<?xml version="1.0" ?>
<kc>

<title>Wine Traffic</title>

<author contact="http://www.theshell.com/~vinn">Brian Vincent</author>

<issue num="175" date="6/20/2003" />

<intro>
<p>This is the 175th release of the Wine's kernel cousin publication. 
  Its main goal is to ensure I spend more time at the driving range instead
  of indoors writing WWN issues.
  It also serves inform you of what's going on around Wine
  (the Un*x Windows emulator).</p>
</intro>






<stats posts="138" size="460" contrib="57" multiples="28" lastweek="31">

<person posts="17" size="47" who="Mike Hearn" />
<person posts="14" size="34" who="Alexandre Julliard" />
<person posts="7" size="15" who="Lionel Ulmer" />
<person posts="5" size="21" who="Sylvain Petreolle" />
<person posts="5" size="14" who="Gregory M. Turner" />
<person posts="5" size="12" who="Eric Pouech" />
<person posts="4" size="14" who="Kelly Leahy" />
<person posts="4" size="14" who="Robert North" />
<person posts="4" size="14" who="OverrideX" />
<person posts="4" size="10" who="Christian Costa" />
<person posts="4" size="9" who="Sundaranathan S" />
<person posts="4" size="11" who="Raphael Junqueira" />
<person posts="3" size="8" who="Gerald Pfeifer" />
<person posts="3" size="7" who="Shachar Shemesh" />
<person posts="3" size="6" who="BiGgUn" />
<person posts="2" size="9" who="Aric Stewart" />
<person posts="2" size="7" who="Rok Mandeljc" />
<person posts="2" size="5" who="Ove Kaaven" />
<person posts="2" size="5" who="Christian Neumair" />
<person posts="2" size="5" who="Juraj Hercek" />
<person posts="2" size="5" who="Duane Clark" />
<person posts="2" size="4" who="Robert Shearman" />
<person posts="2" size="4" who="Jeremy Newman" />
<person posts="2" size="4" who="Dustin Navea" />
<person posts="2" size="4" who="Marcus Meissner" />
<person posts="2" size="4" who="Sylvain Petreolle" />
<person posts="2" size="3" who="Auge Mike" />
<person posts="1" size="37" who="Mark Dufour" />
<person posts="1" size="22" who="Tom Wickline" />
<person posts="1" size="21" who="Steven Edwards" />
<person posts="1" size="8" who="Josh Metzler" />
<person posts="1" size="4" who="(cartel)" />
<person posts="1" size="4" who="Eric Frias" />
<person posts="1" size="4" who="Francois Gouget" />
<person posts="1" size="3" who="John K. Hohm" />
<person posts="1" size="3" who="Carlos Lozano" />
<person posts="1" size="3" who="Peter Hunnisett" />
<person posts="1" size="3" who="Stephen Pedrosa Eilert" />
<person posts="1" size="2" who="Guy Harrison" />
<person posts="1" size="2" who="Roderick Colenbrander" />
<person posts="1" size="2" who="Emmanuel Goldstein" />
<person posts="1" size="2" who="Brian Vincent" />
<person posts="1" size="2" who="Martin Fuchs" />
<person posts="1" size="2" who="hatky" />
<person posts="1" size="2" who="olivier" />
<person posts="1" size="2" who="Igor Sysoev" />
<person posts="1" size="2" who="Dmitry Timoshkov" />
<person posts="1" size="2" who="Kye Lewis" />
<person posts="1" size="2" who="Todd Vierling" />
<person posts="1" size="2" who="Z_God" />
<person posts="1" size="2" who="Chris Seddon" />
<person posts="1" size="1" who="(fenix)" />
<person posts="1" size="1" who="Gerhard W. Gruber" />
<person posts="1" size="1" who="Zsolt Rizsanyi" />

</stats>




<section 
	title="News: Wine-20030618, TransGaming Update, WineHQ Interview" 
	subject="News"
	archive="http://cvs.winehq.org/cvsweb/wine/ANNOUNCE?rev=1.76&amp;content-type=text/x-cvsweb-markup" 
	posts="3"
	startdate="06/14/2003"
	enddate="06/20/2003"
>
<topic>News</topic>
<p>Alexandre resurfaced from vacation to unleash wine-20030618. 
Generally, releases seems to generate about a 1000 lines added
to the Changelog.  This one resulted in 2102 new lines.  Alexandre
noted the following changes:</p>
<quote who="Alexandre Julliard"><p>
WHAT'S NEW with Wine-20030618: (see 
  <a href="http://cvs.winehq.org/cvsweb/wine/ChangeLog?rev=1.72&amp;content-type=text/x-cvsweb-markup">ChangeLog</a>
  for details)
<ul>
        <li> Still more Direct3D and DirectSound improvements.</li>
        <li> Tons of fixes merged from CrossOver Office 2.0.</li>
        <li> New iphlpapi dll.</li>
        <li> Lots of bug fixes.</li>
</ul></p></quote>

<p>TransGaming <a href="http://downloads.transgaming.com/files/winex-3.1_releasenotes.txt">released
WineX 3.1</a> and noted the following changes:</p>
<quote who="TransGaming"><p>
 With WineX 3.1, TransGamers can enjoy such games as Morrowind and Grand
 Theft Auto: Vice City as well as the many graphical and speed
 improvements visible in games such as Battlefield 1942. Also available
 for TransGamers is a new release of Point2Play, version 1.1, which
 incorporates many changes suggested by TransGamers to enhance
 integration with desktop themes and to simplify game play experience.
</p></quote>

<p>TransGaming also released June's 
<a href="http://www.transgaming.com/showthread.php?news=73">development status
and voting report</a>.  Morrowind has been voted one of the top games
subscribers want, so it's really nice to see that supported. </p>

<p>Last week I forgot to mention the interview on WineHQ 
<a href="http://www.winehq.org/?interview=7">with Mike McCormack</a>.
Look for another one this Tuesday.  </p>

</section><section 
	title="DMusic Interfaces" 
	subject="Dmusic interfaces"
	archive="http://www.winehq.org/hypermail/wine-devel/2003/06/0432.html" 
	posts="3"
	startdate="06/16/2003"
	enddate="06/17/2003"
>
<topic>Multimedia</topic>
<p>Sylvain Petreolle want to know some DirectX work was being done:</p>
<quote who="Sylvain Petreolle"><p>
Is anyone of you working on Dmusic interfaces ?
Now doing test with Dxdiag doesn't work,
it says "No such interface" when trying to create an IDirectPerformance
object.
</p><p>
I did a look through the source and noticed that Dll(Un)RegisterServer
are stubs.
</p></quote>

<p>Rok Mandeljc replied:</p>
<quote who="Rok Mandeljc"><p>
Hi everyone. Sorry for not contributing anything to dmusic in a while,
but I'm currently busy with final exams...
As I can see, more work was done on it :)
</p><p>
This problem can be fixed with adding a 
<ul><code>
if (IsEqualGUID(lpcGUID, &amp;IID_IDirectMusicPerformance)
    || IsEqualGUID(lpcGUID, &amp;IID_IDirectMusicPerformance8))
</code></ul></p><p>
in DMUSIC_CreateDirectMusicPerformance8 (at the time being, there's
check for IID_IDirectMusicPerformance8 only).
</p><p>
But even with this added, dxdiag creates interface, calls some functions
and then crashes (though I have no idea why).
</p><p>
Another thing... does anyone of you know how to write effective chunk
loading function (it will be needed sooner or later since most dmusic
objects are stored in files)?
</p></quote>

<p>Rapha&#235;l Junqueira wrote in to mention him and Christan Costa
were working on getting some games running and expected support to improve.
He also gave a pointer to 
<a href="http://www.winehq.org/hypermail/wine-patches/2003/06/0162.html">a
DMusic patch</a> that might help Sylvain out.</p>

</section><section 
	title="Displaying Icons for Executables" 
	subject="Executables icons"
	archive="http://www.winehq.org/hypermail/wine-devel/2003/06/0396.html" 
	posts="5"
	startdate="06/15/2003"
>
<topic>Fixes</topic>
<p>In Windows, resources such as icons can be embedded in executable
or DLL files.  
Someone uncovered a cosmetic problem was fixed with a simple patch:</p>
<quote who="BiGgUn"><p>
 I wonder why icons located in an executable are not viewable in GetOpenFileName ? I had a look 
 to the source code
 (dlls/shell32/folder.c and dlls/shell32/classes.c) and saw that  a search is made in the registry. 
 But this search failed because my
 system.reg doesn't have the queried entry ( [Software\\Classes\\.exe]). I noticed that the 
 winedefault.reg doesn't have the queried
 entry also. When this search fails, a default icon is applied.
</p><p>
   By manually adding this entry in system.reg, it is still not possible to get the executables 
 icons :-\ I also saw that
 [Software\\Classes\\.exe\\DefaultIcon] is also queried. Even if i manually add this entry again, 
 it's not successful. I think i've
 missed something in these entries definition but i don't know what. Anyway, by forcing the code 
 to look inside executable for icons,
 they finally appear :)
</p><p>
   But it's better to find another solution. How registry should be setted up (system.reg / 
 winedefault.reg) ? Do we need to review
 the code (adding special case for exe files) ?
</p></quote>

<p>Martin Fuchs looked at the problem:</p>
<quote who="Martin Fuchs"><p>

I tried and imported the following entries in the registry:
<ul><code>
[Software\\Classes\\.exe] 1055664996<br />
@="exefile"
<br /><br />
[Software\\Classes\\exefile\\DefaultIcon] 1055665049<br />
@="%1"</code></ul></p><p>

It does work!
it displays the exe-icons, when switching into detail mode of the 
GetOpenFile-dialog box.
</p></quote>

<p>Then he added, <quote who="Martin Fuchs">
 But the last problem is for executables without icons inside of them. 
 The wrong default icon is applied.</quote></p>

<p>The patch worked for a few other people too, so Sylvain Petreolle 
submitted it to wine-patches.  Alexandre committed it shortly after.</p>
</section><section 
	title="Wintab Status" 
	subject="Wintab: beginning to investigate Aric's patch from April."
	archive="http://www.winehq.org/hypermail/wine-devel/2003/05/00.html" 
	posts="5"
	startdate="06/17/2003"
	enddate="06/19/2003"
>
<topic>Status Updates</topic>
<p>Rob North decided to revisit support for tablets.  We
last covered this topic back in 
<a href="http://www.winehq.org/index.php?issue=167#Wintab%20Status%20and%20Development">issue
#167</a>.  
Rob wanted to know if anyone else had worked on it recently:</p>
<quote who="Rob North"><p>
Ok, I've just managed to start looking into Aric's Wintab32 patch from
April 23rd.
</p><p>
I've been extremely busy (more so than I expected) since then, on a
small Java contract. So I've missed my goal of looking into Aric's
code in 3 weeks. (Apologies Aric)
</p><p>
But anyway, I'm starting to look into it.
</p><p>
The first thing I'm seeing is a crash in the WTInfo() wintab call with
Painter 5. Will look into this further, and attempt to fix.
</p><p>
Aric: Ever had this? I'll investigate further before posting up
any significant details, as I suspect the fix is trivial.
</p><p>
Infact, has anyone else looked into this patch?
</p><p>
I haven't looked any further into Aric's other problems with Painter, as 
this WTInfo() error prevents Painter from even starting!
</p><p>
More importantly, I'd like to know why it didn't make it into the CVS?
Did the patch slip behind the filing cabinet (as they do ;-)?
Or was there a more substantive reason to reject the patch?
I think Mike Hearn mentioned something about it's size (v. large)?
Aric, Alexandre: do you want me to want me to re-subimt the patch,
once I've got WTInfo() working?
</p><p>
I've also noticed that it doesn't update Wine's autoconf file to
look for the XInput X extension, as is done to support other dlls that
use X extensions. I assume this should be added.
</p><p>
Just to touch base with Aric: Has anyone done any more work in Code 
Weavers on this?
</p></quote>

<p>Aric thought Rob should take care of submitting something:</p>
<quote who="Aric Stewart"><p>
I think we where waiting on you. :) I did not formally commit it to 
wine-patches because i wanted to get your input first.
</p><p>
If you are planing to expand on my patch, then i would say Alexandre 
should could commit my patch then you work from there. Whatever is 
easiest for you.
</p></quote>

<p>Rob then took a look at the code Aric had submitted a few months 
and noticed some problems:</p>
<quote who="Robert North"><p>
Ok, I've done some preliminary testing, and
fixed obvious bugs that have arisen.
</p><p>
What I found, and could fix:
<ul>
	<li>Sometimes a badly configured tablet can generate
	X errors on the XOpenDevice method.
	Fixed by ensuring tablet driver was functional.
	I don't know if the errors need to be caught, or
	not, but I think they were causing crashes.
	This is probably related to synchronous/asynchronous
	X modes.</li>

	<li>In Photoshop, an infinite loop in method FindOpenContext
	when attepting to traverse the wintab context chain.</li>

	<li>In Painter, a number of methods didn't handle NULL prameters
	properly, resulting in various crashes.
	Wintab uses NULL parameters to signify a query for size of
	available data, or to signify a request to flush the Wintab
	packet queue.</li>
</ul></p><p>
Aric, I'm wondering if I should really be fixing these things, as
these look like the kind of bugs Code Weavers will have fixed in the
  normal course of product support.
</p><p>
After fixing these issues, The following remain:
<ol>
	<li> Photoshop doesn't seem to respond to pressure.</li>
	<li> Painter receives wintab events, but coordinates
		are extreme: only see lines from one side of
		drawing to another.</li>
	<li> Maybe some further research into the errors from XOpenDevice.
		I'm not convinced it is a problem.</li></ol></p><p>

Aric, are these the kind of bugs you were seeing with Painter?
</p><p>
I'm suspicious of the Wintab packet building code, as it has to
build a C data struct on the fly. Looking at the code though, I can't
see anything that could be going wrong.
It could also be a scaling issue, where the scales deduced from X
are wrong (I remember being suspicious of some of the values returned
by the wacom driver).
</p><p>
I've got tons of trace code that runs as a wrapper round wintab
on win98, and will move some of this into the wine impl for more 
testing. I hope this will help solve the remaining bugs.
</p><p>
I think in the light of the crashing bugs, Aric's patch shouldn't
go in as-is.
</p></quote>

<p>Lionel Ulmer gave a pointer to the DGA2 code as an example of
catching X errors.  Aric was surprised Rob had uncovered those 
issues.  He gave a pointer to a program to make sure the tablet
and X were set up properly: </p>
<quote who="Aric Stewart"><p>
The first thing you need to do is make sure that your tablet is working 
under X. There is a great little program called xinput, it is a utility 
that test the XInput module. You can see all the axis of your device and 
make sure they are working. I found that to get XInput to recognize 
pressure from my wacom tablet i needed to run the latest wacom drivers 
from http://linuxwacom.sourceforge.net/index.php/main.
</p><p>
you can download xinput from 
<ul>
<a href="ftp://ftp.x.org/contrib/utilities/xinput-1.2.tar.gz">ftp://ftp.x.org/contrib/utilities/xinput-1.2.tar.gz</a>
</ul></p></quote>

</section><section 
	title="Workaround for Xvidmode Graphic Corruption" 
	subject="[D3D] Xvidmode and surface locking"
	archive="http://www.winehq.org/hypermail/wine-devel/2003/06/0477.html" 
	posts="3"
	startdate="06/18/2003"
	enddate="06/19/2003"
>
<topic>Grapghics</topic>
<p>This is a workaround other folks might find useful.  Someone
wrote in with a gaming problem:</p>
<quote who="OverrideX"><p>
Ok, I recently started using System Shock 2 fullscreen with xvidmode
enabled in my wine config, and here's something strange.  When xvidmode
is enabled, and I'm in a game and press esc to go to the menu, then esc
again to return to the game, or load another save or go through a
bulkhead/elevator and cause it to load another level, when it returns to
the game the 3D area is completely black, though the HUD/inventory and
brackets around items all shows up.  This happens with a cvs from
2003-06-08 and also with a cvs from 2003-05-17, however if I don't patch
2003-05-17 with the surface locking the screen doesn't black when
loading a saved game or moving between levels, etc. (of course then
there's no hud or anything without the surface locking) So basically
it's like you can only load 1 saved game,  then the next area you go to
or saved game you restore you need to save and restart the game for it
to go away. Sorry I didn't notice this sooner when testing it out for
you :) If you need any tracing done I'd be glad to, just tell me what ya
need, also if you want a demo of ss2 I could give you a link to that
too.... cheers -Dan</p></quote>

<p>Lionel Ulmer diagnosed the real problem:</p>
<quote who="Lionel Ulmer"><p>
Well, seeing this description, I could say only one thing : DRIVER PROBLEM
:-)
</p><p>
You description seems to imply that the glReadPixels call returns a
completely black frame buffer (whereas the drawing seems to work well as
shown when you remove the surface locking stuff). To be 100 % sure, you could
enable the debug code in the Lock / Unlock case to have nice screenshots (if
they are all black, that would show that :-) ).
</p><p>
Maybe it could be fixed by my attempts to use the texture engine instead of
glReadPixels (to be submitted only after profiling)...
</p><p>
Did you try changing the resolution manually using Ctrl +/- ? Does it work
like that ?
</p></quote>

<p>Dan reported that worked,
<quote who="OverrideX">
 hitting
 ctrl+alt+(+/-) causes what was black to be drawn properly... so just
 hitting +/- real quick after loading a game works fine
</quote></p>

</section><section 
	title="Missing Bugzilla Descriptions" 
	subject="Missing Bugzilla Descriptions"
	archive="http://www.winehq.org/hypermail/wine-devel/2003/06/0451.html" 
	posts="6"
	startdate="06/16/2003"
	enddate="06/18/2003"
>
<topic>Project Management</topic>
<p>Did you have a bug in the <a href="http://bugs.winehq.org">Bugzilla</a>
database?  Well it seems we've lost a lot of it
(see <a href="http://www.winehq.org/index.php?issue=171#Bugzilla%20Upgraded">issue #171</a>
for more details.)  Dustin Navea described the issues he was running into and asked if
a solution was on the horizon,
<quote who="Dustin Navea">
 Hey guys i was browsing thru BugZilla and I noticed that most if not all of
 the bugs between 853-1349 are missing their descriptions..  Possibly from the
 software update?</quote></p>

<p>Rob North noticed the same,
<quote who="Robert North">
2 *important* bugs for me 1160 &amp; 1165 are missing any comments.
1165 in particular, contained some useful debugging info ... I suppose 
it's a good thing that it seems to be resolved in the current CVS!</quote></p>

<p>Duane Clark gave a pointer to an archive where comments could be searched,
<quote who="Duane Clark">
Well, most all the bugs and comments after Apr 2002 should be archived 
on 
<a href="http://news.gmane.org">news.gmane.org</a>. That includes new bugs
starting about bug 565. It is 
a lot easier to browse with gmane than the winehq archives (select all 
articles and sort by subject). However, gmane doesn't archive the 
attachments.</quote></p>

<p>Jeremy Newman had originally thought the descriptions had been in the
database but Bugzilla just wasn't pulling them out.  This week he reported
that wasn't the case,
<quote who="Jeremy Newman">
 Those bug descriptions are gone. I thought I had a recent backup of
 them. I thought wrong. The last good backup I have is from Aug 2000. It
 was in daily rotation after that. Whatever caused them to disappear,
 happened 2 weeks before anyone even noticed. All two weeks of my tape
 rotations have those bugs missing.</quote> Then he added,
<quote who="Jeremy Newman">
 If anyone else has some time for data entry, we could use
 some volunteers here.</quote></p>

<p>So, anyone out there tracking a bug might want to take some time and
pull the comments out of news.gmane.org.  Rebuilding an entry wouldn't
be too hard.</p>

</section></kc>

