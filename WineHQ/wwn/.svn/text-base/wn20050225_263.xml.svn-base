<?xml version="1.0" ?>
<kc>

<title>Wine Traffic</title>

<author contact="http://www.theshell.com/~vinn">Brian Vincent</author>
<issue num="263" date="02/25/2005" />
<intro> <p>This is the 263rd issue of the Wine Weekly News publication.
Its main goal is to find a dark corner of the library. It also serves to inform you of what's going on around Wine. Wine is an open source implementation of the Windows API on top of X and Unix.  Think of it as a Windows compatibility layer.  Wine does not require Microsoft Windows, as it is a completely alternative implementation consisting of 100% Microsoft-free code, but it can optionally use native system DLLs if they are available.   You can find more info at <a href="http://www.winehq.org">www.winehq.org</a></p> </intro>
<stats posts="227" size="2959" contrib="77" multiples="43" lastweek="41">

<person posts="13" size="63" who="Alex Woods" />
<person posts="13" size="31" who="Alexandre Julliard" />
<person posts="16" size="54" who="Mike Hearn" />
<person posts="9" size="67" who="Raphael" />
<person posts="9" size="29" who="Dmitry Timoshkov" />
<person posts="9" size="25" who="Lionel Ulmer" />
<person posts="9" size="24" who="Tom" />
<person posts="8" size="34" who="Michael Jung" />
<person posts="7" size="23" who="Troy Rollo" />
<person posts="7" size="22" who="Paul Vriens" />
<person posts="6" size="18" who="Steven Edwards" />
<person posts="5" size="16" who="Jonathan Ernst" />
<person posts="4" size="33" who="George Ginden" />
<person posts="4" size="29" who="Tobias Burnus" />
<person posts="4" size="28" who="Francois Gouget" />
<person posts="4" size="23" who="Jeremy White" />
<person posts="4" size="12" who="Mike McCormack" />
<person posts="4" size="12" who="James Hawkins" />
<person posts="4" size="11" who="Ivan Leo Puoti" />
<person posts="3" size="32" who="Oliver Stieber" />
<person posts="3" size="11" who="Boaz Harrosh" />
<person posts="3" size="11" who="Michael Stefaniuc" />
<person posts="3" size="10" who="Rein Klazes" />
<person posts="3" size="9" who="Hans Leidekker" />
<person posts="3" size="9" who="Andreas Mohr" />
<person posts="3" size="8" who="Dimitrie O. Paun" />
<person posts="3" size="8" who="Paul van Schayck" />
<person posts="2" size="62" who="Vishal Gakhare" />
<person posts="2" size="10" who="Darryl Dixon" />
<person posts="2" size="8" who="Holly Bostick" />
<person posts="2" size="7" who="Tony Lambregts" />
<person posts="2" size="6" who="Casper Hornstrup" />
<person posts="2" size="6" who="Sebastian Schlingmann" />
<person posts="2" size="6" who="Fabian Cenedese" />
<person posts="2" size="6" who="(fenix)" />
<person posts="2" size="6" who="Brian Vincent" />
<person posts="2" size="6" who="Vincent B&#233;ron" />
<person posts="2" size="5" who="Dan Kegel" />
<person posts="2" size="5" who="Bill Medland" />
<person posts="2" size="5" who="Juan Lang" />
<person posts="2" size="4" who="Stefan =?utf-8?q?D=C3=B6singer?=" />
<person posts="2" size="4" who="Stefan D&#246;singer" />
<person posts="2" size="2021" who="Anders =?ISO-8859-1?Q?R=F8nningen?=" />
<person posts="1" size="27" who="Kumaran Santhanam" />
<person posts="1" size="5" who="Carl Sopchak" />
<person posts="1" size="5" who="Huw D M Davies" />
<person posts="1" size="4" who="Ge van Geldorp" />
<person posts="1" size="4" who="Rolf Kalbermatter" />
<person posts="1" size="4" who="MightY" />
<person posts="1" size="4" who="Jan Tore Korneliussen" />
<person posts="1" size="3" who="Krzysztof Kosz" />
<person posts="1" size="3" who="Ron Jensen" />
<person posts="1" size="3" who="Pavel Troller" />
<person posts="1" size="3" who="Steven Knight" />
<person posts="1" size="3" who="Krzysztof Foltman" />
<person posts="1" size="2" who="Joris Huizer" />
<person posts="1" size="2" who="Scott W Gifford" />
<person posts="1" size="2" who="Huw Davies" />
<person posts="1" size="2" who="Aric Stewart" />
<person posts="1" size="2" who="Nick Hornback" />
<person posts="1" size="2" who="Duane Clark" />
<person posts="1" size="2" who="Robert Reif" />
<person posts="1" size="2" who="Christian Costa" />
<person posts="1" size="2" who="Rob Shearman" />
<person posts="1" size="2" who="Stefan Leichter" />
<person posts="1" size="2" who="Jesse Allen" />
<person posts="1" size="2" who="Tim Schmidt" />
<person posts="1" size="2" who="Hartmut Haase" />
<person posts="1" size="2" who="paul wise" />
<person posts="1" size="2" who="Fredrik rst" />
<person posts="1" size="2" who="Filip Navara" />
<person posts="1" size="2" who="Erich Hoover" />
<person posts="1" size="2" who="Jonathan Wilson" />
<person posts="1" size="1" who="Vitaly Lipatov" />

</stats>
<section
        title="News: WGA Articles, Misc Press"
        subject="News"
        archive="http://www.eweek.com/article2/0,1759,1766843,00.asp"
        posts="1"
        startdate="02/19/2005"
	enddate="02/25/2005"
>
<topic>News</topic>

<p>Ziff-Davis confuses me.  The same article appeared in both 
<a href="http://www.microsoft-watch.com/article2/0,1995,1766738,00.asp">Microsoft Watch</a>
  and
<a href="http://www.eweek.com/article2/0,1759,1766843,00.asp">eWeek</a>
  written by Mary Jo Foley with two different titles.  The title from the
  Microsoft Watch article makes me cringe, so I'll quote from 
  eWeek's <i>Microsoft Seeks to Bottle Up Open Source Wine</i>article:
</p>
<quote who="eWeek"><p>
  On Wednesday, a developer of Wine - an open-source implementation of 
  the Windows application-programming interface that allows Windows 
  applications to run on Unix and Linux - said he discovered that Microsoft's 
  Windows validation tool checks for Wine and generates an error when 
  it is found.
</p><p>
  Wine developer Ivan Leo Puoti's e-mail was linked on the Slashdot.org 
  site and immediately generated a flood of comments.
</p></quote>

<p>Yes it did generate a lot of comments.</p>

<p>Earlier this week another article appeared on eWeek, 
<i><a href="http://www.eweek.com/article2/0,1759,1766920,00.asp">Microsoft vs.
Wine: Deja Vu on the FUD Front</a></i>, by Steven J. Vaughan-Nichols.  
It's a great summary, I'd suggest reading it.  A little quote:</p>
<quote who="eWeek"><p>
Now, what do most users think when something doesn't work? That's right, they 
think it's whoever builds the software. So in this case, the problem won't 
be the people behind Wine. But, it's not them, it's Microsoft.</p></quote>

<p><i>Feel the love.</i></p>

<p>Later in the week,
<a href="http://news.zdnet.co.uk/software/linuxunix/0,39020390,39188944,00.htm">
ZDNet UK picked up</a> the story and included an interview with Jeremy White:
</p><quote who="Jeremy White"><p>
"The reason we love this is because this shows that Microsoft is aware of Wine at very high levels," said White. "For us it's exciting -- it is an acknowledgement of us as a threat. Microsoft does not want the world to know how terrified of Wine they are."
</p></quote>

<p>Unmentioned in any of the articles are the recent developments in
Wine.  I guess that's what WWN is for.  Many major components
being protected with the WGA are already in the process of being
replaced, including MSI and DCOM.  </p>

<p>Government Computer News 
<a href="http://www.gcn.com/24_4/prod_reviews/35101-1.html">reviewed
3 Linux distributions</a> and Mac OS X.  The Xandros review was quite
favorable:</p>
<quote who="Government Computer News"><p>
But by far the most powerful feature of Xandros is its ability to run 
Microsoft Office applications through a program called CrossOver, written by 
CodeWeavers Inc. of St. Paul, Minn. CrossOver Office 4.1, originally bundled 
in Xandros 2.5, lets several supported Windows applications such as Microsoft 
Office 97, 2000, and XP run in the Linux environment. CrossOver also makes 
Adobe Photoshop 6, Adobe FrameMaker 7.1 and Dreamweaver MX file compatible in 
the Xandros environment. With CrossOver, government agencies using Lotus 
Notes 5 or later are also safe to use those applications. The CrossOver 
application makes the transition from a Windows environment to a Linux world 
particularly easy.</p></quote>


<p>Linux Journal had a series of three articles discussing the integration
of Linux and Windows.  It's a pretty neat series and contains some original
ideas.  In 
<a href="http://www.linuxjournal.com/article/8113">part 3</a> they 
included a few paragraphs discussing Wine, specifically using 
Lotus Notes with it:</p>
<quote who="Linux Journal"><p>
 I had high hopes that IBM would provide a Linux client for Notes, but 
none is available as of yet. IBM is committed to Linux as a Notes server 
platform, which is great, but its support of a Linux client is lacking. 
That being said, there is a way to run a Windows Notes client on the 
Linux desktop--WINE to the rescue.</p></quote>

<p>On a lighter note, over at linuX-gamers.net an article 
<a href="http://www.linux-gamers.net/modules/news/article.php?storyid=707">about
World of Warcraft</a> appeared complementing a thread on wine-devel that's 
covered below.  Just a few years ago it seemed like gaming with Wine was 
stagnant so the recent activity is great to see:</p>
<quote who="linuX-gamers.net"><p>
Since there was only two things preventing operation of the game. The people at 
WineHQ have got World of Warcraft working with the help of Blizzard's WoW 
maintainer on the latest cvs and some patches provided on the developer 
mailing list. The game is playable under OpenGL using Raphael's Pbuffer patch.
</p></quote>

<p>The best part of the news?  Screenshots!  
<ul>
 <li><a href="http://www.linux-gamers.net/uploads/img421c8552d7338.jpg">Screenshot #1</a></li>
 <li><a href="http://www.linux-gamers.net/uploads/img421c857a5d6b1.jpg">Screenshot #2</a></li>
</ul></p>

</section>

<section 
	title="World of Warcraft &amp; PBuffers"
	subject="World Of Warcraft"
	archive="http://www.winehq.org/hypermail/wine-devel/2005/02/0391.html" 
	posts="57"
	startdate="02/16/2005"
	enddate="02/23/2005"
>
<topic>DirectX</topic>
<topic>Graphics</topic>
<p>The World of Warcraft news above spawned from a lengthy thread on wine-devel
that stretched through 57 messages.  This also happens to be the thread
I mentioned last week that I hadn't covered.  Well, over the past week more
debugging and testing by Alex Woods resolved the major problem.  After a 
few debugging sessions, the heart of the problem was identified and 
Alex wrote:</p>
<quote who="Alex Woods"><p>
It looks as though it's the Pbuffer stuff it is after.  Right after all
those wglGetProcAddress it does this:
<ul><code>
trace:opengl:wglCreatePbufferARB (0x7b8, 1, 1024, 1024, 0x55bdfc4c)<br />
trace:opengl:wglGetPbufferDCARB ((nil))
</code></ul></p><p>
So I guess it could be setting up stuff for the minimap long before it
gets into the actual game.
</p><p>
Have you actually started on the Pbuffer code now Raphael?  If you have,
is there anything I can do to help?  At the very least I have a testbed
I suppose ;)
</p></quote>

<p>That begs the question, what is all this PBuffer crap?  
<a href="http://www.mesa3d.org/pbuffers.html">Pixel buffers</a> are part
of OpenGL and can be used to do off-screen rendering.  Generally
the reason you want to render off-screen is for performance.  First,
you set up a nice image buffer and you do all your rendering into it.  
The processing to make a complete scene can be extensive and doing it
in real-time can incur a noticeable performance hit.  After you've 
rendered your scene into a buffer, it simply gets copied onto the
screen.  Needing PBuffer support led Lionel Ulmer to remark:</p>
<quote who="Lionel Ulmer"><p>

Ah ah !! Now we have some motivation to actually work on PBuffers... Now
who, from Raphael, Olivier or me will send the patch first :-) ?
</p></quote>

<p>The next day Raphael Junqueira came up with 
<a href="http://www.winehq.com/hypermail/wine-devel/2005/02/att-0693/01-gl.diff">a
patch</a>.  Alex tried it out and reported:</p>
<quote who="Alex Woods"><p>

I owe you a beer!
</p><p>
It works great.  No crash, and the minimap is there looking how I think
it should (don't have windows or cedega so it's the first time I've seen
inside the game properly).  Unfortunately, wine crashes out if I move
the mouse to another display.  so I can't take a screenshot for you :(
I'll take a look at that later when I've got more time.  The minimap
even works indoors (I think start rooms count as indoors), which is
apparently something that doesn't work in cedega in opengl mode ;)
</p><p>
There were a couple of compile warnings, but nothing to worry about
</p></quote>

<p>Raphael cleaned up the patch and submitted it to wine-patches. There
appears to be some parts Alexandre didn't like, but hopefully it's on
its way in.  </p>

<p>Alex noted <i>World of Warcraft</i> supports both DirectX9 and
OpenGL for 3D, but only the latter works:</p>
<quote who="Alex Woods"><p>
The game is playable under OpenGL using Raphael's Pbuffer patch. 
The d3d9 mode doesn't currently work since the support for this 
dll is not complete. With Oliver Stieber's DirectX 9 patches the 
game has been run, but isn't quite playable yet.</p></quote>

</section>
<section
        title="OLE Status"
        subject="Re: Making builtin OLE32 work right"
        archive="http://www.winehq.org/hypermail/wine-devel/2005/02/0547.html"
        posts="5"
        startdate="02/18/2005"
	enddate="02/19/2005"
>
<topic>Status Updates</topic>
<p>Mike McCormack wanted to know what issues with OLE32 needed to
be tacked,
<quote who="Mike McCormack">
 I'd like to compile a list of all applications that don't work correctly 
 without native ole32 (aka dcom95), then go through and try fix them.
</quote></p>

<p>Mike Hearn ran through a list of issues:</p>
<quote who="Mike Hearn"><p>

Here is a brain dump of what I already know we need to fix for the CW
supported apps:
<ol>
<li> InstallShield:    <ul>RPC call re-entrancy</ul></li>

<li> Lotus Notes:      <ul>OLE drag/drop leaves an image of the window behind
                     when it closes. Native does this functionality very
                     differently to us.</ul>
</li>
<li> VB apps:          <ul>As Holly Bostick discovered to her cost, we can't
                     load all OLEPicture resources correctly. Our OLEFont
                     code also has misc bugs in, but we don't have any
                     tests and code which uses these objects is rare so
                     the full extent of the work here is an unknown</ul>
</li>
<li> OLE Storage:      <ul>IIRC misc things break in Office when this is pulled
			</ul></li>

<li> Office embedding: <ul>We need marshallers for IOleObject for this, I think ...
                     possibly a lot more. I do not know the details.</ul>
</li>
<li> iTunes/iPod:    
	<ul>Not fully investigated yet but I think we need to
                     drop the typelib marshaller hack (this stands a 
                     good chance of breaking InstallShield for a short
                     time as well)</ul>

And one thing we probably don't care about:
</li>
<li> Microsoft Transaction Server needs the typelib marshaller to generate
   RPC marshal-ops (format strings) instead of using custom marshalling
   like we do right now. But who cares about MTS while InstallShield and
   Office still aren't there? :)</li>
</ol></p></quote>



</section>

<section 
	title="Forwarding rsabase to rsaenh" 
	subject="Re: status of wine dlls"
	archive="http://www.winehq.com/hypermail/wine-devel/2005/02/0552.html" 
	posts="10"
	startdate="02/19/2005"
	enddate="02/23/2005"
>
<topic>Security</topic>
<p>Michael Jung has done a lot of work to implement the new rsaenh crypto
library.  This week he commented on what direction this should take:</p>
<quote who="Michael Jung"><p>
 As a rough guess, I would say that rsaenh.dll is 70% complete by now. 
</p><p>
 I think we should get rid of the rsabase.dll entry on the status_dll site 
(and probably also in wine cvs): rsaenh.dll is a complete replacement and 
rsabase isn't shipped anymore by Microsoft since Win2k (Applications don't 
load rsabase/rsaenh directly, but via advapi32, which looks it up in the 
registry). </p></quote>

<p>Alexandre cautioned against removing it completely since some apps
might specifically look for it.  Then he noted,
<quote who="Alexandre Julliard">
 We could remove the code though, and make it
forward everything to rsaenh.</quote></p>

<p>Michael went ahead and did that,
<quote who="Michael Jung">
 As suggested by Alexandre, I removed all implementation code from rsabase and 
 made it a pure wrapper around rsaenh. I've imitated the scheme used in wine's 
 unicows.dll to do so. </quote></p>

<p>Alexandre looked at it and noted,
<quote who="Alexandre Julliard">

You don't need that, you can forward directly in the spec file.
Unicows has to do it differently because of the way it's loaded, but
other dlls can use normal forwards.</quote></p>

<p>Michael made the change and submitted a patch.</p>


</section>
<section 
	title="Compiling for Windows and Cross-Compiling" 
	subject="Compiling wine dlls for windows"
	archive="http://www.winehq.com/hypermail/wine-devel/2005/02/0741.html" 
	posts="4"
	startdate="02/24/2005"
>
<topic>Build Process</topic>
<p>Michael Jung wanted to know how to compile a DLL for Windows,
<quote who="Michael Jung">

I would like to test a wine dll I'm working on on windows. Could you please 
tell me how the wine dlls are build for windows ? (Or beat me to the
place where it is documented.)</quote></p>

<p>Steven Edwards gave some pointers:</p>
<quote who="Steven Edwards"><p>
Ivan has a script he uses and there are a few patches I keep in my tree. You 
can build on Windows using Msys and Mingw. Or if you want to cross-compile 
from linux I can send you my compiler.</p><p>

Get msys and from www.sourceforge.net/projects/mingw and the compiler 
versions that work best are the ones listed here

<ul><a href="http://reactos.com/wiki/index.php/Build_Environment">
http://reactos.com/wiki/index.php/Build_Environment</a></ul>
</p>
<p>
Older binutils have a forward exports bug that can cause problems.
</p><p>
You will also need a copy of flex and bison for windows. You can get them from here

<ul><a href="http://prdownloads.sourceforge.net/mingw/mingwDTK-1.0.0-alpha-1.tar.gz">
http://prdownloads.sourceforge.net/mingw/mingwDTK-1.0.0-alpha-1.tar.gz</a></ul>
</p></quote>

<p>Hans Leidekker offered some suggestions as well:</p>
<quote who="Hans Leidekker"><p>
Among other possibilities, if you have an RPM based distro
you could use my MinGW cross compiler RPM packages, prebuilt
for Fedora Core and SUSE but also available as source RPMS
to rebuild yourself:

  <ul><a href="http://mirzam.it.vu.nl/mingw">
  http://mirzam.it.vu.nl/mingw</a></ul></p><p>

You need to do an out-of-tree build for the Wine tools as
well as the PE build. Off the top of my head I repeat 
Alexandre's original recipe here: Assuming your wine
tree is at /sources/wine:
<ul><code>
 $ cd /sources<br />
 $ mkdir wine-tools wine-pe<br />
 $ cd wine-tools<br />
 $ ../wine/configure &amp;&amp; make depend &amp;&amp; make tools<br />
 $ cd ../wine-pe<br />
 $ ../wine/configure --with-wine-tools=../wine-tools --host=i386-ming32<br />
 $ make depend &amp;&amp; make</code></ul></p><p>

The last step will spit out many errors mostly because
Wine targets Unix platforms, not a Windows platform like
MinGW. But most dlls will actually build if you ignore
the errors (make -k) or cd into the dll's directory first.
</p></quote>

</section>
<section 
	title="Why Custom Threading?" 
	subject=""
	archive="http://www.winehq.com/hypermail/wine-devel/2005/02/0.html" 
	posts=""
	startdate="02/  /2005"
	enddate="02/  /2005"
>
<topic></topic>
<p>Bill Medland wanted to know the details about how Wine's threading
works and what was involved with implementing it:</p>
<quote who="Bill Medland"><p>
Does anyone know any site or book or something with a decent discussion about
the problems of the different threading models and their implementations?
</p><p>
In the Developer's Guide in section 8.3 there are references to "the threading
chapter".  Is this a section that has not yet been written?
</p><p>
As I understand it we (in the pthreads version) "override the native pthreads
library".  What does this mean?
</p><p>
I am trying to research the issues associated with threading so that I
understand the complications.  The fact that Linux has two models and that
Wine, FreeDCE and Samba (that I know of) seem to have found it necessary to
bypass/hack/modify/override them indicates to me that there is something to
understand.
</p></quote>

<p>Mike Hearn pointed out the docs had moved, but were still around:</p>
<quote who="Mike Hearn"><p>

It was written, and then the developer guide was reorganised and a ton of
content was moved around. It's now under "NTDLL", which IMHO isn't very
intuitive but I didn't reorganise it so I would say that :)

<ul><a href="http://www.winehq.org/site/docs/winedev-guide/ntdll">
http://www.winehq.org/site/docs/winedev-guide/ntdll</a></ul></p></quote>

</section></kc>
