From scott at open-vote.org  Mon Apr 14 03:39:08 2008
From: scott at open-vote.org (Scott Ritchie)
Date: Mon, 14 Apr 2008 01:39:08 -0700
Subject: Feature Request: Registry / winecfg entry for launching an application
	in a wineexplorer window
Message-ID: <4803182C.9070209@open-vote.org>

I have a few full screen applications that I'd like to run contained in
small windows.  Currently, in order to run them this way, I have to
either open winecfg and set a virtual desktop or launch the application
on the terminal with: wine explorer /desktop=name,1024x768 app.exe

What I'd like is something that does this for me similar to app
defaults.  That way I could run the application by double clicking it
(or from the shortcut in the start menu) and have it contained in the
window I want.

Ideally I'd be able to enable this setting from a right
click->properties menu, however that work isn't necessarily needed
within Wine other than support for modifying this new key using
something like reg.exe on the terminal.

It seems like it'd be fairly simple to implement, too.  Any thoughts?

Thanks,
Scott Ritchie


From austinenglish at gmail.com  Mon Apr 14 05:23:55 2008
From: austinenglish at gmail.com (Austin English)
Date: Mon, 14 Apr 2008 05:23:55 -0500
Subject: Feature Request: Registry / winecfg entry for launching an
	application in a wineexplorer window
In-Reply-To: <4803182C.9070209@open-vote.org>
References: <4803182C.9070209@open-vote.org>
Message-ID: <b6bb06270804140323h337208dcoaed798540f800b1@mail.gmail.com>

On Mon, Apr 14, 2008 at 3:39 AM, Scott Ritchie <scott at open-vote.org> wrote:
> I have a few full screen applications that I'd like to run contained in
>  small windows.  Currently, in order to run them this way, I have to
>  either open winecfg and set a virtual desktop or launch the application
>  on the terminal with: wine explorer /desktop=name,1024x768 app.exe
>
>  What I'd like is something that does this for me similar to app
>  defaults.  That way I could run the application by double clicking it
>  (or from the shortcut in the start menu) and have it contained in the
>  window I want.
>
>  Ideally I'd be able to enable this setting from a right
>  click->properties menu, however that work isn't necessarily needed
>  within Wine other than support for modifying this new key using
>  something like reg.exe on the terminal.
>
>  It seems like it'd be fairly simple to implement, too.  Any thoughts?
>
>  Thanks,
>  Scott Ritchie
>
>
>

There was a similar request in a  bug a few weeks ago. Someone made
the comment that  since Windows's explorer doesn't support this, we
can't, even though running it on a per-app basis  with the 'wine
explorer /desktop=name,1024x768 app.exe" workaround allows it to work.
I asked for an explanation in the bug, but received no response (I
can't find the bug off hand, I'll keep looking).


From mrmessiah at gmail.com  Mon Apr 14 05:39:37 2008
From: mrmessiah at gmail.com (Chris Howe)
Date: Mon, 14 Apr 2008 11:39:37 +0100
Subject: Feature Request: Registry / winecfg entry for launching an
	application in a wineexplorer window
In-Reply-To: <b6bb06270804140323h337208dcoaed798540f800b1@mail.gmail.com>
References: <4803182C.9070209@open-vote.org>
	<b6bb06270804140323h337208dcoaed798540f800b1@mail.gmail.com>
Message-ID: <39c14e440804140339y4979331didff42e4345558f24@mail.gmail.com>

On Mon, Apr 14, 2008 at 11:23 AM, Austin English <austinenglish at gmail.com>
wrote:

>
> There was a similar request in a  bug a few weeks ago. Someone made
> the comment that  since Windows's explorer doesn't support this, we
> can't, even though running it on a per-app basis  with the 'wine
> explorer /desktop=name,1024x768 app.exe" workaround allows it to work.
>

As WINE is not a Windows Emulator, but rather a means to get Windows
applications to run in Linux, I see no reason why this shouldn't be allowed
in WINE's explorer.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080414/b6c006d1/attachment.htm 

From julliard at winehq.org  Mon Apr 14 05:57:45 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 14 Apr 2008 12:57:45 +0200
Subject: wine.info add fake dlls for msacm32.drv and midimap.dll
In-Reply-To: <19e31a080804122256h6b4a5534m6b61acae87f8c479@mail.gmail.com>
	(Steven Edwards's message of "Sun, 13 Apr 2008 01:56:29 -0400")
References: <19e31a080804122129j75bc068cr1fe1e023e05aa011@mail.gmail.com>
	<024001c89d2a$698bdc60$a600fea9@DMITRY>
	<19e31a080804122256h6b4a5534m6b61acae87f8c479@mail.gmail.com>
Message-ID: <87wsn07lg6.fsf@wine.dyndns.org>

"Steven Edwards" <winehacker at gmail.com> writes:

> If I understand the issue correctly the problem is in Wine. The
> application works on Windows no problem. The Thinstall LoadLibrary
> hook can't be expected to know about builtin dlls if its searching the
> default directories or looking up KnownDLLs in the registry and they
> are not there, then failure is by design.

This would require creating fake dlls for every single dll we support.
That's a bit problematic considering that we need to load the dll to
retrieve the proper info.

It seems broken for Thinstall to try to second-guess the library search
algorithm, especially now with activation contexts and the like. I'd
argue that they should forward the call to LoadLibrary unless the file
has been explicitly deleted.

-- 
Alexandre Julliard
julliard at winehq.org


From chris.kcat at gmail.com  Mon Apr 14 07:34:33 2008
From: chris.kcat at gmail.com (Chris Robinson)
Date: Mon, 14 Apr 2008 05:34:33 -0700
Subject: Feature Request: Registry / winecfg entry for launching an
	application in a wineexplorer window
In-Reply-To: <4803182C.9070209@open-vote.org>
References: <4803182C.9070209@open-vote.org>
Message-ID: <200804140534.33333.chris.kcat@gmail.com>

On Monday 14 April 2008 01:39:08 am Scott Ritchie wrote:
> I have a few full screen applications that I'd like to run contained in
> small windows.  Currently, in order to run them this way, I have to
> either open winecfg and set a virtual desktop or launch the application
> on the terminal with: wine explorer /desktop=name,1024x768 app.exe
>
> What I'd like is something that does this for me similar to app
> defaults.  That way I could run the application by double clicking it
> (or from the shortcut in the start menu) and have it contained in the
> window I want.

IIRC, the problem is you can't have two Wine processes using two different 
desktops. Try this: start an app without virtual desktop and leave it 
running, run winecfg and turn on virtual desktop (make sure to click Apply), 
then try to start another app. It won't use a virtual desktop.

I'm also not sure virtual desktop mode should be seen as a way to force 
fullscreen apps into a windowed mode, because that's not what it does. The 
app takes up the whole desktop still, it's just contained within a window 
that Wine controls for better compatibility, like the unmanaged windows 
setting.


From Petr.Sumbera at Sun.COM  Mon Apr 14 08:17:34 2008
From: Petr.Sumbera at Sun.COM (Petr Sumbera)
Date: Mon, 14 Apr 2008 15:17:34 +0200
Subject: error: `XICCallback' undeclared (Solaris build problem)
Message-ID: <4803596E.1030800@sun.com>

Hi all,

It seems that following change from last Friday broke Solaris build:

http://source.winehq.org/git/wine.git/?a=commitdiff;h=185157cb6eb25bc5e75e9a260b593e98153d2255

This is probably because Solaris /usr/include/X11/Xlib.h doesn't define 
XICCallback.

-bash-3.2$ grep XICCallback /usr/include/X11/Xlib.h
-bash-3.2$

Compilation error is following:

gcc -c -I. -I. -I../../include -I../../include  -D__WINESRC__ 
-D_REENTRANT -fPIC -Wall -pipe -fno-strict-aliasing 
-Wdeclaration-after-statement -Wwrite-strings -Wpointer-arith 
-std=gnu99  -o xim.o xim.c
xim.c: In function `X11DRV_DestroyIM':
xim.c:371: warning: passing arg 5 of `XRegisterIMInstantiateCallback' 
from incompatible pointer type
xim.c: In function `X11DRV_OpenIM':
xim.c:398: warning: assignment from incompatible pointer type
xim.c:475: warning: passing arg 5 of `XUnregisterIMInstantiateCallback' 
from incompatible pointer type
xim.c: In function `X11DRV_SetupXIM':
xim.c:485: warning: passing arg 5 of `XRegisterIMInstantiateCallback' 
from incompatible pointer type
xim.c: In function `X11DRV_CreateIC':
xim.c:504: error: `XICCallback' undeclared (first use in this function)
xim.c:504: error: (Each undeclared identifier is reported only once
xim.c:504: error: for each function it appears in.)
xim.c:504: error: syntax error before "destroy"
xim.c:500: warning: unused variable `spot'
xim.c:501: warning: unused variable `preedit'
xim.c:502: warning: unused variable `status'
xim.c:503: warning: unused variable `xic'
...

Any idea or comment to this?

Thanks,

Petr


From dank at kegel.com  Mon Apr 14 10:09:26 2008
From: dank at kegel.com (Dan Kegel)
Date: Mon, 14 Apr 2008 08:09:26 -0700
Subject: Including Mono within a Wine package - should Wine expect this?
In-Reply-To: <20080414061400.39750@gmx.net>
References: <a71bd89a0804100645y2b7f9c94n719ab5f19374db04@mail.gmail.com>
	<47FECF9E.1030309@open-vote.org>
	<a71bd89a0804101954w31a24e2fn72c027796b771a6e@mail.gmail.com>
	<47FF506D.4010102@open-vote.org> <20080411125059.293230@gmx.net>
	<19e31a080804131011s11342880qd0ee9d2981a1c9be@mail.gmail.com>
	<a71bd89a0804131228w188ecd20r9802c35198b25764@mail.gmail.com>
	<20080414061400.39750@gmx.net>
Message-ID: <a71bd89a0804140809s1d1af678uf5a6170ab5a1ae97@mail.gmail.com>

On Sun, Apr 13, 2008 at 11:14 PM, Roderick Colenbrander
<thunderbird2k at gmx.net> wrote:
>  What we really need is mono's windows.forms to be layered on top of gdi32 and user32 for windows controls like buttons, textboxes and so on .. As lots of programs do overrides using native dlls on them, so that's why it should be real windows controls with a wndproc.
>
>  Ironically the current situation is for a part our own issue. Years ago Mono's windows.forms used winelib. They moved to a managed implementation because they had wine integration issues and we weren't that cooperative. Further they didn't like the 2d performance much (likely due to the lack of a dib engine ..). They might be reluctant to Wine.

Yup.  We have to really get our act together, then undoing the fork
might make sense.


From lich at math.spbu.ru  Mon Apr 14 11:30:40 2008
From: lich at math.spbu.ru (Kirill K. Smirnov)
Date: Mon, 14 Apr 2008 20:30:40 +0400
Subject: ws2_32: Work around the host name resolving to 127.x.x.x when using
	that for binding.
Message-ID: <200804142030.41154.lich@math.spbu.ru>

Hi,

nitpick:
> +                        /* Trying to bind to the default hots interface, 
using
Typo in word 'host'?

--
Kirill


From frick at sc-networks.de  Mon Apr 14 11:29:32 2008
From: frick at sc-networks.de (Christoph Frick)
Date: Mon, 14 Apr 2008 18:29:32 +0200
Subject: ws2_32: Work around the host name resolving to 127.x.x.x when
	using that for binding.
In-Reply-To: <200804141605.23704.kai.blin@gmail.com>
References: <200804141605.23704.kai.blin@gmail.com>
Message-ID: <20080414162932.GX5348@byleth.sc-networks.de>

On Mon, Apr 14, 2008 at 04:05:23PM +0200, Kai Blin wrote:

Hi Kai, et all,

> +static const char magic_loopback_addr[] = {127, 12, 34, 56};

in the past wine used to work quite well with the ip-address configured
using the places in the windows registry (msdn or something similar kept
an howto for setting the ips in win98 and 2k (and look alikes)). now
that wine tries to get its ip from the /etc/hosts (or whereever?) i
noticed some problems with hosting games. as msdn keeps firing errors at
me i go and ask the list about this.

i always though windows (at least until xp?) is not capable of listening
to requests bound to an ip/interface? with the recent changes the games
listen to lo0 and will never ever accept anything. i had to change my
/etc/hosts now to make it work again; yet it will fail with more than
one nic (i have to change /etc/hosts again).

long story short:

- does any windows version at all support the idea behind giving an ip
  to listen for connections like unix/linux/bsd does?

- and even if: who runs some windows software in wine that needs this
  features and is not able to fix the problem with the firewall or other
  restrictions on the unix end?

if no: what would be needed to change the listening to 0.0.0.0 by
default? a patch and a test?

-- 
cu
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 163 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080414/46088c15/attachment.pgp 

From zgs at seas.upenn.edu  Mon Apr 14 11:40:51 2008
From: zgs at seas.upenn.edu (Zachary Goldberg)
Date: Mon, 14 Apr 2008 12:40:51 -0400
Subject: Lug Radio Live 2008 wine talk. Slides online, comments welcome.
In-Reply-To: <1207299933.6522.112.camel@jernst-desktop>
References: <a71bd89a0804032026s2f87faa7v27641421c4e07ac1@mail.gmail.com>
	<1207299933.6522.112.camel@jernst-desktop>
Message-ID: <b050a5e70804140940s34467fddv51596d108024f4a4@mail.gmail.com>

Dan,

Any links for us to hear your discussion this past weekend?

--Zach

On Fri, Apr 4, 2008 at 5:05 AM, Jonathan Ernst <jonathan at ernstfamily.ch> wrote:
> ?Hello,
>
>  Le jeudi 03 avril 2008 ? 20:26 -0700, Dan Kegel a ?crit :
>  > [...]
>
>
>  > The slides are pretty basic; I'll talk a lot around them.
>  > If anybody feels like reviewing the slides
>  > and giving feedback, I'd appreciate it.
>
>
>  Slide 4 :
>
>  You might be interested to add some, government related, recent
>  migrations in Europe to this slide :
>
>  French Police ~70'000 seats
>  http://www.cnet.com/8301-13505_1-9861472-16.html
>
>  Geneva, Switzerland schools 9'000 seats
>  http://www.tdg.ch/pages/home/tribune_de_geneve/recherche/recherche_3_2_1/(contenu)/211880
>
>  http://www.google.com/translate?u=http%3A%2F%2Fwww.tdg.ch%2Fpages%2Fhome
>  %2Ftribune_de_geneve%2Frecherche%2Frecherche_3_2_1%2F(contenu)%
>  2F211880&langpair=fr|en&hl=fr&ie=UTF8
>
>  Slide 13 :
>
>  Maybe add "2008: Codeweavers releases Crossover Games"
>
>  I'm looking forward to hearing this second Wine related LugRadio.
>
>  Best regards.
>
>  Jonathan
>
>
>
>
>
>



-- 
Zachary Goldberg
Computer Science & Engineering
Electrical Captain of Penn Electric Race Team
School of Engineering at the University of Pennsylvania

From paulc at voip.null.ro  Mon Apr 14 11:42:26 2008
From: paulc at voip.null.ro (Paul Chitescu)
Date: Mon, 14 Apr 2008 19:42:26 +0300 (EEST)
Subject: ws2_32: Work around the host name resolving to 127.x.x.x when
	using that for binding.
In-Reply-To: <20080414162932.GX5348@byleth.sc-networks.de>
References: <200804141605.23704.kai.blin@gmail.com>
	<20080414162932.GX5348@byleth.sc-networks.de>
Message-ID: <Pine.LNX.4.64.0804141934580.24510@dragoshel>

On Mon, 14 Apr 2008, Christoph Frick wrote:
> On Mon, Apr 14, 2008 at 04:05:23PM +0200, Kai Blin wrote:
>
> Hi Kai, et all,
>
>> +static const char magic_loopback_addr[] = {127, 12, 34, 56};
>
> in the past wine used to work quite well with the ip-address configured
> using the places in the windows registry (msdn or something similar kept
> an howto for setting the ips in win98 and 2k (and look alikes)). now
> that wine tries to get its ip from the /etc/hosts (or whereever?) i
> noticed some problems with hosting games. as msdn keeps firing errors at
> me i go and ask the list about this.
>
> i always though windows (at least until xp?) is not capable of listening
> to requests bound to an ip/interface? with the recent changes the games
> listen to lo0 and will never ever accept anything. i had to change my
> /etc/hosts now to make it work again; yet it will fail with more than
> one nic (i have to change /etc/hosts again).
>
> long story short:
>
> - does any windows version at all support the idea behind giving an ip
>  to listen for connections like unix/linux/bsd does?
>
> - and even if: who runs some windows software in wine that needs this
>  features and is not able to fix the problem with the firewall or other
>  restrictions on the unix end?
>
> if no: what would be needed to change the listening to 0.0.0.0 by
> default? a patch and a test?
>
> -- 
> cu

Hi!

All versions of Windows support binding to an IP address - although the 
(preferred) method used for enumerating interfaces and their IP address 
varies with version (not that there is a portable way across *NIXes).

Binding to a specific address is the only easy way of detecting which 
interface an UDP packet was received on since recvfrom() only gives source 
address, not destination. Listening on 0.0.0.0 would make impossible to 
tell which interface a packet was received on. Furthermore, a program that 
explicitely tries to bind to each interface would fail all but the first 
bind and possibly bail out. Probably many games that use UDP would break.

Regards,

Paul Chitescu


From austinenglish at gmail.com  Mon Apr 14 12:04:23 2008
From: austinenglish at gmail.com (Austin English)
Date: Mon, 14 Apr 2008 12:04:23 -0500
Subject: Feature Request: Registry / winecfg entry for launching an
	application in a wineexplorer window
In-Reply-To: <200804140534.33333.chris.kcat@gmail.com>
References: <4803182C.9070209@open-vote.org>
	<200804140534.33333.chris.kcat@gmail.com>
Message-ID: <b6bb06270804141004nd99e48are3158647a4482bc2@mail.gmail.com>

On Mon, Apr 14, 2008 at 7:34 AM, Chris Robinson <chris.kcat at gmail.com> wrote:
>  IIRC, the problem is you can't have two Wine processes using two different
>  desktops. Try this: start an app without virtual desktop and leave it
>  running, run winecfg and turn on virtual desktop (make sure to click Apply),
>  then try to start another app. It won't use a virtual desktop.
>
>

Terminal one:
$ rm -rf ~/.wine
$ wine notepad

Terminal two:
$ winecfg # enable virtual desktop
$ winemine # doesn't go in virtual desktop
$ wine explorer /desktop=name,1024x768 winemine # goes in virtual desktop

Now can someone please explain why this is? Is it because using the
workaround a second explorer process is started? If so, we can extend
the same process and run those apps needing workarounds in a virtual
desktop...


From slash at ma.neweb.ne.jp  Mon Apr 14 12:26:09 2008
From: slash at ma.neweb.ne.jp (Kusanagi Kouichi)
Date: Tue, 15 Apr 2008 02:26:09 +0900
Subject: error: `XICCallback' undeclared (Solaris build problem)
In-Reply-To: <4803596E.1030800@sun.com>
References: <4803596E.1030800@sun.com>
Message-ID: <200804141726096658890006MAA5@nm06mta.auone-net.jp>

Does this patch fix the problem?

diff --git a/dlls/winex11.drv/xim.c b/dlls/winex11.drv/xim.c
index d4df9f7..b66cf87 100644
--- a/dlls/winex11.drv/xim.c
+++ b/dlls/winex11.drv/xim.c
@@ -501,7 +501,7 @@ XIC X11DRV_CreateIC(XIM xim, struct x11drv_win_data *data)
     XVaNestedList preedit = NULL;
     XVaNestedList status = NULL;
     XIC xic;
-    XICCallback destroy = {(XPointer)data, X11DRV_DestroyIC};
+    XIMCallback destroy = {(XPointer)data, (XIMProc)X11DRV_DestroyIC};
     XIMCallback P_StartCB;
     XIMCallback P_DoneCB;
     XIMCallback P_DrawCB;


From rob at codeweavers.com  Mon Apr 14 12:36:44 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Mon, 14 Apr 2008 18:36:44 +0100
Subject: error: `XICCallback' undeclared (Solaris build problem)
In-Reply-To: <200804141726096658890006MAA5@nm06mta.auone-net.jp>
References: <4803596E.1030800@sun.com>
	<200804141726096658890006MAA5@nm06mta.auone-net.jp>
Message-ID: <4803962C.8060801@codeweavers.com>

Kusanagi Kouichi wrote:
> Does this patch fix the problem?
>
> -    XICCallback destroy = {(XPointer)data, X11DRV_DestroyIC};
> +    XIMCallback destroy = {(XPointer)data, (XIMProc)X11DRV_DestroyIC};
>   

I think a configure check may be a more appropriate fix.

-- 
Rob Shearman



From kai.blin at gmail.com  Mon Apr 14 12:41:55 2008
From: kai.blin at gmail.com (Kai Blin)
Date: Mon, 14 Apr 2008 19:41:55 +0200
Subject: ws2_32: Work around the host name resolving to 127.x.x.x when
	using that for binding.
In-Reply-To: <200804142030.41154.lich@math.spbu.ru>
References: <200804142030.41154.lich@math.spbu.ru>
Message-ID: <200804141942.00589.kai.blin@gmail.com>

On Monday 14 April 2008 18:30:40 Kirill K. Smirnov wrote:
> Hi,
>
> nitpick:
> > +                        /* Trying to bind to the default hots interface,

Thanks for the catch, revised patch sent.

Cheers,
Kai
-- 
Kai Blin
WorldForge developer  http://www.worldforge.org/
Wine developer        http://wiki.winehq.org/KaiBlin
Samba team member     http://www.samba.org/samba/team/
--
Will code for cotton.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080414/fb79f269/attachment.pgp 

From stefan at codeweavers.com  Mon Apr 14 12:45:45 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Mon, 14 Apr 2008 19:45:45 +0200
Subject: IWineD3DBaseTextureImpl_SetAutoGenFilterType missing break inside
	switch
In-Reply-To: <47CC5ABB01651443A88DB8EC5B4D657BE6404B@S4DE8PSAANK.mitte.t-com.de>
References: <47CC5ABB01651443A88DB8EC5B4D657BE6404B@S4DE8PSAANK.mitte.t-com.de>
Message-ID: <200804141945.45824.stefan@codeweavers.com>

Am Montag, 14. April 2008 17:16:25 schrieb Hoehle, Joerg-Cyril:
> Hi,
>
> regardless of issue
> http://bugs.winehq.org/show_bug.cgi?id=11167
> which suggests that the function is incorrect it its use of GL parameters,
> so it needs fixing, you may wish to apply the following (minor) patch.
>
> dlls/wined3d/basetexture.c:IWineD3DBaseTextureImpl_SetAutoGenFilterType
> missing break inside switch
The patch looks ok.


From julliard at winehq.org  Mon Apr 14 14:00:47 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 14 Apr 2008 21:00:47 +0200
Subject: [1/2] shlwapi: Fixed the todo blocks in the SHCreateStreamOnFile
	tests. [try 2]
In-Reply-To: <3f4fd2640804130613q1c93aea4wa57f609446beadca@mail.gmail.com>
	(Reece Dunn's message of "Sun, 13 Apr 2008 14:13:36 +0100")
References: <3f4fd2640804130613q1c93aea4wa57f609446beadca@mail.gmail.com>
Message-ID: <87wsn05kio.fsf@wine.dyndns.org>

"Reece Dunn" <msclrhd at googlemail.com> writes:

> @@ -120,12 +119,12 @@ static HRESULT WINAPI IStream_fnRead(IStream *iface, void* pv, ULONG cb, ULONG*
>    TRACE("(%p,%p,0x%08x,%p)\n", This, pv, cb, pcbRead);
>  
>    if (!pv)
> -    return STG_E_INVALIDPOINTER;
> +    return S_OK;

It's very unlikely that this is the correct behavior in all cases.

> @@ -459,7 +458,9 @@ HRESULT WINAPI SHCreateStreamOnFileEx(LPCWSTR lpszPath, DWORD dwMode,
>    switch(STGM_CREATE_MODE(dwMode))
>    {
>    case STGM_FAILIFTHERE:
> -    dwCreate = OPEN_EXISTING;
> +    if (bCreate && PathFileExistsW(lpszPath))
> +      return HRESULT_FROM_WIN32(ERROR_FILE_EXISTS);
> +    dwCreate = bCreate ? CREATE_ALWAYS : OPEN_EXISTING;

That case should be handled by CreateFile, you shouldn't check for the
file existence explicitly.

-- 
Alexandre Julliard
julliard at winehq.org


From khodych at gmail.com  Mon Apr 14 14:03:37 2008
From: khodych at gmail.com (Sergey Khodych)
Date: Mon, 14 Apr 2008 22:03:37 +0300
Subject: dinput: Convert keyboard buffer from internal data format to
	user data format
In-Reply-To: <48024BE1.1090008@kievinfo.com>
References: <4802384D.1090704@gmail.com> <48024BE1.1090008@kievinfo.com>
Message-ID: <4803AA89.3070806@gmail.com>

A possibility of using custom data format, for any type of devices, is
described in DirectX SDK documentation.
For example Monolith's  F.E.A.R. use this method.

> Any particular reason for this? Do you have a program that sets different 
> data format? The reason I ask - copying 256 bytes is much faster then 
> iterating over the whole data format and copying one byte at a time.
> 
> Vitaliy.
> 
> 
> 




From khodych at gmail.com  Mon Apr 14 14:07:22 2008
From: khodych at gmail.com (Sergey Khodych)
Date: Mon, 14 Apr 2008 22:07:22 +0300
Subject: dinput: Implement DIPROP_KEYNAME property for keyboard device
In-Reply-To: <48024DC2.3020008@kievinfo.com>
References: <48023854.9020308@gmail.com> <48024DC2.3020008@kievinfo.com>
Message-ID: <4803AB6A.3040900@gmail.com>

> 
>> ...
>> +                hr = SysKeyboardWImpl_GetObjectInfo( (LPDIRECTINPUTDEVICE8W)iface , &didoi,
>> +                                                     ps->diph.dwObj, ps->diph.dwHow );
> 
> You mixing unicode and ascii. Also if you are implementing 
> SysKeyboardAImpl_GetProperty you should also implement it's unicode 
> counterpart SysKeyboardWImpl_GetProperty.
Realization of GetProperty for keyboard device for unicode and ascii do
not differ at this time.









From htl10 at users.sourceforge.net  Mon Apr 14 14:19:37 2008
From: htl10 at users.sourceforge.net (Hin-Tak Leung)
Date: Mon, 14 Apr 2008 19:19:37 +0000 (GMT)
Subject: Including Mono within a Wine package - should Wine expect this?
In-Reply-To: <a71bd89a0804131350o4935bf68n1de7253d00ab1e6e@mail.gmail.com>
Message-ID: <666369.76248.qm@web23115.mail.ird.yahoo.com>

--- On Sun, 13/4/08, Dan Kegel <dank at kegel.com> wrote:
<snipped>
> > > 2) porting Mono's WinForms on top of Wine
> gdiplus
> > > instead of Mono gdiplus (and making it more
> win32-ish as
> > > a result)
> >
> >  Mono is using MS GDI+ on Windows since it uses GDI+.
> Mono's libgdiplus is
> > only used on non-Windows platforms.
> 
> I guess I assumed that Mono used native WinForms on
> Windows,
> and that its winforms code was only used on Linux.  I
> clearly
> don't know enough about Mono to discuss it
> intelligently :-)
<snipped>

I can't comment on anything else, but after trying to get a .NET WinForms application
(mentioned in some of the bugs I filed) for a few months under the 3 options of 
native linux mono, wine+.NET and wine+mono, I can say that win32 mono uses P/Invoke
*differently* from how .NET2 does it, and the missing APIs required to get an
application to work with the wine + win32 mono and wine +MS.NET combo is different.
So some part of the applications runs better with wine + win32 mono and some better
with wine + MS.NET ... win32 mono and MS.NET just seems to have different native code dependencies.




      ___________________________________________________________ 
Yahoo! For Good helps you make a difference  

http://uk.promotions.yahoo.com/forgood/


From juan.lang at gmail.com  Mon Apr 14 14:20:19 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Mon, 14 Apr 2008 12:20:19 -0700
Subject: gdiplus: (try2) GdipCloneStringFormat
Message-ID: <3a768c550804141220g4c819a61s979ee74e2ef8add7@mail.gmail.com>

Hi Nikolay,

+GpStatus WINGDIPAPI GdipCloneStrinFormat(GDIPCONST

Typo:  s/StrinFormat/StringFormat/
--Juan


From julliard at winehq.org  Mon Apr 14 15:04:26 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 14 Apr 2008 22:04:26 +0200
Subject: [PATCH 1/6] includes: update aviriff header file
In-Reply-To: <b130c85e0804141221t23034cfcuab1c4936543a9697@mail.gmail.com>
	(Maarten Lankhorst's message of "Mon, 14 Apr 2008 12:21:24 -0700")
References: <b130c85e0804141221t23034cfcuab1c4936543a9697@mail.gmail.com>
Message-ID: <87prss5hkl.fsf@wine.dyndns.org>

"Maarten Lankhorst" <m.b.lankhorst at gmail.com> writes:

> @@ -161,4 +186,135 @@ typedef struct _avimetaindex
>      DWORD adwIndex[0];
>  } AVIMETAINDEX;
>  
> -/* FIXME: index structures missing */
> +#define ckidAVISUPERINDEX FCC('i','n','d','x')
> +typedef struct _avisuperindex {
> +    FOURCC fcc;
> +    UINT cb;
> +    WORD wLongsPerEntry;
> +    BYTE bIndexSubType;
> +    BYTE bIndexType;
> +    DWORD nEntriesInUse;
> +    DWORD dwChunkId;
> +    DWORD dwReserved[3];
> +    struct _avisuperindex_entry {
> +        DWORDLONG qwOffset;
> +        DWORD dwSize;
> +        DWORD dwDuration;
> +    } aIndex[0];
> +} AVISUPERINDEX;

Zero-size arrays are not portable, and this is not what the MS header
does anyway.

-- 
Alexandre Julliard
julliard at winehq.org


From slash at ma.neweb.ne.jp  Mon Apr 14 16:03:53 2008
From: slash at ma.neweb.ne.jp (Kusanagi Kouichi)
Date: Tue, 15 Apr 2008 06:03:53 +0900
Subject: error: `XICCallback' undeclared (Solaris build problem)
In-Reply-To: <4803962C.8060801@codeweavers.com>
References: <4803596E.1030800@sun.com>
	<200804141726096658890006MAA5@nm06mta.auone-net.jp>
	<4803962C.8060801@codeweavers.com>
Message-ID: <200804142103535878180006MA82@nm06mta.auone-net.jp>

On Mon, Apr 14, 2008 at 06:36:44PM +0100, Robert Shearman wrote:
> 
> I think a configure check may be a more appropriate fix.
> 

I don't know proper way to check whether XICCallback is defined.
But this seems to work.

diff --git a/configure b/configure
index b66a40a..01fdf19 100755
--- a/configure
+++ b/configure
@@ -10686,6 +10686,115 @@ esac
 fi
 
 
+                { echo "$as_me:$LINENO: checking for XICCallback.callback" >&5
+echo $ECHO_N "checking for XICCallback.callback... $ECHO_C" >&6; }
+if test "${ac_cv_member_XICCallback_callback+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+#ifdef HAVE_X11_XLIB_H
+#include <X11/Xlib.h>
+#endif
+
+int
+main ()
+{
+static XICCallback ac_aggr;
+if (ac_aggr.callback)
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext
+if { (ac_try="$ac_compile"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
+  (eval "$ac_compile") 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && {
+	 test -z "$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest.$ac_objext; then
+  ac_cv_member_XICCallback_callback=yes
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+	cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+#ifdef HAVE_X11_XLIB_H
+#include <X11/Xlib.h>
+#endif
+
+int
+main ()
+{
+static XICCallback ac_aggr;
+if (sizeof ac_aggr.callback)
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext
+if { (ac_try="$ac_compile"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
+  (eval "$ac_compile") 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && {
+	 test -z "$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest.$ac_objext; then
+  ac_cv_member_XICCallback_callback=yes
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+	ac_cv_member_XICCallback_callback=no
+fi
+
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+{ echo "$as_me:$LINENO: result: $ac_cv_member_XICCallback_callback" >&5
+echo "${ECHO_T}$ac_cv_member_XICCallback_callback" >&6; }
+if test $ac_cv_member_XICCallback_callback = yes; then
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_XICCALLBACK_CALLBACK 1
+_ACEOF
+
+
+fi
+
+
 
         opengl_msg=""
     if test "x$with_opengl" != "xno"
diff --git a/configure.ac b/configure.ac
index e9dadee..b5c4bf2 100644
--- a/configure.ac
+++ b/configure.ac
@@ -698,6 +698,12 @@ then
         WINE_NOTICE_WITH(xcomposite,[test "x$ac_cv_lib_soname_Xcomposite" = "x"],
                          [libxcomposite development files not found, Xcomposite won't be supported.])
 
+        dnl *** Check for XICCallback struct
+        AC_CHECK_MEMBERS([XICCallback.callback],,,
+[#ifdef HAVE_X11_XLIB_H
+#include <X11/Xlib.h>
+#endif])
+
     dnl *** End of X11/Xlib.h check
 
     dnl Check for the presence of OpenGL
diff --git a/dlls/winex11.drv/xim.c b/dlls/winex11.drv/xim.c
index d4df9f7..85d37e8 100644
--- a/dlls/winex11.drv/xim.c
+++ b/dlls/winex11.drv/xim.c
@@ -501,11 +501,13 @@ XIC X11DRV_CreateIC(XIM xim, struct x11drv_win_data *data)
     XVaNestedList preedit = NULL;
     XVaNestedList status = NULL;
     XIC xic;
-    XICCallback destroy = {(XPointer)data, X11DRV_DestroyIC};
-    XIMCallback P_StartCB;
-    XIMCallback P_DoneCB;
-    XIMCallback P_DrawCB;
-    XIMCallback P_CaretCB;
+#ifdef HAVE_XICCALLBACK_CALLBACK
+    XICCallback destroy = {(XPointer)data, (XICProc)X11DRV_DestroyIC};
+    XICCallback P_StartCB, P_DoneCB, P_DrawCB, P_CaretCB;
+#else
+    XIMCallback destroy = {(XPointer)data, (XIMProc)X11DRV_DestroyIC};
+    XIMCallback P_StartCB, P_DoneCB, P_DrawCB, P_CaretCB;
+#endif
     LANGID langid = PRIMARYLANGID(LANGIDFROMLCID(GetThreadLocale()));
     Window win = data->whole_window;
 
@@ -531,13 +533,20 @@ XIC X11DRV_CreateIC(XIM xim, struct x11drv_win_data *data)
 
     /* create callbacks */
     P_StartCB.client_data = NULL;
-    P_StartCB.callback = (XIMProc)XIMPreEditStartCallback;
     P_DoneCB.client_data = NULL;
-    P_DoneCB.callback = (XIMProc)XIMPreEditDoneCallback;
     P_DrawCB.client_data = NULL;
-    P_DrawCB.callback = (XIMProc)XIMPreEditDrawCallback;
     P_CaretCB.client_data = NULL;
+#ifdef HAVE_XICCALLBACK_CALLBACK
+    P_StartCB.callback = (XICProc)XIMPreEditStartCallback;
+    P_DoneCB.callback = (XICProc)XIMPreEditDoneCallback;
+    P_DrawCB.callback = (XICProc)XIMPreEditDrawCallback;
+    P_CaretCB.callback = (XICProc)XIMPreEditCaretCallback;
+#else
+    P_StartCB.callback = (XIMProc)XIMPreEditStartCallback;
+    P_DoneCB.callback = (XIMProc)XIMPreEditDoneCallback;
+    P_DrawCB.callback = (XIMProc)XIMPreEditDrawCallback;
     P_CaretCB.callback = (XIMProc)XIMPreEditCaretCallback;
+#endif
 
     if ((ximStyle & (XIMPreeditNothing | XIMPreeditNone)) == 0)
     {
diff --git a/include/config.h.in b/include/config.h.in
index ac464db..f867662 100644
--- a/include/config.h.in
+++ b/include/config.h.in
@@ -945,6 +945,9 @@
 /* Define to 1 if you have the <X11/Xutil.h> header file. */
 #undef HAVE_X11_XUTIL_H
 
+/* Define to 1 if `callback' is member of `XICCallback'. */
+#undef HAVE_XICCALLBACK_CALLBACK
+
 /* Define if you have the XKB extension */
 #undef HAVE_XKB
 


From kai.blin at gmail.com  Mon Apr 14 16:04:52 2008
From: kai.blin at gmail.com (Kai Blin)
Date: Mon, 14 Apr 2008 23:04:52 +0200
Subject: ws2_32: Work around the host name resolving to 127.x.x.x when
	using that for binding.
In-Reply-To: <Pine.LNX.4.64.0804141934580.24510@dragoshel>
References: <200804141605.23704.kai.blin@gmail.com>
	<20080414162932.GX5348@byleth.sc-networks.de>
	<Pine.LNX.4.64.0804141934580.24510@dragoshel>
Message-ID: <200804142304.58241.kai.blin@gmail.com>

On Monday 14 April 2008 18:42:26 Paul Chitescu wrote:

> Binding to a specific address is the only easy way of detecting which
> interface an UDP packet was received on since recvfrom() only gives source
> address, not destination. Listening on 0.0.0.0 would make impossible to
> tell which interface a packet was received on. Furthermore, a program that
> explicitely tries to bind to each interface would fail all but the first
> bind and possibly bail out. Probably many games that use UDP would break.

I'm currently trying to fix apps that fail doing the following (which seems to 
be a popular way among game developers), in pseudo-code. 

hostname = gethostname();
hostent = gethostbyname(hostname);
sockaddr->sin_addr = hostent->addr;
sock = socket();
bind(sock, sockaddr);

Which, as Christoph noted, cause windows apps to bind to loopback addresses, 
breaking the networking. This only started to happen recently as recently 
Linux distros started mapping the machine's hostname to a loopback address. I 
don't think Wine ever used the registry for anything like that.

Cheers,
Kai

-- 
Kai Blin
WorldForge developer  http://www.worldforge.org/
Wine developer        http://wiki.winehq.org/KaiBlin
Samba team member     http://www.samba.org/samba/team/
--
Will code for cotton.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080414/f44e06c8/attachment.pgp 

From Stefan.Leichter at camline.com  Mon Apr 14 16:11:01 2008
From: Stefan.Leichter at camline.com (Stefan Leichter)
Date: Mon, 14 Apr 2008 23:11:01 +0200
Subject: winex11: Standardize a stub trace and add a trailing '\n'.
In-Reply-To: <alpine.DEB.1.10.0804140101131.12478@amboise.dolphin>
References: <alpine.DEB.1.10.0804140101131.12478@amboise.dolphin>
Message-ID: <200804142311.01886.Stefan.Leichter@camline.com>

Am Monday 14 April 2008 01:01 schrieb Francois Gouget:
> ---
> +    FIXME("(%p, %x): stub\n");

You forgot the parameters hIMC and fFlag

Bye Stefan


From julliard at winehq.org  Mon Apr 14 16:11:46 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 14 Apr 2008 23:11:46 +0200
Subject: error: `XICCallback' undeclared (Solaris build problem)
In-Reply-To: <200804142103535878180006MA82@nm06mta.auone-net.jp> (Kusanagi
	Kouichi's message of "Tue, 15 Apr 2008 06:03:53 +0900")
References: <4803596E.1030800@sun.com>
	<200804141726096658890006MAA5@nm06mta.auone-net.jp>
	<4803962C.8060801@codeweavers.com>
	<200804142103535878180006MA82@nm06mta.auone-net.jp>
Message-ID: <87d4os5egd.fsf@wine.dyndns.org>

Kusanagi Kouichi <slash at ma.neweb.ne.jp> writes:

> On Mon, Apr 14, 2008 at 06:36:44PM +0100, Robert Shearman wrote:
>> 
>> I think a configure check may be a more appropriate fix.
>> 
>
> I don't know proper way to check whether XICCallback is defined.
> But this seems to work.

Is it just the type that is not defined, or is the callback feature
itself not supported?

-- 
Alexandre Julliard
julliard at winehq.org


From slash at ma.neweb.ne.jp  Mon Apr 14 18:09:02 2008
From: slash at ma.neweb.ne.jp (Kusanagi Kouichi)
Date: Tue, 15 Apr 2008 08:09:02 +0900
Subject: error: `XICCallback' undeclared (Solaris build problem)
In-Reply-To: <87d4os5egd.fsf@wine.dyndns.org>
References: <4803596E.1030800@sun.com>
	<200804141726096658890006MAA5@nm06mta.auone-net.jp>
	<4803962C.8060801@codeweavers.com>
	<200804142103535878180006MA82@nm06mta.auone-net.jp>
	<87d4os5egd.fsf@wine.dyndns.org>
Message-ID: <200804142309031987210006MAC3@nm06mta.auone-net.jp>

On Mon, Apr 14, 2008 at 11:11:46PM +0200, Alexandre Julliard wrote:
> Kusanagi Kouichi <slash at ma.neweb.ne.jp> writes:
> 
> > On Mon, Apr 14, 2008 at 06:36:44PM +0100, Robert Shearman wrote:
> >> 
> >> I think a configure check may be a more appropriate fix.
> >> 
> >
> > I don't know proper way to check whether XICCallback is defined.
> > But this seems to work.
> 
> Is it just the type that is not defined, or is the callback feature
> itself not supported?

Solaris ought to support callback. Thus existence of XICCallback will be
irrelevant to callback functionality.


From juan.lang at gmail.com  Mon Apr 14 18:58:13 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Mon, 14 Apr 2008 16:58:13 -0700
Subject: Apparently it is possible to have chm file without #STRINGS in it,
	so we should not stop processing file at it. Fixes bug #12498
Message-ID: <3a768c550804141658x6051f8a3raadc85603cedc023@mail.gmail.com>

Hi Tomasz,

-        info->WinType.pszToc = strdupW(info->pCHMInfo->defToc);
+        info->WinType.pszToc = strdupW(info->pCHMInfo->defToc ?
info->pCHMInfo->defToc : null);

Please don't use null, it's not portable.  Also, what has this change
accomplished?  If strdupW succeeds when passed NULL, the existing line
would already have done the same thing, so you've added a test for no
benefit.
--Juan


From ivg231 at gmail.com  Mon Apr 14 00:08:30 2008
From: ivg231 at gmail.com (Ivan Gyurdiev)
Date: Mon, 14 Apr 2008 01:08:30 -0400
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <200804132126.19422.stefan@codeweavers.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804111618.49900.stefan@codeweavers.com>
	<48001DF5.3050401@gmail.com>
	<200804132126.19422.stefan@codeweavers.com>
Message-ID: <4802E6CE.9070001@gmail.com>


> What are your opinions?
I can't comment on the specifics of the state table design - would have 
to leave that to Henri. However, anything that increases modularity is a 
good thing. I'm in favor of the overall direction to break up the 
pipeline into component stages.  Smaller components are more easy to 
manage - specifically in your case this should allow separate backends 
to be chosen per pipeline stage.

It seems reasonable that these changes would be deferred until after 1.0.

Ivan


From wine-devel at kievinfo.com  Mon Apr 14 21:03:02 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Mon, 14 Apr 2008 20:03:02 -0600
Subject: dinput: Convert keyboard buffer from internal data format to
	user data format
In-Reply-To: <4803AA89.3070806@gmail.com>
References: <4802384D.1090704@gmail.com> <48024BE1.1090008@kievinfo.com>
	<4803AA89.3070806@gmail.com>
Message-ID: <48040CD6.2030105@kievinfo.com>

Sergey Khodych wrote:
>> Any particular reason for this? Do you have a program that sets different 
>> data format? The reason I ask - copying 256 bytes is much faster then 
>> iterating over the whole data format and copying one byte at a time.
>>
> A possibility of using custom data format, for any type of devices, is
> described in DirectX SDK documentation.
> For example Monolith's  F.E.A.R. use this method.

That is not what I asked. If you read MSDN it tells lots of things that are 
not true. Also I do not recall seeing any problems with FEAR game that were 
related dinput. If you have that bug handle please point me to it.

Vitaliy.


From wine-devel at kievinfo.com  Mon Apr 14 21:06:30 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Mon, 14 Apr 2008 20:06:30 -0600
Subject: dinput: Implement DIPROP_KEYNAME property for keyboard device
In-Reply-To: <4803AB6A.3040900@gmail.com>
References: <48023854.9020308@gmail.com> <48024DC2.3020008@kievinfo.com>
	<4803AB6A.3040900@gmail.com>
Message-ID: <48040DA6.6090708@kievinfo.com>

Sergey Khodych wrote:
>>> ...
>>> +                hr = SysKeyboardWImpl_GetObjectInfo( (LPDIRECTINPUTDEVICE8W)iface , &didoi,
>>> +                                                     ps->diph.dwObj, ps->diph.dwHow );
>> You mixing unicode and ascii. Also if you are implementing 
>> SysKeyboardAImpl_GetProperty you should also implement it's unicode 
>> counterpart SysKeyboardWImpl_GetProperty.
> Realization of GetProperty for keyboard device for unicode and ascii do
> not differ at this time.
> 

In ascii function you are calling unicode function and copying it's output 
(unicode string) to the ascii string buffer. This is wrong. Also because 
these functions deal with strings you have to implement both ascii and 
unicode functions at the same time. You can't forward one to the other.

Vitaliy.



From wine-devel at kievinfo.com  Mon Apr 14 21:11:41 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Mon, 14 Apr 2008 20:11:41 -0600
Subject: Feature Request: Registry / winecfg entry for launching
	an	application in a wineexplorer window
In-Reply-To: <b6bb06270804141004nd99e48are3158647a4482bc2@mail.gmail.com>
References: <4803182C.9070209@open-vote.org>	<200804140534.33333.chris.kcat@gmail.com>
	<b6bb06270804141004nd99e48are3158647a4482bc2@mail.gmail.com>
Message-ID: <48040EDD.7010708@kievinfo.com>

Austin English wrote:
> On Mon, Apr 14, 2008 at 7:34 AM, Chris Robinson <chris.kcat at gmail.com> wrote:
>>  IIRC, the problem is you can't have two Wine processes using two different
>>  desktops. Try this: start an app without virtual desktop and leave it
>>  running, run winecfg and turn on virtual desktop (make sure to click Apply),
>>  then try to start another app. It won't use a virtual desktop.
>>
>>
> 
> Terminal one:
> $ rm -rf ~/.wine
> $ wine notepad
> 
> Terminal two:
> $ winecfg # enable virtual desktop
> $ winemine # doesn't go in virtual desktop
> $ wine explorer /desktop=name,1024x768 winemine # goes in virtual desktop
> 
That's by design when you change configuration via winecfg it applies to 
"default" desktop only. And if it's already active (desktop for your 
notepad) it won't just become virtual desktop. When you using "name" that 
creates separate desktop with that name and requested parameters.

Vitaliy


From frick at sc-networks.de  Tue Apr 15 02:45:43 2008
From: frick at sc-networks.de (Christoph Frick)
Date: Tue, 15 Apr 2008 09:45:43 +0200
Subject: ws2_32: Work around the host name resolving to 127.x.x.x when
	using that for binding.
In-Reply-To: <200804142304.58241.kai.blin@gmail.com>
References: <200804141605.23704.kai.blin@gmail.com>
	<20080414162932.GX5348@byleth.sc-networks.de>
	<Pine.LNX.4.64.0804141934580.24510@dragoshel>
	<200804142304.58241.kai.blin@gmail.com>
Message-ID: <20080415074543.GY5348@byleth.sc-networks.de>

On Mon, Apr 14, 2008 at 11:04:52PM +0200, Kai Blin wrote:

> > Binding to a specific address is the only easy way of detecting
> > which interface an UDP packet was received on since recvfrom() only
> > gives source address, not destination. Listening on 0.0.0.0 would
> > make impossible to tell which interface a packet was received on.
> > Furthermore, a program that explicitely tries to bind to each
> > interface would fail all but the first bind and possibly bail out.
> > Probably many games that use UDP would break.

does then windows actually handle also the other way around? like i
listen on 127.0.0.1:12345 in windows and i will not be able to connect
to 192.168.1.1:12345 on the same machine? i know it is "supported" - but
i have the nagging doubt, that it will not work the same way as in unix
but wine maps this behaviour as as unix would do it the same way.
IANAE...

> Which, as Christoph noted, cause windows apps to bind to loopback
> addresses, breaking the networking. This only started to happen
> recently as recently Linux distros started mapping the machine's
> hostname to a loopback address. I don't think Wine ever used the
> registry for anything like that.

not wine in its guts - the apps. wine now uses the /etc/hosts to
determine the ip of the machine and put this informations in the places,
where windows keeps them. one of this places was the registry
(.../nettrans/tcpip/... or something). some apps use this informations.
maybe 

-- 
cu
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 163 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080415/7bdb9694/attachment.pgp 

From Petr.Sumbera at Sun.COM  Tue Apr 15 03:19:18 2008
From: Petr.Sumbera at Sun.COM (Petr Sumbera)
Date: Tue, 15 Apr 2008 10:19:18 +0200
Subject: error: `XICCallback' undeclared (Solaris build problem)
In-Reply-To: <200804141726096658890006MAA5@nm06mta.auone-net.jp>
References: <4803596E.1030800@sun.com>
	<200804141726096658890006MAA5@nm06mta.auone-net.jp>
Message-ID: <48046506.8010007@sun.com>

I can confirm that this works (I mean it compiles).

Thanks,

Petr

Kusanagi Kouichi wrote:
> Does this patch fix the problem?
> 
> diff --git a/dlls/winex11.drv/xim.c b/dlls/winex11.drv/xim.c
> index d4df9f7..b66cf87 100644
> --- a/dlls/winex11.drv/xim.c
> +++ b/dlls/winex11.drv/xim.c
> @@ -501,7 +501,7 @@ XIC X11DRV_CreateIC(XIM xim, struct x11drv_win_data *data)
>      XVaNestedList preedit = NULL;
>      XVaNestedList status = NULL;
>      XIC xic;
> -    XICCallback destroy = {(XPointer)data, X11DRV_DestroyIC};
> +    XIMCallback destroy = {(XPointer)data, (XIMProc)X11DRV_DestroyIC};
>      XIMCallback P_StartCB;
>      XIMCallback P_DoneCB;
>      XIMCallback P_DrawCB;



From dmitry at codeweavers.com  Tue Apr 15 03:52:03 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Tue, 15 Apr 2008 17:52:03 +0900
Subject: [WineHQ][WWN] WWN 345
References: <20080415034454.D66A4166CF23@bluesata.com>
Message-ID: <001c01c89ed5$fbf92150$a600fea9@DMITRY>

"Zachary Goldberg" <zgs at seas.upenn.edu> wrote:

> +<section
> + title="News: new WineTricks, 1.0 status updates and more"
> + subject="Wine"
> + archive="http://www.xkcd.com"
> + posts="0"
> +>

How is the url above related to the title?

-- 
Dmitry.


From Petr.Sumbera at Sun.COM  Tue Apr 15 04:13:08 2008
From: Petr.Sumbera at Sun.COM (Petr Sumbera)
Date: Tue, 15 Apr 2008 11:13:08 +0200
Subject: error: `XICCallback' undeclared (Solaris build problem)
In-Reply-To: <200804142103535878180006MA82@nm06mta.auone-net.jp>
References: <4803596E.1030800@sun.com>
	<200804141726096658890006MAA5@nm06mta.auone-net.jp>
	<4803962C.8060801@codeweavers.com>
	<200804142103535878180006MA82@nm06mta.auone-net.jp>
Message-ID: <480471A4.3090902@sun.com>

This works properly on Solaris. Please submit patch if everybody is 
happy with it.

Thanks,

Petr

Kusanagi Kouichi wrote:
> On Mon, Apr 14, 2008 at 06:36:44PM +0100, Robert Shearman wrote:
>> I think a configure check may be a more appropriate fix.
>>
> 
> I don't know proper way to check whether XICCallback is defined.
> But this seems to work.
> 
> diff --git a/configure b/configure
> index b66a40a..01fdf19 100755
> --- a/configure
> +++ b/configure
> @@ -10686,6 +10686,115 @@ esac
>  fi
>  
>  
> +                { echo "$as_me:$LINENO: checking for XICCallback.callback" >&5
> +echo $ECHO_N "checking for XICCallback.callback... $ECHO_C" >&6; }
> +if test "${ac_cv_member_XICCallback_callback+set}" = set; then
> +  echo $ECHO_N "(cached) $ECHO_C" >&6
> +else
> +  cat >conftest.$ac_ext <<_ACEOF
> +/* confdefs.h.  */
> +_ACEOF
> +cat confdefs.h >>conftest.$ac_ext
> +cat >>conftest.$ac_ext <<_ACEOF
> +/* end confdefs.h.  */
> +#ifdef HAVE_X11_XLIB_H
> +#include <X11/Xlib.h>
> +#endif
> +
> +int
> +main ()
> +{
> +static XICCallback ac_aggr;
> +if (ac_aggr.callback)
> +return 0;
> +  ;
> +  return 0;
> +}
> +_ACEOF
> +rm -f conftest.$ac_objext
> +if { (ac_try="$ac_compile"
> +case "(($ac_try" in
> +  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
> +  *) ac_try_echo=$ac_try;;
> +esac
> +eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
> +  (eval "$ac_compile") 2>conftest.er1
> +  ac_status=$?
> +  grep -v '^ *+' conftest.er1 >conftest.err
> +  rm -f conftest.er1
> +  cat conftest.err >&5
> +  echo "$as_me:$LINENO: \$? = $ac_status" >&5
> +  (exit $ac_status); } && {
> +	 test -z "$ac_c_werror_flag" ||
> +	 test ! -s conftest.err
> +       } && test -s conftest.$ac_objext; then
> +  ac_cv_member_XICCallback_callback=yes
> +else
> +  echo "$as_me: failed program was:" >&5
> +sed 's/^/| /' conftest.$ac_ext >&5
> +
> +	cat >conftest.$ac_ext <<_ACEOF
> +/* confdefs.h.  */
> +_ACEOF
> +cat confdefs.h >>conftest.$ac_ext
> +cat >>conftest.$ac_ext <<_ACEOF
> +/* end confdefs.h.  */
> +#ifdef HAVE_X11_XLIB_H
> +#include <X11/Xlib.h>
> +#endif
> +
> +int
> +main ()
> +{
> +static XICCallback ac_aggr;
> +if (sizeof ac_aggr.callback)
> +return 0;
> +  ;
> +  return 0;
> +}
> +_ACEOF
> +rm -f conftest.$ac_objext
> +if { (ac_try="$ac_compile"
> +case "(($ac_try" in
> +  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
> +  *) ac_try_echo=$ac_try;;
> +esac
> +eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
> +  (eval "$ac_compile") 2>conftest.er1
> +  ac_status=$?
> +  grep -v '^ *+' conftest.er1 >conftest.err
> +  rm -f conftest.er1
> +  cat conftest.err >&5
> +  echo "$as_me:$LINENO: \$? = $ac_status" >&5
> +  (exit $ac_status); } && {
> +	 test -z "$ac_c_werror_flag" ||
> +	 test ! -s conftest.err
> +       } && test -s conftest.$ac_objext; then
> +  ac_cv_member_XICCallback_callback=yes
> +else
> +  echo "$as_me: failed program was:" >&5
> +sed 's/^/| /' conftest.$ac_ext >&5
> +
> +	ac_cv_member_XICCallback_callback=no
> +fi
> +
> +rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
> +fi
> +
> +rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
> +fi
> +{ echo "$as_me:$LINENO: result: $ac_cv_member_XICCallback_callback" >&5
> +echo "${ECHO_T}$ac_cv_member_XICCallback_callback" >&6; }
> +if test $ac_cv_member_XICCallback_callback = yes; then
> +
> +cat >>confdefs.h <<_ACEOF
> +#define HAVE_XICCALLBACK_CALLBACK 1
> +_ACEOF
> +
> +
> +fi
> +
> +
>  
>          opengl_msg=""
>      if test "x$with_opengl" != "xno"
> diff --git a/configure.ac b/configure.ac
> index e9dadee..b5c4bf2 100644
> --- a/configure.ac
> +++ b/configure.ac
> @@ -698,6 +698,12 @@ then
>          WINE_NOTICE_WITH(xcomposite,[test "x$ac_cv_lib_soname_Xcomposite" = "x"],
>                           [libxcomposite development files not found, Xcomposite won't be supported.])
>  
> +        dnl *** Check for XICCallback struct
> +        AC_CHECK_MEMBERS([XICCallback.callback],,,
> +[#ifdef HAVE_X11_XLIB_H
> +#include <X11/Xlib.h>
> +#endif])
> +
>      dnl *** End of X11/Xlib.h check
>  
>      dnl Check for the presence of OpenGL
> diff --git a/dlls/winex11.drv/xim.c b/dlls/winex11.drv/xim.c
> index d4df9f7..85d37e8 100644
> --- a/dlls/winex11.drv/xim.c
> +++ b/dlls/winex11.drv/xim.c
> @@ -501,11 +501,13 @@ XIC X11DRV_CreateIC(XIM xim, struct x11drv_win_data *data)
>      XVaNestedList preedit = NULL;
>      XVaNestedList status = NULL;
>      XIC xic;
> -    XICCallback destroy = {(XPointer)data, X11DRV_DestroyIC};
> -    XIMCallback P_StartCB;
> -    XIMCallback P_DoneCB;
> -    XIMCallback P_DrawCB;
> -    XIMCallback P_CaretCB;
> +#ifdef HAVE_XICCALLBACK_CALLBACK
> +    XICCallback destroy = {(XPointer)data, (XICProc)X11DRV_DestroyIC};
> +    XICCallback P_StartCB, P_DoneCB, P_DrawCB, P_CaretCB;
> +#else
> +    XIMCallback destroy = {(XPointer)data, (XIMProc)X11DRV_DestroyIC};
> +    XIMCallback P_StartCB, P_DoneCB, P_DrawCB, P_CaretCB;
> +#endif
>      LANGID langid = PRIMARYLANGID(LANGIDFROMLCID(GetThreadLocale()));
>      Window win = data->whole_window;
>  
> @@ -531,13 +533,20 @@ XIC X11DRV_CreateIC(XIM xim, struct x11drv_win_data *data)
>  
>      /* create callbacks */
>      P_StartCB.client_data = NULL;
> -    P_StartCB.callback = (XIMProc)XIMPreEditStartCallback;
>      P_DoneCB.client_data = NULL;
> -    P_DoneCB.callback = (XIMProc)XIMPreEditDoneCallback;
>      P_DrawCB.client_data = NULL;
> -    P_DrawCB.callback = (XIMProc)XIMPreEditDrawCallback;
>      P_CaretCB.client_data = NULL;
> +#ifdef HAVE_XICCALLBACK_CALLBACK
> +    P_StartCB.callback = (XICProc)XIMPreEditStartCallback;
> +    P_DoneCB.callback = (XICProc)XIMPreEditDoneCallback;
> +    P_DrawCB.callback = (XICProc)XIMPreEditDrawCallback;
> +    P_CaretCB.callback = (XICProc)XIMPreEditCaretCallback;
> +#else
> +    P_StartCB.callback = (XIMProc)XIMPreEditStartCallback;
> +    P_DoneCB.callback = (XIMProc)XIMPreEditDoneCallback;
> +    P_DrawCB.callback = (XIMProc)XIMPreEditDrawCallback;
>      P_CaretCB.callback = (XIMProc)XIMPreEditCaretCallback;
> +#endif
>  
>      if ((ximStyle & (XIMPreeditNothing | XIMPreeditNone)) == 0)
>      {
> diff --git a/include/config.h.in b/include/config.h.in
> index ac464db..f867662 100644
> --- a/include/config.h.in
> +++ b/include/config.h.in
> @@ -945,6 +945,9 @@
>  /* Define to 1 if you have the <X11/Xutil.h> header file. */
>  #undef HAVE_X11_XUTIL_H
>  
> +/* Define to 1 if `callback' is member of `XICCallback'. */
> +#undef HAVE_XICCALLBACK_CALLBACK
> +
>  /* Define if you have the XKB extension */
>  #undef HAVE_XKB
>  



From julliard at winehq.org  Tue Apr 15 05:29:02 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Tue, 15 Apr 2008 12:29:02 +0200
Subject: start.exe: updated French translation
In-Reply-To: <1208208634.6722.32.camel@jernst-laptop> (Jonathan Ernst's
	message of "Mon, 14 Apr 2008 23:30:34 +0200")
References: <1208208634.6722.32.camel@jernst-laptop>
Message-ID: <873apno1ht.fsf@wine.dyndns.org>

Jonathan Ernst <jonathan at ernstfamily.ch> writes:

> @@ -24,41 +24,42 @@ LANGUAGE LANG_FRENCH, SUBLANG_NEUTRAL
>  
>  STRINGTABLE DISCARDABLE
>  {
> -STRING_USAGE,                                   "Lance un programme, ou ouvre un document dans le programme normalement utilis? avec cette extension. \n\
> +STRING_USAGE,                                   "Lance un programme, ou ouvre un document dans le programme normalement utilis?? avec cette extension. \n\

If you are converting the file to utf-8 you also have to add the
appropriate pragmas.

-- 
Alexandre Julliard
julliard at winehq.org


From kornelpal at gmail.com  Tue Apr 15 05:53:04 2008
From: kornelpal at gmail.com (=?iso-8859-1?B?S29ybulsIFDhbA==?=)
Date: Tue, 15 Apr 2008 12:53:04 +0200
Subject: Including Mono within a Wine package - should Wine expect this?
References: <666369.76248.qm@web23115.mail.ird.yahoo.com>
Message-ID: <007c01c89ee6$e2be05f0$387326c3@kornelpal.hu>

Hi,

> From: "Hin-Tak Leung" <htl10 at users.sourceforge.net>
> I can't comment on anything else, but after trying to get a .NET WinForms 
> application
> (mentioned in some of the bugs I filed) for a few months under the 3 
> options of
> native linux mono, wine+.NET and wine+mono, I can say that win32 mono uses 
> P/Invoke
> *differently* from how .NET2 does it, and the missing APIs required to get 
> an
> application to work with the wine + win32 mono and wine +MS.NET combo is 
> different.
> So some part of the applications runs better with wine + win32 mono and 
> some better
> with wine + MS.NET ... win32 mono and MS.NET just seems to have different 
> native code dependencies.

The only major difference I know is that Mono uses UTF-8 instead of ACP for 
ANSI functions. If you know some serious issues please feel free to file bug 
report(s) at Mono's Bugzilla.

> From: "Dan Kegel" <dank at kegel.com>
>>  http://lists.ximian.com/pipermail/mono-devel-list/2008-April/027491.html
>
> That's interesting info, thanks.
>
> At the moment you seem to be taking the lead on these issues.
> Please let us know how it goes.

I have made some progess and now I am able to call unmanaged methods from 
managed methods and also implemented some mscoree.dll hacks that make 
possible to use the NT loader (LoadLibrary). Unfortunately the loader uses 
mscoree.dll located in system32 anyway so I had to modify it's export 
address table in memory. And I also had to implement base relocation and 
import adress table processing for EXE modules because that is not done by 
NT. Processes could only be created from managed EXE files with some more 
intrusive mscoree.dll hacks (mscoree.dll file or registy modifications).

Korn?l 



From dmitry at codeweavers.com  Tue Apr 15 06:07:38 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Tue, 15 Apr 2008 20:07:38 +0900
Subject: Including Mono within a Wine package - should Wine expect this?
References: <666369.76248.qm@web23115.mail.ird.yahoo.com>
	<007c01c89ee6$e2be05f0$387326c3@kornelpal.hu>
Message-ID: <013701c89ee8$ecc90f20$a600fea9@DMITRY>

"Korn?l P?l" <kornelpal at gmail.com> wrote:

> The only major difference I know is that Mono uses UTF-8 instead of ACP for
> ANSI functions.

UTF-8 will break most of Windows applications since they don't expect to see
strings in a multibyte encoding.

-- 
Dmitry.



From paulc at voip.null.ro  Tue Apr 15 06:11:46 2008
From: paulc at voip.null.ro (Paul Chitescu)
Date: Tue, 15 Apr 2008 14:11:46 +0300 (EEST)
Subject: ws2_32: Work around the host name resolving to 127.x.x.x when
	using that for binding.
In-Reply-To: <200804142304.58241.kai.blin@gmail.com>
References: <200804141605.23704.kai.blin@gmail.com>
	<20080414162932.GX5348@byleth.sc-networks.de>
	<Pine.LNX.4.64.0804141934580.24510@dragoshel>
	<200804142304.58241.kai.blin@gmail.com>
Message-ID: <Pine.LNX.4.64.0804151402290.15822@dragoshel>

On Mon, 14 Apr 2008, Kai Blin wrote:
> On Monday 14 April 2008 18:42:26 Paul Chitescu wrote:
>
>> Binding to a specific address is the only easy way of detecting which
>> interface an UDP packet was received on since recvfrom() only gives source
>> address, not destination. Listening on 0.0.0.0 would make impossible to
>> tell which interface a packet was received on. Furthermore, a program that
>> explicitely tries to bind to each interface would fail all but the first
>> bind and possibly bail out. Probably many games that use UDP would break.
>
> I'm currently trying to fix apps that fail doing the following (which seems to
> be a popular way among game developers), in pseudo-code.
>
> hostname = gethostname();
> hostent = gethostbyname(hostname);
> sockaddr->sin_addr = hostent->addr;
> sock = socket();
> bind(sock, sockaddr);
>
> Which, as Christoph noted, cause windows apps to bind to loopback addresses,
> breaking the networking. This only started to happen recently as recently
> Linux distros started mapping the machine's hostname to a loopback address. I
> don't think Wine ever used the registry for anything like that.
>
> Cheers,
> Kai
>
> -- 
> Kai Blin
> WorldForge developer  http://www.worldforge.org/
> Wine developer        http://wiki.winehq.org/KaiBlin
> Samba team member     http://www.samba.org/samba/team/
> --
> Will code for cotton.


Hi, Kai!

Your patch seems quite safe to me as it checks lots of stuff. I disagreed 
to Christoph Frick's proposal of always binding to 0.0.0.0

As a security enhancement, what about randomly initializing the last 3 
octets of magic_loopback_addr at every run instance? This could help fend 
off potential attacks targeted at buggy applications running in Wine by 
sending this special address over some other protocol. A remote attacker 
can convince a local application to listen on all interfaces including 
Internet attached ones while thinking it (safely) listens only on 
loopback.

Regards,

Paul Chitescu


From kornelpal at gmail.com  Tue Apr 15 06:22:10 2008
From: kornelpal at gmail.com (=?iso-8859-1?B?S29ybulsIFDhbA==?=)
Date: Tue, 15 Apr 2008 13:22:10 +0200
Subject: Including Mono within a Wine package - should Wine expect this?
References: <666369.76248.qm@web23115.mail.ird.yahoo.com>
	<007c01c89ee6$e2be05f0$387326c3@kornelpal.hu>
	<013701c89ee8$ecc90f20$a600fea9@DMITRY>
Message-ID: <000c01c89eea$f3406a40$387326c3@kornelpal.hu>

>> The only major difference I know is that Mono uses UTF-8 instead of ACP 
>> for
>> ANSI functions.
>
> UTF-8 will break most of Windows applications since they don't expect to 
> see
> strings in a multibyte encoding.

I know that. And the problem is that there is a mess of ACP and UTF-8 inside 
native code of Mono. I tried to change things several times but none of them 
were accepted.

Korn?l 



From ovek at arcticnet.no  Tue Apr 15 06:29:22 2008
From: ovek at arcticnet.no (Ove Kaaven)
Date: Tue, 15 Apr 2008 13:29:22 +0200
Subject: Including Mono within a Wine package - should Wine expect this?
In-Reply-To: <47FECF9E.1030309@open-vote.org>
References: <a71bd89a0804100645y2b7f9c94n719ab5f19374db04@mail.gmail.com>
	<47FECF9E.1030309@open-vote.org>
Message-ID: <48049192.4090906@arcticnet.no>

Scott Ritchie skrev:
> Agreed.  The one tricky thing here is making a proper "source" package.
>  There is some precedent for source packages that don't actually build
> on the architecture they're for.  The ia32-libs package, for instance,
> contains both binary and source versions of the 32 bit libraries since
> it's solely for 64 bit arches, however to build those binaries requires
> use of a 32 bit system.
> 
> Similarly, we can ship a wine-gecko "source" package which includes
> binary and source, with the readme detailing how to actually build the
> binary from the source (ie, use Windows).  Meanwhile the source package
> "builds" by just copying the binary into the right place (much like how
> ia32-libs builds).

Debian would not accept this into main. Perhaps into contrib, maybe. For 
example, DFSG-free Java programs that must be compiled with a non-free 
Java compiler (because the free compilers aren't good enough) goes into 
contrib, not main (though even here, it should be possible to 
auto-rebuild the package).

Debian's ia32-libs package isn't an example of a whole lot. It grabs 
compiled binaries from the official Debian archive, and nowhere else. It 
isn't built on a 32-bit system. If ia32-libs had contained binaries that 
could not be built 100% automatically using Debian's official archive 
(and only the official archive), it probably wouldn't have gotten into 
Debian. Besides, ia32-libs is not meant to be a long-lived package, 
it'll go away eventually.




From msclrhd at googlemail.com  Tue Apr 15 03:03:03 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Tue, 15 Apr 2008 09:03:03 +0100
Subject: [1/2] shlwapi: Fixed the todo blocks in the SHCreateStreamOnFile
	tests. [try 2]
In-Reply-To: <87wsn05kio.fsf@wine.dyndns.org>
References: <3f4fd2640804130613q1c93aea4wa57f609446beadca@mail.gmail.com>
	<87wsn05kio.fsf@wine.dyndns.org>
Message-ID: <3f4fd2640804150103v735792cat246c2511ae855ecd@mail.gmail.com>

On 14/04/2008, Alexandre Julliard <julliard at winehq.org> wrote:
> "Reece Dunn" <msclrhd at googlemail.com> writes:
>
>  > @@ -120,12 +119,12 @@ static HRESULT WINAPI IStream_fnRead(IStream *iface, void* pv, ULONG cb, ULONG*
>  >    TRACE("(%p,%p,0x%08x,%p)\n", This, pv, cb, pcbRead);
>  >
>  >    if (!pv)
>  > -    return STG_E_INVALIDPOINTER;
>  > +    return S_OK;
>
>  It's very unlikely that this is the correct behavior in all cases.

That is what the tests appear to be implying. Unless they are
returning S_OK if there is no content to be read, but that wouldn't
make any sense, unless the parameter is passed directly to ReadFile
without any checking and that is how ReadFile behaves.

In that case, I'll leave this as a todo_wine block for the time being
until there is a more complete set of tests for the read method.

>  > @@ -459,7 +458,9 @@ HRESULT WINAPI SHCreateStreamOnFileEx(LPCWSTR lpszPath, DWORD dwMode,
>  >    switch(STGM_CREATE_MODE(dwMode))
>  >    {
>  >    case STGM_FAILIFTHERE:
>  > -    dwCreate = OPEN_EXISTING;
>  > +    if (bCreate && PathFileExistsW(lpszPath))
>  > +      return HRESULT_FROM_WIN32(ERROR_FILE_EXISTS);
>  > +    dwCreate = bCreate ? CREATE_ALWAYS : OPEN_EXISTING;
>
>  That case should be handled by CreateFile, you shouldn't check for the
>  file existence explicitly.

The MSDN documentation for CreateFile
(http://msdn2.microsoft.com/en-us/library/aa363858.aspx) suggests that
CREATE_NEW has the desired behaviour. However, the Wine implementation
is not handling this correctly. Therefore, I'll improve the CreateFile
tests to test the CREATE_NEW behaviour.

I will also resubmit this patch with those tests marked as todo_wine.

- Reece


From msclrhd at googlemail.com  Tue Apr 15 03:27:27 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Tue, 15 Apr 2008 09:27:27 +0100
Subject: [1/2] shlwapi: Fixed the todo blocks in the SHCreateStreamOnFile
	tests. [try 2]
In-Reply-To: <3f4fd2640804150103v735792cat246c2511ae855ecd@mail.gmail.com>
References: <3f4fd2640804130613q1c93aea4wa57f609446beadca@mail.gmail.com>
	<87wsn05kio.fsf@wine.dyndns.org>
	<3f4fd2640804150103v735792cat246c2511ae855ecd@mail.gmail.com>
Message-ID: <3f4fd2640804150127lcc87fb6n5c673e8f4c066fe6@mail.gmail.com>

On 15/04/2008, Reece Dunn <msclrhd at googlemail.com> wrote:
> On 14/04/2008, Alexandre Julliard <julliard at winehq.org> wrote:
>  > "Reece Dunn" <msclrhd at googlemail.com> writes:
>  >  > @@ -459,7 +458,9 @@ HRESULT WINAPI SHCreateStreamOnFileEx(LPCWSTR lpszPath, DWORD dwMode,
>  >  >    switch(STGM_CREATE_MODE(dwMode))
>  >  >    {
>  >  >    case STGM_FAILIFTHERE:
>  >  > -    dwCreate = OPEN_EXISTING;
>  >  > +    if (bCreate && PathFileExistsW(lpszPath))
>  >  > +      return HRESULT_FROM_WIN32(ERROR_FILE_EXISTS);
>  >  > +    dwCreate = bCreate ? CREATE_ALWAYS : OPEN_EXISTING;
>  >
>  >  That case should be handled by CreateFile, you shouldn't check for the
>  >  file existence explicitly.
>
> The MSDN documentation for CreateFile
>  (http://msdn2.microsoft.com/en-us/library/aa363858.aspx) suggests that
>  CREATE_NEW has the desired behaviour. However, the Wine implementation
>  is not handling this correctly. Therefore, I'll improve the CreateFile
>  tests to test the CREATE_NEW behaviour.

There were tests for the CREATE_NEW case in kernel32/tests/file.c,
verifying this behaviour. I tracked the problem down to a strange way
of converting a GetLastError status to a HRESULT. Fixing that got the
desired behaviour (see my new patch).

- Reece


From developers at tefnet.pl  Tue Apr 15 05:26:09 2008
From: developers at tefnet.pl (Tomasz Jezierski - Tefnet)
Date: Tue, 15 Apr 2008 12:26:09 +0200
Subject: [Fwd: Re: Apparently it is possible to have chm file without
	#STRINGS in it, so we should not stop processing file at it. Fixes bug
	#12498]
Message-ID: <1208255169.14006.1.camel@tefdemo>


ups.. forgot to CC:

-------- Przekazywana wiadomo?? ----------
Od: Tomasz Jezierski - Tefnet <developers at tefnet.pl>
Do: Juan Lang <juan.lang at gmail.com>
Temat: Re: Apparently it is possible to have chm file without #STRINGS
in it, so we should not stop processing file at it. Fixes bug #12498
Data: Tue, 15 Apr 2008 08:31:23 +0200

Dnia 14-04-2008, pon o godzinie 16:58 -0700, Juan Lang pisze:
> Hi Tomasz,
> 
> -        info->WinType.pszToc = strdupW(info->pCHMInfo->defToc);
> +        info->WinType.pszToc = strdupW(info->pCHMInfo->defToc ?
> info->pCHMInfo->defToc : null);
> 
Sorry, didn't know that... I saw that "small" null is used one line
under:
info->WinType.pszIndex = strdupW(null);
so I used it too.

Have you tried patch without this "if"? In my case it crashes without it
when I try to open chm from bug #12498... i don't know if strdupW can
dup NULL as well as null?





From aric at codeweavers.com  Tue Apr 15 07:24:57 2008
From: aric at codeweavers.com (Aric Stewart)
Date: Tue, 15 Apr 2008 07:24:57 -0500
Subject: IMM / IME work
Message-ID: <48049E99.7060205@codeweavers.com>

Hello all,

   I know this will only interest a small portion of you but thought i 
would give a quick update on the state of IMM32 since I have brought it 
to a major milestone.

   All the main patches are in which now separate IMM32 and IMEs. There 
is still more work to do but the major framework is in place. X11 XIM 
processing should be unchanged. However wine can now begin to  load 
native windows IMEs as well.

  I have tested with windows ATOK20 (a popular Japanese IME) and 
successfully had text processing in a fully IME aware application. There 
are still clear issues to resolve in many aspects of this processing but 
we have forward progress.

  ImmInstallIME does not work yet, nor does switching keyboards.  So to 
get the native IME to work you need to add this registry key.

[System\\CurrentControlSet\\Control\\Keyboard Layouts\\<keyboard layout>]
"Ime File"=<IME filename>

so for example for ATOK20 in Japanese i used.

[System\\CurrentControlSet\\Control\\Keyboard Layouts\\e0010411]
"Ime File"="ATOK20W.IME"

I would love to hear how well things work.  I am sure using native IMEs 
will quickly show us many places where IMM32 needs to be improved.

One issues I am going to investigate next is that sometimes non x11drv 
ime initialization, if occurring too early, causes x11drv to fail to 
create windows.  I have not investigated with the latest changes to 
xim.c  (which may already correct this problem) but if you see this 
problem this patch may help and i believe the 
IME_UpdateAssociation(NULL) is already unneeded.


diff --git a/dlls/winex11.drv/xim.c b/dlls/winex11.drv/xim.c
index d4df9f7..0c98136 100644
--- a/dlls/winex11.drv/xim.c
+++ b/dlls/winex11.drv/xim.c
@@ -475,7 +475,6 @@ static void X11DRV_OpenIM(Display *display, XPointer 
ptr, XP
      XUnregisterIMInstantiateCallback(display, NULL, NULL, NULL, 
X11DRV_OpenIM,
      wine_tsx11_unlock();
      IME_XIMPresent(TRUE);
-    IME_UpdateAssociation(NULL);
  }

thanks,
-aric


From vitperov at etersoft.ru  Tue Apr 15 07:54:45 2008
From: vitperov at etersoft.ru (Vitaly Perov)
Date: Tue, 15 Apr 2008 16:54:45 +0400
Subject: Bug with duplex printing
Message-ID: <200804151654.46205.vitperov@etersoft.ru>

Hi all,

I'm sorry. My English is not so good.

There is a bug. I have some idia how to solve it. I'm sure it's not good way 
to solve this problem.

The bug is the following:
You print one page with duplex printing, and the number of copies is 2.
The second page must be printed on the next page, but it is printed on the 
another side of this page.
This bug appears if an application is responsible for printing (almost always)
 
I have tried to print the following documents (duplex printing) into the file:
1) Document consists of 1 page, number of copies is 2;
2) Document consist of 2 pages, number of copies is 1;
Then I have compared theese documents with diff.
The documens differ only in some strings (date of creation)!

I have tried the same test in OpenOffice.
The results is the same!

I want to try this in Windows, but i can find a printer which can generate 
PostScript and supports Duplex mode.

The is several ways to solve it.
Application is responsible for printing. We print 2 copies and the number of 
pages is 1, 3, 5... etc. So after sending the first copy of document it 
must "tell" to the Windows/Wine, that new page must start from the new sheet 
of paper.
I think the are 2 ways:
1) The is special WINAPI function, that application call
2) The empty page after each copy of the document. It can be inserted by 
application or Windows/Wine.

I find out that there is no special WINAPI, so this bug can be solved only by 
inserting of empty page.

I have ascertained that the application a'm testing never asks whether printer 
support duplex. So I have decided, that Windows/Wine must insert empty page.

But the Windows/Wine can't get to know the number of pages, that application 
is going to print.

So I think, its only one way to add an empty page:
We must catch EndDoc, then scan the PostScript and count number of pages it is 
going to print. Then we devide number of pages over number of copies, and 
determine number of pages in one copy of the document. Then, if number of 
pages is 1, 3, 5 .. etc. we rescan the PostScript document, and insert empty 
page after last page of each copy.
I'm sure it's not good way to solve this problem.

So, if anybody have something to say, I would be appreciate.

Thank you.


-- 
Best wishes,
Vitaly Perov
Russia, Saint-Petersburg. www.etersoft.ru


From patrol at sinus.cz  Tue Apr 15 08:02:14 2008
From: patrol at sinus.cz (Pavel Troller)
Date: Tue, 15 Apr 2008 15:02:14 +0200
Subject: Unimplemented ntoskrnl functions ?
Message-ID: <20080415130214.GA21775@tangens.sinus.cz>

Hi!
  I'm solving the following problem:
  I would like to run the "Tibbo Device Server Toolkit" (TDSK) - see
http://www.tibbo.com/get_dst.php
  During installation of the product on a fresh wine (the last Sunday's git)
with a fresh .wine directory, it crashes with the following report:

wine: Call from 0x7b841720 to unimplemented function ntoskrnl.exe.KeInitializeEvent, aborting
wine: Unimplemented function ntoskrnl.exe.KeInitializeEvent called at address 0x7b841720 (thread 0021), starting debugger...
Unhandled exception: unimplemented function ntoskrnl.exe.KeInitializeEvent called in 32-bit code (0x7b841796).

  Is this function hard to implement ? I'm somewhat experienced with Linux
programming, but I know absolutely nothing about windoze. 

After a lot of time, if wineserver -k isn't applied, it reports another two
unimplemented functions - KeInitializeInterrupt and KeInitializeMutant. What
about these ?

With regards, Pavel Troller


From zgs at seas.upenn.edu  Tue Apr 15 08:35:46 2008
From: zgs at seas.upenn.edu (Zachary Goldberg)
Date: Tue, 15 Apr 2008 09:35:46 -0400
Subject: [WineHQ][WWN] WWN 345
In-Reply-To: <001c01c89ed5$fbf92150$a600fea9@DMITRY>
References: <20080415034454.D66A4166CF23@bluesata.com>
	<001c01c89ed5$fbf92150$a600fea9@DMITRY>
Message-ID: <b050a5e70804150635h59a90fe4q3af0f211c7b4fa93@mail.gmail.com>

On Tue, Apr 15, 2008 at 4:52 AM, Dmitry Timoshkov
<dmitry at codeweavers.com> wrote:
> "Zachary Goldberg" <zgs at seas.upenn.edu> wrote:
>
>
> > +<section
> > + title="News: new WineTricks, 1.0 status updates and more"
> > + subject="Wine"
> > + archive="http://www.xkcd.com"
> > + posts="0"
> > +>
> >
>
>  How is the url above related to the title?
>
>  --
>  Dmitry.
>

It isn't, I had nothing else to put.  I generally leave them blank but
I for some reason decided to throw xkcd in there this time.

-Zach


From hverbeet at gmail.com  Tue Apr 15 08:54:07 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Tue, 15 Apr 2008 15:54:07 +0200
Subject: d3dx9: Add d3dx9tex.h
In-Reply-To: <E1JllJQ-0003bt-Va@www13.emo.freenet-rz.de>
References: <E1JllJQ-0003bt-Va@www13.emo.freenet-rz.de>
Message-ID: <d658b69e0804150654q25d3bc53x9a5b6a52c362f174@mail.gmail.com>

On 15/04/2008, tony.wasserka at freenet.de <tony.wasserka at freenet.de> wrote:
>

> +#ifndef __WINE_D3DX9TEX_H
> +#define __WINE_D3DX9TEX_H
...
> +#endif /* __WINE_D3DX9CORE_H */
I didn't look at the rest of the patch in detail, but the comment
there doesn't match the actual #ifndef.


From paulc at voip.null.ro  Tue Apr 15 09:02:45 2008
From: paulc at voip.null.ro (Paul Chitescu)
Date: Tue, 15 Apr 2008 17:02:45 +0300 (EEST)
Subject: Unimplemented ntoskrnl functions ?
In-Reply-To: <20080415130214.GA21775@tangens.sinus.cz>
References: <20080415130214.GA21775@tangens.sinus.cz>
Message-ID: <Pine.LNX.4.64.0804151655570.15822@dragoshel>

On Tue, 15 Apr 2008, Pavel Troller wrote:
> Hi!
>  I'm solving the following problem:
>  I would like to run the "Tibbo Device Server Toolkit" (TDSK) - see
> http://www.tibbo.com/get_dst.php
>  During installation of the product on a fresh wine (the last Sunday's git)
> with a fresh .wine directory, it crashes with the following report:
>
> wine: Call from 0x7b841720 to unimplemented function ntoskrnl.exe.KeInitializeEvent, aborting
> wine: Unimplemented function ntoskrnl.exe.KeInitializeEvent called at address 0x7b841720 (thread 0021), starting debugger...
> Unhandled exception: unimplemented function ntoskrnl.exe.KeInitializeEvent called in 32-bit code (0x7b841796).
>
>  Is this function hard to implement ? I'm somewhat experienced with Linux
> programming, but I know absolutely nothing about windoze.
>
> After a lot of time, if wineserver -k isn't applied, it reports another two
> unimplemented functions - KeInitializeInterrupt and KeInitializeMutant. What
> about these ?
>
> With regards, Pavel Troller

Hi, Pavel!

You are trying to run the Windows device driver (a virtual port 
redirector) included with the application.

Wine does not really support Windows drivers - although some may load the 
functionality just isn't there. The application may run on a COM port 
supported by the operating system (Linux, etc.)

The installation failure is what you should aim to fix. A winedevice crash 
should not stop the installation.

Regards,

Paul Chitescu


From juan.lang at gmail.com  Tue Apr 15 09:14:58 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Tue, 15 Apr 2008 07:14:58 -0700
Subject: Apparently it is possible to have chm file without #STRINGS in it,
	so we should not stop processing file at it. Fixes bug #12498
In-Reply-To: <1208241074.18325.9.camel@zgierznet>
References: <3a768c550804141658x6051f8a3raadc85603cedc023@mail.gmail.com>
	<1208241074.18325.9.camel@zgierznet>
Message-ID: <3a768c550804150714q1c8b004dt9ed135c1be1d1439@mail.gmail.com>

>  Have you tried patch without this "if"? In my case it crashes without it
>  when I try to open chm from bug #12498... i don't know if strdupW can
>  dup NULL as well as null?

Aaaah...  Sorry, my mistake, I missed this declaration:
        static const WCHAR null[] = {0};
That solves that mystery.

In that case, one fix per patch, please.  This fix and the other are
unrelated:  one fixes a crash, the other deals with a missing #STRINGS
stream.  Thanks,
--Juan


From patrol at sinus.cz  Tue Apr 15 09:19:38 2008
From: patrol at sinus.cz (Pavel Troller)
Date: Tue, 15 Apr 2008 16:19:38 +0200
Subject: Unimplemented ntoskrnl functions ?
In-Reply-To: <Pine.LNX.4.64.0804151655570.15822@dragoshel>
References: <20080415130214.GA21775@tangens.sinus.cz>
	<Pine.LNX.4.64.0804151655570.15822@dragoshel>
Message-ID: <20080415141938.GA27081@tangens.sinus.cz>

> On Tue, 15 Apr 2008, Pavel Troller wrote:
> > Hi!
> >  I'm solving the following problem:
> >  I would like to run the "Tibbo Device Server Toolkit" (TDSK) - see
> > http://www.tibbo.com/get_dst.php
> >  During installation of the product on a fresh wine (the last Sunday's git)
> > with a fresh .wine directory, it crashes with the following report:
> >
> > wine: Call from 0x7b841720 to unimplemented function ntoskrnl.exe.KeInitializeEvent, aborting
> > wine: Unimplemented function ntoskrnl.exe.KeInitializeEvent called at address 0x7b841720 (thread 0021), starting debugger...
> > Unhandled exception: unimplemented function ntoskrnl.exe.KeInitializeEvent called in 32-bit code (0x7b841796).
> >
> >  Is this function hard to implement ? I'm somewhat experienced with Linux
> > programming, but I know absolutely nothing about windoze.
> >
> > After a lot of time, if wineserver -k isn't applied, it reports another two
> > unimplemented functions - KeInitializeInterrupt and KeInitializeMutant. What
> > about these ?
> >
> > With regards, Pavel Troller
> 
> Hi, Pavel!
> 
> You are trying to run the Windows device driver (a virtual port 
> redirector) included with the application.

Oh, I see. I actually don't want to use the device driver (Virtual Serial
Port - VSP), there is a native Linux driver for it. What I need, is to
manage the Tibbo devices, and this functionality is not available for Linux
and probably will never be.

> 
> Wine does not really support Windows drivers - although some may load the 
> functionality just isn't there. The application may run on a COM port 
> supported by the operating system (Linux, etc.)

The problem probably is, that the Device Server utilizes the underlying devices
for its operation, so it cannot be used without them. It uses some "out of band
channels" to communicate with Tibbos - for example, even if the IP address of
the device is lost/spontaneously changed, it can find it using special
broadcasts, show its current config, and change it (without losing this
"service connection"). I was hoping that maybe it will work independently of the
device driver, but it probably won't.

> 
> The installation failure is what you should aim to fix. A winedevice crash 
> should not stop the installation.
> 
> Regards,
> 
> Paul Chitescu
> 
Thank you for your valuable help! It looks that these devices are not for me
:-(.
   With regards, Pavel Troller


From juan.lang at gmail.com  Tue Apr 15 10:09:22 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Tue, 15 Apr 2008 08:09:22 -0700
Subject: Apparently it is possible to have chm file without #STRINGS in it,
	so we should not stop processing file at it. Fixes bug #12498
In-Reply-To: <1208271962.25171.16.camel@tefdemo>
References: <3a768c550804141658x6051f8a3raadc85603cedc023@mail.gmail.com>
	<1208241074.18325.9.camel@zgierznet>
	<3a768c550804150714q1c8b004dt9ed135c1be1d1439@mail.gmail.com>
	<1208271962.25171.16.camel@tefdemo>
Message-ID: <3a768c550804150809q1ed25390r46be73afd64382f1@mail.gmail.com>

>  > In that case, one fix per patch, please.  This fix and the other are
>  > unrelated:  one fixes a crash, the other deals with a missing #STRINGS
>  > stream.  Thanks,
>
>  No, I think that crash is only possible with my patch. Right now if
>  there is no #STRINGS it closes chm and stops processing.

Okay, I understand.  Your patch looks fine to me then.  You may wish
to resend, Alexandre may have other ideas ;-)
--Juan


From pnilsson at nullref.se  Tue Apr 15 11:17:29 2008
From: pnilsson at nullref.se (Philip Nilsson)
Date: Tue, 15 Apr 2008 18:17:29 +0200
Subject: d3dx9_36: Add stubs and implementations for D3DXCreateTexturexx
In-Reply-To: <E1Jl4yL-00045q-1D@www19.emo.freenet-rz.de>
References: <E1Jl4yL-00045q-1D@www19.emo.freenet-rz.de>
Message-ID: <20080415161729.GA4373@zorkmid.localnetwork>

On Sun, Apr 13, 2008 at 06:22:29PM +0200, tony.wasserka at freenet.de wrote:
> Hi,
> Are you still working on the texture functions?
> I'd need them for completing my ID3DXSprite implementation,
> so if you don't mind I could complete your started patches.
> 
> Best regards,
>     Tony

  I have a hacky implementation of D3DXLoadSurfaceFromMemory and
D3DXLoadSurfaceFromSurface, as well as a pretty good implementation of
D3DXCreateTexture and D3DXCheckTextureRequirements.

  I'll send in the patch for the last two when I have time, and have
looked it over a final time.  I pretty much abandoned the first two,
because there's got to be a whole lot of code somewhere in the tree
already.  It does work in some cases, however.  Attached in case it
might be helpful.

-- 
Philip Nilsson
-------------- next part --------------
A non-text attachment was scrubbed...
Name: surface.c
Type: text/x-csrc
Size: 8438 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080415/f19089b5/attachment-0001.c 

From luis.busquets at ilidium.com  Tue Apr 15 11:58:23 2008
From: luis.busquets at ilidium.com (Luis Busquets)
Date: Tue, 15 Apr 2008 18:58:23 +0200
Subject: quartz: FOURCC Error in compiling
Message-ID: <4804DEAF.7050809@ilidium.com>

When I try to compile the wine tree of today I get an error compiling 
avisplit.o: There is no rule to build fourcc.h needed for avisplit.o

/make[2]: *** No hay ninguna regla para construir el objetivo 
`fourcc.h', necesario para `avisplit.o'.  Alto.
make[2]: se sale del directorio `/wine-git/dlls/quartz'
make[1]: *** [quartz] Error 2
make[1]: se sale del directorio `/wine-git/dlls'
make: *** [dlls] Error 2
/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080415/f605e91f/attachment.htm 

From austinenglish at gmail.com  Tue Apr 15 12:07:48 2008
From: austinenglish at gmail.com (Austin English)
Date: Tue, 15 Apr 2008 12:07:48 -0500
Subject: Feature Request: Registry / winecfg entry for launching an
	application in a wineexplorer window
In-Reply-To: <48040EDD.7010708@kievinfo.com>
References: <4803182C.9070209@open-vote.org>
	<200804140534.33333.chris.kcat@gmail.com>
	<b6bb06270804141004nd99e48are3158647a4482bc2@mail.gmail.com>
	<48040EDD.7010708@kievinfo.com>
Message-ID: <b6bb06270804151007h717ebc48n7b33025c902f3985@mail.gmail.com>

On Mon, Apr 14, 2008 at 9:11 PM, Vitaliy Margolen
<wine-devel at kievinfo.com> wrote:
> Austin English wrote:
>  > On Mon, Apr 14, 2008 at 7:34 AM, Chris Robinson <chris.kcat at gmail.com> wrote:
>  >>  IIRC, the problem is you can't have two Wine processes using two different
>  >>  desktops. Try this: start an app without virtual desktop and leave it
>  >>  running, run winecfg and turn on virtual desktop (make sure to click Apply),
>  >>  then try to start another app. It won't use a virtual desktop.
>  >>
>  >>
>  >
>  > Terminal one:
>  > $ rm -rf ~/.wine
>  > $ wine notepad
>  >
>  > Terminal two:
>  > $ winecfg # enable virtual desktop
>  > $ winemine # doesn't go in virtual desktop
>  > $ wine explorer /desktop=name,1024x768 winemine # goes in virtual desktop
>  >
>  That's by design when you change configuration via winecfg it applies to
>  "default" desktop only. And if it's already active (desktop for your
>  notepad) it won't just become virtual desktop. When you using "name" that
>  creates separate desktop with that name and requested parameters.
>
>  Vitaliy
>
>
>

What would be lost by having those apps that someone wants to be in
their own virtual desktop each having their own (with unique names).
I.e., if you choose to give Starcraft and Wow each their own desktop,
but not notepad:
$ wine notepad #works in regular managed mode
$ wine wow.exe # would be equivalent to running wine explorer
/desktop=wow,1024x768 wow.exe
$ wine starcraft.exe # would be equivalent to running wine explorer
/desktop=starcraft,800x600 starcraft.exe

With the desktop names being either assigned by program name,
automatically assigned, or chosen by the user. Resolution could
default to 800 x 600, but also be customizable in winecfg.

Thoughts?


From thestig at google.com  Tue Apr 15 12:08:27 2008
From: thestig at google.com (Lei Zhang)
Date: Tue, 15 Apr 2008 10:08:27 -0700
Subject: quartz: FOURCC Error in compiling
In-Reply-To: <4804DEAF.7050809@ilidium.com>
References: <4804DEAF.7050809@ilidium.com>
Message-ID: <558b2f5c0804151008k78af8797tb6e20cfe35a9ad64@mail.gmail.com>

On Tue, Apr 15, 2008 at 9:58 AM, Luis Busquets
<luis.busquets at ilidium.com> wrote:
>
>  When I try to compile the wine tree of today I get an error compiling
> avisplit.o: There is no rule to build fourcc.h needed for avisplit.o
>
>  make[2]: *** No hay ninguna regla para construir el objetivo `fourcc.h',
> necesario para `avisplit.o'.  Alto.
>  make[2]: se sale del directorio `/wine-git/dlls/quartz'
>  make[1]: *** [quartz] Error 2
>  make[1]: se sale del directorio `/wine-git/dlls'
>  make: *** [dlls] Error 2
>

Try regenerating dlls/quartz/Makefile and it should compile again.


From rob at codeweavers.com  Tue Apr 15 12:40:13 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Tue, 15 Apr 2008 18:40:13 +0100
Subject: RFC: Fix for IWineMsiRemotePackage::FormatRecord
Message-ID: <4804E87D.2000209@codeweavers.com>

Hi,

Currently, the [out] value parameter for 
IWineMsiRemotePackage::FormatRecord doesn't have a level of indirection 
associated with it and so I would be very surprised if the typelib 
marshaller actually does the right thing in this case. Compiling with 
MIDL and with a future update to widl causes an error for this 
parameter. I'm proposing the attached patch to fix things, but I'm not 
able to test that this works correctly.

Thanks,

-- 
Rob Shearman

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-msi-Fix-the-value-parameter-of-IWineMsiRemotePackag.patch
Type: text/x-patch
Size: 0 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080415/d659e778/attachment.bin 

From rob at codeweavers.com  Tue Apr 15 05:33:43 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Tue, 15 Apr 2008 11:33:43 +0100
Subject: msi: Fix the value parameter of IWineMsiRemotePackage::FormatRecord to have the right level of indirection for an [out] parameter.
Message-ID: <mailman.388.1208281233.3731.wine-devel@winehq.org>

Remove the redundant size parameter and simplify the client code such that the remote function is only called once, with the value being automatically allocated. Add corresponding code on the server side to automatically allocate said value.
---
 dlls/msi/format.c      |   17 +----------------
 dlls/msi/msiserver.idl |    2 +-
 dlls/msi/package.c     |   13 +++++++++++--
 3 files changed, 13 insertions(+), 19 deletions(-)

diff --git a/dlls/msi/format.c b/dlls/msi/format.c
index f58f517..454142a 100644
--- a/dlls/msi/format.c
+++ b/dlls/msi/format.c
@@ -921,28 +921,13 @@ UINT WINAPI MsiFormatRecordW( MSIHANDLE hInstall, MSIHANDLE hRecord,
         HRESULT hr;
         IWineMsiRemotePackage *remote_package;
         BSTR value = NULL;
-        DWORD len;
         awstring wstr;
 
         remote_package = (IWineMsiRemotePackage *)msi_get_remote( hInstall );
         if (remote_package)
         {
-            len = 0;
             hr = IWineMsiRemotePackage_FormatRecord( remote_package, hRecord,
-                                                     NULL, &len );
-            if (FAILED(hr))
-                goto done;
-
-            len++;
-            value = SysAllocStringLen( NULL, len );
-            if (!value)
-            {
-                r = ERROR_OUTOFMEMORY;
-                goto done;
-            }
-
-            hr = IWineMsiRemotePackage_FormatRecord( remote_package, hRecord,
-                                                     value, &len );
+                                                     &value );
             if (FAILED(hr))
                 goto done;
 
diff --git a/dlls/msi/msiserver.idl b/dlls/msi/msiserver.idl
index d5b47ac..37aa91e 100644
--- a/dlls/msi/msiserver.idl
+++ b/dlls/msi/msiserver.idl
@@ -70,7 +70,7 @@ interface IWineMsiRemotePackage : IUnknown
     HRESULT SetComponentState( [in] BSTR component, [in] INSTALLSTATE state );
     HRESULT GetLanguage( [out] LANGID *language );
     HRESULT SetInstallLevel( [in] int level );
-    HRESULT FormatRecord( [in] MSIHANDLE record, [out] BSTR value, [out] DWORD *size );
+    HRESULT FormatRecord( [in] MSIHANDLE record, [out] BSTR *value );
     HRESULT EvaluateCondition( [in] BSTR condition );
 }
 
diff --git a/dlls/msi/package.c b/dlls/msi/package.c
index a587a63..f11b068 100644
--- a/dlls/msi/package.c
+++ b/dlls/msi/package.c
@@ -1812,10 +1812,19 @@ static HRESULT WINAPI mrp_SetInstallLevel( IWineMsiRemotePackage *iface, int lev
 }
 
 static HRESULT WINAPI mrp_FormatRecord( IWineMsiRemotePackage *iface, MSIHANDLE record,
-                                 BSTR value, DWORD *size )
+                                        BSTR *value)
 {
+    DWORD size = 0;
     msi_remote_package_impl* This = mrp_from_IWineMsiRemotePackage( iface );
-    UINT r = MsiFormatRecordW(This->package, record, (LPWSTR)value, size);
+    UINT r = MsiFormatRecordW(This->package, record, NULL, &size);
+    if (r == ERROR_SUCCESS)
+    {
+        *value = SysAllocStringLen(NULL, size);
+        if (!*value)
+            return E_OUTOFMEMORY;
+        size++;
+        r = MsiFormatRecordW(This->package, record, *value, &size);
+    }
     return HRESULT_FROM_WIN32(r);
 }
 
-- 
1.5.3.8


--------------050007050203060904040902--


From jnewman at codeweavers.com  Tue Apr 15 12:53:17 2008
From: jnewman at codeweavers.com (Jeremy Newman)
Date: Tue, 15 Apr 2008 12:53:17 -0500
Subject: [WineHQ] Assorted spelling fixes.
In-Reply-To: <alpine.DEB.1.10.0804151124480.31798@amboise.dolphin>
References: <alpine.DEB.1.10.0804151124480.31798@amboise.dolphin>
Message-ID: <4804EB8D.6070107@codeweavers.com>

This patch does not apply for me, I get the following errors:

jnewman at jnewman:/home/httpd/html/winehq_org$ git am ~/Downloads/patch.eml
Applying Assorted spelling fixes.
.dotest/patch:38: trailing whitespace.
     between GDI/USER and the KERNEL, that is not absolutely needed, must be
.dotest/patch:47: trailing whitespace.
<quote who="Patrick Stridvall">I think your original suggestion making Wine
.dotest/patch:60: trailing whitespace.
not very optimized so I wouldn't be surprised if it is _much_ slower.
.dotest/patch:69: trailing whitespace.
Ove's pthread hack is a good way to make more libc functions usable
.dotest/patch:82: trailing whitespace.
It is of course also possible to override these settings by explicitly 
using Wine's --dll command-line
error: patch failed: wwn/wn19990627_2.xml:474
error: wwn/wn19990627_2.xml: patch does not apply
error: patch failed: wwn/wn19990718_4.xml:394
error: wwn/wn19990718_4.xml: patch does not apply
error: patch failed: wwn/wn20000605_46.xml:364
error: wwn/wn20000605_46.xml: patch does not apply
error: patch failed: wwn/wn20001106_68.xml:566
error: wwn/wn20001106_68.xml: patch does not apply
error: patch failed: wwn/wn20010718_100.xml:342
error: wwn/wn20010718_100.xml: patch does not apply
error: patch failed: wwn/wn20011021_106.xml:422
error: wwn/wn20011021_106.xml: patch does not apply
error: patch failed: wwn/wn20020308_117.xml:720
error: wwn/wn20020308_117.xml: patch does not apply
error: patch failed: wwn/wn20030103_151.xml:437
error: wwn/wn20030103_151.xml: patch does not apply
error: patch failed: wwn/wn20030228_159.xml:566
error: wwn/wn20030228_159.xml: patch does not apply
error: patch failed: wwn/wn20030725_180.xml:165
error: wwn/wn20030725_180.xml: patch does not apply
error: patch failed: wwn/wn20030829_185.xml:381
error: wwn/wn20030829_185.xml: patch does not apply
error: patch failed: wwn/wn20041022_245.xml:162
error: wwn/wn20041022_245.xml: patch does not apply
error: patch failed: wwn/wn20041126_250.xml:337
error: wwn/wn20041126_250.xml: patch does not apply
error: patch failed: wwn/wn20050415_270.xml:257
error: wwn/wn20050415_270.xml: patch does not apply
error: patch failed: wwn/wn20050506_273.xml:354
error: wwn/wn20050506_273.xml: patch does not apply
error: patch failed: wwn/wn20050819_288.xml:286
error: wwn/wn20050819_288.xml: patch does not apply
error: patch failed: wwn/wn20051014_294.xml:155
error: wwn/wn20051014_294.xml: patch does not apply
error: patch failed: wwn/wn20051125_299.xml:294
error: wwn/wn20051125_299.xml: patch does not apply
error: patch failed: wwn/wn20060226_306.xml:208
error: wwn/wn20060226_306.xml: patch does not apply
error: patch failed: wwn/wn20060410_311.xml:321
error: wwn/wn20060410_311.xml: patch does not apply
error: patch failed: wwn/wn20060428_312.xml:287
error: wwn/wn20060428_312.xml: patch does not apply
error: patch failed: wwn/wn20070416_329.xml:304
error: wwn/wn20070416_329.xml: patch does not apply
Patch failed at 0001.
When you have resolved this problem run "git-am --resolved".
If you would prefer to skip this patch, instead run "git-am --skip".



Francois Gouget wrote:
> ---
> 
> The attachement will probably look a bit strange but it should work 
> anyway.
> 
>  wwn/wn19990627_2.xml   |    4 ++--
>  wwn/wn19990718_4.xml   |    4 ++--
>  wwn/wn20000605_46.xml  |    2 +-
>  wwn/wn20001106_68.xml  |    2 +-
>  wwn/wn20010718_100.xml |    2 +-
>  wwn/wn20011021_106.xml |    2 +-
>  wwn/wn20020308_117.xml |    2 +-
>  wwn/wn20030103_151.xml |    6 +++---
>  wwn/wn20030228_159.xml |    2 +-
>  wwn/wn20030725_180.xml |    2 +-
>  wwn/wn20030829_185.xml |    4 ++--
>  wwn/wn20041022_245.xml |    2 +-
>  wwn/wn20041126_250.xml |    2 +-
>  wwn/wn20050415_270.xml |    2 +-
>  wwn/wn20050506_273.xml |    4 ++--
>  wwn/wn20050819_288.xml |    2 +-
>  wwn/wn20051014_294.xml |    2 +-
>  wwn/wn20051125_299.xml |    2 +-
>  wwn/wn20060226_306.xml |    2 +-
>  wwn/wn20060410_311.xml |    2 +-
>  wwn/wn20060428_312.xml |    4 ++--
>  wwn/wn20070416_329.xml |    2 +-
>  22 files changed, 29 insertions(+), 29 deletions(-)
> 
> 
> ------------------------------------------------------------------------
> 
> 


From julliard at winehq.org  Tue Apr 15 13:05:08 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Tue, 15 Apr 2008 20:05:08 +0200
Subject: Feature Request: Registry / winecfg entry for launching an
	application in a wineexplorer window
In-Reply-To: <b6bb06270804151007h717ebc48n7b33025c902f3985@mail.gmail.com>
	(Austin English's message of "Tue, 15 Apr 2008 12:07:48 -0500")
References: <4803182C.9070209@open-vote.org>
	<200804140534.33333.chris.kcat@gmail.com>
	<b6bb06270804141004nd99e48are3158647a4482bc2@mail.gmail.com>
	<48040EDD.7010708@kievinfo.com>
	<b6bb06270804151007h717ebc48n7b33025c902f3985@mail.gmail.com>
Message-ID: <87od8bm1t7.fsf@wine.dyndns.org>

"Austin English" <austinenglish at gmail.com> writes:

> What would be lost by having those apps that someone wants to be in
> their own virtual desktop each having their own (with unique names).
> I.e., if you choose to give Starcraft and Wow each their own desktop,
> but not notepad:
> $ wine notepad #works in regular managed mode
> $ wine wow.exe # would be equivalent to running wine explorer
> /desktop=wow,1024x768 wow.exe
> $ wine starcraft.exe # would be equivalent to running wine explorer
> /desktop=starcraft,800x600 starcraft.exe
>
> With the desktop names being either assigned by program name,
> automatically assigned, or chosen by the user. Resolution could
> default to 800 x 600, but also be customizable in winecfg.
>
> Thoughts?

That's clearly something that would be nice to have, but it's not
trivial to do; otherwise it would have been done already, it has been
requested for a while now. Patches are welcome of course...

-- 
Alexandre Julliard
julliard at winehq.org


From jnewman at codeweavers.com  Tue Apr 15 13:18:20 2008
From: jnewman at codeweavers.com (Jeremy Newman)
Date: Tue, 15 Apr 2008 13:18:20 -0500
Subject: Full Screen Desktop Mode
Message-ID: <4804F16C.3050002@codeweavers.com>

Here is a feature request that I'd had in my head for quite some time 
now. I don't usually pass my crazy ideas on down through the devel pipe, 
but I feel this one is too good to pass up on.

Many of us still use desktop mode to get around issues with various 
window managers (compiz, metacity, etc). But running a game in desktop 
mode, you loose out on running full screen.

It would be slick if the Wine desktop could be switched into full screen 
on the fly with a hotkey (say Ctrl + Alt + Enter). So if you are running 
a 1280x800 Wine desktop on a 1680x1050 screen, and you hit the hotkey, 
the resolution would be switched to 1280x800 and the Wine desktop is 
your screen until you hit the hotkey to switch back, or you exit the 
program.

Sound fun?


From developers at tefnet.pl  Tue Apr 15 08:04:49 2008
From: developers at tefnet.pl (Tomasz Jezierski - Tefnet)
Date: Tue, 15 Apr 2008 15:04:49 +0200
Subject: hhctrl.ocx: Parse HTML entities in the table of contents.
In-Reply-To: <874pluwkj0.fsf@wine.dyndns.org>
References: <4657EA04.1010107@codeweavers.com> <874pluwkj0.fsf@wine.dyndns.org>
Message-ID: <1208264688.23885.17.camel@tefdemo>


Dnia 30-05-2007, ?ro o godzinie 14:41 +0200, Alexandre Julliard pisze:
> Robert Shearman <rob at codeweavers.com> writes:
> 
Hi, I found this patch from May which never got into wine.
http://www.winehq.org/pipermail/wine-patches/2007-May/039722.html

Could you explain me what is still wrong with it? I would like to fix
it.


> > +            p++;
> > +            if ((*p == 'X') || (*p == 'x'))
> > +            {
> > +                /* hexadecimal entity */
> > +                while ((*p >= '0' && *p <= '9') || (*p >= 'a' && *p <= 'f') ||
> > +                       (*p >= 'A' && *p <= 'F'))
> > +                    p++;
> > +                ch = strtolW(start + 2, NULL, 16);
> > +            }
> 
> This is still broken.
You said earlier:
"You should exit the loop at the first ';'. Also you have to increment
p first."

It looks like Robert did what you said?

> 
> > +            if (p - start - 1 <= sizeof(char_refs[0].name))
> > +            {
> > +                for (i = 0; i < sizeof(char_refs)/sizeof(char_refs[0]); i++)
> > +                    if (!strncmpW(char_refs[i].name, start + 1, p - start - 1))
> > +                        break;
> > +            }
> 
> This is still broken too.

You said earlier:
"The sizeof check doesn't make much sense, especially inside the
loop. What you need is to check that you reached the end of the string
if the strncmpW succeeded."

You mean to check if *p == 0 ?



While reading this patch I found another bug:

+            if (i == sizeof(char_refs)/sizeof(char_refs[0]))
+            {
+                FIXME("character entity %s not found\n", debugstr_wn(start + 1, p - start - 1));
+                continue;
+            }

I think *start should be changed to another char in that case, because if we will not change it, we will fall into infinite loop like it happens with help file in GPSTRACK from bug #6801.

Moreover we need full entity table, one of those mentioned by Hin-Tak Leung:
http://bugs.winehq.org/show_bug.cgi?id=6801#c28







From truiken at gmail.com  Tue Apr 15 15:12:32 2008
From: truiken at gmail.com (James Hawkins)
Date: Tue, 15 Apr 2008 15:12:32 -0500
Subject: RFC: Fix for IWineMsiRemotePackage::FormatRecord
In-Reply-To: <4804E87D.2000209@codeweavers.com>
References: <4804E87D.2000209@codeweavers.com>
Message-ID: <22821af30804151312u25bcbb4o8c95c63ce1fde6ff@mail.gmail.com>

On Tue, Apr 15, 2008 at 12:40 PM, Robert Shearman <rob at codeweavers.com> wrote:
> Hi,
>
>  Currently, the [out] value parameter for
> IWineMsiRemotePackage::FormatRecord doesn't have a level of indirection
> associated with it and so I would be very surprised if the typelib
> marshaller actually does the right thing in this case. Compiling with MIDL
> and with a future update to widl causes an error for this parameter. I'm
> proposing the attached patch to fix things, but I'm not able to test that
> this works correctly.
>

> Remove the redundant size parameter and simplify the client code such that the remote function is only called once, with the value being automatically allocated. Add corresponding code on the server side to automatically allocate said value.

Yea, this is good.  I remember that I had a problem with this when I
wrote it, but I wasn't sure of the right way to go.

-- 
James Hawkins


From rob at codeweavers.com  Tue Apr 15 15:41:01 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Tue, 15 Apr 2008 21:41:01 +0100
Subject: browseui: Remove unused variables
In-Reply-To: <200804152133.19736.andrew.talbot@talbotville.com>
References: <200804152133.19736.andrew.talbot@talbotville.com>
Message-ID: <480512DD.7010201@codeweavers.com>

Andrew Talbot wrote:
> @@ -299,7 +299,6 @@ static HRESULT WINAPI ProgressDialog_StartProgressDialog(IProgressDialog *iface,
>  {
>      ProgressDialog *This = (ProgressDialog *)iface;
>      struct create_params params;
> -    HANDLE hThread;
>  
>      TRACE("(%p, %p, %x, %p)\n", iface, punkEnableModeless, dwFlags, reserved);
>      if (punkEnableModeless || reserved)
> @@ -321,7 +320,7 @@ static HRESULT WINAPI ProgressDialog_StartProgressDialog(IProgressDialog *iface,
>      params.hwndParent = hwndParent;
>      params.hEvent = CreateEventW(NULL, TRUE, FALSE, NULL);
>  
> -    hThread = CreateThread(NULL, 0, dialog_thread, &params, 0, NULL);
> +    CreateThread(NULL, 0, dialog_thread, &params, 0, NULL);
>      WaitForSingleObject(params.hEvent, INFINITE);
>  
>      This->hwndDisabledParent = NULL;

A correct fix is to call CloseHandle(hThread), otherwise the handle is 
leaked.


-- 
Rob Shearman



From rob at codeweavers.com  Tue Apr 15 15:42:55 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Tue, 15 Apr 2008 21:42:55 +0100
Subject: comctl32: Remove unused variables
In-Reply-To: <200804152133.23009.andrew.talbot@talbotville.com>
References: <200804152133.23009.andrew.talbot@talbotville.com>
Message-ID: <4805134F.8010603@codeweavers.com>

Andrew Talbot wrote:
> @@ -967,16 +967,14 @@ static HFONT SYSLINK_SetFont (SYSLINK_INFO *infoPtr, HFONT hFont, BOOL bRedraw)
>   */
>  static LRESULT SYSLINK_SetText (SYSLINK_INFO *infoPtr, LPCWSTR Text)
>  {
> -    int textlen;
> -
>      /* clear the document */
>      SYSLINK_ClearDoc(infoPtr);
> -    
> -    if(Text == NULL || (textlen = lstrlenW(Text)) == 0)
> +
> +    if(Text == NULL || lstrlenW(Text) == 0)
>      {
>   

A better fix would be to use "*Text == 0" instead of "lstrlenW(Text) == 0".

-- 
Rob Shearman



From rob at codeweavers.com  Tue Apr 15 15:44:15 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Tue, 15 Apr 2008 21:44:15 +0100
Subject: dinput: Remove unused variables
In-Reply-To: <200804152133.26439.andrew.talbot@talbotville.com>
References: <200804152133.26439.andrew.talbot@talbotville.com>
Message-ID: <4805139F.5020203@codeweavers.com>

Andrew Talbot wrote:
> @@ -142,13 +142,12 @@ static INT find_joystick_devices(void)
>      {
>          CHAR device_name[MAX_PATH], *str;
>          INT len;
> -        int fd;
>  
>          len = sprintf(device_name, "%s%d", JOYDEV_NEW, i) + 1;
> -        if ((fd = open(device_name, O_RDONLY)) < 0)
> +        if (open(device_name, O_RDONLY) < 0)
>          {
>              len = sprintf(device_name, "%s%d", JOYDEV_OLD, i) + 1;
> -            if ((fd = open(device_name, O_RDONLY)) < 0) continue;
> +            if (open(device_name, O_RDONLY) < 0) continue;
>          }
>  
>          if (!(str = HeapAlloc(GetProcessHeap(), 0, len))) break;

Again, this needs to be fixed in another way as fd is being leaked.

-- 
Rob Shearman



From Andrew.Talbot at talbotville.com  Tue Apr 15 16:13:51 2008
From: Andrew.Talbot at talbotville.com (Andrew Talbot)
Date: Tue, 15 Apr 2008 22:13:51 +0100
Subject: browseui: Remove unused variables
References: <200804152133.19736.andrew.talbot@talbotville.com>
	<480512DD.7010201@codeweavers.com>
Message-ID: <fu35qf$sdn$1@ger.gmane.org>

Robert Shearman wrote:

> A correct fix is to call CloseHandle(hThread), otherwise the handle is
> leaked.
> 
Thanks, Rob. I've sent a replacement patch entitled
"browseui: Fix handle leak" to replace this.

-- 
Andy.




From Andrew.Talbot at talbotville.com  Tue Apr 15 16:56:24 2008
From: Andrew.Talbot at talbotville.com (Andrew Talbot)
Date: Tue, 15 Apr 2008 22:56:24 +0100
Subject: dinput: Remove unused variables
References: <200804152133.26439.andrew.talbot@talbotville.com>
	<4805139F.5020203@codeweavers.com>
Message-ID: <fu38a8$3pk$1@ger.gmane.org>

Robert Shearman wrote:

> Again, this needs to be fixed in another way as fd is being leaked.
> 

Thanks, again. I've sent a patch entitled
"dinput: Fix handle leak" to replace this.

-- 
Andy.




From khodych at gmail.com  Tue Apr 15 16:59:44 2008
From: khodych at gmail.com (Sergey Khodych)
Date: Wed, 16 Apr 2008 00:59:44 +0300
Subject: dinput: Implement DIPROP_KEYNAME property for keyboard device
In-Reply-To: <48040DA6.6090708@kievinfo.com>
References: <48023854.9020308@gmail.com>
	<48024DC2.3020008@kievinfo.com>	<4803AB6A.3040900@gmail.com>
	<48040DA6.6090708@kievinfo.com>
Message-ID: <48052550.4070504@gmail.com>

> In ascii function you are calling unicode function and copying it's output 
> (unicode string) to the ascii string buffer. This is wrong. Also because 
> these functions deal with strings you have to implement both ascii and 
> unicode functions at the same time. You can't forward one to the other.
Variable ps->wsz not a ascii string buffer because wsz field of struct
DIPROPSTRING has type WCHAR[MAX_PATH]. Function
IDirectInputDevice8::GetProperty works only with unicode strings.






From developers at tefnet.pl  Tue Apr 15 08:59:10 2008
From: developers at tefnet.pl (Tomasz Jezierski - Tefnet)
Date: Tue, 15 Apr 2008 15:59:10 +0200
Subject: hhctrl.ocx: Parse HTML entities in the table of contents.
Message-ID: <1208267950.25171.5.camel@tefdemo>

Dnia 30-05-2007, ?ro o godzinie 14:41 +0200, Alexandre Julliard pisze:
> Robert Shearman <rob at codeweavers.com> writes:
> 

Hi, I found this patch from May 2007 which never got into wine.
http://www.winehq.org/pipermail/wine-patches/2007-May/039722.html

Could you explain me what is still wrong with it? I would like to fix
it.


> > +            p++;
> > +            if ((*p == 'X') || (*p == 'x'))
> > +            {
> > +                /* hexadecimal entity */
> > +                while ((*p >= '0' && *p <= '9') || (*p >= 'a' && *p
<= 'f') ||
> > +                       (*p >= 'A' && *p <= 'F'))
> > +                    p++;
> > +                ch = strtolW(start + 2, NULL, 16);
> > +            }
> 
> This is still broken.

You said earlier:
"You should exit the loop at the first ';'. Also you have to increment
p first."

It looks like Robert did what you said?

> 
> > +            if (p - start - 1 <= sizeof(char_refs[0].name))
> > +            {
> > +                for (i = 0; i <
sizeof(char_refs)/sizeof(char_refs[0]); i++)
> > +                    if (!strncmpW(char_refs[i].name, start + 1, p -
start - 1))
> > +                        break;
> > +            }
> 
> This is still broken too.

You said earlier:
"The sizeof check doesn't make much sense, especially inside the
loop. What you need is to check that you reached the end of the string
if the strncmpW succeeded."

You mean to check if *p == 0 ?




While reading this patch I found another bug:

+            if (i == sizeof(char_refs)/sizeof(char_refs[0]))
+            {
+                FIXME("character entity %s not found\n",
debugstr_wn(start + 1, p - start - 1));
+                continue;
+            }

I think *start should be changed to another char in that case, because
if we will not change it, we will fall into infinite loop like it
happens with help file in GPSTRACK from bug #6801.

Moreover we need full entity table, one of those mentioned by Hin-Tak
Leung:
http://bugs.winehq.org/show_bug.cgi?id=6801#c28







From developers at tefnet.pl  Tue Apr 15 10:07:23 2008
From: developers at tefnet.pl (Tomasz Jezierski - Tefnet)
Date: Tue, 15 Apr 2008 17:07:23 +0200
Subject: Apparently it is possible to have chm file without #STRINGS in
	it, so we should not stop processing file at it. Fixes bug #12498
In-Reply-To: <3a768c550804150714q1c8b004dt9ed135c1be1d1439@mail.gmail.com>
References: <3a768c550804141658x6051f8a3raadc85603cedc023@mail.gmail.com>
	<1208241074.18325.9.camel@zgierznet>
	<3a768c550804150714q1c8b004dt9ed135c1be1d1439@mail.gmail.com>
Message-ID: <1208272043.25171.18.camel@tefdemo>

Dnia 15-04-2008, wto o godzinie 07:14 -0700, Juan Lang pisze:
> >  Have you tried patch without this "if"? In my case it crashes
without it
> >  when I try to open chm from bug #12498... i don't know if strdupW
can
> >  dup NULL as well as null?
> 
> Aaaah...  Sorry, my mistake, I missed this declaration:
>         static const WCHAR null[] = {0};
> That solves that mystery.
> 
> In that case, one fix per patch, please.  This fix and the other are
> unrelated:  one fixes a crash, the other deals with a missing #STRINGS
> stream.  Thanks,

No, I think that crash is only possible with my patch. Right now if
there is no #STRINGS it closes chm and stops processing.




From sonia.xapelli at ilidium.com  Tue Apr 15 11:03:00 2008
From: sonia.xapelli at ilidium.com (=?ISO-8859-1?Q?S=F2nia_Xapell=ED_Br=FA?=)
Date: Tue, 15 Apr 2008 18:03:00 +0200
Subject: quartz: FOURCC Error in compiling
Message-ID: <4804D1B4.6030505@ilidium.com>

When I try to compile the wine tree of today I get an error compiling 
avisplit.o: There is no rule to build fourcc.h needed for avisplit.o

/make[2]: *** No hay ninguna regla para construir el objetivo 
`fourcc.h', necesario para `avisplit.o'.  Alto.
make[2]: se sale del directorio `/wine-git/dlls/quartz'
make[1]: *** [quartz] Error 2
make[1]: se sale del directorio `/wine-git/dlls'
make: *** [dlls] Error 2
/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080415/5c60977e/attachment.htm 

From juan.lang at gmail.com  Tue Apr 15 17:48:59 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Tue, 15 Apr 2008 15:48:59 -0700
Subject: quartz: FOURCC Error in compiling
In-Reply-To: <4804D1B4.6030505@ilidium.com>
References: <4804D1B4.6030505@ilidium.com>
Message-ID: <3a768c550804151548p3802f790q98bbe4d320a34a2f@mail.gmail.com>

>  When I try to compile the wine tree of today I get an error compiling
> avisplit.o

This was already addressed:
http://www.winehq.org/pipermail/wine-devel/2008-April/064884.html
--Juan


From dank at kegel.com  Tue Apr 15 20:05:00 2008
From: dank at kegel.com (Dan Kegel)
Date: Tue, 15 Apr 2008 18:05:00 -0700
Subject: Something strange: installers not waiting for subinstallers any more?
Message-ID: <a71bd89a0804151805y2da885b8o12bdd3ba6a9b5a64@mail.gmail.com>

I just installed Photoshop CS2 trial using yesterday morning's cvs,
and there seemed to be two odd failure:
1) gecko didn't install properly
2) the outer installer declared victory way before the inner installer
was done unpacking

Mysterious, very mysterious.

Ah, well, I'll close my eyes and hope it goes away :-)


From juan.lang at gmail.com  Tue Apr 15 21:41:20 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Tue, 15 Apr 2008 19:41:20 -0700
Subject: Apparently it is possible to have chm file without #STRINGS in it,
	so we should not stop processing file at it. Fixes bug #12498
In-Reply-To: <993130.26158.qm@web23113.mail.ird.yahoo.com>
References: <3a768c550804150714q1c8b004dt9ed135c1be1d1439@mail.gmail.com>
	<993130.26158.qm@web23113.mail.ird.yahoo.com>
Message-ID: <3a768c550804151941n763185y73aad79a20fe0b46@mail.gmail.com>

>  Hmm, sorry, it is probably not a good idea to name a variable "null" -
>  it is just a little confusing. Maybe W_Null or even Wchar_Null or
>  to make it more obvious that it is a programmer-defined variable?

I agree, but Tomasz didn't name this variable, it was already in the
code--that's how I missed it.  I don't think it's a problem in this
patch.
--Juan


From wine-devel at kievinfo.com  Wed Apr 16 00:23:49 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Tue, 15 Apr 2008 23:23:49 -0600
Subject: dinput: Implement DIPROP_KEYNAME property for keyboard device
In-Reply-To: <48052550.4070504@gmail.com>
References: <48023854.9020308@gmail.com>	<48024DC2.3020008@kievinfo.com>	<4803AB6A.3040900@gmail.com>	<48040DA6.6090708@kievinfo.com>
	<48052550.4070504@gmail.com>
Message-ID: <48058D65.5000007@kievinfo.com>

Sergey Khodych wrote:
>> In ascii function you are calling unicode function and copying it's output 
>> (unicode string) to the ascii string buffer. This is wrong. Also because 
>> these functions deal with strings you have to implement both ascii and 
>> unicode functions at the same time. You can't forward one to the other.
> Variable ps->wsz not a ascii string buffer because wsz field of struct
> DIPROPSTRING has type WCHAR[MAX_PATH]. Function
> IDirectInputDevice8::GetProperty works only with unicode strings.
> 
No, there are 2 separate implementations - one ascii another unicode. During 
the object creation one would specify either ascii or unicode RIID.

Vitaliy.


From hintak_leung at yahoo.co.uk  Tue Apr 15 19:41:52 2008
From: hintak_leung at yahoo.co.uk (Hin-Tak Leung)
Date: Wed, 16 Apr 2008 00:41:52 +0000 (GMT)
Subject: Apparently it is possible to have chm file without #STRINGS in it,
	so we should not stop processing file at it. Fixes bug #12498
In-Reply-To: <3a768c550804150714q1c8b004dt9ed135c1be1d1439@mail.gmail.com>
Message-ID: <993130.26158.qm@web23113.mail.ird.yahoo.com>

--- On Tue, 15/4/08, Juan Lang <juan.lang at gmail.com> wrote:

> From: Juan Lang <juan.lang at gmail.com>
> Subject: Re: Apparently it is possible to have chm file without #STRINGS in it, so we should not stop processing file at it. Fixes bug #12498
> To: "Tomasz Jezierski - Tefnet" <developers at tefnet.pl>
> Cc: "Wine Developers List" <wine-devel at winehq.org>
> Date: Tuesday, 15 April, 2008, 3:14 PM
> >  Have you tried patch without this "if"? In
> my case it crashes without it
> >  when I try to open chm from bug #12498... i don't
> know if strdupW can
> >  dup NULL as well as null?
> 
> Aaaah...  Sorry, my mistake, I missed this declaration:
>         static const WCHAR null[] = {0};
> That solves that mystery.
> 
> In that case, one fix per patch, please.  This fix and the
> other are
> unrelated:  one fixes a crash, the other deals with a
> missing #STRINGS
> stream.  Thanks,
> --Juan

Hmm, sorry, it is probably not a good idea to name a variable "null" - 
it is just a little confusing. Maybe W_Null or even Wchar_Null or
to make it more obvious that it is a programmer-defined variable? 


      ___________________________________________________________ 
Yahoo! For Good helps you make a difference  

http://uk.promotions.yahoo.com/forgood/


From hintak_leung at yahoo.co.uk  Tue Apr 15 19:49:30 2008
From: hintak_leung at yahoo.co.uk (Hin-Tak Leung)
Date: Wed, 16 Apr 2008 00:49:30 +0000 (GMT)
Subject: hhctrl.ocx: Parse HTML entities in the table of contents.
In-Reply-To: <1208267950.25171.5.camel@tefdemo>
Message-ID: <326392.29812.qm@web23106.mail.ird.yahoo.com>




--- On Tue, 15/4/08, Tomasz Jezierski - Tefnet <developers at tefnet.pl> wrote:
<snipped>
> While reading this patch I found another bug:
> 
> +            if (i ==
> sizeof(char_refs)/sizeof(char_refs[0]))
> +            {
> +                FIXME("character entity %s not
> found\n",
> debugstr_wn(start + 1, p - start - 1));
> +                continue;
> +            }
> 
> I think *start should be changed to another char in that
> case, because
> if we will not change it, we will fall into infinite loop
> like it
> happens with help file in GPSTRACK from bug #6801.

I have experience the infinite loop myself, but I haven't quite checked
where it is - it happens if the table is incomplete and the code
encounters an html entity that's not mentioned in the table. I encountered it when I tried to view some help pages containing german &umlaute; 's
in another help file I happened to have around.
(gpstrack is about french accented characters.)

So in that sense, the patch is dangerous - infinite loop is far worse 
than not seeing a couple of help pages. I think it needs to do something sensible (e.g. don't translate) even if the table is incomplete.



      ___________________________________________________________ 
Yahoo! For Good helps you make a difference  

http://uk.promotions.yahoo.com/forgood/


From hintak_leung at yahoo.co.uk  Tue Apr 15 20:51:04 2008
From: hintak_leung at yahoo.co.uk (Hin-Tak Leung)
Date: Wed, 16 Apr 2008 01:51:04 +0000 (GMT)
Subject: ddiwrapper 0.3rc1
Message-ID: <718330.5702.qm@web23103.mail.ird.yahoo.com>

I have uploaded my mod'ed version of ddiwrapper to
http://www.linuxprinting.org/download/ddiwrapper/
and called it 0.3rc1. There are some stub codes which I added
to try to get the Konica-Minolta MC2500W XP driver to work without success, so they probably should be taken out, but they are fairly harmless and maybe useful to somebody else. I tried one of the Canon drivers and ddiwrapper worked as advertised. I have updated the change 
log and also added the following paragraph to the bottom of the README:

For Wine releases between Feb/March 2006 up to time of writing
(April 2008), it is necessary to comment out one line in the wine 
loader code to make ddiwrapper work:
====================================================
diff --git a/libs/wine/loader.c b/libs/wine/loader.c
index 0f05f0c..743d487 100644
--- a/libs/wine/loader.c
+++ b/libs/wine/loader.c
@@ -117,7 +117,7 @@ static void build_dll_path(void)
     if (dlldir)
     {
         dll_path_maxlen = strlen(dlldir);
-        dll_paths[nb_dll_paths++] = dlldir;
+        /* dll_paths[nb_dll_paths++] = dlldir; */
     }
     else if ((build_dir = wine_get_build_dir()))
     {
====================================================



      ___________________________________________________________ 
Yahoo! For Good helps you make a difference  

http://uk.promotions.yahoo.com/forgood/


From leslie_alistair at hotmail.com  Wed Apr 16 01:50:46 2008
From: leslie_alistair at hotmail.com (Alistair Leslie-Hughes)
Date: Wed, 16 Apr 2008 16:50:46 +1000
Subject: Help with configure option
Message-ID: <4805A1C6.1060107@hotmail.com>

Hi,
   I need to add an option, HAS_TEXTCONCAT_BUG to the configure script 
to check for a bug in libxml.  What file(s) do I have to change?

The file attached is an example to test for this issue. (returns -1 if 
the error exists)

Best Regards
  Alistair Leslie-Hughes
-------------- next part --------------
A non-text attachment was scrubbed...
Name: sampleXML.c
Type: text/x-csrc
Size: 307 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080416/5263d11b/attachment.c 

From wjsqudtlr at gmail.com  Wed Apr 16 01:45:50 2008
From: wjsqudtlr at gmail.com (ByeongSik Jeon)
Date: Wed, 16 Apr 2008 15:45:50 +0900
Subject: IMM / IME work
In-Reply-To: <48049E99.7060205@codeweavers.com>
References: <48049E99.7060205@codeweavers.com>
Message-ID: <1208328350.2682.16.camel@localhost>

Aric Stewart wrote:
>   I have tested with windows ATOK20 (a popular Japanese IME) and 
> successfully had text processing in a fully IME aware application.
Great!!!!

I have tested with "MS IME 2002(imekr61.ime)", "MS IME
2003(imekr70.ime)", and "Saenaru(saenaru.ime)" [1].
These all are works with next two patches.

Default conversion mode toggle key of Korean IME is Hangul( == XK_Hangul
== VK_Hangul). 

Regards...

Thanks.
----
[1] Saenaru, Korean Free IME, http://kldp.net/projects/saenaru/
    http://kldp.net/frs/download.php/4353/Saenaru-1.0.1.exe

    INSTALL & SETUP
    $ wine Saenaru-1.0.1.exe
    $ regedit wine_saenaru.reg

    Conversion mode toggle key: Shift+Space(by wine_saenaru.reg) or
Hangul(default)

-------------- next part --------------
REGEDIT4

[HKEY_LOCAL_MACHINE\Software\OpenHangulProject]

[HKEY_LOCAL_MACHINE\Software\OpenHangulProject\Saenaru]
@="C:\\WINDOWS\\IME\\Saenaru"
"LayoutFlag"=dword:00000001
"OptionFlag"=dword:00000080
"StatusPos"=dword:00000000

[HKEY_LOCAL_MACHINE\Software\OpenHangulProject\Saenaru\Dictionary]
@="nabi.dic"
"HanjaIndex"="jinsuk.dic"
"Symbol"="symwin.dic"
"Word"="word.dic"

[HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Keyboard Layouts\E0010412]
"IME file"="SAENARU.IME"

[HKEY_CURRENT_USER\Software\Wine\X11 Driver]
"UseXIM"="N"

From developers at tefnet.pl  Wed Apr 16 02:16:52 2008
From: developers at tefnet.pl (Tomasz Jezierski - Tefnet)
Date: Wed, 16 Apr 2008 09:16:52 +0200
Subject: hhctrl.ocx: Parse HTML entities in the table of contents.
In-Reply-To: <326392.29812.qm@web23106.mail.ird.yahoo.com>
References: <1208267950.25171.5.camel@tefdemo>
	<326392.29812.qm@web23106.mail.ird.yahoo.com>
Message-ID: <1208330212.19262.7.camel@tefdemo>


Dnia 16-04-2008, ?ro o godzinie 00:49 +0000, Hin-Tak Leung pisze:
> 
> 
> --- On Tue, 15/4/08, Tomasz Jezierski - Tefnet <developers at tefnet.pl> wrote:
> <snipped>
> > While reading this patch I found another bug:
> > 
> > +            if (i ==
> > sizeof(char_refs)/sizeof(char_refs[0]))
> > +            {
> > +                FIXME("character entity %s not
> > found\n",
> > debugstr_wn(start + 1, p - start - 1));
> > +                continue;
> > +            }
> > 
> > I think *start should be changed to another char in that
> > case, because
> > if we will not change it, we will fall into infinite loop
> > like it
> > happens with help file in GPSTRACK from bug #6801.
> 
> I have experience the infinite loop myself, but I haven't quite checked
> where it is - it happens if the table is incomplete and the code
> encounters an html entity that's not mentioned in the table. I encountered it when I tried to view some help pages containing german &umlaute; 's
> in another help file I happened to have around.
> (gpstrack is about french accented characters.)
> 
If you won't find entity in table and change ampersand to another char,
you won't get infinite loop, but I'm not sure what will happen if you
have &amp; in help, that might trigger loop too. Do you know any free
software in which I can craft such chm files?






From astrand at cendio.se  Wed Apr 16 07:04:40 2008
From: astrand at cendio.se (=?UTF-8?Q?Peter_=C3=85strand?=)
Date: Wed, 16 Apr 2008 14:04:40 +0200 (CEST)
Subject: Strange waveOutGetDevCaps calls in winmm/tests/wave.c
Message-ID: <Pine.LNX.4.64.0804161351210.19758@maggie.lkpg.cendio.se>


winmm/tests/wave.c currently contains:

    rc=waveOutGetDevCapsA(device,&capsA,4);
    ok(rc==MMSYSERR_NOERROR,
       "waveOutGetDevCapsA(%s): MMSYSERR_NOERROR expected, got %s\n",
       dev_name(device),wave_out_error(rc));

    rc=waveOutGetDevCapsW(device,&capsW,4);
    ok(rc==MMSYSERR_NOERROR || rc==MMSYSERR_NOTSUPPORTED,
       "waveOutGetDevCapsW(%s): MMSYSERR_NOERROR or MMSYSERR_NOTSUPPORTED "
       "expected, got %s\n",dev_name(device),wave_out_error(rc));

This seems wrong to me; the last argument should be the size of the
WAVEOUTCAPS structure, and there are no such structures that have size 4. 

The CapsW test fails with our sound driver (tlsnd) as well as Microsofts 
Terminal Services driver (rdpsnd).

The CapsA test doesn't fail, probably since winmm wraps CapsA calls with 
CapsW calls and then does memcpy. In either case, calling 
waveOutGetDevCaps sith size=4 is not valid, as far as I can tell. 
Theoretically, it might be in the future, though, if some small caps 
structure is invented. I suggest that these tests are removed altogether:

--- wave.c      29 Feb 2008 12:18:36 -0000      1.67
+++ wave.c      16 Apr 2008 12:03:44 -0000
@@ -853,16 +853,6 @@
        "expected, got %s\n",dev_name(device),wave_out_error(rc));
     }

-    rc=waveOutGetDevCapsA(device,&capsA,4);
-    ok(rc==MMSYSERR_NOERROR,
-       "waveOutGetDevCapsA(%s): MMSYSERR_NOERROR expected, got %s\n",
-       dev_name(device),wave_out_error(rc));
-
-    rc=waveOutGetDevCapsW(device,&capsW,4);
-    ok(rc==MMSYSERR_NOERROR || rc==MMSYSERR_NOTSUPPORTED,
-       "waveOutGetDevCapsW(%s): MMSYSERR_NOERROR or MMSYSERR_NOTSUPPORTED 
"
-       "expected, got %s\n",dev_name(device),wave_out_error(rc));
-
     nameA=NULL;
     rc=waveOutMessage((HWAVEOUT)device, DRV_QUERYDEVICEINTERFACESIZE,
                       (DWORD_PTR)&size, 0);

Regards, 
---
Peter ?strand		ThinLinc Chief Developer
Cendio AB		http://www.cendio.se
Wallenbergs gata 4
583 30 Link?ping	Phone: +46-13-21 46 00

From kornelpal at gmail.com  Wed Apr 16 07:15:13 2008
From: kornelpal at gmail.com (=?ISO-8859-1?B?S29ybulsIFDhbA==?=)
Date: Wed, 16 Apr 2008 14:15:13 +0200
Subject: Including Mono within a Wine package - should Wine expect this?
References: <a71bd89a0804100645y2b7f9c94n719ab5f19374db04@mail.gmail.com><47FECF9E.1030309@open-vote.org><a71bd89a0804101954w31a24e2fn72c027796b771a6e@mail.gmail.com><47FF506D.4010102@open-vote.org>
	<20080411125059.293230@gmx.net><19e31a080804131011s11342880qd0ee9d2981a1c9be@mail.gmail.com><a71bd89a0804131228w188ecd20r9802c35198b25764@mail.gmail.com><20080414061400.39750@gmx.net>
	<a71bd89a0804140809s1d1af678uf5a6170ab5a1ae97@mail.gmail.com>
Message-ID: <002c01c89fbb$875c8f30$4e42ee55@kornelpal.hu>

Hi,

I am almost complete with implementing mixed-mode support for Mono only some 
code cleanup is remaining. Note that however this still will not support 
MSVCRT becuase that assumes that is running on .NET Framework. Also note 
that applications using unmanaged API (COM interfaces and DLL exports) of 
.NET Framework will not be compatible with Mono because those APIs are not 
implemented by Mono.

If my patch will be accepted you will see the changes in SVN trunk of Mono.

> From: "Dan Kegel" <dank at kegel.com>
>> On Sun, Apr 13, 2008 at 11:14 PM, Roderick Colenbrander
>> <thunderbird2k at gmx.net> wrote:
>>>  What we really need is mono's windows.forms to be layered on top of 
>>> gdi32 and user32 for windows controls like buttons, textboxes and so on 
>>> .. As lots of programs do overrides using native dlls on them, so that's 
>>> why it should be real windows controls with a wndproc.
>>>
>>>  Ironically the current situation is for a part our own issue. Years ago 
>>> Mono's windows.forms used winelib. They moved to a managed 
>>> implementation because they had wine integration issues and we weren't 
>>> that cooperative. Further they didn't like the 2d performance much 
>>> (likely due to the lack of a dib engine ..). They might be reluctant to 
>>> Wine.
>>
>> Yup.  We have to really get our act together, then undoing the fork
>> might make sense.

Undoing the fork is not that easy because the current System.Windows.Forms 
uses it's own rendering engine and low level parts have been completely 
rewritten to support platform independent rendering and message processing. 
It supports low level WndProc functionality but I don't know how much is it 
compatible with Microsoft's implementation.

Korn?l 



From aric at codeweavers.com  Wed Apr 16 07:20:33 2008
From: aric at codeweavers.com (Aric Stewart)
Date: Wed, 16 Apr 2008 07:20:33 -0500
Subject: IMM / IME work
In-Reply-To: <1208328350.2682.16.camel@localhost>
References: <48049E99.7060205@codeweavers.com>
	<1208328350.2682.16.camel@localhost>
Message-ID: <4805EF11.7070004@codeweavers.com>

Wonderful!

I am glad you have this working for you as well.
I think this will make it much easier to test and greatly improve our 
IME support in WINE.

-aric

ByeongSik Jeon wrote:
> Aric Stewart wrote:
>>   I have tested with windows ATOK20 (a popular Japanese IME) and 
>> successfully had text processing in a fully IME aware application.
> Great!!!!
> 
> I have tested with "MS IME 2002(imekr61.ime)", "MS IME
> 2003(imekr70.ime)", and "Saenaru(saenaru.ime)" [1].
> These all are works with next two patches.
> 
> Default conversion mode toggle key of Korean IME is Hangul( == XK_Hangul
> == VK_Hangul). 
> 
> Regards...
> 
> Thanks.
> ----
> [1] Saenaru, Korean Free IME, http://kldp.net/projects/saenaru/
>     http://kldp.net/frs/download.php/4353/Saenaru-1.0.1.exe
> 
>     INSTALL & SETUP
>     $ wine Saenaru-1.0.1.exe
>     $ regedit wine_saenaru.reg
> 
>     Conversion mode toggle key: Shift+Space(by wine_saenaru.reg) or
> Hangul(default)
> 
> 


From julliard at winehq.org  Wed Apr 16 07:41:13 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 16 Apr 2008 14:41:13 +0200
Subject: [PATCH] [WinHelp]: fix regression introduced by Dmitry's Win64
	warning fixes
In-Reply-To: <20080414185700.22586.58253.stgit@localhost> (Eric Pouech's
	message of "Mon, 14 Apr 2008 20:57:01 +0200")
References: <20080414185700.22586.58253.stgit@localhost>
Message-ID: <87wsmykm52.fsf@wine.dyndns.org>

Eric Pouech <eric.pouech at orange.fr> writes:

> index 8181469..bf942a4 100644
> --- a/programs/winhelp/hlpfile.c
> +++ b/programs/winhelp/hlpfile.c
> @@ -158,8 +158,8 @@ HLPFILE_PAGE *HLPFILE_PageByOffset(HLPFILE* hlpfile, LONG offset)
>  static int comp_PageByHash(void *p, const void *key,
>                             int leaf, void** next)
>  {
> -    ULONG_PTR lKey = (LONG_PTR)key;
> -    ULONG_PTR lTest = GET_UINT(p, 0);
> +    LONG_PTR lKey = (LONG_PTR)key;
> +    LONG_PTR lTest = GET_UINT(p, 0);

This won't work on 64-bit. If the hash really needs to be signed (why?)
you need some extra casts.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Wed Apr 16 07:44:39 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 16 Apr 2008 14:44:39 +0200
Subject: [Fwd: Bug#476232: winebuild fails to build for powerpc]
In-Reply-To: <48048451.6040402@arcticnet.no> (Ove Kaaven's message of "Tue, 15
	Apr 2008 12:32:49 +0200")
References: <48048451.6040402@arcticnet.no>
Message-ID: <87skxmklzc.fsf@wine.dyndns.org>

Ove Kaaven <ovek at arcticnet.no> writes:

> @@ -368,7 +368,7 @@ void BuildSpec32File( DLLSPEC *spec )
>      else
>      {
>          output( "\n\t.section \".init\",\"ax\"\n" );
> -        output( "\tjmp 1f\n" );
> +        output( "\t%s 1f\n", get_asm_branch_mnemonic() );
>          output( "__wine_spec_pe_header:\n" );
>          output( "\t.skip %u\n", 65536 + page_size );
>          output( "1:\n" );

I don't think it makes sense to add functions that return specific asm
mnemonics, there's no guarantee that all platforms would use a single
jump instruction here. You should add a switch the way it is done for
instance in output_asm_constructor().

-- 
Alexandre Julliard
julliard at winehq.org


From scott at open-vote.org  Wed Apr 16 08:52:49 2008
From: scott at open-vote.org (Scott Ritchie)
Date: Wed, 16 Apr 2008 06:52:49 -0700
Subject: Including Mono within a Wine package - should Wine expect this?
In-Reply-To: <48049192.4090906@arcticnet.no>
References: <a71bd89a0804100645y2b7f9c94n719ab5f19374db04@mail.gmail.com>
	<47FECF9E.1030309@open-vote.org> <48049192.4090906@arcticnet.no>
Message-ID: <480604B1.4090105@open-vote.org>

Ove Kaaven wrote:
> Debian's ia32-libs package isn't an example of a whole lot. It grabs
> compiled binaries from the official Debian archive, and nowhere else. It
> isn't built on a 32-bit system. If ia32-libs had contained binaries that
> could not be built 100% automatically using Debian's official archive
> (and only the official archive), it probably wouldn't have gotten into
> Debian. Besides, ia32-libs is not meant to be a long-lived package,
> it'll go away eventually.
> 

We've been saying that for 3 years now, and we've only become MORE
dependent on ia32-libs in the process.  The chief culprit, of course, is
Wine, and Wine's need to run 32 bit applications isn't going away soon.

Really, what Debian (and Ubuntu) need is to replace the contents of the
ia32-libs package with proper 32 versions of package (sorta like how
lib32asound and lib32z1 are now).  Fixing that, however, is a bit beyond
the scope of the wine-devel list ;)

Thanks,
Scott Ritchie


From rob at codeweavers.com  Wed Apr 16 09:21:19 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Wed, 16 Apr 2008 15:21:19 +0100
Subject: Help with configure option
In-Reply-To: <4805A1C6.1060107@hotmail.com>
References: <4805A1C6.1060107@hotmail.com>
Message-ID: <48060B5F.9050403@codeweavers.com>

Alistair Leslie-Hughes wrote:
>   I need to add an option, HAS_TEXTCONCAT_BUG to the configure script 
> to check for a bug in libxml.  What file(s) do I have to change?
>
> The file attached is an example to test for this issue. (returns -1 if 
> the error exists)

The trouble is that because msxml3 links to a shared library, the 
library that the configure check is done against isn't necessarily the 
version that is used at runtime. (Think .debs for multiple distros and 
versions of those distros.)

Therefore, you may have to do the check at runtime. Where that check is 
implemented depends on what you need to do when you discover the buggy 
version is in use.

-- 
Rob Shearman



From rhysmcguckin at yahoo.com.au  Wed Apr 16 09:43:13 2008
From: rhysmcguckin at yahoo.com.au (Rhys McGuckin)
Date: Thu, 17 Apr 2008 00:43:13 +1000 (EST)
Subject: .NET 2.0 problematic DLL loading.
Message-ID: <701826.48135.qm@web90304.mail.mud.yahoo.com>

In reference to bug #11973, I've the following observation.

Using the native .NET 2.0 installed via winetricks, I located what is potentially a problem with the method that .NET is using to locate the DLLs that it wishes to load.

The problem seems to be that .NET is attempting to locate the various DLL's it is going to use, by searching various directory paths. Once this does not occur (by placing a native DLL into the windows/system32 path) it causing a crash further down. It doesn't seem to utilize the LoadLibrary initially to locate but another function (from memory I think it NtCreateFile). With the native DLL in place it starts to process properly, at least until it runs into other files not located (as stated above).

I believe that .NET 2.0 is assuming that the files are located within the directory path (this may be so that it can independently utilize application supplied DLL files - I read that WinXP supposedly uses this policy to reduce problems with DLL dependencies).
This of course, totally by-passes the built-in DLL files (which should be located using this method, except that they do not exist in the paths .NET searches).

There are two possible ways currently that I can think of, which would potentially solve this problem:
1. Have symbolic links within the system directory (I find this to be bad method, for multiple reasons)
2. Have some interception of the searching for files located within the system32, to include all of built-in dlls.

Unfortunately, since I don't know a huge amount about Wine yet, I have no idea on how to code the second one, and I think having a patch for this, may solve quite a few problems that currently exist with using .NET based programs.


       
---------------------------------
Get the name you always wanted with the new y7mail email address.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080417/03744c8e/attachment.htm 

From juan.lang at gmail.com  Wed Apr 16 09:44:13 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Wed, 16 Apr 2008 07:44:13 -0700
Subject: Strange waveOutGetDevCaps calls in winmm/tests/wave.c
In-Reply-To: <Pine.LNX.4.64.0804161351210.19758@maggie.lkpg.cendio.se>
References: <Pine.LNX.4.64.0804161351210.19758@maggie.lkpg.cendio.se>
Message-ID: <3a768c550804160744r285ab6a0j1a02b7892841e661@mail.gmail.com>

>  The CapsA test doesn't fail, probably since winmm wraps CapsA calls with
>  CapsW calls and then does memcpy. In either case, calling
>  waveOutGetDevCaps sith size=4 is not valid, as far as I can tell.
>  Theoretically, it might be in the future, though, if some small caps
>  structure is invented. I suggest that these tests are removed altogether:

Sounds reasonable to me; please send to wine-patches.
--Juan


From stefandoesinger at gmx.at  Wed Apr 16 10:17:15 2008
From: stefandoesinger at gmx.at (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Wed, 16 Apr 2008 17:17:15 +0200
Subject: .NET 2.0 problematic DLL loading.
In-Reply-To: <701826.48135.qm@web90304.mail.mud.yahoo.com>
References: <701826.48135.qm@web90304.mail.mud.yahoo.com>
Message-ID: <200804161717.16099.stefandoesinger@gmx.at>

Am Mittwoch, 16. April 2008 16:43:13 schrieb Rhys McGuckin:
> There are two possible ways currently that I can think of, which would
> potentially solve this problem: 1. Have symbolic links within the system
> directory (I find this to be bad method, for multiple reasons) 2. Have some
> interception of the searching for files located within the system32, to
> include all of built-in dlls.
Many applications behave that way, and we create fake .DLL files in system32. 
They are real PE files from their file header, but they do not contain the 
implementation. When an app tries to LoadLibrary this DLL we load the builtin 
one instead

So we just have to add the needed DLLs to the fake DLL list. We don't add one 
there without an application requiring it, because it makes it harder to 
install MS library packages. E.g. the IE6 installer fails unless the user 
deletes a bunch of those faked DLLs first


From Petr.Sumbera at Sun.COM  Wed Apr 16 10:41:27 2008
From: Petr.Sumbera at Sun.COM (Petr Sumbera)
Date: Wed, 16 Apr 2008 17:41:27 +0200
Subject: Trouble in compiling Wine 0.9.57 and 0.9.58 on Solaris 10 08/07
In-Reply-To: <200804132308.19873.stefan@codeweavers.com>
References: <47FF74FD.4060307@sun.com> <00a101c89da4$e7f77210$4001a8c0@NATERS>
	<200804132308.19873.stefan@codeweavers.com>
Message-ID: <48061E27.3070509@sun.com>

Stefan D?singer wrote:
> Am Sonntag, 13. April 2008 22:28:16 schrieb Rolf Kalbermatter:
>> Following link might give some details about Sun Solaris support of
>> infinintes
>> and also ideas how to solve that problem.
> Yes, that would work. Any build system guru who could implement that? I think 
> it is not a good idea to put that into wined3d

Well, we have only one isinf call in Wine so I think it isn't worst of 
creating Wine special isinf implementation. Instead I propose emulate 
isinf via finite() and isnand() (both coming from ieeefp.h).

Petr
-------------- next part --------------
A non-text attachment was scrubbed...
Name: isinf.diff
Type: text/x-patch
Size: 6091 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080416/ac058cec/attachment.bin 

From sh at sourcecode.de  Wed Apr 16 10:50:22 2008
From: sh at sourcecode.de (Stephan Hermann)
Date: Wed, 16 Apr 2008 17:50:22 +0200
Subject: Including Mono within a Wine package - should Wine expect this?
In-Reply-To: <480604B1.4090105@open-vote.org>
References: <a71bd89a0804100645y2b7f9c94n719ab5f19374db04@mail.gmail.com>
	<47FECF9E.1030309@open-vote.org> <48049192.4090906@arcticnet.no>
	<480604B1.4090105@open-vote.org>
Message-ID: <20080416175022.078a5b04@wz-pc-006.intern.netviewer.de>

On Wed, 16 Apr 2008 06:52:49 -0700
Scott Ritchie <scott at open-vote.org> wrote:

> Ove Kaaven wrote:
> > Debian's ia32-libs package isn't an example of a whole lot. It grabs
> > compiled binaries from the official Debian archive, and nowhere
> > else. It isn't built on a 32-bit system. If ia32-libs had contained
> > binaries that could not be built 100% automatically using Debian's
> > official archive (and only the official archive), it probably
> > wouldn't have gotten into Debian. Besides, ia32-libs is not meant
> > to be a long-lived package, it'll go away eventually.
> > 
> 
> We've been saying that for 3 years now, and we've only become MORE
> dependent on ia32-libs in the process.  The chief culprit, of course,
> is Wine, and Wine's need to run 32 bit applications isn't going away
> soon.
> 
> Really, what Debian (and Ubuntu) need is to replace the contents of
> the ia32-libs package with proper 32 versions of package (sorta like
> how lib32asound and lib32z1 are now).  Fixing that, however, is a bit
> beyond the scope of the wine-devel list ;)

The real problem with multi-arch libs is, that it's hard to maintain
inside debian packages at all...not that it's difficult to compile on
amd64 with -m32 , but regarding the different ways of debian/rules
writing with all different maintainer ways to write Makefiles for
accomplishing this tasks is the most difficult thing.

When there are people interested in going a hard way of fixing todays
situation in debian/ubuntu and other distris, please let's do it
, sane and with a plan.

Regards,
\sh
  


From bsjeon at hanmail.net  Wed Apr 16 01:55:25 2008
From: bsjeon at hanmail.net (ByeongSik Jeon)
Date: Wed, 16 Apr 2008 15:55:25 +0900
Subject: imm32: Implement the ImmSetConversionStatus.
Message-ID: <1208328925.2682.29.camel@localhost>

Tested with "MS IME 2002(imekr61.ime)", "MS IME
2003(imekr70.ime)", and "Saenaru(saenaru.ime, Korean Free IME)".

---
 dlls/imm32/imm.c |   29 ++++++++++++++++++++---------
 1 files changed, 20 insertions(+), 9 deletions(-)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 65e86a8886f5840a7dfb7600d5b2850832189abb.diff
Type: text/x-patch
Size: 1237 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080416/6ba47a50/attachment-0001.bin 

From ovek at arcticnet.no  Wed Apr 16 11:20:38 2008
From: ovek at arcticnet.no (Ove Kaaven)
Date: Wed, 16 Apr 2008 18:20:38 +0200
Subject: Including Mono within a Wine package - should Wine expect this?
In-Reply-To: <20080416175022.078a5b04@wz-pc-006.intern.netviewer.de>
References: <a71bd89a0804100645y2b7f9c94n719ab5f19374db04@mail.gmail.com>	<47FECF9E.1030309@open-vote.org>
	<48049192.4090906@arcticnet.no>	<480604B1.4090105@open-vote.org>
	<20080416175022.078a5b04@wz-pc-006.intern.netviewer.de>
Message-ID: <48062756.7070307@arcticnet.no>

Stephan Hermann skrev:
> When there are people interested in going a hard way of fixing todays
> situation in debian/ubuntu and other distris, please let's do it
> , sane and with a plan.

There's already work going on to try to get a better solution into 
Debian lenny. There's a new "ia32-libs-tools" package about to enter 
Debian unstable, which would make it possible to replace the big 
ia32-libs package with more fine-grained individual ia32-lib* packages. 
(It may not be true multiarch, but still a lot better than the current 
situation.)




From rhysmcguckin at yahoo.com.au  Wed Apr 16 11:31:35 2008
From: rhysmcguckin at yahoo.com.au (Rhys McGuckin)
Date: Thu, 17 Apr 2008 02:31:35 +1000 (EST)
Subject: .NET 2.0 problematic DLL loading.
In-Reply-To: <200804161717.16099.stefandoesinger@gmx.at>
Message-ID: <853444.79694.qm@web90301.mail.mud.yahoo.com>



Stefan D?singer <stefandoesinger at gmx.at> wrote:Many applications behave that way, and we create fake .DLL files in system32. 
They are real PE files from their file header, but they do not contain the 
implementation. When an app tries to LoadLibrary this DLL we load the builtin 
one instead

So we just have to add the needed DLLs to the fake DLL list. We don't add one 
there without an application requiring it, because it makes it harder to 
install MS library packages. E.g. the IE6 installer fails unless the user 
deletes a bunch of those faked DLLs first
The other problem was that it also failed attempting to find l_intl.nls. 
And is this list of fake DLLs application specific? 
Since I'm not sure what dlls all .NET 2.0 applications are going to try to search for, would we add all the DLLs that are central to windows?
The program that I am using that relies on .NET requires (imm32, lz32, iphlpapi, & l_intl.nls), before it runs into an unimplemented RAS function.



       
---------------------------------
Get the name you always wanted with the new y7mail email address.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080417/47c3d564/attachment.htm 

From truiken at gmail.com  Wed Apr 16 11:45:32 2008
From: truiken at gmail.com (James Hawkins)
Date: Wed, 16 Apr 2008 11:45:32 -0500
Subject: dlls/fusion/assembly.c -- no-op error checks
In-Reply-To: <alpine.LSU.1.10.0804161624400.6827@acrux.dbai.tuwien.ac.at>
References: <alpine.LSU.1.10.0804161624400.6827@acrux.dbai.tuwien.ac.at>
Message-ID: <22821af30804160945v2facb0efh61bcb5c81447efe3@mail.gmail.com>

On Wed, Apr 16, 2008 at 9:28 AM, Gerald Pfeifer <gerald at pfeifer.com> wrote:
> Both offset and tables[].offset are of unsigned types, so these two
>  checks for errors will never trigger.
>

The offsets are explicity set to -1 on line 242, so the check needs to
be for -1.  It won't work at all otherwise.

-- 
James Hawkins


From meissner at suse.de  Wed Apr 16 11:51:12 2008
From: meissner at suse.de (Marcus Meissner)
Date: Wed, 16 Apr 2008 18:51:12 +0200
Subject: fusion: Explicitly check for -1 for a missing table
In-Reply-To: <22821af30804160948u374eb9b6vb559827104802d3f@mail.gmail.com>
References: <22821af30804160948u374eb9b6vb559827104802d3f@mail.gmail.com>
Message-ID: <20080416165112.GA14495@suse.de>

On Wed, Apr 16, 2008 at 11:48:31AM -0500, James Hawkins wrote:
> Hi,
> 
> Changelog:
> * Explicitly check for -1 for a missing table.
> 
>  dlls/fusion/assembly.c |    4 ++--
>  1 files changed, 2 insertions(+), 2 deletions(-)
> 
> -- 
> James Hawkins

> diff --git a/dlls/fusion/assembly.c b/dlls/fusion/assembly.c
> index 024e611..eee889a 100644
> --- a/dlls/fusion/assembly.c
> +++ b/dlls/fusion/assembly.c
> @@ -416,7 +416,7 @@ HRESULT assembly_get_name(ASSEMBLY *assembly, LPSTR *name)
>      ULONG offset;
>  
>      offset = assembly->tables[0x20].offset; /* FIXME: add constants */
> -    if (offset < 0)
> +    if (offset == -1)
>          return E_FAIL;
>  
>      asmtbl = (ASSEMBLYTABLE *)assembly_data_offset(assembly, offset);
> @@ -527,7 +527,7 @@ HRESULT assembly_get_pubkey_token(ASSEMBLY *assembly, LPSTR *token)
>      *token = NULL;
>  
>      offset = assembly->tables[0x20].offset; /* FIXME: add constants */
> -    if (offset < 0)
> +    if (offset == -1)
>          return E_FAIL;

You should make offset "signed", or pass errors down in another way.
This will not work this way.

Ciao, Marcus


From truiken at gmail.com  Wed Apr 16 12:08:05 2008
From: truiken at gmail.com (James Hawkins)
Date: Wed, 16 Apr 2008 12:08:05 -0500
Subject: fusion: Explicitly check for -1 for a missing table
In-Reply-To: <20080416165112.GA14495@suse.de>
References: <22821af30804160948u374eb9b6vb559827104802d3f@mail.gmail.com>
	<20080416165112.GA14495@suse.de>
Message-ID: <22821af30804161008y2a4d93d3mf60fb88ed909503f@mail.gmail.com>

On Wed, Apr 16, 2008 at 11:51 AM, Marcus Meissner <meissner at suse.de> wrote:
>
> On Wed, Apr 16, 2008 at 11:48:31AM -0500, James Hawkins wrote:
>  > Hi,
>  >
>  > Changelog:
>  > * Explicitly check for -1 for a missing table.
>  >
>  >  dlls/fusion/assembly.c |    4 ++--
>  >  1 files changed, 2 insertions(+), 2 deletions(-)
>  >
>  > --
>  > James Hawkins
>
>  > diff --git a/dlls/fusion/assembly.c b/dlls/fusion/assembly.c
>  > index 024e611..eee889a 100644
>  > --- a/dlls/fusion/assembly.c
>  > +++ b/dlls/fusion/assembly.c
>  > @@ -416,7 +416,7 @@ HRESULT assembly_get_name(ASSEMBLY *assembly, LPSTR *name)
>  >      ULONG offset;
>  >
>  >      offset = assembly->tables[0x20].offset; /* FIXME: add constants */
>  > -    if (offset < 0)
>  > +    if (offset == -1)
>  >          return E_FAIL;
>  >
>  >      asmtbl = (ASSEMBLYTABLE *)assembly_data_offset(assembly, offset);
>  > @@ -527,7 +527,7 @@ HRESULT assembly_get_pubkey_token(ASSEMBLY *assembly, LPSTR *token)
>  >      *token = NULL;
>  >
>  >      offset = assembly->tables[0x20].offset; /* FIXME: add constants */
>  > -    if (offset < 0)
>  > +    if (offset == -1)
>  >          return E_FAIL;
>
>  You should make offset "signed", or pass errors down in another way.
>  This will not work this way.
>

It works just fine.  -1 is 4294967295 in ULONG (32bit), which is
exactly the same as offset on error (because we assigned it -1, but
the representation in memory is the same).  We do this several other
places in the code base.

-- 
James Hawkins


From truiken at gmail.com  Wed Apr 16 12:51:39 2008
From: truiken at gmail.com (James Hawkins)
Date: Wed, 16 Apr 2008 12:51:39 -0500
Subject: dlls/fusion/assembly.c -- no-op error checks
In-Reply-To: <alpine.LSU.1.10.0804161945300.6827@acrux.dbai.tuwien.ac.at>
References: <alpine.LSU.1.10.0804161624400.6827@acrux.dbai.tuwien.ac.at>
	<22821af30804160945v2facb0efh61bcb5c81447efe3@mail.gmail.com>
	<alpine.LSU.1.10.0804161945300.6827@acrux.dbai.tuwien.ac.at>
Message-ID: <22821af30804161051t5c731357ne65d475c44ef5736@mail.gmail.com>

On Wed, Apr 16, 2008 at 12:47 PM, Gerald Pfeifer <gerald at pfeifer.com> wrote:
> On Wed, 16 Apr 2008, James Hawkins wrote:
>  > The offsets are explicity set to -1 on line 242, so the check needs to
>  > be for -1.  It won't work at all otherwise.
>
>  Thanks, James!  I was looking for this, but must have missed it somehow.
>  I'm glad I Cc:d you. :-)
>
>  Please find the real fix below.
>

Beat ya to the punch :)

http://winehq.org/pipermail/wine-patches/2008-April/053446.html

-- 
James Hawkins


From rob at codeweavers.com  Wed Apr 16 13:09:10 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Wed, 16 Apr 2008 19:09:10 +0100
Subject: fusion: Explicitly check for -1 for a missing table
In-Reply-To: <22821af30804161008y2a4d93d3mf60fb88ed909503f@mail.gmail.com>
References: <22821af30804160948u374eb9b6vb559827104802d3f@mail.gmail.com>	<20080416165112.GA14495@suse.de>
	<22821af30804161008y2a4d93d3mf60fb88ed909503f@mail.gmail.com>
Message-ID: <480640C6.9080604@codeweavers.com>

James Hawkins wrote:
> It works just fine.  -1 is 4294967295 in ULONG (32bit), which is
> exactly the same as offset on error (because we assigned it -1, but
> the representation in memory is the same).

Then use ~0 so that the purpose is clearer. Adding a define for this 
value would probably further increase readability of the code.

> We do this several other
> places in the code base.

They should be changed too.

-- 
Rob Shearman



From gerald at pfeifer.com  Wed Apr 16 12:59:50 2008
From: gerald at pfeifer.com (Gerald Pfeifer)
Date: Wed, 16 Apr 2008 19:59:50 +0200 (CEST)
Subject: dlls/fusion/assembly.c -- no-op error checks
In-Reply-To: <22821af30804161051t5c731357ne65d475c44ef5736@mail.gmail.com>
References: <alpine.LSU.1.10.0804161624400.6827@acrux.dbai.tuwien.ac.at>
	<22821af30804160945v2facb0efh61bcb5c81447efe3@mail.gmail.com>
	<alpine.LSU.1.10.0804161945300.6827@acrux.dbai.tuwien.ac.at>
	<22821af30804161051t5c731357ne65d475c44ef5736@mail.gmail.com>
Message-ID: <alpine.LSU.1.10.0804161959180.6827@acrux.dbai.tuwien.ac.at>

On Wed, 16 Apr 2008, James Hawkins wrote:
> Beat ya to the punch :)

Better twice than not at all, to paraphrase a German saying. :-)

Gerald


From leslie_alistair at hotmail.com  Wed Apr 16 15:30:38 2008
From: leslie_alistair at hotmail.com (Alistair Leslie-Hughes)
Date: Thu, 17 Apr 2008 06:30:38 +1000
Subject: msxml3: Implement transformNode (try 3)
References: <ftvcka$qrg$1@ger.gmane.org>
Message-ID: <fu5nn3$3vc$1@ger.gmane.org>

"Alistair Leslie-Hughes" <leslie_alistair at hotmail.com> wrote in message 
news:ftvcka$qrg$1 at ger.gmane.org...
> Hi,
> Corrected issue with tests
>
> Changelog:
> msxml3: Implement transformNode
>
> Best Regards
>  Alistair Leslie-Hughes
>
Anything wrong with this patch?

Best Regards
 Alistair Leslie-Hughes 




From khodych at gmail.com  Wed Apr 16 16:47:05 2008
From: khodych at gmail.com (Sergey Khodych)
Date: Thu, 17 Apr 2008 00:47:05 +0300
Subject: dinput: Implement DIPROP_KEYNAME property for keyboard device
In-Reply-To: <48058D65.5000007@kievinfo.com>
References: <48023854.9020308@gmail.com>	<48024DC2.3020008@kievinfo.com>	<4803AB6A.3040900@gmail.com>	<48040DA6.6090708@kievinfo.com>	<48052550.4070504@gmail.com>
	<48058D65.5000007@kievinfo.com>
Message-ID: <480673D9.40609@gmail.com>

> No, there are 2 separate implementations - one ascii another unicode. During 
> the object creation one would specify either ascii or unicode RIID.

Objects IDirectInputDevice8W and IDirectInputDevice8A has function
GetProperty. This function get struct of type DIPROPSTRING as
input/output parameter in our case . This struct has output field wsz of
type WCHAR[ MAX_PATH ] and other input fields not depends of charset.
So type of returned data will be WCHAR[ MAX_PATH ] in both case.
So objects IDirectInputDevice8W and IDirectInputDevice8A has the same
implementation of function GetProperty and this implementation is for
Unicode in both case.




From wine-devel at kievinfo.com  Wed Apr 16 21:22:02 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Wed, 16 Apr 2008 20:22:02 -0600
Subject: dinput/tests: Add test to show dinput does not use user defined
	data   format for keyboard.
In-Reply-To: <48067251.5070202@gmail.com>
References: <48067251.5070202@gmail.com>
Message-ID: <4806B44A.8070708@kievinfo.com>

Sergey Khodych wrote:
> 
> +    hr = IDirectInputDevice_GetDeviceState(pKeyboard, sizeof(custom_state), custom_state);
> +    ok(SUCCEEDED(hr), "IDirectInputDevice_GetDeviceState(4,) failed: %s\n", DXGetErrorString8(hr));
> +    hr = IDirectInputDevice_GetDeviceState(pKeyboard, sizeof(kbd_state), kbd_state);
> +    ok(hr == DIERR_INVALIDPARAM, "IDirectInputDevice_GetDeviceState(256,) should have failed: %s\n", DXGetErrorString8(hr));

When you add tests that fail on Wine, you need to add todo_wine at front of 
them so "make test" will still succeed.

Vitaliy.


From wine-devel at kievinfo.com  Wed Apr 16 21:31:45 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Wed, 16 Apr 2008 20:31:45 -0600
Subject: dinput: Implement DIPROP_KEYNAME property for keyboard device
In-Reply-To: <480673D9.40609@gmail.com>
References: <48023854.9020308@gmail.com>	<48024DC2.3020008@kievinfo.com>	<4803AB6A.3040900@gmail.com>	<48040DA6.6090708@kievinfo.com>	<48052550.4070504@gmail.com>	<48058D65.5000007@kievinfo.com>
	<480673D9.40609@gmail.com>
Message-ID: <4806B691.3080205@kievinfo.com>

Sergey Khodych wrote:
>> No, there are 2 separate implementations - one ascii another unicode. During 
>> the object creation one would specify either ascii or unicode RIID.
> 
> Objects IDirectInputDevice8W and IDirectInputDevice8A has function
> GetProperty. This function get struct of type DIPROPSTRING as
> input/output parameter in our case . This struct has output field wsz of
> type WCHAR[ MAX_PATH ] and other input fields not depends of charset.
> So type of returned data will be WCHAR[ MAX_PATH ] in both case.
> So objects IDirectInputDevice8W and IDirectInputDevice8A has the same
> implementation of function GetProperty and this implementation is for
> Unicode in both case.
> 
> 
I'd like to see a test for this. So far I have not seen a case when ascii 
and unicode COM objects return the same exact unicode structure with unicode 
text. And we also seen number of cases when even SDK was wrong. Not even 
talking about MSDN.

Vitaliy


From eric.pouech at gmail.com  Thu Apr 17 00:54:40 2008
From: eric.pouech at gmail.com (Eric Pouech)
Date: Thu, 17 Apr 2008 07:54:40 +0200
Subject: [PATCH] [WinHelp]: fix regression introduced by Dmitry's Win64
	warning fixes
In-Reply-To: <87wsmykm52.fsf@wine.dyndns.org>
References: <20080414185700.22586.58253.stgit@localhost>
	<87wsmykm52.fsf@wine.dyndns.org>
Message-ID: <2611daec0804162254k2de2780dqdb54565165380548@mail.gmail.com>

>
>
> This won't work on 64-bit. If the hash really needs to be signed (why?)
> you need some extra casts.


signed comparison is needed below for finding the key in the btree
currently, most of the navigation in hlp files is broken because of this
patch
A+


> --
> Alexandre Julliard
> julliard at winehq.org
>
>
>


-- 
-- 
Eric Pouech
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080417/6dd16e54/attachment.htm 

From hintak_leung at yahoo.co.uk  Wed Apr 16 15:47:41 2008
From: hintak_leung at yahoo.co.uk (Hin-Tak Leung)
Date: Wed, 16 Apr 2008 20:47:41 +0000 (GMT)
Subject: hhctrl.ocx: Parse HTML entities in the table of contents.
In-Reply-To: <1208330212.19262.7.camel@tefdemo>
Message-ID: <460698.19166.qm@web23111.mail.ird.yahoo.com>


--- On Wed, 16/4/08, Tomasz Jezierski - Tefnet <developers at tefnet.pl> wrote:

<snipped>
> If you won't find entity in table and change ampersand
> to another char,
> you won't get infinite loop, but I'm not sure what
> will happen if you
> have &amp; in help, that might trigger loop too. Do you
> know any free
> software in which I can craft such chm files?

I don't know about "free", but the microsoft htmlhelp workshop is available 
for download... and you might be able to do something like that with it.

It is also a good source of information, BTW. Comes with an htmlhelp API reference. (I installed it under wine last week).

BTW, I keep forgetting - what is the policy about contributing code after
reading MSDN and official microsoft documentation available for download such as this? 

I think MSDN is okay, butactual source files (including include headers)
is not?


      ___________________________________________________________ 
Yahoo! For Good helps you make a difference  

http://uk.promotions.yahoo.com/forgood/


From julliard at winehq.org  Thu Apr 17 05:02:01 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 17 Apr 2008 12:02:01 +0200
Subject: [1/3] [try 2] setupapi: Add a test for
	SetupDiGetDeviceRegistryProperty and SetupDiSetDeviceRegistryProperty
In-Reply-To: <200804151203.08793.amorozov@etersoft.ru> (Alexander Morozov's
	message of "Tue, 15 Apr 2008 12:03:08 +0400")
References: <200804151203.08793.amorozov@etersoft.ru>
Message-ID: <87abjslrza.fsf@wine.dyndns.org>

Alexander Morozov <amorozov at etersoft.ru> writes:

> Changelog:
> Add a test for SetupDiGetDeviceRegistryProperty and 
> SetupDiSetDeviceRegistryProperty

This doesn't apply because there have been other changes in that area,
when resending a patch you need to first resync to the current tree.

-- 
Alexandre Julliard
julliard at winehq.org


From dank at kegel.com  Thu Apr 17 10:20:15 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 17 Apr 2008 08:20:15 -0700
Subject: Towards pure wine: a step by step approach
Message-ID: <a71bd89a0804170820j22f4a449h5ad00373b8b5e269@mail.gmail.com>

Errors reported by valgrind, coverity, and our conformance test suite
are all worth fixing... but fixing them *all* is like shovelling out
the dung from an infinitely large barn.  Various people have tried
fixing one kind of error or the other, but maybe a combined attack,
where we went module by module and fixed *all* of the valgrind,
coverity, and conformance test errors might be more fruitful
(or at least more satisfying).   Such an attempt should probably
start at the bottom, cleaning up modules in the order
  wineserver, ntdll, kernel32, gdi32, user32, ...

To that end, here are the combined known errors for the first few modules.

wineserver:

coverity:
cv219        FORWARD_NULL    UNINSPECTED      set_console_input_info
base/src/wine/server/console.c
cv220        FORWARD_NULL    UNINSPECTED
connect_process_winstation      base/src/wine/server/winstation.c

ntdll:

coverity:
cv48    FORWARD_NULL    UNINSPECTED      RtlAllocateHandle
base/src/wine/dlls/ntdll/handletable.c
cv55    FORWARD_NULL    UNINSPECTED        RtlCreateEnvironment
base/src/wine/dlls/ntdll/env.c
cv227   NEGATIVE_RETURNS        UNINSPECTED       read_changes_apc
   base/src/wine/dlls/ntdll/directory.c
cv248   NULL_RETURNS    UNINSPECTED       HEAP_FindFreeBlock
base/src/wine/dlls/ntdll/heap.c
cv343   REVERSE_INULL   UNINSPECTED       NtOpenSection
base/src/wine/dlls/ntdll/virtual.c
cv538   NULL_RETURNS    UNINSPECTED        HEApNtEnumerateSubKey
base/src/wine/dlls/ntdll/reg.c
cv644   REVERSE_INULL   UNINSPECTED       NtQueryInformationProcess
   base/src/wine/dlls/ntdll/process.c
cv658   FORWARD_NULL RNS        UNINSPECTED     RtlQueryRegistryValues
 base/src/wine/dlls/ntdll/reg.cdlls/ole32/ole2.c

valgrind:

http://kegel.com/wine/valgrind/logs-2008-04-10/vg-ntdll_env.txt
http://kegel.com/wine/valgrind/logs-2008-04-10/vg-ntdll_exception.txt
http://kegel.com/wine/valgrind/logs-2008-04-10/vg-ntdll_file.txt

conformance tests:
http://test.winehq.org/data/200804161000/#group_Wine:ntdll:change
http://test.winehq.org/data/200804161000/#group_XP:ntdll:exception

There, that doesn't look too awful, does it?  Only a few dozen little
problems to solve
and we'll have server and ntdll spic and span... and then on to the next module.

If we start with a small circle of pure modules, and vigorously defend
the modules
in that circle against regressions in any of valgrind, coverity, and
conformance tests,
we might make a noticable improvement in Wine's quality.
- Dan


From stephencooper96 at hotmail.com  Thu Apr 17 08:46:10 2008
From: stephencooper96 at hotmail.com (stephen cooper)
Date: Thu, 17 Apr 2008 13:46:10 +0000
Subject: installing wine into linux ubuntu
Message-ID: <BAY114-W5346A2814598953C9CA3EDB5E50@phx.gbl>


 ref. Linux Format DVD 104 April 2008From: stephen cooper (stephencooper96 at hotmail.com) 
I am new to Linux.I have just installed Linux UBUNTU 7.1 (gutsy) onto my computer with no problems. I want to install wine.I have written the source code onto my hard disc. (using tar ) When I run ./configure (.tools/wineinstall) I get an error -  C compiler cannot create executables. I am including the output from the config.log for wine installation below.  PLEASE ADVISE ME. Stephen Cooper.
This file contains any messages produced by compilers whilerunning configure, to aid debugging if configure makes a mistake.
It was created by Wine configure 0.9.54, which wasgenerated by GNU Autoconf 2.61.  Invocation command line was
  $ ./configure --verbose
## --------- #### Platform. #### --------- ##
hostname = stephen-desktopuname -m = i686uname -r = 2.6.22-14-genericuname -s = Linuxuname -v = #1 SMP Sun Oct 14 23:05:12 GMT 2007
/usr/bin/uname -p = unknown/bin/uname -X     = unknown
/bin/arch              = unknown/usr/bin/arch -k       = unknown/usr/convex/getsysinfo = unknown/usr/bin/hostinfo      = unknown/bin/machine           = unknown/usr/bin/oslevel       = unknown/bin/universe          = unknown
PATH: /usr/local/sbinPATH: /usr/local/binPATH: /usr/sbinPATH: /usr/binPATH: /sbinPATH: /binPATH: /usr/games
## ----------- #### Core tests. #### ----------- ##
configure:2100: checking build system typeconfigure:2118: result: i686-pc-linux-gnulibc1configure:2140: checking host system typeconfigure:2155: result: i686-pc-linux-gnulibc1configure:2221: checking whether make sets $(MAKE)configure:2242: result: yesconfigure:2299: checking for gccconfigure:2315: found /usr/bin/gccconfigure:2326: result: gccconfigure:2564: checking for C compiler versionconfigure:2571: gcc --version >&5gcc (GCC) 4.1.3 20070929 (prerelease) (Ubuntu 4.1.2-16ubuntu2)Copyright (C) 2006 Free Software Foundation, Inc.This is free software; see the source for copying conditions.  There is NOwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
configure:2574: $? = 0configure:2581: gcc -v >&5Using built-in specs.Target: i486-linux-gnuConfigured with: ../src/configure -v --enable-languages=c,c++,fortran,objc,obj-c++,treelang --prefix=/usr --enable-shared --with-system-zlib --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --enable-nls --with-gxx-include-dir=/usr/include/c++/4.1.3 --program-suffix=-4.1 --enable-__cxa_atexit --enable-clocale=gnu --enable-libstdcxx-debug --enable-mpfr --enable-checking=release i486-linux-gnuThread model: posixgcc version 4.1.3 20070929 (prerelease) (Ubuntu 4.1.2-16ubuntu2)configure:2584: $? = 0configure:2591: gcc -V >&5gcc: '-V' option must have argumentconfigure:2594: $? = 1configure:2617: checking for C compiler default output file nameconfigure:2644: gcc    conftest.c  >&5/usr/bin/ld: crt1.o: No such file: No such file or directorycollect2: ld returned 1 exit statusconfigure:2647: $? = 1configure:2685: result: configure: failed program was:| /* confdefs.h.  */| #define PACKAGE_NAME "Wine"| #define PACKAGE_TARNAME "wine"| #define PACKAGE_VERSION "0.9.54"| #define PACKAGE_STRING "Wine 0.9.54"| #define PACKAGE_BUGREPORT "wine-devel at winehq.org"| /* end confdefs.h.  */| | int| main ()| {| |   ;|   return 0;| }configure:2692: error: C compiler cannot create executablesSee `config.log' for more details.
## ---------------- #### Cache variables. #### ---------------- ##
ac_cv_build=i686-pc-linux-gnulibc1ac_cv_env_CCC_set=ac_cv_env_CCC_value=ac_cv_env_CC_set=ac_cv_env_CC_value=ac_cv_env_CFLAGS_set=ac_cv_env_CFLAGS_value=ac_cv_env_CPPFLAGS_set=ac_cv_env_CPPFLAGS_value=ac_cv_env_CPP_set=ac_cv_env_CPP_value=ac_cv_env_CXXFLAGS_set=ac_cv_env_CXXFLAGS_value=ac_cv_env_CXX_set=ac_cv_env_CXX_value=ac_cv_env_LDFLAGS_set=ac_cv_env_LDFLAGS_value=ac_cv_env_LIBS_set=ac_cv_env_LIBS_value=ac_cv_env_XMKMF_set=ac_cv_env_XMKMF_value=ac_cv_env_build_alias_set=ac_cv_env_build_alias_value=ac_cv_env_host_alias_set=ac_cv_env_host_alias_value=ac_cv_env_target_alias_set=ac_cv_env_target_alias_value=ac_cv_host=i686-pc-linux-gnulibc1ac_cv_prog_ac_ct_CC=gccac_cv_prog_make_make_set=yes
## ----------------- #### Output variables. #### ----------------- ##
ALSALIBS=''AR=''AS=''AUDIOIOLIBS=''BISON=''BUILTINFLAG=''CARBONLIB=''CC='gcc'CFLAGS=''COREAUDIO=''COREFOUNDATIONLIB=''CPP=''CPPBIN=''CPPFLAGS=''CROSSCC=''CROSSTEST=''CROSSWINDRES=''CRTLIBS=''CXX=''CXXFLAGS=''DEFS=''DEPENDENCIES=''DISKARBITRATIONLIB=''DLLEXT=''DLLFLAGS=''DLLTOOL=''DLLWRAP=''ECHO_C=''ECHO_N='-n'ECHO_T=''EGREP=''ESDCONFIG=''ESDINCL=''ESDLIBS=''EXEEXT=''EXTRACFLAGS=''EXTRA_BINARIES=''FLEX=''FONTCONFIGINCL=''FONTFORGE=''FONTSSUBDIRS=''FREETYPEINCL=''FREETYPELIBS=''GLU32FILES=''GPHOTO2INCL=''GPHOTO2LIBS=''GREP=''HALINCL=''IMPLIBEXT=''INSTALL_DATA=''INSTALL_PROGRAM=''INSTALL_SCRIPT=''IOKITLIB=''LCMSLIBS=''LD=''LDAPLIBS=''LDCONFIG=''LDD=''LDDLLFLAGS=''LDEXECFLAGS=''LDFLAGS=''LDPATH=''LDRPATH_INSTALL=''LDRPATH_LOCAL=''LDSHARED=''LIBDL=''LIBEXT=''LIBOBJS=''LIBPOLL=''LIBPTHREAD=''LIBS=''LINT=''LINTFLAGS=''LN=''LN_S=''LTLIBOBJS=''MAIN_BINARY=''MINGWAR=''NASLIBS=''OBJEXT=''OPENGLFILES=''OPENGL_LIBS=''PACKAGE_BUGREPORT='wine-devel at winehq.org'PACKAGE_NAME='Wine'PACKAGE_STRING='Wine 0.9.54'PACKAGE_TARNAME='wine'PACKAGE_VERSION='0.9.54'PATH_SEPARATOR=':'PKG_CONFIG=''PRELINK=''QUARTZFILES=''RANLIB=''RESOLVLIBS=''SANEINCL=''SECURITYLIB=''SET_MAKE=''SHELL='/bin/bash'SOCKETLIBS=''STRIP=''TOOLSDIR=''WIN16_FILES='$(WIN16_FILES)'WIN16_INSTALL='$(WIN16_INSTALL)'WINDRES=''XFILES=''XLIB=''XMKMF=''XML2INCL=''XML2LIBS=''XSLTINCL=''XSLTLIBS=''X_CFLAGS=''X_EXTRA_LIBS=''X_LIBS=''X_PRE_LIBS=''ac_ct_AS=''ac_ct_CC='gcc'ac_ct_CXX=''bindir='${exec_prefix}/bin'build='i686-pc-linux-gnulibc1'build_alias=''build_cpu='i686'build_os='linux-gnulibc1'build_vendor='pc'datadir='${datarootdir}'datarootdir='${prefix}/share'docdir='${datarootdir}/doc/${PACKAGE_TARNAME}'dvidir='${docdir}'exec_prefix='NONE'ft_devel=''gphoto2_devel=''gphoto2port_devel=''host='i686-pc-linux-gnulibc1'host_alias=''host_cpu='i686'host_os='linux-gnulibc1'host_vendor='pc'htmldir='${docdir}'includedir='${prefix}/include'infodir='${datarootdir}/info'libdir='${exec_prefix}/lib'libexecdir='${exec_prefix}/libexec'localedir='${datarootdir}/locale'localstatedir='${prefix}/var'mandir='${datarootdir}/man'oldincludedir='/usr/include'pdfdir='${docdir}'prefix='NONE'program_transform_name='s,x,x,'psdir='${docdir}'sane_devel=''sbindir='${exec_prefix}/sbin'sharedstatedir='${prefix}/com'sysconfdir='${prefix}/etc'target_alias=''
## ------------------- #### File substitutions. #### ------------------- ##
MAKE_DLL_RULES=''MAKE_IMPLIB_RULES=''MAKE_PROG_RULES=''MAKE_RULES=''MAKE_TEST_RULES=''
## ----------- #### confdefs.h. #### ----------- ##
#define PACKAGE_NAME "Wine"#define PACKAGE_TARNAME "wine"#define PACKAGE_VERSION "0.9.54"#define PACKAGE_STRING "Wine 0.9.54"#define PACKAGE_BUGREPORT "wine-devel at winehq.org"
configure: exit 77
_________________________________________________________________
Get Hotmail on your mobile. Text MSN to 63463 now!
http://mobile.uk.msn.com/pc/mail.aspx
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080417/a9ee95b8/attachment.htm 

From a_villacis at palosanto.com  Thu Apr 17 11:38:23 2008
From: a_villacis at palosanto.com (=?ISO-8859-2?Q?Alex_Villac=ED=ADs_Lasso?=)
Date: Thu, 17 Apr 2008 11:38:23 -0500
Subject: installing wine into linux ubuntu
In-Reply-To: <BAY114-W5346A2814598953C9CA3EDB5E50@phx.gbl>
References: <BAY114-W5346A2814598953C9CA3EDB5E50@phx.gbl>
Message-ID: <48077CFF.4040906@palosanto.com>

stephen cooper escribi?:
>  ref. Linux Format DVD 104 April 2008From: stephen cooper (stephencooper96 at hotmail.com) 
> I am new to Linux.I have just installed Linux UBUNTU 7.1 (gutsy) onto my computer with no problems. I want to install wine.I have written the source code onto my hard disc. (using tar ) When I run ./configure (.tools/wineinstall) I get an error -  C compiler cannot create executables. I am including the output from the config.log for wine installation below.  PLEASE ADVISE ME. Stephen Cooper.
> This file contains any messages produced by compilers whilerunning configure, to aid debugging if configure makes a mistake.
> It was created by Wine configure 0.9.54, which wasgenerated by GNU Autoconf 2.61.  Invocation command line was
>   
It's good you are trying to build Wine. However, you need to install the 
appropriate development packages for Ubuntu first. Plain Ubuntu as 
installed from disks does not ship with enough tools to build any 
program in C. Also, most recent wine version as of this writing is 
0.9.59, so you are already a few versions behind.

You might want to try suscribing to the wine-users mailing list first. 
That mailing list is more appropriate for people who are starting with 
Wine and Linux than wine-devel.

-- 
perl -e '$x=2.4;print sprintf("%.0f + %.0f = %.0f\n",$x,$x,$x+$x);'



From m.b.lankhorst at gmail.com  Thu Apr 17 11:56:44 2008
From: m.b.lankhorst at gmail.com (Maarten Lankhorst)
Date: Thu, 17 Apr 2008 09:56:44 -0700
Subject: msxml3: Implement transformNode (try 3)
In-Reply-To: <fu5nn3$3vc$1@ger.gmane.org>
References: <ftvcka$qrg$1@ger.gmane.org> <fu5nn3$3vc$1@ger.gmane.org>
Message-ID: <b130c85e0804170956r8338396u43887738b48bef81@mail.gmail.com>

Hello Alistair,

2008/4/16, Alistair Leslie-Hughes <leslie_alistair at hotmail.com>:
> "Alistair Leslie-Hughes" <leslie_alistair at hotmail.com> wrote in message
>  news:ftvcka$qrg$1 at ger.gmane.org...
>  > Hi,
>  > Corrected issue with tests
>  >
>  > Changelog:
>  > msxml3: Implement transformNode
>  >
>  > Best Regards
>  >  Alistair Leslie-Hughes
>  >
>  Anything wrong with this patch?
Yes, it breaks building on dapper. I get an undefined reference to
xsltInit in main.c

Cheers,
Maarten.


From thestig at google.com  Thu Apr 17 12:24:10 2008
From: thestig at google.com (Lei Zhang)
Date: Thu, 17 Apr 2008 10:24:10 -0700
Subject: installing wine into linux ubuntu
In-Reply-To: <BAY114-W5346A2814598953C9CA3EDB5E50@phx.gbl>
References: <BAY114-W5346A2814598953C9CA3EDB5E50@phx.gbl>
Message-ID: <558b2f5c0804171024g7c7b2d44o2bd66d79a688f1d6@mail.gmail.com>

On Thu, Apr 17, 2008 at 6:46 AM, stephen cooper
<stephencooper96 at hotmail.com> wrote:
>
>   ref. Linux Format DVD 104 April 2008
> From: stephen cooper (stephencooper96 at hotmail.com)
>  I am new to Linux.
> I have just installed Linux UBUNTU 7.1 (gutsy) onto my computer with no
> problems.
>
> I want to install wine.
> I have written the source code onto my hard disc. (using tar )
> When I run ./configure (.tools/wineinstall) I get an error -  C compiler
> cannot create executables.
> I am including the output from the config.log for wine installation below.
>
> PLEASE ADVISE ME.

Take a look at http://wiki.winehq.org/Recommended_Packages for the
list of packages needed to build Wine. If you just want to use Wine,
there's packages available for Ubuntu:
http://www.winehq.org/site/download


From dank at kegel.com  Thu Apr 17 12:28:03 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 17 Apr 2008 10:28:03 -0700
Subject: New winetricks 20080417: new verb wmp9
Message-ID: <a71bd89a0804171028w239249b5p61026d38bf60f9b2@mail.gmail.com>

Another day, another Winetricks.  Changes:

r34  	Add Windows Media Player 9 (not really usable yet; this is for
the guys implementing Quartz etc.)

r33 	Fixed typo that disabled curl.

As always, get it at
http://kegel.com/wine/winetricks
or
http://code.google.com/p/winezeug

- Dan


From julliard at winehq.org  Thu Apr 17 12:39:36 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 17 Apr 2008 19:39:36 +0200
Subject: Trouble in compiling Wine 0.9.57 and 0.9.58 on Solaris 10 08/07
In-Reply-To: <48061E27.3070509@sun.com> (Petr Sumbera's message of "Wed, 16
	Apr 2008 17:41:27 +0200")
References: <47FF74FD.4060307@sun.com> <00a101c89da4$e7f77210$4001a8c0@NATERS>
	<200804132308.19873.stefan@codeweavers.com>
	<48061E27.3070509@sun.com>
Message-ID: <871w54l6sn.fsf@wine.dyndns.org>

Petr Sumbera <Petr.Sumbera at Sun.COM> writes:

> Well, we have only one isinf call in Wine so I think it isn't worst of
> creating Wine special isinf implementation. Instead I propose emulate
> isinf via finite() and isnand() (both coming from ieeefp.h).

You should still put that in libwine_port, it keeps the #ifdef ugliness
out of the code.

-- 
Alexandre Julliard
julliard at winehq.org


From susancragin at earthlink.net  Thu Apr 17 12:41:04 2008
From: susancragin at earthlink.net (Susan Cragin)
Date: Thu, 17 Apr 2008 13:41:04 -0400 (GMT-04:00)
Subject: installing wine into linux ubuntu
Message-ID: <4908366.1208454064493.JavaMail.root@elwamui-norfolk.atl.sa.earthlink.net>

Another way to do it, is run the following commands in a terminal before beginning:

sudo apt-get build-dep wine wine-dev
sudo apt-get install msttcorefonts fontforge


You need a lot of things, ideally. This gets you all of them. Some places say you can get by with bison and flex and the C compiler. I don't think that's really true. 


-----Original Message-----
>From: Lei Zhang <thestig at google.com>
>Sent: Apr 17, 2008 1:24 PM
>To: stephen cooper <stephencooper96 at hotmail.com>
>Cc: wine-devel at winehq.org
>Subject: Re: installing wine into linux ubuntu
>
>On Thu, Apr 17, 2008 at 6:46 AM, stephen cooper
><stephencooper96 at hotmail.com> wrote:
>>
>>   ref. Linux Format DVD 104 April 2008
>> From: stephen cooper (stephencooper96 at hotmail.com)
>>  I am new to Linux.
>> I have just installed Linux UBUNTU 7.1 (gutsy) onto my computer with no
>> problems.
>>
>> I want to install wine.
>> I have written the source code onto my hard disc. (using tar )
>> When I run ./configure (.tools/wineinstall) I get an error -  C compiler
>> cannot create executables.
>> I am including the output from the config.log for wine installation below.
>>
>> PLEASE ADVISE ME.
>
>Take a look at http://wiki.winehq.org/Recommended_Packages for the
>list of packages needed to build Wine. If you just want to use Wine,
>there's packages available for Ubuntu:
>http://www.winehq.org/site/download
>
>





From julliard at winehq.org  Thu Apr 17 13:21:04 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 17 Apr 2008 20:21:04 +0200
Subject: shell32: Allow ShellExecute to accept file extensions for lpClass.
In-Reply-To: <20080417173926.8139B3DB0E3@localhost> (Michael Moss's message of
	"Thu, 17 Apr 2008 10:33:37 -0700")
References: <20080417173926.8139B3DB0E3@localhost>
Message-ID: <87wsmwjqb3.fsf@wine.dyndns.org>

Michael Moss <mmoss at google.com> writes:

> [originally a Picasa patch by Aric Stewart]

In general if these patches have not been merged there was a good
reason. The first step would be to write test cases for them.

-- 
Alexandre Julliard
julliard at winehq.org


From hans at it.vu.nl  Thu Apr 17 14:26:30 2008
From: hans at it.vu.nl (Hans Leidekker)
Date: Thu, 17 Apr 2008 21:26:30 +0200
Subject: wininet: correct the case where Content-Length is set as well as
	Transer-Encoding = chunked
In-Reply-To: <48079175.3010107@codeweavers.com>
References: <48079175.3010107@codeweavers.com>
Message-ID: <200804172126.30625.hans@it.vu.nl>

On Thursday 17 April 2008 20:05:41 Aric Stewart wrote:

> +            /* Correct the case where both a Content-Length and Transfer-encoding = chuncked are set */
> +
> +            dwBufferSize = sizeof(encoding);
> +            if (HTTP_HttpQueryInfoW(lpwhr, HTTP_QUERY_TRANSFER_ENCODING, encoding, &dwBufferSize, NULL) &&
> +                !strcmpiW(encoding, szChunked))
> +            {
> +                lpwhr->dwContentLength = -1;
> +            }

I think the right thing to do is to strip the Transfer-Encoding
header from the request because we don't support chunked transfers
in the sending direction. Would that work for you?

 -Hans


From aric at codeweavers.com  Thu Apr 17 14:28:57 2008
From: aric at codeweavers.com (Aric Stewart)
Date: Thu, 17 Apr 2008 14:28:57 -0500
Subject: wininet: correct the case where Content-Length is set as well
	as Transer-Encoding = chunked
In-Reply-To: <200804172126.30625.hans@it.vu.nl>
References: <48079175.3010107@codeweavers.com>
	<200804172126.30625.hans@it.vu.nl>
Message-ID: <4807A4F9.2020208@codeweavers.com>

This patch is for the receiving direction, unless I misread the code.

The issue is that after a sent request the response is coming back with 
both Transfer-Encoding=chunked and a Content-Length.

-aric

Hans Leidekker wrote:
> On Thursday 17 April 2008 20:05:41 Aric Stewart wrote:
> 
>> +            /* Correct the case where both a Content-Length and Transfer-encoding = chuncked are set */
>> +
>> +            dwBufferSize = sizeof(encoding);
>> +            if (HTTP_HttpQueryInfoW(lpwhr, HTTP_QUERY_TRANSFER_ENCODING, encoding, &dwBufferSize, NULL) &&
>> +                !strcmpiW(encoding, szChunked))
>> +            {
>> +                lpwhr->dwContentLength = -1;
>> +            }
> 
> I think the right thing to do is to strip the Transfer-Encoding
> header from the request because we don't support chunked transfers
> in the sending direction. Would that work for you?
> 
>  -Hans
> 


From thestig at google.com  Thu Apr 17 15:05:25 2008
From: thestig at google.com (Lei Zhang)
Date: Thu, 17 Apr 2008 13:05:25 -0700
Subject: msxml3: Implement transformNode (try 3)
In-Reply-To: <b130c85e0804170956r8338396u43887738b48bef81@mail.gmail.com>
References: <ftvcka$qrg$1@ger.gmane.org> <fu5nn3$3vc$1@ger.gmane.org>
	<b130c85e0804170956r8338396u43887738b48bef81@mail.gmail.com>
Message-ID: <558b2f5c0804171305k6bd8241bnb34901e46b8b7e20@mail.gmail.com>

On Thu, Apr 17, 2008 at 9:56 AM, Maarten Lankhorst
<m.b.lankhorst at gmail.com> wrote:
> Hello Alistair,
>
>  2008/4/16, Alistair Leslie-Hughes <leslie_alistair at hotmail.com>:
>
> > "Alistair Leslie-Hughes" <leslie_alistair at hotmail.com> wrote in message
>  >  news:ftvcka$qrg$1 at ger.gmane.org...
>  >  > Hi,
>  >  > Corrected issue with tests
>  >  >
>  >  > Changelog:
>  >  > msxml3: Implement transformNode
>  >  >
>  >  > Best Regards
>  >  >  Alistair Leslie-Hughes
>  >  >
>  >  Anything wrong with this patch?
>  Yes, it breaks building on dapper. I get an undefined reference to
>  xsltInit in main.c
>
>  Cheers,
>  Maarten.
>
>
>

Patch sent:

http://www.winehq.org/pipermail/wine-patches/2008-April/053513.html


From hans at it.vu.nl  Thu Apr 17 15:13:49 2008
From: hans at it.vu.nl (Hans Leidekker)
Date: Thu, 17 Apr 2008 22:13:49 +0200
Subject: wininet: correct the case where Content-Length is set as well as
	Transer-Encoding = chunked
In-Reply-To: <4807A4F9.2020208@codeweavers.com>
References: <48079175.3010107@codeweavers.com>
	<200804172126.30625.hans@it.vu.nl>
	<4807A4F9.2020208@codeweavers.com>
Message-ID: <200804172213.49344.hans@it.vu.nl>

On Thursday 17 April 2008 21:28:57 Aric Stewart wrote:

> This patch is for the receiving direction, unless I misread the code.

Well, we're in a loop here, possibly sending and receiving multiple times
because of redirects.

> The issue is that after a sent request the response is coming back with
> both Transfer-Encoding=chunked and a Content-Length.

Which webserver is that?

RFC2616, section 4.4 states that "Messages MUST NOT include both a
 Content-Length header field and a non-identity transfer-coding. If the
 message does include a non-identity transfer-coding, the Content-Length
 MUST be ignored." 

So it looks like your patch does the right thing when we receive a
non-compliant response. I think we have a problem in the sending direction
too but we can address that later.

 -Hans


From joel at airwebreathe.org.uk  Thu Apr 17 18:07:58 2008
From: joel at airwebreathe.org.uk (Joel Holdsworth)
Date: Fri, 18 Apr 2008 00:07:58 +0100
Subject: Wine Status Page
Message-ID: <1208473678.6673.5.camel@joel-desktop>

Hi All,

Are there any plans to update the percentages on the Wine status page
any time soon? I'm curious to know how much progress has been made in
the past 10 months.

Regards
Joel Holdsworth




From hintak_leung at yahoo.co.uk  Thu Apr 17 14:21:25 2008
From: hintak_leung at yahoo.co.uk (Hin-Tak Leung)
Date: Thu, 17 Apr 2008 19:21:25 +0000 (GMT)
Subject: installing wine into linux ubuntu
In-Reply-To: <BAY114-W5346A2814598953C9CA3EDB5E50@phx.gbl>
Message-ID: <776761.16774.qm@web23109.mail.ird.yahoo.com>

--- On Thu, 17/4/08, stephen cooper <stephencooper96 at hotmail.com> wrote:
<snipped>
> /usr/bin/ld: crt1.o: No such file: No such file or directory
> collect2: ld returned 1 exit
<snipped>

Your specific problem is that you are missing crt1.o - that's part of
the glibc-dev package, I think. Install that the usual way under ubuntu.

As others has suggested - 
(1) your question is more appropriate to wine-users,
(2) considering using one of the pre-packaged deb packages available from either ubuntu or on winehq, instead of rolling your own, 
(3) since you don't even have glibc-dev (and your system does not seem
to have any developer tools at all, since almost every dev tool depends 
on this), you need to install a lot of required tools before you attempt
doing this again.




      ___________________________________________________________ 
Yahoo! For Good helps you make a difference  

http://uk.promotions.yahoo.com/forgood/


From scott at open-vote.org  Thu Apr 17 19:03:47 2008
From: scott at open-vote.org (Scott Ritchie)
Date: Thu, 17 Apr 2008 17:03:47 -0700
Subject: Towards pure wine: a step by step approach
In-Reply-To: <a71bd89a0804170820j22f4a449h5ad00373b8b5e269@mail.gmail.com>
References: <a71bd89a0804170820j22f4a449h5ad00373b8b5e269@mail.gmail.com>
Message-ID: <4807E563.1060400@open-vote.org>

Dan Kegel wrote:
> Errors reported by valgrind, coverity, and our conformance test suite
> are all worth fixing... but fixing them *all* is like shovelling out
> the dung from an infinitely large barn.  Various people have tried
> fixing one kind of error or the other, but maybe a combined attack,
> where we went module by module and fixed *all* of the valgrind,
> coverity, and conformance test errors might be more fruitful
> (or at least more satisfying).   Such an attempt should probably
> start at the bottom, cleaning up modules in the order
>   wineserver, ntdll, kernel32, gdi32, user32, ...
> 

Is this also the order of the most mature modules?  It seems to make
sense doing this kind of cleanup on the more stable parts first, since
the fixes are more likely to be permanent.

Thanks,
Scott Ritchie


From dank at kegel.com  Thu Apr 17 19:09:56 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 17 Apr 2008 17:09:56 -0700
Subject: Towards pure wine: a step by step approach
In-Reply-To: <4807E563.1060400@open-vote.org>
References: <a71bd89a0804170820j22f4a449h5ad00373b8b5e269@mail.gmail.com>
	<4807E563.1060400@open-vote.org>
Message-ID: <a71bd89a0804171709u7cc40c90o4c69bd11ea35b3ca@mail.gmail.com>

On Thu, Apr 17, 2008 at 5:03 PM, Scott Ritchie <scott at open-vote.org> wrote:
>  > Such an attempt should probably
>  > start at the bottom, cleaning up modules in the order
>  >   wineserver, ntdll, kernel32, gdi32, user32, ...
>
>  Is this also the order of the most mature modules?  It seems to make
>  sense doing this kind of cleanup on the more stable parts first, since
>  the fixes are more likely to be permanent.

Yes, I think so (though user32 can't quite be called fully stable).

Doing it bottom-up is also natural because otherwise
we'd see lots of lower-level module errors while valgrinding
or running conformance tests on upper-level modules.


From dank at kegel.com  Thu Apr 17 20:14:40 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 17 Apr 2008 18:14:40 -0700
Subject: new Valgrind errors in oleaut32
Message-ID: <a71bd89a0804171814n602daba7rc28e57ba8a8d82f8@mail.gmail.com>

James just barely touched the oleaut32 tests, and
as a side effect, we now have several more warnings of the sort

+ Conditional jump or move depends on uninitialised value(s)
+    at  VARIANT_DI_tostringW (vartype.c:4852)
+    by  VarBstrFromCy (vartype.c:6519)
+    by  VariantChangeTypeEx (variant.c:433)
+    by  VarCat (variant.c:2555)
+    by  test_VarCat (vartest.c:5246)
+    by  func_vartest (vartest.c:8436)
+    by  run_test (test.h:406)
+    by  main (test.h:455)

and

+ Conditional jump or move depends on uninitialised value(s)
+    at  __printf_fp (in /lib/tls/i686/cmov/libc-2.6.1.so)
+    by  vfprintf (in /lib/tls/i686/cmov/libc-2.6.1.so)
+    by  vsprintf (in /lib/tls/i686/cmov/libc-2.6.1.so)
+    by  sprintf (in /lib/tls/i686/cmov/libc-2.6.1.so)
+    by  vsnprintfW (string.c:408)
+    by  sprintfW (string.c:455)
+    by  VARIANT_BstrFromReal (vartype.c:6406)
+    by  VarBstrFromR4 (vartype.c:6457)
+    by  VariantChangeTypeEx (variant.c:430)
+    by  VarCat (variant.c:2555)
+    by  test_VarCat (vartest.c:5246)
+    by  func_vartest (vartest.c:8454)
+    by  run_test (test.h:406)
+    by  main (test.h:455)

See http://kegel.com/wine/valgrind/logs-2008-04-17/vg-oleaut32_vartest-diff.txt


From zgs at seas.upenn.edu  Thu Apr 17 22:17:24 2008
From: zgs at seas.upenn.edu (Zachary Goldberg)
Date: Thu, 17 Apr 2008 23:17:24 -0400
Subject: Wine Status Page
In-Reply-To: <1208473678.6673.5.camel@joel-desktop>
References: <1208473678.6673.5.camel@joel-desktop>
Message-ID: <b050a5e70804172017m41685299ub0f44e079f7ed428@mail.gmail.com>

On Thu, Apr 17, 2008 at 7:07 PM, Joel Holdsworth
<joel at airwebreathe.org.uk> wrote:
> Hi All,
>
>  Are there any plans to update the percentages on the Wine status page
>  any time soon? I'm curious to know how much progress has been made in
>  the past 10 months.
>
>  Regards
>  Joel Holdsworth
>
>
>
>
>

I've spoken with the guy who used to maintain these pages (Tom
Wickline) who mentioned that he may be able to update them during the
code freeze this coming May.


-- 
Zachary Goldberg
Computer Science & Engineering
Electrical Captain of Penn Electric Race Team
School of Engineering at the University of Pennsylvania


From dmitry at codeweavers.com  Fri Apr 18 03:55:10 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 18 Apr 2008 17:55:10 +0900
Subject: wininet: improve stub for FindNextUrlCacheEntryW a tiny bit
References: <759214.73335.qm@web23212.mail.ird.yahoo.com>
Message-ID: <022501c8a131$ec699130$a600fea9@DMITRY>

"Louis. Lenders" <xerox_xerox2000 at yahoo.co.uk> wrote:

> @@ -3113,6 +3113,7 @@ BOOL WINAPI FindNextUrlCacheEntryW(
>    LPDWORD lpdwNextCacheEntryInfoBufferSize
>  )
>  {
> +    SetLastError(ERROR_CALL_NOT_IMPLEMENTED);
>      FIXME("(%p, %p, %p) stub\n", hEnumHandle, lpNextCacheEntryInfo, lpdwNextCacheEntryInfoBufferSize);
>      return FALSE;
>  }

You should put SetLastError() immediately before return, any calls after
it may potentially change last error value.

-- 
Dmitry.


From astrand at cendio.se  Fri Apr 18 04:01:57 2008
From: astrand at cendio.se (=?UTF-8?Q?Peter_=C3=85strand?=)
Date: Fri, 18 Apr 2008 11:01:57 +0200 (CEST)
Subject: Strange waveOutGetDevCaps calls in winmm/tests/wave.c
In-Reply-To: <3a768c550804160744r285ab6a0j1a02b7892841e661@mail.gmail.com>
References: <Pine.LNX.4.64.0804161351210.19758@maggie.lkpg.cendio.se>
	<3a768c550804160744r285ab6a0j1a02b7892841e661@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0804171247560.7871@maggie.lkpg.cendio.se>

On Wed, 16 Apr 2008, Juan Lang wrote:

> >  The CapsA test doesn't fail, probably since winmm wraps CapsA calls with
> >  CapsW calls and then does memcpy. In either case, calling
> >  waveOutGetDevCaps sith size=4 is not valid, as far as I can tell.
> >  Theoretically, it might be in the future, though, if some small caps
> >  structure is invented. I suggest that these tests are removed altogether:
> 
> Sounds reasonable to me; please send to wine-patches.

Actually, the patch was wrong: The capsA structure is used later below, so 
the call needs to be fixed rather than removed. 

I'll fix a new patch. 

Rgds, 
---
Peter ?strand		ThinLinc Chief Developer
Cendio AB		http://www.cendio.se
Wallenbergs gata 4
583 30 Link?ping	Phone: +46-13-21 46 00

From julliard at winehq.org  Fri Apr 18 06:44:42 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 18 Apr 2008 13:44:42 +0200
Subject: shell32: implement SHGetFolderPathAndSubDirA/W [try2][resend]
In-Reply-To: <200804172331.05268.Stefan.Leichter@camline.com> (Stefan
	Leichter's message of "Thu, 17 Apr 2008 23:31:05 +0200")
References: <200804172331.05268.Stefan.Leichter@camline.com>
Message-ID: <87mynrjsk5.fsf@wine.dyndns.org>

Stefan Leichter <Stefan.Leichter at camline.com> writes:

> @@ -1758,7 +1836,7 @@
>       */
>      if (!(nFolder & CSIDL_FLAG_CREATE))
>      {
> -        hr = HRESULT_FROM_WIN32(ERROR_FILE_NOT_FOUND);
> +        hr = HRESULT_FROM_WIN32(ERROR_PATH_NOT_FOUND);
>          goto end;

Why is it using a different error code here?  Do you have a test case
for this?

-- 
Alexandre Julliard
julliard at winehq.org


From aric at codeweavers.com  Fri Apr 18 06:53:01 2008
From: aric at codeweavers.com (Aric Stewart)
Date: Fri, 18 Apr 2008 06:53:01 -0500
Subject: wininet: correct the case where Content-Length is set as well
	as Transer-Encoding = chunked
In-Reply-To: <200804172213.49344.hans@it.vu.nl>
References: <48079175.3010107@codeweavers.com>
	<200804172126.30625.hans@it.vu.nl>
	<4807A4F9.2020208@codeweavers.com>
	<200804172213.49344.hans@it.vu.nl>
Message-ID: <48088B9D.6090908@codeweavers.com>

Here is the download where i see the behavior is where I see the behavior.

http://site.ebrary.com/lib/stanford/support/plugins/ebraryReader.exe

thanks,
-aric

Hans Leidekker wrote:
> On Thursday 17 April 2008 21:28:57 Aric Stewart wrote:
> 
>> This patch is for the receiving direction, unless I misread the code.
> 
> Well, we're in a loop here, possibly sending and receiving multiple times
> because of redirects.
> 
>> The issue is that after a sent request the response is coming back with
>> both Transfer-Encoding=chunked and a Content-Length.
> 
> Which webserver is that?
> 
> RFC2616, section 4.4 states that "Messages MUST NOT include both a
>  Content-Length header field and a non-identity transfer-coding. If the
>  message does include a non-identity transfer-coding, the Content-Length
>  MUST be ignored." 
> 
> So it looks like your patch does the right thing when we receive a
> non-compliant response. I think we have a problem in the sending direction
> too but we can address that later.
> 
>  -Hans
> 


From Stefan.Leichter at camLine.com  Fri Apr 18 07:56:38 2008
From: Stefan.Leichter at camLine.com (Stefan Leichter)
Date: Fri, 18 Apr 2008 14:56:38 +0200
Subject: shell32: implement SHGetFolderPathAndSubDirA/W [try2][resend]
In-Reply-To: <87mynrjsk5.fsf@wine.dyndns.org>
References: <200804172331.05268.Stefan.Leichter@camline.com>
	<87mynrjsk5.fsf@wine.dyndns.org>
Message-ID: <48089A86.6080706@camLine.com>

Alexandre Julliard schrieb:
> Stefan Leichter <Stefan.Leichter at camline.com> writes:
> 
>> @@ -1758,7 +1836,7 @@
>>       */
>>      if (!(nFolder & CSIDL_FLAG_CREATE))
>>      {
>> -        hr = HRESULT_FROM_WIN32(ERROR_FILE_NOT_FOUND);
>> +        hr = HRESULT_FROM_WIN32(ERROR_PATH_NOT_FOUND);
>>          goto end;
> 
> Why is it using a different error code here?  Do you have a test case
> for this?
> 
Of course

dlls/shell32/tests/shlfolder.c around line 1457


From Petr.Sumbera at Sun.COM  Fri Apr 18 08:21:00 2008
From: Petr.Sumbera at Sun.COM (Petr Sumbera)
Date: Fri, 18 Apr 2008 15:21:00 +0200
Subject: Trouble in compiling Wine 0.9.57 and 0.9.58 on Solaris 10 08/07
In-Reply-To: <871w54l6sn.fsf@wine.dyndns.org>
References: <47FF74FD.4060307@sun.com> <00a101c89da4$e7f77210$4001a8c0@NATERS>
	<200804132308.19873.stefan@codeweavers.com>
	<48061E27.3070509@sun.com> <871w54l6sn.fsf@wine.dyndns.org>
Message-ID: <4808A03C.5050207@sun.com>

Alexandre Julliard wrote:
> Petr Sumbera <Petr.Sumbera at Sun.COM> writes:
> 
>> Well, we have only one isinf call in Wine so I think it isn't worst of
>> creating Wine special isinf implementation. Instead I propose emulate
>> isinf via finite() and isnand() (both coming from ieeefp.h).
> 
> You should still put that in libwine_port, it keeps the #ifdef ugliness
> out of the code.
> 

What about defining isinf as macro?

diff --git a/include/wine/port.h b/include/wine/port.h
index 6727891..59c12aa 100644
--- a/include/wine/port.h
+++ b/include/wine/port.h
@@ -146,6 +146,11 @@ struct statvfs
  #define strtoull _strtoui64
  #endif

+#if !defined(HAVE_ISINF) && defined(HAVE_IEEEFP_H)
+#include <ieeefp.h>
+#define isinf(x) (!(finite(x) || isnand(x)))
+#endif
+
  #ifndef S_ISLNK
  # define S_ISLNK(mod) (0)
  #endif


---

BTW, I would maybe question also existence of float_32_to_16() in header 
  file too.

Petr


From dmitry at codeweavers.com  Fri Apr 18 08:52:18 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 18 Apr 2008 22:52:18 +0900
Subject: user32:mdi.c  Fix creating MDI child window according with test.
References: <480894BF.9020009@etersoft.ru>
Message-ID: <001b01c8a15b$6d07c220$a600fea9@DMITRY>

"Anatoly Lyutin" <vostok at etersoft.ru> wrote:

> --- dlls/user32/mdi.c 5 Mar 2008 19:42:23 -0000 1.24
> +++ dlls/user32/mdi.c 18 Apr 2008 12:07:50 -0000
> @@ -649,6 +728,9 @@ static LONG MDI_ChildActivate( HWND clie
>     }
> 
>     SendMessageW( child, WM_MDIACTIVATE, (WPARAM)prevActiveWnd, (LPARAM)child );
> +
> +    SetWindowPos( frame, HWND_TOP, 0, 0, 0, 0, SWP_NOMOVE|SWP_NOSIZE|SWP_NOACTIVATE|SWP_FRAMECHANGED );

SWP_NOZORDER should be there for sure, and in that case HWND_TOP doesn't make
sense, so  just use 0 (although HWND_TOP == 0) instead.

-- 
Dmitry.


From vostok at etersoft.ru  Fri Apr 18 09:29:51 2008
From: vostok at etersoft.ru (Anatoly Lyutin)
Date: Fri, 18 Apr 2008 18:29:51 +0400
Subject: user32:mdi.c  Fix creating MDI child window according with test.
In-Reply-To: <001b01c8a15b$6d07c220$a600fea9@DMITRY>
References: <480894BF.9020009@etersoft.ru>
	<001b01c8a15b$6d07c220$a600fea9@DMITRY>
Message-ID: <4808B05F.2010207@etersoft.ru>

Dmitry Timoshkov wrote:
>
> SWP_NOZORDER should be there for sure, and in that case HWND_TOP 
> doesn't make
> sense, so  just use 0 (although HWND_TOP == 0) instead.
>
Yes, You are right. I have sent a new version.

-- 
Best regards
	Anatoly Lyutin.



From reif at earthlink.net  Fri Apr 18 09:33:41 2008
From: reif at earthlink.net (Robert Reif)
Date: Fri, 18 Apr 2008 10:33:41 -0400
Subject: winmm/tests: waveOutGetDevCaps called with invalid size
In-Reply-To: <Pine.LNX.4.64.0804181102080.23847@maggie.lkpg.cendio.se>
References: <Pine.LNX.4.64.0804181102080.23847@maggie.lkpg.cendio.se>
Message-ID: <4808B145.2010609@earthlink.net>

Peter ?strand wrote:
> Changelog:
>
> Calling waveOutGetDevCapsA/waveOutGetDevCapsW with size 4 is wrong, the 
> size should be the sizeof the structure used. waveOutGetDevCapsA needs to 
> succeed since the capsA structure is used later. 
>
> Index: wave.c
> ===================================================================
> RCS file: /home/wine/wine/dlls/winmm/tests/wave.c,v
> retrieving revision 1.67
> diff -u -r1.67 wave.c
> --- wave.c	29 Feb 2008 12:18:36 -0000	1.67
> +++ wave.c	18 Apr 2008 08:43:54 -0000
> @@ -853,15 +853,13 @@
>         "expected, got %s\n",dev_name(device),wave_out_error(rc));
>      }
>  
> -    rc=waveOutGetDevCapsA(device,&capsA,4);
> +    /* Final call must succeed, capsA will be used below */
> +    rc=waveOutGetDevCapsA(device,&capsA,sizeof(capsA));
>      ok(rc==MMSYSERR_NOERROR,
>         "waveOutGetDevCapsA(%s): MMSYSERR_NOERROR expected, got %s\n",
>         dev_name(device),wave_out_error(rc));
> -
> -    rc=waveOutGetDevCapsW(device,&capsW,4);
> -    ok(rc==MMSYSERR_NOERROR || rc==MMSYSERR_NOTSUPPORTED,
> -       "waveOutGetDevCapsW(%s): MMSYSERR_NOERROR or MMSYSERR_NOTSUPPORTED "
> -       "expected, got %s\n",dev_name(device),wave_out_error(rc));
> +    if (rc!=MMSYSERR_NOERROR)
> +	return;
>  
>      nameA=NULL;
>      rc=waveOutMessage((HWAVEOUT)device, DRV_QUERYDEVICEINTERFACESIZE,
>
>
> ---
> Peter ?strand		ThinLinc Chief Developer
> Cendio AB		http://www.cendio.se
> Wallenbergs gata 4
> 583 30 Link?ping	Phone: +46-13-21 46 00
> ------------------------------------------------------------------------
>
>
>   
That's the whole point of the test, to check what happens with an 
invalid argument.


From dank at kegel.com  Fri Apr 18 09:45:15 2008
From: dank at kegel.com (Dan Kegel)
Date: Fri, 18 Apr 2008 07:45:15 -0700
Subject: New winetricks 20080418: add wmp10, windows codecs,
	accept new flash version
Message-ID: <a71bd89a0804180745v73d505a5m288c55d0c72059ff@mail.gmail.com>

Another day, another Winetricks.

Changes since yesterday's annoucement:
 Switch to listing simpler synonyms for changing windows version (long
ones still valid)
 Correct description of volnum verb (it's still needed)
 Fix typo in sha1sum check that caused it to be ignored!
 Update sha1sum for flash player (see comment for URL about the update)
 Much better error reporting for gui users.
 Add wmp10
 Installing wmp9 or wmp10 also gets codecs now

Online as always at
  http://kegel.com/wine/winetricks
or
  http://winezeug.googlecode.com


From tony.wasserka at freenet.de  Fri Apr 18 10:49:15 2008
From: tony.wasserka at freenet.de (tony.wasserka at freenet.de)
Date: Fri, 18 Apr 2008 17:49:15 +0200
Subject: d3dx9_36: Add stubs and implementations for D3DXCreateTexturexx
Message-ID: <E1Jmspv-0007s6-Ql@www19.emo.freenet-rz.de>

>   I have a hacky implementation of D3DXLoadSurfaceFromMemory and
> D3DXLoadSurfaceFromSurface, as well as a pretty good implementation of
> D3DXCreateTexture and D3DXCheckTextureRequirements.
> 
>   I'll send in the patch for the last two when I have time, and have
> looked it over a final time.  I pretty much abandoned the first two,
> because there's got to be a whole lot of code somewhere in the tree
> already.  It does work in some cases, however.  Attached in case it
> might be helpful.

Nice, I hope I can do something with the D3DXLoadSurfaceFromMemory/Surface
implementations when my D3DXLoadXXFromFile functions are ready, thank you!
However, I don't wanna push you, but can you send me your current code for 
D3DXCreateTexture+D3DXCheckTextureRequirements so that I can
work on D3DXLoadXXFromFile and the other functions until it's in the main tree?

    Tony



Unbegrenzter Speicher, Top-Spamschutz, 120 SMS und eigene E-MailDomain inkl.
http://office.freenet.de/dienste/emailoffice/produktuebersicht/power/mail/index.html



From bunk at stusta.de  Fri Apr 18 11:52:19 2008
From: bunk at stusta.de (Adrian Bunk)
Date: Fri, 18 Apr 2008 19:52:19 +0300
Subject: Wine release 0.9.60
In-Reply-To: <20080418155916.7F4431E715A@wine.dyndns.org>
References: <20080418155916.7F4431E715A@wine.dyndns.org>
Message-ID: <20080418165219.GB9770@cs181133002.pp.htv.fi>

On Fri, Apr 18, 2008 at 05:59:16PM +0200, Alexandre Julliard wrote:
>...
> Bugs fixed since 0.9.59:
>...
>    7174  Master of Orion 2 does not switch screen resolution correctly
>...

That this bug is listed as "fixed since 0.9.59" is wrong, and it sounds 
as if you wrongly count all bugs closed since 0.9.59 as having been 
present in 0.9.59?

Looking through some of the other bugs (especially older ones) the 
information in Bugzilla indicates for several other bugs listed in your 
announcement that they were not "fixed since 0.9.59".

You Wine developers are doing a great job, but especially since you are 
currently actively triaging older bugs "fixed since 0.9.59" is quite 
different from "closed since 0.9.59".

> Alexandre Julliard

cu
Adrian

-- 

       "Is there not promise of rain?" Ling Tan asked suddenly out
        of the darkness. There had been need of rain for many days.
       "Only a promise," Lao Er said.
                                       Pearl S. Buck - Dragon Seed



From julliard at winehq.org  Fri Apr 18 12:46:51 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 18 Apr 2008 19:46:51 +0200
Subject: Wine release 0.9.60
In-Reply-To: <20080418165219.GB9770@cs181133002.pp.htv.fi> (Adrian Bunk's
	message of "Fri, 18 Apr 2008 19:52:19 +0300")
References: <20080418155916.7F4431E715A@wine.dyndns.org>
	<20080418165219.GB9770@cs181133002.pp.htv.fi>
Message-ID: <87hcdzjbsk.fsf@wine.dyndns.org>

Adrian Bunk <bunk at stusta.de> writes:

> That this bug is listed as "fixed since 0.9.59" is wrong, and it sounds 
> as if you wrongly count all bugs closed since 0.9.59 as having been 
> present in 0.9.59?
>
> Looking through some of the other bugs (especially older ones) the 
> information in Bugzilla indicates for several other bugs listed in your 
> announcement that they were not "fixed since 0.9.59".
>
> You Wine developers are doing a great job, but especially since you are 
> currently actively triaging older bugs "fixed since 0.9.59" is quite 
> different from "closed since 0.9.59".

Not really; the important point is that the bug is not present in
0.9.60. I don't think it matters all that much to know whether it was
really still present in 0.9.59, or already fixed there but not reported
as such.

Doing this right would require adding support in bugzilla for storing
the sha1 of the commit that fixed the bug, then we could query exactly
which release fixed which bug. Patches are welcome...

-- 
Alexandre Julliard
julliard at winehq.org


From r.kalbermatter at hccnet.nl  Fri Apr 18 15:15:56 2008
From: r.kalbermatter at hccnet.nl (Rolf Kalbermatter)
Date: Fri, 18 Apr 2008 22:15:56 +0200
Subject: Trouble in compiling Wine 0.9.57 and 0.9.58 on Solaris 10 08/07
In-Reply-To: <4808A03C.5050207@sun.com>
References: <47FF74FD.4060307@sun.com> <00a101c89da4$e7f77210$4001a8c0@NATERS>
	<200804132308.19873.stefan@codeweavers.com>
	<48061E27.3070509@sun.com> <871w54l6sn.fsf@wine.dyndns.org>
	<4808A03C.5050207@sun.com>
Message-ID: <001601c8a191$0360bb20$4001a8c0@NATERS>

Petr.Sumbera at Sun.COM [mailto:Petr.Sumbera at Sun.COM] wrote:

> What about defining isinf as macro?
> 
> diff --git a/include/wine/port.h b/include/wine/port.h index 
> 6727891..59c12aa 100644
> --- a/include/wine/port.h
> +++ b/include/wine/port.h
> @@ -146,6 +146,11 @@ struct statvfs
>   #define strtoull _strtoui64
>   #endif
> 
> +#if !defined(HAVE_ISINF) && defined(HAVE_IEEEFP_H) #include <ieeefp.h> 
> +#define isinf(x) (!(finite(x) || isnand(x))) #endif
> +
>   #ifndef S_ISLNK
>   # define S_ISLNK(mod) (0)
>   #endif

With the exception of the somewhat weird line wrapping (or better lack
thereof)
this looks like what I had in mind. I don't see the benefit of adding
something
simple like this into libwine_port.

But of course it's Alexandre's call.

Rolf Kalbermatter



From julliard at winehq.org  Fri Apr 18 16:33:26 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 18 Apr 2008 23:33:26 +0200
Subject: Wine release 0.9.60
In-Reply-To: <20080418201417.GA1595@cs181133002.pp.htv.fi> (Adrian Bunk's
	message of "Fri, 18 Apr 2008 23:14:17 +0300")
References: <20080418155916.7F4431E715A@wine.dyndns.org>
	<20080418165219.GB9770@cs181133002.pp.htv.fi>
	<87hcdzjbsk.fsf@wine.dyndns.org>
	<20080418201417.GA1595@cs181133002.pp.htv.fi>
Message-ID: <87d4omkfvd.fsf@wine.dyndns.org>

Adrian Bunk <bunk at stusta.de> writes:

> I might be a bit nitpicking, but "Bugs fixed since 0.9.59" implies for  
> me that these bugs have been fixed after 0.9.59.

I can certainly change it to "Bugs fixed in 0.9.60" if you prefer that.

> And when I'm reading the 0.9.60 announcement I'm mostly interested in 
> whether upgrading from 0.9.59 to 0.9.60 is worth it, not whether your 
> Bugzilla triage has found that a bug has been fixed a year ago. [1]

But maybe other people are interested to know that their bug has been
fixed, and don't care whether it was fixed before or after 0.9.59. Since
there is at the moment no good way to find out which bugs were fixed in
0.9.59 but marked resolved after that, listing them in the next
announcement is IMO better than not listing them at all.

-- 
Alexandre Julliard
julliard at winehq.org


From m.b.lankhorst at gmail.com  Fri Apr 18 16:37:28 2008
From: m.b.lankhorst at gmail.com (Maarten Lankhorst)
Date: Fri, 18 Apr 2008 14:37:28 -0700
Subject: Hack: Debug a specific critical section WINE_DEBUG_SPINLOCK
Message-ID: <b130c85e0804181437h3237e223sd98d8a6cae69a4ea@mail.gmail.com>

Hi all,

I created a hack to debug a specific critical section with
WINE_DEBUG_SPINLOCK environment. It was useful for me because it found
a very weird deadlock, a thread would terminate before releasing its
critical section. It will also change the timeout to 1 second so you
will get a faster response on potential latency issues.

How to use it?

First you need the exact spinlock name.

for example in parser.c:

    pParser->csFilter.DebugInfo->Spare[0] = (DWORD_PTR)(__FILE__ ":
ParserImpl.csFilter");

Of course you still need to know what __FILE__ is, this is usually
parser.c but I'm not 100% sure that is the same for out of tree
builds.

So just to be sure:
$ strings parser.o |grep csFilter
parser.c: ParserImpl.csFilter

export WINE_DEBUG_SPINLOCK="parser.c: ParserImpl.csFilter"

It will then print a ++ for every time a lock is entered, and -- for
every time lock is left., I would recommend mixing this with
WINEDEBUG=+tid so you can also see the threads they are in.

Comments?

Cheers,
Maarten.
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: 0013-ntdll-Add-reading-WINE_DEBUG_SPINLOCK-variable.txt
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20080418/56e157b8/attachment.txt 

From bunk at stusta.de  Fri Apr 18 15:14:17 2008
From: bunk at stusta.de (Adrian Bunk)
Date: Fri, 18 Apr 2008 23:14:17 +0300
Subject: Wine release 0.9.60
In-Reply-To: <87hcdzjbsk.fsf@wine.dyndns.org>
References: <20080418155916.7F4431E715A@wine.dyndns.org>
	<20080418165219.GB9770@cs181133002.pp.htv.fi>
	<87hcdzjbsk.fsf@wine.dyndns.org>
Message-ID: <20080418201417.GA1595@cs181133002.pp.htv.fi>

On Fri, Apr 18, 2008 at 07:46:51PM +0200, Alexandre Julliard wrote:
> Adrian Bunk <bunk at stusta.de> writes:
> 
> > That this bug is listed as "fixed since 0.9.59" is wrong, and it sounds 
> > as if you wrongly count all bugs closed since 0.9.59 as having been 
> > present in 0.9.59?
> >
> > Looking through some of the other bugs (especially older ones) the 
> > information in Bugzilla indicates for several other bugs listed in your 
> > announcement that they were not "fixed since 0.9.59".
> >
> > You Wine developers are doing a great job, but especially since you are 
> > currently actively triaging older bugs "fixed since 0.9.59" is quite 
> > different from "closed since 0.9.59".
> 
> Not really; the important point is that the bug is not present in
> 0.9.60. I don't think it matters all that much to know whether it was
> really still present in 0.9.59, or already fixed there but not reported
> as such.

I might be a bit nitpicking, but "Bugs fixed since 0.9.59" implies for  
me that these bugs have been fixed after 0.9.59.

And when I'm reading the 0.9.60 announcement I'm mostly interested in 
whether upgrading from 0.9.59 to 0.9.60 is worth it, not whether your 
Bugzilla triage has found that a bug has been fixed a year ago. [1]

> Doing this right would require adding support in bugzilla for storing
> the sha1 of the commit that fixed the bug, then we could query exactly
> which release fixed which bug. Patches are welcome...

Without any patches you could add fields "Known to work:" and
"Known to fail:" as in the gcc Bugzilla (see e.g. [2]), when resolving a 
bug updating them, and then query for which bugs 0.9.59 was known to 
fail and 0.9.60 is known to work.

> Alexandre Julliard

cu
Adrian

[1] triaging bugs is an important task, but the information about
    closing bugs fixed long ago doesn't belong here
[2] http://gcc.gnu.org/bugzilla/show_bug.cgi?id=20623

-- 

       "Is there not promise of rain?" Ling Tan asked suddenly out
        of the darkness. There had been need of rain for many days.
       "Only a promise," Lao Er said.
                                       Pearl S. Buck - Dragon Seed



From hverbeet at gmail.com  Fri Apr 18 19:36:39 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Sat, 19 Apr 2008 02:36:39 +0200
Subject: [PATCH 2/2] wined3d: Prevent console spamming in drawPrimitive.
In-Reply-To: <480915AB.7060104@inbox.lv>
References: <480915AB.7060104@inbox.lv>
Message-ID: <d658b69e0804181736u32f4eafbw1b9ea9a5d0561180@mail.gmail.com>

On 18/04/2008, Alexander Dorofeyev <alexd4 at inbox.lv> wrote:
> Fixes massive slowdown in games like Aliens vs Predator 2.
>
If you care about performance you should always run with
WINEDEBUG="-all" anyway.


From dmitry at codeweavers.com  Fri Apr 18 20:52:38 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sat, 19 Apr 2008 10:52:38 +0900
Subject: [PATCH] user32: Handle VK_RETURN KeyDown events more properly in
	EDITcontrols.
References: <3c72a4290804181550x5b550459o4a0a6c5b95c16962@mail.gmail.com>
Message-ID: <01e801c8a1c0$0d4a8740$a600fea9@DMITRY>

"El." <elptr at users.sourceforge.net> wrote:

> @@ -4606,6 +4606,10 @@ static LRESULT EDIT_WM_KeyDown(EDITSTATE *es, INT key)
>       {
>    HWND hwndParent = GetParent(es->hwndSelf);
>    DWORD dw = SendMessageW( hwndParent, DM_GETDEFID, 0, 0 );
> +
> +  if (GetClassLongW(hwndParent, GCW_ATOM) != WC_DIALOG)
> +      break;

You need to add a test case first to confirm that the fix is correct, and
use EDIT_IsInsideDialog to detect if the parent is dialog.

-- 
Dmitry.


From stefan at codeweavers.com  Fri Apr 18 23:37:50 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sat, 19 Apr 2008 06:37:50 +0200
Subject: [PATCH 2/2] wined3d: Prevent console spamming in drawPrimitive.
In-Reply-To: <d658b69e0804181736u32f4eafbw1b9ea9a5d0561180@mail.gmail.com>
References: <480915AB.7060104@inbox.lv>
	<d658b69e0804181736u32f4eafbw1b9ea9a5d0561180@mail.gmail.com>
Message-ID: <200804190637.51151.stefan@codeweavers.com>

Am Samstag, 19. April 2008 02:36:39 schrieb H. Verbeet:
> On 18/04/2008, Alexander Dorofeyev <alexd4 at inbox.lv> wrote:
> > Fixes massive slowdown in games like Aliens vs Predator 2.
>
> If you care about performance you should always run with
> WINEDEBUG="-all" anyway.
I think it is valid to prevent such flooding though, because with 
WINEDEBUG=-all you might miss helpful errors as well. Even if -all is not set 
it is usually quite hard to see a single legitimate fixme in such a flood


From hverbeet at gmail.com  Sat Apr 19 00:19:17 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Sat, 19 Apr 2008 07:19:17 +0200
Subject: [PATCH 2/2] wined3d: Prevent console spamming in drawPrimitive.
In-Reply-To: <200804190637.51151.stefan@codeweavers.com>
References: <480915AB.7060104@inbox.lv>
	<d658b69e0804181736u32f4eafbw1b9ea9a5d0561180@mail.gmail.com>
	<200804190637.51151.stefan@codeweavers.com>
Message-ID: <d658b69e0804182219p140cc1d9jfffd1ba442a797bc@mail.gmail.com>

On 19/04/2008, Stefan D?singer <stefan at codeweavers.com> wrote:
> Am Samstag, 19. April 2008 02:36:39 schrieb H. Verbeet:
>
> > On 18/04/2008, Alexander Dorofeyev <alexd4 at inbox.lv> wrote:
>  > > Fixes massive slowdown in games like Aliens vs Predator 2.
>  >
>  > If you care about performance you should always run with
>  > WINEDEBUG="-all" anyway.
>
> I think it is valid to prevent such flooding though, because with
>  WINEDEBUG=-all you might miss helpful errors as well. Even if -all is not set
>  it is usually quite hard to see a single legitimate fixme in such a flood
>
Oh, I'm not opposed to the patch itself, preventing the log from
getting spammed is a good thing. Just saying performance is the wrong
reason.


From tony.wasserka at freenet.de  Sat Apr 19 03:11:06 2008
From: tony.wasserka at freenet.de (tony.wasserka at freenet.de)
Date: Sat, 19 Apr 2008 10:11:06 +0200
Subject: d3dx9: Texturing functions
Message-ID: <E1Jn8A6-00041M-77@www15.emo.freenet-rz.de>

Hi all,
as it's a larger chunk of functions, I felt like proposing my design idea for the
D3DXCreateTexture/Volume/CubeTextureFromFile/Resource/FileInMemory/etc...
functions. I'm CC'ing it to any wine d3dx coder I have in my addressbook yet,
so sorry if I forgot one :)

So, the first thing I want to make sure is that we redirect the function calls correctly in order
to reduce double coding.
This means on the one hand that we should call the Extended versions of each function
from inside of the simpler ones (most default parameters for the Ex functions are
on MSDN) and on the other hand that we unify all D3DXCreateTextureFromXXEx
functions somehow. I don't know how Resources are stored internally, but I guess
the simplest would be to redirect all of them to D3DXCreateTextureFromFileInMemory, i.e.
when D3DXCreateTextureFromFile is called we read the file into memory and call the
InMemory function. I hope this shouldn't be too hard to be applied to the resource function
either. Of course, this should also be done at the corresponding Surface, Volume and
cube texture functions.
Also, I haven't looked too much into it yet, but I guess we could go even a step further
and define the CreateTextuteFromXX calls like this:
1. Redirect to the corresponding D3DXCreateXFromFileInMemoryEx call
2. Call D3DXCheckXRequirements
3. Call IDirect3DDevice9::CreateTexture
4. Lock its surface
5. Call LoadSurfaceFromFileEx with it

This would reduce most of our coding work on LoadSurfaceFromFileEx.
However, there are still plenty of formats supported by the texturing functions
and thus, plenty of work for us to do. IIRC we once came to the decision to
use libraries like libpng or so to reduce that work, too, so we'd just need
to implement formats like .dds.


And the last thing I'd like to ask goes to Louis Lenders: I've just found out
that you have been working on a D3DXCreateTextureFromFile implementation.
Are you still working on that? I'm really looking forward to do some coding
work again, so I could continue your implementation from the 24th March if
you've stopped to work on it ;-)

However, feel free to comment on my proposals for the texturing functions
and tell me if you see any concerns with it :)

Best regards,
   Tony



Unbegrenzter Speicher, Top-Spamschutz, 120 SMS und eigene E-MailDomain inkl.
http://office.freenet.de/dienste/emailoffice/produktuebersicht/power/mail/index.html



From jan.wine at zerebecki.de  Sat Apr 19 03:47:02 2008
From: jan.wine at zerebecki.de (Jan Zerebecki)
Date: Sat, 19 Apr 2008 10:47:02 +0200
Subject: Trying to get a grip on how to handle bug reports.
In-Reply-To: <22821af30804131228j7cd7d16cva450906cb2f0b54@mail.gmail.com>
References: <200804130014.58380.kai.blin@gmail.com>
	<22821af30804121557t2e560a85ub1d5a9ecc55dbadb@mail.gmail.com>
	<48025892.3090502@inbox.lv>
	<22821af30804131228j7cd7d16cva450906cb2f0b54@mail.gmail.com>
Message-ID: <20080419084702.GW3557@crissy.swd.zerebecki.de>

On Sun, Apr 13, 2008 at 02:28:15PM -0500, James Hawkins wrote:
> On behalf of the regular bugzilla moderators (of which there are very
> few), I'll go over the policy we have in place to keep, or strive to
> attain, a manageable bugzilla database.  There are only a few
> conditions that warrant abandoning a bug:
> 
> a) the bug must not be freely reproducible
> b) the reporter has not responded to a request for more information in
> at least 3 months, or
> c) the reporter will not or can not provide the information requested,
> usually not doing the regression testing

We should probably have such information on the wiki.
please :)


Jan



From eth.bell at gmail.com  Sat Apr 19 00:46:22 2008
From: eth.bell at gmail.com (El.)
Date: Sat, 19 Apr 2008 01:46:22 -0400
Subject: [PATCH] user32: Handle VK_RETURN KeyDown events more properly in
	EDITcontrols.
Message-ID: <3c72a4290804182246q5fbcc0dcxa8fe0cf28af5f783@mail.gmail.com>

> "El." <elptr at users.sourceforge.net> wrote:
>
> > @@ -4606,6 +4606,10 @@ static LRESULT EDIT_WM_KeyDown(EDITSTATE *es, INT key)
> >      {
> >    HWND hwndParent = GetParent(es->hwndSelf);
> >    DWORD dw = SendMessageW( hwndParent, DM_GETDEFID, 0, 0 );
> > +
> > +  if (GetClassLongW(hwndParent, GCW_ATOM) != WC_DIALOG)
> > +      break;
>
> You need to add a test case first to confirm that the fix is correct, and
> use EDIT_IsInsideDialog to detect if the parent is dialog.

Well I'm not sure what to test in the first place, I didn't assume that
modifying some aspect of the code to be in compliance with official
"standards" required writing any test case.

I might be missing what you mean by the "correctness" of the fix,
since I'm not really familiar with Wine's patching practices.

http://msdn2.microsoft.com/en-us/library/bb775464(VS.85).aspx

As for using EDIT_IsInsideDialog, that I can manage.


From hverbeet at gmail.com  Sat Apr 19 05:05:31 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Sat, 19 Apr 2008 12:05:31 +0200
Subject: WINED3D: Fix a possible null dereference.
In-Reply-To: <5f9140a20804181841o66aec35fr7bdb1252f1522333@mail.gmail.com>
References: <5f9140a20804181841o66aec35fr7bdb1252f1522333@mail.gmail.com>
Message-ID: <d658b69e0804190305l1de5644eib6ef4e4fa2943755@mail.gmail.com>

On 19/04/2008, David Adam <david.adam.cnrs at gmail.com> wrote:
> The Sting Demo calls the function
> IDirect3DDeviceImpl_7_SetMaterial (in ddraw/device.c) with
> Mat=NULL.
> Then, this makes the function IWineD3DDeviceImpl_SetMaterial (in
> wined3d/device.c) crashes in the line
> This->updateStateBlock->material = *pMaterial;
>  So, the patch checks is the material is not null before  assignating it.
>
> This fixes a crash in The Sting demo.
>
> David Adam
>
I would like to see a few tests that prove this is the correct
behaviour (instead of eg. simply returning WINED3DERR_INVALIDCALL),
for ddraw, d3d8 and d3d9.


From stefan at codeweavers.com  Sat Apr 19 07:55:32 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sat, 19 Apr 2008 14:55:32 +0200
Subject: [PATCH 2/2] wined3d: Prevent console spamming in drawPrimitive.
In-Reply-To: <d658b69e0804182219p140cc1d9jfffd1ba442a797bc@mail.gmail.com>
References: <480915AB.7060104@inbox.lv>
	<200804190637.51151.stefan@codeweavers.com>
	<d658b69e0804182219p140cc1d9jfffd1ba442a797bc@mail.gmail.com>
Message-ID: <200804191455.32766.stefan@codeweavers.com>

Am Samstag, 19. April 2008 07:19:17 schrieb H. Verbeet:
> Oh, I'm not opposed to the patch itself, preventing the log from
> getting spammed is a good thing. Just saying performance is the wrong
> reason.
Agreed



From dank at kegel.com  Sat Apr 19 10:58:10 2008
From: dank at kegel.com (Dan Kegel)
Date: Sat, 19 Apr 2008 08:58:10 -0700
Subject: [lostwages] update LGPL url, specify version
Message-ID: <a71bd89a0804190858x5d92bbc9i108d568e5bf03f6f@mail.gmail.com>

Somebody on wine-users asked us to clarify this, so:
-------------- next part --------------
A non-text attachment was scrubbed...
Name: license.patch
Type: text/x-patch
Size: 637 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080419/928f7507/attachment.bin 

From msclrhd at googlemail.com  Sat Apr 19 05:44:10 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Sat, 19 Apr 2008 11:44:10 +0100
Subject: [PATCH] user32: Handle VK_RETURN KeyDown events more properly in
	EDITcontrols.
In-Reply-To: <3c72a4290804182246q5fbcc0dcxa8fe0cf28af5f783@mail.gmail.com>
References: <3c72a4290804182246q5fbcc0dcxa8fe0cf28af5f783@mail.gmail.com>
Message-ID: <3f4fd2640804190344p7ef15efcgf25f3e4c0dc5129d@mail.gmail.com>

On 19/04/2008, El. <eth.bell at gmail.com> wrote:
> > "El." <elptr at users.sourceforge.net> wrote:
> >
> > > @@ -4606,6 +4606,10 @@ static LRESULT EDIT_WM_KeyDown(EDITSTATE *es, INT key)
> > >      {
> > >    HWND hwndParent = GetParent(es->hwndSelf);
> > >    DWORD dw = SendMessageW( hwndParent, DM_GETDEFID, 0, 0 );
> > > +
> > > +  if (GetClassLongW(hwndParent, GCW_ATOM) != WC_DIALOG)
> > > +      break;
> >
> > You need to add a test case first to confirm that the fix is correct, and
> > use EDIT_IsInsideDialog to detect if the parent is dialog.
>
> Well I'm not sure what to test in the first place, I didn't assume that
> modifying some aspect of the code to be in compliance with official
> "standards" required writing any test case.
>
> I might be missing what you mean by the "correctness" of the fix,
> since I'm not really familiar with Wine's patching practices.
>
> http://msdn2.microsoft.com/en-us/library/bb775464(VS.85).aspx

The MSDN documentation is a good source of information for how various
controls and APIs behave. However, this is only a starting point.

The aim of Wine is to match the behaviour of Windows, not the
documented behaviour. While the patch is likely to be correct, this is
not always the case.

The test case will be run on (and verified against) the different
versions of Windows. This will also test other things not explicitly
documented: what is the return value; is GetLastError set; what is the
sequence of messages sent in each case? All of these will add weight
to your fix.

The tests also serve another purpose. They allow the developers to
refactor, rewrite or address other issues in the code and have a
greater confidence that they haven't broken anything. If a bug is
reported and then fixed, if there isn't a valid test case for that
bug, there is a chance that the bug will reappear later on.

When you have documentation (such as MSDN) that describes behaviour
that is not supported in Wine, or differs in some way, the approach
should be to write tests to validate the documentation and then
implement it. That way, you have the verification that what you have
written is correct.

Thank you for improving Wine,
- Reece


From msclrhd at googlemail.com  Sat Apr 19 06:05:45 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Sat, 19 Apr 2008 12:05:45 +0100
Subject: [PATCH] user32: Handle VK_RETURN KeyDown events more properly in
	EDITcontrols.
In-Reply-To: <3c72a4290804182246q5fbcc0dcxa8fe0cf28af5f783@mail.gmail.com>
References: <3c72a4290804182246q5fbcc0dcxa8fe0cf28af5f783@mail.gmail.com>
Message-ID: <3f4fd2640804190405h5bedc77esf42fbdf4bb509a47@mail.gmail.com>

On 19/04/2008, El. <eth.bell at gmail.com> wrote:
> >
> > You need to add a test case first to confirm that the fix is correct, and
> > use EDIT_IsInsideDialog to detect if the parent is dialog.
>
> Well I'm not sure what to test in the first place, I didn't assume that
> modifying some aspect of the code to be in compliance with official
> "standards" required writing any test case.
>
> I might be missing what you mean by the "correctness" of the fix,
> since I'm not really familiar with Wine's patching practices.
>
> http://msdn2.microsoft.com/en-us/library/bb775464(VS.85).aspx

Reading the MSDN documentation for the behaviour of ES_MULTILINE, it
says "When the multiline edit control is in a dialog box, the default
response to pressing the ENTER key is to activate the default button.
To use the ENTER key as a carriage return, use the ES_WANTRETURN
style."

Therefore, I think your patch is incomplete, especially the part about
the ES_WANTRETURN style. As such, you will need tests to verify this.

In response to the enter key there are three behaviours:
1.  the default push button is not activated; the edit contents is unchanged.
2.  the default push button is activated; the edit contents is unchanged.
3.  the default push button is not activated; the edit contents has a
new line inserted at the current cursor position.

You have the following configurations with their associated behaviours:
  *  an edit control in a dialog without ES_MULTILINE and without
ES_WANTRETURN: behaviour (2).
  *  an edit control in a dialog with ES_MULTILINE and without
ES_WANTRETURN: behaviour (2).
  *  an edit control in a dialog with ES_MULTILINE and with
ES_WANTRETURN: behaviour (3).
  *  an edit control not in a dialog without ES_MULTILINE and without
ES_WANTRETURN: behaviour (1).
  *  an edit control not in a dialog with ES_MULTILINE and without
ES_WANTRETURN: behaviour (3).
  *  an edit control not in a dialog with ES_MULTILINE and with
ES_WANTRETURN: behaviour (3).

This is how I interpret that part of the MSDN documentation. This
gives you the test cases needed to verify that your fix works in all
these possibilities. It also ensures that someone wanting to improve
the edit control does not regress this functionality, or breaks
something else in the process.

Thank you for improving Wine,
- Reece


From hverbeet at gmail.com  Sat Apr 19 12:06:07 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Sat, 19 Apr 2008 19:06:07 +0200
Subject: WINED3D: Fix a possible null dereference (try 2)
In-Reply-To: <5f9140a20804190544s785b6d3cw8d8794ba51936c70@mail.gmail.com>
References: <5f9140a20804190544s785b6d3cw8d8794ba51936c70@mail.gmail.com>
Message-ID: <d658b69e0804191006j52909fb2h5b7ee3e3b173a676@mail.gmail.com>

On 19/04/2008, David Adam <david.adam.cnrs at gmail.com> wrote:
> This time, with tests for d3d8 and d3d9.
>
> David Adam
>

Looks mostly ok, but you do need a \n at the end of these ok messages:
> +    ok(hr == D3DERR_INVALIDCALL, "Expected D3DERR_INVALIDCALL, got %s",  DXGetErrorString8(hr));
> +    ok(hr == D3DERR_INVALIDCALL, "Expected D3DERR_INVALIDCALL, got %s",  DXGetErrorString9(hr));

> - * Copyright (C) 2006-2007 Stefan D?singer(For CodeWeavers)
> + * Copyright (C) 2006-2007 Stefan D???singer(For CodeWeavers)
Try not to change the encoding of the file.
I'm not sure if we ever considered simply using UTF-8 for source
files, but it would probably prevent some issues like this.


From thestig at google.com  Sat Apr 19 12:25:32 2008
From: thestig at google.com (Lei Zhang)
Date: Sat, 19 Apr 2008 10:25:32 -0700
Subject: [PATCH] user32: Handle VK_RETURN KeyDown events more properly in
	EDITcontrols.
In-Reply-To: <3f4fd2640804190405h5bedc77esf42fbdf4bb509a47@mail.gmail.com>
References: <3c72a4290804182246q5fbcc0dcxa8fe0cf28af5f783@mail.gmail.com>
	<3f4fd2640804190405h5bedc77esf42fbdf4bb509a47@mail.gmail.com>
Message-ID: <558b2f5c0804191025w52130288sbbffed094bc1d11a@mail.gmail.com>

On Sat, Apr 19, 2008 at 4:05 AM, Reece Dunn <msclrhd at googlemail.com> wrote:
>  Reading the MSDN documentation for the behaviour of ES_MULTILINE, it
>  says "When the multiline edit control is in a dialog box, the default
>  response to pressing the ENTER key is to activate the default button.
>  To use the ENTER key as a carriage return, use the ES_WANTRETURN
>  style."
>
>  Therefore, I think your patch is incomplete, especially the part about
>  the ES_WANTRETURN style. As such, you will need tests to verify this.
>
>  In response to the enter key there are three behaviours:
>  1.  the default push button is not activated; the edit contents is unchanged.
>  2.  the default push button is activated; the edit contents is unchanged.
>  3.  the default push button is not activated; the edit contents has a
>  new line inserted at the current cursor position.
>
>  You have the following configurations with their associated behaviours:
>   *  an edit control in a dialog without ES_MULTILINE and without
>  ES_WANTRETURN: behaviour (2).
>   *  an edit control in a dialog with ES_MULTILINE and without
>  ES_WANTRETURN: behaviour (2).
>   *  an edit control in a dialog with ES_MULTILINE and with
>  ES_WANTRETURN: behaviour (3).
>   *  an edit control not in a dialog without ES_MULTILINE and without
>  ES_WANTRETURN: behaviour (1).
>   *  an edit control not in a dialog with ES_MULTILINE and without
>  ES_WANTRETURN: behaviour (3).
>   *  an edit control not in a dialog with ES_MULTILINE and with
>  ES_WANTRETURN: behaviour (3).
>
>  This is how I interpret that part of the MSDN documentation. This
>  gives you the test cases needed to verify that your fix works in all
>  these possibilities. It also ensures that someone wanting to improve
>  the edit control does not regress this functionality, or breaks
>  something else in the process.

Edit controls get used in tons of applications, and its behavior can
be tricky to get right. Especially in the case of ES_MULTILINE without
ES_WANTRETURN. In the last two releases, I have managed to break the
edit control several times, and the thing that really helped me figure
out the proper fix is to write lots of test cases to cover as many
usage scenarios as possible.

Of course, writing tests is time consuming, and it's not always
possible to cover all the usage cases. With the native notepad bug,
it's because I didn't test the behavior when not inside a dialog box
well enough. I don't know if Reece's interpretation of MSDN is 100%
correct either, so the best thing to do is to write tests.

With regards to the patch, if EDIT_IsInsideDialog returns false, then
you don't want to send DM_GETDEFID either.


From thestig at google.com  Sat Apr 19 12:38:28 2008
From: thestig at google.com (Lei Zhang)
Date: Sat, 19 Apr 2008 10:38:28 -0700
Subject: [PATCH] user32: Handle VK_RETURN KeyDown events more properly in
	EDIT controls.
In-Reply-To: <3c72a4290804181550x5b550459o4a0a6c5b95c16962@mail.gmail.com>
References: <3c72a4290804181550x5b550459o4a0a6c5b95c16962@mail.gmail.com>
Message-ID: <558b2f5c0804191038y3db3314ew90f724ee04ccfd11@mail.gmail.com>

On Fri, Apr 18, 2008 at 3:50 PM, El. <elptr at users.sourceforge.net> wrote:
> When a ES_MULTILINE-styled EDIT responds to a VK_RETURN Key press, it should
> send a WM_COMMAND to the default control of the parent window if and only if
> that parent is a Dialog box. At least Microsoft's version of notepad.exe
> (WinXP) is fixed.
>

BTW,  bug 12478 [1] appears to be related to this.

[1] http://bugs.winehq.org/show_bug.cgi?id=12478


From dank at kegel.com  Sat Apr 19 18:48:51 2008
From: dank at kegel.com (Dan Kegel)
Date: Sat, 19 Apr 2008 16:48:51 -0700
Subject: Wine countdown?
Message-ID: <a71bd89a0804191648y4a6c2c27h4edf8129fda402b7@mail.gmail.com>

Anybody seen the nifty countdown logo that Ubuntu is using?
http://www.ubuntu.com/getubuntu/countdown
Maybe we should do something similar for Wine.

FWIW, here's a snippet that does something similar, but with text:

<h1>Wine Release Countdown</h1>
<script type='text/javascript'>
function days_between(date1, date2) {
    // The number of milliseconds in one day
    var ONE_DAY = 1000 * 60 * 60 * 24;
    // Convert both dates to milliseconds
    var date1_ms = date1.getTime();
    var date2_ms = date2.getTime();
    // Calculate the difference in milliseconds
    var difference_ms = date2_ms - date1_ms;
    // Convert back to days and return
    return Math.round(difference_ms/ONE_DAY);
}
var d = new Date();
var release = new Date();
// see http://wiki.winehq.org/WineReleasePlan
release.setTime(Date.parse("Jun 13, 2008"));

document.write('<a href="http://www.winehq.org/">Wine 1.0 countdown: '
+days_between(d, release)+' days to release!</a>');
</script>


From stefan at codeweavers.com  Sat Apr 19 22:23:03 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sun, 20 Apr 2008 05:23:03 +0200
Subject: WINED3D: Fix a possible null dereference (try 2)
In-Reply-To: <d658b69e0804191006j52909fb2h5b7ee3e3b173a676@mail.gmail.com>
References: <5f9140a20804190544s785b6d3cw8d8794ba51936c70@mail.gmail.com>
	<d658b69e0804191006j52909fb2h5b7ee3e3b173a676@mail.gmail.com>
Message-ID: <200804200523.04086.stefan@codeweavers.com>

Am Samstag, 19. April 2008 19:06:07 schrieb H. Verbeet:
> Try not to change the encoding of the file.
> I'm not sure if we ever considered simply using UTF-8 for source
> files, but it would probably prevent some issues like this.
I could change my name :-)

There was some consideration of UTF 8, but AJ says some other changes are 
needed; not sure what that was, maybe the archives know more


From dmitry at codeweavers.com  Sun Apr 20 01:10:06 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sun, 20 Apr 2008 15:10:06 +0900
Subject: kernel32: Skip the screen buffer tests if codepage 866 is
	notavailable
References: <22821af30804192159q671043aegf78d9fbcfd5cc5c8@mail.gmail.com>
Message-ID: <01b501c8a2ad$2ff9a170$a600fea9@DMITRY>

"James Hawkins" <jhawkins at codeweavers.com> wrote:

> +    res = RegOpenKeyA(HKEY_LOCAL_MACHINE,
> +                      "System\\CurrentControlSet\\Control\\Nls\\CodePage", &hkey);
> +    if (res == ERROR_SUCCESS)
> +    {
> +        len = 20;
> +        res = RegQueryValueExA(HKEY_LOCAL_MACHINE, "866", NULL,
> +                               NULL, (LPBYTE)str_buf, &len);
> +    }

Could IsValidCodePage() be used instead?

-- 
Dmitry.


From truiken at gmail.com  Sun Apr 20 01:15:37 2008
From: truiken at gmail.com (James Hawkins)
Date: Sun, 20 Apr 2008 01:15:37 -0500
Subject: kernel32: Skip the screen buffer tests if codepage 866 is
	notavailable
In-Reply-To: <01b501c8a2ad$2ff9a170$a600fea9@DMITRY>
References: <22821af30804192159q671043aegf78d9fbcfd5cc5c8@mail.gmail.com>
	<01b501c8a2ad$2ff9a170$a600fea9@DMITRY>
Message-ID: <22821af30804192315o300e39f2n899ca0efd675f95f@mail.gmail.com>

On Sun, Apr 20, 2008 at 1:10 AM, Dmitry Timoshkov
<dmitry at codeweavers.com> wrote:
> "James Hawkins" <jhawkins at codeweavers.com> wrote:
>
>
> > +    res = RegOpenKeyA(HKEY_LOCAL_MACHINE,
> > +
> "System\\CurrentControlSet\\Control\\Nls\\CodePage", &hkey);
> > +    if (res == ERROR_SUCCESS)
> > +    {
> > +        len = 20;
> > +        res = RegQueryValueExA(HKEY_LOCAL_MACHINE, "866", NULL,
> > +                               NULL, (LPBYTE)str_buf, &len);
> > +    }
> >
>
>  Could IsValidCodePage() be used instead?
>

Indeed it could.  Thanks for the tip.

-- 
James Hawkins


From dank at kegel.com  Sun Apr 20 02:45:55 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 20 Apr 2008 00:45:55 -0700
Subject: Strange struct alignment errors?
Message-ID: <a71bd89a0804200045n57eeb6d1k2abc149f0869731d@mail.gmail.com>

http://test.winehq.org/data/94883af56d7348228963d7e70a5af578310c2228/wine_xp_icc-3/ntdll:generated.txt
looks kinda funny.  Is somebody compiling the tests
wrong somehow?


From truiken at gmail.com  Sun Apr 20 02:52:32 2008
From: truiken at gmail.com (James Hawkins)
Date: Sun, 20 Apr 2008 02:52:32 -0500
Subject: Strange struct alignment errors?
In-Reply-To: <a71bd89a0804200045n57eeb6d1k2abc149f0869731d@mail.gmail.com>
References: <a71bd89a0804200045n57eeb6d1k2abc149f0869731d@mail.gmail.com>
Message-ID: <22821af30804200052y6c03c8efh8c56d22282bd0848@mail.gmail.com>

On Sun, Apr 20, 2008 at 2:45 AM, Dan Kegel <dank at kegel.com> wrote:
> http://test.winehq.org/data/94883af56d7348228963d7e70a5af578310c2228/wine_xp_icc-3/ntdll:generated.txt
>  looks kinda funny.  Is somebody compiling the tests
>  wrong somehow?
>

If the tag (wine_xp_icc-3) is any hint, the tests were compiled with
icc, which might not handle the alignment headers (#include
<pshpack2.h>) correctly.

-- 
James Hawkins


From dank at kegel.com  Sun Apr 20 02:57:24 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 20 Apr 2008 00:57:24 -0700
Subject: Strange struct alignment errors?
In-Reply-To: <22821af30804200052y6c03c8efh8c56d22282bd0848@mail.gmail.com>
References: <a71bd89a0804200045n57eeb6d1k2abc149f0869731d@mail.gmail.com>
	<22821af30804200052y6c03c8efh8c56d22282bd0848@mail.gmail.com>
Message-ID: <a71bd89a0804200057l4a91f644x45f99a17f53bcf47@mail.gmail.com>

On Sun, Apr 20, 2008 at 12:52 AM, James Hawkins <truiken at gmail.com> wrote:
>  > http://test.winehq.org/data/94883af56d7348228963d7e70a5af578310c2228/wine_xp_icc-3/ntdll:generated.txt
>
>  If the tag (wine_xp_icc-3) is any hint, the tests were compiled with
>  icc, which might not handle the alignment headers (#include
>  <pshpack2.h>) correctly.

Shoot, icc ought to be able to handle those, but
you're right, we should ignore any icc results.
Thanks for noticing that.


From dank at kegel.com  Sun Apr 20 05:13:22 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 20 Apr 2008 03:13:22 -0700
Subject: Wine 1.0 status: T minus 54 days,
	63 bugs to go. Code freeze in 12 days.
Message-ID: <a71bd89a0804200313r5f12f67dv4b3418cf45a01b3a@mail.gmail.com>

See
   http://kegel.com/wine/countdown.html
for a current (and clickable) status report.  Here's what it says now:

Wine Release Countdown
Wine 1.0 countdown: 54 days to release, 12 days to freeze!

See WineReleasePlan for details.

wine-0.9.60 was released on Friday, April 20th, 2008.

According to http://wiki.winehq.org/WineReleasePlan wine-0.9.61, due
out Friday, May 2, 2008, will be the first release candidate for 1.0,
and mark the start of the code freeze.

During the code freeze, patches that
    * are simple
    * come with a conformance test
    * fix a regression
    * are low risk
are more likely to get in than other patches. (Heck, that's always
true, but it's even truer during a freeze.) We will actively
discourage patches that might endanger the 1.0 release date (June
13th).

Bug Status

There are 63 open 1.0 bugs as of 20 April. Most of these will simply
be rolled over to be fixed for a later release; we only have time to
fix a few, and much as we'd like to fix the rest, most are not
showstoppers.

Changes since last week (with category and votes):

New (!):
12666  -unknown        0       Wine should refuse to run if pointed at
a real Windows

Fixed:
7477   -unknown        1       Uplink demo crashes
9809   shell32         4       Autodesk Revit Architecture 2008 install fails
12561   -unknown       0       Photoshop CS alt key for clone/healing
- possible regression

Duplicate:
2539   ole             3       XDND (Drag and drop for X Windows)
doesn't copy text
6607   ole             10      Drag and Drop not working

Deferred:
5541   kernel32        0       WriteConsole can't write to stdout;
affects e.g. wsh's cscript's usage message
9484   kernel32        19      Program refuses to run because of
ProtectCD/ProtectDISC copy-protection

Here's the full list of current bugs:

5055    -unknown        5       Deleting files from a window in wine
doesn't send them to the Trash
5061    -unknown        6       Copying from Windows Firefox in Wine
and pasting to Linux OpenOffice pastes metadata as data
5402    -unknown        0       Trying to run PhotoStitch 3.1
5844    -unknown        12      tray minimize
5948    -unknown        1       Star Trek: Armada does not install
7404    -unknown        3       ShowWindow(SW_MINIMIZE) should not
generate a WM_PAINT message
8125    -unknown        0       Marratech 6.1 crashes on start
9178    -unknown        8       "hello world" dos program hangs
9916    -unknown        6       "make test" usually fails
9959    -unknown        9       Make wine updates work even if the
registry changed
10815   -unknown        5       Cannot drag images into Adobe
Photoshop 7 from the web / desktop
11281   -unknown        4       CJK input many issues
12097   -unknown        3       Wine 1.0 should not ship out-of-sync
resource translations
12246   -unknown        2       "make test" gives different results
with and without warn+heap
12666   -unknown        0       Wine should refuse to run if pointed
at a real Windows
11420   advapi32        0       service control manager API problem:
name of named objects might differ (client vs. service process)
556     build-en        1       Reconcile the Windows and Wine spec files
1114    comctl32        3       Winrar2.90/3.00: Comboex doesn't
trigger a event when you mouse-click in some value of it
2493    comctl32        2       Multi-select listview: Shift-arrow up
only selects top two items
4372    comctl32        1       listview: cannot drag several items
11509   crypt32         0       Wordviewer 2003 is unable to open
documents encrypted with AES
5535    directx-        17      Planescape:Torment doesn't work
9030    directx-        0       army men hangs on black screen
11681   directx-        17      Add support for video overlay
3270    gdi32           15      Problem with minimized top-level windows
6519    gdi32           7       Wine blacks out rotated font bitmap
7571    gdi32           1       Accented character glyphs are mixed up
with TrueType fonts (affects e.g. Lotus Notes R5)
9771    gdi32           45      Steam Friends doesn't work (fails to
render correctly or refresh)
5024    kernel32        4       Thief: Deadly Shadows crashes:page
fault on read access to 0x0000040c
5351    kernel32        11      Windows Installer 3.1 cannot install
because of non-standard drive labeling
9039    kernel32        0       GS-Auftrag Professional SQL aborts on startup
7098    mscoree         1       RufzXP crashes on startup, needs
mscoree.dll.CorBindToRuntimeEx
10147   msi             1       Word Viewer 2003 - Tab behavior
differs from Windows
8783    ntdll           13      USB serial ports do not work
9356    ntdll           8       Serial communication not working since
wine-0.9.33
8095    ole             0       PQ Teaching toy crashes
9942    ole             2       Powerpoint Viewer 2007 crashes opening
.pptx files
5926    programs        1       Wine does not provide an
implementation of winhlp32.exe
5163    setupapi        13      Office XP 2002 crashes on installation
3546    shdocvw         2       CLSID_InternetShortcut not available...
6095    shdocvw         15      MOTD in counter-strike 1.6 and
counter-strike source does not render
8898    shdocvw         1       Run Time Error "445": Object doesn't
support this action in Europa Knowledgebase
9304    shdocvw         4       Temple of Elemental Evil demo doesn't
start - gui irresponsive
8439    shell32         8       Visual Studio .NET (7) install fails
10905   shell32         0       thinstall firefox demo requires native msvcrt
11742   shlwapi         9       Small .net 1.1 app (FastMD5 1.3) fails
to start up
12074   testcase        2       The conformance tests fail on Windows
6604    tools           3       Ship icons for the wine-tools that can
be used in .desktop files
664     user32          7       The help menu functionality inside
programs is broken (messaging problem)
3023    user32          6       Orcad - "Place Part" never tries to
put down a part
4523    user32          5       Can't copy from Firefox 1.5 and paste
into OpenOffice 2 under Wine
124     wineserv        2       Review of Wine Server Protocol
1990    winex11.        1       modifier keys not released when
switching desktop
2368    winex11.        7       Wine loses its X-Window when switching
to another virt. desktop in Fvwm
3297    winex11.        13      UpdateWindow() doesn't call XFlush()
5623    winex11.        4       GetAsyncKeyState wrong if querying
process doesn't have focus
5828    winex11.        25      Command and Conquer Generals (Zero
Hour) doesn't change the mouse cursor from the default X mouse
7372    winex11.        12      can't copy and paste between gnome
apps eg openoffice or gimp and wine apps such as dreamweaver or adobe
photoshop
10984   winex11.        6       sun jre 5 update 10 installer hangs in 0.9.52
11019   winex11.        4       matlab r14 and r16 (7.0.4 and 7.3.0)
and WriteItNow3.1.0s hang if X in 24bpp mode
5625    wininet         4       Wine does not handle internet proxy
settings conveniently
9787    winsock         50      Warcraft3 Battle.net Doesn't work
(Needs AcceptEx)
12005   wintab32        1       Regression in pressure sensitivity
with wizardpen tablet driver and Photoshop 7


From tehblunderbuss at gmail.com  Sun Apr 20 09:52:52 2008
From: tehblunderbuss at gmail.com (TheBlunderbuss)
Date: Sun, 20 Apr 2008 09:52:52 -0500
Subject: Wine countdown?
In-Reply-To: <a71bd89a0804191648y4a6c2c27h4edf8129fda402b7@mail.gmail.com>
References: <a71bd89a0804191648y4a6c2c27h4edf8129fda402b7@mail.gmail.com>
Message-ID: <480B58C4.5090500@gmail.com>

Dan Kegel wrote:
> Anybody seen the nifty countdown logo that Ubuntu is using?
> http://www.ubuntu.com/getubuntu/countdown
> Maybe we should do something similar for Wine.
Yes we should!


From dank at kegel.com  Sun Apr 20 15:49:23 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 20 Apr 2008 13:49:23 -0700
Subject: MSIME support causing slow setup until explorer.exe paused?
Message-ID: <a71bd89a0804201349v6f827eb7ke6a7717ea3c7fdda@mail.gmail.com>

I tried installing StarUML (after doing winetricks vcrun6 msxml3, as required),
and the setup crept along very slowly... so I got curious and ran top.
Most of the cpu time was being used by Explorer and wineserver,
and interestingly, if I suspended Explorer by doing
  strace -p <pid of explorer>
and then pressing ^S, the install ran awful darn fast.

So, what was explorer doing that was slowing things down so much?

writev(3, [{"l\0\0\0\30\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"...,
64}, {"M\0S\0I\0M\0E\0S\0e\0r\0v\0i\0c\0e\0", 24}], 2) = 88
...
writev(3, [{"l\0\0\0*\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"...,
64}, {"M\0S\0I\0M\0E\0R\0e\0c\0o\0n\0v\0e\0r\0t\0O\0p\0"..., 42}], 2)
= 106
...
writev(3, [{"l\0\0\0&\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"...,
64}, {"M\0S\0I\0M\0E\0M\0o\0u\0s\0e\0O\0p\0e\0r\0a\0t\0"..., 38}], 2)
= 102
...
writev(3, [{"l\0\0\0*\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"...,
64}, {"M\0S\0I\0M\0E\0R\0e\0c\0o\0n\0v\0e\0r\0t\0R\0e\0"..., 42}], 2)
= 106
...

This persisted in the app, too, not just in the installer.

So it kind of sounds like our msime support is hurting us performance-wise?
- Dan


From dank at kegel.com  Sun Apr 20 18:04:51 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 20 Apr 2008 16:04:51 -0700
Subject: Regressions: the enemy of 1.0
Message-ID: <a71bd89a0804201604h20314163mc0b84437a45b269c@mail.gmail.com>

There's been lots of progress in Wine lately; many
important applications work better than ever.
But the inevitable cost of such progress is that
some applications are now broken and/or
wine has odd problems.

For instance, as of the last two versions of Wine,
StarUML can't be unminimized
( http://bugs.winehq.org/show_bug.cgi?id=12697 ),
and as of 0.9.60, the IME support seems to be
making wine apps run dog slow on at least one
of my machines
( http://www.winehq.org/pipermail/wine-devel/2008-April/064999.html ).
These seem like regressions that ought to be fixed
before 1.0.

So... I guess my point is: the code freeze is starting soon,
which is good; that will help coax developers into looking
for and fixing recently introduced bugs rather than old ones.
i.e. fight to hang on to what we've got (or had recently)
rather than pushing to conquer new ground.

Those who absolutely have to work on risky new stuff
in the meantime will increasingly have to keep their
work outside the main tree for now.
Once 1.0 is out, those patches can land, and
the fight for new ground can resume.


From wine-devel at kievinfo.com  Sun Apr 20 19:02:08 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sun, 20 Apr 2008 18:02:08 -0600
Subject: [1/4] dinput: Return error for unknown property.
In-Reply-To: <480BC94D.2080006@gmail.com>
References: <480BC94D.2080006@gmail.com>
Message-ID: <480BD980.1000605@kievinfo.com>

Sergey Khodych wrote:
> 
> 
> -            WARN("Unknown property %s\n", debugstr_guid(rguid));
> -            break;
> +            FIXME("Unknown property %s\n", debugstr_guid(rguid));
> +            return DIERR_UNSUPPORTED;
I'd like to see tests for this. Also lots of programs will break because 
they won't get some not significant property. No short - don't do this.

Vitaliy


From wine-devel at kievinfo.com  Sun Apr 20 20:16:13 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sun, 20 Apr 2008 19:16:13 -0600
Subject: [4/4] Add test for IDirectInputDevice_GetProperty of keyboard
	device   for unicode and ascii case.
In-Reply-To: <480BC96F.3040900@gmail.com>
References: <480BC96F.3040900@gmail.com>
Message-ID: <480BEADD.3040904@kievinfo.com>

Sergey Khodych wrote:
> 
> 
> ------------------------------------------------------------------------
> 
> 

> +    result =  wcsncmp( dipsw.wsz, dipsa.wsz, sizeof( dipsw.wsz )/sizeof( dipsw.wsz[0] ) );
UNIX unicode and windows unicode are two separate things. Don't use 
functions that work with wchar_t - they are not compatible with Wine. Use 
Wine's own unicode functions instead. For example here you can use lstrcmpW().

Vitaliy.


From winehacker at gmail.com  Sun Apr 20 23:00:24 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Mon, 21 Apr 2008 00:00:24 -0400
Subject: Regressions: the enemy of 1.0
In-Reply-To: <a71bd89a0804201604h20314163mc0b84437a45b269c@mail.gmail.com>
References: <a71bd89a0804201604h20314163mc0b84437a45b269c@mail.gmail.com>
Message-ID: <19e31a080804202100t27d440e6w732c296bbae0074a@mail.gmail.com>

On Sun, Apr 20, 2008 at 7:04 PM, Dan Kegel <dank at kegel.com> wrote:
> There's been lots of progress in Wine lately; many
>  important applications work better than ever.
>  But the inevitable cost of such progress is that
>  some applications are now broken and/or
>  wine has odd problems.

Yes Office 2000/XP installs have totally regressed recently. While
great improvements have been made for Photoshop and newer Office
versions, it is frustrating that we are so close to Wine 1.0 and it
might not even be able to install Office 2000.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From m.b.lankhorst at gmail.com  Sun Apr 20 23:41:05 2008
From: m.b.lankhorst at gmail.com (Maarten Lankhorst)
Date: Sun, 20 Apr 2008 21:41:05 -0700
Subject: Regressions: the enemy of 1.0
In-Reply-To: <a71bd89a0804201604h20314163mc0b84437a45b269c@mail.gmail.com>
References: <a71bd89a0804201604h20314163mc0b84437a45b269c@mail.gmail.com>
Message-ID: <b130c85e0804202141v18ce9335geba9f7186fa3e4a2@mail.gmail.com>

Hi Dan,

2008/4/20, Dan Kegel <dank at kegel.com>:
> There's been lots of progress in Wine lately; many
>  important applications work better than ever.
>  But the inevitable cost of such progress is that
>  some applications are now broken and/or
>  wine has odd problems.
>
>  For instance, as of the last two versions of Wine,
>  StarUML can't be unminimized
>  ( http://bugs.winehq.org/show_bug.cgi?id=12697 ),
>  and as of 0.9.60, the IME support seems to be
>  making wine apps run dog slow on at least one
>  of my machines
>  ( http://www.winehq.org/pipermail/wine-devel/2008-April/064999.html ).
>  These seem like regressions that ought to be fixed
>  before 1.0.
Worse still, after all of the work I've done on getting most tests
running there have been 3 new failures in make test:

setupapi/devinst.ok
devinst.c:831: Test failed: SetupDiEnumDeviceInterfaces failed: 00000103
devinst.c:850: Test failed: Unexpected path ?
devinst.c:920: Test failed: Expected ERROR_INVALID_DATA, got deadbeef
devinst.c:925: Test failed: Expected ERROR_INSUFFICIENT_BUFFER, got deadbeef
devinst.c:1013: Test failed: Expected ERROR_INVALID_DATA, got deadbeef
devinst.c:1018: Test failed: Expected ERROR_INSUFFICIENT_BUFFER, got deadbeef
msxml3/domdoc.ok
domdoc.c:2323: Test failed: ret 80004005
domdoc.c:2327: Test failed: incorrect get_text string
mshtml/dom.ok
dom.c:1048: Test failed: Could not get
{3050F4AE-98B5-11CF-BB82-00AA00BDCE0B} interface: 80004002

Is anyone working in these areas willing to look into the test failures?

Cheers,

Maarten.

From dmitry at codeweavers.com  Mon Apr 21 01:06:55 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Mon, 21 Apr 2008 15:06:55 +0900
Subject: user32: Use the PostMessage() for WM_IME_KEY{DOWN|UP} message
References: <1208754207.10521.4.camel@localhost>
Message-ID: <038001c8a375$e8b4e710$a600fea9@DMITRY>

"ByeongSik Jeon" <bsjeon at hanmail.net> wrote:

> * MS Spi++ test result, PostMessage is right.
> * Message generation sequence:
>   WM_IME_KEYDOWN -> WM_KEYDOWN -> WM_CHAR
>   WM_CHAR is genetated in the TranslateMessage() when we use
>   PostMessage() function.
> * Real case: MS IME 2002, MS IME 2003, Saenaru
>   In the preedit mode, when we press the "ENTER" key, Korean
>   Native IME generate the WM_IME_KEYDOWN(wParam==VK_RETURN) message.
>   This message is translated to the WM_CHAR(wParam==VK_RETURN)
>   message finally.

You should add the tests to dlls/user32/tests/msg.c for the above changes.

-- 
Dmitry.


From mle+win at mega-nerd.com  Mon Apr 21 02:16:03 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Mon, 21 Apr 2008 17:16:03 +1000
Subject: Wine64?
Message-ID: <20080421171603.8ea1aa71.mle+win@mega-nerd.com>

Hi all,

I'm interested in the current state of work towards Wine64, ie
running Win64 binaries on x86_64 Linux machines.

My needs are actually really simple and hence may be a good base
functionality to work towards. I just need to run Win64 binaries
that read stdin, write stdout/stderr and do file I/O using the
standard windows CreateFile/ReadFile/WriteFile/CloseHandle/
SetFilePointer etc functions.

I have found and read this:

    http://wiki.winehq.org/Wine64

but some of that stuff seems rather out-of-date.

When I configure with --enable-win64 it configures fine but then
errors out in widl generated code because of things like this:

    #if !defined(__RPC_WIN32__)
    #error Currently only Wine and WIN32 are supported.
    #endif

So, is anybody working on Wine64 stuff? Is there a Wine64 TODO list?
Any way for me to get involved?

Cheers,
Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
"If you have one apple and I have one apple, if we exchange, each will
have one apple. If you have one idea and i have one idea, if we exchange
them, each will have two ideas!" -- Attributed to George Bernard Shaw


From ivan at etersoft.ru  Mon Apr 21 03:29:35 2008
From: ivan at etersoft.ru (Ivan Sinitsin)
Date: Mon, 21 Apr 2008 12:29:35 +0400
Subject: Question about openning html document in new window
Message-ID: <200804211229.35940.ivan@etersoft.ru>

Hello, I have a question.

I make a patch, that fix problem with open html document in new window. I 
tested it on "MyIE 2" and it works. But I am not assured, whether it is 
possible to solve a problem in this way.

What do you think about it?

-- 
Sinitsin Ivan
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dlls-shdoxvw-navigate.c
Type: text/x-csrc
Size: 830 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080421/e3ef9af3/attachment.c 

From astrand at cendio.se  Mon Apr 21 03:54:07 2008
From: astrand at cendio.se (=?UTF-8?Q?Peter_=C3=85strand?=)
Date: Mon, 21 Apr 2008 10:54:07 +0200 (CEST)
Subject: winmm/tests: waveOutGetDevCaps called with invalid size
In-Reply-To: <4808B145.2010609@earthlink.net>
References: <Pine.LNX.4.64.0804181102080.23847@maggie.lkpg.cendio.se>
	<4808B145.2010609@earthlink.net>
Message-ID: <Pine.LNX.4.64.0804211050260.12791@maggie.lkpg.cendio.se>

On Fri, 18 Apr 2008, Robert Reif wrote:

> > -    rc=waveOutGetDevCapsA(device,&capsA,4);
> > +    /* Final call must succeed, capsA will be used below */
> > +    rc=waveOutGetDevCapsA(device,&capsA,sizeof(capsA));
> >      ok(rc==MMSYSERR_NOERROR,
> >         "waveOutGetDevCapsA(%s): MMSYSERR_NOERROR expected, got %s\n",
> >         dev_name(device),wave_out_error(rc));
> > -
> > -    rc=waveOutGetDevCapsW(device,&capsW,4);
> > -    ok(rc==MMSYSERR_NOERROR || rc==MMSYSERR_NOTSUPPORTED,
> > -       "waveOutGetDevCapsW(%s): MMSYSERR_NOERROR or MMSYSERR_NOTSUPPORTED "
> > -       "expected, got %s\n",dev_name(device),wave_out_error(rc));
> > +    if (rc!=MMSYSERR_NOERROR)
> > +	return;


> That's the whole point of the test, to check what happens with an invalid
> argument.

So what do you think *should* happen with an invalid argument? The result 
is different on different Windows platforms. The behaviour is not 
specified by MSDN. 

In any case, continuing and executing code that uses "capsA" even though 
the waveOutGetDevCapsA call failed is definitely wrong. 

 
Rgds, 
---
Peter ?strand		ThinLinc Chief Developer
Cendio AB		http://www.cendio.se
Wallenbergs gata 4
583 30 Link?ping	Phone: +46-13-21 46 00

From julliard at winehq.org  Mon Apr 21 05:36:33 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 21 Apr 2008 12:36:33 +0200
Subject: [PATCH 09/17] widl: Split the expr rule up into multiple rules to
	fix operator precedence.
In-Reply-To: <480BB2A5.6050609@codeweavers.com> (Robert Shearman's message of
	"Sun, 20 Apr 2008 22:16:21 +0100")
References: <480BB2A5.6050609@codeweavers.com>
Message-ID: <87prsj4hqm.fsf@wine.dyndns.org>

Robert Shearman <rob at codeweavers.com> writes:

> @@ -263,8 +263,14 @@ static void add_explicit_handle_if_necessary(func_t *func);
>  %type <attr> attribute
>  %type <attr_list> m_attributes attributes attrib_list
>  %type <str_list> str_list
> -%type <expr> m_expr expr expr_const
> -%type <expr_list> m_exprs /* exprs expr_list */ expr_list_const
> +%type <expr> m_expr expr_const expression conditional_expression
> +%type <expr> conditional_expression logical_OR_expression logical_AND_expression
> +%type <expr> inclusive_OR_expression exclusive_OR_expression AND_expression
> +%type <expr> equality_expression relational_expression shift_expression
> +%type <expr> additive_expression additive_expression multiplicative_expression
> +%type <expr> cast_expression unary_expression postfix_expression
> +%type <expr> primary_expression
> +%type <expr_list> m_exprs expr_list_const
>  %type <array_dims> array array_list
>  %type <ifinfo> interfacehdr
>  %type <type> inherit interface interfacedef interfacedec

You shouldn't need that, the %left/%right declarations should define the
correct precedence already. Why doesn't this work for you?

-- 
Alexandre Julliard
julliard at winehq.org


From aric at codeweavers.com  Mon Apr 21 07:12:49 2008
From: aric at codeweavers.com (Aric Stewart)
Date: Mon, 21 Apr 2008 07:12:49 -0500
Subject: MSIME support causing slow setup until explorer.exe paused?
In-Reply-To: <a71bd89a0804201349v6f827eb7ke6a7717ea3c7fdda@mail.gmail.com>
References: <a71bd89a0804201349v6f827eb7ke6a7717ea3c7fdda@mail.gmail.com>
Message-ID: <480C84C1.80003@codeweavers.com>

Humm,

   MSIMEService, MSIMEReconvertOptions, MSIMEMouseOperator, etc... those 
are all Messages that Microsoft Office looks for and sends to the IME 
during operations.  For the most part all those messages are just stubbed.

   The messages are Registered in Imm32/imm.c once per process, and also 
registered in winex11.drv/ime.c also once per process. I am pretty sure 
we do not send those messages somewhere. So I am not sure why they would 
be taking up so much cpu time.

Do you know what is happening with the messages during the slow-down?
thanks,
-aric


Dan Kegel wrote:
> I tried installing StarUML (after doing winetricks vcrun6 msxml3, as required),
> and the setup crept along very slowly... so I got curious and ran top.
> Most of the cpu time was being used by Explorer and wineserver,
> and interestingly, if I suspended Explorer by doing
>   strace -p <pid of explorer>
> and then pressing ^S, the install ran awful darn fast.
> 
> So, what was explorer doing that was slowing things down so much?
> 
> writev(3, [{"l\0\0\0\30\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"...,
> 64}, {"M\0S\0I\0M\0E\0S\0e\0r\0v\0i\0c\0e\0", 24}], 2) = 88
> ...
> writev(3, [{"l\0\0\0*\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"...,
> 64}, {"M\0S\0I\0M\0E\0R\0e\0c\0o\0n\0v\0e\0r\0t\0O\0p\0"..., 42}], 2)
> = 106
> ...
> writev(3, [{"l\0\0\0&\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"...,
> 64}, {"M\0S\0I\0M\0E\0M\0o\0u\0s\0e\0O\0p\0e\0r\0a\0t\0"..., 38}], 2)
> = 102
> ...
> writev(3, [{"l\0\0\0*\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"...,
> 64}, {"M\0S\0I\0M\0E\0R\0e\0c\0o\0n\0v\0e\0r\0t\0R\0e\0"..., 42}], 2)
> = 106
> ...
> 
> This persisted in the app, too, not just in the installer.
> 
> So it kind of sounds like our msime support is hurting us performance-wise?
> - Dan
> 
> 


From aric at codeweavers.com  Mon Apr 21 07:17:19 2008
From: aric at codeweavers.com (Aric Stewart)
Date: Mon, 21 Apr 2008 07:17:19 -0500
Subject: imm32: Fix a test that fails on all systems
In-Reply-To: <22821af30804201849h426d63ffu7a13b02bb0a4e265@mail.gmail.com>
References: <22821af30804201849h426d63ffu7a13b02bb0a4e265@mail.gmail.com>
Message-ID: <480C85CF.9040703@codeweavers.com>

Are this tests failing on windows?

When I did my recent IME work I was working to make sure that these 
tests succeeded at that time.

have they started failing on wine as well?

thanks,
-aric


James Hawkins wrote:
> Hi,
> 
> Changelog:
> * Fix a test that fails on all systems.
> 
>  dlls/imm32/tests/imm32.c |   30 +++++++++++++++++++++---------
>  1 files changed, 21 insertions(+), 9 deletions(-)
> 
> 
> 
> ------------------------------------------------------------------------
> 
> 


From rob at codeweavers.com  Mon Apr 21 08:33:20 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Mon, 21 Apr 2008 14:33:20 +0100
Subject: [PATCH 09/17] widl: Split the expr rule up into multiple rules
	to fix operator precedence.
In-Reply-To: <87prsj4hqm.fsf@wine.dyndns.org>
References: <480BB2A5.6050609@codeweavers.com> <87prsj4hqm.fsf@wine.dyndns.org>
Message-ID: <480C97A0.7020706@codeweavers.com>

Alexandre Julliard wrote:
> You shouldn't need that, the %left/%right declarations should define the
> correct precedence already. Why doesn't this work for you?

I was attempting to fix the attached case. The result of the expression 
evaluation can be seen in the generated _c.c file by searching for "/* 
Corr desc:  constant, val=".

I see that the issue is that the %left and %right declarations aren't in 
the correct order (and some aren't grouped properly either).

So this bug can indeed be fixed without splitting up expr into multiple 
rules.

-- 
Rob Shearman

-------------- next part --------------
A non-text attachment was scrubbed...
Name: expr_test.idl
Type: text/x-idl
Size: 192 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080421/c7cc0d4e/attachment.bin 

From truiken at gmail.com  Mon Apr 21 09:11:01 2008
From: truiken at gmail.com (James Hawkins)
Date: Mon, 21 Apr 2008 09:11:01 -0500
Subject: imm32: Fix a test that fails on all systems
In-Reply-To: <480C85CF.9040703@codeweavers.com>
References: <22821af30804201849h426d63ffu7a13b02bb0a4e265@mail.gmail.com>
	<480C85CF.9040703@codeweavers.com>
Message-ID: <22821af30804210711i3fa4e5bevaff564b2e14db86a@mail.gmail.com>

On Mon, Apr 21, 2008 at 7:17 AM, Aric Stewart <aric at codeweavers.com> wrote:
> Are this tests failing on windows?
>
>  When I did my recent IME work I was working to make sure that these tests
> succeeded at that time.
>
>  have they started failing on wine as well?
>

Yes, they fail on all versions:

http://test.winehq.org/data/200804191000/

Well, they 'pass' on wine, but that doesn't match the behavior of
native windows.

-- 
James Hawkins


From julliard at winehq.org  Mon Apr 21 09:53:18 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 21 Apr 2008 16:53:18 +0200
Subject: msxml3: Correct transformNode from failing on windows
In-Reply-To: <fueho1$j8r$1@ger.gmane.org> (Alistair Leslie-Hughes's message of
	"Sun, 20 Apr 2008 14:43:33 +1000")
References: <fueho1$j8r$1@ger.gmane.org>
Message-ID: <87fxtf45up.fsf@wine.dyndns.org>

Alistair Leslie-Hughes <leslie_alistair at hotmail.com> writes:

> diff --git a/dlls/msxml3/tests/domdoc.c b/dlls/msxml3/tests/domdoc.c
> index 6f790fe..b06e57e 100644
> --- a/dlls/msxml3/tests/domdoc.c
> +++ b/dlls/msxml3/tests/domdoc.c
> @@ -143,7 +143,11 @@ static  const CHAR szTransformSSXML[] =
>  "</xsl:stylesheet>";
>  
>  static  const CHAR szTransformOutput[] =
> -"<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n"
> +"<html>\r\n<body>\r\n<h1>\r\n"
> +"Hello World\r\n"
> +"</h1>\r\n</body>\r\n</html>\r\n";
> +
> +static  const CHAR szTransformOutputWine[] =
>  "<html><body><h1>\n"
>  "Hello World\n"
>  "</h1></body></html>\n";
> @@ -3193,7 +3197,8 @@ static void test_testTransforms(void)
>  
>          hr = IXMLDOMDocument_transformNode(doc, pNode, &bOut);
>          ok(hr == S_OK, "ret %08x\n", hr );
> -        ok( !lstrcmpW( bOut, _bstr_(szTransformOutput) ), "Stylesheet output not correct\n");
> +        ok( !lstrcmpW( bOut, _bstr_(szTransformOutput)) ||  /* Windows */
> +            !lstrcmpW( bOut, _bstr_(szTransformOutputWine)) /* Wine */, "Stylesheet output not correct\n");

You shouldn't need a special case for Wine. What you need is a smarter
comparison function that ignores EOL characters.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Mon Apr 21 09:58:33 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 21 Apr 2008 16:58:33 +0200
Subject: gdi32: Make the bitmap test pass under Windows 2000
In-Reply-To: <E1JnqOS-0007lR-Gp@mail.codeweavers.com> (Dmitry Timoshkov's
	message of "Mon, 21 Apr 2008 16:24:58 +0900")
References: <E1JnqOS-0007lR-Gp@mail.codeweavers.com>
Message-ID: <87bq4345ly.fsf@wine.dyndns.org>

Dmitry Timoshkov <dmitry at codeweavers.com> writes:

> @@ -967,15 +970,19 @@ static void test_bitmap(void)
>      hdc = CreateCompatibleDC(0);
>      assert(hdc != 0);
>  
> +if (0)
> +{   /* this test fails under Win2k */
>      SetLastError(0xdeadbeef);
>      hbmp = CreateBitmap(0x7ffffff, 1, 1, 1, NULL);
>      ok(hbmp != 0, "CreateBitmap should not fail\n");
>      DeleteObject(hbmp);
> +}

It would be better to find values that work on all platforms, instead of
disabling the test completely.

-- 
Alexandre Julliard
julliard at winehq.org


From stefandoesinger at gmx.at  Mon Apr 21 10:00:04 2008
From: stefandoesinger at gmx.at (Stefan =?utf-8?q?D=C3=B6singer?=)
Date: Mon, 21 Apr 2008 17:00:04 +0200
Subject: Some XDC update
Message-ID: <200804211700.04680.stefandoesinger@gmx.at>

Hi,

Here's a short summary of the wine-related things that were going on on XDC:

-> Mouse input: Daniel Stone will take care of that. He says DGA would give us 
what we want, but recommends not to use it. He is working on extending 
XInput(or making a new XI2) which can report relative mouse movements. The X 
people want to phase out DGA. Some games use it for relative input, so 
they'll make a DGA emulation layered on the new XInput stuff. He will need 
debugging / testing help from us since Wine will most likely be the only App 
making use of that directly. Also we should not hold our breath, he has some 
other items on his TODO list, but the end of 2008 is a plausible ETA.

-> Tablets: Config issue is known and being worked on

-> Graphics, general: The Mesa and ATI people are willing to help out with our 
issues. I talked to Aaron Plattner and Pierre ? from Nvidia, and 
they know the issues and worked on some extensions for that internally some 
time ago, but then decided that they're not going to implement that for some 
reason they didn't tell me(I hope they re-consider that now that someone is 
asking for it though). The ATI guys warned me that it might take a while 
until any new extensions are available in production drivers, but that's  
something we have to put up with I guess. Also both the ATI and Mesa people  
like the idea of using our conformance tests for their driver testing and  
debugging. The Nvidia guys offered help with the multithreading crashes and  
the 32 vs 40 varying issue.
(I also talked to Ben Byer from Apple, but he's not in charge of the graphics 
drivers)

-> Graphics: Flat shading: Picking that as a first case for working on an 
extension. Should be fairly easy to implement in Mesa since all cards have a 
specific register for exactly that issue.

-> Graphics, multithreading: general agreement that what we are doing is 
correct, and driver bugs need fixing. It looks like the crash in fglrx will be 
fixed soon(my test app worked in Matthew's development driver). For the 
Nvidia issues I'll file a bugreport as soon as I know if the glxSwapBuffers 
crash is a driver or Gentoo bug)

-> Graphics, sRGB blending: Everyone believes me that our emulation is 
slow("pow() - uh oh, don't use that, that's not parallelizeable"[Keith 
Packard]). The nvidia people are aware of the issue, but a fix is also 
unlikely. The ATI people aren't sure if their dx9 hardware supports sRGB 
writing, maybe the windows driver is emulating things as well - have to check

-> Graphics, GLSL issues: MOVA and LIT, possibly extensions for that.

-> Graphics, Hacks: Both the ATI and Nvidia developers warned me that their 
Windows drivers have a huge per-application bug workaround database. Aaron 
was pretty impressed that Wine doesn't have any app-specific hacks. I am 
afraid we will need them, as some apps seem to expect different behavior that 
our d3d9 tests get. I think the best way is to fetch some information about 
the Windows driver hacks and write tests which trigger them to show 
that "hl2.exe" gets different driver behavior than "d3d9_test.exe"(or in 
whatever way things work)


From dmitry at codeweavers.com  Mon Apr 21 10:06:42 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Tue, 22 Apr 2008 00:06:42 +0900
Subject: gdi32: Make the bitmap test pass under Windows 2000
References: <E1JnqOS-0007lR-Gp@mail.codeweavers.com>
	<87bq4345ly.fsf@wine.dyndns.org>
Message-ID: <018001c8a3c1$50d410f0$a600fea9@DMITRY>

"Alexandre Julliard" <julliard at winehq.org> wrote:

>> @@ -967,15 +970,19 @@ static void test_bitmap(void)
>>      hdc = CreateCompatibleDC(0);
>>      assert(hdc != 0);
>>  
>> +if (0)
>> +{   /* this test fails under Win2k */
>>      SetLastError(0xdeadbeef);
>>      hbmp = CreateBitmap(0x7ffffff, 1, 1, 1, NULL);
>>      ok(hbmp != 0, "CreateBitmap should not fail\n");
>>      DeleteObject(hbmp);
>> +}
> 
> It would be better to find values that work on all platforms, instead of
> disabling the test completely.

Yes, it would be better, but unfortunately I don't have windows 2000
installed around.

-- 
Dmitry.


From dmitry at codeweavers.com  Mon Apr 21 10:20:38 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Tue, 22 Apr 2008 00:20:38 +0900
Subject: gdi32: Make the bitmap test pass under Windows 2000
References: <E1JnqOS-0007lR-Gp@mail.codeweavers.com>	<87bq4345ly.fsf@wine.dyndns.org>
	<018001c8a3c1$50d410f0$a600fea9@DMITRY>
	<480CAF6D.7000007@gmail.com>
Message-ID: <01b101c8a3c3$43e1f090$a600fea9@DMITRY>

"Paul Vriens" <paul.vriens.wine at gmail.com> wrote:

>>>> +if (0)
>>>> +{   /* this test fails under Win2k */
>>>>      SetLastError(0xdeadbeef);
>>>>      hbmp = CreateBitmap(0x7ffffff, 1, 1, 1, NULL);
>>>>      ok(hbmp != 0, "CreateBitmap should not fail\n");
>>>>      DeleteObject(hbmp);
>>>> +}
>>> It would be better to find values that work on all platforms, instead of
>>> disabling the test completely.
>> 
>> Yes, it would be better, but unfortunately I don't have windows 2000
>> installed around.
>> 
> If you need me to test something on a Win2K box (Vmware) just shout.

We need to know what bitmap size is acceptable for CreateBitmap, so
basically experimenting with first 2 parameters in the above test
should answer that.

-- 
Dmitry.


From paul.vriens.wine at gmail.com  Mon Apr 21 10:27:25 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Mon, 21 Apr 2008 17:27:25 +0200
Subject: gdi32: Make the bitmap test pass under Windows 2000
In-Reply-To: <01b101c8a3c3$43e1f090$a600fea9@DMITRY>
References: <E1JnqOS-0007lR-Gp@mail.codeweavers.com>	<87bq4345ly.fsf@wine.dyndns.org>
	<018001c8a3c1$50d410f0$a600fea9@DMITRY>
	<480CAF6D.7000007@gmail.com>
	<01b101c8a3c3$43e1f090$a600fea9@DMITRY>
Message-ID: <480CB25D.1090509@gmail.com>

Dmitry Timoshkov wrote:
> "Paul Vriens" <paul.vriens.wine at gmail.com> wrote:
> 
>>>>> +if (0)
>>>>> +{   /* this test fails under Win2k */
>>>>>      SetLastError(0xdeadbeef);
>>>>>      hbmp = CreateBitmap(0x7ffffff, 1, 1, 1, NULL);
>>>>>      ok(hbmp != 0, "CreateBitmap should not fail\n");
>>>>>      DeleteObject(hbmp);
>>>>> +}
>>>> It would be better to find values that work on all platforms, 
>>>> instead of
>>>> disabling the test completely.
>>>
>>> Yes, it would be better, but unfortunately I don't have windows 2000
>>> installed around.
>>>
>> If you need me to test something on a Win2K box (Vmware) just shout.
> 
> We need to know what bitmap size is acceptable for CreateBitmap, so
> basically experimenting with first 2 parameters in the above test
> should answer that.
> 
OK, no problem but I can't do that right now. Will have to wait a few hours.

Is there a specific combination you are looking for? Huge width, small height? 
Or the maximum size possible?

-- 
Cheers,

Paul.


From paul.vriens.wine at gmail.com  Mon Apr 21 10:14:53 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Mon, 21 Apr 2008 17:14:53 +0200
Subject: gdi32: Make the bitmap test pass under Windows 2000
In-Reply-To: <018001c8a3c1$50d410f0$a600fea9@DMITRY>
References: <E1JnqOS-0007lR-Gp@mail.codeweavers.com>	<87bq4345ly.fsf@wine.dyndns.org>
	<018001c8a3c1$50d410f0$a600fea9@DMITRY>
Message-ID: <480CAF6D.7000007@gmail.com>

Dmitry Timoshkov wrote:
> "Alexandre Julliard" <julliard at winehq.org> wrote:
> 
>>> @@ -967,15 +970,19 @@ static void test_bitmap(void)
>>>      hdc = CreateCompatibleDC(0);
>>>      assert(hdc != 0);
>>>  
>>> +if (0)
>>> +{   /* this test fails under Win2k */
>>>      SetLastError(0xdeadbeef);
>>>      hbmp = CreateBitmap(0x7ffffff, 1, 1, 1, NULL);
>>>      ok(hbmp != 0, "CreateBitmap should not fail\n");
>>>      DeleteObject(hbmp);
>>> +}
>> It would be better to find values that work on all platforms, instead of
>> disabling the test completely.
> 
> Yes, it would be better, but unfortunately I don't have windows 2000
> installed around.
> 
If you need me to test something on a Win2K box (Vmware) just shout.

-- 
Cheers,

Paul.


From dmitry at codeweavers.com  Mon Apr 21 10:40:25 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Tue, 22 Apr 2008 00:40:25 +0900
Subject: gdi32: Make the bitmap test pass under Windows 2000
References: <E1JnqOS-0007lR-Gp@mail.codeweavers.com>	<87bq4345ly.fsf@wine.dyndns.org><018001c8a3c1$50d410f0$a600fea9@DMITRY><480CAF6D.7000007@gmail.com><01b101c8a3c3$43e1f090$a600fea9@DMITRY>
	<480CB25D.1090509@gmail.com>
Message-ID: <020101c8a3c6$05f16f60$a600fea9@DMITRY>

"Paul Vriens" <paul.vriens.wine at gmail.com> wrote:

> Is there a specific combination you are looking for? Huge width, small height?

Anything you could test that will lead to a reasonable conclusion.

> Or the maximum size possible?

At least we need to know this one.

-- 
Dmitry.


From stefan at codeweavers.com  Mon Apr 21 11:25:46 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Mon, 21 Apr 2008 18:25:46 +0200
Subject: Some XDC update
In-Reply-To: <200804211700.04680.stefandoesinger@gmx.at>
References: <200804211700.04680.stefandoesinger@gmx.at>
Message-ID: <200804211825.46857.stefan@codeweavers.com>

Am Montag, 21. April 2008 17:00:04 schrieb Stefan D?singer:
> I talked to Aaron Plattner and Pierre ?
I forgot to look up the name: Pierre-Loup Griffais was it, if I am not 
mistaken


From austinenglish at gmail.com  Mon Apr 21 11:47:44 2008
From: austinenglish at gmail.com (Austin English)
Date: Mon, 21 Apr 2008 11:47:44 -0500
Subject: gdi32: Make the bitmap test pass under Windows 2000
In-Reply-To: <018001c8a3c1$50d410f0$a600fea9@DMITRY>
References: <E1JnqOS-0007lR-Gp@mail.codeweavers.com>
	<87bq4345ly.fsf@wine.dyndns.org>
	<018001c8a3c1$50d410f0$a600fea9@DMITRY>
Message-ID: <b6bb06270804210947k753c7129iec9655105cb64e3a@mail.gmail.com>

On Mon, Apr 21, 2008 at 10:06 AM, Dmitry Timoshkov <dmitry at codeweavers.com>
wrote:

> "Alexandre Julliard" <julliard at winehq.org> wrote:
>
> >> @@ -967,15 +970,19 @@ static void test_bitmap(void)
> >>      hdc = CreateCompatibleDC(0);
> >>      assert(hdc != 0);
> >>
> >> +if (0)
> >> +{   /* this test fails under Win2k */
> >>      SetLastError(0xdeadbeef);
> >>      hbmp = CreateBitmap(0x7ffffff, 1, 1, 1, NULL);
> >>      ok(hbmp != 0, "CreateBitmap should not fail\n");
> >>      DeleteObject(hbmp);
> >> +}
> >
> > It would be better to find values that work on all platforms, instead of
> > disabling the test completely.
>
> Yes, it would be better, but unfortunately I don't have windows 2000
> installed around.
>
> --
> Dmitry.
>
>
> I've got about 6 2k boxes lying around at work I can test on...
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080421/d9038bf3/attachment.htm 

From pnilsson at nullref.se  Mon Apr 21 12:00:05 2008
From: pnilsson at nullref.se (Philip Nilsson)
Date: Mon, 21 Apr 2008 19:00:05 +0200
Subject: d3dx9: Texturing functions
In-Reply-To: <E1Jn8A6-00041M-77@www15.emo.freenet-rz.de>
References: <E1Jn8A6-00041M-77@www15.emo.freenet-rz.de>
Message-ID: <20080421170005.GA4326@zorkmid.localnetwork>

On Sat, Apr 19, 2008 at 10:11:06AM +0200, tony.wasserka at freenet.de wrote:
> So, the first thing I want to make sure is that we redirect the function calls correctly in order
> to reduce double coding.
> This means on the one hand that we should call the Extended versions of each function
> from inside of the simpler ones (most default parameters for the Ex functions are
> on MSDN) and on the other hand that we unify all D3DXCreateTextureFromXXEx
> functions somehow. I don't know how Resources are stored internally, but I guess
> the simplest would be to redirect all of them to D3DXCreateTextureFromFileInMemory, i.e.
> when D3DXCreateTextureFromFile is called we read the file into memory and call the
> InMemory function. I hope this shouldn't be too hard to be applied to the resource function
> either. Of course, this should also be done at the corresponding Surface, Volume and
> cube texture functions.
> Also, I haven't looked too much into it yet, but I guess we could go even a step further
> and define the CreateTextuteFromXX calls like this:
> 1. Redirect to the corresponding D3DXCreateXFromFileInMemoryEx call
> 2. Call D3DXCheckXRequirements
> 3. Call IDirect3DDevice9::CreateTexture
> 4. Lock its surface
> 5. Call LoadSurfaceFromFileEx with it
> 
> This would reduce most of our coding work on LoadSurfaceFromFileEx.
> However, there are still plenty of formats supported by the texturing functions
> and thus, plenty of work for us to do. IIRC we once came to the decision to
> use libraries like libpng or so to reduce that work, too, so we'd just need
> to implement formats like .dds.

I can't remember what the differences are between the CreateTexture and
LoadSurface functions, but this is what I'd do for the LoadSurface functions:

LoadSurfaceFromMemory (read data with the specified pixel format)
  LoadSurfaceFromFileInMemory (parse image format, read actual data into memory)
    LoadSurfaceFromFile (open file, read contents into memory)
	LoadSurfaceFromResource (open resource, read contents into memory)
  LoadSurfaceFromSurface (read image data from a surface)

This would mean two huge chunks of code: One which parses image formats
(LoadSurfaceFromFileInMemory), and one which handles all the resizing,
conversion, filtering and stuff (LoadSurfaceFromMemory).

-- 
Philip Nilsson


From fgouget at free.fr  Mon Apr 21 12:03:28 2008
From: fgouget at free.fr (Francois Gouget)
Date: Mon, 21 Apr 2008 19:03:28 +0200 (CEST)
Subject: Alternative for isinf (fix for bug 12008) (version 2)
In-Reply-To: <480CBB14.3000707@sun.com>
References: <480CBB14.3000707@sun.com>
Message-ID: <alpine.DEB.1.10.0804211902090.24974@amboise.dolphin>



+#if !defined(HAVE_ISINF) && defined(HAVE_IEEEFP_H)
+#include <ieeefp.h>
+#define isinf(x) (!(finite(x) || isnand(x)))
+#endif

The problem with macros is that something like isinf(*x++) won't do what 
you intend. That's why even for such a simple case a function would be 
better imho.



-- 
Francois Gouget <fgouget at free.fr>              http://fgouget.free.fr/
                         Stolen from an Internet user:
              "f u cn rd ths, u cn gt a gd jb n cmptr prgrmmng !"


From truiken at gmail.com  Mon Apr 21 12:36:33 2008
From: truiken at gmail.com (James Hawkins)
Date: Mon, 21 Apr 2008 12:36:33 -0500
Subject: gdi32: Make the bitmap test pass under Windows 2000
In-Reply-To: <020101c8a3c6$05f16f60$a600fea9@DMITRY>
References: <E1JnqOS-0007lR-Gp@mail.codeweavers.com>
	<87bq4345ly.fsf@wine.dyndns.org>
	<018001c8a3c1$50d410f0$a600fea9@DMITRY> <480CAF6D.7000007@gmail.com>
	<01b101c8a3c3$43e1f090$a600fea9@DMITRY> <480CB25D.1090509@gmail.com>
	<020101c8a3c6$05f16f60$a600fea9@DMITRY>
Message-ID: <22821af30804211036t32bb688ah54c780c64ed8235d@mail.gmail.com>

On Mon, Apr 21, 2008 at 10:40 AM, Dmitry Timoshkov
<dmitry at codeweavers.com> wrote:
> "Paul Vriens" <paul.vriens.wine at gmail.com> wrote:
>
>
> > Is there a specific combination you are looking for? Huge width, small height?
>
>  Anything you could test that will lead to a reasonable conclusion.
>
>
>  > Or the maximum size possible?
>
>  At least we need to know this one.
>

The maximum values for both width and height on win2k is 32767.
Anything above that on either parameter returns
ERROR_INVALID_PARAMETER.  Both params can be 32767 at the same time
and the call will still succeed (assuming there's enough memory left).

-- 
James Hawkins


From paul.vriens.wine at gmail.com  Mon Apr 21 13:16:25 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Mon, 21 Apr 2008 20:16:25 +0200
Subject: gdi32: Make the bitmap test pass under Windows 2000
In-Reply-To: <22821af30804211036t32bb688ah54c780c64ed8235d@mail.gmail.com>
References: <E1JnqOS-0007lR-Gp@mail.codeweavers.com>	
	<87bq4345ly.fsf@wine.dyndns.org>	
	<018001c8a3c1$50d410f0$a600fea9@DMITRY>
	<480CAF6D.7000007@gmail.com>	
	<01b101c8a3c3$43e1f090$a600fea9@DMITRY>
	<480CB25D.1090509@gmail.com>	
	<020101c8a3c6$05f16f60$a600fea9@DMITRY>
	<22821af30804211036t32bb688ah54c780c64ed8235d@mail.gmail.com>
Message-ID: <480CD9F9.7060501@gmail.com>

James Hawkins wrote:
> On Mon, Apr 21, 2008 at 10:40 AM, Dmitry Timoshkov
> <dmitry at codeweavers.com> wrote:
>> "Paul Vriens" <paul.vriens.wine at gmail.com> wrote:
>>
>>
>>> Is there a specific combination you are looking for? Huge width, small height?
>>  Anything you could test that will lead to a reasonable conclusion.
>>
>>
>>  > Or the maximum size possible?
>>
>>  At least we need to know this one.
>>
> 
> The maximum values for both width and height on win2k is 32767.
> Anything above that on either parameter returns
> ERROR_INVALID_PARAMETER.  Both params can be 32767 at the same time
> and the call will still succeed (assuming there's enough memory left).
> 

Yep, exactly what I just found.

-- 
Cheers,

Paul.


From dank at kegel.com  Mon Apr 21 15:59:58 2008
From: dank at kegel.com (Dan Kegel)
Date: Mon, 21 Apr 2008 13:59:58 -0700
Subject: MSIME support causing slow setup until explorer.exe paused?
In-Reply-To: <480C84C1.80003@codeweavers.com>
References: <a71bd89a0804201349v6f827eb7ke6a7717ea3c7fdda@mail.gmail.com>
	<480C84C1.80003@codeweavers.com>
Message-ID: <a71bd89a0804211359m678d4310sd22910e2816221b9@mail.gmail.com>

On Mon, Apr 21, 2008 at 5:12 AM, Aric Stewart <aric at codeweavers.com> wrote:
>   MSIMEService, MSIMEReconvertOptions, MSIMEMouseOperator, etc... those are
> all Messages that Microsoft Office looks for and sends to the IME during
> operations.  For the most part all those messages are just stubbed.
>
>   The messages are Registered in Imm32/imm.c once per process, and also
> registered in winex11.drv/ime.c also once per process. I am pretty sure we
> do not send those messages somewhere. So I am not sure why they would be
> taking up so much cpu time.
>
>  Do you know what is happening with the messages during the slow-down?

Oddly, they don't seem to be happening on Dapper.  I'll try again on
Gutsy tonight.  (Chris Smith says he saw something like this with
iTunes on gentoo today, too.)


From khodych at gmail.com  Mon Apr 21 16:25:21 2008
From: khodych at gmail.com (Sergey Khodych)
Date: Tue, 22 Apr 2008 00:25:21 +0300
Subject: [1/4] dinput: Return error for unknown property.
In-Reply-To: <480BD980.1000605@kievinfo.com>
References: <480BC94D.2080006@gmail.com> <480BD980.1000605@kievinfo.com>
Message-ID: <480D0641.9020401@gmail.com>


> I'd like to see tests for this. Also lots of programs will break because 
> they won't get some not significant property. No short - don't do this.
But wine return a garbage value also for significant property. This 
value may cause undefined behavior of application. The patch will make 
errors more explicit.



From m.b.lankhorst at gmail.com  Mon Apr 21 16:57:01 2008
From: m.b.lankhorst at gmail.com (Maarten Lankhorst)
Date: Mon, 21 Apr 2008 14:57:01 -0700
Subject: Wine64?
In-Reply-To: <20080421171603.8ea1aa71.mle+win@mega-nerd.com>
References: <20080421171603.8ea1aa71.mle+win@mega-nerd.com>
Message-ID: <b130c85e0804211457w78c0c5a5n92538f1ac9cda630@mail.gmail.com>

Hello Erik,

2008/4/21, Erik de Castro Lopo <mle+win at mega-nerd.com>:
> Hi all,
>
>  I'm interested in the current state of work towards Wine64, ie
>  running Win64 binaries on x86_64 Linux machines.
>
>  My needs are actually really simple and hence may be a good base
>  functionality to work towards. I just need to run Win64 binaries
>  that read stdin, write stdout/stderr and do file I/O using the
>  standard windows CreateFile/ReadFile/WriteFile/CloseHandle/
>  SetFilePointer etc functions.
>
>  I have found and read this:
>
>     http://wiki.winehq.org/Wine64
>
>  but some of that stuff seems rather out-of-date.
>
>  When I configure with --enable-win64 it configures fine but then
>  errors out in widl generated code because of things like this:
>
>     #if !defined(__RPC_WIN32__)
>     #error Currently only Wine and WIN32 are supported.
>     #endif
>
>  So, is anybody working on Wine64 stuff? Is there a Wine64 TODO list?
>  Any way for me to get involved?
A lot of the lowest level stuff is currently missing. If you don't
mind x64 assembly it's not impossible to do. We would need support
from gcc for the windows calling convention, and making it possible to
mix linux calling convention with windows calling convention. If you
are up to it just make it ignore the error for now, even if it causes
errors. A proof of concept "Hello, world!" would be a great
accomplishment at this point.

Cheers,
Maarten.


From reif at earthlink.net  Mon Apr 21 17:18:25 2008
From: reif at earthlink.net (Robert Reif)
Date: Mon, 21 Apr 2008 18:18:25 -0400
Subject: winmm/tests: waveOutGetDevCaps called with invalid size
In-Reply-To: <Pine.LNX.4.64.0804211050260.12791@maggie.lkpg.cendio.se>
References: <Pine.LNX.4.64.0804181102080.23847@maggie.lkpg.cendio.se>
	<4808B145.2010609@earthlink.net>
	<Pine.LNX.4.64.0804211050260.12791@maggie.lkpg.cendio.se>
Message-ID: <480D12B1.3070309@earthlink.net>

Peter ?strand wrote:
> On Fri, 18 Apr 2008, Robert Reif wrote:
>
>   
>>> -    rc=waveOutGetDevCapsA(device,&capsA,4);
>>> +    /* Final call must succeed, capsA will be used below */
>>> +    rc=waveOutGetDevCapsA(device,&capsA,sizeof(capsA));
>>>      ok(rc==MMSYSERR_NOERROR,
>>>         "waveOutGetDevCapsA(%s): MMSYSERR_NOERROR expected, got %s\n",
>>>         dev_name(device),wave_out_error(rc));
>>> -
>>> -    rc=waveOutGetDevCapsW(device,&capsW,4);
>>> -    ok(rc==MMSYSERR_NOERROR || rc==MMSYSERR_NOTSUPPORTED,
>>> -       "waveOutGetDevCapsW(%s): MMSYSERR_NOERROR or MMSYSERR_NOTSUPPORTED "
>>> -       "expected, got %s\n",dev_name(device),wave_out_error(rc));
>>> +    if (rc!=MMSYSERR_NOERROR)
>>> +	return;
>>>       
>
>
>   
>> That's the whole point of the test, to check what happens with an invalid
>> argument.
>>     
>
> So what do you think *should* happen with an invalid argument? The result 
> is different on different Windows platforms. The behaviour is not 
> specified by MSDN. 
>
> In any case, continuing and executing code that uses "capsA" even though 
> the waveOutGetDevCapsA call failed is definitely wrong. 
>
>  
> Rgds, 
> ---
> Peter ?strand		ThinLinc Chief Developer
> Cendio AB		http://www.cendio.se
> Wallenbergs gata 4
> 583 30 Link?ping	Phone: +46-13-21 46 00
This is the proper fix:

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: wave.diff.txt
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20080421/37cbf957/attachment.txt 

From wine-devel at kievinfo.com  Mon Apr 21 19:20:07 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Mon, 21 Apr 2008 18:20:07 -0600
Subject: [1/4] dinput: Return error for unknown property.
In-Reply-To: <480D0641.9020401@gmail.com>
References: <480BC94D.2080006@gmail.com> <480BD980.1000605@kievinfo.com>
	<480D0641.9020401@gmail.com>
Message-ID: <480D2F37.20801@kievinfo.com>

Sergey Khodych wrote:
>> I'd like to see tests for this. Also lots of programs will break because 
>> they won't get some not significant property. No short - don't do this.
> But wine return a garbage value also for significant property. This 
> value may cause undefined behavior of application. The patch will make 
> errors more explicit.
> 
> 
On another hand - that's the way Wine been headed - break everything that's 
not implemented. So go ahead and put that error in.

Vitaliy.


From leslie_alistair at hotmail.com  Mon Apr 21 20:22:59 2008
From: leslie_alistair at hotmail.com (Alistair Leslie-Hughes)
Date: Tue, 22 Apr 2008 11:22:59 +1000
Subject: version: Fix tests that fail in win9x and win2k
In-Reply-To: <22821af30804211707o4fecb300g8db61a0689ce2ab6@mail.gmail.com>
References: <22821af30804211707o4fecb300g8db61a0689ce2ab6@mail.gmail.com>
Message-ID: <480D3DF3.9000803@hotmail.com>

James Hawkins wrote:
> Hi,
> 
> Changelog:
> * Fix tests that fail in win9x and win2k.
> 
>  dlls/version/tests/info.c |   29 +++++++++++++++++++----------
>  1 files changed, 19 insertions(+), 10 deletions(-)
> 
Hi James,
   No patch attached.

Best Regards
  Alistair Leslie-Hughes


From winehacker at gmail.com  Mon Apr 21 20:30:29 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Mon, 21 Apr 2008 21:30:29 -0400
Subject: Strange struct alignment errors?
In-Reply-To: <a71bd89a0804200057l4a91f644x45f99a17f53bcf47@mail.gmail.com>
References: <a71bd89a0804200045n57eeb6d1k2abc149f0869731d@mail.gmail.com>
	<22821af30804200052y6c03c8efh8c56d22282bd0848@mail.gmail.com>
	<a71bd89a0804200057l4a91f644x45f99a17f53bcf47@mail.gmail.com>
Message-ID: <19e31a080804211830g1b2eed4r92336d3d99f760c6@mail.gmail.com>

On Sun, Apr 20, 2008 at 3:57 AM, Dan Kegel <dank at kegel.com> wrote:
>  Shoot, icc ought to be able to handle those, but
>  you're right, we should ignore any icc results.

At least until I am done... =)

But yeah icc's alignment handling seems to be totally broken...I've
tried every alignment switch known to man and still get problems.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From dmitry at codeweavers.com  Mon Apr 21 21:39:18 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Tue, 22 Apr 2008 11:39:18 +0900
Subject: Secure filename copy to fixed size variable wfileName
References: <1208786326.23524.19.camel@tefdemo>
Message-ID: <01a701c8a422$11f1ed10$a600fea9@DMITRY>

"Tomasz Jezierski - Tefnet" <developers at tefnet.pl> wrote:

> -     strcpyW(wfileName, sei_tmp.lpFile);
> +           StrCpyNW(wfileName, sei_tmp.lpFile,sizeof(wfileName));
>   }
>      } else
> - strcpyW(wfileName, sei_tmp.lpFile);
> +       StrCpyNW(wfileName, sei_tmp.lpFile,sizeof(wfileName));

Your patch doesn't make the code more secure than it is now. StrCpyNW takes
number of characters, not bytes. And since it's just a wrapper around lstrcpynW
it's better to use the latter one instead.

-- 
Dmitry.


From austinenglish at gmail.com  Mon Apr 21 22:02:50 2008
From: austinenglish at gmail.com (Austin English)
Date: Mon, 21 Apr 2008 22:02:50 -0500
Subject: Documentation updating / XML?
Message-ID: <b6bb06270804212002h73a55f23i1ce083af2dbd3150@mail.gmail.com>

I've been working on some of the documentation, then remembered that Scott
requested a move to XML:
http://bugs.winehq.org/show_bug.cgi?id=12217

There are quite a few programs to convert SGML to XML, and I've got a bit of
time to kill. Alexandre, would you accept a move to XML, or would this be a
waste of time?

-Austin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080421/5c7d191c/attachment.htm 

From dank at kegel.com  Mon Apr 21 22:58:21 2008
From: dank at kegel.com (Dan Kegel)
Date: Mon, 21 Apr 2008 20:58:21 -0700
Subject: What to do about filenames legal in Linux but illegal in Windows?
Message-ID: <a71bd89a0804212058k7209bc9cl7ce04fb30cc87e58@mail.gmail.com>

Linux users create files with names that are legal in Linux but not
in Windows, simply because they can.
Eventually they'll try to read those files in a Windows app,
either by carrying them on a flash drive over to a real windows
system, by dual booting, or by running the app in Wine.

Now, normally, Wine should do exactly what Windows does.
(I believe that in both Windows and Wine, directory listings
will show these illegal chars, but attempts to open the files will fail.)

But let's say we're in that happy time in the near future
when lots of companies are willing to ship their apps
with Wine as a halfway house to native support, and
lots of their users start running into this issue.
Can/should such apps tell Windows or Wine "Oh, go ahead
and let me open those funny files?"

On Wine, of course, we could open up a hole if we had to,
but it'd be nice to know if there were a method that
also worked on Windows.

I looked around a bit today for a way to open such files in
Windows, and failed miserably (though I did find a nice
example of how to use NtCreateFile without the DDK).
Anyone know of a way on real Windows to do this?


From saulius2 at ar.fi.lt  Tue Apr 22 00:57:39 2008
From: saulius2 at ar.fi.lt (Saulius Krasuckas)
Date: Tue, 22 Apr 2008 08:57:39 +0300 (EEST)
Subject: What to do about filenames legal in Linux but illegal in Windows?
In-Reply-To: <a71bd89a0804212058k7209bc9cl7ce04fb30cc87e58@mail.gmail.com>
References: <a71bd89a0804212058k7209bc9cl7ce04fb30cc87e58@mail.gmail.com>
Message-ID: <Pine.LNX.4.62.0804220839250.16602@tvarka.ar.fi.lt>

* On Mon, 21 Apr 2008, Dan Kegel wrote:
> 
> (I believe that in both Windows and Wine, directory listings
> will show these illegal chars, but attempts to open the files will 
> fail.)
  ...
> I looked around a bit today for a way to open such files in
> Windows, and failed miserably 
  ...
> Anyone know of a way on real Windows to do this?

For a files that were at least "undeletable" I remember I have been using 
a feature of Total Commander to switch format of files displayed to a 
Short/Long form.  Not all files give up for me this way, but half of them 
did, though.


From thunderbird2k at gmx.net  Tue Apr 22 01:04:46 2008
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Tue, 22 Apr 2008 08:04:46 +0200
Subject: Wine64?
In-Reply-To: <b130c85e0804211457w78c0c5a5n92538f1ac9cda630@mail.gmail.com>
References: <20080421171603.8ea1aa71.mle+win@mega-nerd.com>
	<b130c85e0804211457w78c0c5a5n92538f1ac9cda630@mail.gmail.com>
Message-ID: <20080422060446.42360@gmx.net>

> Hello Erik,
> 
> 2008/4/21, Erik de Castro Lopo <mle+win at mega-nerd.com>:
> > Hi all,
> >
> >  I'm interested in the current state of work towards Wine64, ie
> >  running Win64 binaries on x86_64 Linux machines.
> >
> >  My needs are actually really simple and hence may be a good base
> >  functionality to work towards. I just need to run Win64 binaries
> >  that read stdin, write stdout/stderr and do file I/O using the
> >  standard windows CreateFile/ReadFile/WriteFile/CloseHandle/
> >  SetFilePointer etc functions.
> >
> >  I have found and read this:
> >
> >     http://wiki.winehq.org/Wine64
> >
> >  but some of that stuff seems rather out-of-date.
> >
> >  When I configure with --enable-win64 it configures fine but then
> >  errors out in widl generated code because of things like this:
> >
> >     #if !defined(__RPC_WIN32__)
> >     #error Currently only Wine and WIN32 are supported.
> >     #endif
> >
> >  So, is anybody working on Wine64 stuff? Is there a Wine64 TODO list?
> >  Any way for me to get involved?
> A lot of the lowest level stuff is currently missing. If you don't
> mind x64 assembly it's not impossible to do. We would need support
> from gcc for the windows calling convention, and making it possible to
> mix linux calling convention with windows calling convention. If you
> are up to it just make it ignore the error for now, even if it causes
> errors. A proof of concept "Hello, world!" would be a great
> accomplishment at this point.
> 
> Cheers,
> Maarten.
> 

These days there is a 64bit version of mingw (mingw64 or so it is called). They must have patches to add the calling convention to gcc now. I'm not sure what the status is on merging the changes back but I think nothing forbids you from building gcc from their sources. I have no idea whether having the calling convention is enough for Wine.

Roderick
-- 
Psssst! Schon vom neuen GMX MultiMessenger geh?rt?
Der kann`s mit allen: http://www.gmx.net/de/go/multimessenger


From paul.vriens.wine at gmail.com  Tue Apr 22 01:33:25 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Tue, 22 Apr 2008 08:33:25 +0200
Subject: kernel32: Fix a test that fails on all NT platforms
In-Reply-To: <22821af30804212203q7ff76745ge14ec12b3b8eec79@mail.gmail.com>
References: <22821af30804212203q7ff76745ge14ec12b3b8eec79@mail.gmail.com>
Message-ID: <480D86B5.8010707@gmail.com>

James Hawkins wrote:
> Hi,
> 
> Changelog:
> * Fix a test that fails on all NT platforms.
> 
>  dlls/kernel32/tests/toolhelp.c |   12 +++++++++---
>  1 files changed, 9 insertions(+), 3 deletions(-)
> 
> 
> 
> ------------------------------------------------------------------------
> 
> 
Hi James,

I've been looking at some of the patches to fix the tests but I'm a bit unsure 
if some of them are the correct way to go. Things like:

+    /* win9x does not return a thread, NT does */
      te.dwSize = sizeof(te);
-    ok(!pThread32First( hSnapshot, &te ), "shouldn't return a thread\n");
+    ret = pThread32First( hSnapshot, &te );
+    ok(ret || !ret, "You'll never see this\n");

renders the whole test useless. It turns out that win9x in this case leaves 
te.dwSize and XP-and-up set te.dwSize to 0. Shouldn't we make use of that fact?
So something like (or another combination):

if (te.dwSize == 0)
{
    XP-and-up, expect failure
}
else if (te.dwSize == sizeof(te))
{
    win9x, expect success
}
else
{
   something is wrong/unexpected
}

On a sidenote (and this has been the case for a long time):

I've seen patches where

ok(function(a,b),"Failed");

is turned into

c = function(a,b);
if (c)
{
   .....
}

but done without a skip or such. So if Wine has a regression for 'function' we 
won't notice.

We have loads of patches where we expect 3 or more different last errors. This 
will make sure the tests always succeed of course but makes it difficult to tell 
if we (Wine) are doing the correct/best thing.

-- 
Cheers,

Paul.


From mrmessiah at gmail.com  Tue Apr 22 01:35:07 2008
From: mrmessiah at gmail.com (Chris Howe)
Date: Tue, 22 Apr 2008 07:35:07 +0100
Subject: What to do about filenames legal in Linux but illegal in Windows?
In-Reply-To: <Pine.LNX.4.62.0804220839250.16602@tvarka.ar.fi.lt>
References: <a71bd89a0804212058k7209bc9cl7ce04fb30cc87e58@mail.gmail.com>
	<Pine.LNX.4.62.0804220839250.16602@tvarka.ar.fi.lt>
Message-ID: <39c14e440804212335t4530d58bl82ffa1719f022c7b@mail.gmail.com>

Would the right way to handle such files be to use the
FUSE filesystem (when it's done) to hide them from
apps?

On the one hand it sidesteps the problem, but as
a recent blog post by Microsoft's Raymond Chen
http://blogs.msdn.com/oldnewthing/archive/2008/04/14/8389268.aspx
shows, it IS possible to get into this kind of problem
in Windows too.

---
Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080422/9b471f33/attachment.htm 

From truiken at gmail.com  Tue Apr 22 01:57:09 2008
From: truiken at gmail.com (James Hawkins)
Date: Tue, 22 Apr 2008 01:57:09 -0500
Subject: kernel32: Fix a test that fails on all NT platforms
In-Reply-To: <480D86B5.8010707@gmail.com>
References: <22821af30804212203q7ff76745ge14ec12b3b8eec79@mail.gmail.com>
	<480D86B5.8010707@gmail.com>
Message-ID: <22821af30804212357p69f6fe7dtf9090eb95ad9ebb3@mail.gmail.com>

On Tue, Apr 22, 2008 at 1:33 AM, Paul Vriens <paul.vriens.wine at gmail.com> wrote:
> James Hawkins wrote:
>
> >
> > Hi,
> >
> > Changelog:
> > * Fix a test that fails on all NT platforms.
> >
> >  dlls/kernel32/tests/toolhelp.c |   12 +++++++++---
> >  1 files changed, 9 insertions(+), 3 deletions(-)
> >
> >
> >
> > ------------------------------------------------------------------------
> >
> >
> >
>  Hi James,
>
>  I've been looking at some of the patches to fix the tests but I'm a bit
> unsure if some of them are the correct way to go. Things like:
>
>  +    /* win9x does not return a thread, NT does */
>      te.dwSize = sizeof(te);
>  -    ok(!pThread32First( hSnapshot, &te ), "shouldn't return a thread\n");
>  +    ret = pThread32First( hSnapshot, &te );
>  +    ok(ret || !ret, "You'll never see this\n");
>
>  renders the whole test useless.
>

That's the point; the test is useless.  If a test fails on one
platform but succeeds in another, then we're testing a behavior that
can't be relied on, or the test is not specific enough.  We leave it
around for documentation of that fact.

> It turns out that win9x in this case leaves
> te.dwSize and XP-and-up set te.dwSize to 0. Shouldn't we make use of that
> fact?
>

You could, but it doesn't change the fact that the behavior is not
reliable across different platforms.  If we knew an app that makes
this exact check and depends on the results, then sure we should add a
pickier test.  As it stands, it's just a bit too nit-picky.

>
>  On a sidenote (and this has been the case for a long time):
>
>  I've seen patches where
>
>  ok(function(a,b),"Failed");
>
>  is turned into
>
>  c = function(a,b);
>  if (c)
>  {
>   .....
>  }
>
>  but done without a skip or such. So if Wine has a regression for 'function'
> we won't notice.
>

Tell that to the platforms that fail too.  Thus, this is a behavior
that can't be relied on.  Wine strives to have compatibility with all
the platforms we test on.  We don't stick to one specific version, and
if we did, we could arbitrarily pick the version that fails this
function, then failing would be the right behavior.

>  We have loads of patches where we expect 3 or more different last errors.
> This will make sure the tests always succeed of course but makes it
> difficult to tell if we (Wine) are doing the correct/best thing.
>

You're missing the broader picture.  If a function returns three or
more different last errors, how can any app depend on that either?
What is the definition of the "correct/best thing"?

-- 
James Hawkins


From astrand at cendio.se  Tue Apr 22 02:30:09 2008
From: astrand at cendio.se (=?UTF-8?Q?Peter_=C3=85strand?=)
Date: Tue, 22 Apr 2008 09:30:09 +0200 (CEST)
Subject: winmm/tests: waveOutGetDevCaps called with invalid size
In-Reply-To: <480D12B1.3070309@earthlink.net>
References: <Pine.LNX.4.64.0804181102080.23847@maggie.lkpg.cendio.se>
	<4808B145.2010609@earthlink.net>
	<Pine.LNX.4.64.0804211050260.12791@maggie.lkpg.cendio.se>
	<480D12B1.3070309@earthlink.net>
Message-ID: <Pine.LNX.4.64.0804220842440.29058@maggie.lkpg.cendio.se>

On Mon, 21 Apr 2008, Robert Reif wrote:

> > > That's the whole point of the test, to check what happens with an invalid
> > > argument.
> > >     
> >
> > So what do you think *should* happen with an invalid argument? The result is
> > different on different Windows platforms. The behaviour is not specified by
> > MSDN. 
> >
> > In any case, continuing and executing code that uses "capsA" even though the
> > waveOutGetDevCapsA call failed is definitely wrong. 

> This is the proper fix:

The fix for this part of the problem is fine. Please apply. 

However, I still think it's VERY strange to expect success from an invalid 
call. You are describing it as an "invalid argument" yourself. Why should 
we expect a call with an "invalid argument" to succeed? And again, the 
test does NOT pass on all Microsoft versions; it fails on Terminal 
Servers. 

If the point is to verify that waveOutGetDevCaps doesn't write more than 
the size supplied, this should be verified. I'd also like to point out 
that the Wine implementation also doesn't handle this correctly: Only 
waveOutGetDevCapsA does a memcpy() using the size argument; 
waveOutGetDevCapsW does not.


Rgds, 
---
Peter ?strand		ThinLinc Chief Developer
Cendio AB		http://www.cendio.se
Wallenbergs gata 4
583 30 Link?ping	Phone: +46-13-21 46 00
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: wave.diff.txt
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20080422/6248e257/attachment.txt 

From paul.vriens.wine at gmail.com  Tue Apr 22 02:48:02 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Tue, 22 Apr 2008 09:48:02 +0200
Subject: kernel32: Fix a test that fails on all NT platforms
In-Reply-To: <22821af30804212357p69f6fe7dtf9090eb95ad9ebb3@mail.gmail.com>
References: <22821af30804212203q7ff76745ge14ec12b3b8eec79@mail.gmail.com>	
	<480D86B5.8010707@gmail.com>
	<22821af30804212357p69f6fe7dtf9090eb95ad9ebb3@mail.gmail.com>
Message-ID: <480D9832.8070701@gmail.com>

James Hawkins wrote:
> On Tue, Apr 22, 2008 at 1:33 AM, Paul Vriens <paul.vriens.wine at gmail.com> wrote:
>> James Hawkins wrote:
>>
>>> Hi,
>>>
>>> Changelog:
>>> * Fix a test that fails on all NT platforms.
>>>
>>>  dlls/kernel32/tests/toolhelp.c |   12 +++++++++---
>>>  1 files changed, 9 insertions(+), 3 deletions(-)
>>>
>>>
>>>
>>> ------------------------------------------------------------------------
>>>
>>>
>>>
>>  Hi James,
>>
>>  I've been looking at some of the patches to fix the tests but I'm a bit
>> unsure if some of them are the correct way to go. Things like:
>>
>>  +    /* win9x does not return a thread, NT does */
>>      te.dwSize = sizeof(te);
>>  -    ok(!pThread32First( hSnapshot, &te ), "shouldn't return a thread\n");
>>  +    ret = pThread32First( hSnapshot, &te );
>>  +    ok(ret || !ret, "You'll never see this\n");
>>
>>  renders the whole test useless.
>>
> 
> That's the point; the test is useless.  If a test fails on one
> platform but succeeds in another, then we're testing a behavior that
> can't be relied on, or the test is not specific enough.  We leave it
> around for documentation of that fact.
> 
>> It turns out that win9x in this case leaves
>> te.dwSize and XP-and-up set te.dwSize to 0. Shouldn't we make use of that
>> fact?
>>
> 
> You could, but it doesn't change the fact that the behavior is not
> reliable across different platforms.  If we knew an app that makes
> this exact check and depends on the results, then sure we should add a
> pickier test.  As it stands, it's just a bit too nit-picky.

But if it's just for documentation purposes (as for now we don't know an app 
that depends on it) isn't my example a bit better? (I agree about the nit-picky 
though).

> 
>>  On a sidenote (and this has been the case for a long time):
>>
>>  I've seen patches where
>>
>>  ok(function(a,b),"Failed");
>>
>>  is turned into
>>
>>  c = function(a,b);
>>  if (c)
>>  {
>>   .....
>>  }
>>
>>  but done without a skip or such. So if Wine has a regression for 'function'
>> we won't notice.
>>
> 
> Tell that to the platforms that fail too.  Thus, this is a behavior
> that can't be relied on.  Wine strives to have compatibility with all
> the platforms we test on.  We don't stick to one specific version, and
> if we did, we could arbitrarily pick the version that fails this
> function, then failing would be the right behavior.

If a function consistently fails that's true but there are all kinds of 
circumstances that a function could fail. I agree we shouldn't care about the 
specific version but just ignoring failure because one of the versions fails is 
not correct in my opinion. We already had this 'discussion' with failures that 
only happen on win9x and the fact whether we should cater for that are just let 
it be. 'Let it be' was AJ's opinion back than, unless we have a nice way of 
catching it.

> 
>>  We have loads of patches where we expect 3 or more different last errors.
>> This will make sure the tests always succeed of course but makes it
>> difficult to tell if we (Wine) are doing the correct/best thing.
>>
> 
> You're missing the broader picture.  If a function returns three or
> more different last errors, how can any app depend on that either?
> What is the definition of the "correct/best thing"?
> 

Agreed, if versions pass different last errors an app could hardly be depending 
on it.

I agree on most of your points as we merely showing that versions return 
different errors or even succeed or fail depending on the OS. But I also think 
that the more we know about the circumstances the more we should document them.

Having a 1.0 soon will most likely broaden the numbers of users and hence apps 
that people are going to (try to) run with Wine. The chances will become bigger 
that there is an app out there that will make use of version differences by 
whatever means. I've seen several apps that do a whole lot of things just to to 
find out on what version/OS they are running on (and I'm not talking about copy 
protection apps).

-- 
Cheers,

Paul.


From truiken at gmail.com  Tue Apr 22 03:01:34 2008
From: truiken at gmail.com (James Hawkins)
Date: Tue, 22 Apr 2008 03:01:34 -0500
Subject: kernel32: Fix a test that fails on all NT platforms
In-Reply-To: <480D9832.8070701@gmail.com>
References: <22821af30804212203q7ff76745ge14ec12b3b8eec79@mail.gmail.com>
	<480D86B5.8010707@gmail.com>
	<22821af30804212357p69f6fe7dtf9090eb95ad9ebb3@mail.gmail.com>
	<480D9832.8070701@gmail.com>
Message-ID: <22821af30804220101q660cc4b9ob07683e257728267@mail.gmail.com>

On Tue, Apr 22, 2008 at 2:48 AM, Paul Vriens <paul.vriens.wine at gmail.com> wrote:
>
> James Hawkins wrote:
>
> > On Tue, Apr 22, 2008 at 1:33 AM, Paul Vriens <paul.vriens.wine at gmail.com>
> wrote:
> >
> > > James Hawkins wrote:
> > >
> > >
> > > > Hi,
> > > >
> > > > Changelog:
> > > > * Fix a test that fails on all NT platforms.
> > > >
> > > >  dlls/kernel32/tests/toolhelp.c |   12 +++++++++---
> > > >  1 files changed, 9 insertions(+), 3 deletions(-)
> > > >
> > > >
> > > >
> > > >
> ------------------------------------------------------------------------
> > > >
> > > >
> > > >
> > > >
> > >  Hi James,
> > >
> > >  I've been looking at some of the patches to fix the tests but I'm a bit
> > > unsure if some of them are the correct way to go. Things like:
> > >
> > >  +    /* win9x does not return a thread, NT does */
> > >     te.dwSize = sizeof(te);
> > >  -    ok(!pThread32First( hSnapshot, &te ), "shouldn't return a
> thread\n");
> > >  +    ret = pThread32First( hSnapshot, &te );
> > >  +    ok(ret || !ret, "You'll never see this\n");
> > >
> > >  renders the whole test useless.
> > >
> > >
> >
> > That's the point; the test is useless.  If a test fails on one
> > platform but succeeds in another, then we're testing a behavior that
> > can't be relied on, or the test is not specific enough.  We leave it
> > around for documentation of that fact.
> >
> >
> > > It turns out that win9x in this case leaves
> > > te.dwSize and XP-and-up set te.dwSize to 0. Shouldn't we make use of
> that
> > > fact?
> > >
> > >
> >
> > You could, but it doesn't change the fact that the behavior is not
> > reliable across different platforms.  If we knew an app that makes
> > this exact check and depends on the results, then sure we should add a
> > pickier test.  As it stands, it's just a bit too nit-picky.
> >
>
>  But if it's just for documentation purposes (as for now we don't know an
> app that depends on it) isn't my example a bit better? (I agree about the
> nit-picky though).
>
>
>
> >
> >
> > >  On a sidenote (and this has been the case for a long time):
> > >
> > >  I've seen patches where
> > >
> > >  ok(function(a,b),"Failed");
> > >
> > >  is turned into
> > >
> > >  c = function(a,b);
> > >  if (c)
> > >  {
> > >  .....
> > >  }
> > >
> > >  but done without a skip or such. So if Wine has a regression for
> 'function'
> > > we won't notice.
> > >
> > >
> >
> > Tell that to the platforms that fail too.  Thus, this is a behavior
> > that can't be relied on.  Wine strives to have compatibility with all
> > the platforms we test on.  We don't stick to one specific version, and
> > if we did, we could arbitrarily pick the version that fails this
> > function, then failing would be the right behavior.
> >
>
>  If a function consistently fails that's true but there are all kinds of
> circumstances that a function could fail. I agree we shouldn't care about
> the specific version but just ignoring failure because one of the versions
> fails is not correct in my opinion. We already had this 'discussion' with
> failures that only happen on win9x and the fact whether we should cater for
> that are just let it be. 'Let it be' was AJ's opinion back than, unless we
> have a nice way of catching it.
>
>
>
> >
> >
> > >  We have loads of patches where we expect 3 or more different last
> errors.
> > > This will make sure the tests always succeed of course but makes it
> > > difficult to tell if we (Wine) are doing the correct/best thing.
> > >
> > >
> >
> > You're missing the broader picture.  If a function returns three or
> > more different last errors, how can any app depend on that either?
> > What is the definition of the "correct/best thing"?
> >
> >
>
>  Agreed, if versions pass different last errors an app could hardly be
> depending on it.
>
>  I agree on most of your points as we merely showing that versions return
> different errors or even succeed or fail depending on the OS. But I also
> think that the more we know about the circumstances the more we should
> document them.
>
>  Having a 1.0 soon will most likely broaden the numbers of users and hence
> apps that people are going to (try to) run with Wine. The chances will
> become bigger that there is an app out there that will make use of version
> differences by whatever means. I've seen several apps that do a whole lot of
> things just to to find out on what version/OS they are running on (and I'm
> not talking about copy protection apps).
>

Sure, but like I said before, we'll deal with that when we find those
apps.  In the meantime, I'm going to keep sending in these patches
fixing up the tests.  Hopefully people will take notice and help me
out :-)

-- 
James Hawkins


From buzzilo at gmail.com  Mon Apr 21 17:34:15 2008
From: buzzilo at gmail.com (Evgeny Burzak)
Date: Tue, 22 Apr 2008 02:34:15 +0400
Subject: winehq.org redesign
Message-ID: <20080422023415.48a311e3.buzzilo@gmail.com>

Hello all,
some times ago I make design for AppDB  (http://buzz.ulx.ru/pf/appdb.png). Folks was  delighted with this one, but managers rejected my idea due to needs redesign everything then. 
But now it may be more actual then ever owing to Wine 1.0 release? I think it may gain attention from professionals who wants to use wine in production environment and improve Wine.
I can make design for main pages, xml/xslt template and probably base php5 clasess if you decide to change site engine.

-- 
Evgeny


From dwayne at translate.org.za  Tue Apr 22 05:13:09 2008
From: dwayne at translate.org.za (Dwayne Bailey)
Date: Tue, 22 Apr 2008 12:13:09 +0200
Subject: Translating Wine with PO files
Message-ID: <1208859189.20951.48.camel@dhcppc32>

Hi,

I've just completed a tool for converting resource files (.rc) to
Gettext PO.  
http://translate.sourceforge.net/wiki/toolkit/rc2po
This should allow many more FOSS translators to add translations to
Wine, hopefully before the 1.0 release.

In some ways this is a response to some issues raised in the
'Translations and Wine 1.0' thread:
http://thread.gmane.org/gmane.comp.emulators.wine.devel/58000
further into this email I offer some comments on the issues raised in
that thread.  My suggestion is to deploy a Pootle server:
http://translate.sourceforge.net/wiki/pootle/index

The new RC tool, rc2po, is part of the Translate Toolkit, a general
translation conversion toolkit and localisation library.
http://translate.sourceforge.net/wiki/toolkit/index

I've cut 1.2-alpha1 for those who want to give it a spin.  We've just
started work on v1.2 so the toolkit is mature, started in 2002, and the
alpha status is simply an indication that we've got quite a while before
1.2 official.  Download it from here:
http://translate.sourceforge.net/snapshots/

Status of rc2po:
----------------
* Its very new - I've done roundtrip testing and some translating in
ummm pig latin :) but will begin more serious Afrikaans translation
soon.  So I expect to see some bugs.
* It can handle: DIALOG*, MENU, LANGUAGE, STRINGTABLE
* You can't change the dialog sizes - I have some ideas of how we could
do this in PO but its not implemented at all

How it works:
-------------
Make POT files: rc2po -P some.rc some.pot
Recover old translations: rc2po -t some.rc translated.rc translated.po
Make rc files: 
  po2rc --lang=LANG_XXX -t some.rc translated.po translated.rc
The wiki page provides clearer usage examples:
http://translate.sourceforge.net/wiki/toolkit/rc2po

Things to be aware of
---------------------
* You cannot tweak the translations in .rc and hope to keep things in
sync with PO, you'll need to only work in PO files or make sure any
tweaks you make in your .rc you copy to the .po.
* You cannot change the sizes of the dialogues in your translation for
the above reason.  This should change in the future to allow you to
'translate' the sizes.
* Recovered translations need to be fully reviewed as we can't determine
if your translation is based on the same English text.
* We cannot create multi-language .rc files, you'll need one languages
in each file.
* We can read multilingual files but will only take the first language
and drop anything after that, since PO files can only contain one
language this makes sense.
* We don't do any changes to the Makefiles, you'll have to do those by
hand.  But it would probably be easy to create a simple bash script or
change the build system to automagically include all xxx_yy.rc files.
* We handle encoding issues but prefer UTF-8 throughout.

How you can help
----------------
* By testing rc2po and po2rc
* Help implement a solution to allow size changes
* Report bugs on http://bugs.locamotion.org

Getting help
------------
* On IRC: irc://irc.freenode.net/#pootle
* Mailing list:
http://lists.sourceforge.net/lists/listinfo/translate-devel
* Wiki: http://translate.sourceforge.net/wiki/toolkit/rc2po

Suggested localization infrastructure for Wine
----------------------------------------------
In the thread 'Translation and Wine 1.0':
http://thread.gmane.org/gmane.comp.emulators.wine.devel/58000
there was some discussion about localization infrastructure for wine.

I'd like to suggest that Wine looks at using Pootle:
http://translate.sourceforge.net/wiki/pootle/index
this is already in use by projects such as OLPC, OpenOffice.org and
others.  It can manage PO files, commit to various VC systems (including
Git), allows suggestions, does various QA checks and allows download and
submission of PO files, has translation memory and glossary suggestions,
statistics, etc, etc.

A hosting option is to put the files on http://pootle.locamotion.org but
I would request someone from the Wine community to take charge of
keeping the PO files up-to-date and authorising users, etc.  I would
however encourage the Wine community to run its own server.  This would
make it easier to commit files directly into Git.  I would suggest some
work to ensure that POT files, updating of PO files and conversion back
to .rc are automatic.  Being within the control of the Wine community
makes this easier.

Launchpad is not an options unless you convert to PO using the above
rc2po.  Pootle has the advantage that you can run your own server, you
don't have that with Launchpad.

-- 
Dwayne Bailey
Translate.org.za

+27-12-460-1095 (w)
+27-83-443-7114 (cell)



From julliard at winehq.org  Tue Apr 22 05:17:49 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Tue, 22 Apr 2008 12:17:49 +0200
Subject: [PATCH 01/21] [WinHelp]: get rid of the reuse concept for Windows
	and refactor the code a bit for window creation / deletion
In-Reply-To: <20080421190646.12982.96067.stgit@localhost> (Eric Pouech's
	message of "Mon, 21 Apr 2008 21:06:46 +0200")
References: <20080421190145.12982.57452.stgit@localhost>
	<20080421190646.12982.96067.stgit@localhost>
Message-ID: <87mynm2nxu.fsf@wine.dyndns.org>

Eric Pouech <eric.pouech at orange.fr> writes:

>  programs/winhelp/winhelp.c |  257 ++++++++++++++++++++------------------------
>  1 files changed, 116 insertions(+), 141 deletions(-)

This breaks window repaints for me, when switching pages the window is
not repainted and still shows the old page.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Tue Apr 22 05:25:53 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Tue, 22 Apr 2008 12:25:53 +0200
Subject: Documentation updating / XML?
In-Reply-To: <b6bb06270804212002h73a55f23i1ce083af2dbd3150@mail.gmail.com>
	(Austin English's message of "Mon, 21 Apr 2008 22:02:50 -0500")
References: <b6bb06270804212002h73a55f23i1ce083af2dbd3150@mail.gmail.com>
Message-ID: <87iqya2nke.fsf@wine.dyndns.org>

"Austin English" <austinenglish at gmail.com> writes:

> I've been working on some of the documentation, then remembered that Scott
> requested a move to XML:
> http://bugs.winehq.org/show_bug.cgi?id=12217
>
> There are quite a few programs to convert SGML to XML, and I've got a bit of
> time to kill. Alexandre, would you accept a move to XML, or would this be a
> waste of time?

I don't really care about the format as long as there are decent tools
to generate all the outputs we want. Considering the state of SGML tools
it's probably not hard to do better...

-- 
Alexandre Julliard
julliard at winehq.org


From 4winter at informatik.uni-hamburg.de  Tue Apr 22 05:56:35 2008
From: 4winter at informatik.uni-hamburg.de (Justus Winter)
Date: Tue, 22 Apr 2008 12:56:35 +0200
Subject: Wine countdown?
In-Reply-To: <a71bd89a0804191648y4a6c2c27h4edf8129fda402b7@mail.gmail.com>
References: <a71bd89a0804191648y4a6c2c27h4edf8129fda402b7@mail.gmail.com>
Message-ID: <480DC463.4010507@informatik.uni-hamburg.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Dan Kegel wrote:
> Anybody seen the nifty countdown logo that Ubuntu is using?
> http://www.ubuntu.com/getubuntu/countdown
> Maybe we should do something similar for Wine.
Agreed.

> FWIW, here's a snippet that does something similar, but with text:
[...]

I don't like this approach for several reasons:

* It doesn't work for browsers without javascript interpreter or for
users who disabled javascript for various reasons
* You ask people to include a script in their pages (well, you didn't,
the Ubuntu people did). Including executable script code that you don't
control is a very bad idea since it is executed in the execution context
of your page (think about stealing session ids that are stored in
cookies or in the URL).
* You rely on the users clock to calculate the number of days left

Instead I propose the use of a small cgi script that calculates the
number of days left and creates a 307 redirect to the appropriate image.
I prepared some images and you can try it out:

<img src="http://teythoon.cryptobitch.de/cgi-bin/wine-countdown.py"
     alt="Wine 1.0 countdown" />

The images could use some fine tuning, feedback is always welcome :). I
couldn't find much about "official" wine artwork, I searched the wiki
for "artwork" and "logo" and googling for "wine artwork" didn't yield
any useful information either ;). The images I found were in the
website.git module...

Cheers,
Justus
- --
gpg key fingerprint: C82D 382A AB38 1A54 5290  19D6 A0F9 B035 686C 6996
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFIDcRjoPmwNWhsaZYRAhlbAJ9xksvA0TS4H9Q8ZEEmx469yeyfIgCfbZzO
LQGrNLOKHT27aNf+/eJAlEg=
=1cnU
-----END PGP SIGNATURE-----


From reif at earthlink.net  Tue Apr 22 05:55:52 2008
From: reif at earthlink.net (Robert Reif)
Date: Tue, 22 Apr 2008 06:55:52 -0400
Subject: winmm/tests: waveOutGetDevCaps called with invalid size
In-Reply-To: <Pine.LNX.4.64.0804220842440.29058@maggie.lkpg.cendio.se>
References: <Pine.LNX.4.64.0804181102080.23847@maggie.lkpg.cendio.se>	<4808B145.2010609@earthlink.net>	<Pine.LNX.4.64.0804211050260.12791@maggie.lkpg.cendio.se>	<480D12B1.3070309@earthlink.net>
	<Pine.LNX.4.64.0804220842440.29058@maggie.lkpg.cendio.se>
Message-ID: <480DC438.7010107@earthlink.net>

Peter ?strand wrote:
> However, I still think it's VERY strange to expect success from an 
> invalid call. You are describing it as an "invalid argument" yourself. 
> Why should we expect a call with an "invalid argument" to succeed? And 
> again, the test does NOT pass on all Microsoft versions; it fails on 
> Terminal Servers.
If size wasn't relevant, it wouldn't be passed.  There are only two 
options: only pass the number of bytes requested or return an error for 
unreasonable sizes.  What is Terminal Server doing?  You can check for 
the error return code if that's what it's doing and add it to the return 
values checked.  If it's doing something silly like ignoring the size 
and overrunning the buffer, then it's broken and needs to be black 
listed.  A page for the buffer can be allocated with a guard page after 
it to catch buffer overruns if necessary.
> If the point is to verify that waveOutGetDevCaps doesn't write more 
> than the size supplied, this should be verified. I'd also like to 
> point out that the Wine implementation also doesn't handle this 
> correctly: Only waveOutGetDevCapsA does a memcpy() using the size 
> argument; waveOutGetDevCapsW does not.
>
waveOutGetDevCapsW lets the driver do the copy (just like old versions 
of windows).  The driver should be checking the size and only copying 
that much.  If it doesn't, then it broken.


From hverbeet at gmail.com  Tue Apr 22 06:06:48 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Tue, 22 Apr 2008 13:06:48 +0200
Subject: Spelling fixes
In-Reply-To: <b6bb06270804212319g4875f1dev395d5651a7dba55d@mail.gmail.com>
References: <b6bb06270804212319g4875f1dev395d5651a7dba55d@mail.gmail.com>
Message-ID: <d658b69e0804220406h60d0c7ecj3a60bd84da0fecd9@mail.gmail.com>

On 22/04/2008, Austin English <austinenglish at gmail.com> wrote:
> -    /* Declare loop registers aLx */
> +    /* Declare loop registers alx */
>      for (i = 0; i < reg_maps->loop_depth; i++) {
>          shader_addline(buffer, "int aL%u;\n", i);
>          shader_addline(buffer, "int tmpInt%u;\n", i);
As can be seen a few lines down, the registers are declared as "aL%u".


From mle+win at mega-nerd.com  Tue Apr 22 06:11:25 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Tue, 22 Apr 2008 21:11:25 +1000
Subject: Wine64 : initializer element is not computable at load time?
Message-ID: <20080422211125.7c056bc1.mle+win@mega-nerd.com>

Hi all,

I'm compiling wine on x86-64 after configuring with --enable-win64
and I get the error:

    irotp.c:54: error: initializer element is not computable at load time
    irotp.c:54: error: (near initialization for 'critsect_debug.Spare[0]')

on this this code:

    51: static CRITICAL_SECTION_DEBUG critsect_debug =
    52: {
    53:    0, 0, &csRunningObjectTable,
    53:    { &critsect_debug.ProcessLocksList, &critsect_debug.ProcessLocksList },
    54:      0, 0, { (DWORD_PTR)(__FILE__ ": csRunningObjectTable") }
    55: };

Anybody understand why?

Cheers,
Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
"I'm not even an atheist so much as I am an antitheist; I not
only maintain that all religions are versions of the same
untruth, but I hold that the influence of churches, and the
effect of religious belief, is positively harmful."
-- Christopher Hitchens in "Letters to a Young Contrarian" 2001


From paul.vriens.wine at gmail.com  Tue Apr 22 06:38:13 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Tue, 22 Apr 2008 13:38:13 +0200
Subject: gdi32: Make the bitmap test pass under Windows 2000. Take 2
In-Reply-To: <E1JoGj7-0002zO-IP@mail.codeweavers.com>
References: <E1JoGj7-0002zO-IP@mail.codeweavers.com>
Message-ID: <480DCE25.8010107@gmail.com>

Dmitry Timoshkov wrote:
> Hello,
> 
> here is another version of the patch.
> --
> 
> According to test.winehq.ord data Windows 2000 behaves weird in some tests,
> this looks like a bug to me. This patch addresses these failures.
> 
> Changelog:
>     gdi32: Make the bitmap test pass under Windows 2000.
> ---
>  dlls/gdi32/tests/bitmap.c |   28 ++++++++++++++++------------
>  1 files changed, 16 insertions(+), 12 deletions(-)
> 
> diff --git a/dlls/gdi32/tests/bitmap.c b/dlls/gdi32/tests/bitmap.c
> index f7bfdfd..ba4f8bd 100644
> --- a/dlls/gdi32/tests/bitmap.c
> +++ b/dlls/gdi32/tests/bitmap.c
> @@ -276,7 +276,7 @@ static void test_dib_info(HBITMAP hbm, const void *bits, const BITMAPINFOHEADER
>  {
>      BITMAP bm;
>      DIBSECTION ds;
> -    INT ret, width_bytes;
> +    INT ret, bm_width_bytes, dib_width_bytes;
>      BYTE *buf;
>  
>      ret = GetObject(hbm, sizeof(bm), &bm);
> @@ -285,23 +285,25 @@ static void test_dib_info(HBITMAP hbm, const void *bits, const BITMAPINFOHEADER
>      ok(bm.bmType == 0, "wrong bm.bmType %d\n", bm.bmType);
>      ok(bm.bmWidth == bmih->biWidth, "wrong bm.bmWidth %d\n", bm.bmWidth);
>      ok(bm.bmHeight == bmih->biHeight, "wrong bm.bmHeight %d\n", bm.bmHeight);
> -    width_bytes = DIB_GetWidthBytes(bm.bmWidth, bm.bmBitsPixel);
> -    ok(bm.bmWidthBytes == width_bytes, "wrong bm.bmWidthBytes %d != %d\n", bm.bmWidthBytes, width_bytes);
> +    dib_width_bytes = DIB_GetWidthBytes(bm.bmWidth, bm.bmBitsPixel);
> +    bm_width_bytes = BITMAP_GetWidthBytes(bm.bmWidth, bm.bmBitsPixel);
> +    if (bm.bmWidthBytes != dib_width_bytes) /* Win2k bug */
> +        ok(bm.bmWidthBytes == bm_width_bytes, "wrong bm.bmWidthBytes %d != %d\n", bm.bmWidthBytes, bm_width_bytes);
> +    else
> +        ok(bm.bmWidthBytes == dib_width_bytes, "wrong bm.bmWidthBytes %d != %d\n", bm.bmWidthBytes, dib_width_bytes);
>      ok(bm.bmPlanes == bmih->biPlanes, "wrong bm.bmPlanes %d\n", bm.bmPlanes);
>      ok(bm.bmBitsPixel == bmih->biBitCount, "bm.bmBitsPixel %d != %d\n", bm.bmBitsPixel, bmih->biBitCount);
>      ok(bm.bmBits == bits, "wrong bm.bmBits %p != %p\n", bm.bmBits, bits);
>  
>      buf = HeapAlloc(GetProcessHeap(), 0, bm.bmWidthBytes * bm.bmHeight + 4096);
>  
> -    width_bytes = BITMAP_GetWidthBytes(bm.bmWidth, bm.bmBitsPixel);
> -
>      /* GetBitmapBits returns not 32-bit aligned data */
>      ret = GetBitmapBits(hbm, 0, NULL);
> -    ok(ret == width_bytes * bm.bmHeight, "%d != %d\n", ret, width_bytes * bm.bmHeight);
> +    ok(ret == bm_width_bytes * bm.bmHeight, "%d != %d\n", ret, bm_width_bytes * bm.bmHeight);
>  
>      memset(buf, 0xAA, bm.bmWidthBytes * bm.bmHeight + 4096);
>      ret = GetBitmapBits(hbm, bm.bmWidthBytes * bm.bmHeight + 4096, buf);
> -    ok(ret == width_bytes * bm.bmHeight, "%d != %d\n", ret, width_bytes * bm.bmHeight);
> +    ok(ret == bm_width_bytes * bm.bmHeight, "%d != %d\n", ret, bm_width_bytes * bm.bmHeight);
>  
>      HeapFree(GetProcessHeap(), 0, buf);
>  
> @@ -331,8 +333,9 @@ static void test_dib_info(HBITMAP hbm, const void *bits, const BITMAPINFOHEADER
>      ok(ret == sizeof(ds), "wrong size %d\n", ret);
>  
>      ok(ds.dsBm.bmBits == bits, "wrong bm.bmBits %p != %p\n", ds.dsBm.bmBits, bits);
> -    ok(ds.dsBmih.biSizeImage == ds.dsBm.bmWidthBytes * ds.dsBm.bmHeight, "%u != %u\n",
> -       ds.dsBmih.biSizeImage, ds.dsBm.bmWidthBytes * ds.dsBm.bmHeight);
> +    if (ds.dsBm.bmWidthBytes != bm_width_bytes) /* Win2k bug */
> +        ok(ds.dsBmih.biSizeImage == ds.dsBm.bmWidthBytes * ds.dsBm.bmHeight, "%u != %u\n",
> +           ds.dsBmih.biSizeImage, ds.dsBm.bmWidthBytes * ds.dsBm.bmHeight);
>      ok(bmih->biSizeImage == 0, "%u != 0\n", bmih->biSizeImage);
>      ds.dsBmih.biSizeImage = 0;
>  
> @@ -968,14 +971,15 @@ static void test_bitmap(void)
>      assert(hdc != 0);
>  
>      SetLastError(0xdeadbeef);
> -    hbmp = CreateBitmap(0x7ffffff, 1, 1, 1, NULL);
> -    ok(hbmp != 0, "CreateBitmap should not fail\n");
> +    hbmp = CreateBitmap(0x7fff, 0x7fff, 1, 1, NULL);
> +    ok(hbmp != 0, "CreateBitmap error %u\n", GetLastError());
>      DeleteObject(hbmp);
>  

Hi Dmitry,

This one will fail at least on my VMware box. Shouldn't the test (and it's 
confirmed by James and me) include something like:

ok(hbmp!=0 || (hbmp == 0 && GetLastError() == ERROR_NOT_ENOUGH_MEMORY), ....)

-- 
Cheers,

Paul.


From wine-devel at kievinfo.com  Tue Apr 22 09:33:20 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Tue, 22 Apr 2008 08:33:20 -0600
Subject: Removinig CVS/GIT version from bugzilla
Message-ID: <480DF730.6030006@kievinfo.com>

I'm copying my response here to continue the conversation.

Please don't remove cvs/git version.

What should be done is:
1. Leave old bugs alone or modify them case-by-case
2. All bugs with "cvs/git" version from now on can be filed on the 
development branch between releases only.
3. After the next release, if the bug is still present, modify version to 
that release. Of course no modifying of old bugs.


Vitaliy.


From ovek at arcticnet.no  Tue Apr 22 09:33:43 2008
From: ovek at arcticnet.no (Ove Kaaven)
Date: Tue, 22 Apr 2008 16:33:43 +0200
Subject: Wine64 : initializer element is not computable at load time?
In-Reply-To: <20080422211125.7c056bc1.mle+win@mega-nerd.com>
References: <20080422211125.7c056bc1.mle+win@mega-nerd.com>
Message-ID: <480DF747.3080209@arcticnet.no>

Erik de Castro Lopo skrev:
> Anybody understand why?

You could look up the definition of RTL_CRITICAL_SECTION_DEBUG in 
include/winnt.h. Then realize that __WINESRC__ is only defined for stuff 
in dlls/, not for stuff in programs/, which should make the type 
mismatch clear.




From dmitry at codeweavers.com  Tue Apr 22 09:43:52 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Tue, 22 Apr 2008 23:43:52 +0900
Subject: gdi32: Make the bitmap test pass under Windows 2000. Take 2
References: <E1JoGj7-0002zO-IP@mail.codeweavers.com>
	<480DCE25.8010107@gmail.com>
Message-ID: <008a01c8a487$4ade9320$a600fea9@DMITRY>

"Paul Vriens" <paul.vriens.wine at gmail.com> wrote:

>>      SetLastError(0xdeadbeef);
>> -    hbmp = CreateBitmap(0x7ffffff, 1, 1, 1, NULL);
>> -    ok(hbmp != 0, "CreateBitmap should not fail\n");
>> +    hbmp = CreateBitmap(0x7fff, 0x7fff, 1, 1, NULL);
>> +    ok(hbmp != 0, "CreateBitmap error %u\n", GetLastError());
>>      DeleteObject(hbmp);
>>  
> 
> Hi Dmitry,
> 
> This one will fail at least on my VMware box. Shouldn't the test (and it's 
> confirmed by James and me) include something like:
> 
> ok(hbmp!=0 || (hbmp == 0 && GetLastError() == ERROR_NOT_ENOUGH_MEMORY), ....)

Why will it fail? According to James (and you confirmed it):

> The maximum values for both width and height on win2k is 32767.
> Anything above that on either parameter returns
> ERROR_INVALID_PARAMETER.  Both params can be 32767 at the same time
> and the call will still succeed (assuming there's enough memory left).

-- 
Dmitry.


From dmitry at codeweavers.com  Tue Apr 22 09:50:05 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Tue, 22 Apr 2008 23:50:05 +0900
Subject: Fix "warning: cast from pointer to integer of different size"
References: <20080422222441.b042f27b.mle+win@mega-nerd.com>
Message-ID: <00b501c8a488$296854f0$a600fea9@DMITRY>

"Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:

> /* get pointer to object containing list element */
> #define LIST_ENTRY(elem, type, field) \
> -    ((type *)((char *)(elem) - (unsigned int)(&((type *)0)->field)))
> +    ((type *)((char *)(elem) - (unsigned long)(&((type *)0)->field)))

It should be replaced with FIELD_OFFSET instead.

-- 
Dmitry.


From paul.vriens.wine at gmail.com  Tue Apr 22 10:03:29 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Tue, 22 Apr 2008 17:03:29 +0200
Subject: gdi32: Make the bitmap test pass under Windows 2000. Take 2
In-Reply-To: <008a01c8a487$4ade9320$a600fea9@DMITRY>
References: <E1JoGj7-0002zO-IP@mail.codeweavers.com>
	<480DCE25.8010107@gmail.com>
	<008a01c8a487$4ade9320$a600fea9@DMITRY>
Message-ID: <480DFE41.50906@gmail.com>

Dmitry Timoshkov wrote:
> "Paul Vriens" <paul.vriens.wine at gmail.com> wrote:
> 
>>>      SetLastError(0xdeadbeef);
>>> -    hbmp = CreateBitmap(0x7ffffff, 1, 1, 1, NULL);
>>> -    ok(hbmp != 0, "CreateBitmap should not fail\n");
>>> +    hbmp = CreateBitmap(0x7fff, 0x7fff, 1, 1, NULL);
>>> +    ok(hbmp != 0, "CreateBitmap error %u\n", GetLastError());
>>>      DeleteObject(hbmp);
>>>  
>>
>> Hi Dmitry,
>>
>> This one will fail at least on my VMware box. Shouldn't the test (and 
>> it's confirmed by James and me) include something like:
>>
>> ok(hbmp!=0 || (hbmp == 0 && GetLastError() == 
>> ERROR_NOT_ENOUGH_MEMORY), ....)
> 
> Why will it fail? According to James (and you confirmed it):
> 
>> The maximum values for both width and height on win2k is 32767.
>> Anything above that on either parameter returns
>> ERROR_INVALID_PARAMETER.  Both params can be 32767 at the same time
>> and the call will still succeed (assuming there's enough memory left).
> 
It's that last piece: "assuming there's enough memory left".

-- 
Cheers,

Paul.


From dmitry at codeweavers.com  Tue Apr 22 10:11:39 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Wed, 23 Apr 2008 00:11:39 +0900
Subject: gdi32: Make the bitmap test pass under Windows 2000. Take 2
References: <E1JoGj7-0002zO-IP@mail.codeweavers.com>
	<480DCE25.8010107@gmail.com>
	<008a01c8a487$4ade9320$a600fea9@DMITRY> <480DFE41.50906@gmail.com>
Message-ID: <018301c8a48b$2c4ad410$a600fea9@DMITRY>

"Paul Vriens" <paul.vriens.wine at gmail.com> wrote:

>>> This one will fail at least on my VMware box. Shouldn't the test (and 
>>> it's confirmed by James and me) include something like:
>>>
>>> ok(hbmp!=0 || (hbmp == 0 && GetLastError() == 
>>> ERROR_NOT_ENOUGH_MEMORY), ....)
>> 
>> Why will it fail? According to James (and you confirmed it):
>> 
>>> The maximum values for both width and height on win2k is 32767.
>>> Anything above that on either parameter returns
>>> ERROR_INVALID_PARAMETER.  Both params can be 32767 at the same time
>>> and the call will still succeed (assuming there's enough memory left).
>> 
> It's that last piece: "assuming there's enough memory left".

That's a valid assumption I'd guess, and a lot of tests already rely
on this: every thing which indirectly or directly allocates memory,
creates windows, objects, processes, etc.

-- 
Dmitry.


From paul.vriens.wine at gmail.com  Tue Apr 22 10:47:47 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Tue, 22 Apr 2008 17:47:47 +0200
Subject: gdi32: Make the bitmap test pass under Windows 2000. Take 2
In-Reply-To: <018301c8a48b$2c4ad410$a600fea9@DMITRY>
References: <E1JoGj7-0002zO-IP@mail.codeweavers.com>
	<480DCE25.8010107@gmail.com>
	<008a01c8a487$4ade9320$a600fea9@DMITRY> <480DFE41.50906@gmail.com>
	<018301c8a48b$2c4ad410$a600fea9@DMITRY>
Message-ID: <480E08A3.3010207@gmail.com>

Dmitry Timoshkov wrote:
> "Paul Vriens" <paul.vriens.wine at gmail.com> wrote:
> 
>>>> This one will fail at least on my VMware box. Shouldn't the test 
>>>> (and it's confirmed by James and me) include something like:
>>>>
>>>> ok(hbmp!=0 || (hbmp == 0 && GetLastError() == 
>>>> ERROR_NOT_ENOUGH_MEMORY), ....)
>>>
>>> Why will it fail? According to James (and you confirmed it):
>>>
>>>> The maximum values for both width and height on win2k is 32767.
>>>> Anything above that on either parameter returns
>>>> ERROR_INVALID_PARAMETER.  Both params can be 32767 at the same time
>>>> and the call will still succeed (assuming there's enough memory left).
>>>
>> It's that last piece: "assuming there's enough memory left".
> 
> That's a valid assumption I'd guess, and a lot of tests already rely
> on this: every thing which indirectly or directly allocates memory,
> creates windows, objects, processes, etc.
> 
But the test doesn't cater for that.

If I run the test with several heights on my win2k box the maximum I can have is:

CreateBitmap(0x7fff,0x2e63, ...

before it fails with ERROR_NOT_ENOUGH_MEMORY.

This of course differs on every run. My point is that ERROR_NOT_ENOUGH_MEMORY is 
totally valid and should be catered for in the test otherwise we would still 
have failures for this test.

-- 
Cheers,

Paul.


From msclrhd at googlemail.com  Tue Apr 22 04:07:10 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Tue, 22 Apr 2008 10:07:10 +0100
Subject: winehq.org redesign
In-Reply-To: <20080422023415.48a311e3.buzzilo@gmail.com>
References: <20080422023415.48a311e3.buzzilo@gmail.com>
Message-ID: <3f4fd2640804220207w31c3d08aj40f5c7d394008de6@mail.gmail.com>

2008/4/21 Evgeny Burzak <buzzilo at gmail.com>:
> Hello all,
>  some times ago I make design for AppDB  (http://buzz.ulx.ru/pf/appdb.png). Folks was  delighted with this one, but managers rejected my idea due to needs redesign everything then.
>  But now it may be more actual then ever owing to Wine 1.0 release? I think it may gain attention from professionals who wants to use wine in production environment and improve Wine.
>  I can make design for main pages, xml/xslt template and probably base php5 clasess if you decide to change site engine.

I personally like it overall and agree that this makes sense for a
Wine 1.0 release.

Comments:

*  There is no default screenshot of applications shown in your
mockup, as they are in the current appdb.

*  It would also be nice if the website could retain its red colour theme.

*  I don't really like the coloured boxes on the Wine image, but I do
like the 3D wine bottle. It would look better if you did away with the
squares and shifted the logo to the left.

*  The CodeWeavers logo should remain as is. Also, since CodeWeavers
are hosting WineHQ I don't see why it should have the 'advertisement'
label.

- Reece


From msclrhd at googlemail.com  Tue Apr 22 07:06:45 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Tue, 22 Apr 2008 13:06:45 +0100
Subject: gdi32: Make the bitmap test pass under Windows 2000. Take 2
In-Reply-To: <480DCE25.8010107@gmail.com>
References: <E1JoGj7-0002zO-IP@mail.codeweavers.com>
	<480DCE25.8010107@gmail.com>
Message-ID: <3f4fd2640804220506t5db12a78g463e2e3fd650598d@mail.gmail.com>

2008/4/22 Paul Vriens <paul.vriens.wine at gmail.com>:
>  Hi Dmitry,
>
>  This one will fail at least on my VMware box. Shouldn't the test (and it's
>  confirmed by James and me) include something like:
>
>  ok(hbmp!=0 || (hbmp == 0 && GetLastError() == ERROR_NOT_ENOUGH_MEMORY), ....)

I would say something more like this:

    ok( (hbmp != 0 && GetLastError() == ERROR_INVALID_PARAMETER) /* Win2K */
       || (hbmp == 0 && GetLastError() == ERROR_NOT_ENOUGH_MEMORY) /* XP */,
       ... )

Since the hbmp value and the GetLastError code are related together.

- Reece


From austinenglish at gmail.com  Tue Apr 22 11:29:16 2008
From: austinenglish at gmail.com (Austin English)
Date: Tue, 22 Apr 2008 11:29:16 -0500
Subject: Documentation updating / XML?
In-Reply-To: <87iqya2nke.fsf@wine.dyndns.org>
References: <b6bb06270804212002h73a55f23i1ce083af2dbd3150@mail.gmail.com>
	<87iqya2nke.fsf@wine.dyndns.org>
Message-ID: <b6bb06270804220929x30dbaf6ftc9f056ac372a0b85@mail.gmail.com>

On Tue, Apr 22, 2008 at 5:25 AM, Alexandre Julliard <julliard at winehq.org>
wrote:

> "Austin English" <austinenglish at gmail.com> writes:
>
> > I've been working on some of the documentation, then remembered that
> Scott
> > requested a move to XML:
> > http://bugs.winehq.org/show_bug.cgi?id=12217
> >
> > There are quite a few programs to convert SGML to XML, and I've got a
> bit of
> > time to kill. Alexandre, would you accept a move to XML, or would this
> be a
> > waste of time?
>
> I don't really care about the format as long as there are decent tools
> to generate all the outputs we want. Considering the state of SGML tools
> it's probably not hard to do better...
>
> --
> Alexandre Julliard
> julliard at winehq.org
>

Web/html/PDF/XML?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080422/4bac207b/attachment-0001.htm 

From austinenglish at gmail.com  Tue Apr 22 11:29:16 2008
From: austinenglish at gmail.com (Austin English)
Date: Tue, 22 Apr 2008 11:29:16 -0500
Subject: Documentation updating / XML?
In-Reply-To: <87iqya2nke.fsf@wine.dyndns.org>
References: <b6bb06270804212002h73a55f23i1ce083af2dbd3150@mail.gmail.com>
	<87iqya2nke.fsf@wine.dyndns.org>
Message-ID: <b6bb06270804220929x30dbaf6ftc9f056ac372a0b85@mail.gmail.com>

On Tue, Apr 22, 2008 at 5:25 AM, Alexandre Julliard <julliard at winehq.org>
wrote:

> "Austin English" <austinenglish at gmail.com> writes:
>
> > I've been working on some of the documentation, then remembered that
> Scott
> > requested a move to XML:
> > http://bugs.winehq.org/show_bug.cgi?id=12217
> >
> > There are quite a few programs to convert SGML to XML, and I've got a
> bit of
> > time to kill. Alexandre, would you accept a move to XML, or would this
> be a
> > waste of time?
>
> I don't really care about the format as long as there are decent tools
> to generate all the outputs we want. Considering the state of SGML tools
> it's probably not hard to do better...
>
> --
> Alexandre Julliard
> julliard at winehq.org
>

Web/html/PDF/XML?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080422/4bac207b/attachment-0002.htm 

From l_bratch at yahoo.co.uk  Tue Apr 22 11:15:53 2008
From: l_bratch at yahoo.co.uk (Luke Bratch)
Date: Tue, 22 Apr 2008 16:15:53 +0000 (GMT)
Subject: wine-announce and wine-users getting hammered
Message-ID: <138291.26516.qm@web26004.mail.ukl.yahoo.com>

Hi

I do the moderation for these lists, and wine-accounce and wine-users are getting absolutely hammered with notification error messages today (in the order of around 15 per minute all day long).

I've been clearing these out, but perhaps this is an indication of someone targeting these lists?

Luke


      __________________________________________________________
Sent from Yahoo! Mail.
A Smarter Email http://uk.docs.yahoo.com/nowyoucan.html


From juan.lang at gmail.com  Tue Apr 22 13:00:22 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Tue, 22 Apr 2008 11:00:22 -0700
Subject: [PATCH 05/21] [WinHelp]: properly handle the back button (in
	multiple windows, in empty stack...)
Message-ID: <3a768c550804221100m69cd23cfu2cd907fbd3bfcdd8@mail.gmail.com>

+ *		WINHELP_DeleteButtons
+ *
+ */
+void WINHELP_DeleteBackSet(WINHELP_WINDOW* win)

Nit:  the comment should match the function.
--Juan


From juan.lang at gmail.com  Tue Apr 22 13:00:22 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Tue, 22 Apr 2008 11:00:22 -0700
Subject: [PATCH 05/21] [WinHelp]: properly handle the back button (in
	multiple windows, in empty stack...)
Message-ID: <3a768c550804221100m69cd23cfu2cd907fbd3bfcdd8@mail.gmail.com>

+ *		WINHELP_DeleteButtons
+ *
+ */
+void WINHELP_DeleteBackSet(WINHELP_WINDOW* win)

Nit:  the comment should match the function.
--Juan


From frank.richter at gmail.com  Tue Apr 22 13:32:51 2008
From: frank.richter at gmail.com (Frank Richter)
Date: Tue, 22 Apr 2008 20:32:51 +0200
Subject: Alex =?UTF-8?B?VmlsbGFjw61zIExhc3NvIDogdXh0aGVtZTogICBTcGVlZA==?=
	=?UTF-8?B?IHVwIFVYVEhFTUVfU2l6ZWRCbHQgaW4gdGhlIFNUX1RJTEUgYnkgYnVpbGRpbmc=?=
	=?UTF-8?B?IGFuICAgYXBwcm9wcmlhdGVseS1zaXplZCBtZW1vcnkgYml0bWFwIG91dCBvZiA=?=
	=?UTF-8?B?dGhlIHRpbGUgaW5zdGVhZCBvZiAgIGl0ZXJhdGluZyB3aXRoIFVYVEhFTUVfQmw=?=
	=?UTF-8?B?dCAoKSBkaXJlY3RseS4=?=
In-Reply-To: <E1JoGyB-0001fK-TB@wine.codeweavers.com>
References: <E1JoGyB-0001fK-TB@wine.codeweavers.com>
Message-ID: <480E2F53.9070401@gmail.com>

On 22.04.2008 13:47, Alexandre Julliard wrote:
> uxtheme: Speed up UXTHEME_SizedBlt in the ST_TILE by building an appropriately-sized memory bitmap out of the tile instead of iterating with UXTHEME_Blt() directly.

But does that keep the alpha channel intact?

-f.r.


From eric.pouech at orange.fr  Tue Apr 22 14:58:12 2008
From: eric.pouech at orange.fr (Eric Pouech)
Date: Tue, 22 Apr 2008 21:58:12 +0200
Subject: [PATCH 01/21] [WinHelp]: get rid of the reuse concept for Windows
	and refactor the code a bit for window creation / deletion
In-Reply-To: <87mynm2nxu.fsf@wine.dyndns.org>
References: <20080421190145.12982.57452.stgit@localhost>	<20080421190646.12982.96067.stgit@localhost>
	<87mynm2nxu.fsf@wine.dyndns.org>
Message-ID: <480E4354.3050209@orange.fr>

Alexandre Julliard a ?crit :
> Eric Pouech <eric.pouech at orange.fr> writes:
>
>   
>>  programs/winhelp/winhelp.c |  257 ++++++++++++++++++++------------------------
>>  1 files changed, 116 insertions(+), 141 deletions(-)
>>     
>
> This breaks window repaints for me, when switching pages the window is
> not repainted and still shows the old page.
>
>   
actually, not really... it works when you click a second time on the 
same hyperlink
that should be considered as a semi-conscious user-interface enhancement 
in order to help users switch to the new interface <g>
I'll resend the lot with a fix
A+

-- 
Eric Pouech
"The problem with designing something completely foolproof is to underestimate the ingenuity of a complete idiot." (Douglas Adams)




From mle+win at mega-nerd.com  Tue Apr 22 15:53:22 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Wed, 23 Apr 2008 06:53:22 +1000
Subject: Fix "warning: cast from pointer to integer of different size"
In-Reply-To: <00b501c8a488$296854f0$a600fea9@DMITRY>
References: <20080422222441.b042f27b.mle+win@mega-nerd.com>
	<00b501c8a488$296854f0$a600fea9@DMITRY>
Message-ID: <20080423065322.3938d77c.mle+win@mega-nerd.com>

Dmitry Timoshkov wrote:

> "Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:
> 
> > /* get pointer to object containing list element */
> > #define LIST_ENTRY(elem, type, field) \
> > -    ((type *)((char *)(elem) - (unsigned int)(&((type *)0)->field)))
> > +    ((type *)((char *)(elem) - (unsigned long)(&((type *)0)->field)))
> 
> It should be replaced with FIELD_OFFSET instead.

FIELD_OFFSET is defined in include/winnt.h. 

Now I could include winnt.h into include/wine/list.h but that doesn't
seem right. I could also copy it,but having two difinitions of the
same macro is also not right. I'm also sure that moving the definition
from include/winnt.h to include/wine/list.h will break existing code.

Any suggestions for dealing with this?

Cheers,
Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
"The Internet interprets censorship as damage, and routes around it."
  -- John Gilmore


From mle+win at mega-nerd.com  Tue Apr 22 16:26:17 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Wed, 23 Apr 2008 07:26:17 +1000
Subject: Wine64 : initializer element is not computable at load time?
In-Reply-To: <480DF747.3080209@arcticnet.no>
References: <20080422211125.7c056bc1.mle+win@mega-nerd.com>
	<480DF747.3080209@arcticnet.no>
Message-ID: <20080423072617.76332e3d.mle+win@mega-nerd.com>

Ove Kaaven wrote:

> Erik de Castro Lopo skrev:
> > Anybody understand why?
> 
> You could look up the definition of RTL_CRITICAL_SECTION_DEBUG in 
> include/winnt.h. Then realize that __WINESRC__ is only defined for stuff 
> in dlls/, not for stuff in programs/, which should make the type 
> mismatch clear.

The error message says nothing about a type mismatch its complaining
about something not being compulatble a load time.

In include/winnt.h we have:

    #ifdef __WINESRC__  /* in Wine we store the name here */
      DWORD_PTR Spare[8/sizeof(DWORD_PTR)];
    #else
      DWORD Spare[ 2 ];
    #endif

and the code tries to initialize Spare with this:

    { (DWORD_PTR)(__FILE__ ": csRunningObjectTable") }

That makes me suspect that the non  __WINESRC__ definition
is wrong and that the whole #ifdef above could be replaced
with 

      DWORD_PTR Spare[8/sizeof(DWORD_PTR)];

Is that right?

Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
"Copyrighting allows people to benefit from their labours,
but software patents allow the companies with the largest
legal departments to benefit from everyone else's work."
-- Andrew Brown
(http://www.guardian.co.uk/online/comment/story/0,12449,1387575,00.html)


From scott at open-vote.org  Tue Apr 22 16:28:30 2008
From: scott at open-vote.org (Scott Ritchie)
Date: Tue, 22 Apr 2008 14:28:30 -0700
Subject: Removinig CVS/GIT version from bugzilla
In-Reply-To: <480DF730.6030006@kievinfo.com>
References: <480DF730.6030006@kievinfo.com>
Message-ID: <480E587E.3070209@open-vote.org>

Vitaliy Margolen wrote:
> 3. After the next release, if the bug is still present, modify version to 
> that release. Of course no modifying of old bugs.
> 

Sounds like a simple addition to Alexandre's (scripted?) closing of all
fixed bugs on release day.

Thanks,
Scott Ritchie


From austinenglish at gmail.com  Tue Apr 22 16:36:27 2008
From: austinenglish at gmail.com (Austin English)
Date: Tue, 22 Apr 2008 16:36:27 -0500
Subject: SOC 2008 Projects Announced
Message-ID: <b6bb06270804221436s5dfab6fctbe89047e55b4a8e9@mail.gmail.com>

For those of you who haven't heard yet, the Google SOC Projects were
announced today:
http://google-opensource.blogspot.com/2008/04/announcing-accepted-student-proposals.html

5 Wine projects have been accepted:
http://code.google.com/soc/2008/wine/about.html

  <http://code.google.com/soc/2008/wine/about.html#>Improving Wine MSXML
implementation
<http://code.google.com/soc/2008/wine/appinfo.html?csaid=A546A592C8ACDDD5>
 by Piotr Caban, mentored by James Hawkins
  Print Dialog
<http://code.google.com/soc/2008/wine/appinfo.html?csaid=7CC6A70D0D7A1FDE>
 by Gal Topper, mentored by Detlef Riekenberg
   <http://code.google.com/soc/2008/wine/about.html#> Implementing proper
Control Panel support for Wine
<http://code.google.com/soc/2008/wine/appinfo.html?csaid=8B4254855F2BD854>
 by Owen Rudge, mentored by Juan Lang
   <http://code.google.com/soc/2008/wine/about.html#> DirectPlay
implementation
<http://code.google.com/soc/2008/wine/appinfo.html?csaid=984D708DA20ACA94>
 by Ismael Barros Barros, mentored by Kai Blin
  Wine - Richedit with Tables
<http://code.google.com/soc/2008/wine/appinfo.html?csaid=7D1930729985958C>
 by Dylan Andrew Harper Smith, mentored by Huw D M Davies
   <http://code.google.com/soc/2008/wine/about.html#> Improve Gdi+
Implemenation
<http://code.google.com/soc/2008/wine/appinfo.html?csaid=7BE88570BACC2046>
 by Adam Joel Petaccia, mentored by Lei Zhang

Thanks to all those who applied and congrats to those who were accepted!

Now get hacking ;-).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080422/7e30514a/attachment.htm 

From scott at open-vote.org  Tue Apr 22 16:59:00 2008
From: scott at open-vote.org (Scott Ritchie)
Date: Tue, 22 Apr 2008 14:59:00 -0700
Subject: winehq.org redesign
In-Reply-To: <20080422023415.48a311e3.buzzilo@gmail.com>
References: <20080422023415.48a311e3.buzzilo@gmail.com>
Message-ID: <480E5FA4.7080404@open-vote.org>

Evgeny Burzak wrote:
> Hello all,
> some times ago I make design for AppDB  (http://buzz.ulx.ru/pf/appdb.png). Folks was  delighted with this one, but managers rejected my idea due to needs redesign everything then. 
> But now it may be more actual then ever owing to Wine 1.0 release? I think it may gain attention from professionals who wants to use wine in production environment and improve Wine.
> I can make design for main pages, xml/xslt template and probably base php5 clasess if you decide to change site engine.
> 

Why do we even have a top 10 gold and top 10 silver list anyway?  Why
not just a top 30 platinum list based on popularity?

Also, it's not made clear how an application gets into the top 10.
Intuitively, a top 10 list for the front page would be a list of the top
10 most popular applications to run with Wine (perhaps judged by AppDB
hits).

If it's based on votes, then how are any platinum applications there?
Votes are supposed to indicate "I want more work done on this
application" rather than "I like this application" -- that's why votes
for platinum applications were supposed to disintegrate.  We already
have a separate list for the top voted applications.


Regarding the design itself, the colored boxes remind me more of a
children's party than a useful piece of software.  If you want to add
color to the page, it seems like there are other ways to do it without
calling garish attention to the Wine logo.

That said, winehq and appdb definitely need a new redesign, and I'm very
happy you've offered to help.

Thanks,
Scott Ritchie


From alex at thehandofagony.com  Tue Apr 22 17:06:16 2008
From: alex at thehandofagony.com (Alexander Nicolaysen =?iso-8859-1?q?S=F8rnes?=)
Date: Wed, 23 Apr 2008 00:06:16 +0200
Subject: winehq.org redesign
In-Reply-To: <20080422023415.48a311e3.buzzilo@gmail.com>
References: <20080422023415.48a311e3.buzzilo@gmail.com>
Message-ID: <200804230006.17192.alex@thehandofagony.com>

> Hello all,
> some times ago I make design for AppDB  (http://buzz.ulx.ru/pf/appdb.png).
> Folks was  delighted with this one, but managers rejected my idea due to
> needs redesign everything then. But now it may be more actual then ever
> owing to Wine 1.0 release? I think it may gain attention from professionals
> who wants to use wine in production environment and improve Wine. I can
> make design for main pages, xml/xslt template and probably base php5
> clasess if you decide to change site engine.
>
> --
> Evgeny


Thanks for the design and for bringing it up again!  It certainly contains a 
lot of good ideas about how the site can be improved.



Alexander N. S?rnes


From research at science.su  Tue Apr 22 17:18:21 2008
From: research at science.su (L. Rahyen)
Date: Tue, 22 Apr 2008 22:18:21 +0000
Subject: winehq.org redesign
In-Reply-To: <3f4fd2640804220207w31c3d08aj40f5c7d394008de6@mail.gmail.com>
References: <20080422023415.48a311e3.buzzilo@gmail.com>
	<3f4fd2640804220207w31c3d08aj40f5c7d394008de6@mail.gmail.com>
Message-ID: <200804222218.21375.research@science.su>

On Tuesday April 22 2008 09:07:10 Reece Dunn wrote:
> 2008/4/21 Evgeny Burzak <buzzilo at gmail.com>:
> > Hello all,
> >  some times ago I make design for AppDB 
> > (http://buzz.ulx.ru/pf/appdb.png). Folks was  delighted with this one,
> > but managers rejected my idea due to needs redesign everything then. But
> > now it may be more actual then ever owing to Wine 1.0 release? I think it
> > may gain attention from professionals who wants to use wine in production
> > environment and improve Wine. I can make design for main pages, xml/xslt
> > template and probably base php5 clasess if you decide to change site
> > engine.

	Yeah, great design!

> I personally like it overall and agree that this makes sense for a
> Wine 1.0 release.
>
> Comments:
>
> *  There is no default screenshot of applications shown in your
> mockup, as they are in the current appdb.
>
> *  It would also be nice if the website could retain its red colour theme.
>
> *  I don't really like the coloured boxes on the Wine image, but I do
> like the 3D wine bottle. It would look better if you did away with the
> squares and shifted the logo to the left.

	I don't like colored boxes too. But 3D logo is good so I think getting rid of 
colored boxes is good idea. It might be better to add some kind of "neutral" 
background for 3D logo.


From a_villacis at palosanto.com  Tue Apr 22 18:00:46 2008
From: a_villacis at palosanto.com (=?ISO-8859-1?Q?Alex_Villac=ED=ADs_Lasso?=)
Date: Tue, 22 Apr 2008 18:00:46 -0500
Subject: Alex =?ISO-8859-1?Q?Villac=EDs_Lasso_=3A_uxtheme=3A_?=
	=?ISO-8859-1?Q?__Speed_up_UXTHEME=5FSizedBlt_in_the_ST=5FT?=
	=?ISO-8859-1?Q?ILE_by_building_an___appropriately-sized_me?=
	=?ISO-8859-1?Q?mory_bitmap_out_of_the_tile_instead_of__?=
	=?ISO-8859-1?Q?_iterating_with_UXTHEME=5FBlt_=28=29_directly=2E?=
In-Reply-To: <480E2F53.9070401@gmail.com>
References: <E1JoGyB-0001fK-TB@wine.codeweavers.com>
	<480E2F53.9070401@gmail.com>
Message-ID: <480E6E1E.6090809@palosanto.com>

Frank Richter escribio':
> On 22.04.2008 13:47, Alexandre Julliard wrote:
>   
>> uxtheme: Speed up UXTHEME_SizedBlt in the ST_TILE by building an appropriately-sized memory bitmap out of the tile instead of iterating with UXTHEME_Blt() directly.
>>     
>
> But does that keep the alpha channel intact?
>
> -f.r.
>
>   
I directed my themes to the ones on the WinXP partition, and saw no 
difference after the patch, other than the increase in speed. However, 
this might not be a proper test case. I used CreateCompatibleDC out of 
the source HDC, and CreateCompatibleBitmap in the same way. If these 
operations preserve the alpha channel, and BitBlt(SRCCOPY) does too, the 
patch as a whole should be correct. Have you seen a theme that uses 
alpha and breaks with my patch?

-- 
perl -e '$x=2.4;print sprintf("%.0f + %.0f = %.0f\n",$x,$x,$x+$x);'



From ovek at arcticnet.no  Tue Apr 22 18:19:20 2008
From: ovek at arcticnet.no (Ove Kaaven)
Date: Wed, 23 Apr 2008 01:19:20 +0200
Subject: Wine64 : initializer element is not computable at load time?
In-Reply-To: <20080423072617.76332e3d.mle+win@mega-nerd.com>
References: <20080422211125.7c056bc1.mle+win@mega-nerd.com>	<480DF747.3080209@arcticnet.no>
	<20080423072617.76332e3d.mle+win@mega-nerd.com>
Message-ID: <480E7278.8070307@arcticnet.no>

Erik de Castro Lopo skrev:
> Ove Kaaven wrote:
> 
>> Erik de Castro Lopo skrev:
>>> Anybody understand why?
>> You could look up the definition of RTL_CRITICAL_SECTION_DEBUG in 
>> include/winnt.h. Then realize that __WINESRC__ is only defined for stuff 
>> in dlls/, not for stuff in programs/, which should make the type 
>> mismatch clear.
> 
> The error message says nothing about a type mismatch its complaining
> about something not being compulatble a load time.

Yes, I said "type mismatch" to clarify the error. It's not possible to 
fit a 64-bit pointer value into a static 32-bit DWORD at "load time" 
(probably means relocation time). The types aren't compatible.

> That makes me suspect that the non  __WINESRC__ definition
> is wrong and that the whole #ifdef above could be replaced
> with 
> 
>       DWORD_PTR Spare[8/sizeof(DWORD_PTR)];
> 
> Is that right?

No, in the case of Winelib apps, every Wine definition should match the 
Windows definition exactly. And here, DWORD_PTR would be 64-bit and 
DWORD would be 32-bit, so it's not exactly a perfect match.

But I'm not proposing any particular solution, I just said what's wrong.




From m.b.lankhorst at gmail.com  Tue Apr 22 18:53:33 2008
From: m.b.lankhorst at gmail.com (Maarten Lankhorst)
Date: Tue, 22 Apr 2008 16:53:33 -0700
Subject: Removinig CVS/GIT version from bugzilla
In-Reply-To: <480E587E.3070209@open-vote.org>
References: <480DF730.6030006@kievinfo.com> <480E587E.3070209@open-vote.org>
Message-ID: <b130c85e0804221653i1749fbd5i1633279dc015a805@mail.gmail.com>

Hello Scott,

2008/4/22 Scott Ritchie <scott at open-vote.org>:
> Vitaliy Margolen wrote:
>  > 3. After the next release, if the bug is still present, modify version to
>  > that release. Of course no modifying of old bugs.
>  >
>
>  Sounds like a simple addition to Alexandre's (scripted?) closing of all
>  fixed bugs on release day.
I don't think that is needed, all that is needed is to rename git to
wine-0.9.XX and and then create a new git tag.

Cheers,
Maarten.


From chmorgan at gmail.com  Tue Apr 22 19:23:27 2008
From: chmorgan at gmail.com (Chris Morgan)
Date: Tue, 22 Apr 2008 20:23:27 -0400
Subject: winehq.org redesign
In-Reply-To: <480E5FA4.7080404@open-vote.org>
References: <20080422023415.48a311e3.buzzilo@gmail.com>
	<480E5FA4.7080404@open-vote.org>
Message-ID: <f3f1b91a0804221723v411255a2pda668cd191458e5b@mail.gmail.com>

>  Regarding the design itself, the colored boxes remind me more of a
>  children's party than a useful piece of software.  If you want to add
>  color to the page, it seems like there are other ways to do it without
>  calling garish attention to the Wine logo.
>

Garish? ;-) I thought the top X entries looked great.

>  That said, winehq and appdb definitely need a new redesign, and I'm very
>  happy you've offered to help.
>
>  Thanks,
>  Scott Ritchie
>
>
>

We've been throwing around the idea of switching the site to using
drupal for a while now so we can more easily manage it remotely and
take advantage of things like polls and news stories.

I'll suggest the same thing I mentioned the last time the redesign
came up, we should make the changes individually, picking the most
important ones first.

- Program icons (I really like these)
- Stats block on the main page is great (This is something Drupal is
suited to, enabling us to add a box like this and make it user
configurable)
- Collapsing the many 'browse' options, maybe into a menu that expands
when clicked or hovered, or simply removing the options and improving
the UI to have the same capabilities without special links.

I'm sure more can be found but these are the ones that stuck out as
some of the biggest improvements. We also need to find people
interested in working on some of these features.

Chris


From wine-devel at kievinfo.com  Tue Apr 22 19:38:19 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Tue, 22 Apr 2008 18:38:19 -0600
Subject: Removinig CVS/GIT version from bugzilla
In-Reply-To: <b130c85e0804221653i1749fbd5i1633279dc015a805@mail.gmail.com>
References: <480DF730.6030006@kievinfo.com> <480E587E.3070209@open-vote.org>
	<b130c85e0804221653i1749fbd5i1633279dc015a805@mail.gmail.com>
Message-ID: <480E84FB.4080700@kievinfo.com>

Maarten Lankhorst wrote:
> Hello Scott,
> 
> 2008/4/22 Scott Ritchie <scott at open-vote.org>:
>> Vitaliy Margolen wrote:
>>  > 3. After the next release, if the bug is still present, modify version to
>>  > that release. Of course no modifying of old bugs.
>>  >
>>
>>  Sounds like a simple addition to Alexandre's (scripted?) closing of all
>>  fixed bugs on release day.
> I don't think that is needed, all that is needed is to rename git to
> wine-0.9.XX and and then create a new git tag.
> 
Well that will affect closed bugs - which is not good. However I don't have 
a strong objection here - whatever works. It would be even better if we can 
add the version automatically with release scripts.

Vitaliy.


From dmitry at codeweavers.com  Tue Apr 22 22:12:16 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Wed, 23 Apr 2008 12:12:16 +0900
Subject: gdi32: Make the bitmap test pass under Windows 2000. Take 2
References: <E1JoGj7-0002zO-IP@mail.codeweavers.com><480DCE25.8010107@gmail.com><008a01c8a487$4ade9320$a600fea9@DMITRY>
	<480DFE41.50906@gmail.com><018301c8a48b$2c4ad410$a600fea9@DMITRY>
	<480E08A3.3010207@gmail.com>
Message-ID: <00cf01c8a4ef$d6fa0e30$a600fea9@DMITRY>

"Paul Vriens" <paul.vriens.wine at gmail.com> wrote:

>>> It's that last piece: "assuming there's enough memory left".
>> 
>> That's a valid assumption I'd guess, and a lot of tests already rely
>> on this: every thing which indirectly or directly allocates memory,
>> creates windows, objects, processes, etc.
>> 
> But the test doesn't cater for that.
> 
> If I run the test with several heights on my win2k box the maximum I can have is:
> 
> CreateBitmap(0x7fff,0x2e63, ...
> 
> before it fails with ERROR_NOT_ENOUGH_MEMORY.
> 
> This of course differs on every run. My point is that ERROR_NOT_ENOUGH_MEMORY is 
> totally valid and should be catered for in the test otherwise we would still 
> have failures for this test.

I don't think it's a good idea to pollute every test that could fail
due to insufficient memory with fake error handling.

-- 
Dmitry.


From m.b.lankhorst at gmail.com  Tue Apr 22 23:14:43 2008
From: m.b.lankhorst at gmail.com (Maarten Lankhorst)
Date: Tue, 22 Apr 2008 21:14:43 -0700
Subject: SOC 2008 Projects Announced
In-Reply-To: <b6bb06270804221436s5dfab6fctbe89047e55b4a8e9@mail.gmail.com>
References: <b6bb06270804221436s5dfab6fctbe89047e55b4a8e9@mail.gmail.com>
Message-ID: <b130c85e0804222114v3b8abc00v965c598d780e5a44@mail.gmail.com>

Hi Austin,

2008/4/22 Austin English <austinenglish at gmail.com>:
> For those of you who haven't heard yet, the Google SOC Projects were
> announced today:
> http://google-opensource.blogspot.com/2008/04/announcing-accepted-student-proposals.html
>
> 5 Wine projects have been accepted:
> http://code.google.com/soc/2008/wine/about.html
I count six?

>  Improving Wine MSXML implementation
>  by Piotr Caban, mentored by James Hawkins
>
>  Print Dialog
>  by Gal Topper, mentored by Detlef Riekenberg
>
>  Implementing proper Control Panel support for Wine
>  by Owen Rudge, mentored by Juan Lang
>
>  DirectPlay implementation
>  by Ismael Barros Barros, mentored by Kai Blin
>
>  Wine - Richedit with Tables
>  by Dylan Andrew Harper Smith, mentored by Huw D M Davies
>
>  Improve Gdi+ Implemenation
>  by Adam Joel Petaccia, mentored by Lei Zhang
> Thanks to all those who applied and congrats to those who were accepted!
Could the students come forward and say something about themself?

Cheers,
Maarten.


PS: Please no html formatted emails.


From dmitry at codeweavers.com  Tue Apr 22 23:14:40 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Wed, 23 Apr 2008 13:14:40 +0900
Subject: Fix "warning: cast from pointer to integer of different size"
References: <20080422222441.b042f27b.mle+win@mega-nerd.com><00b501c8a488$296854f0$a600fea9@DMITRY>
	<20080423065322.3938d77c.mle+win@mega-nerd.com>
Message-ID: <00c301c8a4f8$8ea65810$a600fea9@DMITRY>

"Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:

>> > /* get pointer to object containing list element */
>> > #define LIST_ENTRY(elem, type, field) \
>> > -    ((type *)((char *)(elem) - (unsigned int)(&((type *)0)->field)))
>> > +    ((type *)((char *)(elem) - (unsigned long)(&((type *)0)->field)))
>> 
>> It should be replaced with FIELD_OFFSET instead.
> 
> FIELD_OFFSET is defined in include/winnt.h. 
> 
> Now I could include winnt.h into include/wine/list.h but that doesn't
> seem right. I could also copy it,but having two difinitions of the
> same macro is also not right. I'm also sure that moving the definition
> from include/winnt.h to include/wine/list.h will break existing code.
> 
> Any suggestions for dealing with this?

Replacing (unsigned int) cast by (unsigned long) doesn't guarantee
anything, long can be a 32-bit entity on a 64-bit platform.

-- 
Dmitry.


From mle+win at mega-nerd.com  Tue Apr 22 23:34:56 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Wed, 23 Apr 2008 14:34:56 +1000
Subject: Fix "warning: cast from pointer to integer of different size"
In-Reply-To: <00c301c8a4f8$8ea65810$a600fea9@DMITRY>
References: <20080422222441.b042f27b.mle+win@mega-nerd.com>
	<00b501c8a488$296854f0$a600fea9@DMITRY>
	<20080423065322.3938d77c.mle+win@mega-nerd.com>
	<00c301c8a4f8$8ea65810$a600fea9@DMITRY>
Message-ID: <20080423143456.9f1fd022.mle+win@mega-nerd.com>

Dmitry Timoshkov wrote:

> "Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:
> 
> > FIELD_OFFSET is defined in include/winnt.h. 
> > 
> > Now I could include winnt.h into include/wine/list.h but that doesn't
> > seem right. I could also copy it,but having two definitions of the
> > same macro is also not right. I'm also sure that moving the definition
> > from include/winnt.h to include/wine/list.h will break existing code.
> > 
> > Any suggestions for dealing with this?
> 
> Replacing (unsigned int) cast by (unsigned long) doesn't guarantee
> anything, long can be a 32-bit entity on a 64-bit platform.

I'm perfectly happy to accept that, but the real question was,
"what is the best way to get FIELD_OFFSET in include/wine/list.h?".

I see four options:

 0) Include include/winnt.h into include/wine/list.h. Ugly!

 1) Copy definition of FIELD_OFFSET macro from include/winnt.h to
    include/wine/list.h. Ugly!

 2) Move the definition of FIELD_OFFSET macro from include/winnt.h to
    include/wine/list.h. This will probably break existing code. Ugly!

 3) Add a definition if FIELD_OFFSET wrapped in #ifndef. This is the
    least ugly option but would cause surprising results if one or
    the other was changed.

So, to rephrase the question, which of the above would actually be
accepted as a patch? If none of them are good enough (highly 
likely) can someone please suggest an alternative that would be
acceptable?

Cheers,
Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
Journalist: Microsoft CEO Steve Ballmer has finally said Linux
            is the No. 1 threat to Windows. What's your response to that?
Linus     : "Tag, you're it." I don't care. They've had a lot of
            enemies in their time. Let them fight one enemy that
            doesn't care for a change.


From m.b.lankhorst at gmail.com  Tue Apr 22 23:52:02 2008
From: m.b.lankhorst at gmail.com (Maarten Lankhorst)
Date: Tue, 22 Apr 2008 21:52:02 -0700
Subject: Wine t-shirts?
Message-ID: <b130c85e0804222152k5447661bo496c267ce6f8a311@mail.gmail.com>

Hi all,

Why don't we have wine t-shirts any more?

Cheers,
Maarten.


From paul.vriens.wine at gmail.com  Wed Apr 23 01:08:55 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Wed, 23 Apr 2008 08:08:55 +0200
Subject: gdi32: Make the bitmap test pass under Windows 2000. Take 2
In-Reply-To: <00cf01c8a4ef$d6fa0e30$a600fea9@DMITRY>
References: <E1JoGj7-0002zO-IP@mail.codeweavers.com><480DCE25.8010107@gmail.com><008a01c8a487$4ade9320$a600fea9@DMITRY>
	<480DFE41.50906@gmail.com><018301c8a48b$2c4ad410$a600fea9@DMITRY>
	<480E08A3.3010207@gmail.com>
	<00cf01c8a4ef$d6fa0e30$a600fea9@DMITRY>
Message-ID: <480ED277.7080500@gmail.com>

Dmitry Timoshkov wrote:
> "Paul Vriens" <paul.vriens.wine at gmail.com> wrote:
> 
>>>> It's that last piece: "assuming there's enough memory left".
>>>
>>> That's a valid assumption I'd guess, and a lot of tests already rely
>>> on this: every thing which indirectly or directly allocates memory,
>>> creates windows, objects, processes, etc.
>>>
>> But the test doesn't cater for that.
>>
>> If I run the test with several heights on my win2k box the maximum I 
>> can have is:
>>
>> CreateBitmap(0x7fff,0x2e63, ...
>>
>> before it fails with ERROR_NOT_ENOUGH_MEMORY.
>>
>> This of course differs on every run. My point is that 
>> ERROR_NOT_ENOUGH_MEMORY is totally valid and should be catered for in 
>> the test otherwise we would still have failures for this test.
> 
> I don't think it's a good idea to pollute every test that could fail
> due to insufficient memory with fake error handling.
> 
The title of the patch says "Make the bitmap test pass under Windows 2000". 
Introducing the test as you did doesn't do that as in some cases it will fail.

But we can spent hours on this. Let's go on and see if AJ will accept the patch.

-- 
Cheers,

Paul.


From marcus at jet.franken.de  Wed Apr 23 01:29:20 2008
From: marcus at jet.franken.de (Marcus Meissner)
Date: Wed, 23 Apr 2008 08:29:20 +0200
Subject: wine-announce and wine-users getting hammered
In-Reply-To: <138291.26516.qm@web26004.mail.ukl.yahoo.com>
References: <138291.26516.qm@web26004.mail.ukl.yahoo.com>
Message-ID: <20080423062920.GA2474@galeere>

On Tue, Apr 22, 2008 at 04:15:53PM +0000, Luke Bratch wrote:
> Hi
> 
> I do the moderation for these lists, and wine-accounce and wine-users are getting absolutely hammered with notification error messages today (in the order of around 15 per minute all day long).
> 
> I've been clearing these out, but perhaps this is an indication of someone targeting these lists?

No it is going around, but also stopping...

I had hundreds of such mails on my private and company accounts (and
lists), but they stopped again.

Ciao, Marcus


From astrand at cendio.se  Wed Apr 23 01:44:55 2008
From: astrand at cendio.se (=?UTF-8?Q?Peter_=C3=85strand?=)
Date: Wed, 23 Apr 2008 08:44:55 +0200 (CEST)
Subject: winmm/tests: waveOutGetDevCaps called with invalid size
In-Reply-To: <480DC438.7010107@earthlink.net>
References: <Pine.LNX.4.64.0804181102080.23847@maggie.lkpg.cendio.se>
	<4808B145.2010609@earthlink.net>
	<Pine.LNX.4.64.0804211050260.12791@maggie.lkpg.cendio.se>
	<480D12B1.3070309@earthlink.net>
	<Pine.LNX.4.64.0804220842440.29058@maggie.lkpg.cendio.se>
	<480DC438.7010107@earthlink.net>
Message-ID: <Pine.LNX.4.64.0804230822450.15637@maggie.lkpg.cendio.se>


> > However, I still think it's VERY strange to expect success from an invalid
> > call. You are describing it as an "invalid argument" yourself. Why should we
> > expect a call with an "invalid argument" to succeed? And again, the test
> > does NOT pass on all Microsoft versions; it fails on Terminal Servers.
> If size wasn't relevant, it wouldn't be passed.  

The size is used for determining which kind of WAVEOUTCAPS structure you 
pass. 


> There are only two options:
> only pass the number of bytes requested or return an error for unreasonable
> sizes.  What is Terminal Server doing?  

It's returning an error. 


> > If the point is to verify that waveOutGetDevCaps doesn't write more than the
> > size supplied, this should be verified. I'd also like to point out that the
> > Wine implementation also doesn't handle this correctly: Only
> > waveOutGetDevCapsA does a memcpy() using the size argument;
> > waveOutGetDevCapsW does not.
> >
> waveOutGetDevCapsW lets the driver do the copy (just like old versions of
> windows).  The driver should be checking the size and only copying that much.
> If it doesn't, then it broken.

Any references for this claim?

You are saying that the driver "should only copy that much", but *what* 
should it copy? In other words: If the size doesn't match the size of any 
known structure (WAVEOUTCAPSA/WAVEOUTCAPSW/WAVEOUTCAPS2A/WAVEOUTCAPS2W), 
should the driver then just *assume* some structure? Which one? As far as 
I know, there's no guarantee that, for example, the first 
sizeof(WAVEOUTCAPSW) bytes of WAVEOUTCAPSW are the same as WAVEOUTCAPS2W. 


Rgds, 
---
Peter ?strand		ThinLinc Chief Developer
Cendio AB		http://www.cendio.se
Wallenbergs gata 4
583 30 Link?ping	Phone: +46-13-21 46 00

From frank.richter at gmail.com  Wed Apr 23 02:31:12 2008
From: frank.richter at gmail.com (Frank Richter)
Date: Wed, 23 Apr 2008 09:31:12 +0200
Subject: Alex =?ISO-8859-1?Q?Villac=EDs_Lasso_=3A_uxtheme=3A_?=
	=?ISO-8859-1?Q?__Speed_up_UXTHEME=5FSizedBlt_in_the_ST=5FT?=
	=?ISO-8859-1?Q?ILE_by_building_an___appropriately-sized_me?=
	=?ISO-8859-1?Q?mory_bitmap_out_of_the_tile_instead_of__?=
	=?ISO-8859-1?Q?_iterating_with_UXTHEME=5FBlt_=28=29_directly=2E?=
In-Reply-To: <480E6E1E.6090809@palosanto.com>
References: <E1JoGyB-0001fK-TB@wine.codeweavers.com>	<480E2F53.9070401@gmail.com>
	<480E6E1E.6090809@palosanto.com>
Message-ID: <480EE5C0.3030109@gmail.com>

On 23.04.2008 01:00, Alex Villac??s Lasso wrote:
> Have you seen a theme that uses  alpha and breaks with my patch?

It's more of a dim recollection from the time I worked on the theming 
stuff. Mind you, it's a while back now, so assuming I remember right the 
underlying issue might have been fixed already.

-f.r.




From m.b.lankhorst at gmail.com  Wed Apr 23 02:58:44 2008
From: m.b.lankhorst at gmail.com (Maarten Lankhorst)
Date: Wed, 23 Apr 2008 00:58:44 -0700
Subject: Removinig CVS/GIT version from bugzilla
In-Reply-To: <480E84FB.4080700@kievinfo.com>
References: <480DF730.6030006@kievinfo.com> <480E587E.3070209@open-vote.org>
	<b130c85e0804221653i1749fbd5i1633279dc015a805@mail.gmail.com>
	<480E84FB.4080700@kievinfo.com>
Message-ID: <b130c85e0804230058h5b2fb5dcy74b6181fc52b24f8@mail.gmail.com>

Hello Vitaily,

2008/4/22 Vitaliy Margolen <wine-devel at kievinfo.com>:
>
> Maarten Lankhorst wrote:
>  > Hello Scott,
>  >
>  > 2008/4/22 Scott Ritchie <scott at open-vote.org>:
>  >> Vitaliy Margolen wrote:
>  >>  > 3. After the next release, if the bug is still present, modify version to
>  >>  > that release. Of course no modifying of old bugs.
>  >>  >
>  >>
>  >>  Sounds like a simple addition to Alexandre's (scripted?) closing of all
>  >>  fixed bugs on release day.
>  > I don't think that is needed, all that is needed is to rename git to
>  > wine-0.9.XX and and then create a new git tag.
>  >
>  Well that will affect closed bugs - which is not good. However I don't have
>  a strong objection here - whatever works. It would be even better if we can
>  add the version automatically with release scripts.
If it is a true rename operation it will. However this will only occur
once so I think we can live with that. Any bugzilla admins ok with
this way of doing bug reports? It would make the version a whole lot
more accurate in the longer run.

Cheers,
Maarten.


From julliard at winehq.org  Wed Apr 23 03:06:49 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 23 Apr 2008 10:06:49 +0200
Subject: Alex =?utf-8?Q?Villac=C3=ADs?= Lasso : uxtheme:   Speed up
	UXTHEME_SizedBlt in the ST_TILE by building an   appropriately-sized
	memory bitmap out of the tile instead of iterating with UXTHEME_Blt ()
	directly.
In-Reply-To: <480E6E1E.6090809@palosanto.com> ("Alex =?utf-8?B?VmlsbGFj?=
	=?utf-8?B?w63CrXM=?= Lasso"'s message
	of "Tue, 22 Apr 2008 18:00:46 -0500")
References: <E1JoGyB-0001fK-TB@wine.codeweavers.com>
	<480E2F53.9070401@gmail.com> <480E6E1E.6090809@palosanto.com>
Message-ID: <871w4x2dwm.fsf@wine.dyndns.org>

Alex Villac??s Lasso <a_villacis at palosanto.com> writes:

> I directed my themes to the ones on the WinXP partition, and saw no 
> difference after the patch, other than the increase in speed. However, 
> this might not be a proper test case. I used CreateCompatibleDC out of 
> the source HDC, and CreateCompatibleBitmap in the same way. If these 
> operations preserve the alpha channel, and BitBlt(SRCCOPY) does too, the 
> patch as a whole should be correct.

No, BitBlt and friends won't preserve the alpha channel. But that should
be fixed in gdi, not worked around in uxtheme.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Wed Apr 23 03:11:33 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 23 Apr 2008 10:11:33 +0200
Subject: gdi32: Make the bitmap test pass under Windows 2000. Take 2
In-Reply-To: <00cf01c8a4ef$d6fa0e30$a600fea9@DMITRY> (Dmitry Timoshkov's
	message of "Wed, 23 Apr 2008 12:12:16 +0900")
References: <E1JoGj7-0002zO-IP@mail.codeweavers.com>
	<480DCE25.8010107@gmail.com> <008a01c8a487$4ade9320$a600fea9@DMITRY>
	<480DFE41.50906@gmail.com> <018301c8a48b$2c4ad410$a600fea9@DMITRY>
	<480E08A3.3010207@gmail.com> <00cf01c8a4ef$d6fa0e30$a600fea9@DMITRY>
Message-ID: <87wsmp0z4a.fsf@wine.dyndns.org>

"Dmitry Timoshkov" <dmitry at codeweavers.com> writes:

> "Paul Vriens" <paul.vriens.wine at gmail.com> wrote:
>
>> This of course differs on every run. My point is that ERROR_NOT_ENOUGH_MEMORY is 
>> totally valid and should be catered for in the test otherwise we would still 
>> have failures for this test.
>
> I don't think it's a good idea to pollute every test that could fail
> due to insufficient memory with fake error handling.

Obviously you don't want to do that for every test, but if you write a
test that requires 1Gb of memory then you definitely need to check, you
can't assume that this will always work.

-- 
Alexandre Julliard
julliard at winehq.org


From buzzilo at gmail.com  Wed Apr 23 02:44:12 2008
From: buzzilo at gmail.com (Evgeny Burzak)
Date: Wed, 23 Apr 2008 11:44:12 +0400
Subject: winehq.org redesign
In-Reply-To: <200804230006.17192.alex@thehandofagony.com>
References: <20080422023415.48a311e3.buzzilo@gmail.com>
	<200804230006.17192.alex@thehandofagony.com>
Message-ID: <20080423114412.ebd554da.buzzilo@gmail.com>

ok. 
If you have another ideas or comments please write it out on wiki page: http://wiki.winehq.org/WinehqDesign
There i will mirror my work too.

On Wed, 23 Apr 2008 00:06:16 +0200
Alexander Nicolaysen S?rnes <alex at thehandofagony.com> wrote:

> > Hello all,
> > some times ago I make design for AppDB  (http://buzz.ulx.ru/pf/appdb.png).
> > Folks was  delighted with this one, but managers rejected my idea due to
> > needs redesign everything then. But now it may be more actual then ever
> > owing to Wine 1.0 release? I think it may gain attention from professionals
> > who wants to use wine in production environment and improve Wine. I can
> > make design for main pages, xml/xslt template and probably base php5
> > clasess if you decide to change site engine.
> >
> > --
> > Evgeny
> 
> 
> Thanks for the design and for bringing it up again!  It certainly contains a 
> lot of good ideas about how the site can be improved.
> 
> 
> 
> Alexander N. S?rnes


-- 
???????
mailto:buzzilo at gmail.com
http://buzz.ulx.ru
:?


From l_bratch at yahoo.co.uk  Wed Apr 23 03:21:39 2008
From: l_bratch at yahoo.co.uk (Luke Bratch)
Date: Wed, 23 Apr 2008 08:21:39 +0000 (GMT)
Subject: wine-announce and wine-users getting hammered
In-Reply-To: <20080423062920.GA2474@galeere>
Message-ID: <103713.63827.qm@web26003.mail.ukl.yahoo.com>

--- On Wed, 23/4/08, Marcus Meissner <marcus at jet.franken.de> wrote:

> No it is going around, but also stopping...
> 
> I had hundreds of such mails on my private and company
> accounts (and
> lists), but they stopped again.

Indeed, it's completely stopped today.  Sorry for the noise.

Luke


      __________________________________________________________
Sent from Yahoo! Mail.
A Smarter Email http://uk.docs.yahoo.com/nowyoucan.html


From julliard at winehq.org  Wed Apr 23 04:20:25 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 23 Apr 2008 11:20:25 +0200
Subject: WGL: WGL_WINE_pixel_format_passthrough [attempt 2]
In-Reply-To: <20080422211225.182040@gmx.net> (Roderick Colenbrander's message
	of "Tue, 22 Apr 2008 23:12:25 +0200")
References: <20080422211225.182040@gmx.net>
Message-ID: <87prsh0vxi.fsf@wine.dyndns.org>

"Roderick Colenbrander" <thunderbird2k at gmx.net> writes:

> +BOOL X11DRV_wglSetPixelFormatWINE(X11DRV_PDEVICE *physDev, int iPixelFormat, const PIXELFORMATDESCRIPTOR *ppfd)
> +{
> +    TRACE("(%p,%d,%p)\n", physDev, iPixelFormat, ppfd);
> +
> +    /* When the requested pixel format differs from the physDev its pixel format AND
> +     * the physDev has a pixel format set, clear current_pf, so that SetPixelFormat
> +     * will set the pixel format again. */
> +    if((physDev->current_pf != 0) && (physDev->current_pf != iPixelFormat)) {
> +        TRACE("Changing iPixelFormat from %d to %d\n", physDev->current_pf, iPixelFormat);
> +        physDev->current_pf = 0;
> +    }

You shouldn't set the format to 0 first, this will break if changing to
the new format fails for some reason.

-- 
Alexandre Julliard
julliard at winehq.org


From owen at owenrudge.net  Wed Apr 23 05:38:22 2008
From: owen at owenrudge.net (Owen Rudge)
Date: Wed, 23 Apr 2008 11:38:22 +0100
Subject: SOC 2008 Projects Announced
References: <b6bb06270804221436s5dfab6fctbe89047e55b4a8e9@mail.gmail.com>
	<b130c85e0804222114v3b8abc00v965c598d780e5a44@mail.gmail.com>
Message-ID: <091501c8a52e$28cdbe30$842a204e@lan.owenrudge.net>

> Could the students come forward and say something about themself?

Hello all. :-) I already introduced myself a while ago when I was writing my 
proposal, and I'm very pleased to see that it was accepted! I'm a 3rd year 
comp sci student at the University of St Andrews in sunny(!) Scotland. 
Looking forward to getting to work on Wine, although I've got exams and a 
junior honours project to get finished first, alas! I've got various ideas 
floating around my head and have figured out how I think I'm going to start 
tackling the project, so hopefully I'll be all ready to go when exams are 
out of the way.

Cheers,

-- 
Owen Rudge
http://www.owenrudge.net/ 



From reif at earthlink.net  Wed Apr 23 05:38:21 2008
From: reif at earthlink.net (Robert Reif)
Date: Wed, 23 Apr 2008 06:38:21 -0400
Subject: winmm/tests: waveOutGetDevCaps called with invalid size
In-Reply-To: <Pine.LNX.4.64.0804230822450.15637@maggie.lkpg.cendio.se>
References: <Pine.LNX.4.64.0804181102080.23847@maggie.lkpg.cendio.se>
	<4808B145.2010609@earthlink.net>
	<Pine.LNX.4.64.0804211050260.12791@maggie.lkpg.cendio.se>
	<480D12B1.3070309@earthlink.net>
	<Pine.LNX.4.64.0804220842440.29058@maggie.lkpg.cendio.se>
	<480DC438.7010107@earthlink.net>
	<Pine.LNX.4.64.0804230822450.15637@maggie.lkpg.cendio.se>
Message-ID: <480F119D.5050107@earthlink.net>


>> There are only two options:
>> only pass the number of bytes requested or return an error for unreasonable
>> sizes.  What is Terminal Server doing?  
>>     
>
> It's returning an error. 
>
>   
And what is the error?  If you know the error code returned, Ill add it 
to the code so
we can end this discussion.
>> waveOutGetDevCapsW lets the driver do the copy (just like old versions of
>> windows).  The driver should be checking the size and only copying that much.
>> If it doesn't, then it broken.
>>     
>
> Any references for this claim?
>
>   
Read the code.
> You are saying that the driver "should only copy that much", but *what* 
> should it copy? In other words: If the size doesn't match the size of any 
> known structure (WAVEOUTCAPSA/WAVEOUTCAPSW/WAVEOUTCAPS2A/WAVEOUTCAPS2W), 
> should the driver then just *assume* some structure? Which one? As far as 
> I know, there's no guarantee that, for example, the first 
> sizeof(WAVEOUTCAPSW) bytes of WAVEOUTCAPSW are the same as WAVEOUTCAPS2W. 
>
>   
Again, read the code. WAVEOUTCAPS2 is a superset of WAVEOUTCAPS
so it doesn't matter when the length is shorter than WAVEOUTCAPS.  The
drivers only support W so mixing A and W is not an issue.



From dank at kegel.com  Wed Apr 23 05:48:39 2008
From: dank at kegel.com (Dan Kegel)
Date: Wed, 23 Apr 2008 03:48:39 -0700
Subject: What to do about filenames legal in Linux but illegal in Windows?
In-Reply-To: <Pine.LNX.4.62.0804220839250.16602@tvarka.ar.fi.lt>
References: <a71bd89a0804212058k7209bc9cl7ce04fb30cc87e58@mail.gmail.com>
	<Pine.LNX.4.62.0804220839250.16602@tvarka.ar.fi.lt>
Message-ID: <a71bd89a0804230348p1eabbbaahc50cc500fa5dff2b@mail.gmail.com>

On Mon, Apr 21, 2008 at 10:57 PM, Saulius Krasuckas <saulius2 at ar.fi.lt> wrote:
> * On Mon, 21 Apr 2008, Dan Kegel wrote:
>  > (I believe that in both Windows and Wine, directory listings
>  > will show these illegal chars, but attempts to open the files will
>  > fail.)
>
>  For a files that were at least "undeletable" I remember I have been using
>  a feature of Total Commander to switch format of files displayed to a
>  Short/Long form.  Not all files give up for me this way, but half of them
>  did, though.

Yes, I had forgotten about short names because I had been working
on *creating* illegal files, not reading them.
Picasa does in fact work on Windows when presented with *directories*
that have illegal names, and I suspect this is because it uses the
short names and the expands them before display.
(It doesn't seem to work with them on Wine yet; that's on my to-do list to
find out why.)
- Dan


From julliard at winehq.org  Wed Apr 23 06:10:29 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 23 Apr 2008 13:10:29 +0200
Subject: server: return active window if foreground window is set
In-Reply-To: <480F17C1.8030508@yless4u.com.au> (Jeff Latimer's message of
	"Wed, 23 Apr 2008 21:04:33 +1000")
References: <480F17C1.8030508@yless4u.com.au>
Message-ID: <87iqy825ei.fsf@wine.dyndns.org>

Jeff Latimer <lats at yless4u.com.au> writes:

> The comment in the code indicates that the foreground window is active
> window of the active thread.  Seems logical the active window handle
> should be returned at the same time.

No, the active window is per-thread, you can't return the active window
of some other thread.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Wed Apr 23 06:23:52 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 23 Apr 2008 13:23:52 +0200
Subject: [2/2] [try2] user32:mdi.c Fix creating MDI child window according
	with test. [resend]
In-Reply-To: <480DE437.3050709@etersoft.ru> (Anatoly Lyutin's message of "Tue, 
	22 Apr 2008 17:12:23 +0400")
References: <480DE437.3050709@etersoft.ru>
Message-ID: <877ieo24s7.fsf@wine.dyndns.org>

Anatoly Lyutin <vostok at etersoft.ru> writes:

> Uses SWP_NOZORDER according with Dmitry's comment.
>
> Changelog:
>  Fix creating MDI child window according with test.

It doesn't work:

msg.c:3065: Test failed: Create visible MDI child window: the msg sequence is not complete: expected 0000 - actual 0046
msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg 0x0047 was expected, but got msg 0x0046 instead
msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg 0x0005 was expected, but got msg 0x0083 instead
msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg 0x0046 was expected, but got msg 0x0047 instead
msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg 0x0083 was expected, but got msg 0x0047 instead
msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg 0x0047 was expected, but got msg 0x0005 instead
msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg sequence is not complete: expected 0000 - actual 0046
msg.c:3345: Test failed: ShowWindow(SW_MAXIMIZE):invisible maximized MDI child: the msg 0x0047 was expected, but got msg 0x0046 instead
msg.c:3345: Test failed: ShowWindow(SW_MAXIMIZE):invisible maximized MDI child: the msg sequence is not complete: expected 0000 - actual 0083
msg.c:3484: Test failed: Create MDI child window with invisible parent: the msg sequence is not complete: expected 0000 - actual 0046

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Wed Apr 23 06:25:40 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 23 Apr 2008 13:25:40 +0200
Subject: [3/3] user32:mdi.c Fix processing of SW_SHOWMINNOACTIVE according
	with test. [resend]
In-Reply-To: <480DE43A.8060108@etersoft.ru> (Anatoly Lyutin's message of "Tue, 
	22 Apr 2008 17:12:26 +0400")
References: <480DE43A.8060108@etersoft.ru>
Message-ID: <873apc24p7.fsf@wine.dyndns.org>

Anatoly Lyutin <vostok at etersoft.ru> writes:

> Changelog:
>   Fix  processing of SW_SHOWMINNOACTIVE according with test.

No luck here either:

msg.c:4587: Test failed: ShowWindow(SW_SHOWMINNOACTIVE) child with invisible parent: in msg 0x0046 expecting wParam 0x8170 got 0x8150
msg.c:4587: Test failed: ShowWindow(SW_SHOWMINNOACTIVE) child with invisible parent: in msg 0x0047 expecting wParam 0x8178 got 0x8158

-- 
Alexandre Julliard
julliard at winehq.org


From dank at kegel.com  Wed Apr 23 06:43:13 2008
From: dank at kegel.com (Dan Kegel)
Date: Wed, 23 Apr 2008 04:43:13 -0700
Subject: Wine t-shirts?
Message-ID: <a71bd89a0804230443w3240caf7v46108219330713af@mail.gmail.com>

Maarten wrote:
> Why don't we have wine t-shirts any more?

I dunno, where were they before?

I just looked, couldn't find any on cafepress.com.

I'd like to bring back the Codeweavers drunken penguin
t-shirts, perhaps with a slightly more generic Wine
design.
Coincidentally, I found some site on the net had taken
the logo from that shirt and erased the Crossover
logo from the wine bottle; here's a cleaned-up copy:
http://kegel.com/wine/wine-penguin-corkscrew.png


From julliard at winehq.org  Wed Apr 23 06:20:43 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 23 Apr 2008 13:20:43 +0200
Subject: [1/3] user32:msg.c Make two tests clear pass in Win XP SP 2
	[resend]
In-Reply-To: <480DE42D.4090301@etersoft.ru> (Anatoly Lyutin's message of "Tue, 
	22 Apr 2008 17:12:13 +0400")
References: <480DE42D.4090301@etersoft.ru>
Message-ID: <87bq4024xg.fsf@wine.dyndns.org>

Anatoly Lyutin <vostok at etersoft.ru> writes:

> Changelog:
>  Make two tests clear pass.

This breaks the test on Vista and on Wine.

-- 
Alexandre Julliard
julliard at winehq.org


From marcus at jet.franken.de  Wed Apr 23 07:29:16 2008
From: marcus at jet.franken.de (Marcus Meissner)
Date: Wed, 23 Apr 2008 14:29:16 +0200
Subject: Wine t-shirts?
In-Reply-To: <a71bd89a0804230443w3240caf7v46108219330713af@mail.gmail.com>
References: <a71bd89a0804230443w3240caf7v46108219330713af@mail.gmail.com>
Message-ID: <20080423122915.GB5121@galeere>

On Wed, Apr 23, 2008 at 04:43:13AM -0700, Dan Kegel wrote:
> Maarten wrote:
> > Why don't we have wine t-shirts any more?
> 
> I dunno, where were they before?
> 
> I just looked, couldn't find any on cafepress.com.
> 
> I'd like to bring back the Codeweavers drunken penguin
> t-shirts, perhaps with a slightly more generic Wine
> design.
> Coincidentally, I found some site on the net had taken
> the logo from that shirt and erased the Crossover
> logo from the wine bottle; here's a cleaned-up copy:
> http://kegel.com/wine/wine-penguin-corkscrew.png

Only CodeWeavers had tshirts previously as far as I remember...

Ciao, Marcus


From jwhite at winehq.org  Wed Apr 23 07:40:24 2008
From: jwhite at winehq.org (Jeremy White)
Date: Wed, 23 Apr 2008 07:40:24 -0500
Subject: Wine t-shirts?
In-Reply-To: <a71bd89a0804230443w3240caf7v46108219330713af@mail.gmail.com>
References: <a71bd89a0804230443w3240caf7v46108219330713af@mail.gmail.com>
Message-ID: <480F2E38.7010506@winehq.org>

> http://kegel.com/wine/wine-penguin-corkscrew.png

Jon Parshall is proud of his ability to draw those penguins,
and we'd gladly send that artwork to anyone that wanted to make a T-shirt.

Note, though, that we felt we had to (very sadly) drop the penguin; it doesn't
really work for Mac users.

Cheers,

Jeremy


From dank at kegel.com  Wed Apr 23 08:06:34 2008
From: dank at kegel.com (Dan Kegel)
Date: Wed, 23 Apr 2008 06:06:34 -0700
Subject: New winetricks 20080423: added mono19, removed mono1[12], updated xvid
Message-ID: <a71bd89a0804230606g6844a90blebaa7b0713b4f578@mail.gmail.com>

Another day, another Winetricks.  Changes:

r40
Update to latest mono
Remove mono11 and mono12 verbs, replace with mono19
Abort properly on network errors

r39
Updated xvid

As always, get it at
http://kegel.com/wine/winetricks
or
http://code.google.com/p/winezeug


From juan.lang at gmail.com  Wed Apr 23 08:54:53 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Wed, 23 Apr 2008 06:54:53 -0700
Subject: Fix "warning: cast from pointer to integer of different size"
In-Reply-To: <20080423143456.9f1fd022.mle+win@mega-nerd.com>
References: <20080422222441.b042f27b.mle+win@mega-nerd.com>
	<00b501c8a488$296854f0$a600fea9@DMITRY>
	<20080423065322.3938d77c.mle+win@mega-nerd.com>
	<00c301c8a4f8$8ea65810$a600fea9@DMITRY>
	<20080423143456.9f1fd022.mle+win@mega-nerd.com>
Message-ID: <3a768c550804230654j5d320ecaqa7ce642e7d701fb1@mail.gmail.com>

>   3) Add a definition if FIELD_OFFSET wrapped in #ifndef. This is the
>     least ugly option but would cause surprising results if one or
>     the other was changed.

Personally, I think this looks the best.  As far as which is likely to
get accepted.. often you have to try first to find that out ;-)
--Juan


From jnewman at codeweavers.com  Wed Apr 23 10:23:06 2008
From: jnewman at codeweavers.com (Jeremy Newman)
Date: Wed, 23 Apr 2008 10:23:06 -0500
Subject: winehq.org redesign
In-Reply-To: <20080422023415.48a311e3.buzzilo@gmail.com>
References: <20080422023415.48a311e3.buzzilo@gmail.com>
Message-ID: <480F545A.1090904@codeweavers.com>

It looks alright. It's simple, and does not really have much punch to 
it. It looks like a Wikipedia clone.

The logo is the big problem. You have unilaterally decided to replace 
our current official Wine logo with one of your own. If you want to do 
that, you need to submit your logo for review to become the new official 
Wine logo.

IMO, In order to be a good project logo, it needs look good when reduced 
down to 2 colors. I.e., on a black and white letterhead. Your logo, 
being 3D will not fit that simple guideline.

Evgeny Burzak wrote:
> Hello all,
> some times ago I make design for AppDB  (http://buzz.ulx.ru/pf/appdb.png). Folks was  delighted with this one, but managers rejected my idea due to needs redesign everything then. 
> But now it may be more actual then ever owing to Wine 1.0 release? I think it may gain attention from professionals who wants to use wine in production environment and improve Wine.
> I can make design for main pages, xml/xslt template and probably base php5 clasess if you decide to change site engine.
> 


From kwixbit at gmail.com  Wed Apr 23 10:39:19 2008
From: kwixbit at gmail.com (Warren Dumortier)
Date: Wed, 23 Apr 2008 17:39:19 +0200
Subject: Text bug in winecfg!
Message-ID: <f3a003030804230839o67ffde37j79de6a540e9b8174@mail.gmail.com>

Hello everybody!

When i use winecfg in english, text in winecfg looks good but in french and
some other languages it isn't the case, i made a screenshot to show the
(little, little, very little) bug, but i find it annoying!

Here is the little window screenshot:
http://www.host-img.com/files/fkn8csdlmgvd316z22uq.png

Is this a wine bug or not?

Thanks, kind regards
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080423/fbb9ed58/attachment.htm 

From mikolaj at zalewski.pl  Wed Apr 23 10:55:44 2008
From: mikolaj at zalewski.pl (=?UTF-8?B?TWlrb8WCYWogWmFsZXdza2k=?=)
Date: Wed, 23 Apr 2008 17:55:44 +0200
Subject: Text bug in winecfg!
In-Reply-To: <f3a003030804230839o67ffde37j79de6a540e9b8174@mail.gmail.com>
References: <f3a003030804230839o67ffde37j79de6a540e9b8174@mail.gmail.com>
Message-ID: <480F5C00.5020202@zalewski.pl>


> Is this a wine bug or not?
  It is a wine bug - the controls for such languages should be bigger.

Mikolaj Zalewski


From buzzilo at gmail.com  Wed Apr 23 07:28:50 2008
From: buzzilo at gmail.com (Evgeny Burzak)
Date: Wed, 23 Apr 2008 16:28:50 +0400
Subject: winehq.org redesign
In-Reply-To: <f3f1b91a0804221723v411255a2pda668cd191458e5b@mail.gmail.com>
References: <20080422023415.48a311e3.buzzilo@gmail.com>
	<480E5FA4.7080404@open-vote.org>
	<f3f1b91a0804221723v411255a2pda668cd191458e5b@mail.gmail.com>
Message-ID: <20080423162850.db564b7f.buzzilo@gmail.com>

On Tue, 22 Apr 2008 20:23:27 -0400
"Chris Morgan" <chmorgan at gmail.com> wrote:

> We've been throwing around the idea of switching the site to using
> drupal for a while now so we can more easily manage it remotely and
> take advantage of things like polls and news stories.
> 
> I'm sure more can be found but these are the ones that stuck out as
> some of the biggest improvements. We also need to find people
> interested in working on some of these features.
> 
> Chris

Switching to drupal is a great idea i think, but i have no deal with drupal at all.. 
I wonder how to move all content to new site? May be the simplest way is begin from scratch? :)


--
???????


From dank at kegel.com  Wed Apr 23 12:16:38 2008
From: dank at kegel.com (Dan Kegel)
Date: Wed, 23 Apr 2008 10:16:38 -0700
Subject: MSIME support causing slow setup until explorer.exe paused?
In-Reply-To: <a71bd89a0804211359m678d4310sd22910e2816221b9@mail.gmail.com>
References: <a71bd89a0804201349v6f827eb7ke6a7717ea3c7fdda@mail.gmail.com>
	<480C84C1.80003@codeweavers.com>
	<a71bd89a0804211359m678d4310sd22910e2816221b9@mail.gmail.com>
Message-ID: <a71bd89a0804231016k4249c9bbyc0cf27a86cb08392@mail.gmail.com>

On Mon, Apr 21, 2008 at 1:59 PM, Dan Kegel <dank at kegel.com> wrote:
>  >   MSIMEService, MSIMEReconvertOptions, MSIMEMouseOperator, etc... those are
>  > all Messages that Microsoft Office looks for and sends to the IME during
>  > operations.  For the most part all those messages are just stubbed.
>  >
>  >   The messages are Registered in Imm32/imm.c once per process, and also
>  > registered in winex11.drv/ime.c also once per process. I am pretty sure we
>  > do not send those messages somewhere. So I am not sure why they would be
>  > taking up so much cpu time.
>  >
>  >  Do you know what is happening with the messages during the slow-down?
>
>  Oddly, they don't seem to be happening on Dapper.  I'll try again on
>  Gutsy tonight.  (Chris Smith says he saw something like this with
>  iTunes on gentoo today, too.)

Not happening on the original machine anymore, either.  If I catch it acting
up again, I'll get a better log.


From alexd4 at inbox.lv  Wed Apr 23 15:53:21 2008
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Wed, 23 Apr 2008 23:53:21 +0300
Subject: MSIME support causing slow setup until explorer.exe paused?
In-Reply-To: <a71bd89a0804231016k4249c9bbyc0cf27a86cb08392@mail.gmail.com>
References: <a71bd89a0804201349v6f827eb7ke6a7717ea3c7fdda@mail.gmail.com>	<480C84C1.80003@codeweavers.com>	<a71bd89a0804211359m678d4310sd22910e2816221b9@mail.gmail.com>
	<a71bd89a0804231016k4249c9bbyc0cf27a86cb08392@mail.gmail.com>
Message-ID: <480FA1C1.9090505@inbox.lv>

I've just had something similar. Tried running a game (I think it was the first 
time I ran wine in this session), and suddenly system became sluggish. 
wineserver and explorer were sitting at 50+% and 40+% cpu respectively. Even 
after I killed the game. strace -p on explorer was also showing lots of these 
writes.

writev(3, [{"l\0\0\0*\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 
64}, {"M\0S\0I\0M\0E\0R\0e\0c\0o\0n\0v\0e\0r\0t\0R\0e\0"..., 42}], 2) = 106
read(4, "\0\0\0\0\0\0\0\0\3\300\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 64)

and other stuff like that (registry keys). Any specific steps that can be taken 
to narrow it down? This is unfortunately kind of random and not readily 
reproducible, after killing wineserver I don't see this any more.

Dan Kegel wrote:
> On Mon, Apr 21, 2008 at 1:59 PM, Dan Kegel <dank at kegel.com> wrote:
>>  >   MSIMEService, MSIMEReconvertOptions, MSIMEMouseOperator, etc... those are
>>  > all Messages that Microsoft Office looks for and sends to the IME during
>>  > operations.  For the most part all those messages are just stubbed.
>>  >
>>  >   The messages are Registered in Imm32/imm.c once per process, and also
>>  > registered in winex11.drv/ime.c also once per process. I am pretty sure we
>>  > do not send those messages somewhere. So I am not sure why they would be
>>  > taking up so much cpu time.
>>  >
>>  >  Do you know what is happening with the messages during the slow-down?
>>
>>  Oddly, they don't seem to be happening on Dapper.  I'll try again on
>>  Gutsy tonight.  (Chris Smith says he saw something like this with
>>  iTunes on gentoo today, too.)
> 
> Not happening on the original machine anymore, either.  If I catch it acting
> up again, I'll get a better log.


From galt280 at gmail.com  Wed Apr 23 16:07:37 2008
From: galt280 at gmail.com (Gal Topper)
Date: Wed, 23 Apr 2008 17:07:37 -0400
Subject: Fwd: SOC 2008 Projects Announced
In-Reply-To: <163937790804231405l28021041of223aa140a89ff64@mail.gmail.com>
References: <b6bb06270804221436s5dfab6fctbe89047e55b4a8e9@mail.gmail.com>
	<b130c85e0804222114v3b8abc00v965c598d780e5a44@mail.gmail.com>
	<163937790804231405l28021041of223aa140a89ff64@mail.gmail.com>
Message-ID: <163937790804231407s2fa1b2f7sfb82728bf25794e8@mail.gmail.com>

> Could the students come forward and say something about themself?

Hello everyone. My name is Gal Topper and my goal this summer will be
to implement PrintDlgEx* in Wine, so that we'll have support for the
newer and more flexible print dialog that was introduced in Windows
NT. I am a third year computer science student in York University in
Toronto, Canada, and lucky for me, my exams are over! So for now, I
can enjoy both the project and the spring. :)

I'm excited about this project and plan to keep you all up-to-date
when things start moving. :)

Cheers,
Gal


From david at l8s.co.uk  Wed Apr 23 16:09:32 2008
From: david at l8s.co.uk (David Laight)
Date: Wed, 23 Apr 2008 22:09:32 +0100
Subject: Fix "warning: cast from pointer to integer of different size"
In-Reply-To: <00b501c8a488$296854f0$a600fea9@DMITRY>
References: <20080422222441.b042f27b.mle+win@mega-nerd.com>
	<00b501c8a488$296854f0$a600fea9@DMITRY>
Message-ID: <20080423210932.GI29242@snowdrop.l8s.co.uk>

On Tue, Apr 22, 2008 at 11:50:05PM +0900, Dmitry Timoshkov wrote:
> "Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:
> 
> > /* get pointer to object containing list element */
> > #define LIST_ENTRY(elem, type, field) \
> > -    ((type *)((char *)(elem) - (unsigned int)(&((type *)0)->field)))
> > +    ((type *)((char *)(elem) - (unsigned long)(&((type *)0)->field)))

How about:
    ((type *)((char *)(elem) - ((char *)(&((type *)0)->field) - (char *)0)))

	David

-- 
David Laight: david at l8s.co.uk


From felix at compsoc.nuigalway.ie  Wed Apr 23 16:47:03 2008
From: felix at compsoc.nuigalway.ie (Darragh Bailey)
Date: Wed, 23 Apr 2008 22:47:03 +0100
Subject: no test structure in place for wine programs
Message-ID: <20080423214703.GB2678@compsoc.nuigalway.ie>

I'm been looking at bug 9628 (and duplicate 12222) whenever I get the
time to work on wine these days. I've gone through various tests, enough
to determine that msiexec on Windows must use some custom command line
parsing in order for it to work for the cases listed in those bugs given
that the behaviour is replicated by the standard command line API's in
windows.


So I've got to the stage where I believe the correct fix is to put in
some custom handling to make wine's msiexec match the behaviour of
windows version. So far so good. At this point I expect that there
should be some test cases added since this functionality wouldn't appear
frequently enough in most install cases for any future breaks to be
picked up if future changes are made.

So I expect to try and add some test cases, when I notice there is no 
test structure to test any of the exe's built by wine. Bit of a problem
there...

I'm assuming that the original assumption was that the programs just act
as entry points to the dll functionality, so there shouldn't be any need
to add unit tests for the programs. They will either work correctly once
the dll's function, or break really, really noticably.


Next step is the question?

Should I try to take the dll test structure (mainly just the
dlls/Maketest.rules.in file) and port this into the programs area?

or is that overboard for that area?

-- 
Darragh

"Nothing is foolproof to a sufficiently talented fool."


From jacek at codeweavers.com  Wed Apr 23 16:51:03 2008
From: jacek at codeweavers.com (Jacek Caban)
Date: Wed, 23 Apr 2008 23:51:03 +0200
Subject: Add implemantation of property "Name" (IHTMLWindow2)
In-Reply-To: <200804231544.40541.ivan@etersoft.ru>
References: <200804231544.40541.ivan@etersoft.ru>
Message-ID: <480FAF47.2010009@codeweavers.com>

Ivan Sinitsin wrote:
> This patch add implementation of HTMLWindow2_put_name, HTMLWindow2_get_name in 
> module htmlwindow.c (mshtml.dll)
>
> Changelog:
> Add implementation of HTMLWindow2_put_name, HTMLWindow2_get_name
>
>   
 > 

> @@ -289,15 +289,43 @@ static HRESULT WINAPI HTMLWindow2_get_na
>  static HRESULT WINAPI HTMLWindow2_put_name(IHTMLWindow2 *iface, BSTR v)
>  {
>      HTMLWindow *This = HTMLWINDOW2_THIS(iface);
> -    FIXME("(%p)->(%s)\n", This, debugstr_w(v));
> -    return E_NOTIMPL;
> +    nsAString aName;
> +    nsresult nsres;
> +
> +    TRACE("(%p)->(%s)\n", This, debugstr_w(v));
> +
> +    nsAString_Init(&aName, v);
> +    nsres = nsIDOMWindow_SetName(This->nswindow, &aName);
> +    if (NS_FAILED(nsres)) {
> +        TRACE("Failed nsIDOMWindow_SetName %08x \n",nsres);
> +        return nsres;

You shouldn't mix nsresult with HRESULT. Also you leak aName here. SetName should never return failure, so printinf ERR and returning S_OK is fine here.

> +    }
> +    nsAString_Finish(&aName);
> +    return S_OK;
>  }
>  
>  static HRESULT WINAPI HTMLWindow2_get_name(IHTMLWindow2 *iface, BSTR *p)
>  {
>      HTMLWindow *This = HTMLWINDOW2_THIS(iface);
> -    FIXME("(%p)->(%p)\n", This, p);
> -    return E_NOTIMPL;
> +    nsAString aName;
> +    nsresult nsres;
> +    TRACE("(%p)->(%p)\n", This, p);
> +
> +    nsAString_Init(&aName, NULL);
> +    nsres = nsIDOMWindow_GetName(This->nswindow, &aName);
> +    if (NS_FAILED(nsres)) {
> +        TRACE("Failed nsIDOMWindow_GetName %08x \n",nsres);
> +        return nsres;

Same as above.

> +    }
> +
> +    nsres = nsAString_GetData(&aName, p);

You can't do this, p is BSTR and must be allocated with SysAllocString. Look at other functions how to implement it.

> +    if (NS_FAILED(nsres)) {
> +        TRACE("Failed nsAString_GetData %08x \n",nsres);
> +        return nsres;
> +    }
> +    nsAString_Finish(&aName);
> +
> +    return S_OK;
>  }



Jacek



From dank at kegel.com  Wed Apr 23 17:11:00 2008
From: dank at kegel.com (Dan Kegel)
Date: Wed, 23 Apr 2008 15:11:00 -0700
Subject: no test structure in place for wine programs
Message-ID: <a71bd89a0804231511o5942e7aep3824a3f76dfa2b86@mail.gmail.com>

Darren wrote:
> Should I try to take the dll test structure (mainly just the
> dlls/Maketest.rules.in file) and port this into the programs area?
>
> or is that overboard for that area?

It's something we need eventually, but for now it would
probably be enough to just attach a standalone test
that invoked msiexec.exe and printed out PASS or FAIL
to http://bugs.winehq.org/show_bug.cgi?id=9628

It's not worth the effort to create the generic app
test framework inside the wine tree at the moment.


From mle+win at mega-nerd.com  Wed Apr 23 17:34:43 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Thu, 24 Apr 2008 08:34:43 +1000
Subject: Fix "warning: cast from pointer to integer of different size"
In-Reply-To: <20080423210932.GI29242@snowdrop.l8s.co.uk>
References: <20080422222441.b042f27b.mle+win@mega-nerd.com>
	<00b501c8a488$296854f0$a600fea9@DMITRY>
	<20080423210932.GI29242@snowdrop.l8s.co.uk>
Message-ID: <20080424083443.8d6536be.mle+win@mega-nerd.com>

David Laight wrote:

> On Tue, Apr 22, 2008 at 11:50:05PM +0900, Dmitry Timoshkov wrote:
> > "Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:
> > 
> > > /* get pointer to object containing list element */
> > > #define LIST_ENTRY(elem, type, field) \
> > > -    ((type *)((char *)(elem) - (unsigned int)(&((type *)0)->field)))
> > > +    ((type *)((char *)(elem) - (unsigned long)(&((type *)0)->field)))
> 
> How about:
>     ((type *)((char *)(elem) - ((char *)(&((type *)0)->field) - (char *)0)))

Much, much better, thank you. I don't know why I didn't see it myself.

Cheers,
Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
"I saw `cout' being shifted "Hello world" times to the left
and stopped right there." -- Steve Gonedes


From tkho at ucla.edu  Wed Apr 23 18:18:41 2008
From: tkho at ucla.edu (Thomas Kho)
Date: Wed, 23 Apr 2008 16:18:41 -0700
Subject: no test structure in place for wine programs
In-Reply-To: <a71bd89a0804231511o5942e7aep3824a3f76dfa2b86@mail.gmail.com>
References: <a71bd89a0804231511o5942e7aep3824a3f76dfa2b86@mail.gmail.com>
Message-ID: <ad4ecd9f0804231618l10a7055em2024aef8a839096f@mail.gmail.com>

On Wed, Apr 23, 2008 at 3:11 PM, Dan Kegel <dank at kegel.com> wrote:
> Darren wrote:
>  > Should I try to take the dll test structure (mainly just the
>  > dlls/Maketest.rules.in file) and port this into the programs area?
>  >
>  > or is that overboard for that area?
>
>  It's something we need eventually, but for now it would
>  probably be enough to just attach a standalone test
>  that invoked msiexec.exe and printed out PASS or FAIL
>  to http://bugs.winehq.org/show_bug.cgi?id=9628
>
>  It's not worth the effort to create the generic app
>  test framework inside the wine tree at the moment.

For what it's worth, I filed a feature request for something like this
some time ago. At the time, the suggestion was to use cxtest.

See http://bugs.winehq.org/show_bug.cgi?id=5616

-Tom


From winehacker at gmail.com  Wed Apr 23 21:35:39 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Wed, 23 Apr 2008 22:35:39 -0400
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
Message-ID: <19e31a080804231935y36ebc670q34a5d88939afb569@mail.gmail.com>

Hi,
My hope that was for Wine 1.0 we could add error handling for missing
dlls and functions that made sense to the user rather than just silent
failed or spewed messages to the console. If you have an application
that depends on a dll such as OUTLOOK.EXE depending on OUTLIB.DLL you
will get a message like this:

err:module:import_dll Library OUTLLIB.dll (which is needed by
L"Z:\\home\\sedwards\\.wine\\drive_c\\Program Files\\Microsoft
Office\\OFFICE11\\OUTLOOK.EXE") not found
err:module:LdrInitializeThunk Main exe initialization for
L"Z:\\home\\sedwards\\.wine\\drive_c\\Program Files\\Microsoft
Office\\OFFICE11\\OUTLOOK.EXE" failed, status c0000135

So instead how about throwing a nice message box? I started working on
this but don't quite know how to properly pass the information to the
MessageBoxW or maybe fill in the MessageBoxIndirect structure to
display the error in a human readable format. I just don't really
know. Of course once its done this would need to be broken out in to a
helper function, its just a proof of concept....

Anyone want to help?

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-Started-hacking-on-adding-a-MessageBox-error-for-mis.patch
Type: text/x-patch
Size: 1860 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080423/e72ca885/attachment.bin 

From dank at kegel.com  Wed Apr 23 21:51:13 2008
From: dank at kegel.com (Dan Kegel)
Date: Wed, 23 Apr 2008 19:51:13 -0700
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
Message-ID: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>

Hmm, maybe make explorer responsible for putting up the
messagebox, and set up some IPC method (good lord,
not COM, just some mailbox or something) for
the loader to notify it...


From winehacker at gmail.com  Wed Apr 23 22:00:14 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Wed, 23 Apr 2008 23:00:14 -0400
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
Message-ID: <19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>

On Wed, Apr 23, 2008 at 10:51 PM, Dan Kegel <dank at kegel.com> wrote:
> Hmm, maybe make explorer responsible for putting up the
>  messagebox, and set up some IPC method (good lord,
>  not COM, just some mailbox or something) for
>  the loader to notify it...

I thought of that, but your going to end up invoking more crap I
really think you don't need. This is a failure case after all.
Explorer is not running at this point so that means you have to start
it, then you could to send the messages which would be the simplest
form of IPC to it which is going to delay load user32 anyway so it can
display the message box...Its better just to do the equivalent of
LoadLibrary/GetProcAddress in the loader from a helper function and be
done with it.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From dank at kegel.com  Wed Apr 23 22:14:52 2008
From: dank at kegel.com (Dan Kegel)
Date: Wed, 23 Apr 2008 20:14:52 -0700
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
Message-ID: <a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>

On Wed, Apr 23, 2008 at 8:00 PM, Steven Edwards <winehacker at gmail.com> wrote:
>  > Hmm, maybe make explorer responsible for putting up the
>  > messagebox, and set up some IPC method for
>  > the loader to notify it...
>
>  I thought of that, but your going to end up invoking more crap I
>  really think you don't need. This is a failure case after all.
>  Explorer is not running at this point

Why not?   I thought Explorer was the first thing to start up...
- Dan


From dank at kegel.com  Wed Apr 23 22:39:40 2008
From: dank at kegel.com (Dan Kegel)
Date: Wed, 23 Apr 2008 20:39:40 -0700
Subject: xfs getting case-insensitive filesystem support...
Message-ID: <a71bd89a0804232039v49b3e0efmd38a045a0594d346@mail.gmail.com>

Hrm.  This is interesting:
  http://lwn.net/Articles/278961/
I wonder if Wine could run faster if it could delegate
the case-insensitvity to the filesystem...


From winehacker at gmail.com  Wed Apr 23 23:33:35 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Thu, 24 Apr 2008 00:33:35 -0400
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
Message-ID: <19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>

On Wed, Apr 23, 2008 at 11:14 PM, Dan Kegel <dank at kegel.com> wrote:
>  Why not?   I thought Explorer was the first thing to start up...

Your right, I thought it was loaded yet but I guess it does anytime
user32 is initalized. Looking at the process list after the messagebox
exits only wineserver, services and winedevice stay resident for a
while so I thought it had not loaded yet. I'll see if I can rework it
to send a message to explorer to display the dialog.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From winehacker at gmail.com  Wed Apr 23 23:45:56 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Thu, 24 Apr 2008 00:45:56 -0400
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
Message-ID: <19e31a080804232145p796e594t74e6d89dcaf49084@mail.gmail.com>

On Thu, Apr 24, 2008 at 12:33 AM, Steven Edwards <winehacker at gmail.com> wrote:
>  Your right, I thought it was loaded yet but I guess it does anytime
>  user32 is initalized. Looking at the process list after the messagebox
>  exits only wineserver, services and winedevice stay resident for a
>  while so I thought it had not loaded yet. I'll see if I can rework it
>  to send a message to explorer to display the dialog.

You were right. Looking at it a bit more maybe the best route is to
add a set of custom messages to user32 and explorer maybe something
like WM_WINE_DLLNOTFOUND/WM_WINE_MISSINGFUCTION or something and
manually do the server call using send_message. I am not exactly sure
how to do it as the actual wineserver call yet. I'll look at it a bit
more tomorrow and see if I can figure the plumbing out.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From jmayer at loplof.de  Thu Apr 24 00:47:02 2008
From: jmayer at loplof.de (Joerg Mayer)
Date: Thu, 24 Apr 2008 07:47:02 +0200
Subject: xfs getting case-insensitive filesystem support...
In-Reply-To: <a71bd89a0804232039v49b3e0efmd38a045a0594d346@mail.gmail.com>
References: <a71bd89a0804232039v49b3e0efmd38a045a0594d346@mail.gmail.com>
Message-ID: <20080424054702.GK21499@thot.informatik.uni-kl.de>

On Wed, Apr 23, 2008 at 08:39:40PM -0700, Dan Kegel wrote:
> Hrm.  This is interesting:
>   http://lwn.net/Articles/278961/
> I wonder if Wine could run faster if it could delegate
> the case-insensitvity to the filesystem...

Would be nice indeed, but I don't think it will come: Linus shot down
similar patches in the past because to_lower may be easy to implement
for ascii, but once you want to implement it for all charsets supported
by the files system it gets very messy.

 Ciao
     Joerg
-- 
Joerg Mayer                                           <jmayer at loplof.de>
We are stuck with technology when what we really want is just stuff that
works. Some say that should read Microsoft instead of technology.


From dmitry at codeweavers.com  Thu Apr 24 01:05:51 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Thu, 24 Apr 2008 15:05:51 +0900
Subject: xfs getting case-insensitive filesystem support...
References: <a71bd89a0804232039v49b3e0efmd38a045a0594d346@mail.gmail.com>
	<20080424054702.GK21499@thot.informatik.uni-kl.de>
Message-ID: <023801c8a5d1$43ea0fe0$a600fea9@DMITRY>

"Joerg Mayer" <jmayer at loplof.de> wrote:

> On Wed, Apr 23, 2008 at 08:39:40PM -0700, Dan Kegel wrote:
>> Hrm.  This is interesting:
>>   http://lwn.net/Articles/278961/
>> I wonder if Wine could run faster if it could delegate
>> the case-insensitvity to the filesystem...
> 
> Would be nice indeed, but I don't think it will come: Linus shot down
> similar patches in the past because to_lower may be easy to implement
> for ascii, but once you want to implement it for all charsets supported
> by the files system it gets very messy.

Sure, it's messy until the filesystem is unicode internally, and uses
something more reasonable instead of a multibyte UTF-8.

-- 
Dmitry.


From david at l8s.co.uk  Thu Apr 24 01:10:58 2008
From: david at l8s.co.uk (David Laight)
Date: Thu, 24 Apr 2008 07:10:58 +0100
Subject: xfs getting case-insensitive filesystem support...
In-Reply-To: <023801c8a5d1$43ea0fe0$a600fea9@DMITRY>
References: <a71bd89a0804232039v49b3e0efmd38a045a0594d346@mail.gmail.com>
	<20080424054702.GK21499@thot.informatik.uni-kl.de>
	<023801c8a5d1$43ea0fe0$a600fea9@DMITRY>
Message-ID: <20080424061058.GJ29242@snowdrop.l8s.co.uk>

On Thu, Apr 24, 2008 at 03:05:51PM +0900, Dmitry Timoshkov wrote:
> "Joerg Mayer" <jmayer at loplof.de> wrote:
> 
> > On Wed, Apr 23, 2008 at 08:39:40PM -0700, Dan Kegel wrote:
> >> Hrm.  This is interesting:
> >>   http://lwn.net/Articles/278961/
> >> I wonder if Wine could run faster if it could delegate
> >> the case-insensitvity to the filesystem...
> > 
> > Would be nice indeed, but I don't think it will come: Linus shot down
> > similar patches in the past because to_lower may be easy to implement
> > for ascii, but once you want to implement it for all charsets supported
> > by the files system it gets very messy.
> 
> Sure, it's messy until the filesystem is unicode internally, and uses
> something more reasonable instead of a multibyte UTF-8.

Unix filesystems treat filenames as byte-strings, this is 100% reasonable :-)
Any conversion to glygps isn't a filesyatem operation.

	David

-- 
David Laight: david at l8s.co.uk


From bsjeon at hanmail.net  Thu Apr 24 02:13:52 2008
From: bsjeon at hanmail.net (ByeongSik Jeon)
Date: Thu, 24 Apr 2008 16:13:52 +0900
Subject: imm32: If ImmNotifyIME fails, ImmSetOpenStatus should also fail.
In-Reply-To: <200804240356459857070006MAA5@nm06mta.auone-net.jp>
References: <200804240356459857070006MAA5@nm06mta.auone-net.jp>
Message-ID: <1209021232.3705.30.camel@localhost>

Kusanagi Kouichi wrote:
>      if (!fOpen != !data->IMC.fOpen)
>      {
> +        if (!ImmNotifyIME( hIMC, NI_CONTEXTUPDATED, 0, IMC_SETOPENSTATUS))
> +            return FALSE;
>          data->IMC.fOpen = fOpen;
> -        ImmNotifyIME( hIMC, NI_CONTEXTUPDATED, 0, IMC_SETOPENSTATUS);
>          ImmInternalSendIMENotify(data, IMN_SETSENTENCEMODE, 0);
Hi,

MS Windows's native imm32.dll return TRUE although NotifyIME return
FALSE. I have tested it with the DDK's Japanese FakeIME.



From dank at kegel.com  Thu Apr 24 04:18:21 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 24 Apr 2008 02:18:21 -0700
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <19e31a080804232145p796e594t74e6d89dcaf49084@mail.gmail.com>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	<19e31a080804232145p796e594t74e6d89dcaf49084@mail.gmail.com>
Message-ID: <a71bd89a0804240218i41f29607ob37b3c09cb7a7926@mail.gmail.com>

On Wed, Apr 23, 2008 at 9:45 PM, Steven Edwards <winehacker at gmail.com> wrote:
> On Thu, Apr 24, 2008 at 12:33 AM, Steven Edwards <winehacker at gmail.com> wrote:
>  >  Your right, I thought it was loaded yet but I guess it does anytime
>  >  user32 is initalized. Looking at the process list after the messagebox
>  >  exits only wineserver, services and winedevice stay resident for a
>  >  while so I thought it had not loaded yet. I'll see if I can rework it
>  >  to send a message to explorer to display the dialog.
>
>  You were right. Looking at it a bit more maybe the best route is to
>  add a set of custom messages to user32 and explorer maybe something
>  like WM_WINE_DLLNOTFOUND/WM_WINE_MISSINGFUCTION or something and
>  manually do the server call using send_message. I am not exactly sure
>  how to do it as the actual wineserver call yet. I'll look at it a bit
>  more tomorrow and see if I can figure the plumbing out.

Alternately we could cheeze it and exec xmessage :-)


From julliard at winehq.org  Thu Apr 24 04:36:56 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 24 Apr 2008 11:36:56 +0200
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	(Steven Edwards's message of "Thu, 24 Apr 2008 00:33:35 -0400")
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
Message-ID: <87r6cv8uh3.fsf@wine.dyndns.org>

"Steven Edwards" <winehacker at gmail.com> writes:

> On Wed, Apr 23, 2008 at 11:14 PM, Dan Kegel <dank at kegel.com> wrote:
>>  Why not?   I thought Explorer was the first thing to start up...
>
> Your right, I thought it was loaded yet but I guess it does anytime
> user32 is initalized. Looking at the process list after the messagebox
> exits only wineserver, services and winedevice stay resident for a
> while so I thought it had not loaded yet. I'll see if I can rework it
> to send a message to explorer to display the dialog.

You certainly don't want to call through explorer for that, showing a
message box directly is fine. You have to be careful to only do it when
loading the main exe, not for any random dll load; also you have to
properly handle the case of a missing X display.

-- 
Alexandre Julliard
julliard at winehq.org


From dank at kegel.com  Thu Apr 24 04:50:04 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 24 Apr 2008 02:50:04 -0700
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <87r6cv8uh3.fsf@wine.dyndns.org>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	<87r6cv8uh3.fsf@wine.dyndns.org>
Message-ID: <a71bd89a0804240250n285933ebl831c82a30412b66b@mail.gmail.com>

On Thu, Apr 24, 2008 at 2:36 AM, Alexandre Julliard <julliard at winehq.org> wrote:
>  You certainly don't want to call through explorer for that, showing a
>  message box directly is fine.

Well, that's easier :-)

> You have to be careful to only do it when
>  loading the main exe, not for any random dll load

Yeah, I guess some apps tolerate missing DLLs by loading them manually.
We'll miss a few problems (e.g. apps that delay-load but can't handle
the missing dll) but that's ok.

> also you have to properly handle the case of a missing X display

right, and just not call MessageBox.

Hmm, ideally we would send them to a web page that gave
information tailored to the dll in question, but a MessageBox is
good enough for 1.0.


From austinenglish at gmail.com  Thu Apr 24 05:01:30 2008
From: austinenglish at gmail.com (Austin English)
Date: Thu, 24 Apr 2008 05:01:30 -0500
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <a71bd89a0804240250n285933ebl831c82a30412b66b@mail.gmail.com>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	<87r6cv8uh3.fsf@wine.dyndns.org>
	<a71bd89a0804240250n285933ebl831c82a30412b66b@mail.gmail.com>
Message-ID: <b6bb06270804240301te516ee8xebb035f363bd19f7@mail.gmail.com>

On Thu, Apr 24, 2008 at 4:50 AM, Dan Kegel <dank at kegel.com> wrote:

> On Thu, Apr 24, 2008 at 2:36 AM, Alexandre Julliard <julliard at winehq.org>
> wrote:
> >  You certainly don't want to call through explorer for that, showing a
> >  message box directly is fine.
>
> Well, that's easier :-)
>
> > You have to be careful to only do it when
> >  loading the main exe, not for any random dll load
>
> Yeah, I guess some apps tolerate missing DLLs by loading them manually.
> We'll miss a few problems (e.g. apps that delay-load but can't handle
> the missing dll) but that's ok.
>
> > also you have to properly handle the case of a missing X display
>
> right, and just not call MessageBox.
>
> Hmm, ideally we would send them to a web page that gave
> information tailored to the dll in question, but a MessageBox is
> good enough for 1.0.
>
>
> A link to a wiki page (http://wiki.winehq/MissingDLL ?) with list of
common dlls/where they come from/what they do/how to use winetricks/etc.)
would be a bit easier/quicker to implement.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080424/7d9a7453/attachment.htm 

From julliard at winehq.org  Thu Apr 24 05:17:20 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 24 Apr 2008 12:17:20 +0200
Subject: mshtml #5: Added more IDispatchEx tests.
In-Reply-To: <480F4BB9.5040003@codeweavers.com> (Jacek Caban's message of
	"Wed, 23 Apr 2008 16:46:17 +0200")
References: <480F4BB9.5040003@codeweavers.com>
Message-ID: <87iqy78slr.fsf@wine.dyndns.org>

Jacek Caban <jacek at codeweavers.com> writes:

>  dlls/mshtml/tests/dom.c |   56
> +++++++++++++++++++++++++++++++----------------
>  1 files changed, 37 insertions(+), 19 deletions(-)

It doesn't work here:

../../../tools/runtest -q -P wine -M mshtml.dll -T ../../.. -p mshtml_test.exe.so dom.c && touch dom.ok
dom.c:1381: Test failed: GetTypeInfo failed: 8002802b
dom.c:1394: Test failed: GetTypeInfo failed: 8002802b
make[2]: *** [dom.ok] Error 2

-- 
Alexandre Julliard
julliard at winehq.org


From aric at codeweavers.com  Thu Apr 24 08:28:36 2008
From: aric at codeweavers.com (Aric Stewart)
Date: Thu, 24 Apr 2008 08:28:36 -0500
Subject: [3/4] user32: Set the vkey value to VK_PROCESSKEY when IME process
	key.
In-Reply-To: <1209026394.3705.91.camel@localhost>
References: <1209026394.3705.91.camel@localhost>
Message-ID: <48108B04.4080305@codeweavers.com>

Thank you for these investigations This is really nice. I support those 
patches.

I just wanted to also communicate a bit of additional information from 
my investigations just in case someone asks.  I placed hooks on both 
WH_KEYBOARD_LL and WH_KEYBOARD.  Even when the IME is active both of 
those hooks showed the VKEY of the actual keystroke.

This showed me that all of this processing happened after 
process_keyboard_message.

great work and thanks,
-aric


ByeongSik Jeon wrote:
> When the MS Windows set the vkey value(MSG.wParam) to VK_PROCESSKEY?
> 
> I have tested following code:
> ----------------------------
> while ( GetMessage(&msg, 0, 0, 0) ) {
>     if ( msg.message == WM_KEYDOWN )
>         printf("OLD: %x %x %x\n", msg.message, msg.wParam, msg.lParam);
>     TranslateMessage( &msg );
> ?    if ( msg.message == WM_KEYDOWN )
>         printf("NEW: %x %x %x\n", msg.message, msg.wParam, msg.lParam);
>     DispatchMessage( &msg );
> }
> -----------------------------
> The result is:
> -----------------------------
> OLD: 100 e5 130001
> NEW: 100 e5 130001
> OLD: 100 e5 250001
> NEW: 100 e5 250001
> OLD: 100 e5 130001
> NEW: 100 e5 130001
> ?-----------------------------
> e5 is VK_PROCESSKEY.
> Before GetMessage, PeekMessage return, msg.wPram ahs seted to VK_PROCESSKEY.
> 
> ---
>  dlls/user32/message.c |    9 +++++++--
>  1 files changed, 7 insertions(+), 2 deletions(-)
> 
> 
> ------------------------------------------------------------------------
> 
> 


From hverbeet at gmail.com  Thu Apr 24 09:06:01 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Thu, 24 Apr 2008 16:06:01 +0200
Subject: [1/7] D3D9: Make the offscreen format test a bit more tolerant
In-Reply-To: <200804241451.31685.stefan@codeweavers.com>
References: <200804241451.31685.stefan@codeweavers.com>
Message-ID: <d658b69e0804240706t664706f2s4e6d6febb0ba6d45@mail.gmail.com>

2008/4/24 Stefan D?singer <stefan at codeweavers.com>:
>
FWIW, for my texop test I wrote a function to do this in a generic
way. I'll probably submit that in the next few days.


From frick at sc-networks.de  Thu Apr 24 09:20:38 2008
From: frick at sc-networks.de (Christoph Frick)
Date: Thu, 24 Apr 2008 16:20:38 +0200
Subject: dinput: Limit number of supported axis and buttons
In-Reply-To: <481093CF.20805@kievinfo.com>
References: <481093CF.20805@kievinfo.com>
Message-ID: <20080424142033.GV5348@byleth.sc-networks.de>

On Thu, Apr 24, 2008 at 08:06:07AM -0600, Vitaliy Margolen wrote:

> +        FIXME("Can't support %d axis. Clamping down to 16\n", newDevice->axes);
           FIXME("Can't support %d axes. Clamping down to 16\n", newDevice->axes);

-- 
cu
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 163 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080424/c290199a/attachment.pgp 

From jacek at codeweavers.com  Thu Apr 24 09:25:20 2008
From: jacek at codeweavers.com (Jacek Caban)
Date: Thu, 24 Apr 2008 16:25:20 +0200
Subject: mshtml #5: Added more IDispatchEx tests.
In-Reply-To: <87iqy78slr.fsf@wine.dyndns.org>
References: <480F4BB9.5040003@codeweavers.com> <87iqy78slr.fsf@wine.dyndns.org>
Message-ID: <48109850.1090803@codeweavers.com>

Alexandre Julliard wrote:
> Jacek Caban <jacek at codeweavers.com> writes:
>
>   
>>  dlls/mshtml/tests/dom.c |   56
>> +++++++++++++++++++++++++++++++----------------
>>  1 files changed, 37 insertions(+), 19 deletions(-)
>>     
>
> It doesn't work here:
>
> ../../../tools/runtest -q -P wine -M mshtml.dll -T ../../.. -p mshtml_test.exe.so dom.c && touch dom.ok
> dom.c:1381: Test failed: GetTypeInfo failed: 8002802b
> dom.c:1394: Test failed: GetTypeInfo failed: 8002802b
> make[2]: *** [dom.ok] Error 2
>
>   

mshtml.tlb needs to be rebuilt after "mshtml.idl: Added 
DispHTMLUnknownElement declaration." patch. make depend is not enough.

Thanks,
    Jacek


From astrand at cendio.se  Thu Apr 24 09:41:37 2008
From: astrand at cendio.se (=?UTF-8?Q?Peter_=C3=85strand?=)
Date: Thu, 24 Apr 2008 16:41:37 +0200 (CEST)
Subject: winmm/tests: waveOutGetDevCaps called with invalid size
In-Reply-To: <480F119D.5050107@earthlink.net>
References: <Pine.LNX.4.64.0804181102080.23847@maggie.lkpg.cendio.se>
	<4808B145.2010609@earthlink.net>
	<Pine.LNX.4.64.0804211050260.12791@maggie.lkpg.cendio.se>
	<480D12B1.3070309@earthlink.net>
	<Pine.LNX.4.64.0804220842440.29058@maggie.lkpg.cendio.se>
	<480DC438.7010107@earthlink.net>
	<Pine.LNX.4.64.0804230822450.15637@maggie.lkpg.cendio.se>
	<480F119D.5050107@earthlink.net>
Message-ID: <Pine.LNX.4.64.0804232120070.26015@maggie.lkpg.cendio.se>


> > > There are only two options: only pass the number of bytes requested 
> > > or return an error for unreasonable sizes.  What is Terminal Server 
> > > doing?
> >
> > It's returning an error. 
> >   
> And what is the error?  If you know the error code returned, Ill add it 
> to the code so we can end this discussion.

The error is MMSYSERR_INVALPARAM. 

Sure, you can add the error code to the list of accepted return code, but 
I still don't understand the meaning of this test. You are basically 
testing the sound card driver, rather than the winmm subsystem. 


> > > waveOutGetDevCapsW lets the driver do the copy (just like old versions of
> > > windows).  The driver should be checking the size and only copying that
> > > much.
> > > If it doesn't, then it broken.
> >
> > Any references for this claim?
> >   
> Read the code.

Since we are trying to follow MS, reading the Wine code doesn't really 
give us a hint of what MS considers valid or invalid. 


> > You are saying that the driver "should only copy that much", but *what*
> > should it copy? In other words: If the size doesn't match the size of any
> > known structure (WAVEOUTCAPSA/WAVEOUTCAPSW/WAVEOUTCAPS2A/WAVEOUTCAPS2W),
> > should the driver then just *assume* some structure? Which one? As far as I
> > know, there's no guarantee that, for example, the first sizeof(WAVEOUTCAPSW)
> > bytes of WAVEOUTCAPSW are the same as WAVEOUTCAPS2W. 
> >
> >   
> Again, read the code. WAVEOUTCAPS2 is a superset of WAVEOUTCAPS
> so it doesn't matter when the length is shorter than WAVEOUTCAPS.  The
> drivers only support W so mixing A and W is not an issue.

Are you saying that WODM_GETDEVCAPS messages are always limited to the "W" 
versions? So, drivers don't need to handle WODM_GETDEVCAPS messages with 
"A" type structs? I had no idea of that. Any reference for this? 
 

Rgds, 
---
Peter ?strand		ThinLinc Chief Developer
Cendio AB		http://www.cendio.se
Wallenbergs gata 4
583 30 Link?ping	Phone: +46-13-21 46 00

From julliard at winehq.org  Thu Apr 24 09:42:03 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 24 Apr 2008 16:42:03 +0200
Subject: mshtml #5: Added more IDispatchEx tests.
In-Reply-To: <48109850.1090803@codeweavers.com> (Jacek Caban's message of
	"Thu, 24 Apr 2008 16:25:20 +0200")
References: <480F4BB9.5040003@codeweavers.com>
	<87iqy78slr.fsf@wine.dyndns.org> <48109850.1090803@codeweavers.com>
Message-ID: <8763u78gck.fsf@wine.dyndns.org>

Jacek Caban <jacek at codeweavers.com> writes:

> mshtml.tlb needs to be rebuilt after "mshtml.idl: Added
> DispHTMLUnknownElement declaration." patch. make depend is not enough.

I see, make depend needs to be fixed. I'll have a look.

-- 
Alexandre Julliard
julliard at winehq.org


From winehacker at gmail.com  Thu Apr 24 09:55:53 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Thu, 24 Apr 2008 10:55:53 -0400
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <87r6cv8uh3.fsf@wine.dyndns.org>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	<87r6cv8uh3.fsf@wine.dyndns.org>
Message-ID: <19e31a080804240755o51963e61xebe17b174382fb88@mail.gmail.com>

On Thu, Apr 24, 2008 at 5:36 AM, Alexandre Julliard <julliard at winehq.org> wrote:
>  You certainly don't want to call through explorer for that, showing a
>  message box directly is fine. You have to be careful to only do it when
>  loading the main exe, not for any random dll load; also you have to
>  properly handle the case of a missing X display.

OK so is doing this in ntdll even the right case? I don't really see
where to do it only from the main exe. I understand we don't want to
report the error if the application is manually doing a
GetProcAddress/LoadLibrary but again don't really know how to limit
it. Here is my stab #2, it actually returns something sane to the
user.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-Took-a-stab-at-graphically-reporting-an-error-when-a.patch
Type: text/x-patch
Size: 2212 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080424/ce0f53f2/attachment.bin 

From wine-devel at kievinfo.com  Thu Apr 24 10:04:56 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Thu, 24 Apr 2008 09:04:56 -0600
Subject: dinput: Limit number of supported axis and buttons
In-Reply-To: <20080424142033.GV5348@byleth.sc-networks.de>
References: <481093CF.20805@kievinfo.com>
	<20080424142033.GV5348@byleth.sc-networks.de>
Message-ID: <4810A198.1010807@kievinfo.com>

Christoph Frick wrote:
> On Thu, Apr 24, 2008 at 08:06:07AM -0600, Vitaliy Margolen wrote:
> 
>> +        FIXME("Can't support %d axis. Clamping down to 16\n", newDevice->axes);
>            FIXME("Can't support %d axes. Clamping down to 16\n", newDevice->axes);
> 

Thanks for catching it. Fixed patch resent.

Vitaliy


From julliard at winehq.org  Thu Apr 24 10:12:46 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 24 Apr 2008 17:12:46 +0200
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <19e31a080804240755o51963e61xebe17b174382fb88@mail.gmail.com>
	(Steven Edwards's message of "Thu, 24 Apr 2008 10:55:53 -0400")
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	<87r6cv8uh3.fsf@wine.dyndns.org>
	<19e31a080804240755o51963e61xebe17b174382fb88@mail.gmail.com>
Message-ID: <871w4v8exd.fsf@wine.dyndns.org>

"Steven Edwards" <winehacker at gmail.com> writes:

> On Thu, Apr 24, 2008 at 5:36 AM, Alexandre Julliard <julliard at winehq.org> wrote:
>>  You certainly don't want to call through explorer for that, showing a
>>  message box directly is fine. You have to be careful to only do it when
>>  loading the main exe, not for any random dll load; also you have to
>>  properly handle the case of a missing X display.
>
> OK so is doing this in ntdll even the right case? I don't really see
> where to do it only from the main exe.

It depends which cases you are trying to catch, but for the case of
users starting an app from their desktop, you could probably do it in
start.exe.

-- 
Alexandre Julliard
julliard at winehq.org


From razielmine at gmail.com  Thu Apr 24 11:57:29 2008
From: razielmine at gmail.com (RazZziel)
Date: Thu, 24 Apr 2008 19:57:29 +0300
Subject: SOC 2008 Projects Announced
In-Reply-To: <b130c85e0804222114v3b8abc00v965c598d780e5a44@mail.gmail.com>
References: <b6bb06270804221436s5dfab6fctbe89047e55b4a8e9@mail.gmail.com>
	<b130c85e0804222114v3b8abc00v965c598d780e5a44@mail.gmail.com>
Message-ID: <82e274890804240957n351820b7g89613cc784a75fc0@mail.gmail.com>

>  Could the students come forward and say something about themself?

Hi there

I'm from Spain and I'm supposed to hack DirectPlay support up until
wine can fully run at least GTA2 multiplayer out of the box, but I
hope to have time enough to give some love to other dplay games. I'll
try not to have too much fun in the testing phases, I promise :)

I still have to get some exams done before embracing the sleepless
nights of passionate coding (and/or swearing against msdn), but things
are going faster than expected and I hopefully will be free of urgent
duties in two or three weeks.

Hope not to break anything
Over and out
   Ismael


From frick at sc-networks.de  Thu Apr 24 13:31:21 2008
From: frick at sc-networks.de (Christoph Frick)
Date: Thu, 24 Apr 2008 20:31:21 +0200
Subject: dinput: Limit number of supported axis and buttons [try 2]
In-Reply-To: <4810A16B.3000003@kievinfo.com>
References: <4810A16B.3000003@kievinfo.com>
Message-ID: <20080424183121.GY5348@byleth.sc-networks.de>

On Thu, Apr 24, 2008 at 09:04:11AM -0600, Vitaliy Margolen wrote:

ok, don't beat me on this one (i guess i could have asked this also for
try one):

> +        FIXME("Can't support %d axes. Clamping down to 16\n", newDevice->axes);
> ...
> +        WARN("Can't support %d buttons. Clamping down to 128\n", newDevice->buttons);

why is axes a FIXME and buttons a WARN?

-- 
cu
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 163 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080424/c4b8df0e/attachment.pgp 

From eric.pouech at orange.fr  Thu Apr 24 15:10:36 2008
From: eric.pouech at orange.fr (Eric Pouech)
Date: Thu, 24 Apr 2008 22:10:36 +0200
Subject: Call for testers
Message-ID: <4810E93C.1010702@orange.fr>

Has you may have seen, a new rendering interface is now available for 
Winhelp
It should be better (with the last row of patches) than the old one, but 
still not perfect
And likely not bug free, hence the call for testers

I'm waiting for some real feedback from real users about reading your 
old .hlp files
The new rendering is turned on by setting the env variable 
WINHELP_RICHEDIT to 1

A+

-- 
Eric Pouech
"The problem with designing something completely foolproof is to underestimate the ingenuity of a complete idiot." (Douglas Adams)




From julliard at winehq.org  Thu Apr 24 15:43:40 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 24 Apr 2008 22:43:40 +0200
Subject: [PATCH 06/12] widl: Create a statement object for import
	statements.
In-Reply-To: <4810CC40.5000101@codeweavers.com> (Robert Shearman's message of
	"Thu, 24 Apr 2008 19:06:56 +0100")
References: <4810CC40.5000101@codeweavers.com>
Message-ID: <87wsmn6l1f.fsf@wine.dyndns.org>

Robert Shearman <rob at codeweavers.com> writes:

> Move the writing of include directives into the generated header into
> header.c.

This one doesn't work right, it doesn't output the #include statements
so the resulting .h files don't compile.

-- 
Alexandre Julliard
julliard at winehq.org


From mle+win at mega-nerd.com  Thu Apr 24 19:47:30 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Fri, 25 Apr 2008 10:47:30 +1000
Subject: dnghelp : Fix pointer cast.
In-Reply-To: <20080425103603.830aff9a.mle+win@mega-nerd.com>
References: <20080425103603.830aff9a.mle+win@mega-nerd.com>
Message-ID: <20080425104730.0ada0bfd.mle+win@mega-nerd.com>

Erik de Castro Lopo wrote:

> 
> Make the pointer cast safe for Wine64.

Please disregard this one as there is a better patch on the
way.

Cheers,
Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
"Within C++, there is a much smaller and cleaner language struggling
to get out." -- Bjarne Stroustrup


From wine-devel at kievinfo.com  Thu Apr 24 20:52:27 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Thu, 24 Apr 2008 19:52:27 -0600
Subject: dinput: Limit number of supported axis and buttons [try 2]
In-Reply-To: <20080424183121.GY5348@byleth.sc-networks.de>
References: <4810A16B.3000003@kievinfo.com>
	<20080424183121.GY5348@byleth.sc-networks.de>
Message-ID: <4811395B.9030905@kievinfo.com>

Christoph Frick wrote:
> On Thu, Apr 24, 2008 at 09:04:11AM -0600, Vitaliy Margolen wrote:
> 
> ok, don't beat me on this one (i guess i could have asked this also for
> try one):
> 
>> +        FIXME("Can't support %d axes. Clamping down to 16\n", newDevice->axes);
>> ...
>> +        WARN("Can't support %d buttons. Clamping down to 128\n", newDevice->buttons);
> 
> why is axes a FIXME and buttons a WARN?
> 
Because default joystick data format supports up to 128 buttons. So even if 
Wine would be using custom data format most programs probably won't be able 
to use all of the buttons.

At the same time there are number of extra axes left in the data format that 
Wine is not using.

So in short - there is something that can be done to support more axes but 
not much about buttons.

PS. I'd like to see a "joystick" with more then 128 buttons...

Vitaliy.


From tehblunderbuss at gmail.com  Thu Apr 24 22:01:41 2008
From: tehblunderbuss at gmail.com (TheBlunderbuss)
Date: Thu, 24 Apr 2008 22:01:41 -0500
Subject: Safedisc for 1.0+ ?
Message-ID: <48114995.3010703@gmail.com>

An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080424/3e854a30/attachment.htm 

From jjmckenzie51 at sprintpcs.com  Thu Apr 24 22:17:19 2008
From: jjmckenzie51 at sprintpcs.com (James McKenzie)
Date: Thu, 24 Apr 2008 20:17:19 -0700
Subject: Wine t-shirts?
In-Reply-To: <480F2E38.7010506@winehq.org>
References: <a71bd89a0804230443w3240caf7v46108219330713af@mail.gmail.com>
	<480F2E38.7010506@winehq.org>
Message-ID: <48114D3F.2080408@sprintpcs.com>

Jeremy White wrote:
>> http://kegel.com/wine/wine-penguin-corkscrew.png
>>     
>
> Jon Parshall is proud of his ability to draw those penguins,
> and we'd gladly send that artwork to anyone that wanted to make a T-shirt.
>
> Note, though, that we felt we had to (very sadly) drop the penguin; it doesn't
> really work for Mac users.
>
>   
Why not?  There is always Yellow Dog and several Linux variants for the 
Mac.....

And I'm always for support the 'quin and have been before Slack 1.0 
(yes, I'm older than dirt and proud of it!)

(And I remember Wine, a long, long time ago in a galaxy far, far away 
(think Far East))

At one time I was a supporter and tester for Project Odin and its 
predecessors.

James McKenzie



From wine-devel at kievinfo.com  Thu Apr 24 22:57:39 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Thu, 24 Apr 2008 21:57:39 -0600
Subject: Safedisc for 1.0+ ?
In-Reply-To: <48114995.3010703@gmail.com>
References: <48114995.3010703@gmail.com>
Message-ID: <481156B3.5060802@kievinfo.com>

TheBlunderbuss wrote:
>     It has just occurred to me that safedisc copy protection (bug 219!) 
> wasn't put on the Wine 1.0 task list. It's a pretty major bug and covers 
> a wide range of programs, with a wide range of safedisc versions.
> Considering this, how should we plan for this implementation?
> 
Some versions should work. Newer versions mos likely won't. But as usual in 
these cases your mileage may vary. Since there are so many variables.

Setting target for such bugs to 1.0 won't magically fix them. Nor will it 
keep them from breaking.

Vitaliy.


From dmitry at codeweavers.com  Thu Apr 24 22:38:10 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 25 Apr 2008 12:38:10 +0900
Subject: user32 : Temporarily disable test for _WIN64.
References: <20080425102920.05581ba3.mle+win@mega-nerd.com>
Message-ID: <01ae01c8a68a$b60cf7e0$a600fea9@DMITRY>

"Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:

> The file dlls/user32/tests/edit.c currently doesn't compile when
> configured with --enable-win64 because GWL_WNDPROC (in include/winuser.h)
> is not defined when _WIN64 is defined.

Then you need to fix the test instead of disabling it.

-- 
Dmitry.


From dmitry at codeweavers.com  Thu Apr 24 22:44:14 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 25 Apr 2008 12:44:14 +0900
Subject: shel32/tests : Use LOWORD to extract rc from pointer.
References: <20080425124410.cf2f58ef.mle+win@mega-nerd.com>
Message-ID: <01af01c8a68a$bb245fc0$a600fea9@DMITRY>

"Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:

> -    rc=(int)ShellExecute(NULL, operation, file, parameters, directory,
> -                         SW_SHOWNORMAL);
> +    rc=LOWORD(ShellExecute(NULL, operation, file, parameters, directory,
> +                         SW_SHOWNORMAL));
>  
>      if (rc > 32)
>      {
> @@ -167,7 +167,7 @@ static int shell_execute_ex(DWORD mask, LPCSTR operation, LPCSTR file,
>      DeleteFile(child_file);
>      SetLastError(0xcafebabe);
>      success=ShellExecuteEx(&sei);
> -    rc=(int)sei.hInstApp;
> +    rc=LOWORD(sei.hInstApp);
>      ok((success && rc > 32) || (!success && rc <= 32),
>         "%s rc=%d and hInstApp=%d is not allowed\n", shell_call, success, rc);
>  
> @@ -836,24 +836,24 @@ static void test_find_executable(void)
>      /* Don't test FindExecutable(..., NULL), it always crashes */
>  
>      strcpy(command, "your word");
> -    rc=(int)FindExecutableA(NULL, NULL, command);
> +    rc=LOWORD(FindExecutableA(NULL, NULL, command));
>      ok(rc == SE_ERR_FNF || rc > 32 /* nt4 */, "FindExecutable(NULL) returned %d\n", rc);

You need to change the type of rc to HINSTANCE and fix the comparisons instead.
What happens if the returned HINSTANCE has a value <= 32 in its low word?

-- 
Dmitry.


From mle+win at mega-nerd.com  Thu Apr 24 23:26:37 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Fri, 25 Apr 2008 14:26:37 +1000
Subject: user32 : Temporarily disable test for _WIN64.
In-Reply-To: <01ae01c8a68a$b60cf7e0$a600fea9@DMITRY>
References: <20080425102920.05581ba3.mle+win@mega-nerd.com>
	<01ae01c8a68a$b60cf7e0$a600fea9@DMITRY>
Message-ID: <20080425142637.2476970f.mle+win@mega-nerd.com>

Dmitry Timoshkov wrote:

> "Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:
> 
> > The file dlls/user32/tests/edit.c currently doesn't compile when
> > configured with --enable-win64 because GWL_WNDPROC (in include/winuser.h)
> > is not defined when _WIN64 is defined.
> 
> Then you need to fix the test instead of disabling it.

In include/winuser.h we have:

    #if !defined _WIN64 && !defined __WINESRC__
    # define GWL_USERDATA        (-21)
    # define GWL_ID              (-12)
    # define GWL_HWNDPARENT      (-8)
    # define GWL_HINSTANCE       (-6)
    # define GWL_WNDPROC         (-4)
    # define DWL_MSGRESULT       0
    # define DWL_DLGPROC         4
    # define DWL_USER            8
    #endif /* _WIN64 && __WINESRC__ */

which means fixing the test requires first finding out the correct
values of these defines under _WIN64. That seems a waste of effort
when I'm aiming to get the simplest of WIN64 apps running, like
a "Hello world" program that prints to stdout.

Secondly, being unable to compile wine configured with --enable-win64
because of a test for code that has zero percent chance of being
correct anyway seems counter productive.

Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
Seen on comp.lang.python:
Q : If someone has the code in python for a buffer overflow,
    please post it.
A : Python does not support buffer overflows, sorry.


From dmitry at codeweavers.com  Thu Apr 24 23:34:10 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 25 Apr 2008 13:34:10 +0900
Subject: Add an include/config.h variable WINE_IS_WIN64 which is 1
	whenconfigured with --enable-win64 and 0 otherwise.
References: <20080425135107.46b65abd.mle+win@mega-nerd.com>
Message-ID: <01fb01c8a68e$1f6f8bf0$a600fea9@DMITRY>

"Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:

> Add an include/config.h variable WINE_IS_WIN64 which is 1 whenconfigured with --enable-win64 and 0 otherwise.

It would be helpful to at least provide an explanation why yo need
this, and why _WIN64 macro is not enough.

-- 
Dmitry.


From dmitry at codeweavers.com  Thu Apr 24 23:36:47 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 25 Apr 2008 13:36:47 +0900
Subject: ntdll : Do not error out on AMD-64 architecture when compiling
	win64.
References: <20080425135611.bc5ecc82.mle+win@mega-nerd.com>
Message-ID: <01fe01c8a68e$2491a230$a600fea9@DMITRY>

"Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:

> +#if WINE_IS_WIN64
> +    if (nt->FileHeader.Machine == IMAGE_FILE_MACHINE_AMD64)
> +        MESSAGE("Support for AMD-64 architecture in progress but not yet working\n");
> +    else
> +#endif

What's the point of this?

-- 
Dmitry.


From dank at kegel.com  Thu Apr 24 23:39:36 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 24 Apr 2008 21:39:36 -0700
Subject: Wine t-shirts?
In-Reply-To: <48114D3F.2080408@sprintpcs.com>
References: <a71bd89a0804230443w3240caf7v46108219330713af@mail.gmail.com>
	<480F2E38.7010506@winehq.org> <48114D3F.2080408@sprintpcs.com>
Message-ID: <a71bd89a0804242139seb68edfxd9620e995acf18c8@mail.gmail.com>

James McKenzie <jjmckenzie51 at sprintpcs.com> wrote:
>  At one time I was a supporter and tester for Project Odin and its
> predecessors.

Wow.

I gave up on OS/2 Warp right from the git-go,
when they shipped me 30 floppies instead of a cd-rom.
I really wanted Microsoft to have competition, but
I just couldn't bear the thought of going through a
30 floppy install!
- Dan


From mle+win at mega-nerd.com  Thu Apr 24 23:43:37 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Fri, 25 Apr 2008 14:43:37 +1000
Subject: ntdll : Do not error out on AMD-64 architecture when compiling
	win64.
In-Reply-To: <01fe01c8a68e$2491a230$a600fea9@DMITRY>
References: <20080425135611.bc5ecc82.mle+win@mega-nerd.com>
	<01fe01c8a68e$2491a230$a600fea9@DMITRY>
Message-ID: <20080425144337.ace28a4e.mle+win@mega-nerd.com>

Dmitry Timoshkov wrote:

> "Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:
> 
> > +#if WINE_IS_WIN64
> > +    if (nt->FileHeader.Machine == IMAGE_FILE_MACHINE_AMD64)
> > +        MESSAGE("Support for AMD-64 architecture in progress but not yet working\n");
> > +    else
> > +#endif
> 
> What's the point of this?

At the moment trying to get wine to execute a win64 binary fails
if

    nt->FileHeader.Machine != IMAGE_FILE_MACHINE_I386

This patch along with the last one which added WINE_IS_WIN64 allows
an attempt to be made to execute a WIN64 binary.

Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
C++: The power, elegance and simplicity of a hand grenade.


From dmitry at codeweavers.com  Thu Apr 24 23:44:19 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 25 Apr 2008 13:44:19 +0900
Subject: user32 : Temporarily disable test for _WIN64.
References: <20080425102920.05581ba3.mle+win@mega-nerd.com><01ae01c8a68a$b60cf7e0$a600fea9@DMITRY>
	<20080425142637.2476970f.mle+win@mega-nerd.com>
Message-ID: <022301c8a68f$37ffbc20$a600fea9@DMITRY>

"Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:

> In include/winuser.h we have:
> 
>    #if !defined _WIN64 && !defined __WINESRC__
>    # define GWL_USERDATA        (-21)
>    # define GWL_ID              (-12)
>    # define GWL_HWNDPARENT      (-8)
>    # define GWL_HINSTANCE       (-6)
>    # define GWL_WNDPROC         (-4)
>    # define DWL_MSGRESULT       0
>    # define DWL_DLGPROC         4
>    # define DWL_USER            8
>    #endif /* _WIN64 && __WINESRC__ */
> 
> which means fixing the test requires first finding out the correct
> values of these defines under _WIN64.

winuser.h already has the correct values for _WIN64.

> That seems a waste of effort
> when I'm aiming to get the simplest of WIN64 apps running, like
> a "Hello world" program that prints to stdout.

I assume that you have all other problems sorted out? (compiler support,
TLS layout, calling conventions, other ABI incompatibilities).

> Secondly, being unable to compile wine configured with --enable-win64
> because of a test for code that has zero percent chance of being
> correct anyway seems counter productive.

It's counter productive to start fighting without investigating the subject
first.

-- 
Dmitry.


From mle+win at mega-nerd.com  Thu Apr 24 23:48:09 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Fri, 25 Apr 2008 14:48:09 +1000
Subject: Add an include/config.h variable WINE_IS_WIN64 which is 1
	whenconfigured with --enable-win64 and 0 otherwise.
In-Reply-To: <01fb01c8a68e$1f6f8bf0$a600fea9@DMITRY>
References: <20080425135107.46b65abd.mle+win@mega-nerd.com>
	<01fb01c8a68e$1f6f8bf0$a600fea9@DMITRY>
Message-ID: <20080425144809.b8406129.mle+win@mega-nerd.com>

Dmitry Timoshkov wrote:

> "Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:
> 
> > Add an include/config.h variable WINE_IS_WIN64 which is 1 when
> > configured with --enable-win64 and 0 otherwise.
> 
> It would be helpful to at least provide an explanation why yo need
> this, and why _WIN64 macro is not enough.

You are right, _WIN64 is sufficient.

Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
A good debugger is no substitute for a good test suite.


From dank at kegel.com  Thu Apr 24 23:50:10 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 24 Apr 2008 21:50:10 -0700
Subject: "make test" - only four tests failing!
Message-ID: <a71bd89a0804242150y47d17e49k5d967db356400042@mail.gmail.com>

"make test" is pretty darn close to passing;
only four tests left to fix.  (Oddly, different
sets fail depending on display mode.)
Details at the end of
http://bugs.winehq.org/show_bug.cgi?id=9916

Let's get these fixed before code freeze!


From truiken at gmail.com  Thu Apr 24 23:55:21 2008
From: truiken at gmail.com (James Hawkins)
Date: Thu, 24 Apr 2008 23:55:21 -0500
Subject: "make test" - only four tests failing!
In-Reply-To: <a71bd89a0804242150y47d17e49k5d967db356400042@mail.gmail.com>
References: <a71bd89a0804242150y47d17e49k5d967db356400042@mail.gmail.com>
Message-ID: <22821af30804242155x6e87762biee7dfd599dec6dc@mail.gmail.com>

On Thu, Apr 24, 2008 at 11:50 PM, Dan Kegel <dank at kegel.com> wrote:
> "make test" is pretty darn close to passing;
>  only four tests left to fix.  (Oddly, different
>  sets fail depending on display mode.)
>  Details at the end of
>  http://bugs.winehq.org/show_bug.cgi?id=9916
>
>  Let's get these fixed before code freeze!
>

Yours is one of the lucky machines.  According to test.winehq.org, the
average number of wine module failures is 11.

-- 
James Hawkins


From mle+win at mega-nerd.com  Thu Apr 24 23:58:55 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Fri, 25 Apr 2008 14:58:55 +1000
Subject: user32 : Temporarily disable test for _WIN64.
In-Reply-To: <022301c8a68f$37ffbc20$a600fea9@DMITRY>
References: <20080425102920.05581ba3.mle+win@mega-nerd.com>
	<01ae01c8a68a$b60cf7e0$a600fea9@DMITRY>
	<20080425142637.2476970f.mle+win@mega-nerd.com>
	<022301c8a68f$37ffbc20$a600fea9@DMITRY>
Message-ID: <20080425145855.f415059d.mle+win@mega-nerd.com>

Dmitry Timoshkov wrote:

> "Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:
> 
> > In include/winuser.h we have:
> > 
> >    #if !defined _WIN64 && !defined __WINESRC__
> >    # define GWL_USERDATA        (-21)
> >    # define GWL_ID              (-12)
> >    # define GWL_HWNDPARENT      (-8)
> >    # define GWL_HINSTANCE       (-6)
> >    # define GWL_WNDPROC         (-4)
> >    # define DWL_MSGRESULT       0
> >    # define DWL_DLGPROC         4
> >    # define DWL_USER            8
> >    #endif /* _WIN64 && __WINESRC__ */
> > 
> > which means fixing the test requires first finding out the correct
> > values of these defines under _WIN64.
> 
> winuser.h already has the correct values for _WIN64.

I has _WIN64, but if _WIN64 is defined then GWL_WNDPROC is undefined
and the test in dlls/user32/tests/edit.c fails to compile.

> I assume that you have all other problems sorted out? (compiler support,
> TLS layout, calling conventions, other ABI incompatibilities).

I'm sure I haven't, but if the wine code doesn't compile I can't
debug any problems in these areas.

Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
"In civilian equipment, such as computers, the number
of components alone makes miniaturization essential if
the computer is to be housed in a reasonable-sized
building." Electronics Oct. 1, 1957, p. 178


From dmitry at codeweavers.com  Fri Apr 25 00:37:44 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 25 Apr 2008 14:37:44 +0900
Subject: user32 : Temporarily disable test for _WIN64.
References: <20080425102920.05581ba3.mle+win@mega-nerd.com><01ae01c8a68a$b60cf7e0$a600fea9@DMITRY><20080425142637.2476970f.mle+win@mega-nerd.com><022301c8a68f$37ffbc20$a600fea9@DMITRY>
	<20080425145855.f415059d.mle+win@mega-nerd.com>
Message-ID: <02f701c8a696$8c0433d0$a600fea9@DMITRY>

"Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:

> I has _WIN64, but if _WIN64 is defined then GWL_WNDPROC is undefined
> and the test in dlls/user32/tests/edit.c fails to compile.

I'll let you figure this out on your own, that's a helpful thing to learn.

>> I assume that you have all other problems sorted out? (compiler support,
>> TLS layout, calling conventions, other ABI incompatibilities).
> 
> I'm sure I haven't, but if the wine code doesn't compile I can't
> debug any problems in these areas.

user32 is not required for a simple "Hello World" app, isn't it?

-- 
Dmitry.


From dmitry at codeweavers.com  Fri Apr 25 00:42:37 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 25 Apr 2008 14:42:37 +0900
Subject: [PATCH] advapi32: add more checks in CRYPT_CreateMachineGuid.
References: <558b2f5c0804242155r7cb5a2d5jabf484e841ee6594@mail.gmail.com>
Message-ID: <032901c8a697$2d2b3ce0$a600fea9@DMITRY>

"Lei Zhang" <thestig at google.com> wrote:

> I'm getting a crash in CRYPT_CreateMachineGuid() with native
> rpcrt4.dll. This adds some checks to work around it.

I assume that "native" == "win9x" in this case.

>      pRpcStringFree = GetProcAddress(lib, "RpcStringFreeW");
> +    if (!pUuidCreate || !pUuidToString || !pRpcStringFree) goto CreateMachineGuidCleaup;

It would be better to use A versions of APIs then instead of failing,

-- 
Dmitry.


From thestig at google.com  Fri Apr 25 00:53:39 2008
From: thestig at google.com (Lei Zhang)
Date: Thu, 24 Apr 2008 22:53:39 -0700
Subject: [PATCH] advapi32: add more checks in CRYPT_CreateMachineGuid.
In-Reply-To: <032901c8a697$2d2b3ce0$a600fea9@DMITRY>
References: <558b2f5c0804242155r7cb5a2d5jabf484e841ee6594@mail.gmail.com>
	<032901c8a697$2d2b3ce0$a600fea9@DMITRY>
Message-ID: <558b2f5c0804242253yc2cc86eg9b7c7eac5df8bf6f@mail.gmail.com>

On Thu, Apr 24, 2008 at 10:42 PM, Dmitry Timoshkov
<dmitry at codeweavers.com> wrote:
> "Lei Zhang" <thestig at google.com> wrote:
>
>
> > I'm getting a crash in CRYPT_CreateMachineGuid() with native
> > rpcrt4.dll. This adds some checks to work around it.
> >
>
>  I assume that "native" == "win9x" in this case.
>
>
> >     pRpcStringFree = GetProcAddress(lib, "RpcStringFreeW");
> > +    if (!pUuidCreate || !pUuidToString || !pRpcStringFree) goto
> CreateMachineGuidCleaup;
> >
>
>  It would be better to use A versions of APIs then instead of failing,
>
>  --
>  Dmitry.
>

Right, native == win9x here. The GetProcAddress call actually
succeeds, but then pUuidToString returns RPC_S_CANNOT_SUPPORT.

I'll send a better patch out tomorrow.


From mle+win at mega-nerd.com  Fri Apr 25 01:08:39 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Fri, 25 Apr 2008 16:08:39 +1000
Subject: user32 : Temporarily disable test for _WIN64.
In-Reply-To: <02f701c8a696$8c0433d0$a600fea9@DMITRY>
References: <20080425102920.05581ba3.mle+win@mega-nerd.com>
	<01ae01c8a68a$b60cf7e0$a600fea9@DMITRY>
	<20080425142637.2476970f.mle+win@mega-nerd.com>
	<022301c8a68f$37ffbc20$a600fea9@DMITRY>
	<20080425145855.f415059d.mle+win@mega-nerd.com>
	<02f701c8a696$8c0433d0$a600fea9@DMITRY>
Message-ID: <20080425160839.8772173a.mle+win@mega-nerd.com>

Dmitry Timoshkov wrote:

> I'll let you figure this out on your own, that's a helpful thing to learn.

????

> user32 is not required for a simple "Hello World" app, isn't it?

I didn't disable test for user32, I disabled a single test. That
test was testing edit controls and I am 100% sure that edit controls
are not needed for a simple hello world program that prints to
stdout.

Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
"The music business is a cruel and shallow money trench, a long
 plastic hallway where thieves and pimps run free, and good men
 die like dogs. There's also a negative side."
   -- Hunter S. Thompson


From fgouget at free.fr  Fri Apr 25 03:12:50 2008
From: fgouget at free.fr (Francois Gouget)
Date: Fri, 25 Apr 2008 10:12:50 +0200 (CEST)
Subject: user32 : Temporarily disable test for _WIN64.
In-Reply-To: <20080425160839.8772173a.mle+win@mega-nerd.com>
References: <20080425102920.05581ba3.mle+win@mega-nerd.com>
	<01ae01c8a68a$b60cf7e0$a600fea9@DMITRY>
	<20080425142637.2476970f.mle+win@mega-nerd.com>
	<022301c8a68f$37ffbc20$a600fea9@DMITRY>
	<20080425145855.f415059d.mle+win@mega-nerd.com>
	<02f701c8a696$8c0433d0$a600fea9@DMITRY>
	<20080425160839.8772173a.mle+win@mega-nerd.com>
Message-ID: <alpine.DEB.1.10.0804251005470.3555@amboise.dolphin>

On Fri, 25 Apr 2008, Erik de Castro Lopo wrote:
[...]
> > user32 is not required for a simple "Hello World" app, isn't it?
> 
> I didn't disable test for user32, I disabled a single test. That
> test was testing edit controls and I am 100% sure that edit controls
> are not needed for a simple hello world program that prints to
> stdout.

That's ok to do in your local Git repository.

However you have to understand that we cannot very well commit patch 
that disables a test which is very useful in garanteeing there won't be 
regressions in the very much used and about to go stable 32bit version 
for hypothetical progress in the 64bit version.

But by all means hack and slash your local tree so you can get to the 
crux of the matter quickly.

-- 
Francois Gouget <fgouget at free.fr>              http://fgouget.free.fr/
            "Lotto: A tax on people who are bad at math." -- unknown
          "Windows: Microsoft's tax on computer illiterates." -- WE7U


From mle+win at mega-nerd.com  Fri Apr 25 03:33:25 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Fri, 25 Apr 2008 18:33:25 +1000
Subject: user32 : Temporarily disable test for _WIN64.
In-Reply-To: <alpine.DEB.1.10.0804251005470.3555@amboise.dolphin>
References: <20080425102920.05581ba3.mle+win@mega-nerd.com>
	<01ae01c8a68a$b60cf7e0$a600fea9@DMITRY>
	<20080425142637.2476970f.mle+win@mega-nerd.com>
	<022301c8a68f$37ffbc20$a600fea9@DMITRY>
	<20080425145855.f415059d.mle+win@mega-nerd.com>
	<02f701c8a696$8c0433d0$a600fea9@DMITRY>
	<20080425160839.8772173a.mle+win@mega-nerd.com>
	<alpine.DEB.1.10.0804251005470.3555@amboise.dolphin>
Message-ID: <20080425183325.734ef069.mle+win@mega-nerd.com>

Francois Gouget wrote:

> That's ok to do in your local Git repository.
> 
> However you have to understand that we cannot very well commit patch 
> that disables a test which is very useful in garanteeing there won't be 
> regressions in the very much used and about to go stable 32bit version 
> for hypothetical progress in the 64bit version.

My patch only disabled this one test for Win64. It remained enabled
and active for Win32.
 
However, after some rather subtle prompting from Dmitry Timoshkov
and Reece Dunn, I have fixed the test so that it compiles correctly
for Win32 and Win64.

Cheers,
Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
"What is freedom of expression? Without the freedom to offend,
it ceases to exist." - Salman Rushdie


From david.adam.cnrs at gmail.com  Thu Apr 24 21:20:11 2008
From: david.adam.cnrs at gmail.com (David Adam)
Date: Fri, 25 Apr 2008 04:20:11 +0200
Subject: ddraw: ComputeSphereVisibility
Message-ID: <5f9140a20804241920i1473bf12gd13fb5a8e5ae3183@mail.gmail.com>

Hello,

I am trying to debug the demo of The Sting. Now, the main is that the screen
is almost black. It is surely related to the following FIXME:
fixme:d3d7:IDirect3DDeviceImpl_7_ComputeSphereVisibility

Unfortunately, I did not find any informations about this function. Does
anyone know what this function does, ( and better knows a possible
implementation)?

Thanks,

David Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080425/10658a8d/attachment.htm 

From msclrhd at googlemail.com  Fri Apr 25 01:19:00 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Fri, 25 Apr 2008 07:19:00 +0100
Subject: user32 : Temporarily disable test for _WIN64.
In-Reply-To: <20080425160839.8772173a.mle+win@mega-nerd.com>
References: <20080425102920.05581ba3.mle+win@mega-nerd.com>
	<01ae01c8a68a$b60cf7e0$a600fea9@DMITRY>
	<20080425142637.2476970f.mle+win@mega-nerd.com>
	<022301c8a68f$37ffbc20$a600fea9@DMITRY>
	<20080425145855.f415059d.mle+win@mega-nerd.com>
	<02f701c8a696$8c0433d0$a600fea9@DMITRY>
	<20080425160839.8772173a.mle+win@mega-nerd.com>
Message-ID: <3f4fd2640804242319i2761d499r9385bbf13cdbaf4c@mail.gmail.com>

2008/4/25 Erik de Castro Lopo <mle+win at mega-nerd.com>:
> Dmitry Timoshkov wrote:
>
>  > I'll let you figure this out on your own, that's a helpful thing to learn.
>
>  ????

Try looking up GetWindowLongPtr in MSDN. That should be enough of a
hint to help you to get the edit.c tests building properly with _WIN64
defined (as well as supporting WIN32).

- Reece


From julliard at winehq.org  Fri Apr 25 07:35:42 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 25 Apr 2008 14:35:42 +0200
Subject: [Resend 2/5] imm32: Add the header for private imm32 function.
In-Reply-To: <1209091034.2601.14.camel@localhost> (ByeongSik Jeon's message of
	"Fri, 25 Apr 2008 11:37:14 +0900")
References: <62a23f5c679edef0d94693f1a48eca307adeaae4.1209090301.git.bsjeon@hanmail.net>
	<1209091034.2601.14.camel@localhost>
Message-ID: <874p9qjen5.fsf@wine.dyndns.org>

ByeongSik Jeon <bsjeon at hanmail.net> writes:

> Unknown function in the SDK/DDK's header.
> ---
>  include/wine/imm_private.h |   35 +++++++++++++++++++++++++++++++++++

You don't want to add a new header for that, especially not a global
one. The function is exported on Windows too, so it's OK to declare it
in the DDK header.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Fri Apr 25 07:52:24 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 25 Apr 2008 14:52:24 +0200
Subject: ntoskrnl.exe: Change calling conventions [try 2]
In-Reply-To: <200804251408.25035.amorozov@etersoft.ru> (Alexander Morozov's
	message of "Fri, 25 Apr 2008 14:08:24 +0400")
References: <200804251408.25035.amorozov@etersoft.ru>
Message-ID: <87zlrihzav.fsf@wine.dyndns.org>

Alexander Morozov <amorozov at etersoft.ru> writes:

> Changelog:
> ntoskrnl.exe: Change calling conventions for InterlockedExchange, 
> InterlockedCompareExchange, InterlockedDecrement and InterlockedIncrement
>
> --- a/dlls/ntoskrnl.exe/ntoskrnl.exe.spec
> +++ b/dlls/ntoskrnl.exe/ntoskrnl.exe.spec
> @@ -28,11 +28,11 @@
>  @ stub Exfi386InterlockedExchangeUlong
>  @ stub Exfi386InterlockedIncrementLong
>  @ stub HalExamineMBR
> -@ stdcall InterlockedCompareExchange(ptr long long) kernel32.InterlockedCompareExchange
> -@ stdcall InterlockedDecrement(ptr) kernel32.InterlockedDecrement
> -@ stdcall InterlockedExchange(ptr long) kernel32.InterlockedExchange
> +@ stdcall -norelay InterlockedCompareExchange(ptr long long) NTOSKRNL_InterlockedCompareExchange
> +@ stdcall -norelay InterlockedDecrement(ptr) NTOSKRNL_InterlockedDecrement
> +@ stdcall -norelay InterlockedExchange(ptr long) NTOSKRNL_InterlockedExchange
>  @ stdcall InterlockedExchangeAdd(ptr long ) kernel32.InterlockedExchangeAdd
> -@ stdcall InterlockedIncrement(ptr) kernel32.InterlockedIncrement
> +@ stdcall -norelay InterlockedIncrement(ptr) NTOSKRNL_InterlockedIncrement

Why didn't you fix InterlockedExchangeAdd too?

-- 
Alexandre Julliard
julliard at winehq.org


From wine-devel at kievinfo.com  Fri Apr 25 08:07:08 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Fri, 25 Apr 2008 07:07:08 -0600
Subject: [PATCH] user32: edit controls should ignore WM_KEYDOWN on control
	+ enter.
In-Reply-To: <558b2f5c0804242223j6918b02enccb1ba5c59924552@mail.gmail.com>
References: <558b2f5c0804242222h2bfa942j7f3cecaaebc0ab81@mail.gmail.com>
	<558b2f5c0804242223j6918b02enccb1ba5c59924552@mail.gmail.com>
Message-ID: <4811D77C.4000203@kievinfo.com>

Lei Zhang wrote:
> On Thu, Apr 24, 2008 at 10:22 PM, Lei Zhang <thestig at google.com> wrote:
>> Hi,
>>
>>  This should be the last bit in getting control + enter working in
>>  multiline edit controls. I attempted to write a test for this using
>>  SendInput() or SetKeyState() + SendMessage(), but I couldn't get seem
>>  to simulate holding down the control key.
>>
> 
Should work. You can also look at keybd_event() how it does it. It's pretty 
much a wrapper around SendInput().
All you'll need is keybd_event(VK_CONTROL, 0, 0, 0); to press it. And 
keybd_event(VK_CONTROL, 0, KEYEVENTF_KEYUP, 0); to release it.

Vitaliy.



From felix at compsoc.nuigalway.ie  Fri Apr 25 09:00:47 2008
From: felix at compsoc.nuigalway.ie (Darragh Bailey)
Date: Fri, 25 Apr 2008 15:00:47 +0100
Subject: Safedisc for 1.0+ ?
In-Reply-To: <481156B3.5060802@kievinfo.com>
References: <48114995.3010703@gmail.com> <481156B3.5060802@kievinfo.com>
Message-ID: <20080425140047.GB7597@compsoc.nuigalway.ie>

On Thu, Apr 24, 2008 at 09:57:39PM -0600, Vitaliy Margolen wrote:
> TheBlunderbuss wrote:
> >     It has just occurred to me that safedisc copy protection (bug 219!) 
> > wasn't put on the Wine 1.0 task list. It's a pretty major bug and covers 
> > a wide range of programs, with a wide range of safedisc versions.
> > Considering this, how should we plan for this implementation?
> > 
> Some versions should work. Newer versions mos likely won't. But as usual in 
> these cases your mileage may vary. Since there are so many variables.
> 
> Setting target for such bugs to 1.0 won't magically fix them. Nor will it 
> keep them from breaking.

There has been some movement in the past to split up the Safedisc bug
and deal with the individual versions separately. Would it be useful to
advance this? I'm certain that I have a number of games that listed as
apps affected by this bug that no longer have a problem. So I'm not sure
that it works well to maintain the same bug for all versions of
safedisc.


-- 
Darragh

"Nothing is foolproof to a sufficiently talented fool."


From amorozov at etersoft.ru  Fri Apr 25 09:22:08 2008
From: amorozov at etersoft.ru (Alexander Morozov)
Date: Fri, 25 Apr 2008 18:22:08 +0400
Subject: ntoskrnl.exe: Change calling conventions [try 2]
In-Reply-To: <87zlrihzav.fsf@wine.dyndns.org>
References: <200804251408.25035.amorozov@etersoft.ru>
	<87zlrihzav.fsf@wine.dyndns.org>
Message-ID: <200804251822.08764.amorozov@etersoft.ru>

> Why didn't you fix InterlockedExchangeAdd too?

Yes, this function also should be fixed. I will send new patch. Sorry. I got 
confused because this function worked:

#include "wdm.h"

#pragma code_seg("INIT")
NTSTATUS DriverEntry(IN PDRIVER_OBJECT DriverObject,
        IN PUNICODE_STRING RegistryPath)
{
    LONG a = 0xaa, b = 0xbb, *ptr = &b, ret = 0xcc;

    ret = InterlockedExchangeAdd(ptr, a);
    DbgPrint("*ptr %x, ret %x\n", *ptr, ret);

    return STATUS_SUCCESS;
}
#pragma code_seg()

...........
   10628:       c7 45 fc aa 00 00 00    movl   $0xaa,0xfffffffc(%ebp)
   1062f:       c7 45 f4 bb 00 00 00    movl   $0xbb,0xfffffff4(%ebp)
   10636:       8d 45 f4                lea    0xfffffff4(%ebp),%eax
   10639:       89 45 f8                mov    %eax,0xfffffff8(%ebp)
   1063c:       c7 45 f0 cc 00 00 00    movl   $0xcc,0xfffffff0(%ebp)
   10643:       8b 55 fc                mov    0xfffffffc(%ebp),%edx
   10646:       8b 4d f8                mov    0xfffffff8(%ebp),%ecx
   10649:       e8 42 fe ff ff          call   0x10490
...........


From aric at codeweavers.com  Fri Apr 25 09:36:36 2008
From: aric at codeweavers.com (Aric Stewart)
Date: Fri, 25 Apr 2008 09:36:36 -0500
Subject: Kusanagi Kouichi : winex11:	Destroy the handle to the composition
	string after it is cancelled.
In-Reply-To: <E1JpNhv-0008GY-P4@wine.codeweavers.com>
References: <E1JpNhv-0008GY-P4@wine.codeweavers.com>
Message-ID: <4811EC74.8010006@codeweavers.com>

Comming in a bit late on this one, (missed the patch submission)

I do not think this is correct as far as i know hCompStr should never be 
NULL. Much of our code depends on that not being NULL.

I would recommend using ImeCreateBlankCompStr instead. (something like 
below)

diff --git a/dlls/winex11.drv/ime.c b/dlls/winex11.drv/ime.c
index f50549f..8fa6f6f 100644
--- a/dlls/winex11.drv/ime.c
+++ b/dlls/winex11.drv/ime.c
@@ -778,7 +778,7 @@ BOOL WINAPI NotifyIME(HIMC hIMC, DWORD dwAction, 
DWORD dwInd
                      if (lpIMC->hCompStr)
                      {
                          ImmDestroyIMCC(lpIMC->hCompStr);
-                        lpIMC->hCompStr = NULL;
+                        lpIMC->hCompStr = ImeCreateBlankCompStr();
                      }

                      myPrivate = 
(LPIMEPRIVATE)ImmLockIMCC(lpIMC->hPrivate);

-aric

Alexandre Julliard wrote:
> Module: wine
> Branch: master
> Commit: 4f2330ac0c951ec5fb05e2fb152c59723c3af336
> URL:    http://source.winehq.org/git/wine.git/?a=commit;h=4f2330ac0c951ec5fb05e2fb152c59723c3af336
> 
> Author: Kusanagi Kouichi <slash at ma.neweb.ne.jp>
> Date:   Fri Apr 25 12:08:24 2008 +0900
> 
> winex11: Destroy the handle to the composition string after it is cancelled.
> 
> ---
> 
>  dlls/winex11.drv/ime.c |    6 ++++++
>  1 files changed, 6 insertions(+), 0 deletions(-)
> 
> diff --git a/dlls/winex11.drv/ime.c b/dlls/winex11.drv/ime.c
> index 6614213..f50549f 100644
> --- a/dlls/winex11.drv/ime.c
> +++ b/dlls/winex11.drv/ime.c
> @@ -775,6 +775,12 @@ BOOL WINAPI NotifyIME(HIMC hIMC, DWORD dwAction, DWORD dwIndex, DWORD dwValue)
>  
>                      X11DRV_ForceXIMReset(lpIMC->hWnd);
>  
> +                    if (lpIMC->hCompStr)
> +                    {
> +                        ImmDestroyIMCC(lpIMC->hCompStr);
> +                        lpIMC->hCompStr = NULL;
> +                    }
> +
>                      myPrivate = (LPIMEPRIVATE)ImmLockIMCC(lpIMC->hPrivate);
>                      if (myPrivate->bInComposition)
>                      {
> 
> 
> 


From mstefani at redhat.com  Fri Apr 25 09:40:31 2008
From: mstefani at redhat.com (Michael Stefaniuc)
Date: Fri, 25 Apr 2008 16:40:31 +0200
Subject: John Klehm : winex11: Add support for IsXExtensionPointer tablet
	devices.
In-Reply-To: <E1JpNhf-0008AF-Q6@wine.codeweavers.com>
References: <E1JpNhf-0008AF-Q6@wine.codeweavers.com>
Message-ID: <4811ED5F.6080108@redhat.com>

This patch break compilation on my RHEL5 box with 
xorg-x11-proto-devel-7.1-9.fc6 which misses the IsXExtensionPointer define.

bye
	michael

Alexandre Julliard wrote:
> Module: wine
> Branch: master
> Commit: 2c26ea609d6b2b8a25be20984c0014ceb202466a
> URL:    http://source.winehq.org/git/wine.git/?a=commit;h=2c26ea609d6b2b8a25be20984c0014ceb202466a
> 
> Author: John Klehm <xixsimplicityxix at gmail.com>
> Date:   Tue Apr 22 20:11:28 2008 -0500
> 
> winex11: Add support for IsXExtensionPointer tablet devices.
> 
> ---
> 
>  dlls/winex11.drv/wintab.c |    5 +++--
>  1 files changed, 3 insertions(+), 2 deletions(-)
> 
> diff --git a/dlls/winex11.drv/wintab.c b/dlls/winex11.drv/wintab.c
> index 37596ba..b086e44 100644
> --- a/dlls/winex11.drv/wintab.c
> +++ b/dlls/winex11.drv/wintab.c
> @@ -530,14 +530,15 @@ void X11DRV_LoadTabletInfo(HWND hwnddefault)
>                  devices[loop].use == IsXKeyboard ? "IsXKeyboard" :
>                      devices[loop].use == IsXPointer ? "IsXPointer" :
>                      devices[loop].use == IsXExtensionDevice ? "IsXExtensionDevice" :
> +                    devices[loop].use == IsXExtensionPointer ? "IsXExtensionPointer" :
>                      "Unknown"
>                  );
>  
> -        if (devices[loop].use == IsXExtensionDevice)
> +        if ((devices[loop].use == IsXExtensionDevice) || (devices[loop].use == IsXExtensionPointer))
>          {
>              LPWTI_CURSORS_INFO cursor;
>  
> -            TRACE("Is Extension Device\n");
> +            TRACE("Is XExtension%s\n", (devices[loop].use == IsXExtensionDevice)? "Device":"Pointer");
>              cursor_target++;
>              target = &devices[loop];
>              cursor = &gSysCursor[cursor_target];
> 
> 
> 


-- 
Michael Stefaniuc                           Tel.: +49-711-96437-199
Consulting Communications Engineer          Fax.: +49-711-96437-111
--------------------------------------------------------------------
Reg. Adresse: Red Hat GmbH, Otto-Hahn-Strasse 20, 85609 Dornach bei Muenchen
Handelsregister: Amtsgericht Muenchen HRB 153243
Gesch?ftsf?hrer: Brendan Lane, Charlie Peters, Michael Cunningham,
                  Werner Knoblich


From winehacker at gmail.com  Fri Apr 25 10:50:22 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Fri, 25 Apr 2008 11:50:22 -0400
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <871w4v8exd.fsf@wine.dyndns.org>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	<87r6cv8uh3.fsf@wine.dyndns.org>
	<19e31a080804240755o51963e61xebe17b174382fb88@mail.gmail.com>
	<871w4v8exd.fsf@wine.dyndns.org>
Message-ID: <19e31a080804250850l360f0e13jc7cf7c28c2f1a961@mail.gmail.com>

On Thu, Apr 24, 2008 at 11:12 AM, Alexandre Julliard
<julliard at winehq.org> wrote:
>  It depends which cases you are trying to catch, but for the case of
>  users starting an app from their desktop, you could probably do it in
>  start.exe.

As per our discussion on IRC, start uses CreateProcess which according
to Raymond and my own testing does not wait around and return anything
of any meaning, see

http://blogs.msdn.com/oldnewthing/archive/2005/01/19/356048.aspx

So checking the return value and doing something like

WINE_ERR("start failed, error %d\n", GetLastError());

does not even work, let alone because if it finds the EXE there is no
error as far as CreateProcess cares. On the other had, The child
process returns an exit code such as STATUS_ENTRYPOINT_NOT_FOUND but I
don't see how to get this information from the parent process, return
it to start.exe.so and have start do something like print an error or
display a message box. Can anyone lurking point me to an example of
how to get the child's return value and pass that back to the parent?

Thanks
-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From vostok at etersoft.ru  Fri Apr 25 11:00:23 2008
From: vostok at etersoft.ru (Anatoly Lyutin)
Date: Fri, 25 Apr 2008 20:00:23 +0400
Subject: [2/2] [try2] user32:mdi.c Fix creating MDI child window according
	with test. [resend]
In-Reply-To: <877ieo24s7.fsf@wine.dyndns.org>
References: <480DE437.3050709@etersoft.ru> <877ieo24s7.fsf@wine.dyndns.org>
Message-ID: <48120017.20206@etersoft.ru>

Alexandre Julliard wrote:
> It doesn't work:
>
> msg.c:3065: Test failed: Create visible MDI child window: the msg sequence is not complete: expected 0000 - actual 0046
> msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg 0x0047 was expected, but got msg 0x0046 instead
> msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg 0x0005 was expected, but got msg 0x0083 instead
> msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg 0x0046 was expected, but got msg 0x0047 instead
> msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg 0x0083 was expected, but got msg 0x0047 instead
> msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg 0x0047 was expected, but got msg 0x0005 instead
> msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg sequence is not complete: expected 0000 - actual 0046
> msg.c:3345: Test failed: ShowWindow(SW_MAXIMIZE):invisible maximized MDI child: the msg 0x0047 was expected, but got msg 0x0046 instead
> msg.c:3345: Test failed: ShowWindow(SW_MAXIMIZE):invisible maximized MDI child: the msg sequence is not complete: expected 0000 - actual 0083
> msg.c:3484: Test failed: Create MDI child window with invisible parent: the msg sequence is not complete: expected 0000 - actual 0046
>
>   
I muff this regression, thank you. I sent a new version of this patch.

-- 
Best regards
	Anatoly Lyutin.



From thestig at google.com  Fri Apr 25 11:11:42 2008
From: thestig at google.com (Lei Zhang)
Date: Fri, 25 Apr 2008 09:11:42 -0700
Subject: [PATCH] user32: edit controls should ignore WM_KEYDOWN on control
	+ enter.
In-Reply-To: <4811D77C.4000203@kievinfo.com>
References: <558b2f5c0804242222h2bfa942j7f3cecaaebc0ab81@mail.gmail.com>
	<558b2f5c0804242223j6918b02enccb1ba5c59924552@mail.gmail.com>
	<4811D77C.4000203@kievinfo.com>
Message-ID: <558b2f5c0804250911r4d677befma3f9a69de41bb3c0@mail.gmail.com>

On Fri, Apr 25, 2008 at 6:07 AM, Vitaliy Margolen
<wine-devel at kievinfo.com> wrote:
>
> Lei Zhang wrote:
>  > On Thu, Apr 24, 2008 at 10:22 PM, Lei Zhang <thestig at google.com> wrote:
>  >> Hi,
>  >>
>  >>  This should be the last bit in getting control + enter working in
>  >>  multiline edit controls. I attempted to write a test for this using
>  >>  SendInput() or SetKeyState() + SendMessage(), but I couldn't get seem
>  >>  to simulate holding down the control key.
>  >>
>  >
>  Should work. You can also look at keybd_event() how it does it. It's pretty
>  much a wrapper around SendInput().
>  All you'll need is keybd_event(VK_CONTROL, 0, 0, 0); to press it. And
>  keybd_event(VK_CONTROL, 0, KEYEVENTF_KEYUP, 0); to release it.
>

I tried that too. Also tried SetFocus(hedit) first. No luck.


From slash at ma.neweb.ne.jp  Fri Apr 25 12:13:45 2008
From: slash at ma.neweb.ne.jp (Kusanagi Kouichi)
Date: Sat, 26 Apr 2008 02:13:45 +0900
Subject: Kusanagi Kouichi : winex11: Destroy the handle to the
	composition string after it is cancelled.
In-Reply-To: <4811EC74.8010006@codeweavers.com>
References: <E1JpNhv-0008GY-P4@wine.codeweavers.com>
	<4811EC74.8010006@codeweavers.com>
Message-ID: <200804251713458971660006MAE3@nm06mta.auone-net.jp>

On Fri, Apr 25, 2008 at 09:36:36AM -0500, Aric Stewart wrote:
> Comming in a bit late on this one, (missed the patch submission)
> 
> I do not think this is correct as far as i know hCompStr should never be 
> NULL. Much of our code depends on that not being NULL.
> 
> I would recommend using ImeCreateBlankCompStr instead. (something like 
> below)
> 
> diff --git a/dlls/winex11.drv/ime.c b/dlls/winex11.drv/ime.c
> index f50549f..8fa6f6f 100644
> --- a/dlls/winex11.drv/ime.c
> +++ b/dlls/winex11.drv/ime.c
> @@ -778,7 +778,7 @@ BOOL WINAPI NotifyIME(HIMC hIMC, DWORD dwAction, 
> DWORD dwInd
>                       if (lpIMC->hCompStr)
>                       {
>                           ImmDestroyIMCC(lpIMC->hCompStr);
> -                        lpIMC->hCompStr = NULL;
> +                        lpIMC->hCompStr = ImeCreateBlankCompStr();
>                       }
> 
>                       myPrivate = 
> (LPIMEPRIVATE)ImmLockIMCC(lpIMC->hPrivate);
> 
> -aric

Then, are these also wrong? updateCompStr returns NULL if NULL or 0 is given.
   748	                        newCompStr = updateCompStr(lpIMC->hCompStr, NULL, 0);
   749	                        ImmDestroyIMCC(lpIMC->hCompStr);
   750	                        lpIMC->hCompStr = newCompStr;

   897	            newCompStr = updateCompStr(lpIMC->hCompStr, NULL, 0);
   898	            ImmDestroyIMCC(lpIMC->hCompStr);
   899	            lpIMC->hCompStr = newCompStr;


From stefan at codeweavers.com  Fri Apr 25 12:23:23 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Fri, 25 Apr 2008 19:23:23 +0200
Subject: ddraw: ComputeSphereVisibility
In-Reply-To: <5f9140a20804241920i1473bf12gd13fb5a8e5ae3183@mail.gmail.com>
References: <5f9140a20804241920i1473bf12gd13fb5a8e5ae3183@mail.gmail.com>
Message-ID: <200804251923.24140.stefan@codeweavers.com>

Am Freitag, 25. April 2008 04:20:11 schrieb David Adam:
> Hello,
>
> I am trying to debug the demo of The Sting. Now, the main is that the
> screen is almost black. It is surely related to the following FIXME:
> fixme:d3d7:IDirect3DDeviceImpl_7_ComputeSphereVisibility
>
> Unfortunately, I did not find any informations about this function. Does
> anyone know what this function does, ( and better knows a possible
> implementation)?
There's something in the DirectX SDK, and I added some implementation ideas to 
the comments in the ddraw code. I think it comes down to a bit of vector 
math, but I think you'll have to write some test cases to check if it really 
does what that the MSDN says


From tehblunderbuss at gmail.com  Fri Apr 25 12:25:44 2008
From: tehblunderbuss at gmail.com (TheBlunderbuss)
Date: Fri, 25 Apr 2008 12:25:44 -0500
Subject: Safedisc for 1.0+ ?
In-Reply-To: <20080425140047.GB7597@compsoc.nuigalway.ie>
References: <48114995.3010703@gmail.com> <481156B3.5060802@kievinfo.com>
	<20080425140047.GB7597@compsoc.nuigalway.ie>
Message-ID: <48121418.6000307@gmail.com>

Darragh Bailey wrote:
> There has been some movement in the past to split up the Safedisc bug
> and deal with the individual versions separately. Would it be useful to
> advance this? I'm certain that I have a number of games that listed as
> apps affected by this bug that no longer have a problem. So I'm not sure
> that it works well to maintain the same bug for all versions of
> safedisc.
I think that's a good idea


From stefan at codeweavers.com  Fri Apr 25 12:36:17 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Fri, 25 Apr 2008 19:36:17 +0200
Subject: ddraw: Fix tests that fail with the reference rasterizer
In-Reply-To: <22821af30804242038v3a581bbcsf7f5493633f07968@mail.gmail.com>
References: <22821af30804242038v3a581bbcsf7f5493633f07968@mail.gmail.com>
Message-ID: <200804251936.18031.stefan@codeweavers.com>

Am Freitag, 25. April 2008 05:38:40 schrieb James Hawkins:
> Hi,
>
> Changelog:
> * Fix tests that fail with the reference rasterizer.

>    if (SUCCEEDED(IDirectDrawSurface7_AddAttachedSurface(surface1, 
surface4)))
>        refrast = TRUE;
Do you take care of detaching the surface again?

Did you try checking the DirectDraw description or GUID? Maybe there's a 
better way to detet the refrast, if you want the teest to succeeed in a VM


From stefan at codeweavers.com  Fri Apr 25 12:37:45 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Fri, 25 Apr 2008 19:37:45 +0200
Subject: d3d8: Fix a few test failures in win2k3
In-Reply-To: <22821af30804241836p571a1e99j98a30694a58be097@mail.gmail.com>
References: <22821af30804241836p571a1e99j98a30694a58be097@mail.gmail.com>
Message-ID: <200804251937.46045.stefan@codeweavers.com>

Am Freitag, 25. April 2008 03:36:04 schrieb James Hawkins:
> Hi,
>
> Changelog:
> * Fix a few test failures in win2k3.
>
>  dlls/d3d8/tests/device.c |    9 ++++++---
>  1 files changed, 6 insertions(+), 3 deletions(-)
Looks ok to me

Somewhen we may want to move all this multiple times copypasted device init 
code into a shared function :-/


From truiken at gmail.com  Fri Apr 25 12:51:31 2008
From: truiken at gmail.com (James Hawkins)
Date: Fri, 25 Apr 2008 12:51:31 -0500
Subject: ddraw: Fix tests that fail with the reference rasterizer
In-Reply-To: <200804251936.18031.stefan@codeweavers.com>
References: <22821af30804242038v3a581bbcsf7f5493633f07968@mail.gmail.com>
	<200804251936.18031.stefan@codeweavers.com>
Message-ID: <22821af30804251051k556c0e0end93bc6d3dee428aa@mail.gmail.com>

On Fri, Apr 25, 2008 at 12:36 PM, Stefan D?singer
<stefan at codeweavers.com> wrote:
> Am Freitag, 25. April 2008 05:38:40 schrieb James Hawkins:
>
> > Hi,
>  >
>  > Changelog:
>  > * Fix tests that fail with the reference rasterizer.
>
>  >    if (SUCCEEDED(IDirectDrawSurface7_AddAttachedSurface(surface1,
>  surface4)))
>  >        refrast = TRUE;
>  Do you take care of detaching the surface again?
>

I'll send in a patch to fix that.

>  Did you try checking the DirectDraw description or GUID? Maybe there's a
>  better way to detet the refrast, if you want the teest to succeeed in a VM
>

I'm sorry, I'm not that familiar with ddraw.

-- 
James Hawkins


From dank at kegel.com  Fri Apr 25 13:07:41 2008
From: dank at kegel.com (Dan Kegel)
Date: Fri, 25 Apr 2008 11:07:41 -0700
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <19e31a080804250850l360f0e13jc7cf7c28c2f1a961@mail.gmail.com>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	<87r6cv8uh3.fsf@wine.dyndns.org>
	<19e31a080804240755o51963e61xebe17b174382fb88@mail.gmail.com>
	<871w4v8exd.fsf@wine.dyndns.org>
	<19e31a080804250850l360f0e13jc7cf7c28c2f1a961@mail.gmail.com>
Message-ID: <a71bd89a0804251107j7cc4b33eya30f562af32ee0a@mail.gmail.com>

On Fri, Apr 25, 2008 at 8:50 AM, Steven Edwards <winehacker at gmail.com> wrote:
>  does not even work, let alone because if it finds the EXE there is no
>  error as far as CreateProcess cares. On the other had, The child
>  process returns an exit code such as STATUS_ENTRYPOINT_NOT_FOUND but I
>  don't see how to get this information from the parent process, return
>  it to start.exe.so and have start do something like print an error or
>  display a message box. Can anyone lurking point me to an example of
>  how to get the child's return value and pass that back to the parent?

A few ideas:

* have start.exe examine the import table of the exe and do an explicit check
(hard)

* have start.exe set an environment variable saying "show graphical error box
on dll load failure", and clear that before calling executed apps' WinMain()
(easy)


From aric at codeweavers.com  Fri Apr 25 14:44:00 2008
From: aric at codeweavers.com (Aric Stewart)
Date: Fri, 25 Apr 2008 14:44:00 -0500
Subject: Kusanagi Kouichi : winex11: Destroy the handle to the	composition
	string after it is cancelled.
In-Reply-To: <200804251713458971660006MAE3@nm06mta.auone-net.jp>
References: <E1JpNhv-0008GY-P4@wine.codeweavers.com>	<4811EC74.8010006@codeweavers.com>
	<200804251713458971660006MAE3@nm06mta.auone-net.jp>
Message-ID: <48123480.80700@codeweavers.com>

No, from updateCompStr

     if (old == NULL && compstr == NULL && len == 0)
         return NULL;

Otherwise it returns a compstr. So it only should return NULL if all the 
incoming parameters are NULL, which i do not believe should ever happen 
after i went through and made sure that the hCompStr was never NULL.

-aric

Kusanagi Kouichi wrote:
> On Fri, Apr 25, 2008 at 09:36:36AM -0500, Aric Stewart wrote:
>> Comming in a bit late on this one, (missed the patch submission)
>>
>> I do not think this is correct as far as i know hCompStr should never be 
>> NULL. Much of our code depends on that not being NULL.
>>
>> I would recommend using ImeCreateBlankCompStr instead. (something like 
>> below)
>>
>> diff --git a/dlls/winex11.drv/ime.c b/dlls/winex11.drv/ime.c
>> index f50549f..8fa6f6f 100644
>> --- a/dlls/winex11.drv/ime.c
>> +++ b/dlls/winex11.drv/ime.c
>> @@ -778,7 +778,7 @@ BOOL WINAPI NotifyIME(HIMC hIMC, DWORD dwAction, 
>> DWORD dwInd
>>                       if (lpIMC->hCompStr)
>>                       {
>>                           ImmDestroyIMCC(lpIMC->hCompStr);
>> -                        lpIMC->hCompStr = NULL;
>> +                        lpIMC->hCompStr = ImeCreateBlankCompStr();
>>                       }
>>
>>                       myPrivate = 
>> (LPIMEPRIVATE)ImmLockIMCC(lpIMC->hPrivate);
>>
>> -aric
> 
> Then, are these also wrong? updateCompStr returns NULL if NULL or 0 is given.
>    748	                        newCompStr = updateCompStr(lpIMC->hCompStr, NULL, 0);
>    749	                        ImmDestroyIMCC(lpIMC->hCompStr);
>    750	                        lpIMC->hCompStr = newCompStr;
> 
>    897	            newCompStr = updateCompStr(lpIMC->hCompStr, NULL, 0);
>    898	            ImmDestroyIMCC(lpIMC->hCompStr);
>    899	            lpIMC->hCompStr = newCompStr;
> 
> 


From adam at tpetaccia.com  Fri Apr 25 15:17:40 2008
From: adam at tpetaccia.com (Adam Petaccia)
Date: Fri, 25 Apr 2008 16:17:40 -0400
Subject: SOC 2008 Projects Announced
In-Reply-To: <b130c85e0804222114v3b8abc00v965c598d780e5a44@mail.gmail.com>
References: <b6bb06270804221436s5dfab6fctbe89047e55b4a8e9@mail.gmail.com>
	<b130c85e0804222114v3b8abc00v965c598d780e5a44@mail.gmail.com>
Message-ID: <1209154660.5743.7.camel@pimpmobile>

> Could the students come forward and say something about themself?

Hello Wine world, my name is Adam Petaccia, and this summer I will be
working on Wine's GDI+ implementation, so more applications can work
"out of the box". I am currently a student at the University of North
Carolina, Greensboro (US), and look forward to getting to coding, once
I'm done with those pesky exams.

Its exciting to see how far Wine has come (I remember running Starcraft
as root with nice -20 just so that the game could be somwhat playable --
thank [deity] we don't have to do that now) and I look forward to making
Wine even greater.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080425/08d5cfc7/attachment.pgp 

From dank at kegel.com  Fri Apr 25 16:24:37 2008
From: dank at kegel.com (Dan Kegel)
Date: Fri, 25 Apr 2008 14:24:37 -0700
Subject: Wine 1.0 release plan update
Message-ID: <a71bd89a0804251424u9f3942eq7e674bc2fcea0593@mail.gmail.com>

Alexandre's taking a vacation in May, and the schedule
is bending slightly to fit.  We're also not promising a
particular release date, though the previously predicted
date is still as likely as it was before.

http://wiki.winehq.org/WineReleasePlan
now says:

--- snip ---
    * 0.9.61 - 2 May 2008 - start of code freeze for 1.0
    * 1.0.0-rc1 - 9 May 2008 (early because of Alexandre's vacation)
    * No release 16 May (Alexandre on vacation)
    * 1.0.0-rc2 - 23 May (early because of Alexandre's vacation)

The exact date of the 1.0.0 release can't be predicted; we'll keep on
doing release candidates until we're comfortable with it. We expect it
will be in June.
--- snip ---


From slash at ma.neweb.ne.jp  Fri Apr 25 16:45:46 2008
From: slash at ma.neweb.ne.jp (Kusanagi Kouichi)
Date: Sat, 26 Apr 2008 06:45:46 +0900
Subject: Kusanagi Kouichi : winex11: Destroy the handle to the
	composition string after it is cancelled.
In-Reply-To: <48123480.80700@codeweavers.com>
References: <E1JpNhv-0008GY-P4@wine.codeweavers.com>
	<4811EC74.8010006@codeweavers.com>
	<200804251713458971660006MAE3@nm06mta.auone-net.jp>
	<48123480.80700@codeweavers.com>
Message-ID: <200804252145471336410006MA34@nm06mta.auone-net.jp>

On Fri, Apr 25, 2008 at 02:44:00PM -0500, Aric Stewart wrote:
> No, from updateCompStr
> 
>      if (old == NULL && compstr == NULL && len == 0)
>          return NULL;
> 
> Otherwise it returns a compstr. So it only should return NULL if all the 
> incoming parameters are NULL, which i do not believe should ever happen 
> after i went through and made sure that the hCompStr was never NULL.
> 
> -aric

Oh, I mistook && for ||. All right, I'll send a patch.


From austinenglish at gmail.com  Fri Apr 25 19:59:12 2008
From: austinenglish at gmail.com (Austin English)
Date: Fri, 25 Apr 2008 19:59:12 -0500
Subject: download.template: Update Mandriva download info (try 2)
Message-ID: <b6bb06270804251759y669f04aby57e5c12318b14b97@mail.gmail.com>

Any reason this patch wasn't applied?

http://www.winehq.org/pipermail/wine-patches/2008-April/053911.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080425/be14600c/attachment.htm 

From dmitry at codeweavers.com  Fri Apr 25 22:07:10 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sat, 26 Apr 2008 12:07:10 +0900
Subject: [PATCH] advapi32: attempt to use UuidToStringA if UuidToStringW
	isnot available.
References: <558b2f5c0804251409o5fe4d7f9m6cb2bc49421b94a5@mail.gmail.com>
Message-ID: <010201c8a74a$a18dc360$a600fea9@DMITRY>

"Lei Zhang" <thestig at google.com> wrote:

> This adds more checks in CRYPT_CreateMachineGuid(), and attempt to use
> UuidToStringA if UuidToStringW is not available.

Instead of duplicating and complicating the code, IMO it would be more
straightforward to use ansi APIs without trying unicode first.

-- 
Dmitry.


From truiken at gmail.com  Sat Apr 26 01:09:21 2008
From: truiken at gmail.com (James Hawkins)
Date: Sat, 26 Apr 2008 01:09:21 -0500
Subject: cabinet: Revert "cabinet: Fix for FDICopy with an empty cabinet
	file."
In-Reply-To: <3f4fd2640804252303g7d59b41ey2e541727edef0f36@mail.gmail.com>
References: <22821af30804252049s6e83d571m3895d3e4f26d2dd4@mail.gmail.com>
	<3f4fd2640804252303g7d59b41ey2e541727edef0f36@mail.gmail.com>
Message-ID: <22821af30804252309i28deb570u3fbf3b0e8daec8d6@mail.gmail.com>

On Sat, Apr 26, 2008 at 1:03 AM, Reece Dunn <msclrhd at googlemail.com> wrote:
> 2008/4/26 James Hawkins <jhawkins at codeweavers.com>:
>
> > Hi,
>  >
>  >  The test was incorrect and failed on all platforms.  Vitaly, please
>  >  ask someone to test your patches on a real windows system in the
>  >  future if you don't have access to one.
>
>  Wouldn't it be better to actually fix the test case than revert it all together?
>
>  Just simply change line 630:
>
>  -    ok(ret, "Expected FDICopy to succeed\n");
>  +    ok(!ret, "Expected FDICopy to fail\n");
>
>  and remove the todo_wine. Adding a GetLastError check would be good as well.
>

Have you actually read the patch or the changelog for that matter?

-- 
James Hawkins


From truiken at gmail.com  Sat Apr 26 01:15:41 2008
From: truiken at gmail.com (James Hawkins)
Date: Sat, 26 Apr 2008 01:15:41 -0500
Subject: ddraw: Remove a test that fails in VMs
In-Reply-To: <3f4fd2640804252311o54006a64geca1ad6d53d0e074@mail.gmail.com>
References: <22821af30804252127h995d19eg1907d741235a45ee@mail.gmail.com>
	<3f4fd2640804252311o54006a64geca1ad6d53d0e074@mail.gmail.com>
Message-ID: <22821af30804252315m5a51ebb6raed8bafea9eb8c47@mail.gmail.com>

On Sat, Apr 26, 2008 at 1:11 AM, Reece Dunn <msclrhd at googlemail.com> wrote:
> 2008/4/26 James Hawkins <jhawkins at codeweavers.com>:
>
> > Hi,
>  >
>  >  The tests aren't run anyway in this case.
>  >
>  >  Changelog:
>  >  * Remove a test that fails in VMs.
>  ...
>  >              hr = IDirect3D7_CreateDevice(Direct3D, &IID_IDirect3DRefDevice, Surface, &Direct3DDevice);
>  >          }
>  >      }
>  > -    ok(hr == D3D_OK, "IDirect3D7_CreateDevice failed with %08x\n", hr);
>
>  Wouldn't it be better to move the ok line to directly after the
>  IDirect3D7_CreateDevice call? That way, on VM machines the test will
>  not get run and on non-VM machines it will, as it is a valid test in
>  that case.
>

No, the test will still be run in all cases, VM or not, and will fail
in VMs.  The function just sets up the direct3d device object for
other tests; there's no point in an ok test in this function,
especially when it doesn't pass for all systems.

-- 
James Hawkins


From msclrhd at googlemail.com  Sat Apr 26 01:03:53 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Sat, 26 Apr 2008 07:03:53 +0100
Subject: cabinet: Revert "cabinet: Fix for FDICopy with an empty cabinet
	file."
In-Reply-To: <22821af30804252049s6e83d571m3895d3e4f26d2dd4@mail.gmail.com>
References: <22821af30804252049s6e83d571m3895d3e4f26d2dd4@mail.gmail.com>
Message-ID: <3f4fd2640804252303g7d59b41ey2e541727edef0f36@mail.gmail.com>

2008/4/26 James Hawkins <jhawkins at codeweavers.com>:
> Hi,
>
>  The test was incorrect and failed on all platforms.  Vitaly, please
>  ask someone to test your patches on a real windows system in the
>  future if you don't have access to one.

Wouldn't it be better to actually fix the test case than revert it all together?

Just simply change line 630:

-    ok(ret, "Expected FDICopy to succeed\n");
+    ok(!ret, "Expected FDICopy to fail\n");

and remove the todo_wine. Adding a GetLastError check would be good as well.

- Reece


From msclrhd at googlemail.com  Sat Apr 26 01:11:44 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Sat, 26 Apr 2008 07:11:44 +0100
Subject: ddraw: Remove a test that fails in VMs
In-Reply-To: <22821af30804252127h995d19eg1907d741235a45ee@mail.gmail.com>
References: <22821af30804252127h995d19eg1907d741235a45ee@mail.gmail.com>
Message-ID: <3f4fd2640804252311o54006a64geca1ad6d53d0e074@mail.gmail.com>

2008/4/26 James Hawkins <jhawkins at codeweavers.com>:
> Hi,
>
>  The tests aren't run anyway in this case.
>
>  Changelog:
>  * Remove a test that fails in VMs.
...
>              hr = IDirect3D7_CreateDevice(Direct3D, &IID_IDirect3DRefDevice, Surface, &Direct3DDevice);
>          }
>      }
> -    ok(hr == D3D_OK, "IDirect3D7_CreateDevice failed with %08x\n", hr);

Wouldn't it be better to move the ok line to directly after the
IDirect3D7_CreateDevice call? That way, on VM machines the test will
not get run and on non-VM machines it will, as it is a valid test in
that case.

- Reece


From msclrhd at googlemail.com  Sat Apr 26 01:17:50 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Sat, 26 Apr 2008 07:17:50 +0100
Subject: cabinet: Revert "cabinet: Fix for FDICopy with an empty cabinet
	file."
In-Reply-To: <22821af30804252309i28deb570u3fbf3b0e8daec8d6@mail.gmail.com>
References: <22821af30804252049s6e83d571m3895d3e4f26d2dd4@mail.gmail.com>
	<3f4fd2640804252303g7d59b41ey2e541727edef0f36@mail.gmail.com>
	<22821af30804252309i28deb570u3fbf3b0e8daec8d6@mail.gmail.com>
Message-ID: <3f4fd2640804252317w3343ed2bra834a5de287c6c3@mail.gmail.com>

2008/4/26 James Hawkins <truiken at gmail.com>:
>
> On Sat, Apr 26, 2008 at 1:03 AM, Reece Dunn <msclrhd at googlemail.com> wrote:
>  > 2008/4/26 James Hawkins <jhawkins at codeweavers.com>:
>  >
>  > > Hi,
>  >  >
>  >  >  The test was incorrect and failed on all platforms.  Vitaly, please
>  >  >  ask someone to test your patches on a real windows system in the
>  >  >  future if you don't have access to one.
>  >
>  >  Wouldn't it be better to actually fix the test case than revert it all together?
>  >
>
>  Have you actually read the patch or the changelog for that matter?

I misread the "Revert ..." part to mean a full revert of the original patch.

Sorry for the noise.
- Reece


From msclrhd at googlemail.com  Sat Apr 26 01:20:03 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Sat, 26 Apr 2008 07:20:03 +0100
Subject: ddraw: Remove a test that fails in VMs
In-Reply-To: <22821af30804252315m5a51ebb6raed8bafea9eb8c47@mail.gmail.com>
References: <22821af30804252127h995d19eg1907d741235a45ee@mail.gmail.com>
	<3f4fd2640804252311o54006a64geca1ad6d53d0e074@mail.gmail.com>
	<22821af30804252315m5a51ebb6raed8bafea9eb8c47@mail.gmail.com>
Message-ID: <3f4fd2640804252320t5e8e42c6sba9d3a2b5672704a@mail.gmail.com>

2008/4/26 James Hawkins <truiken at gmail.com>:
>
> On Sat, Apr 26, 2008 at 1:11 AM, Reece Dunn <msclrhd at googlemail.com> wrote:
>  >  Wouldn't it be better to move the ok line to directly after the
>  >  IDirect3D7_CreateDevice call? That way, on VM machines the test will
>  >  not get run and on non-VM machines it will, as it is a valid test in
>  >  that case.
>
>  No, the test will still be run in all cases, VM or not, and will fail
>  in VMs.  The function just sets up the direct3d device object for
>  other tests; there's no point in an ok test in this function,
>  especially when it doesn't pass for all systems.

Ok.

- Reece


From mat at brain-dump.org  Sat Apr 26 04:45:45 2008
From: mat at brain-dump.org (Marc Andre Tanner)
Date: Sat, 26 Apr 2008 11:45:45 +0200
Subject: [GSoC][RFC] Case Insensitive Filesystem
In-Reply-To: <20080325213351.GA3237@debbook.brain-dump.org>
References: <20080325213351.GA3237@debbook.brain-dump.org>
Message-ID: <20080426094545.GA2036@debbook.brain-dump.org>

Hi,

Just wanted to let you know that i have finally found the time to set 
up a little page for ciopfs:

  http://www.brain-dump.org/projects/ciopfs/

There are certainly a few things which could be improved but it in my
tests it worked quite well in it's current form. As it seems that the 
idea of a fuse mounted .wine directory isn't that popular i will probably
leave the code as it is and move on to other things. Anyway it was fun
to do some work with fuse and in case someone is interested in it you 
now know where you can find it. 

Regards,
Marc

-- 
 Marc Andre Tanner >< http://www.brain-dump.org/ >< GPG key: CF7D56C0


From vitperov at etersoft.ru  Sat Apr 26 08:13:55 2008
From: vitperov at etersoft.ru (Vitaly Perov)
Date: Sat, 26 Apr 2008 17:13:55 +0400
Subject: [Try 3] [1/2] cabinet.dll -> FDICopy: Test added
In-Reply-To: <22821af30804050928s48a26486k311c3d6d6d5a4ce0@mail.gmail.com>
References: <200804051937.33251.vitperov@etersoft.ru>
	<22821af30804050928s48a26486k311c3d6d6d5a4ce0@mail.gmail.com>
Message-ID: <200804261713.55402.vitperov@etersoft.ru>

Hi,

> Hi,
>
>  The test was incorrect and failed on all platforms.  Vitaly, please
>  ask someone to test your patches on a real windows system in the
>  future if you don't have access to one.

I have never received this message. I found it by chance in the comment of 
Reece Dunn.

Does the problem still persist?


-- 
Best wishes,
Vitaly Perov
Russia, Saint-Petersburg. www.etersoft.ru


From wine-devel at kievinfo.com  Sat Apr 26 09:39:19 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sat, 26 Apr 2008 08:39:19 -0600
Subject: [dinput] move the common joystick_map_.* methods from
	joystick_linuxinput.c into device.c
In-Reply-To: <20080426001043.GF5348@byleth.sc-networks.de>
References: <20080426001043.GF5348@byleth.sc-networks.de>
Message-ID: <48133E97.6030003@kievinfo.com>

Christoph Frick wrote:
> diff --git a/dlls/dinput/device.c b/dlls/dinput/device.c
> index 5f927d0..baca0b3 100644
> --- a/dlls/dinput/device.c
> +++ b/dlls/dinput/device.c
> @@ -1400,3 +1400,54 @@ HRESULT WINAPI IDirectInputDevice8WImpl_GetImageInfo(LPDIRECTINPUTDEVICE8W iface
>      
Please don't. Device is common for everything (keyboard, mouse, joysticks). 
Joystick specific code should not be there.


Vitaliy.


From wine-devel at kievinfo.com  Sat Apr 26 09:57:28 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sat, 26 Apr 2008 08:57:28 -0600
Subject: [dinput] initial support for BSD's usbhid joysticks
In-Reply-To: <20080426005247.GH5348@byleth.sc-networks.de>
References: <20080426005247.GH5348@byleth.sc-networks.de>
Message-ID: <481342D8.4070206@kievinfo.com>

Christoph Frick wrote:
> From 7618ceb6941c0dffac9c48c1fa1aeb7e821673a2 Mon Sep 17 00:00:00 2001
> From: Christoph Frick <frick at sc-networks.com>
> Date: Sat, 26 Apr 2008 02:50:01 +0200
> Subject: [PATCH] Initial support for BSD's usbhid joysticks
> 
> Please consider this a tracer bullet. I had only time to test it with a
> 4-axis/4-button wheel in LFS in FreeBSD 7.0. I will take further tests using a
> flight stick and other games soon. But for now i just want to see, what others
> have to say about it.
> ---

Please use 4 spaces indentation, no tabs.

> +		snprintf(buf, MAX_PATH, FMT_UHIDDEVS, i);
> +		buf[MAX_PATH - 1] = 0;

snprintf always writes terminating '\0' character at the end of the string. 
You don't need to explicitly do that yourself.

> +		if ((fd = open(buf, O_RDWR | O_NDELAY, 0)) == -1) {
> +			TRACE("Unable to open %s read/write: %s\n", buf, strerror(errno));
> +			continue;
> +		}
Do you really have to open it read/write? Shouldn't read only be enough for 
not FF joystick?

The only way I can think of to remove code duplication is to create base 
joystick class. There were no reason for that with only 2 joystick drivers. 
With third one should really do it.

Vitaliy.


From juan.lang at gmail.com  Sat Apr 26 10:00:57 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Sat, 26 Apr 2008 08:00:57 -0700
Subject: [dinput] initial support for BSD's usbhid joysticks
In-Reply-To: <481342D8.4070206@kievinfo.com>
References: <20080426005247.GH5348@byleth.sc-networks.de>
	<481342D8.4070206@kievinfo.com>
Message-ID: <3a768c550804260800n54246b5ep23bfe7c86a38d30e@mail.gmail.com>

>  snprintf always writes terminating '\0' character at the end of the string.

Only if the buffer contains enough space for the terminating null.

>  You don't need to explicitly do that yourself.

That's probably true in this case.
--Juan


From wine-devel at kievinfo.com  Sat Apr 26 10:13:43 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sat, 26 Apr 2008 09:13:43 -0600
Subject: [dinput] initial support for BSD's usbhid joysticks
In-Reply-To: <3a768c550804260800n54246b5ep23bfe7c86a38d30e@mail.gmail.com>
References: <20080426005247.GH5348@byleth.sc-networks.de>	
	<481342D8.4070206@kievinfo.com>
	<3a768c550804260800n54246b5ep23bfe7c86a38d30e@mail.gmail.com>
Message-ID: <481346A7.9090707@kievinfo.com>

Juan Lang wrote:
>>  snprintf always writes terminating '\0' character at the end of the string.
> 
> Only if the buffer contains enough space for the terminating null.
> 
No (in case buffer at least 1 byte long). From man page:

The functions snprintf() and vsnprintf() write at most size bytes (including 
the trailing null byte ('\0')) to str.

This means that terminating zero is always written to the buffer (if it's at 
least 1 char long). I agree that above part of the man page is not exactly 
clear. But you can find a better explanation on the web, which spell out 
what is actually written.

This is not the infamous strncpy that does what you said.

Vitaliy.


From juan.lang at gmail.com  Sat Apr 26 10:14:40 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Sat, 26 Apr 2008 08:14:40 -0700
Subject: [dinput] initial support for BSD's usbhid joysticks
In-Reply-To: <481346A7.9090707@kievinfo.com>
References: <20080426005247.GH5348@byleth.sc-networks.de>
	<481342D8.4070206@kievinfo.com>
	<3a768c550804260800n54246b5ep23bfe7c86a38d30e@mail.gmail.com>
	<481346A7.9090707@kievinfo.com>
Message-ID: <3a768c550804260814q33d511aoec06b3a3b92739d3@mail.gmail.com>

>  No (in case buffer at least 1 byte long).

Oh, right you are!  Thanks, I did confuse that the strncpy.
--Juan


From thestig at google.com  Sat Apr 26 12:37:47 2008
From: thestig at google.com (Lei Zhang)
Date: Sat, 26 Apr 2008 10:37:47 -0700
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
Message-ID: <558b2f5c0804261037k69bfa3ddp2262f927d6ca51ed@mail.gmail.com>

On Wed, Apr 23, 2008 at 5:59 AM, Alexandre Julliard <julliard at winehq.org> wrote:
> Module: wine
>  Branch: master
>  Commit: faaccca59be08be547ec4e1948b6306eff3808a2
>  URL:    http://source.winehq.org/git/wine.git/?a=commit;h=faaccca59be08be547ec4e1948b6306eff3808a2
>
>  Author: Dan Kegel <dank at kegel.com>
>  Date:   Tue Apr 22 17:56:36 2008 -0700
>
>  winecfg: Restrict dpi slider to sane values.
>
>  ---
>
>   programs/winecfg/x11drvdlg.c |    4 ++--
>   1 files changed, 2 insertions(+), 2 deletions(-)
>
>  diff --git a/programs/winecfg/x11drvdlg.c b/programs/winecfg/x11drvdlg.c
>  index bfa6ec5..c0ec058 100644
>  --- a/programs/winecfg/x11drvdlg.c
>  +++ b/programs/winecfg/x11drvdlg.c
>  @@ -35,9 +35,9 @@
>
>   WINE_DEFAULT_DEBUG_CHANNEL(winecfg);
>
>  -#define RES_MAXLEN 5 /* the maximum number of characters in a screen dimension. 5 digits should be plenty, what kind of crazy person runs their screen >10,000 pixels across? */
>  +#define RES_MAXLEN 5 /* max number of digits in a screen dimension. 5 digits should be plenty */
>   #define MINDPI 96
>  -#define MAXDPI 480
>  +#define MAXDPI 144     /* making this too high surprises and hurts users */
>   #define DEFDPI 96
>
>   #define IDT_DPIEDIT 0x1234
>
>
>
>

Dan, this basically reverted commit
0110512904d9c646abef416819a057c06d3f2c97, which bumped MAXDPI from 160
to 480 because some users specifically requested the ability for
higher DPI settings.

I think we need to decide what we want and stop the tug-o-war.


From thestig at google.com  Sat Apr 26 12:40:30 2008
From: thestig at google.com (Lei Zhang)
Date: Sat, 26 Apr 2008 10:40:30 -0700
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <558b2f5c0804261037k69bfa3ddp2262f927d6ca51ed@mail.gmail.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<558b2f5c0804261037k69bfa3ddp2262f927d6ca51ed@mail.gmail.com>
Message-ID: <558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>

On Sat, Apr 26, 2008 at 10:37 AM, Lei Zhang <thestig at google.com> wrote:
>
> On Wed, Apr 23, 2008 at 5:59 AM, Alexandre Julliard <julliard at winehq.org> wrote:
>  > Module: wine
>  >  Branch: master
>  >  Commit: faaccca59be08be547ec4e1948b6306eff3808a2
>  >  URL:    http://source.winehq.org/git/wine.git/?a=commit;h=faaccca59be08be547ec4e1948b6306eff3808a2
>  >
>  >  Author: Dan Kegel <dank at kegel.com>
>  >  Date:   Tue Apr 22 17:56:36 2008 -0700
>  >
>  >  winecfg: Restrict dpi slider to sane values.
>  >
>  >  ---
>  >
>  >   programs/winecfg/x11drvdlg.c |    4 ++--
>  >   1 files changed, 2 insertions(+), 2 deletions(-)
>  >
>  >  diff --git a/programs/winecfg/x11drvdlg.c b/programs/winecfg/x11drvdlg.c
>  >  index bfa6ec5..c0ec058 100644
>  >  --- a/programs/winecfg/x11drvdlg.c
>  >  +++ b/programs/winecfg/x11drvdlg.c
>  >  @@ -35,9 +35,9 @@
>  >
>  >   WINE_DEFAULT_DEBUG_CHANNEL(winecfg);
>  >
>  >  -#define RES_MAXLEN 5 /* the maximum number of characters in a screen dimension. 5 digits should be plenty, what kind of crazy person runs their screen >10,000 pixels across? */
>  >  +#define RES_MAXLEN 5 /* max number of digits in a screen dimension. 5 digits should be plenty */
>  >   #define MINDPI 96
>  >  -#define MAXDPI 480
>  >  +#define MAXDPI 144     /* making this too high surprises and hurts users */
>  >   #define DEFDPI 96
>  >
>  >   #define IDT_DPIEDIT 0x1234
>  >
>  >
>  >
>  >
>
>  Dan, this basically reverted commit
>  0110512904d9c646abef416819a057c06d3f2c97, which bumped MAXDPI from 160
>  to 480 because some users specifically requested the ability for
>  higher DPI settings.
>
>  I think we need to decide what we want and stop the tug-o-war.
>

Please see bug 9715.


From winehacker at gmail.com  Sat Apr 26 12:53:28 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Sat, 26 Apr 2008 13:53:28 -0400
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <a71bd89a0804251107j7cc4b33eya30f562af32ee0a@mail.gmail.com>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	<87r6cv8uh3.fsf@wine.dyndns.org>
	<19e31a080804240755o51963e61xebe17b174382fb88@mail.gmail.com>
	<871w4v8exd.fsf@wine.dyndns.org>
	<19e31a080804250850l360f0e13jc7cf7c28c2f1a961@mail.gmail.com>
	<a71bd89a0804251107j7cc4b33eya30f562af32ee0a@mail.gmail.com>
Message-ID: <19e31a080804261053p4ba91432ifa929c13663e4f@mail.gmail.com>

On Fri, Apr 25, 2008 at 2:07 PM, Dan Kegel <dank at kegel.com> wrote:
>  * have start.exe examine the import table of the exe and do an explicit check
>  (hard)

Seems like too much to go in to start anyway. And I am lazy

>  * have start.exe set an environment variable saying "show graphical error box
>  on dll load failure", and clear that before calling executed apps' WinMain()
>  (easy)

So something like start.exe.so in Unix mode would set a variable like
VERSBOSE_USERDEBUG or which then we could query in the loader using
RtlQueryEnvironmentVariable_U or something that would trigger the
MessageBox from the example code I already wrote in ntdll?

Thanks
Steven

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From dsh at linux.ucla.edu  Sat Apr 26 13:00:56 2008
From: dsh at linux.ucla.edu (Dan Hipschman)
Date: Sat, 26 Apr 2008 11:00:56 -0700
Subject: [PATCH 6/7] widl: Accept integer constant suffixes in the lexer.
In-Reply-To: <4812ED2E.7040602@codeweavers.com>
References: <4812ED2E.7040602@codeweavers.com>
Message-ID: <20080426180055.GR11580@linux.ucla.edu>

On Sat, Apr 26, 2008 at 09:51:58AM +0100, Robert Shearman wrote:
> +u_suffix	(l|L)
> +l_suffix	(u|U)

I'm guessing you meant for these to be the other way around.


From austinenglish at gmail.com  Sat Apr 26 13:27:21 2008
From: austinenglish at gmail.com (Austin English)
Date: Sat, 26 Apr 2008 13:27:21 -0500
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<558b2f5c0804261037k69bfa3ddp2262f927d6ca51ed@mail.gmail.com>
	<558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>
Message-ID: <b6bb06270804261127q7341530bq8b5de5274e4ece61@mail.gmail.com>

On 4/26/08, Lei Zhang <thestig at google.com> wrote:
>
> On Sat, Apr 26, 2008 at 10:37 AM, Lei Zhang <thestig at google.com> wrote:
> >
> > On Wed, Apr 23, 2008 at 5:59 AM, Alexandre Julliard <julliard at winehq.org>
> wrote:
> >  > Module: wine
> >  >  Branch: master
> >  >  Commit: faaccca59be08be547ec4e1948b6306eff3808a2
> >  >  URL:
> http://source.winehq.org/git/wine.git/?a=commit;h=faaccca59be08be547ec4e1948b6306eff3808a2
> >  >
> >  >  Author: Dan Kegel <dank at kegel.com>
> >  >  Date:   Tue Apr 22 17:56:36 2008 -0700
> >  >
> >  >  winecfg: Restrict dpi slider to sane values.
> >  >
> >  >  ---
> >  >
> >  >   programs/winecfg/x11drvdlg.c |    4 ++--
> >  >   1 files changed, 2 insertions(+), 2 deletions(-)
> >  >
> >  >  diff --git a/programs/winecfg/x11drvdlg.c
> b/programs/winecfg/x11drvdlg.c
> >  >  index bfa6ec5..c0ec058 100644
> >  >  --- a/programs/winecfg/x11drvdlg.c
> >  >  +++ b/programs/winecfg/x11drvdlg.c
> >  >  @@ -35,9 +35,9 @@
> >  >
> >  >   WINE_DEFAULT_DEBUG_CHANNEL(winecfg);
> >  >
> >  >  -#define RES_MAXLEN 5 /* the maximum number of characters in a
> screen dimension. 5 digits should be plenty, what kind of crazy person runs
> their screen >10,000 pixels across? */
> >  >  +#define RES_MAXLEN 5 /* max number of digits in a screen dimension.
> 5 digits should be plenty */
> >  >   #define MINDPI 96
> >  >  -#define MAXDPI 480
> >  >  +#define MAXDPI 144     /* making this too high surprises and hurts
> users */
> >  >   #define DEFDPI 96
> >  >
> >  >   #define IDT_DPIEDIT 0x1234
> >  >
> >  >
> >  >
> >  >
> >
> >  Dan, this basically reverted commit
> >  0110512904d9c646abef416819a057c06d3f2c97, which bumped MAXDPI from 160
> >  to 480 because some users specifically requested the ability for
> >  higher DPI settings.
> >
> >  I think we need to decide what we want and stop the tug-o-war.
> >
>
>
> Please see bug 9715.
>
>
> The change was specifically requested. A warning if someone sets it over
150, or a small explanation in winecfg would be better IMHO.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080426/d0e2b60b/attachment.htm 

From wine-devel at kievinfo.com  Sat Apr 26 13:54:14 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sat, 26 Apr 2008 12:54:14 -0600
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <b6bb06270804261127q7341530bq8b5de5274e4ece61@mail.gmail.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>	<558b2f5c0804261037k69bfa3ddp2262f927d6ca51ed@mail.gmail.com>	<558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>
	<b6bb06270804261127q7341530bq8b5de5274e4ece61@mail.gmail.com>
Message-ID: <48137A56.9070505@kievinfo.com>

Austin English wrote:
> On 4/26/08, *Lei Zhang* <thestig at google.com <mailto:thestig at google.com>> 
> wrote:
> 
>     On Sat, Apr 26, 2008 at 10:37 AM, Lei Zhang <thestig at google.com
>     <mailto:thestig at google.com>> wrote:
>      >
>      > On Wed, Apr 23, 2008 at 5:59 AM, Alexandre Julliard
>     <julliard at winehq.org <mailto:julliard at winehq.org>> wrote:
>      >  > Module: wine
>      >  >  Branch: master
>      >  >  Commit: faaccca59be08be547ec4e1948b6306eff3808a2
>      >  >  URL:    http://source.winehq.org/git/wine.git/?a=commit;h=faaccca59be08be547ec4e1948b6306eff3808a2
>      >  >
>      >  >  Author: Dan Kegel <dank at kegel.com <mailto:dank at kegel.com>>
>      >  >  Date:   Tue Apr 22 17:56:36 2008 -0700
>      >  >
>      >  >  winecfg: Restrict dpi slider to sane values.
>      >  >
>      >  >  ---
>      >  >
>      >  >   programs/winecfg/x11drvdlg.c |    4 ++--
>      >  >   1 files changed, 2 insertions(+), 2 deletions(-)
>      >  >
>      >  >  diff --git a/programs/winecfg/x11drvdlg.c
>     b/programs/winecfg/x11drvdlg.c
>      >  >  index bfa6ec5..c0ec058 100644
>      >  >  --- a/programs/winecfg/x11drvdlg.c
>      >  >  +++ b/programs/winecfg/x11drvdlg.c
>      >  >  @@ -35,9 +35,9 @@
>      >  >
>      >  >   WINE_DEFAULT_DEBUG_CHANNEL(winecfg);
>      >  >
>      >  >  -#define RES_MAXLEN 5 /* the maximum number of characters in
>     a screen dimension. 5 digits should be plenty, what kind of crazy
>     person runs their screen >10,000 pixels across? */
>      >  >  +#define RES_MAXLEN 5 /* max number of digits in a screen
>     dimension. 5 digits should be plenty */
>      >  >   #define MINDPI 96
>      >  >  -#define MAXDPI 480
>      >  >  +#define MAXDPI 144     /* making this too high surprises and
>     hurts users */
>      >  >   #define DEFDPI 96
>      >  >
>      >  >   #define IDT_DPIEDIT 0x1234
>      >  >
>      >  >
>      >  >
>      >  >
>      >
>      >  Dan, this basically reverted commit
>      >  0110512904d9c646abef416819a057c06d3f2c97, which bumped MAXDPI
>     from 160
>      >  to 480 because some users specifically requested the ability for
>      >  higher DPI settings.
>      >
>      >  I think we need to decide what we want and stop the tug-o-war.
>      >
> 
> 
>     Please see bug 9715.
> 
> 
> The change was specifically requested. A warning if someone sets it over 
> 150, or a small explanation in winecfg would be better IMHO.
> 
> 
> ------------------------------------------------------------------------
> 
> 
For anyone who wants more then 150 they can change that in the registry. 
Honestly I've yet to see a single device with such a high DPI!

And since by definition users will do everything to screw themselves up we 
have to make it hard enough so majority will just give up.

Vitaliy.


From austinenglish at gmail.com  Sat Apr 26 15:43:09 2008
From: austinenglish at gmail.com (Austin English)
Date: Sat, 26 Apr 2008 15:43:09 -0500
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <48137A56.9070505@kievinfo.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<558b2f5c0804261037k69bfa3ddp2262f927d6ca51ed@mail.gmail.com>
	<558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>
	<b6bb06270804261127q7341530bq8b5de5274e4ece61@mail.gmail.com>
	<48137A56.9070505@kievinfo.com>
Message-ID: <b6bb06270804261343t1a2d97e0maf17439ae1c6e85e@mail.gmail.com>

On Sat, Apr 26, 2008 at 1:54 PM, Vitaliy Margolen
<wine-devel at kievinfo.com> wrote:
> Austin English wrote:
>  > On 4/26/08, *Lei Zhang* <thestig at google.com <mailto:thestig at google.com>>
>
> > wrote:
>  >
>  >     On Sat, Apr 26, 2008 at 10:37 AM, Lei Zhang <thestig at google.com
>
> >     <mailto:thestig at google.com>> wrote:
>  >      >
>  >      > On Wed, Apr 23, 2008 at 5:59 AM, Alexandre Julliard
>
> >     <julliard at winehq.org <mailto:julliard at winehq.org>> wrote:
>  >      >  > Module: wine
>  >      >  >  Branch: master
>  >      >  >  Commit: faaccca59be08be547ec4e1948b6306eff3808a2
>  >      >  >  URL:    http://source.winehq.org/git/wine.git/?a=commit;h=faaccca59be08be547ec4e1948b6306eff3808a2
>  >      >  >
>  >      >  >  Author: Dan Kegel <dank at kegel.com <mailto:dank at kegel.com>>
>
>
> >      >  >  Date:   Tue Apr 22 17:56:36 2008 -0700
>  >      >  >
>  >      >  >  winecfg: Restrict dpi slider to sane values.
>  >      >  >
>  >      >  >  ---
>  >      >  >
>  >      >  >   programs/winecfg/x11drvdlg.c |    4 ++--
>  >      >  >   1 files changed, 2 insertions(+), 2 deletions(-)
>  >      >  >
>  >      >  >  diff --git a/programs/winecfg/x11drvdlg.c
>  >     b/programs/winecfg/x11drvdlg.c
>  >      >  >  index bfa6ec5..c0ec058 100644
>  >      >  >  --- a/programs/winecfg/x11drvdlg.c
>  >      >  >  +++ b/programs/winecfg/x11drvdlg.c
>  >      >  >  @@ -35,9 +35,9 @@
>  >      >  >
>  >      >  >   WINE_DEFAULT_DEBUG_CHANNEL(winecfg);
>  >      >  >
>  >      >  >  -#define RES_MAXLEN 5 /* the maximum number of characters in
>  >     a screen dimension. 5 digits should be plenty, what kind of crazy
>  >     person runs their screen >10,000 pixels across? */
>  >      >  >  +#define RES_MAXLEN 5 /* max number of digits in a screen
>  >     dimension. 5 digits should be plenty */
>  >      >  >   #define MINDPI 96
>  >      >  >  -#define MAXDPI 480
>  >      >  >  +#define MAXDPI 144     /* making this too high surprises and
>  >     hurts users */
>  >      >  >   #define DEFDPI 96
>  >      >  >
>  >      >  >   #define IDT_DPIEDIT 0x1234
>  >      >  >
>  >      >  >
>  >      >  >
>  >      >  >
>  >      >
>  >      >  Dan, this basically reverted commit
>  >      >  0110512904d9c646abef416819a057c06d3f2c97, which bumped MAXDPI
>  >     from 160
>  >      >  to 480 because some users specifically requested the ability for
>  >      >  higher DPI settings.
>  >      >
>  >      >  I think we need to decide what we want and stop the tug-o-war.
>  >      >
>  >
>  >
>  >     Please see bug 9715.
>  >
>  >
>  > The change was specifically requested. A warning if someone sets it over
>  > 150, or a small explanation in winecfg would be better IMHO.
>  >
>  >
>  > ------------------------------------------------------------------------
>  >
>  >
>  For anyone who wants more then 150 they can change that in the registry.
>  Honestly I've yet to see a single device with such a high DPI!
>
>  And since by definition users will do everything to screw themselves up we
>  have to make it hard enough so majority will just give up.
>
>  Vitaliy.
>
>
>

How about something like the following, along with restoring back to 480 max?

diff --git a/programs/winecfg/En.rc b/programs/winecfg/En.rc
index 65b6fd1..97550c0 100644
--- a/programs/winecfg/En.rc
+++ b/programs/winecfg/En.rc
@@ -87,7 +87,7 @@ BEGIN
     COMBOBOX
IDC_D3D_VSHADER_MODE,100,201,145,70,CBS_DROPDOWNLIST | WS_VSCROLL |
WS_TABSTOP

     CONTROL         "Allow &Pixel Shader (if supported by
hardware)",IDC_D3D_PSHADER_MODE,"Button",BS_AUTOCHECKBOX |
WS_TABSTOP,15,219,230,10
-    GROUPBOX        " Screen &Resolution ",IDC_STATIC,8,242,244,25
+    GROUPBOX        " Screen &Resolution - Don't change this if you
don't know what it is! ",IDC_STATIC,8,242,244,25
     CONTROL         "", IDC_RES_TRACKBAR,
"msctls_trackbar32",WS_TABSTOP,12,250,187,15
     EDITTEXT        IDC_RES_DPIEDIT,204,250,23,13,ES_NUMBER|WS_TABSTOP
     LTEXT           "dpi",IDC_STATIC,235,252,10,8


From bmschwar at fas.harvard.edu  Sat Apr 26 15:51:11 2008
From: bmschwar at fas.harvard.edu (Benjamin M. Schwartz)
Date: Sat, 26 Apr 2008 16:51:11 -0400
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <48137A56.9070505@kievinfo.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>	<558b2f5c0804261037k69bfa3ddp2262f927d6ca51ed@mail.gmail.com>	<558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>	<b6bb06270804261127q7341530bq8b5de5274e4ece61@mail.gmail.com>
	<48137A56.9070505@kievinfo.com>
Message-ID: <481395BF.4000500@fas.harvard.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Vitaliy Margolen wrote:
| For anyone who wants more then 150 they can change that in the registry.
| Honestly I've yet to see a single device with such a high DPI!

I have ported Wine to run on the OLPC XO, which has a 200 DPI screen.  I
am currently running Wine at 160 DPI, which makes the fonts somewhat small
but improves the ability of Windows apps to fit on the 7.5" screen.

Also, some Windows software runs badly at high DPI.  Some of Wine's own
utilities, such as wordpad.exe, seem to malfunction even at 160 dpi.

- --Ben

P.S.  If you have an XO, you may try out Wine for XO from
http://dev.laptop.org/~bemasc/DOSConsole-3.xo
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.7 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFIE5W/UJT6e6HFtqQRAs1tAKChfwNIHwozyCd6UGAYFXRla0QIxQCgkUqk
EvCic33qC8VRgzZjScvLSk4=
=dn3X
-----END PGP SIGNATURE-----


From frick at sc-networks.de  Sat Apr 26 17:00:38 2008
From: frick at sc-networks.de (Christoph Frick)
Date: Sun, 27 Apr 2008 00:00:38 +0200
Subject: [dinput] move the common joystick_map_.* methods from
	joystick_linuxinput.c into device.c
In-Reply-To: <48133E97.6030003@kievinfo.com>
References: <20080426001043.GF5348@byleth.sc-networks.de>
	<48133E97.6030003@kievinfo.com>
Message-ID: <20080426220038.GI5348@byleth.sc-networks.de>

On Sat, Apr 26, 2008 at 08:39:19AM -0600, Vitaliy Margolen wrote:

> Christoph Frick wrote:
> > diff --git a/dlls/dinput/device.c b/dlls/dinput/device.c
> > index 5f927d0..baca0b3 100644
> > --- a/dlls/dinput/device.c
> > +++ b/dlls/dinput/device.c
> > @@ -1400,3 +1400,54 @@ HRESULT WINAPI IDirectInputDevice8WImpl_GetImageInfo(LPDIRECTINPUTDEVICE8W iface
> >      
> Please don't. Device is common for everything (keyboard, mouse,
> joysticks).  Joystick specific code should not be there.

i dont like it in joysticks_linuxinput. it stands there right before the
bigbig ifdef and the only reason it is there, is because it was written
for that file in the first place. any suggestions where to move it? on
the other hand my other patch does not depend on the move - just on the
functions - so we just keep in the linux file until we get the common
joystick class.

-- 
cu
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 163 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080427/3514110d/attachment.pgp 

From frick at sc-networks.de  Sat Apr 26 17:24:29 2008
From: frick at sc-networks.de (Christoph Frick)
Date: Sun, 27 Apr 2008 00:24:29 +0200
Subject: [dinput] initial support for BSD's usbhid joysticks
In-Reply-To: <481342D8.4070206@kievinfo.com>
References: <20080426005247.GH5348@byleth.sc-networks.de>
	<481342D8.4070206@kievinfo.com>
Message-ID: <20080426222429.GJ5348@byleth.sc-networks.de>

On Sat, Apr 26, 2008 at 08:57:28AM -0600, Vitaliy Margolen wrote:

> Please use 4 spaces indentation, no tabs.

what happened to original author decides? ;)
i will run the uncopied parts through indent once i find the -unreadable
flag for it...

> > +		snprintf(buf, MAX_PATH, FMT_UHIDDEVS, i);
> > +		buf[MAX_PATH - 1] = 0;
> snprintf always writes terminating '\0' character at the end of the
> string.  You don't need to explicitly do that yourself.

ack

> > +		if ((fd = open(buf, O_RDWR | O_NDELAY, 0)) == -1) {
> > +			TRACE("Unable to open %s read/write: %s\n", buf, strerror(errno));
> > +			continue;
> > +		}
> Do you really have to open it read/write? Shouldn't read only be
> enough for not FF joystick?

i tested beforehand with usbhidctl - and it needed r/w for just getting
the state there. so i assumed it is needed. i will just try it out.

> The only way I can think of to remove code duplication is to create
> base joystick class. There were no reason for that with only 2
> joystick drivers.  With third one should really do it.

Four with an potential xinput implementation.

Some of the functions had subtle changes; but i guess they could be
unified. if there where no FF the interface would be quite small:

- find them
- (un)acquire
- poll

I can not think of stuff, that get/setProperty would really need a
special implementation for. A common JoyDev struct could hold all vital
data; we could keep a private area for the "driver" around.

But i guess I can go with the "release" before this changes. We can cope
with the dups later on.

so my next steps are:

- fix above mentioned problems
- test with a TM cougar (6 axes, 28 buttons)
- test more games (GPL, NR2003 - especially ones, that needed patches in
  the linux parts some time ago: IL2 and RBR)

i head for a "release" on monday - if there are no show stoppers ahead,
of course.

BTW: no complains about the autoconf additions?

-- 
cu
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 163 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080427/3189aed4/attachment.pgp 

From frick at sc-networks.de  Sat Apr 26 17:36:22 2008
From: frick at sc-networks.de (Christoph Frick)
Date: Sun, 27 Apr 2008 00:36:22 +0200
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <48137A56.9070505@kievinfo.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<558b2f5c0804261037k69bfa3ddp2262f927d6ca51ed@mail.gmail.com>
	<558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>
	<b6bb06270804261127q7341530bq8b5de5274e4ece61@mail.gmail.com>
	<48137A56.9070505@kievinfo.com>
Message-ID: <20080426223622.GK5348@byleth.sc-networks.de>

On Sat, Apr 26, 2008 at 12:54:14PM -0600, Vitaliy Margolen wrote:

> For anyone who wants more then 150 they can change that in the registry. 
> Honestly I've yet to see a single device with such a high DPI!

for the fun of it - i run wine at 144 it is one less than i need:

0:32 !1 ridcully at ofnir:~% grep DPI /var/log/Xorg.0.log
(--) NVIDIA(0): DPI set to (147, 145); computed from "UseEdidDpi" X
config

(15" notebook with 1920x1200)

-- 
cu
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 163 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080427/74011c00/attachment.pgp 

From dank at kegel.com  Sat Apr 26 18:22:37 2008
From: dank at kegel.com (Dan Kegel)
Date: Sat, 26 Apr 2008 16:22:37 -0700
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<558b2f5c0804261037k69bfa3ddp2262f927d6ca51ed@mail.gmail.com>
	<558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>
Message-ID: <a71bd89a0804261622t1eda6132l8d174e924e5c5ee4@mail.gmail.com>

On Sat, Apr 26, 2008 at 10:40 AM, Lei Zhang <thestig at google.com> wrote:
>  >  >  URL:    http://source.winehq.org/git/wine.git/?a=commit;h=faaccca59be08be547ec4e1948b6306eff3808a2
>  >  >
>  >  >  Author: Dan Kegel <dank at kegel.com>
>  >  >  Date:   Tue Apr 22 17:56:36 2008 -0700
>  >  >
>  >  >  winecfg: Restrict dpi slider to sane values.
>  >
>  >  Dan, this basically reverted commit
>  >  0110512904d9c646abef416819a057c06d3f2c97, which bumped MAXDPI from 160
>  >  to 480 because some users specifically requested the ability for
>  >  higher DPI settings.
>  >
>  >  I think we need to decide what we want and stop the tug-o-war.
>
>  Please see bug 9715.

480 was completely unusable; average Joes were setting it
at random and were unable to use winecfg to reset it to
something sane.

I found a few monitors out there at 200 dpi, so perhaps that would
be a reasonable upper limit, but we'd have to check to make sure that
the average person with a crap monitor could set that to 200dpi,
realize it was wrong, and set it back without having to edit
the registry by hand.
- Dan


From xixsimplicityxix at gmail.com  Sat Apr 26 18:58:53 2008
From: xixsimplicityxix at gmail.com (John Klehm)
Date: Sat, 26 Apr 2008 18:58:53 -0500
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <a71bd89a0804261622t1eda6132l8d174e924e5c5ee4@mail.gmail.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<558b2f5c0804261037k69bfa3ddp2262f927d6ca51ed@mail.gmail.com>
	<558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>
	<a71bd89a0804261622t1eda6132l8d174e924e5c5ee4@mail.gmail.com>
Message-ID: <78a7dad00804261658j30f097abt3cbc36995256788f@mail.gmail.com>

On Sat, Apr 26, 2008 at 6:22 PM, Dan Kegel <dank at kegel.com> wrote:
> On Sat, Apr 26, 2008 at 10:40 AM, Lei Zhang <thestig at google.com> wrote:
>  >  >  >  URL:    http://source.winehq.org/git/wine.git/?a=commit;h=faaccca59be08be547ec4e1948b6306eff3808a2
>  >  >  >
>  >  >  >  Author: Dan Kegel <dank at kegel.com>
>  >  >  >  Date:   Tue Apr 22 17:56:36 2008 -0700
>  >  >  >
>  >  >  >  winecfg: Restrict dpi slider to sane values.
>  >  >
>
> >  >  Dan, this basically reverted commit
>  >  >  0110512904d9c646abef416819a057c06d3f2c97, which bumped MAXDPI from 160
>  >  >  to 480 because some users specifically requested the ability for
>  >  >  higher DPI settings.
>  >  >
>  >  >  I think we need to decide what we want and stop the tug-o-war.
>  >
>  >  Please see bug 9715.
>
>  480 was completely unusable; average Joes were setting it
>  at random and were unable to use winecfg to reset it to
>  something sane.
>
>  I found a few monitors out there at 200 dpi, so perhaps that would
>  be a reasonable upper limit, but we'd have to check to make sure that
>  the average person with a crap monitor could set that to 200dpi,
>  realize it was wrong, and set it back without having to edit
>  the registry by hand.
>  - Dan
>
>
>

Why not wizardify it?  "Enter the physical size of your screen: x
in/cm y in/cm"  Then use appropriate dpi based on current resolution?
Does it not work like that?

--John


From wine-devel at kievinfo.com  Sat Apr 26 19:48:35 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sat, 26 Apr 2008 18:48:35 -0600
Subject: Side affects from running wineprefixcreate
Message-ID: <4813CD63.9020402@kievinfo.com>

So for one notable problems is some file types being reset by Wine. Looks 
like it comes from dlls/mshtml/mshtml.inf. At a minimum all the created 
registry entries should not overwrite already existing ones.


Vitaliy.


From chris.kcat at gmail.com  Sat Apr 26 19:55:04 2008
From: chris.kcat at gmail.com (Chris Robinson)
Date: Sat, 26 Apr 2008 17:55:04 -0700
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <78a7dad00804261658j30f097abt3cbc36995256788f@mail.gmail.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<a71bd89a0804261622t1eda6132l8d174e924e5c5ee4@mail.gmail.com>
	<78a7dad00804261658j30f097abt3cbc36995256788f@mail.gmail.com>
Message-ID: <200804261755.04596.chris.kcat@gmail.com>

On Saturday 26 April 2008 04:58:53 pm John Klehm wrote:
> On Sat, Apr 26, 2008 at 6:22 PM, Dan Kegel <dank at kegel.com> wrote:
> >  I found a few monitors out there at 200 dpi, so perhaps that would
> >  be a reasonable upper limit, but we'd have to check to make sure that
> >  the average person with a crap monitor could set that to 200dpi,
> >  realize it was wrong, and set it back without having to edit
> >  the registry by hand.
> >  - Dan
>
> Why not wizardify it?  "Enter the physical size of your screen: x
> in/cm y in/cm"  Then use appropriate dpi based on current resolution?
> Does it not work like that?

What about getting the value from X? Since Windows only expects one DPI for 
both vertical and horizontal, while X provides two, Wine could just take the 
mean and autoset that on startup.


From chris.kcat at gmail.com  Sat Apr 26 20:05:29 2008
From: chris.kcat at gmail.com (Chris Robinson)
Date: Sat, 26 Apr 2008 18:05:29 -0700
Subject: Side affects from running wineprefixcreate
In-Reply-To: <4813CD63.9020402@kievinfo.com>
References: <4813CD63.9020402@kievinfo.com>
Message-ID: <200804261805.29538.chris.kcat@gmail.com>

On Saturday 26 April 2008 05:48:35 pm Vitaliy Margolen wrote:
> At a minimum all the created
> registry entries should not overwrite already existing ones.

Doesn't that kind of defeat the purpose of having wineprefixcreate executed, 
which is to update the registry?

Not that I don't agree there could be a problem with just blindly overwriting. 
But blindly ignoring can be just as much of a problem.


From wine-devel at kievinfo.com  Sat Apr 26 20:14:06 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sat, 26 Apr 2008 19:14:06 -0600
Subject: Side affects from running wineprefixcreate
In-Reply-To: <200804261805.29538.chris.kcat@gmail.com>
References: <4813CD63.9020402@kievinfo.com>
	<200804261805.29538.chris.kcat@gmail.com>
Message-ID: <4813D35E.2010700@kievinfo.com>

Chris Robinson wrote:
> On Saturday 26 April 2008 05:48:35 pm Vitaliy Margolen wrote:
>> At a minimum all the created
>> registry entries should not overwrite already existing ones.
> 
> Doesn't that kind of defeat the purpose of having wineprefixcreate executed, 
> which is to update the registry?
> 
> Not that I don't agree there could be a problem with just blindly overwriting. 
> But blindly ignoring can be just as much of a problem.
> 

That's the problem of forcefully refreshing registry. If you don't do it - 
some old cruft will get in a way of new stiff. If you do - you removing 
perfectly good entries that user had there.

However things like file associations should not be overwritten. Especially 
that they don't work after that:

$ wine start image.jpg
wine: configuration in '/home/vitaliy/.wine' has been updated.
fixme:exec:SHELL_execute flags ignored: 0x00000500
Application could not be started, or no application associated with the 
specified file.
ShellExecuteEx failed: Success

Vitaliy.


From research at science.su  Sat Apr 26 21:54:41 2008
From: research at science.su (L. Rahyen)
Date: Sun, 27 Apr 2008 02:54:41 +0000
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <a71bd89a0804261622t1eda6132l8d174e924e5c5ee4@mail.gmail.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>
	<a71bd89a0804261622t1eda6132l8d174e924e5c5ee4@mail.gmail.com>
Message-ID: <200804270254.42050.research@science.su>

On Saturday April 26 2008 23:22:37 Dan Kegel wrote:
> On Sat, Apr 26, 2008 at 10:40 AM, Lei Zhang <thestig at google.com> wrote:
> >  >  >  URL:   
> >  >  > http://source.winehq.org/git/wine.git/?a=commit;h=faaccca59be08be54
> >  >  >7ec4e1948b6306eff3808a2
> >  >  >
> >  >  >  Author: Dan Kegel <dank at kegel.com>
> >  >  >  Date:   Tue Apr 22 17:56:36 2008 -0700
> >  >  >
> >  >  >  winecfg: Restrict dpi slider to sane values.
> >  >
> >  >  Dan, this basically reverted commit
> >  >  0110512904d9c646abef416819a057c06d3f2c97, which bumped MAXDPI from
> >  > 160 to 480 because some users specifically requested the ability for
> >  > higher DPI settings.
> >  >
> >  >  I think we need to decide what we want and stop the tug-o-war.
> >
> >  Please see bug 9715.
>
> 480 was completely unusable; average Joes were setting it
> at random and were unable to use winecfg to reset it to
> something sane.
>
> I found a few monitors out there at 200 dpi, so perhaps that would
> be a reasonable upper limit, but we'd have to check to make sure that
> the average person with a crap monitor could set that to 200dpi,
> realize it was wrong,
> - Dan

	200 DPI limit is acceptable for most users. However, what this patch done by 
setting maximum to this small value (144) doesn't seems to be acceptable. 
There is enough users who want higher values and BTW I'm one of them (I need 
150 and 160; I need two values because I have more than one monitor/computer).
	So if we want to set the maximum limit lower than on Windows we need to 
choose reasonable value for most of us. I propose that we agree on at least 
200 DPI limit in winecfg otherwise this puts too much inconvenience 
(especially for everyone who create new WINE prefix for new set of Windows 
programs, and this is what I do regularly).

> and set it back without having to edit the registry by hand.

	Just a note: in all WMs I have tried winecfg remains usable even on 480 DPI 
because you can move the window as usually with Alt+Mouse_move or 
Meta+Mouse_move, and you need to move the window only once to reset the 
setting to any other value.


From dank at kegel.com  Sat Apr 26 22:23:40 2008
From: dank at kegel.com (Dan Kegel)
Date: Sat, 26 Apr 2008 20:23:40 -0700
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <200804270254.42050.research@science.su>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>
	<a71bd89a0804261622t1eda6132l8d174e924e5c5ee4@mail.gmail.com>
	<200804270254.42050.research@science.su>
Message-ID: <a71bd89a0804262023t10db3f16xb336a1a5f8e6c80b@mail.gmail.com>

On Sat, Apr 26, 2008 at 7:54 PM, L. Rahyen <research at science.su> wrote:
>         200 DPI limit is acceptable for most users. However, what this patch done by
>  setting maximum to this small value (144) doesn't seems to be acceptable.

Users really are lost if they set a too-high value.
They don't know how to do alt+mouse_move.
Thus simply setting the limit higher again would
be a support nightmare; we got a preview of that
on wine-users recently, with user after user panicking.

But as I wrote in http://bugs.winehq.org/show_bug.cgi?id=9715
we can probably do something that will make everybody
happy: arrange for winecfg to never let the user set
dpi so high that winecfg is bigger than the screen.
That's probably pretty easy to do.

And we can probably make high-res users happier still
by defaulting to Xft.dpi (used by Gnome and maybe KDE;
it's set by default to 96, but is increased by some users
of high-res displays).

Anyone willing to try implementing that?  I'd do it, but I'm kind of
limited by sore hands and time these days...
- Dan


From research at science.su  Sun Apr 27 00:13:14 2008
From: research at science.su (L. Rahyen)
Date: Sun, 27 Apr 2008 05:13:14 +0000
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <a71bd89a0804262023t10db3f16xb336a1a5f8e6c80b@mail.gmail.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<200804270254.42050.research@science.su>
	<a71bd89a0804262023t10db3f16xb336a1a5f8e6c80b@mail.gmail.com>
Message-ID: <200804270513.15279.research@science.su>

On Sunday April 27 2008 03:23:40 Dan Kegel wrote:
> But as I wrote in http://bugs.winehq.org/show_bug.cgi?id=9715
> we can probably do something that will make everybody
> happy: arrange for winecfg to never let the user set
> dpi so high that winecfg is bigger than the screen.

	Yes, I think this would be better solution. This will probably will work well 
for everyone and will be much better than hard-coded limit.


From winehacker at gmail.com  Sun Apr 27 01:37:34 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Sun, 27 Apr 2008 02:37:34 -0400
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <19e31a080804261053p4ba91432ifa929c13663e4f@mail.gmail.com>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	<87r6cv8uh3.fsf@wine.dyndns.org>
	<19e31a080804240755o51963e61xebe17b174382fb88@mail.gmail.com>
	<871w4v8exd.fsf@wine.dyndns.org>
	<19e31a080804250850l360f0e13jc7cf7c28c2f1a961@mail.gmail.com>
	<a71bd89a0804251107j7cc4b33eya30f562af32ee0a@mail.gmail.com>
	<19e31a080804261053p4ba91432ifa929c13663e4f@mail.gmail.com>
Message-ID: <19e31a080804262337u75d0112dlb54ed540e52b3db8@mail.gmail.com>

On Sat, Apr 26, 2008 at 1:53 PM, Steven Edwards <winehacker at gmail.com> wrote:
>  >  * have start.exe set an environment variable saying "show graphical error box
>  >  on dll load failure", and clear that before calling executed apps' WinMain()
>  >  (easy)
>
>  So something like start.exe.so in Unix mode would set a variable like
>  VERSBOSE_USERDEBUG or which then we could query in the loader using
>  RtlQueryEnvironmentVariable_U or something that would trigger the
>  MessageBox from the example code I already wrote in ntdll?

So that worked. Comments are welcome!

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-Took-a-better-stab-at-reporting-when-a-dll-is-missin.patch
Type: text/x-patch
Size: 4025 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080427/22d069d3/attachment.bin 

From eric.pouech at orange.fr  Sun Apr 27 05:04:34 2008
From: eric.pouech at orange.fr (Eric Pouech)
Date: Sun, 27 Apr 2008 12:04:34 +0200
Subject: msvcrt: Remove two tests that fail on all platforms
In-Reply-To: <22821af30804231600w727fd37r27c60141eca27aaa@mail.gmail.com>
References: <22821af30804231600w727fd37r27c60141eca27aaa@mail.gmail.com>
Message-ID: <48144FB2.7000401@orange.fr>

James Hawkins a ?crit :
> Hi,
>
> Changelog
> * Remove two tests that fail on all platforms.
>
>  dlls/msvcrt/tests/cpp.c |    2 --
>  1 files changed, 0 insertions(+), 2 deletions(-)
>
>   
> ------------------------------------------------------------------------
>
>
the first one is actually bogus, I'll send a corrected test
however, the second seems ok (except some space difference)
can you post the failing test information ?
A+

-- 
Eric Pouech
"The problem with designing something completely foolproof is to underestimate the ingenuity of a complete idiot." (Douglas Adams)




From dmitry at codeweavers.com  Sun Apr 27 05:09:38 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sun, 27 Apr 2008 19:09:38 +0900
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com><558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com><a71bd89a0804261622t1eda6132l8d174e924e5c5ee4@mail.gmail.com><200804270254.42050.research@science.su>
	<a71bd89a0804262023t10db3f16xb336a1a5f8e6c80b@mail.gmail.com>
Message-ID: <00c001c8a84e$d1d6f460$a600fea9@DMITRY>

"Dan Kegel" <dank at kegel.com> wrote:

> On Sat, Apr 26, 2008 at 7:54 PM, L. Rahyen <research at science.su> wrote:
>>         200 DPI limit is acceptable for most users. However, what this patch done by
>>  setting maximum to this small value (144) doesn't seems to be acceptable.
> 
> Users really are lost if they set a too-high value.
> They don't know how to do alt+mouse_move.
> Thus simply setting the limit higher again would
> be a support nightmare; we got a preview of that
> on wine-users recently, with user after user panicking.
> 
> But as I wrote in http://bugs.winehq.org/show_bug.cgi?id=9715
> we can probably do something that will make everybody
> happy: arrange for winecfg to never let the user set
> dpi so high that winecfg is bigger than the screen.
> That's probably pretty easy to do.
> 
> And we can probably make high-res users happier still
> by defaulting to Xft.dpi (used by Gnome and maybe KDE;
> it's set by default to 96, but is increased by some users
> of high-res displays).
> 
> Anyone willing to try implementing that?  I'd do it, but I'm kind of
> limited by sore hands and time these days...

How about doing what Windows does - add a font preview to allow the user
to see an actual size of the font he/she will get after the change?

-- 
Dmitry.


From tijl at ulyssis.org  Sun Apr 27 07:31:00 2008
From: tijl at ulyssis.org (Tijl Coosemans)
Date: Sun, 27 Apr 2008 14:31:00 +0200
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <00c001c8a84e$d1d6f460$a600fea9@DMITRY>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<a71bd89a0804262023t10db3f16xb336a1a5f8e6c80b@mail.gmail.com>
	<00c001c8a84e$d1d6f460$a600fea9@DMITRY>
Message-ID: <200804271431.01718.tijl@ulyssis.org>

> "Dan Kegel" <dank at kegel.com> wrote:
>> On Sat, Apr 26, 2008 at 7:54 PM, L. Rahyen <research at science.su> wrote:
>>> 200 DPI limit is acceptable for most users. However, what this patch
>>> done by setting maximum to this small value (144) doesn't seems to
>>> be acceptable.
>> 
>> Users really are lost if they set a too-high value.
>> They don't know how to do alt+mouse_move.
>> Thus simply setting the limit higher again would
>> be a support nightmare; we got a preview of that
>> on wine-users recently, with user after user panicking.
>> 
>> But as I wrote in http://bugs.winehq.org/show_bug.cgi?id=9715
>> we can probably do something that will make everybody
>> happy: arrange for winecfg to never let the user set
>> dpi so high that winecfg is bigger than the screen.
>> That's probably pretty easy to do.
>> 
>> And we can probably make high-res users happier still
>> by defaulting to Xft.dpi (used by Gnome and maybe KDE;
>> it's set by default to 96, but is increased by some users
>> of high-res displays).

IMO the Mozilla page you linked to in the bug is the correct approach.
Users should set the DisplaySize setting in their X server
configuration (if it isn't detected automatically). And applications
should (by default) use the X server DPI calculated from that.
Applications overriding the X server DPI are bad when you start to
run them remotely.

If users want a graphical way of setting physical display size, then
that's a job for the desktop environments to provide some tools to
configure the local X server.

The only time Wine should have to worry about DPI is when running
apps that haven't been designed with high DPI in mind and therefore
don't scale well (for instance when font sizes are set in points and
other GUI elements are sized or positioned using pixels). But for those
apps it might be good enough to provide a simple checkbox that says
"override DPI to 96" or some other sensible default value. I don't know
if there actually are such apps.


From dmitry at codeweavers.com  Sun Apr 27 07:22:57 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sun, 27 Apr 2008 21:22:57 +0900
Subject: wine.inf.in: use lowercase for Microsoft Video 1
References: <f5d9424f0804270454r6bd2ee39w95ebf5ea7b36aaab@mail.gmail.com>
Message-ID: <007001c8a861$6f5a92c0$a600fea9@DMITRY>

"Jeff Zaroyko" <jeffzaroyko at gmail.com> wrote:

>  system.ini, drivers32,,"vidc.MRLE=msrle32.dll" 
> -system.ini, drivers32,,"vidc.MSVC=msvidc32.dll" 
> +system.ini, drivers32,,"vidc.msvc=msvidc32.dll" 
>  system.ini, drivers32,,"vidc.CVID=iccvid.dll" 
>  system.ini, drivers32,,"; vidc.IV50=ir50_32.dll" 
>  system.ini, drivers32,,"; vidc.IV31=ir32_32.dll"

MRLE and CVID are also in lower case in XP, so they should be fixed too
(as well as removed trailing spaces in many entries in [SystemIni] section).

-- 
Dmitry.


From jeffzaroyko at gmail.com  Sun Apr 27 07:52:13 2008
From: jeffzaroyko at gmail.com (Jeff Zaroyko)
Date: Sun, 27 Apr 2008 22:52:13 +1000
Subject: wine.inf.in: use lowercase for Microsoft Video 1
In-Reply-To: <007001c8a861$6f5a92c0$a600fea9@DMITRY>
References: <f5d9424f0804270454r6bd2ee39w95ebf5ea7b36aaab@mail.gmail.com>
	<007001c8a861$6f5a92c0$a600fea9@DMITRY>
Message-ID: <f5d9424f0804270552v581eb8b4w859cce38b9cc55c7@mail.gmail.com>

On Sun, Apr 27, 2008 at 10:22 PM, Dmitry Timoshkov
<dmitry at codeweavers.com> wrote:
> "Jeff Zaroyko" <jeffzaroyko at gmail.com> wrote:
>
>
> >  system.ini, drivers32,,"vidc.MRLE=msrle32.dll" -system.ini,
> drivers32,,"vidc.MSVC=msvidc32.dll" +system.ini,
> drivers32,,"vidc.msvc=msvidc32.dll"  system.ini,
> drivers32,,"vidc.CVID=iccvid.dll"  system.ini, drivers32,,";
> vidc.IV50=ir50_32.dll"  system.ini, drivers32,,"; vidc.IV31=ir32_32.dll"
> >
>
>  MRLE and CVID are also in lower case in XP, so they should be fixed too
>  (as well as removed trailing spaces in many entries in [SystemIni]
> section).
>
>  --
>  Dmitry.
>

If I should make these changes and resubmit, what about MSACM entries?
  I see that they are also lower case on XP.


From dank at kegel.com  Sun Apr 27 08:19:34 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 27 Apr 2008 06:19:34 -0700
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <19e31a080804262337u75d0112dlb54ed540e52b3db8@mail.gmail.com>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	<87r6cv8uh3.fsf@wine.dyndns.org>
	<19e31a080804240755o51963e61xebe17b174382fb88@mail.gmail.com>
	<871w4v8exd.fsf@wine.dyndns.org>
	<19e31a080804250850l360f0e13jc7cf7c28c2f1a961@mail.gmail.com>
	<a71bd89a0804251107j7cc4b33eya30f562af32ee0a@mail.gmail.com>
	<19e31a080804261053p4ba91432ifa929c13663e4f@mail.gmail.com>
	<19e31a080804262337u75d0112dlb54ed540e52b3db8@mail.gmail.com>
Message-ID: <a71bd89a0804270619r703bb40djf7d5767f1fccadb3@mail.gmail.com>

On Sat, Apr 26, 2008 at 11:37 PM, Steven Edwards <winehacker at gmail.com> wrote:
>>  * have start.exe set an environment variable saying "show
graphical error box
>>  on dll load failure", and clear that before calling executed apps' WinMain()
>
>  So that worked. Comments are welcome!

1. I'd output the console message before the gui one.

2. You never clear that environment variable... what happens
when an app just tests for the existence of a DLL by
trying to load it?  We don't want to print an error then.
(That's why I originally suggested clearing the env var
after the app finished loading.  That's still broken -- it
won't catch errors in helper exes -- but it's better than nothing.)


From dmitry at codeweavers.com  Sun Apr 27 07:43:32 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sun, 27 Apr 2008 21:43:32 +0900
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com><a71bd89a0804262023t10db3f16xb336a1a5f8e6c80b@mail.gmail.com><00c001c8a84e$d1d6f460$a600fea9@DMITRY>
	<200804271431.01718.tijl@ulyssis.org>
Message-ID: <008f01c8a864$4ecfdb20$a600fea9@DMITRY>

"Tijl Coosemans" <tijl at ulyssis.org> wrote:

> If users want a graphical way of setting physical display size, then
> that's a job for the desktop environments to provide some tools to
> configure the local X server.

Same applies to many other settings like fonts and colors. Wine uses
the DPI setting only as a way to scale fonts, not as a general size
scaler.

> The only time Wine should have to worry about DPI is when running
> apps that haven't been designed with high DPI in mind and therefore
> don't scale well (for instance when font sizes are set in points and
> other GUI elements are sized or positioned using pixels). But for those
> apps it might be good enough to provide a simple checkbox that says
> "override DPI to 96" or some other sensible default value. I don't know
> if there actually are such apps.

Such apps would break in Windows as well, Win32 uses logical units for its
GUI elements, not pixels.

Besides, even Windows does go that far as forbidding large DPI values, but
Windows makes it clear what a user will get using a font preview window.

-- 
Dmitry.


From dank at kegel.com  Sun Apr 27 08:35:06 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 27 Apr 2008 06:35:06 -0700
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <00c001c8a84e$d1d6f460$a600fea9@DMITRY>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>
	<a71bd89a0804261622t1eda6132l8d174e924e5c5ee4@mail.gmail.com>
	<200804270254.42050.research@science.su>
	<a71bd89a0804262023t10db3f16xb336a1a5f8e6c80b@mail.gmail.com>
	<00c001c8a84e$d1d6f460$a600fea9@DMITRY>
Message-ID: <a71bd89a0804270635j6e28470cm27a5a18d1d0256de@mail.gmail.com>

Dmitry Timoshkov <dmitry at codeweavers.com> wrote:
>  How about doing what Windows does - add a font preview to allow the user
>  to see an actual size of the font he/she will get after the change?

Yeah, that would be great.  We did something like that
in the Picasa for Linux font settings tool.  Nigel said
it was a real pain, though.  I think it's much harder
than it looks, not something we can do for 1.0.

The cheezy hack I suggested should be easily doable
by Friday, though.  Hint, hint.


From tijl at ulyssis.org  Sun Apr 27 09:58:28 2008
From: tijl at ulyssis.org (Tijl Coosemans)
Date: Sun, 27 Apr 2008 16:58:28 +0200
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <008f01c8a864$4ecfdb20$a600fea9@DMITRY>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<200804271431.01718.tijl@ulyssis.org>
	<008f01c8a864$4ecfdb20$a600fea9@DMITRY>
Message-ID: <200804271658.30462.tijl@ulyssis.org>

On Sunday 27 April 2008 14:43:32 Dmitry Timoshkov wrote:
> "Tijl Coosemans" <tijl at ulyssis.org> wrote:
>> If users want a graphical way of setting physical display size, then
>> that's a job for the desktop environments to provide some tools to
>> configure the local X server.
> 
> Same applies to many other settings like fonts and colors. Wine uses
> the DPI setting only as a way to scale fonts, not as a general size
> scaler.

No, fonts and colors aren't server side settings. DPI is.

>> The only time Wine should have to worry about DPI is when running
>> apps that haven't been designed with high DPI in mind and therefore
>> don't scale well (for instance when font sizes are set in points and
>> other GUI elements are sized or positioned using pixels). But for
>> those apps it might be good enough to provide a simple checkbox that
>> says "override DPI to 96" or some other sensible default value. I
>> don't know if there actually are such apps.
> 
> Such apps would break in Windows as well, Win32 uses logical units
> for its GUI elements, not pixels.

Ah, that's good to know. Then why not get rid of that slider all
together? DPI settings are not a Wine issue and should not be solved
by Wine.


From dank at kegel.com  Sun Apr 27 10:52:10 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 27 Apr 2008 08:52:10 -0700
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <200804271658.30462.tijl@ulyssis.org>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<200804271431.01718.tijl@ulyssis.org>
	<008f01c8a864$4ecfdb20$a600fea9@DMITRY>
	<200804271658.30462.tijl@ulyssis.org>
Message-ID: <a71bd89a0804270852n50ad789cv95cb96f05cc9a431@mail.gmail.com>

On Sun, Apr 27, 2008 at 7:58 AM, Tijl Coosemans <tijl at ulyssis.org> wrote:
>  >> The only time Wine should have to worry about DPI is when running
>  >> apps that haven't been designed with high DPI in mind and therefore
>  >> don't scale well (for instance when font sizes are set in points and
>  >> other GUI elements are sized or positioned using pixels). But for
>  >> those apps it might be good enough to provide a simple checkbox that
>  >> says "override DPI to 96" or some other sensible default value. I
>  >> don't know if there actually are such apps.
>  >
>  > Such apps would break in Windows as well, Win32 uses logical units
>  > for its GUI elements, not pixels.
>
>  Ah, that's good to know. Then why not get rid of that slider all
>  together? DPI settings are not a Wine issue and should not be solved
>  by Wine.

Because DPI settings are kind of broken all over.
We need a way to override things for Wine for the moment until
e.g. X can autodetect monitor DPI reliably.

But we should see if paying attention to Xft.dpi (itself a similar
override that should go away) improves user experience.
- Dan


From wine-devel at kievinfo.com  Sun Apr 27 14:14:43 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sun, 27 Apr 2008 13:14:43 -0600
Subject: [dinput] initial support for BSD's usbhid joysticks
In-Reply-To: <20080427175824.GL5348@byleth.sc-networks.de>
References: <20080427175824.GL5348@byleth.sc-networks.de>
Message-ID: <4814D0A3.8030106@kievinfo.com>

Christoph Frick wrote:
> Add dinput support for BSD's usbhid joysticks
> 
> +	if (have_joy_devs == 0) {
> +	    joy_devs = HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, sizeof(struct JoyDev));
> +	} else {
> +	    HeapReAlloc(GetProcessHeap(), 0, joy_devs, (1 + have_joy_devs) * sizeof(struct JoyDev));
> +	}
> +	joy_devs[have_joy_devs++] = joydev;
> +
> +	hid_dispose_report_desc(rdesc);
> +	close(fd);
> +    }
> +}

This is ugly! Curly brackets should go on the separate line. And I asked no 
tabs please!

And again you copied all the code - I'm against this. All the duplicate code 
should go into the new joystick base class. No reason to rewrite code if it 
can be written right the first time around.


Vitaliy.


From wine-devel at kievinfo.com  Sun Apr 27 14:21:22 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sun, 27 Apr 2008 13:21:22 -0600
Subject: wined3d: Fix dead-loop condition with default setup.
In-Reply-To: <4814ACA3.4050001@kievinfo.com>
References: <4814ACA3.4050001@kievinfo.com>
Message-ID: <4814D232.3090802@kievinfo.com>

Vitaliy Margolen wrote:
> As discussed in bug 11584 this Preload is wrong and should be removed.
> ---
>  dlls/wined3d/context.c |    7 -------
>  1 files changed, 0 insertions(+), 7 deletions(-)
> 
> 
BTW this is still not enough to fix all the problems. There are few more 
preloads that make Psychonauts crash. So I think that whole idea of using 
preload in the context switch is not right. Or activating context in texture 
pre-loading is wrong.

Can some one familiar with this code take a closer look? This is basic 
functionality that should be working in 1.0

Vitaliy.


From thunderbird2k at gmx.net  Sun Apr 27 15:16:38 2008
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Sun, 27 Apr 2008 22:16:38 +0200
Subject: wined3d: Fix dead-loop condition with default setup.
In-Reply-To: <4814D232.3090802@kievinfo.com>
References: <4814ACA3.4050001@kievinfo.com> <4814D232.3090802@kievinfo.com>
Message-ID: <20080427201638.62340@gmx.net>

> Vitaliy Margolen wrote:
> > As discussed in bug 11584 this Preload is wrong and should be removed.
> > ---
> >  dlls/wined3d/context.c |    7 -------
> >  1 files changed, 0 insertions(+), 7 deletions(-)
> > 
> > 
> BTW this is still not enough to fix all the problems. There are few more 
> preloads that make Psychonauts crash. So I think that whole idea of using 
> preload in the context switch is not right. Or activating context in
> texture 
> pre-loading is wrong.
> 
> Can some one familiar with this code take a closer look? This is basic 
> functionality that should be working in 1.0
> 
> Vitaliy.
> 

The whole surface / texture code is quite tricky because of various reasons. First of I have the feeling various parts are still NIH and old (and perhaps not doing what it was originally intended for0. Another big source of troubles is that a bunch of different GL extensions are used (FBO, PBO, texture rectangle ..) in order to achieve certain effects or to improve performance. This causes various games to behave differently on different cards and because drivers aren't bug free, you can have different bugs while the same GL extensions are offered. All in all a hell.

I haven't dealt with much of the code recently but I tried to move common functionality in small functions to make the code more readable and easier to maintain.

Just removing preloads and so isn't an option I think. I think the best thing would be to carefully review the code and to see what a function should be doing and make the code easier and better. Right now what is a fix for game 1 is a regression for game 2. I have seen this a couple of times right now where I fixed some large bugs but which exposed other issues.

The main issue right now is that the code freeze is near and this really isn't anything trivial and you can't write test cases for it. Perhaps native wined3d test apps could be employed but as I said there are dozens of different codepaths which can be entered due to differences in GL features.

Regards,
Roderick



-- 
Psst! Geheimtipp: Online Games kostenlos spielen bei den GMX Free Games! 
http://games.entertainment.gmx.net/de/entertainment/games/free


From anssi.hannula at gmail.com  Sun Apr 27 15:02:41 2008
From: anssi.hannula at gmail.com (Anssi Hannula)
Date: Sun, 27 Apr 2008 23:02:41 +0300
Subject: Wine64?
In-Reply-To: <20080422060446.42360@gmx.net>
References: <20080421171603.8ea1aa71.mle+win@mega-nerd.com>	<b130c85e0804211457w78c0c5a5n92538f1ac9cda630@mail.gmail.com>
	<20080422060446.42360@gmx.net>
Message-ID: <4814DBE1.3030807@gmail.com>

Roderick Colenbrander wrote:
> Maarten wrote:
>> A lot of the lowest level stuff is currently missing. If you don't
>> mind x64 assembly it's not impossible to do. We would need support
>> from gcc for the windows calling convention, and making it possible to
>> mix linux calling convention with windows calling convention. If you
>> are up to it just make it ignore the error for now, even if it causes
>> errors. A proof of concept "Hello, world!" would be a great
>> accomplishment at this point.
>>
> These days there is a 64bit version of mingw (mingw64 or so it is called).
> They must have patches to add the calling convention to gcc now. I'm not
> sure what the status is on merging the changes back but I think nothing
> forbids you from building gcc from their sources. I have no idea whether
> having the calling convention is enough for Wine.

The changes have been applied to gcc trunk, about a year ago IIRC.

Regarding mixing conventions, I had the following discussion with the
developer who implemented the convention in gcc (I didn't pursue the
matter further, though):

Kai Tietz wrote:
> Anssi Hannula <anssi.hannula at gmail.com> wrote on 26.05.2007 13:03:38:
> 
>> However, as the Wine project needs to support running win64 binaries on 
>> x86_64 Linux platforms, we need to able to specify MS ABI in 
>> per-function basis as we call linux functions as well.
>> 
>> I.e. we'd need something like __attribute__(__msvccall__) to specify the 
>> functions that need to have MS ABI calling convention, even when the gcc 
>> target is not x86_64 mingw.
>>
>> Do you think this is possible and/or if it would hard to implement?
> 
> This shouldn't be very hard to do. In i386.c, where the ABI specific 
> calling conventions are done, it can be introduced easily by using an 
> attribute modifier to choose between the different calling conventions 
> AFAICS.



-- 
Anssi Hannula


From stefandoesinger at gmx.at  Sun Apr 27 16:39:29 2008
From: stefandoesinger at gmx.at (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sun, 27 Apr 2008 23:39:29 +0200
Subject: wined3d: Fix dead-loop condition with default setup.
In-Reply-To: <4814D232.3090802@kievinfo.com>
References: <4814ACA3.4050001@kievinfo.com> <4814D232.3090802@kievinfo.com>
Message-ID: <200804272339.29984.stefandoesinger@gmx.at>

Am Sonntag, 27. April 2008 21:21:22 schrieb Vitaliy Margolen:
> Vitaliy Margolen wrote:
> > As discussed in bug 11584 this Preload is wrong and should be removed.
> > ---
> >  dlls/wined3d/context.c |    7 -------
> >  1 files changed, 0 insertions(+), 7 deletions(-)
This patch almost certainly correct, but I think it shouldn't be applied 
without further investigation. There was a reason I added this PreLoad 
call(prior to multithreading support, and this issue occurs with 
multithreading), and I am not sure if we can remove it yet. Unfortunately my 
time is a bit limited currently.

Essentially, we have to call PreLoad(or well: GL calls to read the GL drawable 
into the surface's GL texture) because the old rendertarget surface looses 
control over the drawable and a new surface may change the GL drawable's 
contents.

We have to call ActivateContext in PreLoad because the readback code needs a 
GL context to work. The GL state should be correctly set up in a single 
threaded environment, but in case of multithreading there might be no 
context.

Both those issues are comparably easy to solve on their own. Issues now occur 
when the render target and thread are switched at the same time. In this 
case, we have to activate a context with the *old* drawable in the *new* 
thread, read back, and then activate the new drawable in the new thread.

The PreLoad call you're removing here is obviously flawed. It results in a 
readback attempt needlessly on a thread switch while offscreen rendering. We 
don't have to read back on a thread change, only on a render target change. 
Since lastActiveThread is set after the FindContext call(this is OK), it will 
infinitly recurse. This PreLoad call also shouldn't be needed, but there may 
be other bugs which require this call(It's aim is to create the texture).

The other PreLoad call is OK. I think it should be protected with a check if 
the render target is changed to prevent readback on a pure thread change. In 
this case, the above target-and-thread change will automagically solve itself

1) ActivateContext is called for a new render target and thread
2) FindContext sees the RT change. It calls PreLoad
3) PreLoad calls activatecontext on the new thread and old target
4) The recursed activateContext detects a thread only change. No PreLoad 
called this time. The old target is activated for readback in the new thread
5) LoadLocation performs the GL readback
6) PreLoad returns
7) ActivateContext continues to activate the new RT in the new thread

An issue is that this will be a rather implicit solution which is hard to see 
and tricky to verify. We still recurse, but the recursion limits itself and 
solves the problem.

A few test case suggestions:
*) Render onscreen, switch thread, switch thread back
*) Create an offscreen target, PreLoad it, render to it
*) Same as above, without the PreLoad
*) Create an offscreen target, render to it, switch thread(render there again)
*) Create an offscreen target, PreLoad, switch thread while switching RT
*) Same as above, without the PreLoad

The "render to it" could be just a Clear() call. However, the texture's 
contents should be checked, so that testing would be part of the visual test. 
Another trouble is that multithreading causes major pain with fglrx(fix seems 
to be on the way) and Mesa. So adding this to our testsuite at this point 
might upset many people who run make test by hard crashing their systems.


From rob at codeweavers.com  Sun Apr 27 17:02:29 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Sun, 27 Apr 2008 23:02:29 +0100
Subject: [PATCH 6/7] widl: Accept integer constant suffixes in the lexer.
In-Reply-To: <20080426180055.GR11580@linux.ucla.edu>
References: <4812ED2E.7040602@codeweavers.com>
	<20080426180055.GR11580@linux.ucla.edu>
Message-ID: <4814F7F5.2010206@codeweavers.com>

Dan Hipschman wrote:
> On Sat, Apr 26, 2008 at 09:51:58AM +0100, Robert Shearman wrote:
>   
>> +u_suffix	(l|L)
>> +l_suffix	(u|U)
>>     
>
> I'm guessing you meant for these to be the other way around.
>   

Good spot, thanks!

-- 
Rob Shearman



From truiken at gmail.com  Sun Apr 27 17:25:28 2008
From: truiken at gmail.com (James Hawkins)
Date: Sun, 27 Apr 2008 17:25:28 -0500
Subject: msvcrt: Remove two tests that fail on all platforms
In-Reply-To: <48144FB2.7000401@orange.fr>
References: <22821af30804231600w727fd37r27c60141eca27aaa@mail.gmail.com>
	<48144FB2.7000401@orange.fr>
Message-ID: <22821af30804271525i25c8de1cga8d9a8db8bfee3d4@mail.gmail.com>

On Sun, Apr 27, 2008 at 5:04 AM, Eric Pouech <eric.pouech at orange.fr> wrote:
> James Hawkins a ?crit :
>
>
> > Hi,
>  >
>  > Changelog
>  > * Remove two tests that fail on all platforms.
>  >
>  >  dlls/msvcrt/tests/cpp.c |    2 --
>  >  1 files changed, 0 insertions(+), 2 deletions(-)
>  >
>  >
>  > ------------------------------------------------------------------------
>  >
>  >
>  the first one is actually bogus, I'll send a corrected test
>  however, the second seems ok (except some space difference)
>  can you post the failing test information ?
>  A+
>

cpp.c:995: Test failed: Got name "?$AAA@$D?4@" for 108
cpp.c:997: Test failed: Expected "AAA<`template-parameter-5'>"
cpp.c:995: Test failed: Got name "private: static class bar *
__stdcall foo::bb::bar::ccccc<class aaa *>(class bar *,class ee
*,unsigned int,class aaa * *,class ee *)" for 110
cpp.c:997: Test failed: Expected "private: static class bar *
__stdcall foo::bb::bar::ccccc<class aaa *>(class bar *,class ee
*,unsigned int,class aaa **,class ee *)"
cpp: 377 tests executed (0 marked as todo, 4 failures), 0 skipped.

Do you need more than this?

http://test.winehq.org/data/200804252248/2003_hl-win2k3-vm/msvcrt:cpp.txt

-- 
James Hawkins


From astrand at cendio.se  Mon Apr 28 01:59:14 2008
From: astrand at cendio.se (=?UTF-8?Q?Peter_=C3=85strand?=)
Date: Mon, 28 Apr 2008 08:59:14 +0200 (CEST)
Subject: winmm/tests: waveOutGetDevCaps called with invalid size
In-Reply-To: <Pine.LNX.4.64.0804232120070.26015@maggie.lkpg.cendio.se>
References: <Pine.LNX.4.64.0804181102080.23847@maggie.lkpg.cendio.se>
	<4808B145.2010609@earthlink.net>
	<Pine.LNX.4.64.0804211050260.12791@maggie.lkpg.cendio.se>
	<480D12B1.3070309@earthlink.net>
	<Pine.LNX.4.64.0804220842440.29058@maggie.lkpg.cendio.se>
	<480DC438.7010107@earthlink.net>
	<Pine.LNX.4.64.0804230822450.15637@maggie.lkpg.cendio.se>
	<480F119D.5050107@earthlink.net>
	<Pine.LNX.4.64.0804232120070.26015@maggie.lkpg.cendio.se>
Message-ID: <Pine.LNX.4.64.0804280852530.9581@maggie.lkpg.cendio.se>

> > And what is the error?  If you know the error code returned, Ill add it 
> > to the code so we can end this discussion.
> 
> The error is MMSYSERR_INVALPARAM. 

I can see that this patch has now been committed:

--- wine/dlls/winmm/tests/wave.c:1.67   Fri Feb 29 06:18:36 2008
+++ wine/dlls/winmm/tests/wave.c        Fri Apr 25 08:12:48 2008
@@ -854,9 +854,9 @@
     }

     rc=waveOutGetDevCapsA(device,&capsA,4);
-    ok(rc==MMSYSERR_NOERROR,
-       "waveOutGetDevCapsA(%s): MMSYSERR_NOERROR expected, got %s\n",
-       dev_name(device),wave_out_error(rc));
+    ok(rc==MMSYSERR_NOERROR || rc==MMSYSERR_INVALPARAM,
+       "waveOutGetDevCapsA(%s): MMSYSERR_NOERROR or MMSYSERR_INVALPARAM "
+       "expected, got %s\n", dev_name(device),wave_out_error(rc));


However, the waveOutGetDevCapsW fails as well on WTS, also returning 
MMSYSERR_INVALPARAM. 

We could add MMSYSERR_INVALPARAM as a valid return code, but again, if we 
accept both success and a bunch of failures, the test makes very little 
sense. 

Here's a patch that completely removes the odd tests:

--- wave.c      25 Apr 2008 13:12:48 -0000      1.68
+++ wave.c      28 Apr 2008 06:57:07 -0000
@@ -853,16 +853,6 @@
        "expected, got %s\n",dev_name(device),wave_out_error(rc));
     }

-    rc=waveOutGetDevCapsA(device,&capsA,4);
-    ok(rc==MMSYSERR_NOERROR || rc==MMSYSERR_INVALPARAM,
-       "waveOutGetDevCapsA(%s): MMSYSERR_NOERROR or MMSYSERR_INVALPARAM "
-       "expected, got %s\n", dev_name(device),wave_out_error(rc));
-
-    rc=waveOutGetDevCapsW(device,&capsW,4);
-    ok(rc==MMSYSERR_NOERROR || rc==MMSYSERR_NOTSUPPORTED,
-       "waveOutGetDevCapsW(%s): MMSYSERR_NOERROR or MMSYSERR_NOTSUPPORTED 
"
-       "expected, got %s\n",dev_name(device),wave_out_error(rc));
-
     nameA=NULL;
     rc=waveOutMessage((HWAVEOUT)device, DRV_QUERYDEVICEINTERFACESIZE,
                       (DWORD_PTR)&size, 0);


Here's a patch that adds MMSYSERR_INVALPARAM as accepted return code:

--- wave.c      25 Apr 2008 13:12:48 -0000      1.68
+++ wave.c      28 Apr 2008 06:58:14 -0000
@@ -859,8 +859,8 @@
        "expected, got %s\n", dev_name(device),wave_out_error(rc));

     rc=waveOutGetDevCapsW(device,&capsW,4);
-    ok(rc==MMSYSERR_NOERROR || rc==MMSYSERR_NOTSUPPORTED,
-       "waveOutGetDevCapsW(%s): MMSYSERR_NOERROR or MMSYSERR_NOTSUPPORTED 
"
+    ok(rc==MMSYSERR_NOERROR || rc==MMSYSERR_NOTSUPPORTED || rc==MMSYSERR_INVALPARAM,
+       "waveOutGetDevCapsW(%s): MMSYSERR_NOERROR or MMSYSERR_NOTSUPPORTED or MMSYSERR_INVALPARAM "
        "expected, got %s\n",dev_name(device),wave_out_error(rc));

     nameA=NULL;

Rgds, 
---
Peter ?strand		ThinLinc Chief Developer
Cendio AB		http://www.cendio.se
Wallenbergs gata 4
583 30 Link?ping	Phone: +46-13-21 46 00

From winehacker at gmail.com  Mon Apr 28 02:51:43 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Mon, 28 Apr 2008 03:51:43 -0400
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <a71bd89a0804270619r703bb40djf7d5767f1fccadb3@mail.gmail.com>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	<87r6cv8uh3.fsf@wine.dyndns.org>
	<19e31a080804240755o51963e61xebe17b174382fb88@mail.gmail.com>
	<871w4v8exd.fsf@wine.dyndns.org>
	<19e31a080804250850l360f0e13jc7cf7c28c2f1a961@mail.gmail.com>
	<a71bd89a0804251107j7cc4b33eya30f562af32ee0a@mail.gmail.com>
	<19e31a080804261053p4ba91432ifa929c13663e4f@mail.gmail.com>
	<19e31a080804262337u75d0112dlb54ed540e52b3db8@mail.gmail.com>
	<a71bd89a0804270619r703bb40djf7d5767f1fccadb3@mail.gmail.com>
Message-ID: <19e31a080804280051q308775dek7e999fc1fa645f@mail.gmail.com>

On Sun, Apr 27, 2008 at 9:19 AM, Dan Kegel <dank at kegel.com> wrote:
>  2. You never clear that environment variable... what happens
>  when an app just tests for the existence of a DLL by
>  trying to load it?  We don't want to print an error then.
>  (That's why I originally suggested clearing the env var
>  after the app finished loading.  That's still broken -- it
>  won't catch errors in helper exes -- but it's better than nothing.)

I assume you mean if the application is just checking manually for the
dll via GetModuleHandle or LoadLibrary? I'll write a test case for
this to see if it causes a problem. My assumption was that the failure
case for that was at a higher level but I'll check with a test case. I
don't think we need to clear the variable....what I mean is I wonder
if there is a way to set the variable to be inherited by all child
processes launched by start.exe.so in unix mode. I'll look in to this
as well.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


