From dmitry at codeweavers.com  Tue Apr  1 00:11:14 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Tue, 1 Apr 2008 14:11:14 +0900
Subject: user32: Implement GetWindowModuleFileName with tests (try 2)
References: <b130c85e0802121730m16fd0baej12eb451172d2add@mail.gmail.com>
	<87r6feeboe.fsf@wine.dyndns.org>
Message-ID: <00da01c893b6$d1f73830$a600fea9@DMITRY>

"Alexandre Julliard" <julliard at winehq.org> wrote:

> "Maarten Lankhorst" <m.b.lankhorst at gmail.com> writes:
> 
>> @@ -3121,9 +3133,21 @@ UINT WINAPI GetWindowModuleFileNameA( HWND hwnd, LPSTR lpszFileName, UINT cchFil
>>   */
>>  UINT WINAPI GetWindowModuleFileNameW( HWND hwnd, LPWSTR lpszFileName, UINT cchFileNameMax)
>>  {
>> -    FIXME("GetWindowModuleFileNameW(hwnd %p, lpszFileName %p, cchFileNameMax %u) stub!\n",
>> -          hwnd, lpszFileName, cchFileNameMax);
>> -    return 0;
>> +    HINSTANCE hInst;
>> +    UINT ret;
>> +    TRACE("hwnd %p, lpszFileName %p, cchFileNameMax %u\n", hwnd, lpszFileName, cchFileNameMax);
>> +
>> +    hInst = (HINSTANCE)GetWindowLongPtrW(hwnd, GWLP_HINSTANCE);
>> +    if (!hInst)
>> +    {
>> +        if (hwnd == GetDesktopWindow() || !IsWindow(hwnd))
>> +            return 0;
>> +        hInst = GetModuleHandleW(0);
>> +    }
>> +
>> +    ret = GetModuleFileNameW(hInst, lpszFileName, cchFileNameMax);
>> +    TRACE("--> %d %s\n", ret, debugstr_wn(lpszFileName, ret));
>> +    return ret;
> 
> This won't work across processes.

Looks like GetWindowModuleFileName is not supposed to work for other
process windows, at least in the following snippet both GetWindowLongPtr
and GetWindowModuleFileName return 0 but don't change the last error value
under XP although FindWindow returns a valid window handle:

hwnd = FindWindow("Shell_TrayWnd", NULL);
SetLastError(0xdeadbeef);
ret = GetWindowModuleFileNameA(hwnd, buf, sizeof(buf));
printf("hwnd %p, ret %u, buf \"%s\", error %u\n", hwnd, ret, buf, GetLastError());

SetLastError(0xdeadbeef);
hinst = (HINSTANCE)GetWindowLongPtr(hwnd, GWLP_HINSTANCE);
printf("hwnd %p, hinst %u, error %u\n", hwnd, ret, GetLastError());

GetWindowLong(hwnd, GWL_STYLE) returns a valid style. Both APIs behave the same
way for the desktop window.

So the above implementation of GetWindowModuleFileName looks correct except
a special case for the desktop window (GetWindowLong() should be fixed instead).

-- 
Dmitry.


From dmitry at codeweavers.com  Tue Apr  1 00:31:45 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Tue, 1 Apr 2008 14:31:45 +0900
Subject: user32: Implement GetWindowModuleFileName with tests (try 2)
References: <b130c85e0802121730m16fd0baej12eb451172d2add@mail.gmail.com><87r6feeboe.fsf@wine.dyndns.org>
	<00da01c893b6$d1f73830$a600fea9@DMITRY>
Message-ID: <015301c893b9$aeeab7b0$a600fea9@DMITRY>

"Dmitry Timoshkov" <dmitry at codeweavers.com> wrote:

>> This won't work across processes.
> 
> Looks like GetWindowModuleFileName is not supposed to work for other
> process windows, at least in the following snippet both GetWindowLongPtr
> and GetWindowModuleFileName return 0 but don't change the last error value
> under XP although FindWindow returns a valid window handle:

AF in the bug 10002 pointed out to http://support.microsoft.com/kb/228469
which explains that.

-- 
Dmitry.


From truiken at gmail.com  Tue Apr  1 01:58:34 2008
From: truiken at gmail.com (James Hawkins)
Date: Tue, 1 Apr 2008 01:58:34 -0500
Subject: Greek translation patch correction
In-Reply-To: <b432a8110803311521y1e606fa1wfcaa0e5e35bcf3a7@mail.gmail.com>
References: <b432a8110803311521y1e606fa1wfcaa0e5e35bcf3a7@mail.gmail.com>
Message-ID: <22821af30803312358o1fe1ca4bvf3a420bec18ce280@mail.gmail.com>

2008/3/31 Dj Apal [GR] <djapal at gmail.com>:
> Here are the separate patches as requested by James Hawkins
>

One patch per email.  I see that's not on the sending_patches
page...man our documentation is in such bad shape (and scattered all
over the place).

-- 
James Hawkins


From paul.vriens.wine at gmail.com  Tue Apr  1 02:37:48 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Tue, 01 Apr 2008 09:37:48 +0200
Subject: Wine Release Plan
Message-ID: <47F1E64C.4020909@gmail.com>

Hi,

Just noticed that the dates attached to the versions on 
http://wiki.winehq.org/WineReleasePlan are not correct.

0.9.58 came out on March 21st.

Does this mean we still stick to May 9th or do we stick to 0.9.61 as being 
1.0.0.rc1?

-- 
Cheers,

Paul.


From truiken at gmail.com  Tue Apr  1 03:31:49 2008
From: truiken at gmail.com (James Hawkins)
Date: Tue, 1 Apr 2008 03:31:49 -0500
Subject: [Bug 3297] UpdateWindow() doesn't call XFlush()
In-Reply-To: <E1Jgbe6-0005ak-Mb@wine.codeweavers.com>
References: <bug-3297-3987@http.bugs.winehq.org/>
	<E1Jgbe6-0005ak-Mb@wine.codeweavers.com>
Message-ID: <22821af30804010131y538fa3cfocbe16f286d4a242@mail.gmail.com>

On Tue, Apr 1, 2008 at 3:15 AM,  <wine-bugs at winehq.org> wrote:
> http://bugs.winehq.org/show_bug.cgi?id=3297
>
>
>  Dmitry Timoshkov <dmitry at codeweavers.com> changed:
>
>            What    |Removed                     |Added
>  ----------------------------------------------------------------------------
>            Keywords|patch                       |
>
>
>
>
>  --- Comment #6 from Dmitry Timoshkov <dmitry at codeweavers.com>  2008-04-01 03:15:06 ---
>  The patch is obviously incorrect, so it doesn't count.
>

There are a lot of bugs with incorrect patches that have the patch
keyword.  The patch keyword is not to make sure that all bug reports
with correct patches attached get those patches submitted and
committed.  The point of the keyword is to alert developers to a
source of information.  A user attaches a patch and says, "this makes
the app work."  Even if the patch is wrong, a developer can see what
change makes the app work, and this can potentially help the developer
write a correct patch.

-- 
James Hawkins


From rob at codeweavers.com  Tue Apr  1 03:58:39 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Tue, 01 Apr 2008 09:58:39 +0100
Subject: Hey all, introducing myself and my GSoC idea...
In-Reply-To: <22821af30803311824v77095ec6o24f84772df50b447@mail.gmail.com>
References: <f20910b80803311630g22f40ed0re963b9faf0a360e@mail.gmail.com>	<19e31a080803311709u5cc90246te5682416796d5e37@mail.gmail.com>	<3a768c550803311811y338ca136s7c3d261599be08a1@mail.gmail.com>
	<22821af30803311824v77095ec6o24f84772df50b447@mail.gmail.com>
Message-ID: <47F1F93F.5050902@codeweavers.com>

James Hawkins wrote:
> On Mon, Mar 31, 2008 at 8:11 PM, Juan Lang <juan.lang at gmail.com> wrote:
>   
>>  Personally, I've thought that playing around with the
>>  native LPC API might be interesting.  I'm sure there are other areas
>>  of the native API that are sparsely documented, and for which some
>>  test cases might prove useful.
>>     
>
> But is the API in question useful for the Wine project as far as
> fixing apps?  I don't think we should devote SOC resources to a
> project that doesn't progress Wine beyond just implementing more APIs.

It is useful for getting native rpcrt4 to work, which in turn is useful 
for getting other COM DLLs to work, and so is potentially useful for bug 
triage and identifying the source of bugs in builtin COM DLLs.

-- 
Rob Shearman



From stefan at codeweavers.com  Tue Apr  1 04:45:19 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Tue, 1 Apr 2008 11:45:19 +0200
Subject: d3d9: Add some visual tests for Direct3DDevice9_StretchRect()
In-Reply-To: <df81031c0803312220o6066111bs40b101a12e9bad87@mail.gmail.com>
References: <df81031c0803312220o6066111bs40b101a12e9bad87@mail.gmail.com>
Message-ID: <200804011145.19925.stefan@codeweavers.com>

Am Dienstag, 1. April 2008 07:20:44 schrieb Jason Green:
Did you take a look at the various capability flags? I think the test as you 
submitted it is correct for dx9 level cards and drivers, but there are a few 
capability flags like D3DDEVCAPS2_CANSTRETCHRECTFROMTEXTURE or similar. Also 
some drivers seem to refuse StretchRecting between offscreenplain surfaces, 
even if no stretching is used.

Do you have any ideas what the scheme behind the allowed/forbidden blits is? 
So far I can see this:

-> Blitting to a rendertarget surface/texture is always OK
-> blitting between offscreen surfaces is ok as long as no stretching occurs
-> blitting to non-RT surfaces/textures faily, except the above

Did you test blitting from/to sysmem surfaces? The msdn says both must be 
D3DPOOL_DEFAULT as far as I remember


From lich at math.spbu.ru  Tue Apr  1 04:58:25 2008
From: lich at math.spbu.ru (Kirill K. Smirnov)
Date: Tue, 1 Apr 2008 13:58:25 +0400
Subject: kernel32: add stub for GetConsoleDisplayMode() et al
Message-ID: <200804011358.25879.lich@math.spbu.ru>

Hi,

  In the first patch of the series you really implement 
SetConsoleDisplayMode() instead of GetConsoleDisplayMode(), don't you?

  And it is dangerous to return success in pure stub functions, especially 
GetConsoleDisplayMode(). Returning FALSE and setting last error to 
ERROR_CALL_NOT_IMPLEMENTED will be much better.

--
Kirill


From julliard at winehq.org  Tue Apr  1 05:12:49 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Tue, 01 Apr 2008 12:12:49 +0200
Subject: Wine Release Plan
In-Reply-To: <47F1E64C.4020909@gmail.com> (Paul Vriens's message of "Tue, 01
	Apr 2008 09:37:48 +0200")
References: <47F1E64C.4020909@gmail.com>
Message-ID: <87tzilevdq.fsf@wine.dyndns.org>

Paul Vriens <paul.vriens.wine at gmail.com> writes:

> Just noticed that the dates attached to the versions on 
> http://wiki.winehq.org/WineReleasePlan are not correct.
>
> 0.9.58 came out on March 21st.
>
> Does this mean we still stick to May 9th or do we stick to 0.9.61 as being 
> 1.0.0.rc1?

We should stick to May 9th, we'll just have to wait for this date to
coincide with a release. If my calculations are right this should be
release 0.9.218 on May 9th, 2014. Hopefully we can clear the 1.0 bug
list by then.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Tue Apr  1 06:32:35 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Tue, 01 Apr 2008 13:32:35 +0200
Subject: imm: Keep track of context associations between HWND and HIMC
In-Reply-To: <47F1288D.8020801@codeweavers.com> (Aric Stewart's message of
	"Mon, 31 Mar 2008 13:08:13 -0500")
References: <47F1288D.8020801@codeweavers.com>
Message-ID: <87prt9eros.fsf@wine.dyndns.org>

Aric Stewart <aric at codeweavers.com> writes:

> @@ -93,12 +93,21 @@ typedef struct _tagTRANSMSG {
>      LPARAM lParam;
>  } TRANSMSG, *LPTRANSMSG;
>  
> +typedef struct _tagContextAssociation {
> +    struct list entry;
> +
> +    HWND    *hwnds;
> +    UINT    wndCount;
> +    HIMC    context;
> +} ContextAssociation;

Wouldn't it be a lot easier to store the HIMC in a window property?

-- 
Alexandre Julliard
julliard at winehq.org


From jeroen.janssen at gmail.com  Tue Apr  1 07:33:33 2008
From: jeroen.janssen at gmail.com (Jeroen Janssen)
Date: Tue, 1 Apr 2008 12:33:33 +0000 (UTC)
Subject: SOC Direct3D - Implement missing =?utf-8?b?RDNEOV94eA==?= DLLs?
Message-ID: <loom.20080401T122814-132@post.gmane.org>

Hi,

I was looking at the Wine SOC wiki ( http://wiki.winehq.org/SummerOfCode ) and
noticed an entry on "Direct3D - Implement missing D3D9_xx DLLs".

As far as I can see there are already lots of D3D9_xx dlls in the tree that seem
to forward stuf correctly.

Can someone confirm this to be already finished (and then remove this item from
the wiki?) If it isn't finished yet, what IS missing then?

D3D10_xx DLLs seem to be currently missing (I know we don't have any d3d 10
implementation yet in wine) and it probably isn't a SOC project, but would
completely stubbed D3D10_xx DLLs (patches) be accepted if I submit them to the
patch mailinglist or not?

Best regards,

Jeroen Janssen



From aric at codeweavers.com  Tue Apr  1 07:42:19 2008
From: aric at codeweavers.com (Aric Stewart)
Date: Tue, 01 Apr 2008 07:42:19 -0500
Subject: imm: Keep track of context associations between HWND and HIMC
In-Reply-To: <87prt9eros.fsf@wine.dyndns.org>
References: <47F1288D.8020801@codeweavers.com> <87prt9eros.fsf@wine.dyndns.org>
Message-ID: <47F22DAB.6090604@codeweavers.com>

It would be but I could not find evidence that such a property existed 
for all windows in Window. If you are proposing a wine internal property 
then it would work well.

-aric

Alexandre Julliard wrote:
> Aric Stewart <aric at codeweavers.com> writes:
> 
>> @@ -93,12 +93,21 @@ typedef struct _tagTRANSMSG {
>>      LPARAM lParam;
>>  } TRANSMSG, *LPTRANSMSG;
>>  
>> +typedef struct _tagContextAssociation {
>> +    struct list entry;
>> +
>> +    HWND    *hwnds;
>> +    UINT    wndCount;
>> +    HIMC    context;
>> +} ContextAssociation;
> 
> Wouldn't it be a lot easier to store the HIMC in a window property?
> 


From hverbeet at gmail.com  Tue Apr  1 08:06:37 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Tue, 1 Apr 2008 15:06:37 +0200
Subject: SOC Direct3D - Implement missing D3D9_xx DLLs?
In-Reply-To: <loom.20080401T122814-132@post.gmane.org>
References: <loom.20080401T122814-132@post.gmane.org>
Message-ID: <d658b69e0804010606n3b487ce7i6dd162e0408ca701@mail.gmail.com>

On 01/04/2008, Jeroen Janssen <jeroen.janssen at gmail.com> wrote:
> Hi,
>
>  I was looking at the Wine SOC wiki ( http://wiki.winehq.org/SummerOfCode ) and
>  noticed an entry on "Direct3D - Implement missing D3D9_xx DLLs".
>
>  As far as I can see there are already lots of D3D9_xx dlls in the tree that seem
>  to forward stuf correctly.
>
>  Can someone confirm this to be already finished (and then remove this item from
>  the wiki?) If it isn't finished yet, what IS missing then?
>
It isn't so much that the dlls themselves are missing, but rather that
a lot of the functions they're supposed to implement are still
unimplemented.

>  D3D10_xx DLLs seem to be currently missing (I know we don't have any d3d 10
>  implementation yet in wine) and it probably isn't a SOC project, but would
>  completely stubbed D3D10_xx DLLs (patches) be accepted if I submit them to the
>  patch mailinglist or not?
>
Personally, I don't think it makes sense to have stubbed d3d10x dlls
without at least a partial d3d10 implementation.


From lich at math.spbu.ru  Tue Apr  1 08:25:19 2008
From: lich at math.spbu.ru (Kirill K. Smirnov)
Date: Tue, 1 Apr 2008 16:25:19 +0300
Subject: net: Display a more specific error message when a service command
	fails.
Message-ID: <200804011725.19584.lich@math.spbu.ru>

  Hi,

>+    LPSTR pBuffer;
>+    if (FormatMessageA(FORMAT_MESSAGE_FROM_SYSTEM |
>+            FORMAT_MESSAGE_IGNORE_INSERTS | FORMAT_MESSAGE_ALLOCATE_BUFFER,
>+            NULL, error, 0, (LPSTR)&pBuffer, 0, NULL))
>+    {
>+        fputs(pBuffer, stdout);
>+        LocalFree(pBuffer);
>+        return TRUE;

This is a glibc version of fputs, it DOES NOT work with wineconsole.

--
Kirill

P.S. Current implementation of output_string suffers from the same issue too.


From stefan at codeweavers.com  Tue Apr  1 08:30:31 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Tue, 1 Apr 2008 15:30:31 +0200
Subject: SOC Direct3D - Implement missing D3D9_xx DLLs?
In-Reply-To: <d658b69e0804010606n3b487ce7i6dd162e0408ca701@mail.gmail.com>
References: <loom.20080401T122814-132@post.gmane.org>
	<d658b69e0804010606n3b487ce7i6dd162e0408ca701@mail.gmail.com>
Message-ID: <200804011530.31984.stefan@codeweavers.com>

Am Dienstag, 1. April 2008 15:06:37 schrieb H. Verbeet:
> Personally, I don't think it makes sense to have stubbed d3d10x dlls
> without at least a partial d3d10 implementation.
Yes, I agree. It would make more sense to take the unfinished stub from 
Andras' D3D10 project last year, finish it and write tests. For starting a 
D3D10 implementation we need some tests regarding pixel formats, the shader 
bytecode format and how the new buffer resource model works exactly.


From djapal at gmail.com  Tue Apr  1 07:11:28 2008
From: djapal at gmail.com (Dj Apal [GR])
Date: Tue, 1 Apr 2008 15:11:28 +0300
Subject: Greek translation patch correction
In-Reply-To: <22821af30803312358o1fe1ca4bvf3a420bec18ce280@mail.gmail.com>
References: <b432a8110803311521y1e606fa1wfcaa0e5e35bcf3a7@mail.gmail.com>
	<22821af30803312358o1fe1ca4bvf3a420bec18ce280@mail.gmail.com>
Message-ID: <b432a8110804010511o4e417579pcab0f151244a3539@mail.gmail.com>

So should I resend the patches in individual mails or it's ok for now and
for the next time I create new patches, I can send them as you wish?

2008/4/1, James Hawkins <truiken at gmail.com>:
>
> 2008/3/31 Dj Apal [GR] <djapal at gmail.com>:
>
> > Here are the separate patches as requested by James Hawkins
> >
>
>
> One patch per email.  I see that's not on the sending_patches
> page...man our documentation is in such bad shape (and scattered all
> over the place).
>
> --
>
> James Hawkins
>



-- 
Apostolos Alexiadis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080401/b2fb2d98/attachment-0001.htm 

From vincent.hardy.be at gmail.com  Tue Apr  1 07:59:47 2008
From: vincent.hardy.be at gmail.com (viny)
Date: Tue, 01 Apr 2008 14:59:47 +0200
Subject: msxml3 bug 10802
Message-ID: <fstbk4$9tl$1@ger.gmane.org>

Hi,

When creating an xml file, wine shouldn't create header automatically. 
Is that difficult to fix this bug 
(http://bugs.winehq.org/show_bug.cgi?id=10802) ? I've looked at domdoc.c 
     but I'm not an expert...



From jave27 at gmail.com  Tue Apr  1 08:32:49 2008
From: jave27 at gmail.com (Jason Green)
Date: Tue, 1 Apr 2008 09:32:49 -0400
Subject: d3d9: Add some visual tests for Direct3DDevice9_StretchRect()
In-Reply-To: <200804011145.19925.stefan@codeweavers.com>
References: <df81031c0803312220o6066111bs40b101a12e9bad87@mail.gmail.com>
	<200804011145.19925.stefan@codeweavers.com>
Message-ID: <df81031c0804010632y233e7666q428853eddc0f5d37@mail.gmail.com>

On Tue, Apr 1, 2008 at 5:45 AM, Stefan D?singer <stefan at codeweavers.com> wrote:
> Am Dienstag, 1. April 2008 07:20:44 schrieb Jason Green:
>  Did you take a look at the various capability flags? I think the test as you
>  submitted it is correct for dx9 level cards and drivers, but there are a few
>  capability flags like D3DDEVCAPS2_CANSTRETCHRECTFROMTEXTURE or similar. Also
>  some drivers seem to refuse StretchRecting between offscreenplain surfaces,
>  even if no stretching is used.

Yeah, I meant to make a comment about that as a TODO, but I didn't
have any cards lying around that didn't advertise that cap.  If anyone
does, it'd be interesting to see how Windows handles some of those
cases.  I'd guess it would be just like MSDN claims, but you never
know until you actually test it.

>  Do you have any ideas what the scheme behind the allowed/forbidden blits is?
>  So far I can see this:
>
>  -> Blitting to a rendertarget surface/texture is always OK
>  -> blitting between offscreen surfaces is ok as long as no stretching occurs
>  -> blitting to non-RT surfaces/textures faily, except the above
>

Yeah - turns out that MSDN was correct on this scheme:

http://msdn2.microsoft.com/en-us/library/bb174471(VS.85).aspx

These tests show that the results of the dx9 drivers are valid
according to that page.

>  Did you test blitting from/to sysmem surfaces? The msdn says both must be
>  D3DPOOL_DEFAULT as far as I remember

Yep - I probably should have left a few tests in there for that, but
the only surfaces that are valid to call StretchRect on must be in
D3DPOOL_DEFAULT (both source and destination).  Everything else fails.


From jeroen.janssen at gmail.com  Tue Apr  1 08:54:38 2008
From: jeroen.janssen at gmail.com (Jeroen Janssen)
Date: Tue, 1 Apr 2008 15:54:38 +0200
Subject: SOC Direct3D - Implement missing D3D9_xx DLLs?
In-Reply-To: <d658b69e0804010606n3b487ce7i6dd162e0408ca701@mail.gmail.com>
References: <loom.20080401T122814-132@post.gmane.org>
	<d658b69e0804010606n3b487ce7i6dd162e0408ca701@mail.gmail.com>
Message-ID: <e34e42440804010654y377085f8jfa1c72966ed0bd9f@mail.gmail.com>

On Tue, Apr 1, 2008 at 3:06 PM, H. Verbeet <hverbeet at gmail.com> wrote:
> >  As far as I can see there are already lots of D3D9_xx dlls in the tree that seem
> >  to forward stuf correctly.
> >
> >  Can someone confirm this to be already finished (and then remove this item from
> >  the wiki?) If it isn't finished yet, what IS missing then?
> >
> It isn't so much that the dlls themselves are missing, but rather that
> a lot of the functions they're supposed to implement are still
> unimplemented.

Ok, then the SOC text on the wiki for this item is slightly
"misleading" / outdated.


From jeroen.janssen at gmail.com  Tue Apr  1 09:01:34 2008
From: jeroen.janssen at gmail.com (Jeroen Janssen)
Date: Tue, 1 Apr 2008 16:01:34 +0200
Subject: SOC Direct3D - Implement missing D3D9_xx DLLs?
In-Reply-To: <200804011530.31984.stefan@codeweavers.com>
References: <loom.20080401T122814-132@post.gmane.org>
	<d658b69e0804010606n3b487ce7i6dd162e0408ca701@mail.gmail.com>
	<200804011530.31984.stefan@codeweavers.com>
Message-ID: <e34e42440804010701g4a3b7a10xe3f4199c77415ee@mail.gmail.com>

On Tue, Apr 1, 2008 at 3:30 PM, Stefan D?singer <stefan at codeweavers.com> wrote:
> Am Dienstag, 1. April 2008 15:06:37 schrieb H. Verbeet:
> > Personally, I don't think it makes sense to have stubbed d3d10x dlls
> > without at least a partial d3d10 implementation.
> Yes, I agree. It would make more sense to take the unfinished stub from
> Andras' D3D10 project last year, finish it and write tests. For starting a
> D3D10 implementation we need some tests regarding pixel formats, the shader
> bytecode format and how the new buffer resource model works exactly.

Would it be worth mentioning this on the wine SOC 2008 page?

Also, is there some info on what is left to do?
( I found the code Andras wrote at
http://code.google.com/p/google-summer-of-code-2007-wine/downloads/list
)

Best regards,

Jeroen Janssen

p.s. I'm not a student, but just interested in something that I could
work on, so if someone else claims this for the SOC, that's ok with
me.


From stefan at codeweavers.com  Tue Apr  1 09:09:00 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Tue, 1 Apr 2008 16:09:00 +0200
Subject: SOC Direct3D - Implement missing D3D9_xx DLLs?
In-Reply-To: <e34e42440804010701g4a3b7a10xe3f4199c77415ee@mail.gmail.com>
References: <loom.20080401T122814-132@post.gmane.org>
	<200804011530.31984.stefan@codeweavers.com>
	<e34e42440804010701g4a3b7a10xe3f4199c77415ee@mail.gmail.com>
Message-ID: <200804011609.00726.stefan@codeweavers.com>

Am Dienstag, 1. April 2008 16:01:34 schrieb Jeroen Janssen:
> Would it be worth mentioning this on the wine SOC 2008 page?
>
> Also, is there some info on what is left to do?
> ( I found the code Andras wrote at
> http://code.google.com/p/google-summer-of-code-2007-wine/downloads/list
> )
Ya, might be worth mentioning. But since the last year's soc project didn't 
get too far I am a bit afraid of "infrastructure" projects. I think it is 
easier for a student to add something new if there is an existing framework 
where he can hook in. For one part because the coding is easier, and also 
from a motivation standpoint because you see early results.

Of course if someone steps up and says he wants to go and write D3D10 tests I 
am willing to mentor such a problem.


From thunderbird2k at gmx.net  Tue Apr  1 10:17:19 2008
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Tue, 01 Apr 2008 17:17:19 +0200
Subject: SOC suggestion - Vista Game Explorer APIs (needed for d3d10)
Message-ID: <20080401151719.320740@gmx.net>

Hi,

As the SOC deadline has been extended here another SOC project which I added to the wiki close to the previous deadline namely the Vista Game Explorer dll.

Lots of users find Direct3D related projects cool. Part of the post-Wine-1.0 work will likely focus on D3D10. Just adding a full implementation of this dll won't get most games working as they use the Vista Game Explorer API for various purposes like storing game settings and profiles.

Since this API is bundled with Windows we can't legally use Microsoft their dlls (if possible at all) and we need to add these APIs to Wine. This project would work on adding this dll.

Regards,

Roderick Colenbrander
-- 
Der GMX SmartSurfer hilft bis zu 70% Ihrer Onlinekosten zu sparen! 
Ideal f?r Modem und ISDN: http://www.gmx.net/de/go/smartsurfer


From austinenglish at gmail.com  Tue Apr  1 11:01:48 2008
From: austinenglish at gmail.com (Austin English)
Date: Tue, 1 Apr 2008 11:01:48 -0500
Subject: Greek translation patch correction
In-Reply-To: <b432a8110804010511o4e417579pcab0f151244a3539@mail.gmail.com>
References: <b432a8110803311521y1e606fa1wfcaa0e5e35bcf3a7@mail.gmail.com>
	<22821af30803312358o1fe1ca4bvf3a420bec18ce280@mail.gmail.com>
	<b432a8110804010511o4e417579pcab0f151244a3539@mail.gmail.com>
Message-ID: <b6bb06270804010901w4c39ad73pd6a745b7363f28b@mail.gmail.com>

On Tue, Apr 1, 2008 at 7:11 AM, Dj Apal [GR] <djapal at gmail.com> wrote:
> So should I resend the patches in individual mails or it's ok for now and
> for the next time I create new patches, I can send them as you wish?
>
> 2008/4/1, James Hawkins <truiken at gmail.com>:
>
> > 2008/3/31 Dj Apal [GR] <djapal at gmail.com>:
> >
> > > Here are the separate patches as requested by James Hawkins
> > >
> >
> >
> > One patch per email.  I see that's not on the sending_patches
> > page...man our documentation is in such bad shape (and scattered all
> > over the place).
> >
> > --
> >
> > James Hawkins
> >
>
>
>
> --
> Apostolos Alexiadis
>
>
>
>
>

Please resend each individual patch in a separate e-mail.


From truiken at gmail.com  Tue Apr  1 11:11:29 2008
From: truiken at gmail.com (James Hawkins)
Date: Tue, 1 Apr 2008 11:11:29 -0500
Subject: Hey all, introducing myself and my GSoC idea...
In-Reply-To: <47F1F93F.5050902@codeweavers.com>
References: <f20910b80803311630g22f40ed0re963b9faf0a360e@mail.gmail.com>
	<19e31a080803311709u5cc90246te5682416796d5e37@mail.gmail.com>
	<3a768c550803311811y338ca136s7c3d261599be08a1@mail.gmail.com>
	<22821af30803311824v77095ec6o24f84772df50b447@mail.gmail.com>
	<47F1F93F.5050902@codeweavers.com>
Message-ID: <22821af30804010911r1e4caa85hb330bdda0e1581eb@mail.gmail.com>

On Tue, Apr 1, 2008 at 3:58 AM, Robert Shearman <rob at codeweavers.com> wrote:
> James Hawkins wrote:
>  > On Mon, Mar 31, 2008 at 8:11 PM, Juan Lang <juan.lang at gmail.com> wrote:
>  >
>
> >>  Personally, I've thought that playing around with the
>  >>  native LPC API might be interesting.  I'm sure there are other areas
>  >>  of the native API that are sparsely documented, and for which some
>  >>  test cases might prove useful.
>  >>
>  >
>  > But is the API in question useful for the Wine project as far as
>  > fixing apps?  I don't think we should devote SOC resources to a
>  > project that doesn't progress Wine beyond just implementing more APIs.
>
>  It is useful for getting native rpcrt4 to work, which in turn is useful
>  for getting other COM DLLs to work, and so is potentially useful for bug
>  triage and identifying the source of bugs in builtin COM DLLs.
>

LPC, yes, but the student just said the Native API.

-- 
James Hawkins


From hintak_leung at yahoo.co.uk  Tue Apr  1 11:15:21 2008
From: hintak_leung at yahoo.co.uk (Hin-Tak Leung)
Date: Tue, 1 Apr 2008 16:15:21 +0000 (GMT)
Subject: ddiwrapper/Gsoc Re: DLL exports... HELP?! (wine based win32 printer
	drivers for openprinting)
In-Reply-To: <1206911806.7820.26.camel@p4>
Message-ID: <401063.58506.qm@web23115.mail.ird.yahoo.com>

So far only one person has signed up with gsoc to do the win32 print driver under
linux...

I found out why I couldn't build ddiwrapper earlier - it builds against latest wine 
now; the reason was that I was ripping from opensuse/suse src rpm, and I did not look 
at any of the bundled patch, and there is a bundled patch which does that. The authoritative site for ddiwrapper seems to be:
ftp://ftp.suse.com/people/uli/ddiwrapper/
Although it is quite difficult to find, since most search engine gives various publibc part of suse/novell. I think the src.rpm bundled patch needs to go in properly as a new release, really. (uli at suse.de is the author of ddiwrapper).

--- On Sun, 30/3/08, Detlef Riekenberg <wine.dev at web.de> wrote:

> From: Detlef Riekenberg <wine.dev at web.de>
> Subject: Re: DLL exports... HELP?! (wine based win32 printer drivers for openprinting)
> To: "Hin-Tak Leung" <hintak_leung at yahoo.co.uk>
> Cc: "Till Kamppeter" <till.kamppeter at gmail.com>
> Date: Sunday, 30 March, 2008, 10:16 PM
> On Sa, 2008-03-29 at 15:51 +0000, Hin-Tak Leung wrote:
> > A personal question: would be like to be involved if a
> student comes
> > along, or in general in this area? (I looked it up,
> you were the
> > mentor for the 2007 wine project for the
> printerproxy).
> 
> 
> In general in this Area, Please.
> 
> A applied as Mentor today to Help with the Applications
> (winspool #at# googlemail.com)
> 
> 
> You can reach me on irc (freenode.net) in #winehackers
> My nick is "winspool"
> 
> 
> -- 
>  
> By by ... Detlef


      __________________________________________________________
Sent from Yahoo! Mail.
A Smarter Inbox http://uk.docs.yahoo.com/nowyoucan.html


From truiken at gmail.com  Tue Apr  1 12:04:25 2008
From: truiken at gmail.com (James Hawkins)
Date: Tue, 1 Apr 2008 12:04:25 -0500
Subject: [1/2] cabinet.dll -> FDICopy: Test added [Try 2]
In-Reply-To: <200804012049.29107.vitperov@etersoft.ru>
References: <200804012049.29107.vitperov@etersoft.ru>
Message-ID: <22821af30804011004g4b09b4dfvb70490bd11c7b2c7@mail.gmail.com>

2008/4/1 Vitaly Perov <vitperov at etersoft.ru>:
> This test checks if function FDICopy() of cabinet.dll correctly works with an
>  empty cabinet file (It's correct cab-file, but it has no files and folders
>  inside).
>  In this case Windows return TRUE, but WINE return FALSE. So the installation
>  of certain software finishes with an error in WINE
>
>  Changelog:
>      - Test added for cabinet.dll FDICopy function. This test checks if it
>  works correctly with an empty cab-files
>

@@ -593,9 +594,67 @@ static void test_FDIIsCabinet(void)
     delete_test_files();
 }

+
+static void CreateEmptyCab(void)
+{
+    static const unsigned char file_array [] = { 0x4d, 0x53, 0x43, 0x46,
+        0x00, 0x00, 0x00, 0x00, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+        0x00, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x01,
+        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
+    HANDLE hFile;
+    DWORD written;
+    BOOL result;
+
+    hFile = CreateFile("test1.cab", GENERIC_WRITE, 0, NULL,
CREATE_ALWAYS, FILE_ATTRIBUTE_TEMPORARY, NULL);
+    assert(hFile != INVALID_HANDLE_VALUE);
+    result=WriteFile(hFile, file_array, sizeof(file_array), &written, NULL);
+    CloseHandle( hFile );
+    assert(result); /*can't write to file*/
+}
+

You need to use the FCI api to create this cabinet.

+static void delEmptyCab(void)
+{
+    assert(DeleteFile("test1.cab"));
+}
+

This is a very pointless function, just call DeleteFile("test...") in
its place.  Also, this isn't something that needs an assert.

+INT_PTR __cdecl CopyProgress (FDINOTIFICATIONTYPE fdint,
PFDINOTIFICATION pfdin)
+{
+    return FALSE;
+}
+

Inconsistent style (space before opening parenthesis).

+static void test_FDICopy(void)
+{
+    HFDI hfdi;
+    ERF erf;
+    BOOL ret;
+    char name[] = "test1.cab";
+    char path[] = "";  /*native crashes if path=NULL*/
+

The pszCabPath parameter of FDICopy should be the current directory.
If you want to test using a relative cabinet path, do it in another
test.

+    /* native crashes if hfdi is NULL or invalid*/

These comments don't really apply to the test you've added.  You're
only testing one thing (thus, unit test): how FDICopy responds to an
empty cabinet.

+    hfdi = FDICreate(fdi_alloc, fdi_free, fdi_open, fdi_read,
+                     fdi_write, fdi_close, fdi_seek,
+                     cpuUNKNOWN, &erf);
+    ok(hfdi, "Expected non-NULL context\n");
+
+    /* TESTING FDICopy() */

Pointless comment, please remove it.

+    CreateEmptyCab();
+    ret=FDICopy(hfdi,name,path,0,CopyProgress,NULL,0);
+    delEmptyCab();

Please move this (actually, a call to DeleteFile, see above) to the
end of the function where cleanup happens.  It gets in the way of the
results of the test.

+    todo_wine
+    {
+        ok(ret, "Expected TRUE, got %d\n", ret);
+    }
+

If you're expecting TRUE, check for TRUE like the rest of the tests in
this file.

+    /* successfully destroy hfdi*/
+    ret = FDIDestroy(hfdi);
+    ok(ret, "Expected TRUE, got %d\n", ret);
+}


-- 
James Hawkins


From truiken at gmail.com  Tue Apr  1 12:08:49 2008
From: truiken at gmail.com (James Hawkins)
Date: Tue, 1 Apr 2008 12:08:49 -0500
Subject: [2/2] cabinet.dll -> FDICopy: Bug fixed
In-Reply-To: <200804012049.39732.vitperov@etersoft.ru>
References: <200804012049.39732.vitperov@etersoft.ru>
Message-ID: <22821af30804011008y2640f89eh582fe5aa664af84a@mail.gmail.com>

2008/4/1 Vitaly Perov <vitperov at etersoft.ru>:
> This is a bug fix for the FDICopy() function of cabinet.dll.
>  When you pass an empty cabinet file (It's correct cab-file, but it has no
>  files and folders inside) as a parameter, Wine detects that the file is
>  invalid.
>  In this case Windows return TRUE, but WINE return FALSE. So the installation
>  of certain software finishes with an error in WINE.
>
>  Changelog:
>      - Added a bug fix for cabinet.dll FDICopy function. Now it works correctly
>  with an empty cab-files.
>

+  if (!num_folders)
+    WARN("weird cabinet detect failure: This is an empty cabinet file \n");
+  /* if num_folders is 0, it's correct cab, but empty */

If there's a test for this case, and it is a valid case, then why did
you leave the WARN?

-- 
James Hawkins


From dank at kegel.com  Tue Apr  1 12:45:59 2008
From: dank at kegel.com (Dan Kegel)
Date: Tue, 1 Apr 2008 10:45:59 -0700
Subject: Wine Release Plan
Message-ID: <a71bd89a0804011045k486a2cb0h4962f6ccf31f27a0@mail.gmail.com>

Paul V. wrote:
>Just noticed that the dates attached to the versions on
>http://wiki.winehq.org/WineReleasePlan are not correct.
>0.9.58 came out on March 21st.
>Does this mean we still stick to May 9th or do we stick to 0.9.61 as
>being 1.0.0.rc1?

Whoops, sorry 'bout that.
Whatever Alexandre wants, as long as the release is in 2008 :-)

I've updated the page to show correct dates.
I inserted one more rc to keep the release in June,
but I'm certainly open to other options if folks object.
- Dan


From austinenglish at gmail.com  Tue Apr  1 12:56:59 2008
From: austinenglish at gmail.com (Austin English)
Date: Tue, 1 Apr 2008 12:56:59 -0500
Subject: Wine broken in feisty/git
Message-ID: <b6bb06270804011056v33734f8dye6fb32e27ca8e711@mail.gmail.com>

Building today's git worked fine, until trying to run ~/wine-git/wine
notepad, which results in a segmentation fault. Wine 0.9.58 from the
reps works fine, as did rebuilding wine 0.9.58 in git. I'm starting
the bisect now, but am about to leave this machine and won't be able
to complete it until tomorrow. Anyone else seeing this?


From thestig at google.com  Tue Apr  1 13:12:09 2008
From: thestig at google.com (Lei Zhang)
Date: Tue, 1 Apr 2008 11:12:09 -0700
Subject: Wine broken in feisty/git
In-Reply-To: <b6bb06270804011056v33734f8dye6fb32e27ca8e711@mail.gmail.com>
References: <b6bb06270804011056v33734f8dye6fb32e27ca8e711@mail.gmail.com>
Message-ID: <558b2f5c0804011112m29eae4c0lfbfd664fd9b708b1@mail.gmail.com>

On Tue, Apr 1, 2008 at 10:56 AM, Austin English <austinenglish at gmail.com> wrote:
> Building today's git worked fine, until trying to run ~/wine-git/wine
>  notepad, which results in a segmentation fault. Wine 0.9.58 from the
>  reps works fine, as did rebuilding wine 0.9.58 in git. I'm starting
>  the bisect now, but am about to leave this machine and won't be able
>  to complete it until tomorrow. Anyone else seeing this?
>
>
>

No crashes here...


From tony.wasserka at freenet.de  Tue Apr  1 13:31:45 2008
From: tony.wasserka at freenet.de (tony.wasserka at freenet.de)
Date: Tue, 01 Apr 2008 20:31:45 +0200
Subject: SOC Direct3D - Implement missing D3D9_xx DLLs?
Message-ID: <E1JglGr-0000kz-BM@www20.emo.freenet-rz.de>

>  Can someone confirm this to be already finished (and then remove this item from
>  the wiki?) If it isn't finished yet, what IS missing then?
Nearly everything is missing. It's just the forwarding and some stubs that have been defined, yet,
and the D3DXRenderToSurface implementation I submitted recently was coded
with d3d9 traces, which was something AJ didn't like for reimplementing d3dx9.
That means someone other needs to take care of that interface, but that's OT for this discussion.

> D3D10_xx DLLs seem to be currently missing (I know we don't have any d3d 10
> implementation yet in wine) and it probably isn't a SOC project, but would
> completely stubbed D3D10_xx DLLs (patches) be accepted if I submit them to the
> patch mailinglist or not?
I personally don't think it makes very much sense to stub a big library like d3dx10 without
being able to really implement it (as we'd need d3d10 for this first). You could ask AJ
for this on #winehackers, but I guess he'll be the same opinion.
However, you can of course stub the d3dx10 dlls on your local tree and submit them when
our d3d10 implementation is ready.

> Ok, then the SOC text on the wiki for this item is slightly
> "misleading" / outdated.
I have updated the GSoC and D3DX wiki sites, so that one
gets a very quick overview of how "far" we are with implementing it, yet.

Best regards
   Tony











From paul.vriens.wine at gmail.com  Tue Apr  1 14:41:36 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Tue, 01 Apr 2008 21:41:36 +0200
Subject: user32: Implement BroadcastSystemMessage, try 6
In-Reply-To: <b130c85e0804011225j619575f9m56cf10142fb44e41@mail.gmail.com>
References: <b130c85e0804011225j619575f9m56cf10142fb44e41@mail.gmail.com>
Message-ID: <47F28FF0.3070602@gmail.com>

Maarten Lankhorst wrote:
> Removed most LastError tests except where they are useful.
> 
> 
> ------------------------------------------------------------------------
> 
> 

Hi Maarten,

+    if (!recipients)
+        recipients = &recips;
+

Will that work?

Cheers,

Paul


From dank at kegel.com  Tue Apr  1 14:46:04 2008
From: dank at kegel.com (Dan Kegel)
Date: Tue, 1 Apr 2008 12:46:04 -0700
Subject: crash on exit in hardy on intel graphics?
In-Reply-To: <a71bd89a0803231753m7371015ah885830fbb777cc11@mail.gmail.com>
References: <a71bd89a0803230422n7b715f46r6f52b54201695e98@mail.gmail.com>
	<200803231300.38257.stefan@codeweavers.com>
	<a71bd89a0803230510t19525745id6cfa5b5a23fd329@mail.gmail.com>
	<a71bd89a0803231753m7371015ah885830fbb777cc11@mail.gmail.com>
Message-ID: <a71bd89a0804011246y6ab97d7cp9a8f0f67529d8c38@mail.gmail.com>

On Sun, Mar 23, 2008 at 5:53 PM, Dan Kegel <dank at kegel.com> wrote:
>  >  > >   10 0x7ddc39bc glIsRenderbufferEXT+0x16c() in libgl.so.1 (0x0034fc68)
>  >  >  >   11 0xb7efefdf in ld-linux.so.2 (+0xdfdf) (0x0034fe18)
>  >  >  >   12 0xb7c90f74 exit+0xd4() in libc.so.6 (0x0034fe38)
>  >  >  Why would exit call glIsRenderbuffer() ? That doesn't make sense to me
>  >
>  >  No idea... I guess I figured it was in an onexit handler installed
>  >  by opengl for some reason?
>
>  Now I'm getting that crash on exit from a game, American McGee's Alice demo.

aha.  glxgears also crashes on exit.
https://bugs.launchpad.net/ubuntu/+source/mesa/+bug/149260

Maybe it only affects systems with my graphics chip,
00:02.0 VGA compatible controller: Intel Corporation Mobile 945GM/GMS,
943/940GML Express Integrated Graphics Controller (rev 03)


From thestig at google.com  Tue Apr  1 14:53:09 2008
From: thestig at google.com (Lei Zhang)
Date: Tue, 1 Apr 2008 12:53:09 -0700
Subject: Wine broken in feisty/git
In-Reply-To: <b6bb06270804011056v33734f8dye6fb32e27ca8e711@mail.gmail.com>
References: <b6bb06270804011056v33734f8dye6fb32e27ca8e711@mail.gmail.com>
Message-ID: <558b2f5c0804011253nd4a7942sb0c41d0593becee7@mail.gmail.com>

On Tue, Apr 1, 2008 at 10:56 AM, Austin English <austinenglish at gmail.com> wrote:
> Building today's git worked fine, until trying to run ~/wine-git/wine
>  notepad, which results in a segmentation fault. Wine 0.9.58 from the
>  reps works fine, as did rebuilding wine 0.9.58 in git. I'm starting
>  the bisect now, but am about to leave this machine and won't be able
>  to complete it until tomorrow. Anyone else seeing this?
>
>
>

Hmm, I blew away my .wine directory. Now I'm seeing a segfault in
wineprefixcreate:

$ ~/wine/wine-git/tools/wineprefixcreate -w
ALSA lib seq_hw.c:456:(snd_seq_hw_open) open /dev/snd/seq failed: No
such file or directory
Could not load Mozilla. HTML rendering will be disabled.
/home/thestig/wine/wine-git/tools/wineprefixcreate: line 173:  6781
Segmentation fault      "${WINELOADER:-$bindir/wine}" rundll32.exe
setupapi.dll,InstallHinfSection DefaultInstall 128 wine.inf


From hans at it.vu.nl  Tue Apr  1 15:22:23 2008
From: hans at it.vu.nl (Hans Leidekker)
Date: Tue, 1 Apr 2008 22:22:23 +0200
Subject: wininet: InternetReadFileExA should check INTERNET_FLAG_ASYNC.
In-Reply-To: <20080327205224.GB4608@linux.ucla.edu>
References: <20080327205224.GB4608@linux.ucla.edu>
Message-ID: <200804012222.24647.hans@it.vu.nl>

On Thursday 27 March 2008 21:52:24 Dan Hipschman wrote:

> incorrect.  Here are a few Windows failures:
> 
> http.c:584: Test failed: expected status 10 (INTERNET_STATUS_RESOLVING_NAME) 0 times, received 1 times
> http.c:585: Test failed: expected status 11 (INTERNET_STATUS_NAME_RESOLVED) 0 times, received 1 times
> http.c:587: Test failed: expected status 30 (INTERNET_STATUS_SENDING_REQUEST) 2 times, received 1 times
> http.c:588: Test failed: expected status 31 (INTERNET_STATUS_REQUEST_SENT) 2 times, received 1 times
> http.c:589: Test failed: expected status 40 (INTERNET_STATUS_RECEIVING_RESPONSE) 2 times, received 1 times
> http.c:590: Test failed: expected status 41 (INTERNET_STATUS_RESPONSE_RECEIVED) 2 times, received 1 times
> http.c:591: Test failed: expected status 110 (INTERNET_STATUS_REDIRECT) 1 times, received 0 times

Some of these are also failing when you run them through a proxy server.
I put in some debug printing which confirmed that they only fail when the
async flag is set. So the test seems to be racy; the higher latency of the
proxy connection and your script with built in delays nicely explain that.

 -Hans


From m.b.lankhorst at gmail.com  Tue Apr  1 15:25:33 2008
From: m.b.lankhorst at gmail.com (Maarten Lankhorst)
Date: Tue, 1 Apr 2008 13:25:33 -0700
Subject: user32: Implement BroadcastSystemMessage, try 6
In-Reply-To: <b130c85e0804011324q7caeb449yfdf93a2e3b9cf251@mail.gmail.com>
References: <b130c85e0804011225j619575f9m56cf10142fb44e41@mail.gmail.com>
	<47F28FF0.3070602@gmail.com>
	<b130c85e0804011324q7caeb449yfdf93a2e3b9cf251@mail.gmail.com>
Message-ID: <b130c85e0804011325s65c2a9fdqebf9e951d57c17d8@mail.gmail.com>

Hello Paul,

2008/4/1, Paul Vriens <paul.vriens.wine at gmail.com>:
>  Hi Maarten,
>
>  +    if (!recipients)
>  +        recipients = &recips;
>  +
>
>  Will that work?

Yes. recipients is a pointer.

Cheers,

Maarten.


From thestig at google.com  Tue Apr  1 15:41:20 2008
From: thestig at google.com (Lei Zhang)
Date: Tue, 1 Apr 2008 13:41:20 -0700
Subject: Wine broken in feisty/git
In-Reply-To: <558b2f5c0804011253nd4a7942sb0c41d0593becee7@mail.gmail.com>
References: <b6bb06270804011056v33734f8dye6fb32e27ca8e711@mail.gmail.com>
	<558b2f5c0804011253nd4a7942sb0c41d0593becee7@mail.gmail.com>
Message-ID: <558b2f5c0804011341p1a1aee3ct9c9258a1b9651128@mail.gmail.com>

On Tue, Apr 1, 2008 at 12:53 PM, Lei Zhang <thestig at google.com> wrote:
> On Tue, Apr 1, 2008 at 10:56 AM, Austin English <austinenglish at gmail.com> wrote:
>
>
> > Building today's git worked fine, until trying to run ~/wine-git/wine
>  >  notepad, which results in a segmentation fault. Wine 0.9.58 from the
>  >  reps works fine, as did rebuilding wine 0.9.58 in git. I'm starting
>  >  the bisect now, but am about to leave this machine and won't be able
>  >  to complete it until tomorrow. Anyone else seeing this?
>  >
>  >
>  >
>
>  Hmm, I blew away my .wine directory. Now I'm seeing a segfault in
>  wineprefixcreate:
>
>  $ ~/wine/wine-git/tools/wineprefixcreate -w
>  ALSA lib seq_hw.c:456:(snd_seq_hw_open) open /dev/snd/seq failed: No
>  such file or directory
>  Could not load Mozilla. HTML rendering will be disabled.
>  /home/thestig/wine/wine-git/tools/wineprefixcreate: line 173:  6781
>  Segmentation fault      "${WINELOADER:-$bindir/wine}" rundll32.exe
>  setupapi.dll,InstallHinfSection DefaultInstall 128 wine.inf
>

Git bisect says:

0a44a778f00c5283347646083f682333c11bccf3 is first bad commit
commit 0a44a778f00c5283347646083f682333c11bccf3
Author: Aric Stewart <aric at codeweavers.com>
Date:   Mon Mar 31 09:15:29 2008 -0500

    imm32: Begin to add basic framework for loading IMEs as dlls.


From austinenglish at gmail.com  Tue Apr  1 16:08:29 2008
From: austinenglish at gmail.com (Austin English)
Date: Tue, 1 Apr 2008 16:08:29 -0500
Subject: Wine broken in feisty/git
In-Reply-To: <558b2f5c0804011341p1a1aee3ct9c9258a1b9651128@mail.gmail.com>
References: <b6bb06270804011056v33734f8dye6fb32e27ca8e711@mail.gmail.com>
	<558b2f5c0804011253nd4a7942sb0c41d0593becee7@mail.gmail.com>
	<558b2f5c0804011341p1a1aee3ct9c9258a1b9651128@mail.gmail.com>
Message-ID: <b6bb06270804011408i3c669ea7y2f790d05938b5525@mail.gmail.com>

On 4/1/08, Lei Zhang <thestig at google.com> wrote:
> On Tue, Apr 1, 2008 at 12:53 PM, Lei Zhang <thestig at google.com> wrote:
>  > On Tue, Apr 1, 2008 at 10:56 AM, Austin English <austinenglish at gmail.com> wrote:
>  >
>  >
>  > > Building today's git worked fine, until trying to run ~/wine-git/wine
>  >  >  notepad, which results in a segmentation fault. Wine 0.9.58 from the
>  >  >  reps works fine, as did rebuilding wine 0.9.58 in git. I'm starting
>  >  >  the bisect now, but am about to leave this machine and won't be able
>  >  >  to complete it until tomorrow. Anyone else seeing this?
>  >  >
>  >  >
>  >  >
>  >
>  >  Hmm, I blew away my .wine directory. Now I'm seeing a segfault in
>  >  wineprefixcreate:
>  >
>  >  $ ~/wine/wine-git/tools/wineprefixcreate -w
>  >  ALSA lib seq_hw.c:456:(snd_seq_hw_open) open /dev/snd/seq failed: No
>  >  such file or directory
>  >  Could not load Mozilla. HTML rendering will be disabled.
>  >  /home/thestig/wine/wine-git/tools/wineprefixcreate: line 173:  6781
>  >  Segmentation fault      "${WINELOADER:-$bindir/wine}" rundll32.exe
>  >  setupapi.dll,InstallHinfSection DefaultInstall 128 wine.inf
>  >
>
>
> Git bisect says:
>
>  0a44a778f00c5283347646083f682333c11bccf3 is first bad commit
>  commit 0a44a778f00c5283347646083f682333c11bccf3
>  Author: Aric Stewart <aric at codeweavers.com>
>  Date:   Mon Mar 31 09:15:29 2008 -0500
>
>     imm32: Begin to add basic framework for loading IMEs as dlls.
>

Yep, broken on Hardy as well, haven't tested gutsy. Reverting that
commit fixes it.

CC'ing Aric.


From julliard at winehq.org  Tue Apr  1 16:44:33 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Tue, 01 Apr 2008 23:44:33 +0200
Subject: Wine broken in feisty/git
In-Reply-To: <b6bb06270804011408i3c669ea7y2f790d05938b5525@mail.gmail.com>
	(Austin English's message of "Tue, 1 Apr 2008 16:08:29 -0500")
References: <b6bb06270804011056v33734f8dye6fb32e27ca8e711@mail.gmail.com>
	<558b2f5c0804011253nd4a7942sb0c41d0593becee7@mail.gmail.com>
	<558b2f5c0804011341p1a1aee3ct9c9258a1b9651128@mail.gmail.com>
	<b6bb06270804011408i3c669ea7y2f790d05938b5525@mail.gmail.com>
Message-ID: <87hceldzcu.fsf@wine.dyndns.org>

"Austin English" <austinenglish at gmail.com> writes:

> On 4/1/08, Lei Zhang <thestig at google.com> wrote:
>> Git bisect says:
>>
>>  0a44a778f00c5283347646083f682333c11bccf3 is first bad commit
>>  commit 0a44a778f00c5283347646083f682333c11bccf3
>>  Author: Aric Stewart <aric at codeweavers.com>
>>  Date:   Mon Mar 31 09:15:29 2008 -0500
>>
>>     imm32: Begin to add basic framework for loading IMEs as dlls.
>>
>
> Yep, broken on Hardy as well, haven't tested gutsy. Reverting that
> commit fixes it.

I committed a fix.

-- 
Alexandre Julliard
julliard at winehq.org


From leslie_alistair at hotmail.com  Tue Apr  1 16:48:59 2008
From: leslie_alistair at hotmail.com (Alistair Leslie-Hughes)
Date: Wed, 2 Apr 2008 08:48:59 +1100
Subject: msxml3 bug 10802
References: <fstbk4$9tl$1@ger.gmane.org>
Message-ID: <fsuaji$8ie$1@ger.gmane.org>

"viny" <vincent.hardy.be at gmail.com> wrote in message 
news:fstbk4$9tl$1 at ger.gmane.org...
> Hi,
>
> When creating an xml file, wine shouldn't create header automatically.
> Is that difficult to fix this bug
> (http://bugs.winehq.org/show_bug.cgi?id=10802) ? I've looked at domdoc.c
>     but I'm not an expert...
>
Hi Viny,
   The main issue here is that PI nodes are not suppost to be called xml.
In MSXML3 this is a special case and isnt assigned as a PI node as
such, instead the string is parsed for encoding, version, etc. This 
information
is then used when saving.

So what need to be done
1. When we assign a PI node with a name xml, parse for encoding, etc and
store then in the domdoc structure for later
2. In the domdoc_save, change xmlDocDumpMempory to use xmlDocDumpMemoryEnc
with the parsed encoding above.

Best Regards
 Alistair Leslie-Hughes




From ns03ja at brocku.ca  Tue Apr  1 17:34:00 2008
From: ns03ja at brocku.ca (Neil Skrypuch)
Date: Tue, 1 Apr 2008 18:34:00 -0400
Subject: Wine broken in feisty/git
In-Reply-To: <87hceldzcu.fsf@wine.dyndns.org>
References: <b6bb06270804011056v33734f8dye6fb32e27ca8e711@mail.gmail.com>
	<b6bb06270804011408i3c669ea7y2f790d05938b5525@mail.gmail.com>
	<87hceldzcu.fsf@wine.dyndns.org>
Message-ID: <200804011834.00499.ns03ja@brocku.ca>

On Tuesday 01 April 2008, Alexandre Julliard wrote:
> "Austin English" <austinenglish at gmail.com> writes:
> > On 4/1/08, Lei Zhang <thestig at google.com> wrote:
> >> Git bisect says:
> >>
> >>  0a44a778f00c5283347646083f682333c11bccf3 is first bad commit
> >>  commit 0a44a778f00c5283347646083f682333c11bccf3
> >>  Author: Aric Stewart <aric at codeweavers.com>
> >>  Date:   Mon Mar 31 09:15:29 2008 -0500
> >>
> >>     imm32: Begin to add basic framework for loading IMEs as dlls.
> >
> > Yep, broken on Hardy as well, haven't tested gutsy. Reverting that
> > commit fixes it.
>
> I committed a fix.

This broke for me on Gentoo too, the fix also fixed things for me.

- Neil


From a_villacis at palosanto.com  Tue Apr  1 17:44:38 2008
From: a_villacis at palosanto.com (=?ISO-8859-1?Q?Alex_Villac=ED=ADs_Lasso?=)
Date: Tue, 01 Apr 2008 17:44:38 -0500
Subject: WINEX11.DRV: workaround for unstable window state while handling
	MapNotify (fixes bug 12196)
In-Reply-To: <47F11BE5.40107@palosanto.com>
References: <47F11BE5.40107@palosanto.com>
Message-ID: <47F2BAD6.5000702@palosanto.com>

Alex Villac??s Lasso escribi?:
>
> The attached patch seems to fix this issue for me. It issues 
> X11DRV_MapNotify
> when it detects that the window is still marked as iconic on a 
> transition from
> IconicState to NormalState. Please comment on this.
>
> See bug #12196 for full discussion.
>
> Changelog:
> * Workaround for unstable window state when handling MapNotify at 
> window restore after minimize.  Issue extra X11DRV_MapNotify call when 
> PropertyNotify detects still-iconic window on 
>  IconicState->NormalState transition.
>
Is this patch incorrect? Nobody has commented on it, and it has not been 
applied either.

-- 
perl -e '$x=2.4;print sprintf("%.0f + %.0f = %.0f\n",$x,$x,$x+$x);'



From mstefani at redhat.de  Tue Apr  1 18:23:55 2008
From: mstefani at redhat.de (Michael Stefaniuc)
Date: Wed, 2 Apr 2008 01:23:55 +0200
Subject: Bitrotting Translations
Message-ID: <20080401232355.GA5155@redhat.com>

Hello guys,

there are a couple resource file translations that are so way out of
sync that they are commented out of the main rc file of the relevant
module.

programs/progman/rsrc.rc:
-------------------------
- Da.rc - Danish
- Fi.rc - Finnish
- Sk.rc - Slovak
- Sw.rc - Swedish (correct filename: Sv.rc)
- Va.rc - Rumansh (Vallader) (correct filename: Rm.rc)
- Wa.rc - Wallon
This are so bitrotted that they don't even stink anymore but are nice
fertile compost. Means they aren't even .rc files but .c/.h files.
I have sent a patch to remove them. If somebody still wants to look at
them they can with git show e.g.:
  git show wine-0.9.58:programs/progman/Va.rc


programs/winecfg/winecfg.rc:
----------------------------
- Pt.rc - Portuguese (Brazil/Portugal)
- It.rc - Italian
- Si.rc - Slovenian
This are only a little bit more broken but should be able to be fixed.
If a native speaker could take care of them that would be really nice.
Else I'll try to fix them myself or remove them if I fail after
1.0.0-rc1 comes out.


programs/start/rsrc.rc:
-----------------------
- Si.rc - Slovenian
Looks like only a few characters (the non-7bit clean ones) are broken.
Should be fairly easy to fix for a native speaker. Else I'll try to fix
it myself after 1.0.0-rc1 comes out.


bye
	michael
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080402/15e66485/attachment.pgp 

From xixsimplicityxix at gmail.com  Tue Apr  1 18:24:36 2008
From: xixsimplicityxix at gmail.com (John Klehm)
Date: Tue, 1 Apr 2008 18:24:36 -0500
Subject: AppDB:Nice URLs Question on integration / Request for testing
Message-ID: <78a7dad00804011624x4b30ae61u7aaf4ef8dcc78408@mail.gmail.com>

Hello,

So I have a working "nice urls" implementatino here:
http://appdb.klehm.net/app/
Simply enter in anything after app/  (e.g.
http://appdb.klehm.net/app/visual-basic).  At this point its better to
enter in too little of the desired app name rather than too much.
(better to have visual-basic or visual than visual-basic-7)

So test away and let me know how to improve it or whatnot.

Also as you'll see if you try it out, relative urls are broken (lack
of css, so its ugly =P) because well the page we return is now
relative to the searched term. As I see it we can integrate this with
appdb in 2 ways.  Make all urls absolute or make functions of the main
viewing pages and pass a url base into them.  Any ideas or comments on
the best way to get around this problem would be great.

Regards,
John Klehm


From mstefani at redhat.com  Tue Apr  1 18:34:25 2008
From: mstefani at redhat.com (Michael Stefaniuc)
Date: Wed, 02 Apr 2008 01:34:25 +0200
Subject: Bitrotting Translations
In-Reply-To: <20080401232355.GA5155@redhat.com>
References: <20080401232355.GA5155@redhat.com>
Message-ID: <47F2C681.1010906@redhat.com>

Michael Stefaniuc wrote:
> there are a couple resource file translations that are so way out of
> sync that they are commented out of the main rc file of the relevant
> module.
> 

> programs/winecfg/winecfg.rc:
> ----------------------------
> - Pt.rc - Portuguese (Brazil/Portugal)
> - It.rc - Italian
> - Si.rc - Slovenian
> This are only a little bit more broken but should be able to be fixed.
I mean a little bit more broken than the "normal" breakage that is
caught on Mikolaj's page http://pf128.krakow.sdi.tpnet.pl/wine-transl/ .

> If a native speaker could take care of them that would be really nice.
> Else I'll try to fix them myself or remove them if I fail after
> 1.0.0-rc1 comes out.
> 
> 
> programs/start/rsrc.rc:
> -----------------------
> - Si.rc - Slovenian
> Looks like only a few characters (the non-7bit clean ones) are broken.
> Should be fairly easy to fix for a native speaker. Else I'll try to fix
> it myself after 1.0.0-rc1 comes out.

bye
	michael


From dank at kegel.com  Tue Apr  1 19:16:28 2008
From: dank at kegel.com (Dan Kegel)
Date: Tue, 1 Apr 2008 17:16:28 -0700
Subject: Recent imm changes triggered widespread valgrind errors?
Message-ID: <a71bd89a0804011716pdb12e47je28d04f474c8106@mail.gmail.com>

Aric, can you have a look?

Any call to CreateWindow now spews lots of Valgrind errors.
For instance,
http://kegel.com/wine/valgrind/logs-2008-04-01/vg-advpack_install-diff.txt
contains:
+ Conditional jump or move depends on uninitialised value(s)
+    at  RtlInitUnicodeString (unicode.h:212)
+    by  LoadLibraryExW (module.c:924)
+    by  LoadLibraryW (module.c:968)
+    by  ImmCreateContext (imm.c:143)
+    by  X11DRV_SetupXIM (xim.c:510)
+    by  x11drv_init_thread_data (x11drv_main.c:654)
+    by  X11DRV_SetWindowPos (x11drv.h:517)
+    by  set_window_pos (winpos.c:1919)
+    by  WIN_CreateWindowEx (win.c:1121)
+    by  CreateWindowExW (win.c:1351)
+    by  manage_desktop (desktop.c:224)
+    by  WinMain (explorer.c:136)
+    by  main (exe_main.c:48)


From dank at kegel.com  Tue Apr  1 20:30:23 2008
From: dank at kegel.com (Dan Kegel)
Date: Tue, 1 Apr 2008 18:30:23 -0700
Subject: Wine 1.0 status: T minus 73 days (!), 69 bugs left
Message-ID: <a71bd89a0804011830p2a88e0e7s65b54551981a7f4@mail.gmail.com>

Grumble.  I was off by a week when I wrote
http://wiki.winehq.org/WineReleasePlan
I've adjusted the release dates to match our two-week cycle correctly
this time (I hope).
That pushed our release out one week... which means we finally have
fewer bugs than days-to-release.

Bugs fixed since last summary:
3711   wininet         1       Musicmatch fails to install (missing
registry key, HTTP_HttpOpenRequest() problem)
8246   urlmon  3       invoking htmlhelp:HtmlHelpW crashes wine

Bugs new since last summary (!):
4372   comctl32        0       listview: cannot drag several items
5535   directx-        16      Planescape:Torment doesn't work
11509  crypt32         0       Wordviewer 2003 is unable to open
documents encrypted with AES

(The first is arguable, but listview is pretty central, so ok.
The second was closed by mistake earlier.
The third is in one of our release criterion apps.
Even though we only promise to fix *regressions* in
those apps, we might as well try to fix newly discovered
bugs, too.)

Bugs deferred since last summary:
638    document        9       Document Wine debugging channels
4733   kernel32        5       Get optimized/compressed/packed
executables (non-upx) working
4770   ole     3       BlackBerry Device Manager fails to install under wine
4971   -unknown        3       Corel Draw 12 demo install fails
9926   gdi32   5       gdi32.dll should not have exported function pointers
10905  shell32         0       thinstall firefox demo requires native msvcrt

Current list of open bugs:
ID  	 Comp  	 Votes  	 Summary
5948 	-unknown 	1 	Star Trek: Armada does not install
7404 	-unknown 	2 	ShowWindow(SW_MINIMIZE) should not generate a
WM_PAINT message
12246 	-unknown 	1 	"make test" gives different results with and
without warn+heap
5055 	-unknown 	5 	Deleting files from a window in wine doesn't send
them to the Trash
8125 	-unknown 	0 	Marratech 6.1 crashes on start
5402 	-unknown 	0 	Trying to run PhotoStitch 3.1
11281 	-unknown 	2 	CJK input many issues
9916 	-unknown 	6 	"make test" usually fails
7477 	-unknown 	1 	Uplink demo crashes
12097 	-unknown 	3 	Wine 1.0 should not ship out-of-sync resource translations
9178 	-unknown 	7 	"hello world" dos program hangs
5024 	-unknown 	4 	Thief: Deadly Shadows crashes:page fault on read
access to 0x0000040c
5061 	-unknown 	6 	Copying from Windows Firefox in Wine and pasting to
Linux OpenOffice pastes metadata as data
10815 	-unknown 	2 	Cannot drag images into Adobe Photoshop 7 from the
web / desktop
5844 	-unknown 	11 	tray minimize
10147 	-unknown 	1 	Word Viewer 2003 - Tab behavior differs from Windows
9959 	-unknown 	8 	Make wine updates work even if the registry changed
556 	build-en 	1 	Reconcile the Windows and Wine spec files
2493 	comctl32 	2 	Multi-select listview: Shift-arrow up only selects
top two items
1114 	comctl32 	2 	Winrar2.90/3.00: Comboex doesn't trigger a event
when you mouse-click in some value of it
4372 	comctl32 	0 	listview: cannot drag several items
11509 	crypt32 	0 	Wordviewer 2003 is unable to open documents
encrypted with AES
11681 	directx- 	14 	Add support for video overlay
5535 	directx- 	16 	Planescape:Torment doesn't work
5955 	directx- 	8 	DirectDrawCreate crash on non-OpenGL desktop
9030 	directx- 	0 	army men hangs on black screen
82 	document 	2 	Stabilize Winelib User Guide Table of Contents
6519 	gdi32 	7 	Wine blacks out rotated font bitmap
3270 	gdi32 	15 	Problem with minimized top-level windows
9771 	gdi32 	38 	Steam Friends doesn't work (fails to render correctly
or refresh)
7571 	gdi32 	1 	Accented character glyphs are mixed up with TrueType
fonts (affects e.g. Lotus Notes R5)
9484 	kernel32 	18 	Program refuses to run because of
ProtectCD/ProtectDISC copy-protection
9039 	kernel32 	0 	GS-Auftrag Professional SQL aborts on startup
5541 	kernel32 	0 	WriteConsole can't write to stdout; affects e.g.
wsh's cscript's usage message
5351 	kernel32 	9 	Windows Installer 3.1 cannot install because of
non-standard drive labeling
7098 	mscoree 	1 	RufzXP crashes on startup, needs
mscoree.dll.CorBindToRuntimeEx
5163 	msi 	12 	Office XP 2002 crashes on installation
8783 	ntdll 	12 	USB serial ports do not work
9356 	ntdll 	6 	Serial communication not working since wine-0.9.33
6607 	ole 	9 	Drag and Drop not working
9942 	ole 	2 	Powerpoint Viewer 2007 crashes opening .pptx files
8095 	ole 	0 	PQ Teaching toy crashes
2539 	ole 	3 	XDND (Drag and drop for X Windows) doesn't copy text
5926 	programs 	0 	Wine does not provide an implementation of winhlp32.exe
6254 	richedit 	4 	Installer infinite loop from rich text error
6095 	shdocvw 	12 	MOTD in counter-strike 1.6 and counter-strike
source does not render
9304 	shdocvw 	3 	Temple of Elemental Evil demo doesn't start - gui irresponsive
8898 	shdocvw 	0 	Run Time Error "445": Object doesn't support this
action in Europa Knowledgebase
3546 	shdocvw 	2 	CLSID_InternetShortcut not available...
9809 	shell32 	4 	Autodesk Revit Architecture 2008 install fails
8439 	shell32 	8 	Visual Studio .NET (7) install fails
11742 	shlwapi 	8 	Small .net 1.1 app (FastMD5 1.3) fails to start up
12074 	testcase 	2 	The conformance tests fail on Windows
6604 	tools 	2 	Ship icons for the wine-tools that can be used in .desktop files
664 	user32 	6 	The help menu functionality inside programs is broken
(messaging problem)
4523 	user32 	5 	Can't copy from Firefox 1.5 and paste into OpenOffice
2 under Wine
3023 	user32 	5 	Orcad - "Place Part" never tries to put down a part
124 	wineserv 	2 	Review of Wine Server Protocol
1990 	winex11. 	1 	modifier keys not released when switching desktop
5623 	winex11. 	3 	GetAsyncKeyState wrong if querying process doesn't have focus
5828 	winex11. 	24 	Command and Conquer Generals (Zero Hour) doesn't
change the mouse cursor from the default X mouse
10984 	winex11. 	5 	sun jre 5 update 10 installer hangs in 0.9.52
3297 	winex11. 	12 	UpdateWindow() doesn't call XFlush()
7372 	winex11. 	12 	can't copy and paste between gnome apps eg
openoffice or gimp and wine apps such as dreamweaver or adobe
photoshop
2368 	winex11. 	7 	Wine loses its X-Window when switching to another
virt. desktop in Fvwm
11019 	winex11. 	3 	matlab r14 and r16 (7.0.4 and 7.3.0) and
WriteItNow3.1.0s hang if X in 24bpp mode
5625 	wininet 	4 	Wine does not handle internet proxy settings conveniently
9787 	winsock 	47 	Warcraft3 Battle.net Doesn't work (Needs AcceptEx)
12005 	wintab32 	0 	Regression in pressure sensitivity with wizardpen
tablet driver and Photoshop 7


From paul.vriens.wine at gmail.com  Wed Apr  2 00:54:11 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Wed, 02 Apr 2008 07:54:11 +0200
Subject: user32: Implement BroadcastSystemMessage, try 6
In-Reply-To: <b130c85e0804011325s65c2a9fdqebf9e951d57c17d8@mail.gmail.com>
References: <b130c85e0804011225j619575f9m56cf10142fb44e41@mail.gmail.com>	<47F28FF0.3070602@gmail.com>	<b130c85e0804011324q7caeb449yfdf93a2e3b9cf251@mail.gmail.com>
	<b130c85e0804011325s65c2a9fdqebf9e951d57c17d8@mail.gmail.com>
Message-ID: <47F31F83.8010500@gmail.com>

Maarten Lankhorst wrote:
> Hello Paul,
> 
> 2008/4/1, Paul Vriens <paul.vriens.wine at gmail.com>:
>>  Hi Maarten,
>>
>>  +    if (!recipients)
>>  +        recipients = &recips;
>>  +
>>
>>  Will that work?
> 
> Yes. recipients is a pointer.
> 
> Cheers,
> 
> Maarten.
> 
> 
> 
Yes, sorry for the noise. (Shouldn't check code late in the day).

-- 
Cheers,

Paul.


From kai.blin at gmail.com  Wed Apr  2 03:11:11 2008
From: kai.blin at gmail.com (Kai Blin)
Date: Wed, 2 Apr 2008 10:11:11 +0200
Subject: Some considerations about the Wine FUSE project for GSoC
In-Reply-To: <200803311608.09536.kai.blin@gmail.com>
References: <200803311415.18471.kai.blin@gmail.com>
	<47F0E769.5020908@brain-dump.org>
	<200803311608.09536.kai.blin@gmail.com>
Message-ID: <200804021011.25198.kai.blin@gmail.com>

On Monday 31 March 2008 16:08:00 Kai Blin wrote:
> On Monday 31 March 2008 15:30:17 Marc Andre Tanner wrote:
> > First, I haven't yet applied for the project mainly because i will
> > probably not be able to work full time on a GSoC project due to real
> > life issues (part time job, family related things etc). On the other
> > hand I doubt that it will require ~3 months to implement, I have done
> > my prototype over more or less a weekend.
>
> That's why there's more than one FUSE file systems on the list ;)
>
> > I miss the technical discussion on how the problem should be solved. I
> > think the idea of keeping the original filename in an extended attribute
> > and storing everything in lower case is a pretty good one. Andrew
> > Tridgell also listed it on one of his slides from  WineConf05 [1].
>
> The tricky part is convincing Alexandre Julliard, as always when working on
> Wine.
>
> > I
> > prototyped something and thought this way I would at least get some
> > feedback (after all "Talk is cheap. Show me the code." is common
> > practice in the open source world). But this wasn't really the
> > case, so i am still wondering what should be done differently?
>
> Whoops, I didn't see that url. Sorry, but things were a bit busy recently.
> I'll give that a whirl later today.

I'm seeing some funny behaviour in a directory containing the files foo.txt, 
Foo.txt and bAr.tXt

After mounting, I can only see a "foo.txt" in the directory, containing the 
Foo.txt contents.

Cheers,
Kai

-- 
Kai Blin
WorldForge developer  http://www.worldforge.org/
Wine developer        http://wiki.winehq.org/KaiBlin
Samba team member     http://www.samba.org/samba/team/
--
Will code for cotton.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080402/90b2f8e7/attachment.pgp 

From paul.vriens.wine at gmail.com  Wed Apr  2 03:18:07 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Wed, 02 Apr 2008 10:18:07 +0200
Subject: shell32: Handle a few cases in FO_COPY that arise from
	not	double-NULL terminating the input
In-Reply-To: <22821af30804020107r7f14a125qabab3f323d54574d@mail.gmail.com>
References: <22821af30804020107r7f14a125qabab3f323d54574d@mail.gmail.com>
Message-ID: <47F3413F.9080803@gmail.com>

James Hawkins wrote:
> Hi,
> 
> Fix for bug 9809.
> 
> Changelog:
> * Handle a few cases in FO_COPY that arise from not double-NULL
> terminating the input.
> 
>  dlls/shell32/shlfileop.c       |   11 +++-
>  dlls/shell32/tests/shlfileop.c |  122 ++++++++++++++++++++++++++++++++++++++++
>  2 files changed, 130 insertions(+), 3 deletions(-)
> 
> 
> 
> ------------------------------------------------------------------------
> 
> 
Hi James,

+    /* no double-NULL terminator for pTo */
+    memset(to, 'a', MAX_PATH);
+    lstrcpyA(to, "two.txt");
+    shfo.pFrom = "one.txt\0";
+    shfo.pTo = to;
+    shfo.fFlags = FOF_NOCONFIRMATION | FOF_SILENT | FOF_NOERRORUI;
+    retval = SHFileOperation(&shfo);
+    ok(retval == ERROR_SUCCESS, "Expected ERROR_SUCCESS, got %d\n", retval);
+    ok(DeleteFileA("one.txt"), "Expected file to exist\n");
+    ok(DeleteFileA("two.txt"), "Expected file to exist\n");
+
+    createTestFile("one.txt");
+
+    /* no FOF_MULTIDESTFILES, two files in pTo */
+    shfo.pFrom = "one.txt\0";
+    shfo.pTo = "two.txt\0three.txt\0";
+    shfo.fFlags = FOF_NOCONFIRMATION | FOF_SILENT | FOF_NOERRORUI;
+    retval = SHFileOperation(&shfo);
+    ok(retval == ERROR_SUCCESS, "Expected ERROR_SUCCESS, got %d\n", retval);
+    ok(DeleteFileA("one.txt"), "Expected file to exist\n");
+    ok(DeleteFileA("two.txt"), "Expected file to exist\n");
+
+    createTestFile("one.txt");
+
+    /* no double-NULL terminator for pTo */
+    memset(to, 'a', MAX_PATH);
+    lstrcpyA(to, "two.txt");
+    shfo.pFrom = "one.txt\0";
+    shfo.pTo = to;
+    shfo.fFlags = FOF_NOCONFIRMATION | FOF_SILENT | FOF_NOERRORUI;
+    retval = SHFileOperation(&shfo);
+    ok(retval == ERROR_SUCCESS, "Expected ERROR_SUCCESS, got %d\n", retval);
+    ok(DeleteFileA("one.txt"), "Expected file to exist\n");
+    ok(DeleteFileA("two.txt"), "Expected file to exist\n");

Isn't the last test the same as the first (in the above piece of code) ?

-- 
Cheers,

Paul.


From coolbeer1980 at yahoo.com  Wed Apr  2 03:18:51 2008
From: coolbeer1980 at yahoo.com (=?iso-8859-1?Q?Kolbj=F8rn_Fredheim?=)
Date: Wed, 2 Apr 2008 01:18:51 -0700 (PDT)
Subject: Minor regression introduced in user32
Message-ID: <270140.39077.qm@web44814.mail.sp1.yahoo.com>

There is a regression introduced into the git tree that is causing
some minor issues with Anarchy Online atleast(should be other 
applications affected aswell).
On login, if you press enter instead of pushing "Login" a box will come 
up stating "You must select a charactername before playing! [OK]", this 
is before checking if the password is correct, or actually logging 
in to the account. I have never seen this box in the 2.5 years I've 
been playing Anarchy, so I can only speculate it's trying to select 
a character without actually having one selected in the drop-down
box(ie. Sending the enter twice to the application).

I bisected down to the following commit:

# ~/tmp/wine-git $ git bisect good
41ea8f0e8a6fab93fa08da16ecc24260dbad327c is first bad commit
commit 41ea8f0e8a6fab93fa08da16ecc24260dbad327c
Author: Lei Zhang <thestig at google.com>
Date:   Tue Mar 25 19:09:38 2008 -0700

    user32: Tweak how the edit control handles WM_GETDLGCODE.

:040000 040000 5583dc91d4f658340fcab6169c5be12b18c5d862 114715be44f79ddf45a9c61a01b90ee624504c1a M      dlls


I didn't want to file a bug-report on it, due to it beeing in the 
current git, and 0.9.58 is ok, and my knowledge on this part of wine 
is rather limited.

-
Kolbj?rn Fredheim


      ____________________________________________________________________________________
You rock. That's why Blockbuster's offering you one month of Blockbuster Total Access, No Cost.  
http://tc.deals.yahoo.com/tc/blockbuster/text5.com



From dmitry at codeweavers.com  Wed Apr  2 03:24:57 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Wed, 2 Apr 2008 17:24:57 +0900
Subject: Minor regression introduced in user32
References: <270140.39077.qm@web44814.mail.sp1.yahoo.com>
Message-ID: <02c501c8949b$0e4b5980$a600fea9@DMITRY>

"Kolbj?rn Fredheim" <coolbeer1980 at yahoo.com> wrote:

> I didn't want to file a bug-report on it, due to it beeing in the
> current git, and 0.9.58 is ok, and my knowledge on this part of wine
> is rather limited.

This is not an appropriate place to report the bugs. Also please search
the bugzilla first: #12319

-- 
Dmitry. 



From julliard at winehq.org  Wed Apr  2 04:21:40 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 02 Apr 2008 11:21:40 +0200
Subject: mshtml: Added registry configuration to allow using Active Script
	engine for JavaScript scripts.
In-Reply-To: <47F220F9.2030308@codeweavers.com> (Jacek Caban's message of
	"Tue, 01 Apr 2008 11:48:09 +0000")
References: <47F220F9.2030308@codeweavers.com>
Message-ID: <87d4p8ehnf.fsf@wine.dyndns.org>

Jacek Caban <jacek at codeweavers.com> writes:

> +    static const WCHAR key_nameW[] =
> +        {'S','o','f','t','w','a','r','e',
> +         '\\','W','i','n','e',
> +         '\\','M','S','H','T','M','L',
> +         '\\','S','c','r','i','p','t','O','v','e','r','r','i','d','e','s',0};
> +
> +    /* @@ Wine registry key: HKCU\Software\Wine\MSHTML\ScriptOverrides */
> +    res = RegOpenKeyW(HKEY_CURRENT_USER, key_nameW, &hkey);
> +    if(res != ERROR_SUCCESS)
> +        return ret;

Why do we need a configuration option for this?  When would a user want
to change it?

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Wed Apr  2 04:22:26 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 02 Apr 2008 11:22:26 +0200
Subject: imm: Keep track of context associations between HWND and HIMC
In-Reply-To: <47F22DAB.6090604@codeweavers.com> (Aric Stewart's message of
	"Tue, 01 Apr 2008 07:42:19 -0500")
References: <47F1288D.8020801@codeweavers.com>
	<87prt9eros.fsf@wine.dyndns.org> <47F22DAB.6090604@codeweavers.com>
Message-ID: <878wzwehm5.fsf@wine.dyndns.org>

Aric Stewart <aric at codeweavers.com> writes:

> It would be but I could not find evidence that such a property existed
> for all windows in Window. If you are proposing a wine internal
> property then it would work well.

Sure, a Wine internal property would be fine.

-- 
Alexandre Julliard
julliard at winehq.org


From kwixbit at gmail.com  Wed Apr  2 04:45:12 2008
From: kwixbit at gmail.com (Warren Dumortier)
Date: Wed, 2 Apr 2008 11:45:12 +0200
Subject: Nice feature?
Message-ID: <f3a003030804020245k619eb8c7j9e690f5839b7ab6e@mail.gmail.com>

Hello!
I have a little proposition for Wine 1.0!
Why not creating an error dialog when a dll is missing, it would help a lot
of users!
For example there's a dialog to install geck, why not a dialog that simply
says you have to add a dll in the correct directory?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080402/34f34719/attachment.htm 

From kwixbit at gmail.com  Wed Apr  2 04:49:25 2008
From: kwixbit at gmail.com (Warren Dumortier)
Date: Wed, 2 Apr 2008 11:49:25 +0200
Subject: How can i bypass my bug?
Message-ID: <f3a003030804020249p65745271gf9a30c47be25de44@mail.gmail.com>

Hi!

Some time ago i fille din a bug report because a game (The Sims : Pet
Stories) couldn't lanch, after some mails the problem was that Wine doesn't
gave vertex shaders, is there anything i can do to have this game running on
my linux box?

The bug has been reported as duplicate, but her's the correct one:
http://bugs.winehq.org/show_bug.cgi?id=8051

Is there any way t have the game running (vertex sharders emulation
running?), by adding dlls maybe, installing DirectX and disable some dlls?
Anything? Thanks, kind regards!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080402/504dd556/attachment.htm 

From thunderbird2k at gmx.net  Wed Apr  2 06:12:58 2008
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Wed, 02 Apr 2008 13:12:58 +0200
Subject: How can i bypass my bug?
In-Reply-To: <f3a003030804020249p65745271gf9a30c47be25de44@mail.gmail.com>
References: <f3a003030804020249p65745271gf9a30c47be25de44@mail.gmail.com>
Message-ID: <20080402111258.226330@gmx.net>

> Hi!
> 
> Some time ago i fille din a bug report because a game (The Sims : Pet
> Stories) couldn't lanch, after some mails the problem was that Wine
> doesn't
> gave vertex shaders, is there anything i can do to have this game running
> on
> my linux box?
> 
> The bug has been reported as duplicate, but her's the correct one:
> http://bugs.winehq.org/show_bug.cgi?id=8051
> 
> Is there any way t have the game running (vertex sharders emulation
> running?), by adding dlls maybe, installing DirectX and disable some dlls?
> Anything? Thanks, kind regards!

Easy buy a simple videocard with vertex shader support we offer it on any card equal or better to a geforcefx / radeon 9500.

Roderick


From julliard at winehq.org  Wed Apr  2 06:37:54 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 02 Apr 2008 13:37:54 +0200
Subject: winex11.drv: Connect to XIM server dynamically. [take 2]
In-Reply-To: <200803291252213981870006MA65@nm06mta.auone-net.jp> (Kusanagi
	Kouichi's message of "Sat, 29 Mar 2008 21:52:20 +0900")
References: <200803291252213981870006MA65@nm06mta.auone-net.jp>
Message-ID: <874pakebcd.fsf@wine.dyndns.org>

Kusanagi Kouichi <slash at ma.neweb.ne.jp> writes:

> +
> +    if (data->xic)
> +        return data->xic;
> +
> +    xim = x11drv_thread_data()->xim;
> +    if (!xim)
> +        return NULL;
> +
> +    return X11DRV_CreateIC(xim, data->whole_window, &data->xic);

You shouldn't store a pointer to an internal field of the win_data
structure, that makes things hard to follow. You should store win_data
or hwnd in the pointer field and dereference it in the callback.

> @@ -651,7 +651,10 @@ struct x11drv_thread_data *x11drv_init_thread_data(void)
>      if (TRACE_ON(synchronous)) XSynchronize( data->display, True );
>      wine_tsx11_unlock();
>  
> -    if (use_xim && !(data->xim = X11DRV_SetupXIM( data->display, input_style )))
> +    data->xim = NULL;
> +    if (use_xim &&
> +        !XRegisterIMInstantiateCallback(data->display, NULL, NULL, NULL,
> +                                        X11DRV_SetupXIM, (XPointer)&data->xim))

The XRegisterIMInstantiateCallback should go in xim.c, the
initialization code in x11drv_main.c shouldn't need to know about such
implementation details.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Wed Apr  2 06:42:39 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 02 Apr 2008 13:42:39 +0200
Subject: [2/5] setupapi: Changing pointers on SP_DEVINFO_DATA
In-Reply-To: <200804011524.20838.amorozov@etersoft.ru> (Alexander Morozov's
	message of "Tue, 1 Apr 2008 14:24:20 +0300")
References: <200804011524.20838.amorozov@etersoft.ru>
Message-ID: <87zlsccwk0.fsf@wine.dyndns.org>

Alexander Morozov <amorozov at etersoft.ru> writes:

> SETUPDI_AddDeviceToSet: changing pointers on SP_DEVINFO_DATA after 
> allocating new memory block for their array

We shouldn't have to do that sort of thing. The data structure should be
fixed to store pointers that don't have to be moved around.

-- 
Alexandre Julliard
julliard at winehq.org


From susancragin at earthlink.net  Wed Apr  2 07:11:04 2008
From: susancragin at earthlink.net (Susan Cragin)
Date: Wed, 2 Apr 2008 08:11:04 -0400 (GMT-04:00)
Subject: Pulse Audio -- Wine should have instructions on this web site
Message-ID: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>

This site purports to give instructions on how to run certain applications, including Skype (which is 32-bit). I think wine should have instructions here too. 

http://www.pulseaudio.org/wiki/PerfectSetup

It doesn't look like pulseaudio is going away from Ubuntu anytime soon.
https://bugs.launchpad.net/ubuntu/+source/pulseaudio/+bug/198453




From aric at codeweavers.com  Wed Apr  2 07:25:03 2008
From: aric at codeweavers.com (Aric Stewart)
Date: Wed, 02 Apr 2008 07:25:03 -0500
Subject: Recent imm changes triggered widespread valgrind errors?
In-Reply-To: <a71bd89a0804011716pdb12e47je28d04f474c8106@mail.gmail.com>
References: <a71bd89a0804011716pdb12e47je28d04f474c8106@mail.gmail.com>
Message-ID: <47F37B1F.40702@codeweavers.com>

Thanks for the heads up, With Alexandre's latest fix to the code do the 
valgrind errors persist?

-aric

Dan Kegel wrote:
> Aric, can you have a look?
> 
> Any call to CreateWindow now spews lots of Valgrind errors.
> For instance,
> http://kegel.com/wine/valgrind/logs-2008-04-01/vg-advpack_install-diff.txt
> contains:
> + Conditional jump or move depends on uninitialised value(s)
> +    at  RtlInitUnicodeString (unicode.h:212)
> +    by  LoadLibraryExW (module.c:924)
> +    by  LoadLibraryW (module.c:968)
> +    by  ImmCreateContext (imm.c:143)
> +    by  X11DRV_SetupXIM (xim.c:510)
> +    by  x11drv_init_thread_data (x11drv_main.c:654)
> +    by  X11DRV_SetWindowPos (x11drv.h:517)
> +    by  set_window_pos (winpos.c:1919)
> +    by  WIN_CreateWindowEx (win.c:1121)
> +    by  CreateWindowExW (win.c:1351)
> +    by  manage_desktop (desktop.c:224)
> +    by  WinMain (explorer.c:136)
> +    by  main (exe_main.c:48)
> 


From stefan at codeweavers.com  Wed Apr  2 07:56:21 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Wed, 2 Apr 2008 14:56:21 +0200
Subject: How can i bypass my bug?
In-Reply-To: <20080402111258.226330@gmx.net>
References: <f3a003030804020249p65745271gf9a30c47be25de44@mail.gmail.com>
	<20080402111258.226330@gmx.net>
Message-ID: <200804021456.21960.stefan@codeweavers.com>

Am Mittwoch, 2. April 2008 13:12:58 schrieb Roderick Colenbrander:
> Easy buy a simple videocard with vertex shader support we offer it on any
> card equal or better to a geforcefx / radeon 9500.
This game *needs* SW emulation - 2048 D3D vertex shader constants. A geforce 8 
might do the job though



From julliard at winehq.org  Wed Apr  2 07:20:22 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 02 Apr 2008 14:20:22 +0200
Subject: WINEX11.DRV: workaround for unstable window state while handling
	MapNotify (fixes bug 12196)
In-Reply-To: <47F2BAD6.5000702@palosanto.com> ("Alex =?utf-8?B?VmlsbGFj?=
	=?utf-8?B?w63CrXM=?= Lasso"'s message
	of "Tue, 01 Apr 2008 17:44:38 -0500")
References: <47F11BE5.40107@palosanto.com> <47F2BAD6.5000702@palosanto.com>
Message-ID: <87ve30cut5.fsf@wine.dyndns.org>

Alex Villac??s Lasso <a_villacis at palosanto.com> writes:

> Is this patch incorrect? Nobody has commented on it, and it has not been 
> applied either.

The concept is OK, but the implementation needs more work since
PropertyNotify is also triggered while waiting for the withdrawn state,
and you don't want to send messages to the window at that point. I'm
looking into it.

-- 
Alexandre Julliard
julliard at winehq.org


From paul.vriens.wine at gmail.com  Wed Apr  2 09:41:08 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Wed, 02 Apr 2008 16:41:08 +0200
Subject: Any particular reason we are using printf in the shlwapi/istream
	tests?
Message-ID: <47F39B04.8050307@gmail.com>

Hi,

Should these printf's be turned into trace/skip?

-- 
Cheers,

Paul.


From julliard at winehq.org  Wed Apr  2 09:45:05 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 02 Apr 2008 16:45:05 +0200
Subject: Any particular reason we are using printf in the shlwapi/istream
	tests?
In-Reply-To: <47F39B04.8050307@gmail.com> (Paul Vriens's message of "Wed, 02
	Apr 2008 16:41:08 +0200")
References: <47F39B04.8050307@gmail.com>
Message-ID: <87r6doco3y.fsf@wine.dyndns.org>

Paul Vriens <paul.vriens.wine at gmail.com> writes:

> Should these printf's be turned into trace/skip?

Yes.

-- 
Alexandre Julliard
julliard at winehq.org


From amorozov at etersoft.ru  Wed Apr  2 09:47:55 2008
From: amorozov at etersoft.ru (Alexander Morozov)
Date: Wed, 2 Apr 2008 18:47:55 +0400
Subject: [2/5] setupapi: Changing pointers on SP_DEVINFO_DATA
In-Reply-To: <87zlsccwk0.fsf@wine.dyndns.org>
References: <200804011524.20838.amorozov@etersoft.ru>
	<87zlsccwk0.fsf@wine.dyndns.org>
Message-ID: <200804021847.56378.amorozov@etersoft.ru>

> > SETUPDI_AddDeviceToSet: changing pointers on SP_DEVINFO_DATA after
> > allocating new memory block for their array
>
> We shouldn't have to do that sort of thing. The data structure should be
> fixed to store pointers that don't have to be moved around.

Should modify DeviceInfoSet and _SP_DEVINFO_DATA structures?
Without this patch so modified testRegisterAndGetDetail crashes:

--- a/dlls/setupapi/tests/devinst.c
+++ b/dlls/setupapi/tests/devinst.c
@@ -777,22 +777,26 @@ static void testRegisterAndGetDetail(voi
     SP_DEVINFO_DATA devInfo = { sizeof(SP_DEVINFO_DATA), { 0 } };
     SP_DEVICE_INTERFACE_DATA interfaceData = { sizeof(interfaceData), { 
0 } };
     DWORD dwSize = 0;
+    DWORD i;

     SetLastError(0xdeadbeef);
     set = pSetupDiGetClassDevsA(&guid, NULL, 0, DIGCF_ALLCLASSES);
     ok(set != INVALID_HANDLE_VALUE, "SetupDiGetClassDevsA failed: %08x\n",
      GetLastError());

-    SetLastError(0xdeadbeef);
-    ret = pSetupDiCreateDeviceInfoA(set, "LEGACY_BOGUS", &guid, NULL, 0,
-     DICD_GENERATE_ID, &devInfo);
-    ok(ret, "SetupDiCreateDeviceInfoA failed: %08x\n", GetLastError());
-    SetLastError(0xdeadbeef);
-    ret = pSetupDiCreateDeviceInterfaceA(set, &devInfo, &guid, NULL, 0, 
&interfaceData);
-    ok(ret, "SetupDiCreateDeviceInterfaceA failed: %08x\n", GetLastError());
-    SetLastError(0xdeadbeef);
-    ret = pSetupDiRegisterDeviceInfo(set, &devInfo, 0, NULL, NULL, NULL);
-    ok(ret, "SetupDiRegisterDeviceInfo failed: %08x\n", GetLastError());
+    for (i = 0; i < 10; ++i)
+    {
+        SetLastError(0xdeadbeef);
+        ret = pSetupDiCreateDeviceInfoA(set, "LEGACY_BOGUS", &guid, NULL, 0,
+         DICD_GENERATE_ID, &devInfo);
+        ok(ret, "SetupDiCreateDeviceInfoA failed: %08x\n", GetLastError());
+        SetLastError(0xdeadbeef);
+        ret = pSetupDiCreateDeviceInterfaceA(set, &devInfo, &guid, NULL, 0, 
&interfaceData);
+        ok(ret, "SetupDiCreateDeviceInterfaceA failed: %08x\n", 
GetLastError());
+        SetLastError(0xdeadbeef);
+        ret = pSetupDiRegisterDeviceInfo(set, &devInfo, 0, NULL, NULL, NULL);
+        ok(ret, "SetupDiRegisterDeviceInfo failed: %08x\n", GetLastError());
+    }

     pSetupDiDestroyDeviceInfoList(set);



From juan.lang at gmail.com  Wed Apr  2 09:53:07 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Wed, 2 Apr 2008 07:53:07 -0700
Subject: [2/5] setupapi: Changing pointers on SP_DEVINFO_DATA
In-Reply-To: <200804021847.56378.amorozov@etersoft.ru>
References: <200804011524.20838.amorozov@etersoft.ru>
	<87zlsccwk0.fsf@wine.dyndns.org>
	<200804021847.56378.amorozov@etersoft.ru>
Message-ID: <3a768c550804020753v2b697661p2c78520dc5e70b49@mail.gmail.com>

>  Should modify DeviceInfoSet and _SP_DEVINFO_DATA structures?

Yes.  A linked list would be more appropriate than an array.
Embarrassingly, this is the second time I've introduced such an error
into Wine.  Sorry for the mess.
--Juan


From susancragin at earthlink.net  Wed Apr  2 10:02:54 2008
From: susancragin at earthlink.net (Susan Cragin)
Date: Wed, 2 Apr 2008 11:02:54 -0400 (GMT-04:00)
Subject: re pulse issues
Message-ID: <14704625.1207148574344.JavaMail.root@elwamui-polski.atl.sa.earthlink.net>

wine-0.9.58-438-g997bea9

Just downloaded & compiled latest git and did winetricks fakeie6 gdiplus. 
Noticed the following, so I thought I'd pass it along FWIW.

Executing wine /home/susan/.winetrickscache/ppviewer.exe
ALSA lib pcm.c:2106:(snd_pcm_open_conf) Cannot open shared library /usr/lib/alsa-lib/libasound_module_pcm_pulse.so
ALSA lib pcm.c:2106:(snd_pcm_open_conf) Cannot open shared library /usr/lib/alsa-lib/libasound_module_pcm_pulse.so





From paul.vriens.wine at gmail.com  Wed Apr  2 10:15:36 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Wed, 02 Apr 2008 17:15:36 +0200
Subject: Any particular reason we are using printf in the shlwapi/istream
	tests?
In-Reply-To: <87r6doco3y.fsf@wine.dyndns.org>
References: <47F39B04.8050307@gmail.com> <87r6doco3y.fsf@wine.dyndns.org>
Message-ID: <47F3A318.6090806@gmail.com>

Alexandre Julliard wrote:
> Paul Vriens <paul.vriens.wine at gmail.com> writes:
> 
>> Should these printf's be turned into trace/skip?
> 
> Yes.
> 
Just sent in a patch for that.

Doing a quick (probably some false positives as well) gives:

comctl32/tests/imagelist.c
comctl32/tests/rebar.c
comctl32/tests/toolbar.c
crypt32/tests/encode.c
crypt32/tests/store.c
cryptnet/tests/cryptnet.c
gdi32/tests/dc.c
gdi32/tests/metafile.c
hlink/tests/hlink.c
imm32/tests/imm32.c
kernel32/tests/comm.c
kernel32/tests/file.c
kernel32/tests/format_msg.c
msi/tests/package.c
msvcrt/tests/printf.c
msvcrt/tests/string.c
msvcrt/tests/testlist.c
msvcrt/tests/time.c
ole32/tests/moniker.c
oleaut32/tests/typelib.c
rpcrt4/tests/rpc.c
rsaenh/tests/rsaenh.c
shell32/tests/shellpath.c
shell32/tests/shlexec.c
user32/tests/msg.c

that also have printf's in them. So another janitorial task?

-- 
Cheers,

Paul.


From mat at brain-dump.org  Wed Apr  2 10:18:27 2008
From: mat at brain-dump.org (Marc Andre Tanner)
Date: Wed, 02 Apr 2008 17:18:27 +0200
Subject: Some considerations about the Wine FUSE project for GSoC
In-Reply-To: <200804021011.25198.kai.blin@gmail.com>
References: <200803311415.18471.kai.blin@gmail.com>	<47F0E769.5020908@brain-dump.org>	<200803311608.09536.kai.blin@gmail.com>
	<200804021011.25198.kai.blin@gmail.com>
Message-ID: <47F3A3C3.3080902@brain-dump.org>

Kai Blin wrote:
> On Monday 31 March 2008 16:08:00 Kai Blin wrote:
>> On Monday 31 March 2008 15:30:17 Marc Andre Tanner wrote:
>>> I prototyped something and thought this way I would at least get some
>>> feedback (after all "Talk is cheap. Show me the code." is common
>>> practice in the open source world). But this wasn't really the
>>> case, so i am still wondering what should be done differently?
>> Whoops, I didn't see that url. Sorry, but things were a bit busy recently.
>> I'll give that a whirl later today.

Thanks for testing btw.

> I'm seeing some funny behaviour in a directory containing the files foo.txt, 
> Foo.txt and bAr.tXt
> 
> After mounting, I can only see a "foo.txt" in the directory,

That's intended, filenames which aren't all lower case are ignored.
This makes sure that there won't be conflicts. Ideally you should
start with an empty directory mount the fs and then untar your
actual content in mountpoint.

> containing the  Foo.txt contents.

This would be a bug, are you really sure you are getting the contents
of Foo.txt and not foo.txt? I ask because i can't reproduce it here.
If so could you please compile in debug support "make debug" and then
run ciopfs with option -d. This should print some debug information to
stderr.

Thanks,
Marc

-- 
  Marc Andre Tanner >< http://www.brain-dump.org/ >< GPG key: CF7D56C0


From dank at kegel.com  Wed Apr  2 10:52:53 2008
From: dank at kegel.com (Dan Kegel)
Date: Wed, 2 Apr 2008 08:52:53 -0700
Subject: Recent imm changes triggered widespread valgrind errors?
In-Reply-To: <47F37B1F.40702@codeweavers.com>
References: <a71bd89a0804011716pdb12e47je28d04f474c8106@mail.gmail.com>
	<47F37B1F.40702@codeweavers.com>
Message-ID: <a71bd89a0804020852r676aad26h8ed95ba43d41fbbb@mail.gmail.com>

On Wed, Apr 2, 2008 at 5:25 AM, Aric Stewart <aric at codeweavers.com> wrote:
> Thanks for the heads up, With Alexandre's latest fix to the code do the
> valgrind errors persist?

Things look rather better today.


From jacek at codeweavers.com  Wed Apr  2 13:21:02 2008
From: jacek at codeweavers.com (Jacek Caban)
Date: Wed, 02 Apr 2008 18:21:02 +0000
Subject: mshtml: Added registry configuration to allow using Active Script
	engine for JavaScript scripts.
In-Reply-To: <87d4p8ehnf.fsf@wine.dyndns.org>
References: <47F220F9.2030308@codeweavers.com> <87d4p8ehnf.fsf@wine.dyndns.org>
Message-ID: <47F3CE8E.9060705@codeweavers.com>

Alexandre Julliard wrote:
> Jacek Caban <jacek at codeweavers.com> writes:
>
>   
>> +    static const WCHAR key_nameW[] =
>> +        {'S','o','f','t','w','a','r','e',
>> +         '\\','W','i','n','e',
>> +         '\\','M','S','H','T','M','L',
>> +         '\\','S','c','r','i','p','t','O','v','e','r','r','i','d','e','s',0};
>> +
>> +    /* @@ Wine registry key: HKCU\Software\Wine\MSHTML\ScriptOverrides */
>> +    res = RegOpenKeyW(HKEY_CURRENT_USER, key_nameW, &hkey);
>> +    if(res != ERROR_SUCCESS)
>> +        return ret;
>>     
>
> Why do we need a configuration option for this?  When would a user want
> to change it?
>   


This is for IE-specific scripts in HTMLs. We currently use Gecko for 
doing everything with scripts for us. It means that IE only pages won't 
work mainly due to incompatibilities in DOM API. Even worse case are 
apps that communicate with hosting apps via window.extern object. To 
make them work we need to run script in a real Active Script engine. 
What we can do is quite tricky, but it already works for other script 
languages in current Git (well, not much more than "Hello World" scripts 
work ATM, but I'm working on this). The problem is that in case of 
JavaScript we have to choose if we want Gecko or our JavaScript engine. 
There is no way to determine it automatically, so configurable option is 
needed. I've chosen to use per URL configuration as it seems to be the 
best way. Due to number of DOM API to be implemented and security issues 
I don't think we'll ever make Active Script mode default and it's not 
the goal, but when we'll have our own jscript.dll implementation 
(currently one needs to use native version for tests), we may consider 
some heuristics like using Active Script for c:/Program Files/Common 
Files/* HTMLs.


Jacek


From kai.blin at gmail.com  Wed Apr  2 11:52:59 2008
From: kai.blin at gmail.com (Kai Blin)
Date: Wed, 2 Apr 2008 18:52:59 +0200
Subject: Some considerations about the Wine FUSE project for GSoC
In-Reply-To: <47F3A3C3.3080902@brain-dump.org>
References: <200803311415.18471.kai.blin@gmail.com>
	<200804021011.25198.kai.blin@gmail.com>
	<47F3A3C3.3080902@brain-dump.org>
Message-ID: <200804021852.59495.kai.blin@gmail.com>

On Wednesday 02 April 2008 17:18:27 Marc Andre Tanner wrote:

> > containing the  Foo.txt contents.
>
> This would be a bug, are you really sure you are getting the contents
> of Foo.txt and not foo.txt?

My bad, I must have misread. It's the contents of the lower case file.

Cheers,
Kai

-- 
Kai Blin
WorldForge developer  http://www.worldforge.org/
Wine developer        http://wiki.winehq.org/KaiBlin
Samba team member     http://www.samba.org/samba/team/
--
Will code for cotton.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080402/79ada5d0/attachment.pgp 

From ryuzaki90 at gmail.com  Wed Apr  2 10:08:06 2008
From: ryuzaki90 at gmail.com (Bryan Haskins)
Date: Wed, 2 Apr 2008 10:08:06 -0500
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>
Message-ID: <7e33d29b0804020808m558534f8q1d7430c219cfbc26@mail.gmail.com>

I'm more interested in a direct pulseaudio gateway for Wine... since by
application sound control is the biggest thing here for most people.... wine
is treated as one big audio blob. Pulse sees it as one thing. In effect,
wine handles it's own audio (by talking with ALSA or OSS) then passes that
through to the outside sound server... which in most cases would simply be
ALSA or OSS itself, but in this case it gets passed to ALSA/OSS and through
this talks to pulse. I call that pretty messy when we could just directly
talk to pulse audio (easily, too) and have by applications control. Pulse is
going to be in pretty much every distro soon. For a 1.0 release, no one
wants to go out of their way to accomodate the shortcomings of our audio
control.

Even directly sending the blobof output to pulse directly at first would
simplify things. I know this means yet asnother audio output method to
maintain, and for various reasons many are against it. But this is similar
to us needing to improve ALSA support rather recently. Pulseaudio does
directly support ALSA, but it's a bit demanding on how it need to work to be
perfect.

ALSA, Pulseaudio, and OSS are probably the big three we need support for.
Pulse is a drop in replacement for things like Network Sound, and way easier
to configure and use.

Sorry for expanding the topic so much.

On 4/2/08, Susan Cragin <susancragin at earthlink.net> wrote:
>
> This site purports to give instructions on how to run certain
> applications, including Skype (which is 32-bit). I think wine should have
> instructions here too.
>
> http://www.pulseaudio.org/wiki/PerfectSetup
>
> It doesn't look like pulseaudio is going away from Ubuntu anytime soon.
> https://bugs.launchpad.net/ubuntu/+source/pulseaudio/+bug/198453
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080402/0bd1ab9d/attachment.htm 

From austinenglish at gmail.com  Wed Apr  2 13:05:29 2008
From: austinenglish at gmail.com (Austin English)
Date: Wed, 2 Apr 2008 13:05:29 -0500
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <7e33d29b0804020808m558534f8q1d7430c219cfbc26@mail.gmail.com>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>
	<7e33d29b0804020808m558534f8q1d7430c219cfbc26@mail.gmail.com>
Message-ID: <b6bb06270804021105v63c03b37nd9e47e72a2a338c6@mail.gmail.com>

On Wed, Apr 2, 2008 at 10:08 AM, Bryan Haskins <ryuzaki90 at gmail.com> wrote:
> I'm more interested in a direct pulseaudio gateway for Wine... since by
> application sound control is the biggest thing here for most people.... wine
> is treated as one big audio blob. Pulse sees it as one thing. In effect,
> wine handles it's own audio (by talking with ALSA or OSS) then passes that
> through to the outside sound server... which in most cases would simply be
> ALSA or OSS itself, but in this case it gets passed to ALSA/OSS and through
> this talks to pulse. I call that pretty messy when we could just directly
> talk to pulse audio (easily, too) and have by applications control. Pulse is
> going to be in pretty much every distro soon. For a 1.0 release, no one
> wants to go out of their way to accomodate the shortcomings of our audio
> control.
>
>  Even directly sending the blobof output to pulse directly at first would
> simplify things. I know this means yet asnother audio output method to
> maintain, and for various reasons many are against it. But this is similar
> to us needing to improve ALSA support rather recently. Pulseaudio does
> directly support ALSA, but it's a bit demanding on how it need to work to be
> perfect.
>
>  ALSA, Pulseaudio, and OSS are probably the big three we need support for.
> Pulse is a drop in replacement for things like Network Sound, and way easier
> to configure and use.
>
>  Sorry for expanding the topic so much.
>
>
>
> On 4/2/08, Susan Cragin <susancragin at earthlink.net> wrote:
> > This site purports to give instructions on how to run certain
> applications, including Skype (which is 32-bit). I think wine should have
> instructions here too.
> >
> > http://www.pulseaudio.org/wiki/PerfectSetup
> >
> > It doesn't look like pulseaudio is going away from Ubuntu anytime soon.
> > https://bugs.launchpad.net/ubuntu/+source/pulseaudio/+bug/198453
> >
> >
> >
> >
> >
>
>
>
>
>

This has been brought up before, and it's quite a bit of work. You
can't just simply forward everything to pulse call it a day, you'd
need to implement a full structure/drivers/etc., which would require
quite a bit of time/work and is likely outside of the scope of 1.0.


From truiken at gmail.com  Wed Apr  2 13:33:23 2008
From: truiken at gmail.com (James Hawkins)
Date: Wed, 2 Apr 2008 13:33:23 -0500
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <b6bb06270804021105v63c03b37nd9e47e72a2a338c6@mail.gmail.com>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>
	<7e33d29b0804020808m558534f8q1d7430c219cfbc26@mail.gmail.com>
	<b6bb06270804021105v63c03b37nd9e47e72a2a338c6@mail.gmail.com>
Message-ID: <22821af30804021133m46c0c78dy76debaec3d48bc9a@mail.gmail.com>

On Wed, Apr 2, 2008 at 1:05 PM, Austin English <austinenglish at gmail.com> wrote:
>
> On Wed, Apr 2, 2008 at 10:08 AM, Bryan Haskins <ryuzaki90 at gmail.com> wrote:
>  > I'm more interested in a direct pulseaudio gateway for Wine... since by
>  > application sound control is the biggest thing here for most people.... wine
>  > is treated as one big audio blob. Pulse sees it as one thing. In effect,
>  > wine handles it's own audio (by talking with ALSA or OSS) then passes that
>  > through to the outside sound server... which in most cases would simply be
>  > ALSA or OSS itself, but in this case it gets passed to ALSA/OSS and through
>  > this talks to pulse. I call that pretty messy when we could just directly
>  > talk to pulse audio (easily, too) and have by applications control. Pulse is
>  > going to be in pretty much every distro soon. For a 1.0 release, no one
>  > wants to go out of their way to accomodate the shortcomings of our audio
>  > control.
>  >
>  >  Even directly sending the blobof output to pulse directly at first would
>  > simplify things. I know this means yet asnother audio output method to
>  > maintain, and for various reasons many are against it. But this is similar
>  > to us needing to improve ALSA support rather recently. Pulseaudio does
>  > directly support ALSA, but it's a bit demanding on how it need to work to be
>  > perfect.
>  >
>  >  ALSA, Pulseaudio, and OSS are probably the big three we need support for.
>  > Pulse is a drop in replacement for things like Network Sound, and way easier
>  > to configure and use.
>  >
>  >  Sorry for expanding the topic so much.
>  >
>  >
>  >
>  > On 4/2/08, Susan Cragin <susancragin at earthlink.net> wrote:
>  > > This site purports to give instructions on how to run certain
>  > applications, including Skype (which is 32-bit). I think wine should have
>  > instructions here too.
>  > >
>  > > http://www.pulseaudio.org/wiki/PerfectSetup
>  > >
>  > > It doesn't look like pulseaudio is going away from Ubuntu anytime soon.
>  > > https://bugs.launchpad.net/ubuntu/+source/pulseaudio/+bug/198453
>  > >
>  > >
>  > >
>  > >
>  > >
>  >
>  >
>  >
>  >
>  >
>
>  This has been brought up before, and it's quite a bit of work. You
>  can't just simply forward everything to pulse call it a day, you'd
>  need to implement a full structure/drivers/etc., which would require
>  quite a bit of time/work and is likely outside of the scope of 1.0.
>

And I believe Julliard rejected the idea of adding a pulseaudio driver.

-- 
James Hawkins


From dsh at linux.ucla.edu  Wed Apr  2 13:46:27 2008
From: dsh at linux.ucla.edu (Dan Hipschman)
Date: Wed, 2 Apr 2008 11:46:27 -0700
Subject: [PATCH 4/7] widl: Support __fastcall and __pascal calling
	conventions.
In-Reply-To: <47F37465.3050105@codeweavers.com>
References: <47F37465.3050105@codeweavers.com>
Message-ID: <20080402184627.GE4608@linux.ucla.edu>

On Wed, Apr 02, 2008 at 12:56:21PM +0100, Robert Shearman wrote:
> @@ -186,13 +186,19 @@ static const struct keyword keywords[] = {
>  	{"FALSE",			tFALSE},
>  	{"TRUE",			tTRUE},
>  	{"__cdecl",			tCDECL},
> +	{"__fastcall",			tFASTCALL},
> +	{"__pascal",			tPASCAL},
>  	{"__int64",			tINT64},
>  	{"__stdcall",			tSTDCALL},

__pascal should come after __int64.


From thestig at google.com  Wed Apr  2 13:51:40 2008
From: thestig at google.com (Lei Zhang)
Date: Wed, 2 Apr 2008 11:51:40 -0700
Subject: testing 3d graphics with vmware workstation 6.5 beta?
Message-ID: <558b2f5c0804021151h50c4d5f9o8f6dbd63f961c4c1@mail.gmail.com>

I just got an email about the next vmware workstation beta:

"Improved 3D graphics Support ? Workstation 6.5 can now support
DirectX9.0 accelerated 3D with shaders so you can run more
applications inside your VM."

Maybe this will help with running the 3d graphics test suite in
virtual machines?

http://communities.vmware.com/community/beta/workstation6.5


From mstefani at redhat.com  Wed Apr  2 13:52:31 2008
From: mstefani at redhat.com (Michael Stefaniuc)
Date: Wed, 02 Apr 2008 20:52:31 +0200
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <22821af30804021133m46c0c78dy76debaec3d48bc9a@mail.gmail.com>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>	<7e33d29b0804020808m558534f8q1d7430c219cfbc26@mail.gmail.com>	<b6bb06270804021105v63c03b37nd9e47e72a2a338c6@mail.gmail.com>
	<22821af30804021133m46c0c78dy76debaec3d48bc9a@mail.gmail.com>
Message-ID: <47F3D5EF.2030001@redhat.com>

James Hawkins wrote:
> On Wed, Apr 2, 2008 at 1:05 PM, Austin English <austinenglish at gmail.com> wrote:
>> On Wed, Apr 2, 2008 at 10:08 AM, Bryan Haskins <ryuzaki90 at gmail.com> wrote:
>>  > I'm more interested in a direct pulseaudio gateway for Wine... since by
>>  > application sound control is the biggest thing here for most people.... wine
>>  > is treated as one big audio blob. Pulse sees it as one thing. In effect,
>>  > wine handles it's own audio (by talking with ALSA or OSS) then passes that
>>  > through to the outside sound server... which in most cases would simply be
>>  > ALSA or OSS itself, but in this case it gets passed to ALSA/OSS and through
>>  > this talks to pulse. I call that pretty messy when we could just directly
>>  > talk to pulse audio (easily, too) and have by applications control. Pulse is
>>  > going to be in pretty much every distro soon. For a 1.0 release, no one
>>  > wants to go out of their way to accomodate the shortcomings of our audio
>>  > control.
>>  >
>>  >  Even directly sending the blobof output to pulse directly at first would
>>  > simplify things. I know this means yet asnother audio output method to
>>  > maintain, and for various reasons many are against it. But this is similar
>>  > to us needing to improve ALSA support rather recently. Pulseaudio does
>>  > directly support ALSA, but it's a bit demanding on how it need to work to be
>>  > perfect.
>>  >
>>  >  ALSA, Pulseaudio, and OSS are probably the big three we need support for.
>>  > Pulse is a drop in replacement for things like Network Sound, and way easier
>>  > to configure and use.
>>  >
>>  >  Sorry for expanding the topic so much.
>>  >


>>
>>  This has been brought up before, and it's quite a bit of work. You
>>  can't just simply forward everything to pulse call it a day, you'd
>>  need to implement a full structure/drivers/etc., which would require
>>  quite a bit of time/work and is likely outside of the scope of 1.0.
>>
> 
> And I believe Julliard rejected the idea of adding a pulseaudio driver.
Nope! He isn't against a pulseaudio driver. He is against yet another
broken and half implemented driver for the desktop sound system that
happens to be en vogue at the moment.

I think he would love to see a clean, full implemented pulseaudio
driver; presented in a nice easy review-able patch series which cleans
up the wineaudio driver mess en passant.

bye
	michael


From kwixbit at gmail.com  Wed Apr  2 13:57:29 2008
From: kwixbit at gmail.com (Warren Dumortier)
Date: Wed, 2 Apr 2008 20:57:29 +0200
Subject: How can i bypass my bug?
In-Reply-To: <200804021456.21960.stefan@codeweavers.com>
References: <f3a003030804020249p65745271gf9a30c47be25de44@mail.gmail.com>
	<20080402111258.226330@gmx.net>
	<200804021456.21960.stefan@codeweavers.com>
Message-ID: <f3a003030804021157r70e2f422wcd263730897dc243@mail.gmail.com>

I don't understand, it is a wine bug, not a hardware problem?
I have a geforce 7600GT and knows it works, but don't have windows anymore...

2008/4/2, Stefan D?singer <stefan at codeweavers.com>:
> Am Mittwoch, 2. April 2008 13:12:58 schrieb Roderick Colenbrander:
>
> > Easy buy a simple videocard with vertex shader support we offer it on any
>  > card equal or better to a geforcefx / radeon 9500.
>
> This game *needs* SW emulation - 2048 D3D vertex shader constants. A geforce 8
>  might do the job though
>
>


From truiken at gmail.com  Wed Apr  2 13:59:58 2008
From: truiken at gmail.com (James Hawkins)
Date: Wed, 2 Apr 2008 13:59:58 -0500
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <47F3D5EF.2030001@redhat.com>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>
	<7e33d29b0804020808m558534f8q1d7430c219cfbc26@mail.gmail.com>
	<b6bb06270804021105v63c03b37nd9e47e72a2a338c6@mail.gmail.com>
	<22821af30804021133m46c0c78dy76debaec3d48bc9a@mail.gmail.com>
	<47F3D5EF.2030001@redhat.com>
Message-ID: <22821af30804021159w70ab3327m26ebb9b325c82b1b@mail.gmail.com>

On Wed, Apr 2, 2008 at 1:52 PM, Michael Stefaniuc <mstefani at redhat.com> wrote:
> James Hawkins wrote:
>  > On Wed, Apr 2, 2008 at 1:05 PM, Austin English <austinenglish at gmail.com> wrote:
>  >> On Wed, Apr 2, 2008 at 10:08 AM, Bryan Haskins <ryuzaki90 at gmail.com> wrote:
>  >>  > I'm more interested in a direct pulseaudio gateway for Wine... since by
>  >>  > application sound control is the biggest thing here for most people.... wine
>  >>  > is treated as one big audio blob. Pulse sees it as one thing. In effect,
>  >>  > wine handles it's own audio (by talking with ALSA or OSS) then passes that
>  >>  > through to the outside sound server... which in most cases would simply be
>  >>  > ALSA or OSS itself, but in this case it gets passed to ALSA/OSS and through
>  >>  > this talks to pulse. I call that pretty messy when we could just directly
>  >>  > talk to pulse audio (easily, too) and have by applications control. Pulse is
>  >>  > going to be in pretty much every distro soon. For a 1.0 release, no one
>  >>  > wants to go out of their way to accomodate the shortcomings of our audio
>  >>  > control.
>  >>  >
>  >>  >  Even directly sending the blobof output to pulse directly at first would
>  >>  > simplify things. I know this means yet asnother audio output method to
>  >>  > maintain, and for various reasons many are against it. But this is similar
>  >>  > to us needing to improve ALSA support rather recently. Pulseaudio does
>  >>  > directly support ALSA, but it's a bit demanding on how it need to work to be
>  >>  > perfect.
>  >>  >
>  >>  >  ALSA, Pulseaudio, and OSS are probably the big three we need support for.
>  >>  > Pulse is a drop in replacement for things like Network Sound, and way easier
>  >>  > to configure and use.
>  >>  >
>  >>  >  Sorry for expanding the topic so much.
>  >>  >
>
>
>  >>
>
> >>  This has been brought up before, and it's quite a bit of work. You
>  >>  can't just simply forward everything to pulse call it a day, you'd
>  >>  need to implement a full structure/drivers/etc., which would require
>  >>  quite a bit of time/work and is likely outside of the scope of 1.0.
>  >>
>  >
>  > And I believe Julliard rejected the idea of adding a pulseaudio driver.
>  Nope! He isn't against a pulseaudio driver. He is against yet another
>  broken and half implemented driver for the desktop sound system that
>  happens to be en vogue at the moment.
>
>  I think he would love to see a clean, full implemented pulseaudio
>  driver; presented in a nice easy review-able patch series which cleans
>  up the wineaudio driver mess en passant.
>

"No, the right answer is to make the Alsa driver work right. We need to
stop rushing out to write a new driver every time there's a problem with
an existing one, all it leads to is more broken drivers."
-Julliard

http://winehq.org/pipermail/wine-devel/2008-March/063755.html

-- 
James Hawkins


From marcus at jet.franken.de  Wed Apr  2 14:12:54 2008
From: marcus at jet.franken.de (Marcus Meissner)
Date: Wed, 2 Apr 2008 21:12:54 +0200
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <22821af30804021159w70ab3327m26ebb9b325c82b1b@mail.gmail.com>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>
	<7e33d29b0804020808m558534f8q1d7430c219cfbc26@mail.gmail.com>
	<b6bb06270804021105v63c03b37nd9e47e72a2a338c6@mail.gmail.com>
	<22821af30804021133m46c0c78dy76debaec3d48bc9a@mail.gmail.com>
	<47F3D5EF.2030001@redhat.com>
	<22821af30804021159w70ab3327m26ebb9b325c82b1b@mail.gmail.com>
Message-ID: <20080402191254.GA4822@galeere>

> > >>  This has been brought up before, and it's quite a bit of work. You
> >  >>  can't just simply forward everything to pulse call it a day, you'd
> >  >>  need to implement a full structure/drivers/etc., which would require
> >  >>  quite a bit of time/work and is likely outside of the scope of 1.0.
> >  >>
> >  >
> >  > And I believe Julliard rejected the idea of adding a pulseaudio driver.
> >  Nope! He isn't against a pulseaudio driver. He is against yet another
> >  broken and half implemented driver for the desktop sound system that
> >  happens to be en vogue at the moment.
> >
> >  I think he would love to see a clean, full implemented pulseaudio
> >  driver; presented in a nice easy review-able patch series which cleans
> >  up the wineaudio driver mess en passant.
> >
> 
> "No, the right answer is to make the Alsa driver work right. We need to
> stop rushing out to write a new driver every time there's a problem with
> an existing one, all it leads to is more broken drivers."
> -Julliard
> 
> http://winehq.org/pipermail/wine-devel/2008-March/063755.html

... I also guess no one is stopping people from writing a pulseaudio driver.

Its just that it needs to make certain criteria before inclusion, after we
got burned with esound, arts, nas, etc etc etc etc.

Ciao, Marcus


From tehblunderbuss at gmail.com  Wed Apr  2 14:23:55 2008
From: tehblunderbuss at gmail.com (TheBlunderbuss)
Date: Wed, 02 Apr 2008 14:23:55 -0500
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <20080402191254.GA4822@galeere>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>	<7e33d29b0804020808m558534f8q1d7430c219cfbc26@mail.gmail.com>	<b6bb06270804021105v63c03b37nd9e47e72a2a338c6@mail.gmail.com>	<22821af30804021133m46c0c78dy76debaec3d48bc9a@mail.gmail.com>	<47F3D5EF.2030001@redhat.com>	<22821af30804021159w70ab3327m26ebb9b325c82b1b@mail.gmail.com>
	<20080402191254.GA4822@galeere>
Message-ID: <47F3DD4B.60604@gmail.com>

Marcus Meissner wrote:
> ... I also guess no one is stopping people from writing a pulseaudio driver.
>
> Its just that it needs to make certain criteria before inclusion, after we
> got burned with esound, arts, nas, etc etc etc etc.
>
> Ciao, Marcus
Correct. There is a pulse driver for Wine being worked on, but outside 
the Wine project (ie "not us").


From mstefani at redhat.com  Wed Apr  2 14:28:23 2008
From: mstefani at redhat.com (Michael Stefaniuc)
Date: Wed, 02 Apr 2008 21:28:23 +0200
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <22821af30804021159w70ab3327m26ebb9b325c82b1b@mail.gmail.com>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>	<7e33d29b0804020808m558534f8q1d7430c219cfbc26@mail.gmail.com>	<b6bb06270804021105v63c03b37nd9e47e72a2a338c6@mail.gmail.com>	<22821af30804021133m46c0c78dy76debaec3d48bc9a@mail.gmail.com>	<47F3D5EF.2030001@redhat.com>
	<22821af30804021159w70ab3327m26ebb9b325c82b1b@mail.gmail.com>
Message-ID: <47F3DE57.7050508@redhat.com>

James Hawkins wrote:
> On Wed, Apr 2, 2008 at 1:52 PM, Michael Stefaniuc <mstefani at redhat.com> wrote:
>> James Hawkins wrote:

>>  > And I believe Julliard rejected the idea of adding a pulseaudio driver.
>>  Nope! He isn't against a pulseaudio driver. He is against yet another
>>  broken and half implemented driver for the desktop sound system that
>>  happens to be en vogue at the moment.
>>
>>  I think he would love to see a clean, full implemented pulseaudio
>>  driver; presented in a nice easy review-able patch series which cleans
>>  up the wineaudio driver mess en passant.
>>
> 
> "No, the right answer is to make the Alsa driver work right. We need to
> stop rushing out to write a new driver every time there's a problem with
> an existing one, all it leads to is more broken drivers."
> -Julliard
> 
> http://winehq.org/pipermail/wine-devel/2008-March/063755.html
Right, forgot about that one. But I am still sure he would accept a
"perfect" full featured and beautiful written pulseaudio driver. What he
doesn't wants at all is wasting precious Wine developer time on creating
one in his Wine git repository. And having it rot there because in 1-2
years all of todays pulseaudio proponents will complain how broken
pulseaudio is and how much better this "yet another audio system 2.0" is
and why Wine _needs_ to implement that one.

So if one of the proponents of pulseaudio for Wine would just go ahead
and start writing one, for example on git.or.cz Alexandre wouldn't mind
at all. Convincing the distributions to include the pulseaudio driver
should be an easy selling especially for Fedora and Ubuntu who seem to
move to "pulseaudio will fix everything".


bye
   michael "who fixed the sound on his desktop by removing pulseaudio"


From stefan at codeweavers.com  Wed Apr  2 14:44:41 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Wed, 2 Apr 2008 21:44:41 +0200
Subject: How can i bypass my bug?
In-Reply-To: <f3a003030804021157r70e2f422wcd263730897dc243@mail.gmail.com>
References: <f3a003030804020249p65745271gf9a30c47be25de44@mail.gmail.com>
	<200804021456.21960.stefan@codeweavers.com>
	<f3a003030804021157r70e2f422wcd263730897dc243@mail.gmail.com>
Message-ID: <200804022144.42148.stefan@codeweavers.com>

Am Mittwoch, 2. April 2008 20:57:29 schrieb Warren Dumortier:
> I don't understand, it is a wine bug, not a hardware problem?
> I have a geforce 7600GT and knows it works, but don't have windows
> anymore...
Correct, it is a Wine bug. A Geforce 8 might work around it though


From xixsimplicityxix at gmail.com  Wed Apr  2 14:51:34 2008
From: xixsimplicityxix at gmail.com (John Klehm)
Date: Wed, 2 Apr 2008 14:51:34 -0500
Subject: MinGW cross compilation fails for d3dx9_36/tests
In-Reply-To: <78a7dad00803280405w3da1fd8dv383a1c7dc6688bfa@mail.gmail.com>
References: <47E8C0FC.2010700@gmail.com> <20080325093948.145810@gmx.net>
	<78a7dad00803280405w3da1fd8dv383a1c7dc6688bfa@mail.gmail.com>
Message-ID: <78a7dad00804021251o444fc651y4bd64648f0b2b0bd@mail.gmail.com>

On Fri, Mar 28, 2008 at 6:05 AM, John Klehm <xixsimplicityxix at gmail.com> wrote:
>
>  Well let me know how this works for you.  I'll refactor my script a
>  bit later today but for right now you have to run this one after the
>  winetest script, as this one counts on the environment that the

Here's the refactored script [1].  With some inspiration from winetricks ;)

Example uses:
$crossbuild_tricks winetest

$crossbuild_tricks d3d
=> builds d3d8,d3d9,wined3d, libwine

$crossbuild_tricks test cabinet
=> use test verb for individual tests

$crossbuild_tricks dll wintrust
=> use dll verb for individual dlls


First release and I've tested it some, seems to work but let me know
if it breaks for you.


Regards,
John

[1] http://klehm.net/wine/crossbuild_tricks.sh


From austinenglish at gmail.com  Wed Apr  2 15:01:54 2008
From: austinenglish at gmail.com (Austin English)
Date: Wed, 2 Apr 2008 15:01:54 -0500
Subject: Nice feature?
In-Reply-To: <f3a003030804020245k619eb8c7j9e690f5839b7ab6e@mail.gmail.com>
References: <f3a003030804020245k619eb8c7j9e690f5839b7ab6e@mail.gmail.com>
Message-ID: <b6bb06270804021301o62254e6bie18023a868ea1655@mail.gmail.com>

On Wed, Apr 2, 2008 at 4:45 AM, Warren Dumortier <kwixbit at gmail.com> wrote:
> Hello!
> I have a little proposition for Wine 1.0!
> Why not creating an error dialog when a dll is missing, it would help a lot
> of users!
> For example there's a dialog to install geck, why not a dialog that simply
> says you have to add a dll in the correct directory?
>
>
>
>

When you say a missing dll, that could mean a few things. I'm assuming
you mean the typical case of a dll that should have been redistributed
with an app, but was not, and the application expects it to already be
present. Or the case of a failing installer failing to copy all files?
If so, these errors are already put out to stderr, like most other
warnings.


From julliard at winehq.org  Wed Apr  2 16:24:48 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 02 Apr 2008 23:24:48 +0200
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <47F3DE57.7050508@redhat.com> (Michael Stefaniuc's message of
	"Wed, 02 Apr 2008 21:28:23 +0200")
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>
	<7e33d29b0804020808m558534f8q1d7430c219cfbc26@mail.gmail.com>
	<b6bb06270804021105v63c03b37nd9e47e72a2a338c6@mail.gmail.com>
	<22821af30804021133m46c0c78dy76debaec3d48bc9a@mail.gmail.com>
	<47F3D5EF.2030001@redhat.com>
	<22821af30804021159w70ab3327m26ebb9b325c82b1b@mail.gmail.com>
	<47F3DE57.7050508@redhat.com>
Message-ID: <87k5jgc5lr.fsf@wine.dyndns.org>

Michael Stefaniuc <mstefani at redhat.com> writes:

> Right, forgot about that one. But I am still sure he would accept a
> "perfect" full featured and beautiful written pulseaudio driver. What he
> doesn't wants at all is wasting precious Wine developer time on creating
> one in his Wine git repository. And having it rot there because in 1-2
> years all of todays pulseaudio proponents will complain how broken
> pulseaudio is and how much better this "yet another audio system 2.0" is
> and why Wine _needs_ to implement that one.

What I really want is for all the people who are clamoring for yet
another driver to pitch in and start fixing the alsa driver instead.

Once this is done and we have demonstrated that we can actually make one
driver work 100% correctly, then we can consider adding another one.

-- 
Alexandre Julliard
julliard at winehq.org


From stefan at codeweavers.com  Wed Apr  2 16:29:19 2008
From: stefan at codeweavers.com (Stefan =?windows-1252?q?D=F6singer?=)
Date: Wed, 2 Apr 2008 23:29:19 +0200
Subject: testing 3d graphics with vmware workstation 6.5 beta?
In-Reply-To: <558b2f5c0804021151h50c4d5f9o8f6dbd63f961c4c1@mail.gmail.com>
References: <558b2f5c0804021151h50c4d5f9o8f6dbd63f961c4c1@mail.gmail.com>
Message-ID: <200804022329.19575.stefan@codeweavers.com>

Am Mittwoch, 2. April 2008 20:51:40 schrieb Lei Zhang:
> I just got an email about the next vmware workstation beta:
>
> "Improved 3D graphics Support ? Workstation 6.5 can now support
> DirectX9.0 accelerated 3D with shaders so you can run more
> applications inside your VM."
>
> Maybe this will help with running the 3d graphics test suite in
> virtual machines?
Just give it a try I'd say. I doubt they got the shader stuff right on the 
first try, even if they tested with DCT(which is not available any more)





From dank at kegel.com  Wed Apr  2 16:31:15 2008
From: dank at kegel.com (Dan Kegel)
Date: Wed, 2 Apr 2008 14:31:15 -0700
Subject: New winetricks 20080402: new verbs dotnet20, win2k, flash, msls31;
	updated mono, liberation
Message-ID: <a71bd89a0804021431w79515034i84ff0e4c57af3353@mail.gmail.com>

Big news: as of today or so, wine doesn't need any patches
to install the .net 2.0 runtime or run trivial .net 2.0 apps,
so I've added a dotnet20 verb.  No more futzing with recipes
to try out simple .net 2 apps, huzzah!

There are lots of other little changes, too:

20080402
r21  	Added dotnet20, removed one kludge from dotnet11, added win2k
verb, plus shorthand for winver=foo
r20 	Updated liberation fonts.

20080328
r19 	Added flash.

20080326
r18 	Fix i18n problem reported by Ricardo Cabral

20080321
r17 	Added msls31 (seems to be needed by e-Sword)

20080317
r16 	update mono12 to 1.2.9

...

As always, winetricks is downloadable from
http://kegel.com/wine/winetricks
and change history is at
http://code.google.com/p/winezeug

Thanks to the folks who keep feeding me improvements and suggestions!
- Dan


From austinenglish at gmail.com  Wed Apr  2 17:05:37 2008
From: austinenglish at gmail.com (Austin English)
Date: Wed, 2 Apr 2008 17:05:37 -0500
Subject: Make test - opengl regression
Message-ID: <b6bb06270804021505r6b25a45au8912e625f59abbb0@mail.gmail.com>

Running on my virtualbox feisty vm, seems make test is making some progress:

austin at austin-desktop:~/wine-git$ cat wine-0.9.58-439-g73bd68c.txt |
grep 'make.*Error'
make[2]: *** [exception.ok] Error 1
make[1]: *** [ntdll/tests/__test__] Error 2
make[2]: *** [opengl.ok] Error 1
make[1]: *** [opengl32/tests/__test__] Error 2
make[2]: *** [msg.ok] Error 24
make[1]: *** [user32/tests/__test__] Error 2
make: *** [dlls/__test__] Error 2

The visual.c's are skipping properly now for me, but there's a
regression in opengl/opengl.c.

../../../tools/runtest -q -P wine -M opengl32.dll -T ../../.. -p
opengl32_test.exe.so opengl.c && touch opengl.ok
err:wgl:X11DRV_wglCreateContext Cannot get FB Config for iPixelFormat
0, expect problems!
opengl.c:248: Test failed: Unable to confirm DONTCARE behavior of
unset pixelformatdescriptor flags
err:wgl:X11DRV_SetPixelFormat Invalid operation on root_window
opengl.c:323: Tests skipped: No suitable pixel formats found
make: *** [opengl.ok] Error 1

I haven't ran a regression test yet, but if you want more logs or a
regression test, let me know.


From Andrew.Talbot at talbotville.com  Wed Apr  2 17:12:44 2008
From: Andrew.Talbot at talbotville.com (Andrew Talbot)
Date: Wed, 02 Apr 2008 23:12:44 +0100
Subject: msi: Remove tentative definition of static array with no size
	specifier
References: <200804022307.55734.andrew.talbot@talbotville.com>
Message-ID: <ft10cs$6id$1@ger.gmane.org>

Andrew Talbot wrote:

> strictly, when the static storage specifier is applied, the size must be
> specified:
> 
>     static char ar[5];           /* tentative definition */
> 
>     static char ar[5] = "hello"; /* actual definition */
> 

Of course, the size need not be specified in the case of the actual
definition, so the following is what I should have typed.

    static char a[] = "hello"; /* actual definition */

-- 
Andy.




From truiken at gmail.com  Wed Apr  2 17:14:02 2008
From: truiken at gmail.com (James Hawkins)
Date: Wed, 2 Apr 2008 17:14:02 -0500
Subject: msi: Remove tentative definition of static array with no size
	specifier
In-Reply-To: <200804022307.55734.andrew.talbot@talbotville.com>
References: <200804022307.55734.andrew.talbot@talbotville.com>
Message-ID: <22821af30804021514y2fc5134eg3bd996a7db7e53e2@mail.gmail.com>

On Wed, Apr 2, 2008 at 5:07 PM, Andrew Talbot
<andrew.talbot at talbotville.com> wrote:
> Whereas for a non-static array a tentative definition does not require a
>  size to be specified, for example:
>
>     char ar[];            /* tentative definition */
>
>     char ar[] = "hello";  /* actual definition */
>
>  strictly, when the static storage specifier is applied, the size must be
>  specified:
>
>     static char ar[5];           /* tentative definition */
>
>     static char ar[5] = "hello"; /* actual definition */
>
>  This patch avoids using a magic number by moving the definition of an array
>  and adding forward declarations for the functions affected, instead.
>
>  -- Andy.
>  ---
>  Changelog:
>     msi: Remove tentative declaration of static array with no size specifier.
>
>  diff --git a/dlls/msi/action.c b/dlls/msi/action.c
>  index 982c9f0..8cc36a0 100644
>  --- a/dlls/msi/action.c
>  +++ b/dlls/msi/action.c
>  @@ -47,6 +47,64 @@ WINE_DEFAULT_DEBUG_CHANNEL(msi);
>   static UINT ACTION_ProcessExecSequence(MSIPACKAGE *package, BOOL UIran);
>   static UINT ACTION_ProcessUISequence(MSIPACKAGE *package);
>   static UINT ACTION_PerformActionSequence(MSIPACKAGE *package, UINT seq, BOOL UI);
>  +static UINT ACTION_AllocateRegistrySpace( MSIPACKAGE *package );
>  +static UINT ACTION_BindImage( MSIPACKAGE *package );
>  +static UINT ACTION_CostFinalize(MSIPACKAGE *package);
>  +static UINT ACTION_CostInitialize(MSIPACKAGE *package);
>  +static UINT ACTION_CreateFolders(MSIPACKAGE *package);
>  +static UINT ACTION_CreateShortcuts(MSIPACKAGE *package);
>  +static UINT ACTION_DeleteServices( MSIPACKAGE *package );
>  +static UINT ACTION_ExecuteAction(MSIPACKAGE *package);
>  +static UINT ACTION_FileCost(MSIPACKAGE *package);
>  +static UINT ACTION_InstallExecute(MSIPACKAGE *package);
>  +static UINT ACTION_InstallFinalize(MSIPACKAGE *package);
>  +static UINT ACTION_InstallInitialize(MSIPACKAGE *package);
>  +static UINT ACTION_InstallSFPCatalogFile( MSIPACKAGE *package );
>  +static UINT ACTION_InstallValidate(MSIPACKAGE *package);
>  +static UINT ACTION_IsolateComponents( MSIPACKAGE *package );
>  +static UINT ACTION_LaunchConditions(MSIPACKAGE *package);
>  +static UINT ACTION_MigrateFeatureStates( MSIPACKAGE *package );
>  +static UINT ACTION_MoveFiles( MSIPACKAGE *package );
>  +static UINT ACTION_MsiPublishAssemblies( MSIPACKAGE *package );
>  +static UINT ACTION_MsiUnpublishAssemblies( MSIPACKAGE *package );
>  +static UINT ACTION_InstallODBC( MSIPACKAGE *package );
>  +static UINT ACTION_InstallServices( MSIPACKAGE *package );
>  +static UINT ACTION_PatchFiles( MSIPACKAGE *package );
>  +static UINT ACTION_ProcessComponents(MSIPACKAGE *package);
>  +static UINT ACTION_PublishComponents(MSIPACKAGE *package);
>  +static UINT ACTION_PublishFeatures(MSIPACKAGE *package);
>  +static UINT ACTION_PublishProduct(MSIPACKAGE *package);
>  +static UINT ACTION_RegisterComPlus( MSIPACKAGE *package );
>  +static UINT ACTION_RegisterProduct(MSIPACKAGE *package);
>  +static UINT ACTION_RegisterTypeLibraries(MSIPACKAGE *package);
>  +static UINT ACTION_RegisterUser(MSIPACKAGE *package);
>  +static UINT ACTION_RemoveDuplicateFiles( MSIPACKAGE *package );
>  +static UINT ACTION_RemoveEnvironmentStrings( MSIPACKAGE *package );
>  +static UINT ACTION_RemoveExistingProducts( MSIPACKAGE *package );
>  +static UINT ACTION_RemoveFolders( MSIPACKAGE *package );
>  +static UINT ACTION_RemoveIniValues( MSIPACKAGE *package );
>  +static UINT ACTION_RemoveODBC( MSIPACKAGE *package );
>  +static UINT ACTION_RemoveRegistryValues( MSIPACKAGE *package );
>  +static UINT ACTION_RemoveShortcuts( MSIPACKAGE *package );
>  +static UINT ACTION_ResolveSource(MSIPACKAGE* package);
>  +static UINT ACTION_RMCCPSearch( MSIPACKAGE *package );
>  +static UINT ACTION_SelfRegModules(MSIPACKAGE *package);
>  +static UINT ACTION_SelfUnregModules( MSIPACKAGE *package );
>  +static UINT ACTION_StartServices( MSIPACKAGE *package );
>  +static UINT ACTION_StopServices( MSIPACKAGE *package );
>  +static UINT ACTION_UnpublishComponents( MSIPACKAGE *package );
>  +static UINT ACTION_UnpublishFeatures(MSIPACKAGE *package);
>  +static UINT ACTION_UnregisterClassInfo( MSIPACKAGE *package );
>  +static UINT ACTION_UnregisterComPlus( MSIPACKAGE *package );
>  +static UINT ACTION_UnregisterExtensionInfo( MSIPACKAGE *package );
>  +static UINT ACTION_UnregisterFonts( MSIPACKAGE *package );
>  +static UINT ACTION_UnregisterMIMEInfo( MSIPACKAGE *package );
>  +static UINT ACTION_UnregisterProgIdInfo( MSIPACKAGE *package );
>  +static UINT ACTION_UnregisterTypeLibraries( MSIPACKAGE *package );
>  +static UINT ACTION_ValidateProductID( MSIPACKAGE *package );
>  +static UINT ACTION_WriteEnvironmentStrings( MSIPACKAGE *package );
>  +static UINT ACTION_WriteIniValues(MSIPACKAGE *package);
>  +static UINT ACTION_WriteRegistryValues(MSIPACKAGE *package);
>

I object.  Also, RFCs should be sent to wine-devel, not wine-patches.

-- 
James Hawkins


From m.b.lankhorst at gmail.com  Wed Apr  2 17:17:05 2008
From: m.b.lankhorst at gmail.com (Maarten Lankhorst)
Date: Wed, 2 Apr 2008 15:17:05 -0700
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <87k5jgc5lr.fsf@wine.dyndns.org>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>
	<7e33d29b0804020808m558534f8q1d7430c219cfbc26@mail.gmail.com>
	<b6bb06270804021105v63c03b37nd9e47e72a2a338c6@mail.gmail.com>
	<22821af30804021133m46c0c78dy76debaec3d48bc9a@mail.gmail.com>
	<47F3D5EF.2030001@redhat.com>
	<22821af30804021159w70ab3327m26ebb9b325c82b1b@mail.gmail.com>
	<47F3DE57.7050508@redhat.com> <87k5jgc5lr.fsf@wine.dyndns.org>
Message-ID: <b130c85e0804021517i723ea94kd67b3d129b84d838@mail.gmail.com>

Hi Alexandre,

2008/4/2, Alexandre Julliard <julliard at winehq.org>:
> Michael Stefaniuc <mstefani at redhat.com> writes:
>
>  > Right, forgot about that one. But I am still sure he would accept a
>  > "perfect" full featured and beautiful written pulseaudio driver. What he
>  > doesn't wants at all is wasting precious Wine developer time on creating
>  > one in his Wine git repository. And having it rot there because in 1-2
>  > years all of todays pulseaudio proponents will complain how broken
>  > pulseaudio is and how much better this "yet another audio system 2.0" is
>  > and why Wine _needs_ to implement that one.
>
>
> What I really want is for all the people who are clamoring for yet
>  another driver to pitch in and start fixing the alsa driver instead.
>
>  Once this is done and we have demonstrated that we can actually make one
>  driver work 100% correctly, then we can consider adding another one.
Apart from the horrible waveout playback code that was directly copied
from wineoss, and to a lighter degree the wavein code is there
anything seriously broken in winealsa? Nothing comes to mind at the
moment.

Cheers,
Maarten.


From Andrew.Talbot at talbotville.com  Wed Apr  2 17:19:44 2008
From: Andrew.Talbot at talbotville.com (Andrew Talbot)
Date: Wed, 02 Apr 2008 23:19:44 +0100
Subject: msi: Remove tentative definition of static array with no size
	specifier
References: <200804022307.55734.andrew.talbot@talbotville.com>
	<22821af30804021514y2fc5134eg3bd996a7db7e53e2@mail.gmail.com>
Message-ID: <ft10q0$7jc$1@ger.gmane.org>

James Hawkins wrote:

> 
> I object.  Also, RFCs should be sent to wine-devel, not wine-patches.
> 

I was submitting a patch with a prelude explaining why, not making a request
for comment. But on what grounds are you objecting?

-- 
Andy.




From truiken at gmail.com  Wed Apr  2 17:25:25 2008
From: truiken at gmail.com (James Hawkins)
Date: Wed, 2 Apr 2008 17:25:25 -0500
Subject: msi: Remove tentative definition of static array with no size
	specifier
In-Reply-To: <ft10q0$7jc$1@ger.gmane.org>
References: <200804022307.55734.andrew.talbot@talbotville.com>
	<22821af30804021514y2fc5134eg3bd996a7db7e53e2@mail.gmail.com>
	<ft10q0$7jc$1@ger.gmane.org>
Message-ID: <22821af30804021525w3f0982e9m69df93ecf30bead9@mail.gmail.com>

On Wed, Apr 2, 2008 at 5:19 PM, Andrew Talbot
<Andrew.Talbot at talbotville.com> wrote:
> James Hawkins wrote:
>
>  >
>  > I object.  Also, RFCs should be sent to wine-devel, not wine-patches.
>  >
>
>  I was submitting a patch with a prelude explaining why, not making a request
>  for comment. But on what grounds are you objecting?
>

It's ugly.  What warning are you trying to fix?

-- 
James Hawkins


From mstefani at redhat.com  Wed Apr  2 17:26:40 2008
From: mstefani at redhat.com (Michael Stefaniuc)
Date: Thu, 03 Apr 2008 00:26:40 +0200
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <87k5jgc5lr.fsf@wine.dyndns.org>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>	<7e33d29b0804020808m558534f8q1d7430c219cfbc26@mail.gmail.com>	<b6bb06270804021105v63c03b37nd9e47e72a2a338c6@mail.gmail.com>	<22821af30804021133m46c0c78dy76debaec3d48bc9a@mail.gmail.com>	<47F3D5EF.2030001@redhat.com>	<22821af30804021159w70ab3327m26ebb9b325c82b1b@mail.gmail.com>	<47F3DE57.7050508@redhat.com>
	<87k5jgc5lr.fsf@wine.dyndns.org>
Message-ID: <47F40820.8040506@redhat.com>

Alexandre Julliard wrote:
> Michael Stefaniuc <mstefani at redhat.com> writes:
> 
>> Right, forgot about that one. But I am still sure he would accept a
>> "perfect" full featured and beautiful written pulseaudio driver. What he
>> doesn't wants at all is wasting precious Wine developer time on creating
>> one in his Wine git repository. And having it rot there because in 1-2
>> years all of todays pulseaudio proponents will complain how broken
>> pulseaudio is and how much better this "yet another audio system 2.0" is
>> and why Wine _needs_ to implement that one.
> 
> What I really want is for all the people who are clamoring for yet
> another driver to pitch in and start fixing the alsa driver instead.
Right but you _cannot_ force people to do that. If they just go ahead
and setup a separate Wine repo they can work on pulseaudio all the day
and nobody can stop them. That's the OSS reality and git makes that very
easy to do.

> Once this is done and we have demonstrated that we can actually make one
> driver work 100% correctly, then we can consider adding another one.
It is your tree and given the history the only sane approach for your
("The Wine") git tree. But that's the centralized approach and I would
love if people would start moving away from that.

Compare
"Hey guys, pulseaudio is the uber cool must have audio system of the
future. I went ahead and added a pulseaudio driver to Wine. Here is the
link to my git tree."
to
"Bitch bitch moan everything else sucks but pulseaudio bitch bitch so
you guys go ahead and implement it in Wine."

I prefer the first version but i probably listened to often to Linus
about the advantages of git and the distributed development model.

bye
	michael


From Andrew.Talbot at talbotville.com  Wed Apr  2 17:40:16 2008
From: Andrew.Talbot at talbotville.com (Andrew Talbot)
Date: Wed, 02 Apr 2008 23:40:16 +0100
Subject: msi: Remove tentative definition of static array with no size
	specifier
References: <200804022307.55734.andrew.talbot@talbotville.com>
	<22821af30804021514y2fc5134eg3bd996a7db7e53e2@mail.gmail.com>
	<ft10q0$7jc$1@ger.gmane.org>
	<22821af30804021525w3f0982e9m69df93ecf30bead9@mail.gmail.com>
Message-ID: <ft120h$c0u$1@ger.gmane.org>

James Hawkins wrote:

> 
> It's ugly.  What warning are you trying to fix?
> 

Although I imagine that gcc doesn't do anything particularly adverse as a
result of the existing code, if the pedantic switch were applied it would
cause a message of the following type to be generated.

    action.c:236: error: array size missing in ?StandardActions?

I believe it is also likely to show up under lint-like tools and I believe
it is actually an error, though compilers are not required to generate any
message, apparently. I couldn't say whether the resultant behaviour is
undefined, implemenation defined, or what. And I don't know whether gcc
places any surplus baggage in any segment as a result. The fix was just to
make the code correct and hence more portable.

-- 
Andy.




From truiken at gmail.com  Wed Apr  2 17:43:58 2008
From: truiken at gmail.com (James Hawkins)
Date: Wed, 2 Apr 2008 17:43:58 -0500
Subject: msi: Remove tentative definition of static array with no size
	specifier
In-Reply-To: <ft120h$c0u$1@ger.gmane.org>
References: <200804022307.55734.andrew.talbot@talbotville.com>
	<22821af30804021514y2fc5134eg3bd996a7db7e53e2@mail.gmail.com>
	<ft10q0$7jc$1@ger.gmane.org>
	<22821af30804021525w3f0982e9m69df93ecf30bead9@mail.gmail.com>
	<ft120h$c0u$1@ger.gmane.org>
Message-ID: <22821af30804021543n5db8cd7an39276fea271370d8@mail.gmail.com>

On Wed, Apr 2, 2008 at 5:40 PM, Andrew Talbot
<Andrew.Talbot at talbotville.com> wrote:
> James Hawkins wrote:
>
>  >
>  > It's ugly.  What warning are you trying to fix?
>  >
>
>  Although I imagine that gcc doesn't do anything particularly adverse as a
>  result of the existing code, if the pedantic switch were applied it would
>  cause a message of the following type to be generated.
>
>     action.c:236: error: array size missing in ?StandardActions?
>
>  I believe it is also likely to show up under lint-like tools and I believe
>  it is actually an error, though compilers are not required to generate any
>  message, apparently. I couldn't say whether the resultant behaviour is
>  undefined, implemenation defined, or what. And I don't know whether gcc
>  places any surplus baggage in any segment as a result. The fix was just to
>  make the code correct and hence more portable.
>

That's fine, but it's not worth it to me, and I'm pretty sure Julliard
won't accept it either.

-- 
James Hawkins


From Andrew.Talbot at talbotville.com  Wed Apr  2 17:52:24 2008
From: Andrew.Talbot at talbotville.com (Andrew Talbot)
Date: Wed, 02 Apr 2008 23:52:24 +0100
Subject: msi: Remove tentative definition of static array with no size
	specifier
References: <200804022307.55734.andrew.talbot@talbotville.com>
	<22821af30804021514y2fc5134eg3bd996a7db7e53e2@mail.gmail.com>
	<ft10q0$7jc$1@ger.gmane.org>
	<22821af30804021525w3f0982e9m69df93ecf30bead9@mail.gmail.com>
	<ft120h$c0u$1@ger.gmane.org>
	<22821af30804021543n5db8cd7an39276fea271370d8@mail.gmail.com>
Message-ID: <ft12n8$drd$1@ger.gmane.org>

James Hawkins wrote:

> That's fine, but it's not worth it to me, and I'm pretty sure Julliard
> won't accept it either.
> 

I understand and suspect you are right. Maybe I should have made an RFC
rather than opting for trial by patch. :)

Thanks for your comments.

-- 
Andy.




From chris.kcat at gmail.com  Wed Apr  2 18:15:24 2008
From: chris.kcat at gmail.com (Chris Robinson)
Date: Wed, 2 Apr 2008 16:15:24 -0700
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <47F40820.8040506@redhat.com>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>
	<87k5jgc5lr.fsf@wine.dyndns.org> <47F40820.8040506@redhat.com>
Message-ID: <200804021615.24769.chris.kcat@gmail.com>

On Wednesday 02 April 2008 03:26:40 pm Michael Stefaniuc wrote:
> Alexandre Julliard wrote:
> > What I really want is for all the people who are clamoring for yet
> > another driver to pitch in and start fixing the alsa driver instead.
>
> Right but you _cannot_ force people to do that. If they just go ahead
> and setup a separate Wine repo they can work on pulseaudio all the day
> and nobody can stop them. That's the OSS reality and git makes that very
> easy to do.

But that still doesn't make it The Right Thing to do. Who's to say PulseAudio 
will really stick around and continue to be useful? Phonon has a good chance 
of that, too (as it's backed by Trolltech/Qt, and is useable on several OSs). 
And I'm sure people said some of the same thing about aRts. But we know how 
that ended up.

And it's not even like PA's main feature (software mixing) isn't available 
through ALSA (dmix). Sure it has some other features, but they're hardly 
something that Wine needs to make such a shift for (most apps have their own 
volume control, and people that need device hot-plugging can still get it 
through the ALSA-PulseAudio plugin; or even the OSS-PulseAudio plugin).

I'm sure I'm not alone in feeling like we're getting jerked around with audio 
APIs in Linux (use OSS! no, use ESD! no, use ALSA! no, use PulseAudio!). IMO, 
we have to set down and just pick something.


From stefan at codeweavers.com  Wed Apr  2 18:46:18 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Thu, 3 Apr 2008 01:46:18 +0200
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <7e33d29b0804020808m558534f8q1d7430c219cfbc26@mail.gmail.com>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>
	<7e33d29b0804020808m558534f8q1d7430c219cfbc26@mail.gmail.com>
Message-ID: <200804030146.18372.stefan@codeweavers.com>

Am Mittwoch, 2. April 2008 17:08:06 schrieb Bryan Haskins:
> I'm more interested in a direct pulseaudio gateway for Wine... since by
> application sound control is the biggest thing here for most people....
> wine is treated as one big audio blob. Pulse sees it as one thing.
Isn't that a PulseAudio limitation? I am sure that Wine opens a new Alsa 
connection for each Windows application that uses sound. I don't know how PA 
groups the input, but it can surely find different Wine inputs from Alsa.


From dsh at linux.ucla.edu  Wed Apr  2 19:18:47 2008
From: dsh at linux.ucla.edu (Dan Hipschman)
Date: Wed, 2 Apr 2008 17:18:47 -0700
Subject: [PATCH 4/7] widl: Support __fastcall and __pascal calling
	conventions.
In-Reply-To: <20080402184627.GE4608@linux.ucla.edu>
References: <47F37465.3050105@codeweavers.com>
	<20080402184627.GE4608@linux.ucla.edu>
Message-ID: <20080403001847.GG4608@linux.ucla.edu>

On Wed, Apr 02, 2008 at 11:46:27AM -0700, Dan Hipschman wrote:
> On Wed, Apr 02, 2008 at 12:56:21PM +0100, Robert Shearman wrote:
> > @@ -186,13 +186,19 @@ static const struct keyword keywords[] = {
> >  	{"FALSE",			tFALSE},
> >  	{"TRUE",			tTRUE},
> >  	{"__cdecl",			tCDECL},
> > +	{"__fastcall",			tFASTCALL},
> > +	{"__pascal",			tPASCAL},
> >  	{"__int64",			tINT64},
> >  	{"__stdcall",			tSTDCALL},
> 
> __pascal should come after __int64.
> 

I sent a patch.


From actong88 at gmail.com  Wed Apr  2 20:51:52 2008
From: actong88 at gmail.com (Allan Tong)
Date: Wed, 2 Apr 2008 21:51:52 -0400
Subject: [PATCH 04/10] wined3d: Add ENTER_GL/LEAVE_GL in
	IWineD3DSurfaceImpl_Release.
In-Reply-To: <47F3F69D.8040709@inbox.lv>
References: <47F3F69D.8040709@inbox.lv>
Message-ID: <d75158870804021851j2344841fm229b15a442c076ba@mail.gmail.com>

Perhaps the call to ActivateContext should be moved outside of the if
block since there are other gl calls in the function.  Then you could
move the glDeleteRenderbuffers block before the gdi section and
combine the ENTER_GL/LEAVE_GL blocks into one.

 - Allan


From talk2cod at hotmail.com  Wed Apr  2 23:28:24 2008
From: talk2cod at hotmail.com (andre furtado)
Date: Thu, 3 Apr 2008 04:28:24 +0000
Subject: batmeter exported functions
Message-ID: <BAY109-W369795340707D09F00440887F70@phx.gbl>


Andr? Renato Furtado, talk2cod at hotmail.com  add documentation for exported functions of the win32 batmeter library...
 
BOOL BatMeterCapabilities(    PUINT   *ppuiBatCount)
*\ description:    is used to determine if the batmeter lib can run on the host machine. return true on success 
(battery meter can run).    params:    out -> ppuiBatCount - points to a pointer which will be filled in with a pointer to the global battery count.*\
 
HWND CreateBatMeter(    HWND            hWndParent,    HWND            hWndFrame,    BOOL            bShowMulti,    PBATTERY_STATE  pbsComposite)
*\  description:    create, fetch data for and draw the batmeter window. returns a handle to the newly created battery meter window on success, null on failure.    param:    hWndParent      - parent of the battery meter dialog.    hWndFrame        - frame to locate the battery meter dialog.    bShowMulti      -  display mode (true -> multiple battery).    opt -> pbsComposite    - pointer to composite battery state.*\
 
HWND DestroyBatMeter(HWND hWnd)
*\ description:   destroy the batmeter window created with CreateBatMeter function. returns the handle of the 
batmeter parent window.   params:   hWnd   - handle to the window to be destroyed. *\
 
BOOL PowerCapabilities()
*\  description:    is used to determine if the system has any power    management capabilities which require ui support. return true if power management ui should be displayed. *\
 
BOOL UpdateBatMeter(    HWND            hWnd,    BOOL            bShowMulti,    BOOL            bForceUpdate,    PBATTERY_STATE  pbsComposite)
*\  description:    this function should be called when the battery meter parent window    receives a WM_POWERBROADCAST, PBT_APMPOWERSTATUSCHANGE message, it will    update the data in the global battery state list. if needed the display    will also be updated.  PARAMETERS:    hWndBatMeter,          hwnd of the battery meter dialog    bShowMulti,            display mode    bForceUpdate,          forces a ui update    opt -> pbsComposite,    pointer to composite battery state.  *\
 
WM_POWERBROADCAST == 0x218
PBT_APMPOWERSTATUSCHANGE == 0xa
_________________________________________________________________
Instale a Barra de Ferramentas com Desktop Search e ganhe EMOTICONS para o Messenger! ? GR?TIS!
http://www.msn.com.br/emoticonpack
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080403/20c53144/attachment-0001.htm 

From stephan at kochen.nl  Thu Apr  3 02:33:07 2008
From: stephan at kochen.nl (=?UTF-8?B?U3TDqXBoYW4gS29jaGVu?=)
Date: Thu, 03 Apr 2008 09:33:07 +0200
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <200804021615.24769.chris.kcat@gmail.com>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>	<87k5jgc5lr.fsf@wine.dyndns.org>
	<47F40820.8040506@redhat.com>
	<200804021615.24769.chris.kcat@gmail.com>
Message-ID: <47F48833.60102@kochen.nl>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

A lot of the posts I see about PulseAudio seem to complain about the
Linux audio situation in general. PulseAudio just gets dragged along in
all the negativity.

Chris Robinson wrote:
> On Wednesday 02 April 2008 03:26:40 pm Michael Stefaniuc wrote:
>> Alexandre Julliard wrote:
>>> What I really want is for all the people who are clamoring for yet
>>> another driver to pitch in and start fixing the alsa driver instead.
>> Right but you _cannot_ force people to do that. If they just go ahead
>> and setup a separate Wine repo they can work on pulseaudio all the day
>> and nobody can stop them. That's the OSS reality and git makes that very
>> easy to do.
> 
> But that still doesn't make it The Right Thing to do. Who's to say PulseAudio 
> will really stick around and continue to be useful? Phonon has a good chance 
> of that, too (as it's backed by Trolltech/Qt, and is useable on several OSs). 
> And I'm sure people said some of the same thing about aRts. But we know how 
> that ended up.

Phonon is high level multimedia framework. PulseAudio is a sound server.
Those are two very different areas.

aRts and ESounD were both abandoned because of inactivity, I believe.
Your doubts about the same happening to PulseAudio in light of that are
understandable.

But PulseAudio is the most actively maintained and most desktop
integrated audio solution we have now, and pretty much has been since
it's inception. This looks like one of the widest and most enthusiastic
adoptions of an audio standard I've ever seen on Linux, so I think the
risk is small.

> And it's not even like PA's main feature (software mixing) isn't available 
> through ALSA (dmix). Sure it has some other features, but they're hardly 
> something that Wine needs to make such a shift for (most apps have their own 
> volume control, and people that need device hot-plugging can still get it 
> through the ALSA-PulseAudio plugin; or even the OSS-PulseAudio plugin).

DMix is also a sound server. PulseAudio is a replacement in that sense.
Some will argue it is even a better replacement. ;)

Wine already goes to great lengths to integrate with the existing
desktop environments and distributions. (All the tiny things work: I can
double click on .exes, applications appear in desktop menu, I can copy
and paste naturally, even drag and drop.) Why not go the extra length
and have full integration when it comes to audio as well? Many large
distributions have already accepted PulseAudio as the standard.

Device hot-plugging should be nothing special, especially with Bluetooth
headsets and similar. I admit that I too do not know the exact
advantages in this area when talking directly to PulseAudio instead of
through the ALSA plug-in, but right now Wine does not even work with the
ALSA plug-in for me.

> I'm sure I'm not alone in feeling like we're getting jerked around with audio 
> APIs in Linux (use OSS! no, use ESD! no, use ALSA! no, use PulseAudio!). IMO, 
> we have to set down and just pick something.

You're damn right! So let's pick PulseAudio! :)

Regards,
- -- St?phan
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD4DBQFH9IgzcFUq0gzqDwQRAl2GAJjwe9zLoos+0K8g4/nwmLaDvv4cAJwIKWVe
53m/n13wxXqKtOSbIb8SxA==
=RSWg
-----END PGP SIGNATURE-----


From julliard at winehq.org  Thu Apr  3 02:41:10 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 03 Apr 2008 09:41:10 +0200
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <b130c85e0804021517i723ea94kd67b3d129b84d838@mail.gmail.com>
	(Maarten Lankhorst's message of "Wed, 2 Apr 2008 15:17:05 -0700")
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>
	<7e33d29b0804020808m558534f8q1d7430c219cfbc26@mail.gmail.com>
	<b6bb06270804021105v63c03b37nd9e47e72a2a338c6@mail.gmail.com>
	<22821af30804021133m46c0c78dy76debaec3d48bc9a@mail.gmail.com>
	<47F3D5EF.2030001@redhat.com>
	<22821af30804021159w70ab3327m26ebb9b325c82b1b@mail.gmail.com>
	<47F3DE57.7050508@redhat.com> <87k5jgc5lr.fsf@wine.dyndns.org>
	<b130c85e0804021517i723ea94kd67b3d129b84d838@mail.gmail.com>
Message-ID: <87d4p7crmx.fsf@wine.dyndns.org>

"Maarten Lankhorst" <m.b.lankhorst at gmail.com> writes:

> Apart from the horrible waveout playback code that was directly copied
> from wineoss, and to a lighter degree the wavein code is there
> anything seriously broken in winealsa? Nothing comes to mind at the
> moment.

Well, people are saying we need a pulseaudio driver because alsa doesn't
work right on top of pulseaudio; now it may well be that the fault is
entirely on the pulseaudio side, but either way it needs to be
investigated and fixed.

One other (minor) problem I know about is that building the alsa driver
spews out several warnings about using deprecated functions.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Thu Apr  3 03:00:10 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 03 Apr 2008 10:00:10 +0200
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <47F40820.8040506@redhat.com> (Michael Stefaniuc's message of
	"Thu, 03 Apr 2008 00:26:40 +0200")
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>
	<7e33d29b0804020808m558534f8q1d7430c219cfbc26@mail.gmail.com>
	<b6bb06270804021105v63c03b37nd9e47e72a2a338c6@mail.gmail.com>
	<22821af30804021133m46c0c78dy76debaec3d48bc9a@mail.gmail.com>
	<47F3D5EF.2030001@redhat.com>
	<22821af30804021159w70ab3327m26ebb9b325c82b1b@mail.gmail.com>
	<47F3DE57.7050508@redhat.com> <87k5jgc5lr.fsf@wine.dyndns.org>
	<47F40820.8040506@redhat.com>
Message-ID: <878wzvcqr9.fsf@wine.dyndns.org>

Michael Stefaniuc <mstefani at redhat.com> writes:

> Alexandre Julliard wrote:
>> What I really want is for all the people who are clamoring for yet
>> another driver to pitch in and start fixing the alsa driver instead.
> Right but you _cannot_ force people to do that. If they just go ahead
> and setup a separate Wine repo they can work on pulseaudio all the day
> and nobody can stop them. That's the OSS reality and git makes that very
> easy to do.

Obviously I'm not trying to prevent anybody from working on it, just
trying to encourage at least a few people to follow the correct approach.

But yes, with git it's very easy to maintain a separate tree, and that
was a large part of the reason for making the switch from cvs. This way
I can keep being an asshole about the main tree, and people can route
around me and still get work done. Everybody wins...

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Thu Apr  3 03:07:41 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 03 Apr 2008 10:07:41 +0200
Subject: msi: Remove tentative definition of static array with no size
	specifier
In-Reply-To: <ft12n8$drd$1@ger.gmane.org> (Andrew Talbot's message of "Wed, 02
	Apr 2008 23:52:24 +0100")
References: <200804022307.55734.andrew.talbot@talbotville.com>
	<22821af30804021514y2fc5134eg3bd996a7db7e53e2@mail.gmail.com>
	<ft10q0$7jc$1@ger.gmane.org>
	<22821af30804021525w3f0982e9m69df93ecf30bead9@mail.gmail.com>
	<ft120h$c0u$1@ger.gmane.org>
	<22821af30804021543n5db8cd7an39276fea271370d8@mail.gmail.com>
	<ft12n8$drd$1@ger.gmane.org>
Message-ID: <874pajcqeq.fsf@wine.dyndns.org>

Andrew Talbot <Andrew.Talbot at talbotville.com> writes:

> James Hawkins wrote:
>
>> That's fine, but it's not worth it to me, and I'm pretty sure Julliard
>> won't accept it either.
>
> I understand and suspect you are right. Maybe I should have made an RFC
> rather than opting for trial by patch. :)

I think it's worth fixing, but it's easier to do by avoiding the need
for the forward declaration, there's only one place that uses it.

-- 
Alexandre Julliard
julliard at winehq.org


From rob at codeweavers.com  Thu Apr  3 03:14:59 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Thu, 03 Apr 2008 09:14:59 +0100
Subject: msi: Remove tentative definition of static array with no size
	specifier
In-Reply-To: <ft120h$c0u$1@ger.gmane.org>
References: <200804022307.55734.andrew.talbot@talbotville.com>	<22821af30804021514y2fc5134eg3bd996a7db7e53e2@mail.gmail.com>	<ft10q0$7jc$1@ger.gmane.org>	<22821af30804021525w3f0982e9m69df93ecf30bead9@mail.gmail.com>
	<ft120h$c0u$1@ger.gmane.org>
Message-ID: <47F49203.6030205@codeweavers.com>

Andrew Talbot wrote:
> James Hawkins wrote:
>
>   
>> It's ugly.  What warning are you trying to fix?
>>
>>     
>
> Although I imagine that gcc doesn't do anything particularly adverse as a
> result of the existing code, if the pedantic switch were applied it would
> cause a message of the following type to be generated.
>
>     action.c:236: error: array size missing in ?StandardActions?
>
> I believe it is also likely to show up under lint-like tools and I believe
> it is actually an error, though compilers are not required to generate any
> message, apparently. I couldn't say whether the resultant behaviour is
> undefined, implemenation defined, or what. And I don't know whether gcc
> places any surplus baggage in any segment as a result. The fix was just to
> make the code correct and hence more portable.

This also causes problems when compiling with msvc:
> make[1]: Entering directory `/home/rob/wine-msvc/dlls/msi'
> CC action.o
> action.c
> action.c(236) : error C2133: 'StandardActions' : unknown size

It also might affect compilers on other platforms that Wine might be 
ported to. As Andy says, it's non-standard behaviour and so could break 
even in future versions of gcc.

I think the patch could be changed so that very few, if any, forward 
declarations would need to be made simply by moving 
ACTION_HandleStandardAction to after StandardActions is initialised.

-- 
Rob Shearman



From scott at open-vote.org  Thu Apr  3 03:58:04 2008
From: scott at open-vote.org (Scott Ritchie)
Date: Thu, 03 Apr 2008 01:58:04 -0700
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <200804021615.24769.chris.kcat@gmail.com>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>	<87k5jgc5lr.fsf@wine.dyndns.org>
	<47F40820.8040506@redhat.com>
	<200804021615.24769.chris.kcat@gmail.com>
Message-ID: <47F49C1C.8090507@open-vote.org>

Chris Robinson wrote:
> On Wednesday 02 April 2008 03:26:40 pm Michael Stefaniuc wrote:
>> Alexandre Julliard wrote:
>>> What I really want is for all the people who are clamoring for yet
>>> another driver to pitch in and start fixing the alsa driver instead.
>> Right but you _cannot_ force people to do that. If they just go ahead
>> and setup a separate Wine repo they can work on pulseaudio all the day
>> and nobody can stop them. That's the OSS reality and git makes that very
>> easy to do.
> 
> But that still doesn't make it The Right Thing to do. Who's to say PulseAudio 
> will really stick around and continue to be useful? Phonon has a good chance 
> of that, too (as it's backed by Trolltech/Qt, and is useable on several OSs). 
> And I'm sure people said some of the same thing about aRts. But we know how 
> that ended up.
> 
> And it's not even like PA's main feature (software mixing) isn't available 
> through ALSA (dmix). Sure it has some other features, but they're hardly 
> something that Wine needs to make such a shift for (most apps have their own 
> volume control, and people that need device hot-plugging can still get it 
> through the ALSA-PulseAudio plugin; or even the OSS-PulseAudio plugin).
> 

PulseAudio will take off exactly because Ubuntu is using it.


> I'm sure I'm not alone in feeling like we're getting jerked around with audio 
> APIs in Linux (use OSS! no, use ESD! no, use ALSA! no, use PulseAudio!). IMO, 
> we have to set down and just pick something.
> 

Right, and very understandably it looks like we've picked ALSA, while
the distributions seemed to have picked PulseAudio.


Thanks,
Scott Ritchie


From julliard at winehq.org  Thu Apr  3 05:07:10 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 03 Apr 2008 12:07:10 +0200
Subject: [4/7] WineD3D: Macroize CheckDeviceFormat to reduce code
	duplication
In-Reply-To: <200804031149.56729.stefan@codeweavers.com> ("Stefan
	=?utf-8?Q?D=C3=B6singer=22's?=
	message of "Thu, 3 Apr 2008 11:49:56 +0200")
References: <200804031149.56729.stefan@codeweavers.com>
Message-ID: <87zlsbb6b5.fsf@wine.dyndns.org>

Stefan D?singer <stefan at codeweavers.com> writes:

> The main idea is to avoid that we have screen-sized code sections in this 
> function that look exactly the same. This should make navigation in the code 
> easier

It would be even better with an array of flag->function mappings and a
simple loop over the flags to check.

-- 
Alexandre Julliard
julliard at winehq.org


From paul.vriens.wine at gmail.com  Thu Apr  3 06:52:34 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Thu, 03 Apr 2008 13:52:34 +0200
Subject: Can we remove the rsabase tests?
Message-ID: <47F4C502.4040603@gmail.com>

Hi,

We have only a few (3) tests in the rsabase tests. The same tests are also 
available in the rsaenh tests.

The reason I think they can be removed:

- rsaenh seems to be available most platforms. If not then also rsabase is not 
available (by checking test.winehq.org)
- rsabase is not available on XP and above
- we forward all rsabase calls to rsaenh anyway

-- 
Cheers,

Paul.


From andreas.bierfert at lowlatency.de  Thu Apr  3 07:00:52 2008
From: andreas.bierfert at lowlatency.de (Andreas Bierfert)
Date: Thu, 3 Apr 2008 14:00:52 +0200
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <47F49C1C.8090507@open-vote.org>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>
	<87k5jgc5lr.fsf@wine.dyndns.org> <47F40820.8040506@redhat.com>
	<200804021615.24769.chris.kcat@gmail.com>
	<47F49C1C.8090507@open-vote.org>
Message-ID: <20080403140052.1211763c@alkaid.a.lan>

On Thu, 03 Apr 2008 01:58:04 -0700
Scott Ritchie <scott at open-vote.org> wrote:

> PulseAudio will take off exactly because Ubuntu is using it.

Just to remind you that Fedora has been using it before :P

Anyway, I had to deal with a lot of people when F8 hit because wine was not
working with the default fedora install. Not everything was perfect in the
fedora setup of pa then and it probably is not now, but for the near future
that is where sound in fedora is going.

I would really prefer a native pa backend in wine, but something I do not
understand is why people complain about pa <-> alsa <-> wine when pa <->
pa-esd-compat <-> wine works perfectly...

Regards,
Andreas Bierfert
-- 
Andreas Bierfert, M.Sc.        | http://awbsworld.de      | GPG: C58CF1CB
andreas.bierfert at lowlatency.de | http://lowlatency.de     | signed/encrypted
phone: +49 2402 102373         | cell: +49 173 5803043    | mail preferred
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080403/1c5800f5/attachment.pgp 

From mstefani at redhat.com  Thu Apr  3 07:49:36 2008
From: mstefani at redhat.com (Michael Stefaniuc)
Date: Thu, 03 Apr 2008 14:49:36 +0200
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <20080403140052.1211763c@alkaid.a.lan>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>	<87k5jgc5lr.fsf@wine.dyndns.org>
	<47F40820.8040506@redhat.com>	<200804021615.24769.chris.kcat@gmail.com>	<47F49C1C.8090507@open-vote.org>
	<20080403140052.1211763c@alkaid.a.lan>
Message-ID: <47F4D260.6080906@redhat.com>

Andreas Bierfert wrote:
> On Thu, 03 Apr 2008 01:58:04 -0700
> Scott Ritchie <scott at open-vote.org> wrote:
> 
>> PulseAudio will take off exactly because Ubuntu is using it.
> 
> Just to remind you that Fedora has been using it before :P
> 
> Anyway, I had to deal with a lot of people when F8 hit because wine was not
> working with the default fedora install. Not everything was perfect in the
> fedora setup of pa then and it probably is not now, but for the near future
> that is where sound in fedora is going.
Until the easy stuff that everybody implements (mixer, interface to the 
ton of other sound systems) is finished. Fixing the bugs and the odd 
cases will not be sexy. Interest in PA will fade away, the fan boys will 
move to the next cool thing for which they can go out preaching and 
trying to convince the people of The Right Way. PA will start to rot and 
count as broken by design. Then the next sound system will emerge "to 
fix" all the PA breakages. Fedora and Ubuntu will move to this next uber 
cool sound system. Rinse repeat.

I would love to have a sound system that sticks around for a while. But 
I really doubt that that will be named PulseAudio.

bye
	michael


From jeroen.janssen at gmail.com  Thu Apr  3 08:02:30 2008
From: jeroen.janssen at gmail.com (Jeroen Janssen)
Date: Thu, 3 Apr 2008 13:02:30 +0000 (UTC)
Subject: cygwin and -luuid build error?
Message-ID: <loom.20080403T112224-706@post.gmane.org>

Hi,

I don't know if building wine with cygwin is/should be supported.
However, I get a linker error in dlls/atl with IID_IOleInPlaceSiteWindowless.

It seems this symbol is in the uuid library. The "problem" it seems is that this
library is linked with EXTRALIBS in Makefile.in and this doesn't result in the
correct -L path to be set (essentially the libuuid.a can not be found by the
linker).

When I move -luuid from EXTRALIBS to IMPORTS, -L../../dlls/uuid is added to the
linker and the library is correctly linked.

Since it works ok on Linux, moving the -luuid option around is probably not a
good solution, but I was wondering if anyone has looked into this before and if
so what a good solution would be.

Any thoughts on this?

Best regards,

Jeroen Janssen



From dmitry at codeweavers.com  Thu Apr  3 08:08:14 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Thu, 3 Apr 2008 22:08:14 +0900
Subject: cygwin and -luuid build error?
References: <loom.20080403T112224-706@post.gmane.org>
Message-ID: <012c01c8958b$c8d23030$a600fea9@DMITRY>

"Jeroen Janssen" <jeroen.janssen at gmail.com> wrote:

> I don't know if building wine with cygwin is/should be supported.

It is not, cygwin is not in the supported platforms list.

-- 
Dmitry.


From piotr.caban at gmail.com  Thu Apr  3 08:26:29 2008
From: piotr.caban at gmail.com (Piotr Caban)
Date: Thu, 3 Apr 2008 15:26:29 +0200
Subject: Improving msxml3.dll as GSoC project
Message-ID: <200804031526.29551.piotr.caban@gmail.com>

Hi,
I thought about improving msxml3.dll as GSoC project. There are some 
interfaces not implemented at all, some are not fully implemented. I found 
that there's quite a lot of bugs related to this dll in bugzilla.

I have already sent an application. I thought about implementing SAXReader 
first (there are some applications that fails to install because of it, bugs 
9682 and 6303). Afterwards I thought about implementing functions that are 
used by Photoshop installer (bug 8945, part related to msxml3.dll). I'm not 
really sure how long it will take but if there's enough time I'm going to fix 
more bugs (there are 33 bugs in bugzilla related with the dll). Afterwards  I 
can implement more interfaces that are missing.

More details can be found in the GSoC application.

What do you think about the project idea? Do you have any suggestions?

Regards,
Piotr Caban


From thunderbird2k at gmx.net  Thu Apr  3 08:50:43 2008
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Thu, 03 Apr 2008 15:50:43 +0200
Subject: [4/7] WineD3D: Macroize CheckDeviceFormat to reduce code
	duplication
In-Reply-To: <200804031149.56729.stefan@codeweavers.com>
References: <200804031149.56729.stefan@codeweavers.com>
Message-ID: <20080403135043.203080@gmx.net>

In the end I think something like this is nice to do but not right now. CheckDeviceFormat has changed a lot and it is in good shape now but CreateTexture and friends don't do anything with the capabilities we report. In other words the next step should be to move flags (where possible) over to the pixel format table. E.g. in case of render targets and post pixel shader blending this has been done already. It can be done for a few more.

Basically the Check*Capability functions somehow be placed in utils.c and the result would be cached in the pixel format table. Both CheckDeviceFormat and CreateTexture (and friends) would be able to use the information then.

The Check*Capability calls in CheckDeviceFormat would then become AND-mask checks on the Flags field of a pixel format. This can all be done in small patches.

Roderick


> The main idea is to avoid that we have screen-sized code sections in this 
> function that look exactly the same. This should make navigation in the
> code 
> easier
> 
> Roderick: If you do not like that, just drop a note

-- 
Ist Ihr Browser Vista-kompatibel? Jetzt die neuesten 
Browser-Versionen downloaden: http://www.gmx.net/de/go/browser


From smoki00790 at gmail.com  Thu Apr  3 09:59:21 2008
From: smoki00790 at gmail.com (=?ISO-8859-2?Q?Milan_Kosti=E6?=)
Date: Thu, 3 Apr 2008 16:59:21 +0200
Subject: Deactivate GL_FRAGMENT_SHADER_ATI before deactivating a context
Message-ID: <e1d9e62c0804030759q25f4cd0ao753c5e029a18354a@mail.gmail.com>

 I'm use Mesa 7.01 because that version not have this problem (I try
fragshader.c test from bug #15269). Bug is introduced earler with this
commit, i'm warn about it but nobody listen because i'm not offering
good solution:
 http://gitweb.freedesktop.org/?p=mesa/mesa.git;a=commit;h=e279a0a076b7a3c8d60138c19870784c260c9d67

 Also with that commit several other regressions was introduced with
r200 DRI driver. Maybe they will listen someone (Stefan:)) from here.


From alexd4 at inbox.lv  Thu Apr  3 10:40:23 2008
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Thu, 03 Apr 2008 18:40:23 +0300
Subject: [PATCH 04/10] wined3d: Add ENTER_GL/LEAVE_GL
	in	IWineD3DSurfaceImpl_Release.
In-Reply-To: <d75158870804021851j2344841fm229b15a442c076ba@mail.gmail.com>
References: <47F3F69D.8040709@inbox.lv>
	<d75158870804021851j2344841fm229b15a442c076ba@mail.gmail.com>
Message-ID: <47F4FA67.9010907@inbox.lv>

Hi.

Sounds like a good idea. Unfortunately, it's too late to rework that patch as it 
seems to be in git by now. I suggest you send this improvement as a patch under 
your name.

Allan Tong wrote:
> Perhaps the call to ActivateContext should be moved outside of the if
> block since there are other gl calls in the function.  Then you could
> move the glDeleteRenderbuffers block before the gdi section and
> combine the ENTER_GL/LEAVE_GL blocks into one.
> 
>  - Allan


From susancragin at earthlink.net  Thu Apr  3 11:49:55 2008
From: susancragin at earthlink.net (Susan Cragin)
Date: Thu, 3 Apr 2008 12:49:55 -0400 (EDT)
Subject: Pulse Audio -- Wine should have instructions on this web site
Message-ID: <23410889.1207241395827.JavaMail.root@elwamui-darkeyed.atl.sa.earthlink.net>

Back to the initial question:

Given what we have existing, right now, is there any set of instructions or workarounds that makes WINE apps work best?
even
killall pulseaudio ??
I would like to post them on the pulse web site if appropriate.
I would also like to post them on the web site regarding installing Dragon NaturallySpeaking. 

Thanks. 




From tokul at users.sourceforge.net  Thu Apr  3 11:48:13 2008
From: tokul at users.sourceforge.net (Tomas Kuliavas)
Date: Thu, 3 Apr 2008 19:48:13 +0300 (EEST)
Subject: broken mails from forum
Message-ID: <52937.78.61.224.253.1207241293.nsm@avilys.eik.lt>

Hi,

Could somebody make sure that broken MIME messages are not send to mailing
list. 8bit headers are not allowed. 8bit message body needs RFC2045
headers. By default courier-mta corrupts plain rfc822 messages with 8bit
message body.

-- 
Tomas



From austinenglish at gmail.com  Thu Apr  3 12:18:45 2008
From: austinenglish at gmail.com (Austin English)
Date: Thu, 3 Apr 2008 12:18:45 -0500
Subject: Make test - opengl regression
In-Reply-To: <b6bb06270804021505r6b25a45au8912e625f59abbb0@mail.gmail.com>
References: <b6bb06270804021505r6b25a45au8912e625f59abbb0@mail.gmail.com>
Message-ID: <b6bb06270804031018v79216ab3keeface5b7444927c@mail.gmail.com>

On Wed, Apr 2, 2008 at 5:05 PM, Austin English <austinenglish at gmail.com> wrote:
> Running on my virtualbox feisty vm, seems make test is making some progress:
>
>  austin at austin-desktop:~/wine-git$ cat wine-0.9.58-439-g73bd68c.txt |
>  grep 'make.*Error'
>  make[2]: *** [exception.ok] Error 1
>  make[1]: *** [ntdll/tests/__test__] Error 2
>  make[2]: *** [opengl.ok] Error 1
>  make[1]: *** [opengl32/tests/__test__] Error 2
>  make[2]: *** [msg.ok] Error 24
>  make[1]: *** [user32/tests/__test__] Error 2
>  make: *** [dlls/__test__] Error 2
>
>  The visual.c's are skipping properly now for me, but there's a
>  regression in opengl/opengl.c.
>
>  ../../../tools/runtest -q -P wine -M opengl32.dll -T ../../.. -p
>  opengl32_test.exe.so opengl.c && touch opengl.ok
>  err:wgl:X11DRV_wglCreateContext Cannot get FB Config for iPixelFormat
>  0, expect problems!
>  opengl.c:248: Test failed: Unable to confirm DONTCARE behavior of
>  unset pixelformatdescriptor flags
>  err:wgl:X11DRV_SetPixelFormat Invalid operation on root_window
>  opengl.c:323: Tests skipped: No suitable pixel formats found
>  make: *** [opengl.ok] Error 1
>
>  I haven't ran a regression test yet, but if you want more logs or a
>  regression test, let me know.
>

Seems Roderick's recent  wgl: Fix ChoosePixelFormat behavior patch is
to blame. Before, it would simply skip on failure, now I get a make
error. Is a skip() possible for this case?

http://source.winehq.org/git/wine.git/?a=commit;h=616ac380f9a1ed4e83f0159f4cc9768bad8b4a68


From thestig at google.com  Thu Apr  3 12:37:54 2008
From: thestig at google.com (Lei Zhang)
Date: Thu, 3 Apr 2008 10:37:54 -0700
Subject: Documentation is still in CVS?
Message-ID: <558b2f5c0804031037i427a04fbo1262e3f6c1a735d2@mail.gmail.com>

Hi,

Is there a reason why the Wine documentation is still in CVS, and not in GIT?

- Lei


From dimi at lattica.com  Thu Apr  3 12:50:22 2008
From: dimi at lattica.com (Dimi Paun)
Date: Thu, 03 Apr 2008 13:50:22 -0400
Subject: Documentation is still in CVS?
In-Reply-To: <558b2f5c0804031037i427a04fbo1262e3f6c1a735d2@mail.gmail.com>
References: <558b2f5c0804031037i427a04fbo1262e3f6c1a735d2@mail.gmail.com>
Message-ID: <1207245023.5399.43.camel@dimi.lattica.com>


On Thu, 2008-04-03 at 10:37 -0700, Lei Zhang wrote:
> Is there a reason why the Wine documentation is still in CVS, and not
> in GIT?

Yes. The docs are now maintained at SourceForge, and given the glacial
pace of updates, there is little reason to move them to git. Moreover,
git presents a much higher barrier to entry, and there's no reason to
raise it for (potentially non-technical) documentation contributors.

-- 
Dimi Paun <dimi at lattica.com>
Lattica, Inc.



From jnewman at codeweavers.com  Thu Apr  3 13:22:10 2008
From: jnewman at codeweavers.com (Jeremy Newman)
Date: Thu, 03 Apr 2008 13:22:10 -0500
Subject: broken mails from forum
In-Reply-To: <52937.78.61.224.253.1207241293.nsm@avilys.eik.lt>
References: <52937.78.61.224.253.1207241293.nsm@avilys.eik.lt>
Message-ID: <47F52052.1080203@codeweavers.com>

The source is here:
http://www.mail2forum.com/wiki/Download

If someone wants to patch it.

Tomas Kuliavas wrote:
> Hi,
> 
> Could somebody make sure that broken MIME messages are not send to mailing
> list. 8bit headers are not allowed. 8bit message body needs RFC2045
> headers. By default courier-mta corrupts plain rfc822 messages with 8bit
> message body.
> 


From chris.kcat at gmail.com  Thu Apr  3 15:33:49 2008
From: chris.kcat at gmail.com (Chris Robinson)
Date: Thu, 3 Apr 2008 13:33:49 -0700
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <47F49C1C.8090507@open-vote.org>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>
	<200804021615.24769.chris.kcat@gmail.com>
	<47F49C1C.8090507@open-vote.org>
Message-ID: <200804031333.49363.chris.kcat@gmail.com>

On Thursday 03 April 2008 01:58:04 am Scott Ritchie wrote:
> PulseAudio will take off exactly because Ubuntu is using it.

I don't see ALSA going anywhere anytime soon, seeing as it's in the Linux 
kernel itself.

There's also the issue of PulseAudio being designed to further abstract away 
the audio hardware, which is, IMO, the wrong way Wine needs to be going for 
its DirectSound implementation. The closer we can get to hardware capbilities 
and features, the better.. and AFAIK, ALSA can provide that (assuming its 
drivers know about it).

> > I'm sure I'm not alone in feeling like we're getting jerked around with
> > audio APIs in Linux (use OSS! no, use ESD! no, use ALSA! no, use
> > PulseAudio!). IMO, we have to set down and just pick something.
>
> Right, and very understandably it looks like we've picked ALSA, while
> the distributions seemed to have picked PulseAudio.

Just as distributions picked ESD (via Gnome) and aRts (via KDE) before.

AFAICS, the big issue with the sound landscape in Linux is the lack of ability 
to play multiple sounds at one time, brought on by the lack of proper 
hardware (that doesn't provide multiple output voices) combined with an API 
that can't smartly do software mixing given the lack of hardware voices. ALSA 
can do software mixing, but it needs to be told explicitly by using dmix.

Adding Yet Another Sound API will not fix this. In fact it'll make it worse, 
as each API will want to take exclusive control and we're left with a handful 
of APIs that need to be supported, because a user will be using one and can't 
(easilly) use another. As well, the more you layer one new API on another, 
you'll add more latency and room for bugs, and just enhance the impression 
that Linux audio sucks. Plus, it'll punish those that *do* have good hardware 
by abstracting it away to the lowest common denominator.

IMO, this is why Wine needs to use something lower-level like OSS and ALSA, so 
it can get the capabilities of hardware and offer them through its 
DirectSound implementation, and expose features of the same hardware, not a 
generalized sound server. With Direct3D, we go through OpenGL to expose the 
hardware capabilities. With DirectSound, ALSA seems to be the closest we have 
that provides hardware capabilities.


From saulius2 at ar.fi.lt  Thu Apr  3 16:16:15 2008
From: saulius2 at ar.fi.lt (Saulius Krasuckas)
Date: Fri, 4 Apr 2008 00:16:15 +0300 (EEST)
Subject: LoadStringW [1/2]
In-Reply-To: <47950AEF.9060409@procyongames.com>
References: <4794545B.4000909@procyongames.com>
	<005101c85c07$b280a180$a600fea9@DMITRY>
	<000601c85c08$f006a440$a600fea9@DMITRY>
	<4794FD3E.2080204@procyongames.com>
	<22821af30801211217g22c09c8bu597659ab11aafff0@mail.gmail.com> 
	<479504E4.4080401@procyongames.com>
	<22821af30801211252l30be545cqc9cf37bb4b89451c@mail.gmail.com>
	<47950AEF.9060409@procyongames.com>
Message-ID: <Pine.LNX.4.62.0804032333300.6745@tvarka.ar.fi.lt>

* James Hawkins wrote:
>* On Jan 21, 2008 2:14 PM, Christopher wrote:
>>* Dmitry Timoshkov wrote:
>>>
>>> Also, you need to test LoadStringA, to see if it behaves 
>>> similarly. It would be also interesting to test LoadStringA/W with 
>>> both buffer and buffer length set to 0.
>> 
>> I tested LoadStringA under Windows XP, and calling it with buflen 
>> == 0 does not return a pointer to the resource. In fact LoadStringA 
>> seems to behave fairly differently from LoadStringW: in that 
>> calling with buffer == NULL causes an access violation instead of 
>> just returning 0.
>
> That's why you need to add tests for LoadStringA to Wine's test 
> suite.

No, he did not.  The word "need" wasn't appropriate here.  Christopher 
wasn't going to change LoadStringA.  If changes of LoadStringW breaks 
LoadStringA then tests would show regression.  If tests are too weak, then 
only patch commiter or previous patchers of the LoadStringA are to blame, 
not the casual contributor who enhances B.

And if this is some new official rule for code, then I don't find it on 
the site:www.winehq.org .  Of course, I don't protest at the idea (as I 
would do the same as Dmitry wrote), but I protest against usage of this 
particular word -- it's too strong here.  Please, be more accurate with it.

P.S.: James, you probably should start learning to cut unnecessary blocks 
of quoted text (esp. empty lines) and doing some block justifying in your 
replies using your MUA some day.  Otherwise it gets too hard to read a 
discussion.


From julliard at winehq.org  Thu Apr  3 16:45:45 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 03 Apr 2008 23:45:45 +0200
Subject: Can we remove the rsabase tests?
In-Reply-To: <47F4C502.4040603@gmail.com> (Paul Vriens's message of "Thu, 03
	Apr 2008 13:52:34 +0200")
References: <47F4C502.4040603@gmail.com>
Message-ID: <87r6dmboja.fsf@wine.dyndns.org>

Paul Vriens <paul.vriens.wine at gmail.com> writes:

> The reason I think they can be removed:
>
> - rsaenh seems to be available most platforms. If not then also rsabase is not 
> available (by checking test.winehq.org)
> - rsabase is not available on XP and above
> - we forward all rsabase calls to rsaenh anyway

Sure, it's just a forwarding dll, it doesn't need tests.

-- 
Alexandre Julliard
julliard at winehq.org


From ryuzaki90 at gmail.com  Wed Apr  2 16:20:57 2008
From: ryuzaki90 at gmail.com (Bryan Haskins)
Date: Wed, 2 Apr 2008 17:20:57 -0400
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <22821af30804021159w70ab3327m26ebb9b325c82b1b@mail.gmail.com>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>
	<7e33d29b0804020808m558534f8q1d7430c219cfbc26@mail.gmail.com>
	<b6bb06270804021105v63c03b37nd9e47e72a2a338c6@mail.gmail.com>
	<22821af30804021133m46c0c78dy76debaec3d48bc9a@mail.gmail.com>
	<47F3D5EF.2030001@redhat.com>
	<22821af30804021159w70ab3327m26ebb9b325c82b1b@mail.gmail.com>
Message-ID: <7e33d29b0804021420j19d12047ma386a60d66f2c091@mail.gmail.com>

I would totally agree with that, James. If ALSA worked perfectly, it's
really no problem getting it working "OOB" with Pulse, no specific sound
system needed.

On Wed, Apr 2, 2008 at 2:59 PM, James Hawkins <truiken at gmail.com> wrote:

> On Wed, Apr 2, 2008 at 1:52 PM, Michael Stefaniuc <mstefani at redhat.com>
> wrote:
> > James Hawkins wrote:
> >  > On Wed, Apr 2, 2008 at 1:05 PM, Austin English <
> austinenglish at gmail.com> wrote:
> >  >> On Wed, Apr 2, 2008 at 10:08 AM, Bryan Haskins <ryuzaki90 at gmail.com>
> wrote:
> >  >>  > I'm more interested in a direct pulseaudio gateway for Wine...
> since by
> >  >>  > application sound control is the biggest thing here for most
> people.... wine
> >  >>  > is treated as one big audio blob. Pulse sees it as one thing. In
> effect,
> >  >>  > wine handles it's own audio (by talking with ALSA or OSS) then
> passes that
> >  >>  > through to the outside sound server... which in most cases would
> simply be
> >  >>  > ALSA or OSS itself, but in this case it gets passed to ALSA/OSS
> and through
> >  >>  > this talks to pulse. I call that pretty messy when we could just
> directly
> >  >>  > talk to pulse audio (easily, too) and have by applications
> control. Pulse is
> >  >>  > going to be in pretty much every distro soon. For a 1.0 release,
> no one
> >  >>  > wants to go out of their way to accomodate the shortcomings of
> our audio
> >  >>  > control.
> >  >>  >
> >  >>  >  Even directly sending the blobof output to pulse directly at
> first would
> >  >>  > simplify things. I know this means yet asnother audio output
> method to
> >  >>  > maintain, and for various reasons many are against it. But this
> is similar
> >  >>  > to us needing to improve ALSA support rather recently. Pulseaudio
> does
> >  >>  > directly support ALSA, but it's a bit demanding on how it need to
> work to be
> >  >>  > perfect.
> >  >>  >
> >  >>  >  ALSA, Pulseaudio, and OSS are probably the big three we need
> support for.
> >  >>  > Pulse is a drop in replacement for things like Network Sound, and
> way easier
> >  >>  > to configure and use.
> >  >>  >
> >  >>  >  Sorry for expanding the topic so much.
> >  >>  >
> >
> >
> >  >>
> >
> > >>  This has been brought up before, and it's quite a bit of work. You
> >  >>  can't just simply forward everything to pulse call it a day, you'd
> >  >>  need to implement a full structure/drivers/etc., which would
> require
> >  >>  quite a bit of time/work and is likely outside of the scope of 1.0.
> >  >>
> >  >
> >  > And I believe Julliard rejected the idea of adding a pulseaudio
> driver.
> >  Nope! He isn't against a pulseaudio driver. He is against yet another
> >  broken and half implemented driver for the desktop sound system that
> >  happens to be en vogue at the moment.
> >
> >  I think he would love to see a clean, full implemented pulseaudio
> >  driver; presented in a nice easy review-able patch series which cleans
> >  up the wineaudio driver mess en passant.
> >
>
> "No, the right answer is to make the Alsa driver work right. We need to
> stop rushing out to write a new driver every time there's a problem with
> an existing one, all it leads to is more broken drivers."
> -Julliard
>
> http://winehq.org/pipermail/wine-devel/2008-March/063755.html
>
> --
> James Hawkins
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080402/fe15ad9f/attachment-0001.htm 

From ryuzaki90 at gmail.com  Wed Apr  2 16:23:50 2008
From: ryuzaki90 at gmail.com (Bryan Haskins)
Date: Wed, 2 Apr 2008 17:23:50 -0400
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <7e33d29b0804021420j19d12047ma386a60d66f2c091@mail.gmail.com>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>
	<7e33d29b0804020808m558534f8q1d7430c219cfbc26@mail.gmail.com>
	<b6bb06270804021105v63c03b37nd9e47e72a2a338c6@mail.gmail.com>
	<22821af30804021133m46c0c78dy76debaec3d48bc9a@mail.gmail.com>
	<47F3D5EF.2030001@redhat.com>
	<22821af30804021159w70ab3327m26ebb9b325c82b1b@mail.gmail.com>
	<7e33d29b0804021420j19d12047ma386a60d66f2c091@mail.gmail.com>
Message-ID: <7e33d29b0804021423p5a3ec275l9d5b96234de28a8c@mail.gmail.com>

Sorry for the double post. But further on that point, at the sound system
neutral level, naming eahc app individually as a sound item would rock. In
such a way that each app perhaps talks to ALSA directly, which results in
self identification, and further Pulse via ALSA recognizing things
individually.

For me, the only way to get it working properly with pulse is padsp, meaning
using oss and prefixing all wine commands with padsp.

On Wed, Apr 2, 2008 at 5:20 PM, Bryan Haskins <ryuzaki90 at gmail.com> wrote:

> I would totally agree with that, James. If ALSA worked perfectly, it's
> really no problem getting it working "OOB" with Pulse, no specific sound
> system needed.
>
>
> On Wed, Apr 2, 2008 at 2:59 PM, James Hawkins <truiken at gmail.com> wrote:
>
> > On Wed, Apr 2, 2008 at 1:52 PM, Michael Stefaniuc <mstefani at redhat.com>
> > wrote:
> > > James Hawkins wrote:
> > >  > On Wed, Apr 2, 2008 at 1:05 PM, Austin English <
> > austinenglish at gmail.com> wrote:
> > >  >> On Wed, Apr 2, 2008 at 10:08 AM, Bryan Haskins <
> > ryuzaki90 at gmail.com> wrote:
> > >  >>  > I'm more interested in a direct pulseaudio gateway for Wine...
> > since by
> > >  >>  > application sound control is the biggest thing here for most
> > people.... wine
> > >  >>  > is treated as one big audio blob. Pulse sees it as one thing.
> > In effect,
> > >  >>  > wine handles it's own audio (by talking with ALSA or OSS) then
> > passes that
> > >  >>  > through to the outside sound server... which in most cases
> > would simply be
> > >  >>  > ALSA or OSS itself, but in this case it gets passed to ALSA/OSS
> > and through
> > >  >>  > this talks to pulse. I call that pretty messy when we could
> > just directly
> > >  >>  > talk to pulse audio (easily, too) and have by applications
> > control. Pulse is
> > >  >>  > going to be in pretty much every distro soon. For a 1.0
> > release, no one
> > >  >>  > wants to go out of their way to accomodate the shortcomings of
> > our audio
> > >  >>  > control.
> > >  >>  >
> > >  >>  >  Even directly sending the blobof output to pulse directly at
> > first would
> > >  >>  > simplify things. I know this means yet asnother audio output
> > method to
> > >  >>  > maintain, and for various reasons many are against it. But this
> > is similar
> > >  >>  > to us needing to improve ALSA support rather recently.
> > Pulseaudio does
> > >  >>  > directly support ALSA, but it's a bit demanding on how it need
> > to work to be
> > >  >>  > perfect.
> > >  >>  >
> > >  >>  >  ALSA, Pulseaudio, and OSS are probably the big three we need
> > support for.
> > >  >>  > Pulse is a drop in replacement for things like Network Sound,
> > and way easier
> > >  >>  > to configure and use.
> > >  >>  >
> > >  >>  >  Sorry for expanding the topic so much.
> > >  >>  >
> > >
> > >
> > >  >>
> > >
> > > >>  This has been brought up before, and it's quite a bit of work. You
> > >  >>  can't just simply forward everything to pulse call it a day,
> > you'd
> > >  >>  need to implement a full structure/drivers/etc., which would
> > require
> > >  >>  quite a bit of time/work and is likely outside of the scope of
> > 1.0.
> > >  >>
> > >  >
> > >  > And I believe Julliard rejected the idea of adding a pulseaudio
> > driver.
> > >  Nope! He isn't against a pulseaudio driver. He is against yet another
> > >  broken and half implemented driver for the desktop sound system that
> > >  happens to be en vogue at the moment.
> > >
> > >  I think he would love to see a clean, full implemented pulseaudio
> > >  driver; presented in a nice easy review-able patch series which
> > cleans
> > >  up the wineaudio driver mess en passant.
> > >
> >
> > "No, the right answer is to make the Alsa driver work right. We need to
> > stop rushing out to write a new driver every time there's a problem with
> > an existing one, all it leads to is more broken drivers."
> > -Julliard
> >
> > http://winehq.org/pipermail/wine-devel/2008-March/063755.html
> >
> > --
> > James Hawkins
> >
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080402/98bf1040/attachment-0001.htm 

From m.b.lankhorst at gmail.com  Thu Apr  3 12:47:58 2008
From: m.b.lankhorst at gmail.com (Maarten Lankhorst)
Date: Thu, 3 Apr 2008 10:47:58 -0700
Subject: iTunes ipod support
Message-ID: <b130c85e0804031047q2c02954ay79c1a26e4495e6e5@mail.gmail.com>

Hi all,

I submitted the ipod patches to wine-patches. This won't add support
for ipod touch or iphones. I expect that all patches will be merged
soon. If anyone feels adventurous they can try it. With the amount of
people interested in it I decided to post an update on the mailing
list so that everyone who picked up on the earlier threads can find
it.

Instructions:
- Apply attached patch
- Get a clean wineprefix
- Set wine version to vista
- Download the installer from itunes.com, and install.
- wine net start ipod\ service
- run itunes
- Hopefully the ipod is detected now. Dapper might have a bug in hald
which case it won't detect any usb hard drive that's plugged in. sudo
killall hald; sudo hald; wineserver -k; wine net start ipod\ service
seems to work as workaround.

So far there seems to be some confusion, so for the sake of clarity:
This won't add support for ipod touch or iphones.

Cheers,
Maarten.
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ipod_big.txt
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20080403/0799c8e5/attachment-0001.txt 

From hintak_leung at yahoo.co.uk  Thu Apr  3 13:29:10 2008
From: hintak_leung at yahoo.co.uk (Hin-Tak Leung)
Date: Thu, 3 Apr 2008 18:29:10 +0000 (GMT)
Subject: Documentation is still in CVS?
In-Reply-To: <1207245023.5399.43.camel@dimi.lattica.com>
Message-ID: <906835.3460.qm@web23111.mail.ird.yahoo.com>

--- On Thu, 3/4/08, Dimi Paun <dimi at lattica.com> wrote:

> From: Dimi Paun <dimi at lattica.com>
> Subject: Re: Documentation is still in CVS?
> To: "Wine Devel" <wine-devel at winehq.org>
> Date: Thursday, 3 April, 2008, 6:50 PM
> On Thu, 2008-04-03 at 10:37 -0700, Lei Zhang wrote:
> > Is there a reason why the Wine documentation is still
> in CVS, and not
> > in GIT?
> 
> Yes. The docs are now maintained at SourceForge, and given
> the glacial
> pace of updates, there is little reason to move them to
> git. Moreover,
> git presents a much higher barrier to entry, and
> there's no reason to
> raise it for (potentially non-technical) documentation
> contributors.
>

Actually I tried to follow the wiki instructions to do a git-cvsimport and it didn't work a week or two ago; and plain "cvs co" did not work either.
I have a few other stuff on sourceforge, so the problem seems to be specific to wine. Does anonymous check out work for anybody else? 






      __________________________________________________________
Sent from Yahoo! Mail.
A Smarter Inbox http://uk.docs.yahoo.com/nowyoucan.html


From thestig at google.com  Thu Apr  3 17:14:03 2008
From: thestig at google.com (Lei Zhang)
Date: Thu, 3 Apr 2008 15:14:03 -0700
Subject: Documentation is still in CVS?
In-Reply-To: <906835.3460.qm@web23111.mail.ird.yahoo.com>
References: <1207245023.5399.43.camel@dimi.lattica.com>
	<906835.3460.qm@web23111.mail.ird.yahoo.com>
Message-ID: <558b2f5c0804031514u3f093c85u3ed8ca9a5ecfe5ac@mail.gmail.com>

On Thu, Apr 3, 2008 at 11:29 AM, Hin-Tak Leung <hintak_leung at yahoo.co.uk> wrote:
>  Actually I tried to follow the wiki instructions to do a git-cvsimport and it didn't work a week or two ago; and plain "cvs co" did not work either.
>  I have a few other stuff on sourceforge, so the problem seems to be specific to wine. Does anonymous check out work for anybody else?
>

The instructions on http://www.winehq.org/site/cvs works for me.


From dank at kegel.com  Thu Apr  3 20:14:03 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 3 Apr 2008 18:14:03 -0700
Subject: [1/6] qedit: Add test framework and test for
	IMediaDet_put_Filename.
Message-ID: <a71bd89a0804031814g6781be2dt95f27a2ab0b3da67@mail.gmail.com>

I think you can't depend on files existing in the source
directory; you have to create them yourself
(e.g. from a hex array in your source).
Otherwise the unified winetest app that we
use for semiautomated remote windows testing
by users won't work.

But if, say, WINETEST_INTERACTIVE is set, you
can still use test.avi in the local directory instead
of creating one.


From dmitry at codeweavers.com  Thu Apr  3 21:10:15 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 4 Apr 2008 11:10:15 +0900
Subject: LoadStringW [1/2]
References: <4794545B.4000909@procyongames.com><005101c85c07$b280a180$a600fea9@DMITRY><000601c85c08$f006a440$a600fea9@DMITRY><4794FD3E.2080204@procyongames.com><22821af30801211217g22c09c8bu597659ab11aafff0@mail.gmail.com>
	<479504E4.4080401@procyongames.com><22821af30801211252l30be545cqc9cf37bb4b89451c@mail.gmail.com><47950AEF.9060409@procyongames.com>
	<Pine.LNX.4.62.0804032333300.6745@tvarka.ar.fi.lt>
Message-ID: <006401c895f9$07c167d0$a600fea9@DMITRY>

"Saulius Krasuckas" <saulius2 at ar.fi.lt> wrote:

> No, he did not.  The word "need" wasn't appropriate here.  Christopher 
> wasn't going to change LoadStringA.  If changes of LoadStringW breaks 
> LoadStringA then tests would show regression.  If tests are too weak, then 
> only patch commiter or previous patchers of the LoadStringA are to blame, 
> not the casual contributor who enhances B.

It should be obvious that if a patch introduces a regression (which is the case)
then this patch can't be aplied. If the regression can be identified by someone
able to read the code and not by a regression test that doesn't matter.

> P.S.: James, you probably should start learning to cut unnecessary blocks 
> of quoted text (esp. empty lines) and doing some block justifying in your 
> replies using your MUA some day.  Otherwise it gets too hard to read a 
> discussion.

James left the useful context which is especially helpful for you to reply
in 2 weeks without need to reread the whole thread.

-- 
Dmitry.


From dsh at linux.ucla.edu  Thu Apr  3 21:17:06 2008
From: dsh at linux.ucla.edu (Dan Hipschman)
Date: Thu, 3 Apr 2008 19:17:06 -0700
Subject: [1/6] qedit: Add test framework and test for
	IMediaDet_put_Filename.
In-Reply-To: <a71bd89a0804031814g6781be2dt95f27a2ab0b3da67@mail.gmail.com>
References: <a71bd89a0804031814g6781be2dt95f27a2ab0b3da67@mail.gmail.com>
Message-ID: <20080404021706.GN4608@linux.ucla.edu>

On Thu, Apr 03, 2008 at 06:14:03PM -0700, Dan Kegel wrote:
> I think you can't depend on files existing in the source
> directory; you have to create them yourself
> (e.g. from a hex array in your source).
> Otherwise the unified winetest app that we
> use for semiautomated remote windows testing
> by users won't work.
> 
> But if, say, WINETEST_INTERACTIVE is set, you
> can still use test.avi in the local directory instead
> of creating one.

It doesn't depend on any files anywhere at runtime.  The file is
compiled into the executable as a resource and the resource is extracted
to a temp file at runtime, so the executable is all you need to run the
test.


From dank at kegel.com  Thu Apr  3 22:18:21 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 3 Apr 2008 20:18:21 -0700
Subject: [1/6] qedit: Add test framework and test for
	IMediaDet_put_Filename.
In-Reply-To: <20080404021706.GN4608@linux.ucla.edu>
References: <a71bd89a0804031814g6781be2dt95f27a2ab0b3da67@mail.gmail.com>
	<20080404021706.GN4608@linux.ucla.edu>
Message-ID: <a71bd89a0804032018p4ade49c5rb306cb72b03dfed0@mail.gmail.com>

On Thu, Apr 3, 2008 at 7:17 PM, Dan Hipschman <dsh at linux.ucla.edu> wrote:
>  It doesn't depend on any files anywhere at runtime.  The file is
>  compiled into the executable as a resource and the resource is extracted
>  to a temp file at runtime, so the executable is all you need to run the
>  test.

Well, foo.  I stand corrected.  Sorry for the noise!


From dank at kegel.com  Thu Apr  3 22:26:42 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 3 Apr 2008 20:26:42 -0700
Subject: Lug Radio Live 2008 wine talk. Slides online, comments welcome.
Message-ID: <a71bd89a0804032026s2f87faa7v27641421c4e07ac1@mail.gmail.com>

I'm going to be giving a Wine talk at LugRadio Live 2008,
April 12-13, in San Francisco.
My talk is Saturday at 2:30; see
http://lugradio.org/live/USA2008/schedule

In a mixup at my favorite coffeehouse today
(Stir Crazy), I was accidentally overcaffeinated,
and wrote my entire presentation in about one sitting.
It's online at
  http://kegel.com/wine/lugradiolive2008/
The slides are pretty basic; I'll talk a lot around them.
If anybody feels like reviewing the slides
and giving feedback, I'd appreciate it.

If anybody's planning on attending the event, let's
get together for lunch or coffee or something.
- Dan


From talk2cod at hotmail.com  Thu Apr  3 23:15:24 2008
From: talk2cod at hotmail.com (andre furtado)
Date: Fri, 4 Apr 2008 04:15:24 +0000
Subject: hypertrm exported functions
Message-ID: <BAY109-W118E3C4B4EFACACD38FA6E87F60@phx.gbl>


add documentation for exported functions of the win32 hypertrm library...
BOOL InitInstance(const HINSTANCE hInstance, const LPTSTR lpCmdLine, const int nCmdShow)/* creates the hypertrm session window.   args:   hInstance - apps instance handle.   lpCmdLine - command line.   nCmdShow - passed from winmain overhead function arglist. */
int MessageLoop(void)
/* window message loop. return a wparam int value, that contains the additional information of the 
processed message. */
SF_HANDLE sessQuerySysFileHdl(const HSESSION hSession)
/* returns the sysfile handle based on hypertrm session.   args:   hSession -> hypertrm session. */
HTRANSLATE sessQueryTranslateHdl(const HSESSION hSession)
/* returns the translate handle associated with specific hypertrm session. translate handle is used 
for manager character translation.   args:   hSession -> hypertrm session. */
int sfGetSessionItem(const SF_HANDLE hSF,     const UINT uID,     unsigned long *pIDSize,     void *pvData)
/* is used to get data and item size from the session file handle.   args:   hSF -> session file handle.   uID -> item id.   [out] pIDSize -> size returned.   [out] pvData -> a pointer to an buffer that receives the data. */
int sfPutSessionItem(const SF_HANDLE hSF,     const unsigned int uID,     const unsigned long uIDSize,     const void *pvData)
/* is used to add or modify an entry in the session file data associated with the current session file 
handle.   args:   hSF -> session file handle.   uID -> item id.   pIDSize -> size.   pvData -> a pointer to an buffer of data. */
talk2cod at hotmail.com
_________________________________________________________________
Cansado de espa?o para s? 50 fotos? Conhe?a o Spaces, o site de relacionamentos com at? 6,000 fotos!
http://www.amigosdomessenger.com.br
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080404/3899d1a1/attachment.htm 

From wine-devel at kievinfo.com  Thu Apr  3 23:42:42 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Thu, 03 Apr 2008 22:42:42 -0600
Subject: hypertrm exported functions
In-Reply-To: <BAY109-W118E3C4B4EFACACD38FA6E87F60@phx.gbl>
References: <BAY109-W118E3C4B4EFACACD38FA6E87F60@phx.gbl>
Message-ID: <47F5B1C2.9020101@kievinfo.com>

andre furtado wrote:
> add documentation for exported functions of the win32 hypertrm library...
Send all patches in unified diff format from the top of the source tree. 
Drop all html content - plain text only please.

For more information read http://wiki.winehq.org/SubmittingPatches

Vitaliy.


From dmitry at codeweavers.com  Fri Apr  4 00:51:51 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 4 Apr 2008 14:51:51 +0900
Subject: hypertrm exported functions
References: <BAY109-W118E3C4B4EFACACD38FA6E87F60@phx.gbl>
	<47F5B1C2.9020101@kievinfo.com>
Message-ID: <000601c89617$fcc544e0$a600fea9@DMITRY>

"Vitaliy Margolen" <wine-devel at kievinfo.com> wrote:

> andre furtado wrote:
>> add documentation for exported functions of the win32 hypertrm library...
> Send all patches in unified diff format from the top of the source tree. 
> Drop all html content - plain text only please.
> 
> For more information read http://wiki.winehq.org/SubmittingPatches

The only problem left is that there is no hypertrm in the Wine tree...

-- 
Dmitry.


From xerox_xerox2000 at yahoo.co.uk  Fri Apr  4 01:06:48 2008
From: xerox_xerox2000 at yahoo.co.uk (Louis. Lenders)
Date: Fri, 4 Apr 2008 06:06:48 +0000 (GMT)
Subject: Question about LoadImageW and gifs (affects all new Autodesk
	installers)
Message-ID: <958661.76297.qm@web23206.mail.ird.yahoo.com>

Hi, does anyone know if LoadImageW is supposed to work with *.gif files? I'm asking because Autodesk installers seem to so something like 
LoadImageW(0,"c:\\foo.gif",IMAGE_BITMAP, 0, 0, LR_LOADFROMFILE)
and then wine just crashes later on, as it tries to get the bitmapinfo header , and ends up with wrong info for size of bitmapinfoheader, width, height etc. Anyone an idea why the installer would do such weird thing? See also http://bugs.winehq.org/show_bug.cgi?id=11784




      ___________________________________________________________ 
Yahoo! For Good helps you make a difference  

http://uk.promotions.yahoo.com/forgood/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080404/1b51f999/attachment-0001.htm 

From wine-devel at kievinfo.com  Fri Apr  4 01:13:02 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Fri, 04 Apr 2008 00:13:02 -0600
Subject: hypertrm exported functions
In-Reply-To: <000601c89617$fcc544e0$a600fea9@DMITRY>
References: <BAY109-W118E3C4B4EFACACD38FA6E87F60@phx.gbl>
	<47F5B1C2.9020101@kievinfo.com>
	<000601c89617$fcc544e0$a600fea9@DMITRY>
Message-ID: <47F5C6EE.7040207@kievinfo.com>

Dmitry Timoshkov wrote:
> "Vitaliy Margolen" <wine-devel at kievinfo.com> wrote:
> 
>> andre furtado wrote:
>>> add documentation for exported functions of the win32 hypertrm 
>>> library...
>> Send all patches in unified diff format from the top of the source 
>> tree. Drop all html content - plain text only please.
>>
>> For more information read http://wiki.winehq.org/SubmittingPatches
> 
> The only problem left is that there is no hypertrm in the Wine tree...
> 
Maybe he wants to write one? <g>

Vitaliy.


From pure_evil at mail.bg  Fri Apr  4 02:46:01 2008
From: pure_evil at mail.bg (pure_evil at mail.bg)
Date: Fri, 4 Apr 2008 10:46:01 +0300
Subject: Lug Radio Live 2008 wine talk. Slides online, comments welcome.
Message-ID: <200804041046.01798.pure_evil@mail.bg>

Woah, that's ubercool.
The presentation is excellent! However, you could add five collosal IMHO 
advantages of wine:

1. NO 1000 DISCONTINUED WIN VERSIONS

That's what largely made me dump 'doze and go for Linux - got 6 W98 licenses, 
and at some point, upgraded the hardware to discover that 98 doesn't support 
the new Mainboards. 
So I spent two days trying to get all the MBs replaced, managed to get '98 
running... And trust me, last thing you wanna do when you're in an empty new 
office is to extend a phone wire with a UTP wire to use the only connected 
atm phone socket to get dial-up working and with the collosal 5KBITS(!) per 
second to google out the only remaining in the PC store's warehouse mainboard 
to see if that supports '98, so you can call 'em and tell 'em "I'll 
take 'em". 
Oh, and you have to bring in your OWN PERSONAL machine to do that. The rest 
are basically a pile of mainboards which can't run '98 so they can't use the 
modem and so forth.

And then enter my favorite software provider, sees the new machines, claps his 
hands and says: 
"Cool, new machines! Now you get the new windows version of the soft, and, it 
requires XP! And since you are the only ones to use the DOS version, it's 
discontinued from now on.
Oh, and BTW? Your friendly local Samba server? 
Guess what, we're going MSSQL from now on, you need 1G of RAM on an XP 
machine... for 40 megs of databases."
So with a thousand pains me gets the damn thing working on 98 and sacrifices 
TWO NEW MACHINES for the SQL server(s)  and purchases TWO UNNECESSARY XP 
LICENSES - cuz two sets of databases, and, well, the express version doesn't 
support that.
And things get better: "Yeah, you got it running under '98. Guess what, we'll 
be using cutting-edge stuff from now on; Now it's MSShitQL 2005, when 
something new comes out, you'll be upgrading; And once my soft becomes 
fully '98 incompatible, THEN you scrap the 98 licenses and by new, XP ones."
"- But no money for licenses?" (1 XP = 1 new machine without monitor 
basically. Oh, and it has to be Professional)
"- Bah, go pirate. Everybody's doing it." 
(What does he mean by  on "cutting-edge stuff" BTW?! VISTA?! For an accounting 
database?!)

And every once in a while when there's a bug in his soft, he attributes it to 
98. Program closes but press ctrl-alt-del and you get a bunch of instances 
remaining? 98's fault. Slow? 98's fault. Crash due to an empty piece of 
database? "'98s fault". And of course, after 98s fault follows the 
natural "install XP".

Enter wine. Select windows version = XP. Work.

2.) No Premium Basic Home Server Client whatever. 

Enter wine. Work.

3.) Easy reinstall.
Delete "drive_c" and the reg files. "wineprefixcreate". Work.

4.) A 1000 windows on one machine.
~3 Megs per "drive_c". Work.

5.) Forget that "viruses under wine" stuff from days past, no, really. 
 - No startup! Hide all you like in the registry you piece of cr... spyware, I 
won't even know you got there, nor will you ever get started!
- No IE5678910! Yeah! Come and get me.
- What, no normally inaccessible (even to NOD32 at some point) "System Volume 
Information"? Where are you gonna hide (or rather, stay exposed frustrating 
me)?
- And where's the MBR of "drive_c"? in ".wine"?

All that combined is what makes me want to develop for wine.


From jonathan at ernstfamily.ch  Fri Apr  4 04:05:33 2008
From: jonathan at ernstfamily.ch (Jonathan Ernst)
Date: Fri, 04 Apr 2008 11:05:33 +0200
Subject: Lug Radio Live 2008 wine talk. Slides online, comments welcome.
In-Reply-To: <a71bd89a0804032026s2f87faa7v27641421c4e07ac1@mail.gmail.com>
References: <a71bd89a0804032026s2f87faa7v27641421c4e07ac1@mail.gmail.com>
Message-ID: <1207299933.6522.112.camel@jernst-desktop>

??Hello,

Le jeudi 03 avril 2008 ? 20:26 -0700, Dan Kegel a ?crit :
> [...]

> The slides are pretty basic; I'll talk a lot around them.
> If anybody feels like reviewing the slides
> and giving feedback, I'd appreciate it.


Slide 4 :

You might be interested to add some, government related, recent
migrations in Europe to this slide :

French Police ~70'000 seats
http://www.cnet.com/8301-13505_1-9861472-16.html

Geneva, Switzerland schools 9'000 seats
http://www.tdg.ch/pages/home/tribune_de_geneve/recherche/recherche_3_2_1/(contenu)/211880

http://www.google.com/translate?u=http%3A%2F%2Fwww.tdg.ch%2Fpages%2Fhome
%2Ftribune_de_geneve%2Frecherche%2Frecherche_3_2_1%2F(contenu)%
2F211880&langpair=fr|en&hl=fr&ie=UTF8

Slide 13 :

Maybe add "2008: Codeweavers releases Crossover Games"

I'm looking forward to hearing this second Wine related LugRadio.

Best regards.

Jonathan





From julliard at winehq.org  Fri Apr  4 04:50:51 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 04 Apr 2008 11:50:51 +0200
Subject: [1/6] qedit: Add test framework and test for
	IMediaDet_put_Filename.
In-Reply-To: <20080404005341.GH4608@linux.ucla.edu> (Dan Hipschman's message
	of "Thu, 3 Apr 2008 17:53:41 -0700")
References: <20080404005341.GH4608@linux.ucla.edu>
Message-ID: <87ve2yaqys.fsf@wine.dyndns.org>

Dan Hipschman <dsh at linux.ucla.edu> writes:

> This sets up some real tests for qedit using an actual AVI file to test
> with.  The resource is constructed from the AVI file by prepending the
> size so we know how big it is in the code.

That's ugly, you should use SizeofResource instead.

-- 
Alexandre Julliard
julliard at winehq.org


From xixsimplicityxix at gmail.com  Fri Apr  4 04:56:25 2008
From: xixsimplicityxix at gmail.com (John Klehm)
Date: Fri, 4 Apr 2008 04:56:25 -0500
Subject: Crossbuild patch, appropriate for wine?
Message-ID: <78a7dad00804040256q35948105gb5d52d9b975c8830@mail.gmail.com>

Hey the following patch eases cross compiling of the dlls that use
exceptions, its possible to work around this with scripts of course
but this makes it much cleaner to do so.  I wasnt sure if it was
appropriate to include such a modification in wine though.

This is based on what mingw does in its windef.h but I thought that
excpt.h was more appropriate.  See here for reference:
http://cygwin.com/cgi-bin/cvsweb.cgi/src/winsup/w32api/include/windef.h?rev=1.22&content-type=text/x-cvsweb-markup&cvsroot=src

With this patch the dlls that dont cross compile with wines headers are:
dbghelp
dnsapi
gdi32
glu32
icmp
iphlpapi
kernel32
msvcrt
ntdll
opengl32
rpcrt4
secur32
shell32
winex11.drv
wininet
winmm
ws2_32

Regards,

John Klehm


---
 include/excpt.h |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/include/excpt.h b/include/excpt.h
index 3369f3b..081fb06 100644
--- a/include/excpt.h
+++ b/include/excpt.h
@@ -46,6 +46,10 @@ typedef enum _EXCEPTION_DISPOSITION
 unsigned long __cdecl _exception_code(void);
 void * __cdecl _exception_info(void);
 int __cdecl _abnormal_termination(void);
+#elif defined(__GNUC__) && defined(USE_COMPILER_EXCEPTIONS)
+#define __try
+#define __except(x) while(0)
+#define __finally
 #endif /* defined(_MSC_VER) && defined(USE_COMPILER_EXCEPTIONS) */

 #endif /* __WINE_EXCPT_H */
--
1.5.4.5


From xixsimplicityxix at gmail.com  Fri Apr  4 05:06:43 2008
From: xixsimplicityxix at gmail.com (John Klehm)
Date: Fri, 4 Apr 2008 05:06:43 -0500
Subject: MinGW cross compilation fails for d3dx9_36/tests
In-Reply-To: <78a7dad00804021251o444fc651y4bd64648f0b2b0bd@mail.gmail.com>
References: <47E8C0FC.2010700@gmail.com> <20080325093948.145810@gmx.net>
	<78a7dad00803280405w3da1fd8dv383a1c7dc6688bfa@mail.gmail.com>
	<78a7dad00804021251o444fc651y4bd64648f0b2b0bd@mail.gmail.com>
Message-ID: <78a7dad00804040306t38ddd698i46b2423c7138888a@mail.gmail.com>

On Wed, Apr 2, 2008 at 2:51 PM, John Klehm <xixsimplicityxix at gmail.com> wrote:
> On Fri, Mar 28, 2008 at 6:05 AM, John Klehm <xixsimplicityxix at gmail.com> wrote:
>  >
>  >  Well let me know how this works for you.  I'll refactor my script a
>  >  bit later today but for right now you have to run this one after the
>  >  winetest script, as this one counts on the environment that the
>
>  Here's the refactored script [1].  With some inspiration from winetricks ;)
>
>  Example uses:
>  $crossbuild_tricks winetest
>
>  $crossbuild_tricks d3d
>  => builds d3d8,d3d9,wined3d, libwine
>
>  $crossbuild_tricks test cabinet
>  => use test verb for individual tests
>
>  $crossbuild_tricks dll wintrust
>  => use dll verb for individual dlls
>
>
>  First release and I've tested it some, seems to work but let me know
>  if it breaks for you.
>
>
>  Regards,
>  John
>
>  [1] http://klehm.net/wine/crossbuild_tricks.sh
>

Updated version of crossbuild_tricks:
http://klehm.net/wine/crossbuild_tricks.sh

Changes:

-improved build time: builds only the minimum required targets now.

New verbs:
libs   => build just the import libs (*.a).  Puts them in
wine-pe/libs/wine as usual.
alldlls => build all possible dlls.  Copies them to wine-pe/binaries
for easy downloading.

Dlls known not to cross build:
dbghelp
dnsapi
gdi32
glu32
icmp
iphlpapi
kernel32
msvcrt
ntdll
opengl32
rpcrt4
secur32
shell32
winex11.drv
wininet
winmm
ws2_32

distclean =>  clean up the wine-native and wine-pe dirs and run
distclean in wine-src (a "wash me clean of this dirty script" verb ;)


Use the patch I sent in the other mail that adds mingw like no op
exception stuff if you really need to cross build crypt32 (maybe
others) that complain about missing __try etc.

Any problems let me know.

Enjoy,
John


From mle+win at mega-nerd.com  Fri Apr  4 06:03:35 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Fri, 4 Apr 2008 22:03:35 +1100
Subject: Bug in MSVCRT_fseek (with patch)
Message-ID: <20080404220335.ca47d856.mle+win@mega-nerd.com>

Hi all,

I think I have found a bug in MSVCRT_fseek. If I fread() to the end
of a file, then do fseek (file, 0, SEEK_SET), the feof() function
still returns true.

According to the ISO standard

  A successful call to fseek() shall clear the end-of-file indicator
  for the stream and undo any effects of ungetc() and ungetwc() on
  the same stream. After an fseek() call, the next operation on an
  update stream may be either input or output.

The following patch to dlls/msvcrt/file.c fixes the issue. I also
have a small standalone test program below that fails before the
patch and passes after.

Cheers,
Erik

The patch:
-------------8<-------------8<-------------8<-------------8<-------------
--- a/dlls/msvcrt/file.c
+++ b/dlls/msvcrt/file.c
@@ -918,6 +918,8 @@ int CDECL MSVCRT_fseek(MSVCRT_FILE* file, long offset, int whence)
   if(file->_flag & MSVCRT__IORW) {
         file->_flag &= ~(MSVCRT__IOREAD|MSVCRT__IOWRT);
   }
+  /* Clear end of file */
+  file->_flag &= ~MSVCRT__IOEOF;
   return (_lseek(file->_file,offset,whence) == -1)?-1:0;
 }
 
-------------8<-------------8<-------------8<-------------8<-------------

The test program:
-------------8<-------------8<-------------8<-------------8<-------------
#include <stdio.h>
#include <stdlib.h>
#include <stdarg.h>

static void
error_exit (const char * fmt, ...)
{
	va_list ap ;
	va_start (ap,  fmt) ;
	vprintf (fmt, ap) ;
	va_end (ap) ;

	exit (1) ;
} /* error_exit */

int
main (void)
{	const char * filename = "test.dat" ;
	char buffer [12] ;
	FILE * file ;

	/* Create a short data file. */
	if ((file = fopen (filename, "w")) == NULL)
		error_exit ("Error on line %d : fopen\n", __LINE__) ;
	fputs("abcdefghaiklmnopqrstuvwxyz\n", file) ;
	fclose (file) ;

	/* Now read the file. */
	if ((file = fopen (filename, "r")) == NULL)
		error_exit ("Line %d : fopen\n", __LINE__) ;

	while (fread (buffer, sizeof (buffer), 1, file) > 0)
		(void) 0 ;

	if (! feof (file))
		error_exit ("Error on line %d : feof should return true.\n", __LINE__) ;

	fseek (file, 0, SEEK_SET) ;

	if (feof (file))
		error_exit ("Error on line %d : feof should return false.\n", __LINE__) ;

	fclose (file) ;

	remove (filename) ;

	return 0 ;
} /* main */
-------------8<-------------8<-------------8<-------------8<-------------

-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
"C++ has its place in the history of programming languages. Just
as Caligula has his place in the history of the Roman Empire."
-- Robert Firth


From dank at kegel.com  Fri Apr  4 06:06:30 2008
From: dank at kegel.com (Dan Kegel)
Date: Fri, 4 Apr 2008 04:06:30 -0700
Subject: Bug in MSVCRT_fseek (with patch)
Message-ID: <a71bd89a0804040406r610fe4d6q25e217b9a456505@mail.gmail.com>

Does your test also pass on Windows?

How did you run into this -- does the bug keep a real Windows
app from running on Wine?  Which one?

To get your change and test accepted, please send a patch,
and make the test a real wine conformance test.
- Dan


From julliard at winehq.org  Fri Apr  4 06:19:59 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 04 Apr 2008 13:19:59 +0200
Subject: [PATCH 4/4] configure.ac: Add support for MSVC.
In-Reply-To: <47F60D0C.20209@codeweavers.com> (Robert Shearman's message of
	"Fri, 04 Apr 2008 12:12:12 +0100")
References: <47F60D0C.20209@codeweavers.com>
Message-ID: <87r6dlc1eo.fsf@wine.dyndns.org>

Robert Shearman <rob at codeweavers.com> writes:

> MSVC needs a lot more in the way of rule changes and/or helper scripts
> for it to work properly, but this is a good start.

I'm not sure I see the point. You can't really run configure or make on
an MSVC setup anyway. It seems to me that something like msvcmaker is a
better solution.

-- 
Alexandre Julliard
julliard at winehq.org


From rob at codeweavers.com  Fri Apr  4 06:36:57 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Fri, 04 Apr 2008 12:36:57 +0100
Subject: [PATCH 4/4] configure.ac: Add support for MSVC.
In-Reply-To: <87r6dlc1eo.fsf@wine.dyndns.org>
References: <47F60D0C.20209@codeweavers.com> <87r6dlc1eo.fsf@wine.dyndns.org>
Message-ID: <47F612D9.4060000@codeweavers.com>

Alexandre Julliard wrote:
> Robert Shearman <rob at codeweavers.com> writes:
>   
>> MSVC needs a lot more in the way of rule changes and/or helper scripts
>> for it to work properly, but this is a good start.
>>     
>
> I'm not sure I see the point. You can't really run configure or make on
> an MSVC setup anyway.

Well, you can. MSVC can be run in wine and you can install a Win32 port 
of sh to run configure on Windows and all of our configure tests work.

> It seems to me that something like msvcmaker is a
> better solution.

Yes, you're right. I wish I'd known about the purpose of this tool 
before I went down the route that I did...

-- 
Rob Shearman



From rob at codeweavers.com  Fri Apr  4 06:47:17 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Fri, 04 Apr 2008 12:47:17 +0100
Subject: Crossbuild patch, appropriate for wine?
In-Reply-To: <78a7dad00804040256q35948105gb5d52d9b975c8830@mail.gmail.com>
References: <78a7dad00804040256q35948105gb5d52d9b975c8830@mail.gmail.com>
Message-ID: <47F61545.4040709@codeweavers.com>

John Klehm wrote:
> diff --git a/include/excpt.h b/include/excpt.h
> index 3369f3b..081fb06 100644
> --- a/include/excpt.h
> +++ b/include/excpt.h
> @@ -46,6 +46,10 @@ typedef enum _EXCEPTION_DISPOSITION
>  unsigned long __cdecl _exception_code(void);
>  void * __cdecl _exception_info(void);
>  int __cdecl _abnormal_termination(void);
> +#elif defined(__GNUC__) && defined(USE_COMPILER_EXCEPTIONS)
> +#define __try
> +#define __except(x) while(0)
> +#define __finally
>  #endif /* defined(_MSC_VER) && defined(USE_COMPILER_EXCEPTIONS) */
>
>  #endif /* __WINE_EXCPT_H */
>   

Actually, I think the best place to fix this is in 
include/wine/exception.h. I also think it would be better to use 
"defined(__MINGW32__) && !defined(USE_COMPILER_EXCEPTIONS)." This is 
because that is the platform that can't use the exception macros 
implemented on top of sigsetjmp, and if the developer defines 
"USE_COMPILER_EXCEPTIONS" then it is telling us that their compiler 
supports __try, __except and __finally (there have been custom builds of 
MinGW that include support for native exception handling).

-- 
Rob Shearman



From mle+win at mega-nerd.com  Fri Apr  4 06:56:33 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Fri, 4 Apr 2008 22:56:33 +1100
Subject: Bug in MSVCRT_fseek (with patch)
In-Reply-To: <200804041536.54810.lich@math.spbu.ru>
References: <200804041536.54810.lich@math.spbu.ru>
Message-ID: <20080404225633.f64fddd8.mle+win@mega-nerd.com>

Kirill K. Smirnov wrote:

> What if you try to fseek to the end of file (SEEK_END)? Should IOEOF flag be 
> cleared in this case?

I believe that for a standards conforming fseek it should be. See:

    http://www.opengroup.org/onlinepubs/000095399/functions/fseek.html

For standards conforming behaviour fseek(f,0,SEEK_END) clears the
flag, and the next fread will return 0 and set it again.

However, I realize that for wine, the standards are pretty much
moot as wine attempts to be bug compatible with windows. Obviously
some more testing (on windows and wine) is required.

> And may _lseek() function be better place for this?

I don't think so. _lseek keeps its own flags.

Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
"C++ is like jamming a helicopter inside a Miata and expecting
some sort of improvement." -- Drew Olbrich


From mle+win at mega-nerd.com  Fri Apr  4 06:23:02 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Fri, 4 Apr 2008 22:23:02 +1100
Subject: Bug in MSVCRT_fseek (with patch)
In-Reply-To: <a71bd89a0804040406r610fe4d6q25e217b9a456505@mail.gmail.com>
References: <a71bd89a0804040406r610fe4d6q25e217b9a456505@mail.gmail.com>
Message-ID: <20080404222302.b6494332.mle+win@mega-nerd.com>

Dan Kegel wrote:

> Does your test also pass on Windows?

I didn't try this actual test on windows because I don't have
easy access to windows. However ....

> How did you run into this -- does the bug keep a real Windows
> app from running on Wine?  Which one?

That gets complicated. I'm on Linux, cross compiling to windows
using the mingw cross compiler and running the test suite on
wine. One of the test programs was failing under wine but it did
pass on windows xp. I tracked it down to this incorrect behaviour
of the feof function.

> To get your change and test accepted, please send a patch,
> and make the test a real wine conformance test.

Sure. I'll bang on this some more.

Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
Being really good at C++ is like being really good at using rocks to
sharpen sticks." -- Thant Tessman


From julliard at winehq.org  Fri Apr  4 07:21:42 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 04 Apr 2008 14:21:42 +0200
Subject: Crossbuild patch, appropriate for wine?
In-Reply-To: <47F61545.4040709@codeweavers.com> (Robert Shearman's message of
	"Fri, 04 Apr 2008 12:47:17 +0100")
References: <78a7dad00804040256q35948105gb5d52d9b975c8830@mail.gmail.com>
	<47F61545.4040709@codeweavers.com>
Message-ID: <87myo9byjt.fsf@wine.dyndns.org>

Robert Shearman <rob at codeweavers.com> writes:

> Actually, I think the best place to fix this is in 
> include/wine/exception.h. I also think it would be better to use 
> "defined(__MINGW32__) && !defined(USE_COMPILER_EXCEPTIONS)." This is 
> because that is the platform that can't use the exception macros 
> implemented on top of sigsetjmp, and if the developer defines 
> "USE_COMPILER_EXCEPTIONS" then it is telling us that their compiler 
> supports __try, __except and __finally (there have been custom builds of 
> MinGW that include support for native exception handling).

I don't think we want to disable exceptions, that will just lead to
broken builds. It should be possible to make the sigsetjmp variant work
for MinGW.

-- 
Alexandre Julliard
julliard at winehq.org


From rob at codeweavers.com  Fri Apr  4 07:52:50 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Fri, 04 Apr 2008 13:52:50 +0100
Subject: Crossbuild patch, appropriate for wine?
In-Reply-To: <87myo9byjt.fsf@wine.dyndns.org>
References: <78a7dad00804040256q35948105gb5d52d9b975c8830@mail.gmail.com>	<47F61545.4040709@codeweavers.com>
	<87myo9byjt.fsf@wine.dyndns.org>
Message-ID: <47F624A2.6070401@codeweavers.com>

Alexandre Julliard wrote:
> Robert Shearman <rob at codeweavers.com> writes:
>   
>> Actually, I think the best place to fix this is in 
>> include/wine/exception.h. I also think it would be better to use 
>> "defined(__MINGW32__) && !defined(USE_COMPILER_EXCEPTIONS)." This is 
>> because that is the platform that can't use the exception macros 
>> implemented on top of sigsetjmp
>>     
>
> I don't think we want to disable exceptions, that will just lead to
> broken builds. It should be possible to make the sigsetjmp variant work
> for MinGW.

You can make it compile by using sigjmp instead of sigsetjmp, but 
there's not much point because the code depends on Wine-only functions 
in ntdll that aren't available on Windows and so would cause the DLLs 
not to load.

-- 
Rob Shearman



From lich at math.spbu.ru  Fri Apr  4 06:36:54 2008
From: lich at math.spbu.ru (Kirill K. Smirnov)
Date: Fri, 4 Apr 2008 14:36:54 +0300
Subject: Bug in MSVCRT_fseek (with patch)
Message-ID: <200804041536.54810.lich@math.spbu.ru>

Hi,

>  A successful call to fseek() shall clear the end-of-file indicator
>  for the stream and undo any effects of ungetc() and ungetwc() on
>  the same stream. After an fseek() call, the next operation on an
>  update stream may be either input or output.

>   }
>+  /* Clear end of file */
>+  file->_flag &= ~MSVCRT__IOEOF;
>   return (_lseek(file->_file,offset,whence) == -1)?-1:0;

What if you try to fseek to the end of file (SEEK_END)? Should IOEOF flag be 
cleared in this case? And may _lseek() function be better place for this?

Current _lseeki64() implementation contains FIXME concerning the same issue:
    MSVCRT_fdesc[fd].wxflag &= ~(WX_ATEOF|WX_READEOF);
    /* FIXME: What if we seek _to_ EOF - is EOF set? */

--
Kirill


From julliard at winehq.org  Fri Apr  4 08:13:52 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 04 Apr 2008 15:13:52 +0200
Subject: Crossbuild patch, appropriate for wine?
In-Reply-To: <47F624A2.6070401@codeweavers.com> (Robert Shearman's message of
	"Fri, 04 Apr 2008 13:52:50 +0100")
References: <78a7dad00804040256q35948105gb5d52d9b975c8830@mail.gmail.com>
	<47F61545.4040709@codeweavers.com> <87myo9byjt.fsf@wine.dyndns.org>
	<47F624A2.6070401@codeweavers.com>
Message-ID: <87iqyxbw4v.fsf@wine.dyndns.org>

Robert Shearman <rob at codeweavers.com> writes:

> Alexandre Julliard wrote:
>> I don't think we want to disable exceptions, that will just lead to
>> broken builds. It should be possible to make the sigsetjmp variant work
>> for MinGW.
>
> You can make it compile by using sigjmp instead of sigsetjmp, but
> there's not much point because the code depends on Wine-only functions
> in ntdll that aren't available on Windows and so would cause the DLLs
> not to load.

Yes, but the functions could be moved to winecrt0 or something like that
and get statically linked into the dll.

-- 
Alexandre Julliard
julliard at winehq.org


From dmitry at codeweavers.com  Fri Apr  4 08:24:33 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 4 Apr 2008 22:24:33 +0900
Subject: [PATCH] user32: on VK_RETURN, send WM_COMMAND to ancestor,
	not parent.
References: <558b2f5c0804040020w77698ed0v324e7dbae792098b@mail.gmail.com>
Message-ID: <00a901c89657$3abcc4f0$a600fea9@DMITRY>

"Lei Zhang" <thestig at google.com> wrote:

> I noticed I can no longer install an application which uses the NSIS
> installer by repeatedly hitting enter until it finished. I did some
> testing and it looks like for VK_RETURN, we should be sending
> WM_COMMAND to the ancestor, and not the parent.

Was edit control reparented at some point? Perhaps WM_COMMAND should be
sent to an original parent?

-- 
Dmitry.


From rob at codeweavers.com  Fri Apr  4 08:35:34 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Fri, 04 Apr 2008 14:35:34 +0100
Subject: Crossbuild patch, appropriate for wine?
In-Reply-To: <87iqyxbw4v.fsf@wine.dyndns.org>
References: <78a7dad00804040256q35948105gb5d52d9b975c8830@mail.gmail.com>	<47F61545.4040709@codeweavers.com>
	<87myo9byjt.fsf@wine.dyndns.org>	<47F624A2.6070401@codeweavers.com>
	<87iqyxbw4v.fsf@wine.dyndns.org>
Message-ID: <47F62EA6.4030204@codeweavers.com>

Alexandre Julliard wrote:
> Robert Shearman <rob at codeweavers.com> writes:
>   
>> Alexandre Julliard wrote:
>>     
>>> I don't think we want to disable exceptions, that will just lead to
>>> broken builds. It should be possible to make the sigsetjmp variant work
>>> for MinGW.
>>>       
>> You can make it compile by using sigjmp instead of sigsetjmp, but
>> there's not much point because the code depends on Wine-only functions
>> in ntdll that aren't available on Windows and so would cause the DLLs
>> not to load.
>>     
>
> Yes, but the functions could be moved to winecrt0 or something like that
> and get statically linked into the dll.

In the past, I tried using our implementation of 
__wine_exception_handler on Windows, but it crashes in these three lines:
>     RtlUnwind( frame, 0, record, 0 );
>     __wine_pop_frame( frame );
>     siglongjmp( wine_frame->jmp, 1 );

The reason is that RtlUnwind clears all general purpose registers (and 
maybe changes esp/ebp) so that frame is no longer valid. There may be a 
way to work around this, but I'm not sure.

-- 
Rob Shearman



From talk2cod at hotmail.com  Fri Apr  4 09:31:23 2008
From: talk2cod at hotmail.com (andre furtado)
Date: Fri, 4 Apr 2008 14:31:23 +0000
Subject: xenroll exported functions
Message-ID: <BAY109-W304CEA8B4A519C11C8A81D87F60@phx.gbl>


add documentation for exported functions of the xenroll library...
IEnroll * WINAPI PIEnrollGetNoCOM(void)*/ returns a pointer to an IEnroll interface. */IEnroll2 * WINAPI PIEnroll2GetNoCOM(void)*/ returns a pointer to an IEnroll2 interface. */IEnroll4 * WINAPI PIEnroll4GetNoCOM(void)*/ returns a pointer to an IEnroll4 interface. */
                           Andr? Renato Furtado                                              talk2cod at hotmail.com
_________________________________________________________________
Receba GR?TIS as mensagens do Messenger no seu celular quando voc? estiver offline. Conhe?a  o MSN Mobile!
http://mobile.live.com/signup/signup2.aspx?lc=pt-br
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080404/30b87c59/attachment.htm 

From thestig at google.com  Fri Apr  4 09:47:05 2008
From: thestig at google.com (Lei Zhang)
Date: Fri, 4 Apr 2008 07:47:05 -0700
Subject: [PATCH] user32: on VK_RETURN, send WM_COMMAND to ancestor,
	not parent.
In-Reply-To: <00a901c89657$3abcc4f0$a600fea9@DMITRY>
References: <558b2f5c0804040020w77698ed0v324e7dbae792098b@mail.gmail.com>
	<00a901c89657$3abcc4f0$a600fea9@DMITRY>
Message-ID: <558b2f5c0804040747s3eb841cfma07c0b6ca236e8c1@mail.gmail.com>

On Fri, Apr 4, 2008 at 6:24 AM, Dmitry Timoshkov <dmitry at codeweavers.com> wrote:
>
> "Lei Zhang" <thestig at google.com> wrote:
>
>
> > I noticed I can no longer install an application which uses the NSIS
> > installer by repeatedly hitting enter until it finished. I did some
> > testing and it looks like for VK_RETURN, we should be sending
> > WM_COMMAND to the ancestor, and not the parent.
> >
>
>  Was edit control reparented at some point? Perhaps WM_COMMAND should be
>  sent to an original parent?
>
>  --
>  Dmitry.
>

The edit control is the child of a dialog box bar, which is in turn
the child of another dialog box foo. SetParent() is not involved, if
that's what you mean.

- Lei


From stefandoesinger at gmx.at  Fri Apr  4 10:16:58 2008
From: stefandoesinger at gmx.at (Stefan =?utf-8?q?D=C3=B6singer?=)
Date: Fri, 4 Apr 2008 17:16:58 +0200
Subject: XDC 2008 wishlist
Message-ID: <200804041716.58458.stefandoesinger@gmx.at>

Hi,

My travel to XDC 2008 is finalized now, I am collecting the topics I should 
bring up there. I already have these:

*) Mouse input handling. I've CC'ed Vitaliy. All I know so far is that Vitaliy 
said opening the core pointer as XInput device would be good. Vitaliy, do you 
have any proof of concept code / test apps? Do you have time to discuss the 
details? I think this is the most important topic, and I don't know anything 
about it, so I should be well-prepared.

*) Tablet support. Dan mentioned something about it, but I have no details.

*) Graphics support: I'll talk to the X11 devs about including the wine d3d 
tests in their driver QA. Lobby for widespread support of some rare 
extensions(GL_NV_half_float) and help on adding some others, like for the 
flat shading issue. Others?

*) Discuss the opportunities we have with DRI2

Does anyone have other items?


From dmitry at codeweavers.com  Fri Apr  4 11:14:27 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sat, 5 Apr 2008 01:14:27 +0900
Subject: [PATCH] user32: on VK_RETURN, send WM_COMMAND to ancestor,
	not parent.
References: <558b2f5c0804040020w77698ed0v324e7dbae792098b@mail.gmail.com><00a901c89657$3abcc4f0$a600fea9@DMITRY>
	<558b2f5c0804040747s3eb841cfma07c0b6ca236e8c1@mail.gmail.com>
Message-ID: <018501c8966e$f65e4000$a600fea9@DMITRY>

"Lei Zhang" <thestig at google.com> wrote:

> The edit control is the child of a dialog box bar, which is in turn
> the child of another dialog box foo. SetParent() is not involved, if
> that's what you mean.

Seems that's not the case then, from your test it looks more like
a WM_COMMAND forwarding from a child dialog to the parent one.

-- 
Dmitry.


From tony.wasserka at freenet.de  Fri Apr  4 11:14:57 2008
From: tony.wasserka at freenet.de (tony.wasserka at freenet.de)
Date: Fri, 04 Apr 2008 18:14:57 +0200
Subject: Windows 7
Message-ID: <E1JhoZ7-0002Vl-HB@www19.emo.freenet-rz.de>

I read an interesting article on slashdot today:
http://tech.slashdot.org/tech/08/04/04/1437258.shtml
> Windows 7 will be a from-the-ground-up packaging of the Windows codebase; partially source,
> but not binary compatible with previous versions of Windows."

Sounds like they  format, i.e. maybe they use sth. other than PE then.
But even if they don't, I guess this could be a problem for the existing wine codebase
and require some infrastructural changes to it.
However, I don't know much about these things though and it's possible that I'm completely wrong, but
I though I'd just post this to wine-devel in case anybody is interested.
Feel free to discuss, or not to discuss, do whatever you want with this information ;-)

Maybe we're lucky and people turn away from windows completely this time and we don't even need to care
about Windows 7 xD
(though this is unlikely to happen, but dreams never die...)


Best regards,
    Tony



Unbegrenzter Speicher, Top-Spamschutz, 120 SMS und eigene E-MailDomain inkl.
http://office.freenet.de/dienste/emailoffice/produktuebersicht/power/mail/index.html



From brianmarete at gmail.com  Fri Apr  4 11:36:26 2008
From: brianmarete at gmail.com (Brian Gitonga Marete)
Date: Fri, 4 Apr 2008 19:36:26 +0300
Subject: Making Yahoo Messenger Work
Message-ID: <6dd519ae0804040936h3f66c030sbc4c678fb2dd1311@mail.gmail.com>

Hello,

I am interested in making the latest versions of Yahoo Messenger work
under Wine.

Currently, an attempt to log in results in some errors about the RAS
API, and Log in never succeeds.

If someone (after attempting a run of the application under the latest
version of Wine) could point me (even generally) to those parts of the
Windows API Wine needs to allow Yahoo Messenger to work, I would be
willing to do the work of implementing the necessary parts of the
Win32 API myself.

In this regard, I am especially interested that the Audio/Video chat
aspects of Yahoo Messenger should work under Wine.

Thanks,
-- 
B. Gitonga Marete
Tel: +254-722-151-590


From thunderbird2k at gmx.net  Fri Apr  4 11:55:03 2008
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Fri, 04 Apr 2008 18:55:03 +0200
Subject: XDC 2008 wishlist
In-Reply-To: <200804041716.58458.stefandoesinger@gmx.at>
References: <200804041716.58458.stefandoesinger@gmx.at>
Message-ID: <20080404165503.107670@gmx.net>

> Hi,
> 
> My travel to XDC 2008 is finalized now, I am collecting the topics I
> should 
> bring up there. I already have these:
> 
> *) Mouse input handling. I've CC'ed Vitaliy. All I know so far is that
> Vitaliy 
> said opening the core pointer as XInput device would be good. Vitaliy, do
> you 
> have any proof of concept code / test apps? Do you have time to discuss
> the 
> details? I think this is the most important topic, and I don't know
> anything 
> about it, so I should be well-prepared.
> 
> *) Tablet support. Dan mentioned something about it, but I have no
> details.
> 
> *) Graphics support: I'll talk to the X11 devs about including the wine
> d3d 
> tests in their driver QA. Lobby for widespread support of some rare 
> extensions(GL_NV_half_float) and help on adding some others, like for the 
> flat shading issue. Others?
> 
> *) Discuss the opportunities we have with DRI2
> 
> Does anyone have other items?
> 

Most xorg devs aren't a big fan of pbuffers but they are part of the GLX 1.3 spec which drivers want to support these days. Some drivers are considering to just fail on pbuffer creation. Encourage them to offer pbuffer support on some visuals/fbconfigs. A lot of windows apps rely on their presence including Wow in opengl32 mode and lots of other (older) programs.

Roderick
-- 
Psst! Geheimtipp: Online Games kostenlos spielen bei den GMX Free Games! 
http://games.entertainment.gmx.net/de/entertainment/games/free


From dank at kegel.com  Fri Apr  4 12:32:35 2008
From: dank at kegel.com (Dan Kegel)
Date: Fri, 4 Apr 2008 10:32:35 -0700
Subject: XDC 2008 wishlist
Message-ID: <a71bd89a0804041032r65e6bcd3w4d9b61b566c10364@mail.gmail.com>

On tablet support:

1) users should never, ever have to edit xorg.conf, but
this is still needed when adding some graphics tablets.

2) users should never, ever have to compile their own
drivers, but this is still required when using some graphics
tablets.   See e.g.
https://help.ubuntu.com/community/TabletSetupWizardpen

This is something that Photoshop-on-Wine users are
actually running into.  I don't know how common it is, but
if I've already heard about it once, it's probably not rare.
- Dan


From dank at kegel.com  Fri Apr  4 12:47:40 2008
From: dank at kegel.com (Dan Kegel)
Date: Fri, 4 Apr 2008 10:47:40 -0700
Subject: Lots of valgrind errors in gdi32/tests/font.c
Message-ID: <a71bd89a0804041047p3aad3c03m1e508c4e8d617d4@mail.gmail.com>

Today's valgrind run shows a bunch more valgrind warnings in gdi32/tests/font.c:
http://kegel.com/wine/valgrind/logs-2008-04-04/vg-gdi32_font-diff.txt
e.g.

+ Use of uninitialised value of size 4
+    at  HEAP_CreateFreeBlock (heap.c:502)
+    by  HEAP_MakeInUseBlockFree (heap.c:538)
+    by  RtlFreeHeap (heap.c:1294)
+    by  GDI_FreeObject (gdiobj.c:731)
+    by  FONT_DeleteObject (font.c:554)
+    by  DeleteObject (gdiobj.c:854)
+    by  enum_truetype_font_proc (font.c:1602)
+    by  FONT_EnumInstance (font.c:589)
+    by  WineEngEnumFonts (freetype.c:3761)
+    by  FONT_EnumFontFamiliesEx (font.c:626)
+    by  EnumFontFamiliesExA (font.c:664)
+    by  func_font (font.c:1744)
+    by  run_test (test.h:406)
+    by  main (test.h:455)
...
+ Conditional jump or move depends on uninitialised value(s)
+    at  RtlAllocateHeap (heap.c:1204)
+    by  WineEngGetOutlineTextMetrics (freetype.c:4831)
+    by  WineEngGetTextMetrics (freetype.c:4720)
+    by  GetTextMetricsW (font.c:1158)
+    by  X11DRV_XRender_SelectFont (xrender.c:433)
+    by  X11DRV_SelectFont (xfont.c:3216)
+    by  FONT_SelectObject (font.c:497)
+    by  SelectObject (gdiobj.c:1129)
+    by  enum_truetype_font_proc (font.c:1579)
+    by  FONT_EnumInstance (font.c:589)
+    by  WineEngEnumFonts (freetype.c:3761)
+    by  FONT_EnumFontFamiliesEx (font.c:626)
+    by  EnumFontFamiliesExA (font.c:664)
+    by  func_font (font.c:1744)
+    by  run_test (test.h:406)
+    by  main (test.h:455)

I don't think these are actually new; errors like them have
been around, they just got triggered more with a new test
that was added.   It always worries me when heap
routines start showing up in valgrind dumps, though;
it'd be nice if somebody could take a look at this.
- Dan


From thestig at google.com  Fri Apr  4 12:50:35 2008
From: thestig at google.com (Lei Zhang)
Date: Fri, 4 Apr 2008 10:50:35 -0700
Subject: Documentation is still in CVS?
In-Reply-To: <658075.98811.qm@web23105.mail.ird.yahoo.com>
References: <558b2f5c0804031514u3f093c85u3ed8ca9a5ecfe5ac@mail.gmail.com>
	<658075.98811.qm@web23105.mail.ird.yahoo.com>
Message-ID: <558b2f5c0804041050n26a669b4ude698d41db65e31c@mail.gmail.com>

On Fri, Apr 4, 2008 at 8:35 AM, Hin-Tak Leung <hintak_leung at yahoo.co.uk> wrote:
>  Doesn't work for me:
>
>  $ cvs -z3 -d:pserver:anonymous at wine.cvs.sourceforge.net:/cvsroot/wine co -P docs
>  cvs [checkout aborted]: connect to [wine.cvs.sourceforge.net]:2401 failed: Connection timed out
>
>  $ git cvsimport -C wine-doc -v -k -d :pserver:anonymous at wine.cvs.sourceforge.net:/cvsroot/wine docs
>  Socket to wine.cvs.sourceforge.net: Connection timed out
>
>  I'll need to try stunnel and see if it improves things. (but I can still check out stuff from other sourceforge projects...)
>

Firewall issue on your side? Can you ping wine.cvs.sourceforge.net?
Connect to it on port 80? or port 2401?


From talk2cod at hotmail.com  Fri Apr  4 12:50:55 2008
From: talk2cod at hotmail.com (andre furtado)
Date: Fri, 4 Apr 2008 17:50:55 +0000
Subject: softpub exported functions prototypes
Message-ID: <BAY109-W528BB638B6A34A628701B787F60@phx.gbl>


add softpub exported functions prototypes... HRESULT  WINAPI GenericChainCertificateTrust(IN OUT PCRYPT_PROVIDER_DATA pProvData)HRESULT WINAPI GenericChainFinalProv(IN OUT PCRYPT_PROVIDER_DATA pProvData)HRESULT WINAPI HTTPSCertificateTrust(CRYPT_PROVIDER_DATA *pProvData)HRESULT WINAPI SoftpubDefCertInit(CRYPT_PROVIDER_DATA *pProvData)BOOL WINAPI SoftpubFreeDefUsageCallData(const char *pszUsageOID, CRYPT_PROVIDER_DEFUSAGE *psDefUsage)BOOL WINAPI SoftpubLoadDefUsageCallData(const char *pszUsageOID, CRYPT_PROVIDER_DEFUSAGE *psDefUsage)BOOL CALLBACK AddPersonalTrustDBPages(LPVOID lpv, LPFNADDPROPSHEETPAGE lpfnAddPage, LPARAM lParam) HRESULT WINAPI DriverCleanupPolicy(CRYPT_PROVIDER_DATA *pProvData)HRESULT WINAPI DriverFinalPolicy(CRYPT_PROVIDER_DATA *pProvData)HRESULT WINAPI DriverInitializePolicy(CRYPT_PROVIDER_DATA *pProvData)HRESULT WINAPI HTTPSFinalProv(CRYPT_PROVIDER_DATA *pProvData)HRESULT WINAPI OfficeCleanupPolicy(CRYPT_PROVIDER_DATA *pProvData)HRESULT WINAPI OfficeInitializePolicy(CRYPT_PROVIDER_DATA *pProvData)BOOL WINAPI OpenPersonalTrustDBDialog(HWND hWnd)HRESULT WINAPI OfficeInitializePolicy(CRYPT_PROVIDER_DATA *pProvData)HRESULT WINAPI SoftpubAuthenticode(CRYPT_PROVIDER_DATA *pProvData)BOOL WINAPI SoftpubCheckCert(CRYPT_PROVIDER_DATA *pProvData, DWORD idxSigner, BOOL fCounterSignerChain, DWORD idxCounterSigner)HRESULT WINAPI SoftpubCleanup(CRYPT_PROVIDER_DATA *pProvData)HRESULT WINAPI SoftpubDumpStructure(CRYPT_PROVIDER_DATA *pProvData)HRESULT WINAPI SoftpubInitialize(CRYPT_PROVIDER_DATA *pProvData)HRESULT WINAPI SoftpubLoadMessage(CRYPT_PROVIDER_DATA *pProvData)HRESULT SoftpubLoadSignature(CRYPT_PROVIDER_DATA *pProvData)HRESULT WINAPI FindCertsByIssuer(OUT PCERT_CHAIN pCertChains, IN OUT DWORD *pcbCertChains, OUT DWORD *pcCertChains, IN BYTE* pbEncodedIssuerName, IN DWORD cbEncodedIssuerName, IN LPCWSTR pwszPurpose, IN DWORD dwKeySpec)     Andr? Renato Furtado       talk2cod at hotmail.com
_________________________________________________________________
Conhe?a o Windows Live Spaces, a rede de relacionamentos do Messenger!
http://www.amigosdomessenger.com.br/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080404/8d107b0c/attachment.htm 

From thestig at google.com  Fri Apr  4 13:11:15 2008
From: thestig at google.com (Lei Zhang)
Date: Fri, 4 Apr 2008 11:11:15 -0700
Subject: [PATCH] user32: on VK_RETURN, send WM_COMMAND to ancestor,
	not parent.
In-Reply-To: <018501c8966e$f65e4000$a600fea9@DMITRY>
References: <558b2f5c0804040020w77698ed0v324e7dbae792098b@mail.gmail.com>
	<00a901c89657$3abcc4f0$a600fea9@DMITRY>
	<558b2f5c0804040747s3eb841cfma07c0b6ca236e8c1@mail.gmail.com>
	<018501c8966e$f65e4000$a600fea9@DMITRY>
Message-ID: <558b2f5c0804041111v2daf31e4sbbf874e4424c1be4@mail.gmail.com>

On Fri, Apr 4, 2008 at 9:14 AM, Dmitry Timoshkov <dmitry at codeweavers.com> wrote:
> "Lei Zhang" <thestig at google.com> wrote:
>
>
> > The edit control is the child of a dialog box bar, which is in turn
> > the child of another dialog box foo. SetParent() is not involved, if
> > that's what you mean.
> >
>
>  Seems that's not the case then, from your test it looks more like
>  a WM_COMMAND forwarding from a child dialog to the parent one.
>
>  --
>  Dmitry.
>

I'm pretty sure the parent dialog is getting the WM_COMMAND directly.
It is not the case where the child dialog gets a WM_COMMAND, and
forwards it to its parent.

Running the test on Windows, the child dialog gets two WM_COMMANDS -
EN_SETFOCUS and EN_KILLFOCUS. Then the parent dialog gets WM_COMMAND
with IDOK.

- Lei


From wine-devel at kievinfo.com  Fri Apr  4 13:16:12 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Fri, 04 Apr 2008 12:16:12 -0600
Subject: XDC 2008 wishlist
In-Reply-To: <20080404165503.107670@gmx.net>
References: <200804041716.58458.stefandoesinger@gmx.at>
	<20080404165503.107670@gmx.net>
Message-ID: <47F6706C.3070205@kievinfo.com>

Roderick Colenbrander wrote:
>> Hi,
>>
>> My travel to XDC 2008 is finalized now, I am collecting the topics I
>> should 
>> bring up there. I already have these:
>>
>> *) Mouse input handling. I've CC'ed Vitaliy. All I know so far is that
>> Vitaliy 
>> said opening the core pointer as XInput device would be good. Vitaliy, do
>> you 
>> have any proof of concept code / test apps? Do you have time to discuss
>> the 
>> details? I think this is the most important topic, and I don't know
>> anything 
>> about it, so I should be well-prepared.

I don't have any code for this unfortunately.

What Wine needs is the physical mouse movement events, that work even when 
pointer itself "stuck" on the window/screen border. This should also work 
for the entire desktop not just one window. Absolute/relative events - 
doesn't matter, it's easy to convert from one to another.

In short - in the current xorg code there are checks to explicitly prohibit 
opening of the primary pointer and keyboard device as XInput device.

There is some capturing extension don't remember the name of it. It requires 
two server connections and works for the specified window only. This won't 
work for us.

Vitaliy.


From wine-devel at kievinfo.com  Fri Apr  4 13:19:46 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Fri, 04 Apr 2008 12:19:46 -0600
Subject: xenroll exported functions
In-Reply-To: <BAY109-W328625DAF59377E89A08C187F60@phx.gbl>
References: <BAY109-W328625DAF59377E89A08C187F60@phx.gbl>
Message-ID: <47F67142.9030409@kievinfo.com>

andre furtado wrote:
> add documentation for exported functions of the xenroll library...
> IEnroll * WINAPI PIEnrollGetNoCOM(void)
> */ returns a pointer to an IEnroll interface. */
> IEnroll2 * WINAPI PIEnroll2GetNoCOM(void)
> */ returns a pointer to an IEnroll2 interface. */
> IEnroll4 * WINAPI PIEnroll4GetNoCOM(void)
> */ returns a pointer to an IEnroll4 interface. */
>                            Andr? Renato Furtado
>                                               talk2cod at hotmail.com 
> <mailto:talk2cod at hotmail.com>
> 
> ------------------------------------------------------------------------
> Instale a Barra de Ferramentas com Desktop Search e ganhe EMOTICONS para 
> o Messenger! ? GR?TIS! <http://www.msn.com.br/emoticonpack>
> 
> 
> ------------------------------------------------------------------------
> 
> 
This does not look like a patch to me. Generate something that can be used 
with program 'patch'. For best results use git and 'git format-patch' as 
described in the wiki page you were pointed to in another reply.

Vitaliy.


From truiken at gmail.com  Fri Apr  4 13:56:59 2008
From: truiken at gmail.com (James Hawkins)
Date: Fri, 4 Apr 2008 13:56:59 -0500
Subject: fusion: Test and implement CreateAssemblyNameObject
In-Reply-To: <22821af30804041058x39344346m3a19d631b2417ac5@mail.gmail.com>
References: <22821af30804041058x39344346m3a19d631b2417ac5@mail.gmail.com>
Message-ID: <22821af30804041156r4a741e10g6fba3377707dd0e@mail.gmail.com>

2008/4/4 James Hawkins <jhawkins at codeweavers.com>:
> Hi,
>
>  Changelog:
>  * Test and implement CreateAssemblyNameObject.
>

Please ignore this patch.

-- 
James Hawkins


From thestig at google.com  Fri Apr  4 14:11:41 2008
From: thestig at google.com (Lei Zhang)
Date: Fri, 4 Apr 2008 12:11:41 -0700
Subject: softpub exported functions prototypes
In-Reply-To: <BAY109-W528BB638B6A34A628701B787F60@phx.gbl>
References: <BAY109-W528BB638B6A34A628701B787F60@phx.gbl>
Message-ID: <558b2f5c0804041211x188fffddm3f0afe4365da6043@mail.gmail.com>

On Fri, Apr 4, 2008 at 10:50 AM, andre furtado <talk2cod at hotmail.com> wrote:
>
>
>  add softpub exported functions prototypes...
>
> HRESULT  WINAPI GenericChainCertificateTrust(IN OUT PCRYPT_PROVIDER_DATA
> pProvData)
> HRESULT WINAPI GenericChainFinalProv(IN OUT PCRYPT_PROVIDER_DATA pProvData)
> HRESULT WINAPI HTTPSCertificateTrust(CRYPT_PROVIDER_DATA *pProvData)
> HRESULT WINAPI SoftpubDefCertInit(CRYPT_PROVIDER_DATA *pProvData)
> BOOL WINAPI SoftpubFreeDefUsageCallData(const char *pszUsageOID,
> CRYPT_PROVIDER_DEFUSAGE *psDefUsage)
> BOOL WINAPI SoftpubLoadDefUsageCallData(const char *pszUsageOID,
> CRYPT_PROVIDER_DEFUSAGE *psDefUsage)
> BOOL CALLBACK AddPersonalTrustDBPages(LPVOID lpv, LPFNADDPROPSHEETPAGE
> lpfnAddPage, LPARAM lParam)
> HRESULT WINAPI DriverCleanupPolicy(CRYPT_PROVIDER_DATA *pProvData)
> HRESULT WINAPI DriverFinalPolicy(CRYPT_PROVIDER_DATA *pProvData)
> HRESULT WINAPI DriverInitializePolicy(CRYPT_PROVIDER_DATA *pProvData)
> HRESULT WINAPI HTTPSFinalProv(CRYPT_PROVIDER_DATA *pProvData)
> HRESULT WINAPI OfficeCleanupPolicy(CRYPT_PROVIDER_DATA *pProvData)
> HRESULT WINAPI OfficeInitializePolicy(CRYPT_PROVIDER_DATA *pProvData)
> BOOL WINAPI OpenPersonalTrustDBDialog(HWND hWnd)
> HRESULT WINAPI OfficeInitializePolicy(CRYPT_PROVIDER_DATA *pProvData)
> HRESULT WINAPI SoftpubAuthenticode(CRYPT_PROVIDER_DATA *pProvData)
> BOOL WINAPI SoftpubCheckCert(CRYPT_PROVIDER_DATA *pProvData, DWORD
> idxSigner,
> BOOL fCounterSignerChain, DWORD idxCounterSigner)
> HRESULT WINAPI SoftpubCleanup(CRYPT_PROVIDER_DATA *pProvData)
> HRESULT WINAPI SoftpubDumpStructure(CRYPT_PROVIDER_DATA *pProvData)
> HRESULT WINAPI SoftpubInitialize(CRYPT_PROVIDER_DATA *pProvData)
> HRESULT WINAPI SoftpubLoadMessage(CRYPT_PROVIDER_DATA *pProvData)
> HRESULT SoftpubLoadSignature(CRYPT_PROVIDER_DATA *pProvData)
> HRESULT WINAPI FindCertsByIssuer(OUT PCERT_CHAIN pCertChains, IN OUT DWORD
> *pcbCertChains, OUT DWORD *pcCertChains, IN BYTE* pbEncodedIssuerName, IN
> DWORD
> cbEncodedIssuerName, IN LPCWSTR pwszPurpose, IN DWORD dwKeySpec)
>
>     Andr? Renato Furtado
>        talk2cod at hotmail.com
>
> ________________________________
> Conhe?a j? o Windows Live Spaces, o site de relacionamentos do Messenger!
> Crie j? o seu!
>
>
>

- Stop, you're not doing it correctly. Please read:

http://www.winehq.org/site/sending_patches

- What you're sending is not a patch. Here is what a patch looks like:

http://www.winehq.org/pipermail/wine-patches/attachments/20080402/f22a7fe4/attachment.txt

- Please stop sending the same email to wine-patches and wine-devel.
Patches go only to wine-patches.


From hintak_leung at yahoo.co.uk  Fri Apr  4 10:35:20 2008
From: hintak_leung at yahoo.co.uk (Hin-Tak Leung)
Date: Fri, 4 Apr 2008 15:35:20 +0000 (GMT)
Subject: Documentation is still in CVS?
In-Reply-To: <558b2f5c0804031514u3f093c85u3ed8ca9a5ecfe5ac@mail.gmail.com>
Message-ID: <658075.98811.qm@web23105.mail.ird.yahoo.com>

--- On Thu, 3/4/08, Lei Zhang <thestig at google.com> wrote:

<snipped>
> The instructions on http://www.winehq.org/site/cvs works
> for me.

Doesn't work for me:

$ cvs -z3 -d:pserver:anonymous at wine.cvs.sourceforge.net:/cvsroot/wine co -P docs
cvs [checkout aborted]: connect to [wine.cvs.sourceforge.net]:2401 failed: Connection timed out

$ git cvsimport -C wine-doc -v -k -d :pserver:anonymous at wine.cvs.sourceforge.net:/cvsroot/wine docs 
Socket to wine.cvs.sourceforge.net: Connection timed out

I'll need to try stunnel and see if it improves things. (but I can still check out stuff from other sourceforge projects...)


      ___________________________________________________________ 
Yahoo! For Good helps you make a difference  

http://uk.promotions.yahoo.com/forgood/


From hintak_leung at yahoo.co.uk  Fri Apr  4 11:04:38 2008
From: hintak_leung at yahoo.co.uk (Hin-Tak Leung)
Date: Fri, 4 Apr 2008 16:04:38 +0000 (GMT)
Subject: wget usage in winetricks 
In-Reply-To: <a71bd89a0804021431w79515034i84ff0e4c57af3353@mail.gmail.com>
Message-ID: <89592.13651.qm@web23103.mail.ird.yahoo.com>

I'll say upfront that, *thank you* for wine tricks!

Recently I encounted an interesting issue - I have a .wgetrc which sets always construct directory, and always time stamps, etc. It is equivalent to the command line option:
"-x,  --force-directories        force creation of directories" - while it is my personal preference to always know where I have downloaded stuff from, the usage of wget in winestricks probably should explicitly specify 
"-nd, --no-directories           don't create directories" and maybe other options
to make sure that wget is downloading stuff to where you want it to. 

I thought of unsetting WGETRC, or setting WGETRC to some unknown place so that user/site-admin preferences are not loaded, but that's dangerous, because proxies, etc
are also set in wgetrc and if winetricks unset wgetrc, connectivity can break. So explicitly do -nd or even -O seems more sensible...





      ___________________________________________________________ 
Yahoo! For Good helps you make a difference  

http://uk.promotions.yahoo.com/forgood/


From hintak_leung at yahoo.co.uk  Fri Apr  4 12:55:20 2008
From: hintak_leung at yahoo.co.uk (Hin-Tak Leung)
Date: Fri, 4 Apr 2008 17:55:20 +0000 (GMT)
Subject: Documentation is still in CVS?
In-Reply-To: <558b2f5c0804041050n26a669b4ude698d41db65e31c@mail.gmail.com>
Message-ID: <134335.55841.qm@web23107.mail.ird.yahoo.com>

--- On Fri, 4/4/08, Lei Zhang <thestig at google.com> wrote:

> From: Lei Zhang <thestig at google.com>
> Subject: Re: Documentation is still in CVS?
> To: "Hin-Tak Leung" <hintak_leung at yahoo.co.uk>
> Cc: "Wine Devel" <wine-devel at winehq.org>
> Date: Friday, 4 April, 2008, 6:50 PM
> On Fri, Apr 4, 2008 at 8:35 AM, Hin-Tak Leung
> <hintak_leung at yahoo.co.uk> wrote:
> >  Doesn't work for me:
> >
> >  $ cvs -z3
> -d:pserver:anonymous at wine.cvs.sourceforge.net:/cvsroot/wine
> co -P docs
> >  cvs [checkout aborted]: connect to
> [wine.cvs.sourceforge.net]:2401 failed: Connection timed
> out
> >
> >  $ git cvsimport -C wine-doc -v -k -d
> :pserver:anonymous at wine.cvs.sourceforge.net:/cvsroot/wine
> docs
> >  Socket to wine.cvs.sourceforge.net: Connection timed
> out
> >
> >  I'll need to try stunnel and see if it improves
> things. (but I can still check out stuff from other
> sourceforge projects...)
> >
> 
> Firewall issue on your side? Can you ping
> wine.cvs.sourceforge.net?
> Connect to it on port 80? or port 2401?

Can do port 80, can't do port 2401. Wierd. It is probably problem in my end.



      ___________________________________________________________ 
Yahoo! For Good helps you make a difference  

http://uk.promotions.yahoo.com/forgood/


From hintak_leung at yahoo.co.uk  Fri Apr  4 13:34:30 2008
From: hintak_leung at yahoo.co.uk (Hin-Tak Leung)
Date: Fri, 4 Apr 2008 18:34:30 +0000 (GMT)
Subject: wine based win32 printer drivers
In-Reply-To: <1206918736.7820.140.camel@p4>
Message-ID: <511483.3837.qm@web23102.mail.ird.yahoo.com>

I am looking at ddiwrapper lately and having a lot of fun with it. Is Marcel's on-going 
not-merged work anywhere on line that I can have a peek before its merge into wine?

Hin-Tak

--- On Mon, 31/3/08, Detlef Riekenberg <wine.dev at web.de> wrote:

> From: Detlef Riekenberg <wine.dev at web.de>
> Subject: wine based win32 printer drivers
> To: "Marcel Partap" <mpartap at gmx.net>
> Cc: wine-devel at winehq.org
> Date: Monday, 31 March, 2008, 12:12 AM
> On So, 2008-03-30 at 06:03 +0200, Marcel Partap wrote:
> > Anyways, I am working on getting something merged.. 
> 
> Great!
> 
> > For now the target is to get the Adobe pscript5 driver
> working which
> > has its own raster renderer and thus does not depend
> on the dib
> > engine. 
> A Postscript Driver has no raster renderer...
> A Postscript Driver has a Postscript Engine.
> 
> > Just started by making AddPrinter correctly get 
> > a default devmode out of the driver, patch is
> attached, 
> 
> > DRIVER_EVENT_INITIALIZE, 3,
> "3" is wrong here. See:
> myAddPrinterDriverEx(DWORD level, ...
> 
> Since there are much more Events, we need the DriverUI in
> more Places
> later. I suggest a simple struct, which can be extended
> later
> (The struct must include the Results from GetProcAddress)
> 
> 
> The changes for winspool.drv must go in a seperate Patch.
> WINSPOOL_CallDrvDocumentProperties is the wrong name, when
> you 
> call DrvDocumentPropertySheets.
> 
> You should collect all API in winspool.drv, that need the
> driverui
> (some are not implemented) and design a simple struct
> with helper functions (Use monitor_t as example).
> Not all Drivers Export DrvDocumentPropertySheets.
> You must prepare to use a Fallback to get the default
> devmode
> (DrvConvertDevMode)
> See winspool.drv/monitor_load as Example:
> - InitializePrintMonitor2 is suggested my MSDN, but not
> needed yet
> - InitializePrintMonitor implemented
> - InitializeMonitorEx and InitializeMonitor as Fallback.
> 
> The current Code is a crosscall from DocumentPropertiesW to
> DocumentPropertiesA.
> The DDI-API is unicode and should be the prefered way.
> When wineps.drv is updated, the old code with the crosscall
> can be
> removed, since we do not support ANSI Drivers (Windows 9x).
> 
> You can even use the same struct and helper functions 
> in localspl.dll and winspool.drv
> 
> 
> -- 
>  
> By by ... Detlef


      ___________________________________________________________ 
Yahoo! For Good helps you make a difference  

http://uk.promotions.yahoo.com/forgood/


From mle+win at mega-nerd.com  Fri Apr  4 17:23:10 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Sat, 5 Apr 2008 09:23:10 +1100
Subject: Bug in MSVCRT_fseek (with patch)
In-Reply-To: <a71bd89a0804040406r610fe4d6q25e217b9a456505@mail.gmail.com>
References: <a71bd89a0804040406r610fe4d6q25e217b9a456505@mail.gmail.com>
Message-ID: <20080405092310.5cc2fe78.mle+win@mega-nerd.com>

Dan Kegel wrote:

> To get your change and test accepted, please send a patch,
> and make the test a real wine conformance test.

I found a test in dlls/msvcrt/tests/file.c that seems to have been
mad inactive by use of a "todo_wine". Activating the test without
my patch results in two failures:

    file.c:244: Test failed: feof failure in binary mode
    file.c:244: Test failed: feof failure in ascii mode

Rerunning the test after my patch an these two failures disappeared.

Below is my new patch, which activates the test and fixes the bug.

Cheers,
Erik

-------------8<-------------8<-------------8<-------------8<-------------
diff --git a/dlls/msvcrt/file.c b/dlls/msvcrt/file.c
index 0c1e84b..866d28d 100644
--- a/dlls/msvcrt/file.c
+++ b/dlls/msvcrt/file.c
@@ -918,6 +918,8 @@ int CDECL MSVCRT_fseek(MSVCRT_FILE* file, long offset, int whence)
   if(file->_flag & MSVCRT__IORW) {
         file->_flag &= ~(MSVCRT__IOREAD|MSVCRT__IOWRT);
   }
+  /* Clear end of file flag */
+  file->_flag &= ~MSVCRT__IOEOF;
   return (_lseek(file->_file,offset,whence) == -1)?-1:0;
 }
 
diff --git a/dlls/msvcrt/tests/file.c b/dlls/msvcrt/tests/file.c
index d406ae5..aa58a32 100644
--- a/dlls/msvcrt/tests/file.c
+++ b/dlls/msvcrt/tests/file.c
@@ -241,7 +241,7 @@ static void test_readmode( BOOL ascii_mode )
     ok(fread(buffer,1,1,file)==0,"fread failure in %s\n", IOMODE);
     ok(feof(file)!=0,"feof failure in %s\n", IOMODE);
     ok(fseek(file,-3,SEEK_CUR)==0,"seek failure in %s\n", IOMODE);
-    todo_wine ok(feof(file)==0,"feof failure in %s\n", IOMODE);
+    ok(feof(file)==0,"feof failure in %s\n", IOMODE);
     ok(fread(buffer,2,1,file)==1,"fread failed in %s\n", IOMODE);
     ok(feof(file)==0,"feof failure in %s\n", IOMODE);
     ok(fread(buffer,2,1,file)==0,"fread failure in %s\n",IOMODE);

-------------8<-------------8<-------------8<-------------8<-------------


-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
Only people who suck have a problem with elitism.


From dank at kegel.com  Fri Apr  4 18:39:30 2008
From: dank at kegel.com (Dan Kegel)
Date: Fri, 4 Apr 2008 16:39:30 -0700
Subject: Wine 1.0 status: 70 days to release,
	68 bugs to fix. 28 days to code freeze!
Message-ID: <a71bd89a0804041639r75e8d888qc61669caf6756cb6@mail.gmail.com>

Here are the 1.0 bug list changes since April 1:

Fixed (by Stefan D. and Lei):
5955   directx-        8       DirectDrawCreate crash on non-OpenGL desktop

New (by A.F. and Austin):
11420  advapi32        0       service control manager API problem:
name of named objects might differ (client vs. service process)

Deferred:
82    	document  	2  	Stabilize Winelib User Guide Table of Contents

We really shouldn't be adding any more 1.0 bugs at this point, but
the new one is well-analyzed, and is said to affect Visual Studio, 3dsmax,
and the copy protection scheme used by Autocad 2000, so what the heck.
That's probably the last of its ilk, though.

We're going to get a lot more cruel about deferring bugs
as we get closer to release.  For instance, issue 82.
Winelib is kind of a secondary issue... not a whole lot of
people should be using it, so it's probably ok to defer.
And 'probably ok' is getting to be a good enough reason.

Here's the full list of the 68 remaining bugs:

11420     advapi32  0         service control manager API problem:
name of named objects might differ
556       build-en  1         Reconcile the Windows and Wine spec files
1114      comctl32  3         Winrar2.90/3.00: Comboex doesn't trigger
a event when you mouse-click in
2493      comctl32  2         Multi-select listview: Shift-arrow up
only selects top two items
4372      comctl32  1         listview: cannot drag several items
11509     crypt32   0         Wordviewer 2003 is unable to open
documents encrypted with AES
11681     directx-  15        Add support for video overlay
5535      directx-  16        Planescape:Torment doesn't work
9030      directx-  0         army men hangs on black screen
3270      gdi32     15        Problem with minimized top-level windows
6519      gdi32     7         Wine blacks out rotated font bitmap
7571      gdi32     1         Accented character glyphs are mixed up
with TrueType fonts (affects e.g. Lotus Notes R5)
9771      gdi32     38        Steam Friends doesn't work (fails to
render correctly or refresh)
5024      kernel32  4         Thief: Deadly Shadows crashes:page fault
on read access to 0x0000040c
5351      kernel32  9         Windows Installer 3.1 cannot install
because of non-standard drive labeling
5541      kernel32  0         WriteConsole can't write to stdout;
affects e.g. wsh's cscript's usage message
9039      kernel32  0         GS-Auftrag Professional SQL aborts on startup
9484      kernel32  19        Program refuses to run because of
ProtectCD/ProtectDISC copy-protection
7098      mscoree   1         RufzXP crashes on startup, needs
mscoree.dll.CorBindToRuntimeEx
5163      msi       12        Office XP 2002 crashes on installation
8783      ntdll     13        USB serial ports do not work
9356      ntdll     7         Serial communication not working since wine-0.9.33
2539      ole       3         XDND (Drag and drop for X Windows)
doesn't copy text
6607      ole       10        Drag and Drop not working
8095      ole       0         PQ Teaching toy crashes
9942      ole       2         Powerpoint Viewer 2007 crashes opening .pptx files
5926      programs  1         Wine does not provide an implementation
of winhlp32.exe
6254      richedit  4         Installer infinite loop from rich text error
3546      shdocvw   2         CLSID_InternetShortcut not available...
6095      shdocvw   12        MOTD in counter-strike 1.6 and
counter-strike source does not render
8898      shdocvw   0         Run Time Error "445": Object doesn't
support this action in Europa Knowledgebase
9304      shdocvw   4         Temple of Elemental Evil demo doesn't
start - gui irresponsive
8439      shell32   8         Visual Studio .NET (7) install fails
9809      shell32   4         Autodesk Revit Architecture 2008 install fails
11742     shlwapi   8         Small .net 1.1 app (FastMD5 1.3) fails to start up
12074     testcase  2         The conformance tests fail on Windows
6604      tools     2         Ship icons for the wine-tools that can
be used in .desktop files
5055      -unknown  5         Deleting files from a window in wine
doesn't send them to the Trash
5061      -unknown  6         Copying from Windows Firefox in Wine and
pasting to Linux OpenOffice pastes metadata
5402      -unknown  0         Trying to run PhotoStitch 3.1
5844      -unknown  12        tray minimize
5948      -unknown  1         Star Trek: Armada does not install
7404      -unknown  3         ShowWindow(SW_MINIMIZE) should not
generate a WM_PAINT message
7477      -unknown  1         Uplink demo crashes
8125      -unknown  0         Marratech 6.1 crashes on start
9178      -unknown  7         "hello world" dos program hangs
9916      -unknown  6         "make test" usually fails
9959      -unknown  8         Make wine updates work even if the
registry changed
10147     -unknown  1         Word Viewer 2003 - Tab behavior differs
from Windows
10815     -unknown  2         Cannot drag images into Adobe Photoshop
7 from the web / desktop
11281     -unknown  3         CJK input many issues
12097     -unknown  3         Wine 1.0 should not ship out-of-sync
resource translations
12246     -unknown  2         "make test" gives different results with
and without warn+heap
664       user32    6         The help menu functionality inside
programs is broken (messaging problem)
3023      user32    5         Orcad - "Place Part" never tries to put
down a part
4523      user32    5         Can't copy from Firefox 1.5 and paste
into OpenOffice 2 under Wine
124       wineserv  2         Review of Wine Server Protocol
1990      winex11.  1         modifier keys not released when switching desktop
2368      winex11.  7         Wine loses its X-Window when switching
to another virt. desktop in Fvwm
3297      winex11.  12        UpdateWindow() doesn't call XFlush()
5623      winex11.  4         GetAsyncKeyState wrong if querying
process doesn't have focus
5828      winex11.  24        Command and Conquer Generals (Zero Hour)
doesn't change the mouse cursor
7372      winex11.  12        can't copy and paste between gnome apps
eg openoffice or gimp and wine apps
10984     winex11.  5         sun jre 5 update 10 installer hangs in 0.9.52
11019     winex11.  3         matlab r14 and r16 (7.0.4 and 7.3.0) and
WriteItNow3.1.0s hang if X in 24bpp mode
5625      wininet   4         Wine does not handle internet proxy
settings conveniently
9787      winsock   47        Warcraft3 Battle.net Doesn't work (Needs AcceptEx)
12005     wintab32  1         Regression in pressure sensitivity with
wizardpen tablet driver and Photoshop 7


From austinenglish at gmail.com  Fri Apr  4 19:35:55 2008
From: austinenglish at gmail.com (Austin English)
Date: Fri, 4 Apr 2008 19:35:55 -0500
Subject: Wine 1.0 status: 70 days to release,
	68 bugs to fix. 28 days to code freeze!
In-Reply-To: <a71bd89a0804041639r75e8d888qc61669caf6756cb6@mail.gmail.com>
References: <a71bd89a0804041639r75e8d888qc61669caf6756cb6@mail.gmail.com>
Message-ID: <b6bb06270804041735o7a03b7ffu667494c7b42bdd84@mail.gmail.com>

On 4/4/08, Dan Kegel <dank at kegel.com> wrote:
>  New (by A.F. and Austin):
>  11420  advapi32        0       service control manager API problem:
>  name of named objects might differ (client vs. service process)
I  didn't add that one, I think you mean:
4372      comctl32  1         listview: cannot drag several items
Which I did add. Even though adding bugs at this point is obviously a
bad idea, if something as basic (and somewhat easy to fix) as dragging
multiple items doesn't work, it will reflect poorly on the project.
Things as basic as that should 'just work'.


From dank at kegel.com  Fri Apr  4 20:08:14 2008
From: dank at kegel.com (Dan Kegel)
Date: Fri, 4 Apr 2008 18:08:14 -0700
Subject: Wine 1.0 status: 70 days to release,
	68 bugs to fix. 28 days to code freeze!
In-Reply-To: <b6bb06270804041735o7a03b7ffu667494c7b42bdd84@mail.gmail.com>
References: <a71bd89a0804041639r75e8d888qc61669caf6756cb6@mail.gmail.com>
	<b6bb06270804041735o7a03b7ffu667494c7b42bdd84@mail.gmail.com>
Message-ID: <a71bd89a0804041808y264460e3r4d1ff6ea752f34c7@mail.gmail.com>

On Fri, Apr 4, 2008 at 5:35 PM, Austin English <austinenglish at gmail.com> wrote:
> On 4/4/08, Dan Kegel <dank at kegel.com> wrote:
>  >  New (by A.F. and Austin):
>  >  11420  advapi32        0       service control manager API problem:
>  >  name of named objects might differ (client vs. service process)
>
>  I  didn't add that one

http://bugs.winehq.org/show_bug.cgi?id=11420#c4 says you did, but
somehow it escaped being listed until now.
- Dan


From thestig at google.com  Fri Apr  4 23:55:06 2008
From: thestig at google.com (Lei Zhang)
Date: Fri, 4 Apr 2008 21:55:06 -0700
Subject: [PATCH] user32: on VK_RETURN, send WM_COMMAND to ancestor,
	not parent.
In-Reply-To: <558b2f5c0804041111v2daf31e4sbbf874e4424c1be4@mail.gmail.com>
References: <558b2f5c0804040020w77698ed0v324e7dbae792098b@mail.gmail.com>
	<00a901c89657$3abcc4f0$a600fea9@DMITRY>
	<558b2f5c0804040747s3eb841cfma07c0b6ca236e8c1@mail.gmail.com>
	<018501c8966e$f65e4000$a600fea9@DMITRY>
	<558b2f5c0804041111v2daf31e4sbbf874e4424c1be4@mail.gmail.com>
Message-ID: <558b2f5c0804042155h783268f0m2419aa2f65cf2a19@mail.gmail.com>

On Fri, Apr 4, 2008 at 11:11 AM, Lei Zhang <thestig at google.com> wrote:
>
> On Fri, Apr 4, 2008 at 9:14 AM, Dmitry Timoshkov <dmitry at codeweavers.com> wrote:
>  > "Lei Zhang" <thestig at google.com> wrote:
>  >
>  >
>  > > The edit control is the child of a dialog box bar, which is in turn
>  > > the child of another dialog box foo. SetParent() is not involved, if
>  > > that's what you mean.
>  > >
>  >
>  >  Seems that's not the case then, from your test it looks more like
>  >  a WM_COMMAND forwarding from a child dialog to the parent one.
>  >
>  >  --
>  >  Dmitry.
>  >
>
>  I'm pretty sure the parent dialog is getting the WM_COMMAND directly.
>  It is not the case where the child dialog gets a WM_COMMAND, and
>  forwards it to its parent.
>
>  Running the test on Windows, the child dialog gets two WM_COMMANDS -
>  EN_SETFOCUS and EN_KILLFOCUS. Then the parent dialog gets WM_COMMAND
>  with IDOK.
>
>  - Lei
>

Ah, this is because the child dialog has the DS_CONTROL style. I
should test for that and handle it appropriately.

- Lei


From mle+win at mega-nerd.com  Sat Apr  5 02:50:05 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Sat, 5 Apr 2008 18:50:05 +1100
Subject: Time zone info
Message-ID: <20080405185005.91bcec65.mle+win@mega-nerd.com>

Hi all,

My Linux TZ variable is set to Australia/NSW and I'm getting a
bunch of fixmes like this:

    fixme:ntdll:find_reg_tz_info Can't find matching timezone
    information in the registry for bias -600, std (d/m/y):
    6/04/2008, dlt (d/m/y): 5/10/2008

I've seen this post to this mailing list:

    http://winehq.org/pipermail/wine-patches/2008-March/052474.html

so I understand that this timezone info is in the file tools/wine.inf.

Whats the policy on adding things to this file and how does one go
about it?

Cheers,
Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
"The growing and dangerous intrusion of this new technology,
threatens an entire industry's economic vitality and future
security." -- Jack Valenti (MPAA president) on the video
cassette recorder, 1982.


From dmitry at codeweavers.com  Sat Apr  5 03:12:14 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sat, 5 Apr 2008 17:12:14 +0900
Subject: Time zone info
References: <20080405185005.91bcec65.mle+win@mega-nerd.com>
Message-ID: <00ad01c896f4$c37aa300$a600fea9@DMITRY>

"Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:

> My Linux TZ variable is set to Australia/NSW and I'm getting a
> bunch of fixmes like this:
> 
>    fixme:ntdll:find_reg_tz_info Can't find matching timezone
>    information in the registry for bias -600, std (d/m/y):
>    6/04/2008, dlt (d/m/y): 5/10/2008
> 
> I've seen this post to this mailing list:
> 
>    http://winehq.org/pipermail/wine-patches/2008-March/052474.html
> 
> so I understand that this timezone info is in the file tools/wine.inf.
> 
> Whats the policy on adding things to this file and how does one go
> about it?

Looks like timezone info in your Linux system is not up to date.

P.S.
Please do not use "Reply-To:" header when posting wine-devel.

-- 
Dmitry.


From dmitry at codeweavers.com  Sat Apr  5 03:21:32 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sat, 5 Apr 2008 17:21:32 +0900
Subject: Time zone info
References: <20080405185005.91bcec65.mle+win@mega-nerd.com>
	<00ad01c896f4$c37aa300$a600fea9@DMITRY>
Message-ID: <00ca01c896f6$115b81b0$a600fea9@DMITRY>

"Dmitry Timoshkov" <dmitry at codeweavers.com> wrote:

>> My Linux TZ variable is set to Australia/NSW and I'm getting a
>> bunch of fixmes like this:
>> 
>>    fixme:ntdll:find_reg_tz_info Can't find matching timezone
>>    information in the registry for bias -600, std (d/m/y):
>>    6/04/2008, dlt (d/m/y): 5/10/2008

> Looks like timezone info in your Linux system is not up to date.

Another possibility is that you need to re-run wineprefixcreate to update
time zone information in the registry.

-- 
Dmitry.


From mle+win at mega-nerd.com  Sat Apr  5 03:23:44 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Sat, 5 Apr 2008 19:23:44 +1100
Subject: Time zone info
In-Reply-To: <00ad01c896f4$c37aa300$a600fea9@DMITRY>
References: <20080405185005.91bcec65.mle+win@mega-nerd.com>
	<00ad01c896f4$c37aa300$a600fea9@DMITRY>
Message-ID: <20080405192344.4960570f.mle+win@mega-nerd.com>

Dmitry Timoshkov wrote:

> Looks like timezone info in your Linux system is not up to date.

Sorry, I have every reason to believe it is correct. On what basis
do you suggest that it is not?
 
> Please do not use "Reply-To:" header when posting wine-devel.

I'm sorry, but why not? Isn't that the bext way to indicate
that I would prefer to have replies sent to the list rather
than directly to me?

Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
C++ : an octopus made by nailing extra legs onto a dog.


From ben at atomnet.co.uk  Sat Apr  5 08:39:07 2008
From: ben at atomnet.co.uk (Ben Hodgetts)
Date: Sat, 05 Apr 2008 14:39:07 +0100
Subject: Time zone info
In-Reply-To: <20080405192344.4960570f.mle+win@mega-nerd.com>
References: <20080405185005.91bcec65.mle+win@mega-nerd.com>	<00ad01c896f4$c37aa300$a600fea9@DMITRY>
	<20080405192344.4960570f.mle+win@mega-nerd.com>
Message-ID: <47F780FB.5090109@atomnet.co.uk>



Erik de Castro Lopo wrote:
> Dmitry Timoshkov wrote:
>
>   
>> Looks like timezone info in your Linux system is not up to date.
>>     
>
> Sorry, I have every reason to believe it is correct. On what basis
> do you suggest that it is not?
>  
>   
>> Please do not use "Reply-To:" header when posting wine-devel.
>>     
>
> I'm sorry, but why not? Isn't that the bext way to indicate
> that I would prefer to have replies sent to the list rather
> than directly to me?
>
> Erik
>   

Because replies are always supposed to go to the list anyway, it's 
rather redundant.

Ben H.


From rob at codeweavers.com  Sat Apr  5 09:22:47 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Sat, 05 Apr 2008 15:22:47 +0100
Subject: Wine 1.0 status: 70 days to release,	68 bugs to fix. 28 days
	to code freeze!
In-Reply-To: <a71bd89a0804041639r75e8d888qc61669caf6756cb6@mail.gmail.com>
References: <a71bd89a0804041639r75e8d888qc61669caf6756cb6@mail.gmail.com>
Message-ID: <47F78B37.6080800@codeweavers.com>

Dan Kegel wrote:
> New (by A.F. and Austin):
> 11420  advapi32        0       service control manager API problem:
> name of named objects might differ (client vs. service process)
>   

This should be fixed as a result of the services work that was done in 
the last couple of weeks and the last comment in the bug confirms this.

-- 
Rob Shearman



From dank at kegel.com  Sat Apr  5 10:06:59 2008
From: dank at kegel.com (Dan Kegel)
Date: Sat, 5 Apr 2008 08:06:59 -0700
Subject: Wine 1.0 status: 70 days to release,
	68 bugs to fix. 28 days to code freeze!
In-Reply-To: <47F78B37.6080800@codeweavers.com>
References: <a71bd89a0804041639r75e8d888qc61669caf6756cb6@mail.gmail.com>
	<47F78B37.6080800@codeweavers.com>
Message-ID: <a71bd89a0804050806v1fbf4a90m4aafebda27067719@mail.gmail.com>

On Sat, Apr 5, 2008 at 7:22 AM, Robert Shearman <rob at codeweavers.com> wrote:
> > New (by A.F. and Austin):
> > 11420  advapi32        0       service control manager API problem:
> > name of named objects might differ (client vs. service process)
>
>  This should be fixed as a result of the services work that was done in the
> last couple of weeks

I wondered about that...

> and the last comment in the bug confirms this.

Seems to say the opposite to me... I left a question in the bug, let's
see what Louis says.


From truiken at gmail.com  Sat Apr  5 11:28:47 2008
From: truiken at gmail.com (James Hawkins)
Date: Sat, 5 Apr 2008 11:28:47 -0500
Subject: [Try 3] [1/2] cabinet.dll -> FDICopy: Test added
In-Reply-To: <200804051937.33251.vitperov@etersoft.ru>
References: <200804051937.33251.vitperov@etersoft.ru>
Message-ID: <22821af30804050928s48a26486k311c3d6d6d5a4ce0@mail.gmail.com>

2008/4/5 Vitaly Perov <vitperov at etersoft.ru>:
> This test checks if function FDICopy() of cabinet.dll correctly works with an
>  empty cabinet file (It's correct cab-file, but it has no files and folders
>  inside).
>  In this case Windows return TRUE, but WINE return FALSE. So the installation
>  of certain software finishes with an error in WINE
>
>  Changelog:
>      - Added a test for cabinet.dll FDICopy function. This test checks if it
>  works correctly with an empty cab-files
>

--- dlls/cabinet/tests/fdi.c	6 Feb 2008 13:29:17 -0000	1.3
+++ dlls/cabinet/tests/fdi.c	5 Apr 2008 15:16:55 -0000
@@ -20,6 +20,7 @@

 #include <stdio.h>
 #include <windows.h>
+#include <assert.h>
 #include "fci.h"
 #include "fdi.h"
 #include "wine/test.h"

You forgot to remove this.


-- 
James Hawkins


From mpartap at gmx.net  Sat Apr  5 02:03:38 2008
From: mpartap at gmx.net (Marcel Partap)
Date: Sat, 05 Apr 2008 09:03:38 +0200
Subject: wine based win32 printer drivers
In-Reply-To: <511483.3837.qm@web23102.mail.ird.yahoo.com>
References: <511483.3837.qm@web23102.mail.ird.yahoo.com>
Message-ID: <47F7244A.6010706@gmx.net>

> I am looking at ddiwrapper lately and having a lot of fun with it.
Well I didn't have much fun with it because for me first it did not build properly, then segfaulted. 
Anyways.
> Is Marcel's on-going not-merged work anywhere on line that I can have
 > a peek before its merge into wine?
ot online but attached is the work done last year. This year's work is still in the pipeline, not 
much time for it lately but its on the agenda.
regards.

> 
> Hin-Tak
> 
> --- On Mon, 31/3/08, Detlef Riekenberg <wine.dev at web.de> wrote:
> 
>> From: Detlef Riekenberg <wine.dev at web.de> Subject: wine based win32 printer drivers To: "Marcel
>> Partap" <mpartap at gmx.net> Cc: wine-devel at winehq.org Date: Monday, 31 March, 2008, 12:12 AM On
>> So, 2008-03-30 at 06:03 +0200, Marcel Partap wrote:
>>> Anyways, I am working on getting something merged..
>> Great!
>> 
>>> For now the target is to get the Adobe pscript5 driver
>> working which
>>> has its own raster renderer and thus does not depend
>> on the dib
>>> engine.
>> A Postscript Driver has no raster renderer... A Postscript Driver has a Postscript Engine.
>> 
>>> Just started by making AddPrinter correctly get a default devmode out of the driver, patch is
>>> 
>> attached,
>> 
>>> DRIVER_EVENT_INITIALIZE, 3,
>> "3" is wrong here. See: myAddPrinterDriverEx(DWORD level, ...
>> 
>> Since there are much more Events, we need the DriverUI in more Places later. I suggest a simple
>> struct, which can be extended later (The struct must include the Results from GetProcAddress)
>> 
>> 
>> The changes for winspool.drv must go in a seperate Patch. WINSPOOL_CallDrvDocumentProperties is
>> the wrong name, when you call DrvDocumentPropertySheets.
>> 
>> You should collect all API in winspool.drv, that need the driverui (some are not implemented)
>> and design a simple struct with helper functions (Use monitor_t as example). Not all Drivers
>> Export DrvDocumentPropertySheets. You must prepare to use a Fallback to get the default devmode
>>  (DrvConvertDevMode) See winspool.drv/monitor_load as Example: - InitializePrintMonitor2 is
>> suggested my MSDN, but not needed yet - InitializePrintMonitor implemented -
>> InitializeMonitorEx and InitializeMonitor as Fallback.
>> 
>> The current Code is a crosscall from DocumentPropertiesW to DocumentPropertiesA. The DDI-API is
>> unicode and should be the prefered way. When wineps.drv is updated, the old code with the
>> crosscall can be removed, since we do not support ANSI Drivers (Windows 9x).
>> 
>> You can even use the same struct and helper functions in localspl.dll and winspool.drv
>> 
>> 
>> --
>> 
>> By by ... Detlef
> 
> 
> ___________________________________________________________ Yahoo! For Good helps you make a
> difference
> 
> http://uk.promotions.yahoo.com/forgood/
> 


-- 
<div id="signature">
   "Obstacles are those frightful things you see when you take your eyes off your goal."
                                                               -- Henry Ford (1863-1947)
   Change the world! Vote revolution: http://hfopi.org/vote-future
</div>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: enddeadlinestatus_2007-08-31_07-44.rar
Type: application/rar
Size: 99224 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080405/0409cccc/attachment-0001.rar 

From till.kamppeter at gmail.com  Sat Apr  5 09:43:41 2008
From: till.kamppeter at gmail.com (Till Kamppeter)
Date: Sat, 05 Apr 2008 16:43:41 +0200
Subject: WINEDLLPATH, ddiwrapper, msvcrt40 (Re: wine based win32 printer
	drivers)
In-Reply-To: <780857.19559.qm@web23108.mail.ird.yahoo.com>
References: <780857.19559.qm@web23108.mail.ird.yahoo.com>
Message-ID: <47F7901D.70309@gmail.com>

Hin-Tak Leung wrote:
> 2) (to uli and Till) - do you mind if I put a mod/update of ddiwrapper out
> publicly, or uli can release a new one that works with current wine? 
> 
> I have a third question - while looking at another XP driver for a paper-weight printer (konica-minolta magic color 2500W), it depends on msvcrt40.dll. 
>

I am not of much help here. I have never really used wine (once for 
running a self-extracting .exe with a firmware for a didgital camera in 
it) and I also never packaged it for a distro.

    Till



From xixsimplicityxix at gmail.com  Sat Apr  5 13:10:17 2008
From: xixsimplicityxix at gmail.com (John Klehm)
Date: Sat, 5 Apr 2008 13:10:17 -0500
Subject: Crossbuild patch, appropriate for wine?
In-Reply-To: <47F62EA6.4030204@codeweavers.com>
References: <78a7dad00804040256q35948105gb5d52d9b975c8830@mail.gmail.com>
	<47F61545.4040709@codeweavers.com> <87myo9byjt.fsf@wine.dyndns.org>
	<47F624A2.6070401@codeweavers.com> <87iqyxbw4v.fsf@wine.dyndns.org>
	<47F62EA6.4030204@codeweavers.com>
Message-ID: <78a7dad00804051110s685de46auc9f4616108805bff@mail.gmail.com>

On Fri, Apr 4, 2008 at 8:35 AM, Robert Shearman <rob at codeweavers.com> wrote:
> > > Alexandre Julliard wrote:
> > >
> > >
> > > > I don't think we want to disable exceptions, that will just lead to
> > > > broken builds. It should be possible to make the sigsetjmp variant
> work
>
>  The reason is that RtlUnwind clears all general purpose registers (and
> maybe changes esp/ebp) so that frame is no longer valid. There may be a way
> to work around this, but I'm not sure.
>

Well how about for the interim a no op patch.  No op exceptions can be
handled in the case:
defined(__MINGW32__) && ! defined(USE_COMPILER_EXCEPTIONS).

The eventual support for compiler exceptions can then go in separate
case: defined(__MINGW32__) && defined(USE_COMPILER_EXCEPTIONS)

Patch attached implementing Rob S suggestions.

--John
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: 0001-exception.h-Add-no-op-exception-definitions-for.patch.txt
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20080405/5b0b2b21/attachment.txt 

From mle+win at mega-nerd.com  Sat Apr  5 16:19:06 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Sun, 6 Apr 2008 07:19:06 +1000
Subject: Time zone info
In-Reply-To: <00ca01c896f6$115b81b0$a600fea9@DMITRY>
References: <20080405185005.91bcec65.mle+win@mega-nerd.com>
	<00ad01c896f4$c37aa300$a600fea9@DMITRY>
	<00ca01c896f6$115b81b0$a600fea9@DMITRY>
Message-ID: <20080406071906.e03e4cd0.mle+win@mega-nerd.com>

Dmitry Timoshkov wrote:

> Another possibility is that you need to re-run wineprefixcreate to update
> time zone information in the registry.

That fixed it. Thanks.

Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
Rule 1: Spammers lie.
Rule 2: If a spammer seems to be telling the truth, see Rule #1.


From hans at it.vu.nl  Sun Apr  6 03:41:11 2008
From: hans at it.vu.nl (Hans Leidekker)
Date: Sun, 6 Apr 2008 10:41:11 +0200
Subject: [PATCH 1 of 2] start.exe: add /Unix switch for starting files
	from unix file managers
In-Reply-To: <ced95fe0804052046v425e4ec4reee5e0773ec135@mail.gmail.com>
References: <ced95fe0804052046v425e4ec4reee5e0773ec135@mail.gmail.com>
Message-ID: <200804061041.12274.hans@it.vu.nl>

On Sunday 06 April 2008 05:46:49 Vincent Povirk wrote:

> -IMPORTS   = shell32 user32 kernel32
> +IMPORTS   = shell32 user32 kernel32 shlwapi

If it's just StrCpyNW you need from shlwapi you might as well use
an alternative like memcpy and avoid importing this dll.

> +               char multibyte_dospath[MAX_PATH];

That's a misnomer, you're storing a Unix path in the buffer.
Dynamic allocation would make the code a bit more robust.

> +               WideCharToMultiByte(CP_ACP, 0, sei.lpFile, -1, multibyte_dospath, sizeof(multibyte_dospath)/sizeof(char), NULL, NULL);

Should be CP_UNIXCP.

 -Hans


From stefan at codeweavers.com  Sun Apr  6 04:51:12 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sun, 6 Apr 2008 11:51:12 +0200
Subject: d3d9-Make-the-shader-test-more-precision-tolerant
In-Reply-To: <47F88DFF.8050405@web.de>
References: <47F88DFF.8050405@web.de>
Message-ID: <200804061151.12732.stefan@codeweavers.com>

Am Sonntag, 6. April 2008 10:46:55 schrieb Rico Sch?ller:
> Hi,
>
> this patch makes the cnd_test on windows happy.
>
> Cheers
> Rico

The patches look ok to me



From jan.wine at zerebecki.de  Sun Apr  6 05:13:31 2008
From: jan.wine at zerebecki.de (Jan Zerebecki)
Date: Sun, 6 Apr 2008 12:13:31 +0200
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <7e33d29b0804021423p5a3ec275l9d5b96234de28a8c@mail.gmail.com>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>
	<7e33d29b0804020808m558534f8q1d7430c219cfbc26@mail.gmail.com>
	<b6bb06270804021105v63c03b37nd9e47e72a2a338c6@mail.gmail.com>
	<22821af30804021133m46c0c78dy76debaec3d48bc9a@mail.gmail.com>
	<47F3D5EF.2030001@redhat.com>
	<22821af30804021159w70ab3327m26ebb9b325c82b1b@mail.gmail.com>
	<7e33d29b0804021420j19d12047ma386a60d66f2c091@mail.gmail.com>
	<7e33d29b0804021423p5a3ec275l9d5b96234de28a8c@mail.gmail.com>
Message-ID: <20080406101331.GP3557@crissy.swd.zerebecki.de>

On Wed, Apr 02, 2008 at 05:23:50PM -0400, Bryan Haskins wrote:
> Sorry for the double post. But further on that point, at the sound system
> neutral level, naming eahc app individually as a sound item would rock. In
> such a way that each app perhaps talks to ALSA directly, which results in
> self identification, and further Pulse via ALSA recognizing things
> individually.

That this doesn't work with the alsa->pulse plugin is a missing feature of
that plugin which could be fixed.


Jan



From jan.wine at zerebecki.de  Sun Apr  6 05:21:34 2008
From: jan.wine at zerebecki.de (Jan Zerebecki)
Date: Sun, 6 Apr 2008 12:21:34 +0200
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <23410889.1207241395827.JavaMail.root@elwamui-darkeyed.atl.sa.earthlink.net>
References: <23410889.1207241395827.JavaMail.root@elwamui-darkeyed.atl.sa.earthlink.net>
Message-ID: <20080406102134.GQ3557@crissy.swd.zerebecki.de>

On Thu, Apr 03, 2008 at 12:49:55PM -0400, Susan Cragin wrote:
> Back to the initial question:
> 
> Given what we have existing, right now, is there any set of instructions or workarounds that makes WINE apps work best?
> even
> killall pulseaudio ??

Yes, stopping PA and using alsa directly probably works best.

The other options are either using the alsa->pulse plugin or the oss
wrapper of pulse. When I tested it the alsa->pulse plugin worked fine
with the applications running under wine I tested, but you need to
configure alsa correctly and there are still a few known problems (so it
doesn't work as good for everything as directly using alsa). I didn't
test the oss wrapper and I don't think it's usefull to invest time in
that, the alsa->pulse plugin is the way to go.


Jan



From jan.wine at zerebecki.de  Sun Apr  6 05:27:51 2008
From: jan.wine at zerebecki.de (Jan Zerebecki)
Date: Sun, 6 Apr 2008 12:27:51 +0200
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <200804030146.18372.stefan@codeweavers.com>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>
	<7e33d29b0804020808m558534f8q1d7430c219cfbc26@mail.gmail.com>
	<200804030146.18372.stefan@codeweavers.com>
Message-ID: <20080406102751.GR3557@crissy.swd.zerebecki.de>

On Thu, Apr 03, 2008 at 01:46:18AM +0200, Stefan D?singer wrote:
> Am Mittwoch, 2. April 2008 17:08:06 schrieb Bryan Haskins:
> > I'm more interested in a direct pulseaudio gateway for Wine... since by
> > application sound control is the biggest thing here for most people....
> > wine is treated as one big audio blob. Pulse sees it as one thing.
> Isn't that a PulseAudio limitation? I am sure that Wine opens a new Alsa 
> connection for each Windows application that uses sound. I don't know how PA 
> groups the input, but it can surely find different Wine inputs from Alsa.

Yes, more precicely it's about how the alsa->pulse plugin tries to
identify different applications. It gets the real process name (the
loader), not the one wine changed to. The plugin could use that, but it
would also be nice if the plugin would take an optional argument to set
the name explicitly like on can with the pulse api.


Jan



From jan.wine at zerebecki.de  Sun Apr  6 05:32:40 2008
From: jan.wine at zerebecki.de (Jan Zerebecki)
Date: Sun, 6 Apr 2008 12:32:40 +0200
Subject: re pulse issues
In-Reply-To: <14704625.1207148574344.JavaMail.root@elwamui-polski.atl.sa.earthlink.net>
References: <14704625.1207148574344.JavaMail.root@elwamui-polski.atl.sa.earthlink.net>
Message-ID: <20080406103240.GS3557@crissy.swd.zerebecki.de>

On Wed, Apr 02, 2008 at 11:02:54AM -0400, Susan Cragin wrote:
> ALSA lib pcm.c:2106:(snd_pcm_open_conf) Cannot open shared library /usr/lib/alsa-lib/libasound_module_pcm_pulse.so
> ALSA lib pcm.c:2106:(snd_pcm_open_conf) Cannot open shared library /usr/lib/alsa-lib/libasound_module_pcm_pulse.so

I guess this is a missconfiguration of your system. (Perhaps you don't
have the alsa->pluse plugin installed?) You can try with aplay if you
get sound out of pulse to make sure it's not Wines fault.


Jan



From jan.wine at zerebecki.de  Sun Apr  6 06:23:54 2008
From: jan.wine at zerebecki.de (Jan Zerebecki)
Date: Sun, 6 Apr 2008 13:23:54 +0200
Subject: Time zone info
In-Reply-To: <47F780FB.5090109@atomnet.co.uk>
References: <20080405185005.91bcec65.mle+win@mega-nerd.com>
	<00ad01c896f4$c37aa300$a600fea9@DMITRY>
	<20080405192344.4960570f.mle+win@mega-nerd.com>
	<47F780FB.5090109@atomnet.co.uk>
Message-ID: <20080406112354.GT3557@crissy.swd.zerebecki.de>

On Sat, Apr 05, 2008 at 02:39:07PM +0100, Ben Hodgetts wrote:
> Erik de Castro Lopo wrote:
> > Dmitry Timoshkov wrote:

> >> Please do not use "Reply-To:" header when posting wine-devel.

> > I'm sorry, but why not? Isn't that the bext way to indicate
> > that I would prefer to have replies sent to the list rather
> > than directly to me?

> Because replies are always supposed to go to the list anyway, it's 
> rather redundant.

Then where's the harm? Besides that it perhaps doesn't do what you want,
see http://cr.yp.to/proto/replyto.html for a good explanation.


Jan



From hverbeet at gmail.com  Sun Apr  6 07:50:20 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Sun, 6 Apr 2008 14:50:20 +0200
Subject: d3dx9: Implementation of D3DXGetShaderSize
In-Reply-To: <47F8036A.5030408@ilidium.com>
References: <47F8036A.5030408@ilidium.com>
Message-ID: <d658b69e0804060550n1a31505p695b6280332177e6@mail.gmail.com>

On 06/04/2008, Luis Busquets <luis.busquets at ilidium.com> wrote:
> This function obtains the size of a shader bytestream. It does so looking
> for the End token.
>

>+UINT D3DXGetShaderSize(DWORD * pFunction)
I would expect this to take a const pointer. Also, there's no reason
to use Microsoft's (broken) naming conventions for function arguments.

> + while (*address!=0x0000ffff) {
> +   /*Let's check if the next DWORD is a comment*/
> +   if ((*address&0x0000ffff)==0x0000fffe) {
> +                address=address+((*address >> 0x10) & 0x00007fff);
> +                }
> +   address=address+0x1;
> +  }
It would help readability quite a bit to use the proper constants
here. Also, please try to use an indentation style consistent with the
rest of the dll and wine (this goes for the other patches as well).

> + size=(address-pFunction+0x1)*sizeof(DWORD);
Why the +1 here? Does it return the size without the end token itself?
Tests and comments are always helpful there.


The following (untested!) implementation looks more reasonable to me:

UINT D3DXGetShaderSize(const DWORD *byte_code)
{
    const DWORD *ptr = byte_code;

    if (!ptr) return 0;

    /* Look for the END token, skipping the VERSION token */
    while (*++ptr != D3DSIO_END) {
        /* Skip comments */
        if ((*ptr & D3DSI_OPCODE_MASK) == D3DSIO_COMMENT) {
            ptr += ((*ptr & D3DSI_COMMENTSIZE_MASK) >> D3DSI_COMMENTSIZE_SHIFT);
        }
    }

    /* Return the shader size in bytes, excluding the END token. */
    return (ptr - (byte_code + 1)) * sizeof(*ptr);
}


From hverbeet at gmail.com  Sun Apr  6 08:12:40 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Sun, 6 Apr 2008 15:12:40 +0200
Subject: d3dx9: Implementation of D3DXGetFVFVertexSize
In-Reply-To: <47F803E9.2060605@ilidium.com>
References: <47F803E9.2060605@ilidium.com>
Message-ID: <d658b69e0804060612o97649cn12255061c8d3d5dc@mail.gmail.com>

On 06/04/2008, Luis Busquets <luis.busquets at ilidium.com> wrote:
> Implementation of D3DXGetFVFVertexSize. It does so by calculating all the
> different publicly available posible vertex configuration types.
>

>+  switch (FVF & D3DFVF_XYZB5) {
You should probably use D3DFVF_POSITION_MASK instead here.

>+  for (i=0;i<((FVF&0x0f00) >> 16);i++) {
This doesn't look right. Right shifting (FVF & 0x0f00) by 16 will
always produce 0. Tests should have caught that.


From hverbeet at gmail.com  Sun Apr  6 08:14:04 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Sun, 6 Apr 2008 15:14:04 +0200
Subject: d3dx8: Implementation of D3DXGetFVFVertexSize
In-Reply-To: <47F80450.4060102@ilidium.com>
References: <47F80450.4060102@ilidium.com>
Message-ID: <d658b69e0804060614p2684b47eg1dcc934a6eb476a6@mail.gmail.com>

On 06/04/2008, Luis Busquets <luis.busquets at ilidium.com> wrote:
> Implementation of D3DXGetFVFVertexSize. It does so by calculating all the
> different publicly available posible vertex configuration types.
>
Same comments as for the d3dx9 version apply. (Why isn't the d3dx9
version a forward to d3dx8?)


From saulius2 at ar.fi.lt  Sun Apr  6 08:25:08 2008
From: saulius2 at ar.fi.lt (Saulius Krasuckas)
Date: Sun, 6 Apr 2008 16:25:08 +0300 (EEST)
Subject: LoadStringW [1/2]
In-Reply-To: <006401c895f9$07c167d0$a600fea9@DMITRY>
References: <4794545B.4000909@procyongames.com><005101c85c07$b280a180$a600fea9@DMITRY><000601c85c08$f006a440$a600fea9@DMITRY><4794FD3E.2080204@procyongames.com><22821af30801211217g22c09c8bu597659ab11aafff0@mail.gmail.com>
	<479504E4.4080401@procyongames.com><22821af30801211252l30be545cqc9cf37bb4b89451c@mail.gmail.com><47950AEF.9060409@procyongames.com>
	<Pine.LNX.4.62.0804032333300.6745@tvarka.ar.fi.lt>
	<006401c895f9$07c167d0$a600fea9@DMITRY>
Message-ID: <Pine.LNX.4.62.0804061603190.17765@tvarka.ar.fi.lt>

* On Fri, 4 Apr 2008, Dmitry Timoshkov wrote:
> 
> If the regression can be identified by someone able to read the code and 
> not by a regression test that doesn't matter.

Could you show me appropriate code lines of LoadStringA and a logic to 
follow, please?  I am schocked.

Dmitry, for me your statement is true only in the case of reading original 
code of appropriate DLL from MS :(


From stefan at codeweavers.com  Sun Apr  6 10:41:05 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sun, 6 Apr 2008 17:41:05 +0200
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <20080406102751.GR3557@crissy.swd.zerebecki.de>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>
	<200804030146.18372.stefan@codeweavers.com>
	<20080406102751.GR3557@crissy.swd.zerebecki.de>
Message-ID: <200804061741.05956.stefan@codeweavers.com>

Am Sonntag, 6. April 2008 12:27:51 schrieb Jan Zerebecki:
> Yes, more precicely it's about how the alsa->pulse plugin tries to
> identify different applications. It gets the real process name (the
> loader), not the one wine changed to. The plugin could use that, but it
> would also be nice if the plugin would take an optional argument to set
> the name explicitly like on can with the pulse api.
I don't see how the process name or a process identification is a proper 
primary key for sound clients. They should rather use the alsa primary 
buffers requested by the apps rather than the process identification. They 
could still use the process name as a description for the user interface, 
using anything not directly sound API related like PID, process name, ..., as 
the identifier for a sound client is broken IMHO.


From stefan at codeweavers.com  Sun Apr  6 10:46:00 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sun, 6 Apr 2008 17:46:00 +0200
Subject: 0003-wined3d-Filter-invalid-stuff-in-SetStreamSourceFreq
In-Reply-To: <47F8E64D.3080205@web.de>
References: <47F8E64D.3080205@web.de>
Message-ID: <200804061746.00346.stefan@codeweavers.com>

Am Sonntag, 6. April 2008 17:03:41 schrieb Rico Sch?ller:
> Hi,
>
> this patch filters out invalid parameter in SetStreamSourceFreq(). The
> test for that is 0005-d3d9-add-stream_test-with-instancing. So apply
> this first, otherwise the tests will fail on wine.
You should write some message that the function returns an error, e.g. 
WARN("INSTANCEDATA used on stream 0, returning D3DERR_INVALIDCALL\n"); This 
eases debugging. I prefer a WARN for such cases. It won't be printed with the 
default FIXME loglevel, as it could be caused by an app bug, but it is more 
significant than a TRACE, since an invalid function call could be caused by 
incorrect behavior of Wine earlier on.


From stefan at codeweavers.com  Sun Apr  6 10:48:11 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sun, 6 Apr 2008 17:48:11 +0200
Subject: 0004-wined3d-improve-drawStridedInstanced
In-Reply-To: <47F8E741.7000501@web.de>
References: <47F8E741.7000501@web.de>
Message-ID: <200804061748.12082.stefan@codeweavers.com>

Am Sonntag, 6. April 2008 17:07:45 schrieb Rico Sch?ller:
> Hi,
>
> this patch solves a rendering problem with instances. Affected games are
> Crysis and Gothic3. The test for this is in
> 0005-d3d9-add-stream_test-with-instancing. So apply this first,
> otherwise the tests will fail on wine.
I think a comment why you're breaking out of the loop here would be helpful, 
perhaps mentioning the testcase in d3d9/tests. The same applies to the 0 
instances -> 1 instance override


From stefan at codeweavers.com  Sun Apr  6 10:49:41 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sun, 6 Apr 2008 17:49:41 +0200
Subject: 0005-d3d9-add-stream_test-with-instancing
In-Reply-To: <47F8E80E.5090403@web.de>
References: <47F8E80E.5090403@web.de>
Message-ID: <200804061749.42059.stefan@codeweavers.com>

Am Sonntag, 6. April 2008 17:11:10 schrieb Rico Sch?ller:
> Hi,
>
> this is a patch, which contains a test for instancing. It proves the
> behavior from these two patches:
Alexandre: Note that this test needs my 
D3DCREATE_SOFTWARE_VERTEXPROCESSING->D3DCREATE_HARDWARE_VERTEXPROCESSING to 
work on Windows


From actong88 at gmail.com  Sun Apr  6 11:29:06 2008
From: actong88 at gmail.com (Allan Tong)
Date: Sun, 6 Apr 2008 12:29:06 -0400
Subject: [2/6] d3d9: Remove some test trace lines
In-Reply-To: <200804052318.25518.stefan@codeweavers.com>
References: <200804052318.25518.stefan@codeweavers.com>
Message-ID: <d75158870804060929m6d147aa1ucc2850143e399c50@mail.gmail.com>

On Sat, Apr 5, 2008 at 5:18 PM, Stefan D?singer <stefan at codeweavers.com> wrote:
>
>  I think they're not needed any more now that the test works

For what it's worth, this test fails for me with fbos.

 - Allan

From jan.wine at zerebecki.de  Sun Apr  6 12:04:48 2008
From: jan.wine at zerebecki.de (Jan Zerebecki)
Date: Sun, 6 Apr 2008 19:04:48 +0200
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <200804061741.05956.stefan@codeweavers.com>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>
	<200804030146.18372.stefan@codeweavers.com>
	<20080406102751.GR3557@crissy.swd.zerebecki.de>
	<200804061741.05956.stefan@codeweavers.com>
Message-ID: <20080406170448.GU3557@crissy.swd.zerebecki.de>

On Sun, Apr 06, 2008 at 05:41:05PM +0200, Stefan D?singer wrote:
> Am Sonntag, 6. April 2008 12:27:51 schrieb Jan Zerebecki:
> > Yes, more precicely it's about how the alsa->pulse plugin tries to
> > identify different applications. It gets the real process name (the
> > loader), not the one wine changed to. The plugin could use that, but it
> > would also be nice if the plugin would take an optional argument to set
> > the name explicitly like on can with the pulse api.
> I don't see how the process name or a process identification is a proper 
> primary key for sound clients. They should rather use the alsa primary 
> buffers requested by the apps rather than the process identification. They 
> could still use the process name as a description for the user interface, 
> using anything not directly sound API related like PID, process name, ..., as 
> the identifier for a sound client is broken IMHO.

It results in the behaviour that the user would expect. E.g. that one
game you start retains the same settings everytime it creates a primary
buffer (thus that it retains the settings on the next start) and the
voice chat client also always retains it's separate setting.

I'd expect most pulse using applications use one identifier for their
whole application (and the same one on each start).

There is nothing like that identifier in alsa and AFAIK neither in
dsound/winmm.


Jan



From xixsimplicityxix at gmail.com  Sun Apr  6 12:49:53 2008
From: xixsimplicityxix at gmail.com (John Klehm)
Date: Sun, 6 Apr 2008 12:49:53 -0500
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <20080406170448.GU3557@crissy.swd.zerebecki.de>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>
	<200804030146.18372.stefan@codeweavers.com>
	<20080406102751.GR3557@crissy.swd.zerebecki.de>
	<200804061741.05956.stefan@codeweavers.com>
	<20080406170448.GU3557@crissy.swd.zerebecki.de>
Message-ID: <78a7dad00804061049q75188e23p6b6882140ac12ef1@mail.gmail.com>

On Sun, Apr 6, 2008 at 12:04 PM, Jan Zerebecki <jan.wine at zerebecki.de> wrote:
>  It results in the behaviour that the user would expect. E.g. that one
>  game you start retains the same settings everytime it creates a primary
>  buffer (thus that it retains the settings on the next start) and the
>  voice chat client also always retains it's separate setting.
>
>  I'd expect most pulse using applications use one identifier for their
>  whole application (and the same one on each start).
>

I guess this whole system provided per app sound preference thing
seems weird to me.  From a  design stand point, does it not make sense
for apps that use sound to expect they should maintain their own sound
settings and reuse them on startup.

To design this into the system seems like a workaround for apps that
fail to properly maintain their own sound preferences. Wouldn't it be
better to patch those apps?

Just my .005 cent,
John


From stefan at codeweavers.com  Sun Apr  6 13:00:23 2008
From: stefan at codeweavers.com (Stefan =?utf-8?q?D=C3=B6singer?=)
Date: Sun, 6 Apr 2008 20:00:23 +0200
Subject: [2/6] d3d9: Remove some test trace lines
In-Reply-To: <d75158870804060929m6d147aa1ucc2850143e399c50@mail.gmail.com>
References: <200804052318.25518.stefan@codeweavers.com>
	<d75158870804060929m6d147aa1ucc2850143e399c50@mail.gmail.com>
Message-ID: <200804062000.23756.stefan@codeweavers.com>

Am Sonntag, 6. April 2008 18:29:06 schrieb Allan Tong:
> On Sat, Apr 5, 2008 at 5:18 PM, Stefan D?singer <stefan at codeweavers.com> 
wrote:
> >  I think they're not needed any more now that the test works
>
> For what it's worth, this test fails for me with fbos.
Ya, quite sure since part of the behavior is not implemented yet, most 
importantly clearing the green and blue channels of R32F. What I meant is 
that it works on Windows, so we know what we can expect and should return 
from Wine. However, when I see the lines in a Windows test output it always 
takes me two looks to figure out that they are not failures



From jan.wine at zerebecki.de  Sun Apr  6 13:38:14 2008
From: jan.wine at zerebecki.de (Jan Zerebecki)
Date: Sun, 6 Apr 2008 20:38:14 +0200
Subject: Pulse Audio -- Wine should have instructions on this web site
In-Reply-To: <78a7dad00804061049q75188e23p6b6882140ac12ef1@mail.gmail.com>
References: <11523290.1207138264468.JavaMail.root@elwamui-little.atl.sa.earthlink.net>
	<200804030146.18372.stefan@codeweavers.com>
	<20080406102751.GR3557@crissy.swd.zerebecki.de>
	<200804061741.05956.stefan@codeweavers.com>
	<20080406170448.GU3557@crissy.swd.zerebecki.de>
	<78a7dad00804061049q75188e23p6b6882140ac12ef1@mail.gmail.com>
Message-ID: <20080406183814.GV3557@crissy.swd.zerebecki.de>

On Sun, Apr 06, 2008 at 12:49:53PM -0500, John Klehm wrote:
> On Sun, Apr 6, 2008 at 12:04 PM, Jan Zerebecki <jan.wine at zerebecki.de> wrote:
> >  It results in the behaviour that the user would expect. E.g. that one
> >  game you start retains the same settings everytime it creates a primary
> >  buffer (thus that it retains the settings on the next start) and the
> >  voice chat client also always retains it's separate setting.
> >
> >  I'd expect most pulse using applications use one identifier for their
> >  whole application (and the same one on each start).
> >
> 
> I guess this whole system provided per app sound preference thing
> seems weird to me.  From a  design stand point, does it not make sense
> for apps that use sound to expect they should maintain their own sound
> settings and reuse them on startup.

That would mean duplicate code for every application... With that
logic defined in a central place you can change it, like group
configurations together, e.g. all your games use the same volume setting
but your voice chat uses another.

> To design this into the system seems like a workaround for apps that
> fail to properly maintain their own sound preferences. Wouldn't it be
> better to patch those apps?

Besides the application doesn't even know about such things as on which
physical output it's sound plays...


Jan



From dank at kegel.com  Sun Apr  6 13:43:40 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 6 Apr 2008 11:43:40 -0700
Subject: Free apps bundled with msvcr70?
Message-ID: <a71bd89a0804061143v1352e387mbf1ff57264eefe27@mail.gmail.com>

(This may sound like a repeat question, but last time I
was asking about msvcr71, and thanks to the answers,
that's now in winetricks.)

Anybody have a good download link for an app that
comes bundled with msvcr70 and msvcp70,
i.e. one that was compiled with visual studio 2002?


From luis.busquets at ilidium.com  Sun Apr  6 13:47:03 2008
From: luis.busquets at ilidium.com (Luis Busquets)
Date: Sun, 06 Apr 2008 20:47:03 +0200
Subject: d3dx8: Implementation of D3DXGetFVFVertexSize
In-Reply-To: <d658b69e0804060614p2684b47eg1dcc934a6eb476a6@mail.gmail.com>
References: <47F80450.4060102@ilidium.com>
	<d658b69e0804060614p2684b47eg1dcc934a6eb476a6@mail.gmail.com>
Message-ID: <47F91AA7.301@ilidium.com>

Sorry, actually, the title of d3dx9 was d3dx8. Both patches patch the 
same file.
H. Verbeet escribi?:
> On 06/04/2008, Luis Busquets <luis.busquets at ilidium.com> wrote:
>   
>> Implementation of D3DXGetFVFVertexSize. It does so by calculating all the
>> different publicly available posible vertex configuration types.
>>
>>     
> Same comments as for the d3dx9 version apply. (Why isn't the d3dx9
> version a forward to d3dx8?)
>
>
>   



From dank at kegel.com  Sun Apr  6 13:47:12 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 6 Apr 2008 11:47:12 -0700
Subject: appdb needs to list 0.9.47 in the pulldown, please
Message-ID: <a71bd89a0804061147v71eefcd5lfc39d600b4669fc2@mail.gmail.com>

Can somebody change the appdb to allow submitting
results against 0.9.47?  I think that's what Gutsy's
bundled version of wine is.
Somebody just submitted bogus results (with the wrong wine
version) because we lack that option.


From chmorgan at gmail.com  Sun Apr  6 13:56:43 2008
From: chmorgan at gmail.com (Chris Morgan)
Date: Sun, 6 Apr 2008 14:56:43 -0400
Subject: appdb needs to list 0.9.47 in the pulldown, please
In-Reply-To: <a71bd89a0804061147v71eefcd5lfc39d600b4669fc2@mail.gmail.com>
References: <a71bd89a0804061147v71eefcd5lfc39d600b4669fc2@mail.gmail.com>
Message-ID: <f3f1b91a0804061156q529d417bn304bbc8883d0eacf@mail.gmail.com>

The appdb code currently prunes the list to several of the most recent
versions so people don't submit entries against older or obsolete
versions.

Is it really useful to have test results submitted such an old version
when we almost always ask users to upgrade to the latest version in
the #winehq channel or in bugzilla?

We do mention that if their version is older than the listed version
the user should upgrade. Users that submit results with the wrong or
old version may mean well but may not be the kind of test results we
want to rely on.

Chris



On Sun, Apr 6, 2008 at 2:47 PM, Dan Kegel <dank at kegel.com> wrote:
> Can somebody change the appdb to allow submitting
>  results against 0.9.47?  I think that's what Gutsy's
>  bundled version of wine is.
>  Somebody just submitted bogus results (with the wrong wine
>  version) because we lack that option.
>
>
>


From dank at kegel.com  Sun Apr  6 14:02:07 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 6 Apr 2008 12:02:07 -0700
Subject: appdb needs to list 0.9.47 in the pulldown, please
In-Reply-To: <f3f1b91a0804061156q529d417bn304bbc8883d0eacf@mail.gmail.com>
References: <a71bd89a0804061147v71eefcd5lfc39d600b4669fc2@mail.gmail.com>
	<f3f1b91a0804061156q529d417bn304bbc8883d0eacf@mail.gmail.com>
Message-ID: <a71bd89a0804061202u69df1d1co87edc8f8506a2114@mail.gmail.com>

On Sun, Apr 6, 2008 at 11:56 AM, Chris Morgan <chmorgan at gmail.com> wrote:
> The appdb code currently prunes the list to several of the most recent
>  versions so people don't submit entries against older or obsolete
>  versions.

Of course.  It's just a question of the right cutoff.
It seems reasonable to me to include the version bundled with gutsy,
even if it's getting old, because gutsy is so popular.

>  Is it really useful to have test results submitted such an old version
>  when we almost always ask users to upgrade to the latest version in
>  the #winehq channel or in bugzilla?

Perhaps.  Some things did run ok with it, and we have had some
regressions since then.

>  We do mention that if their version is older than the listed version
>  the user should upgrade. Users that submit results with the wrong or
>  old version may mean well but may not be the kind of test results we
>  want to rely on.

Sure, but one goes to market with the users one has, not with the
users one wishes one had :-)
- Dan


From wine-devel at kievinfo.com  Sun Apr  6 14:42:48 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sun, 06 Apr 2008 13:42:48 -0600
Subject: appdb needs to list 0.9.47 in the pulldown, please
In-Reply-To: <a71bd89a0804061202u69df1d1co87edc8f8506a2114@mail.gmail.com>
References: <a71bd89a0804061147v71eefcd5lfc39d600b4669fc2@mail.gmail.com>	<f3f1b91a0804061156q529d417bn304bbc8883d0eacf@mail.gmail.com>
	<a71bd89a0804061202u69df1d1co87edc8f8506a2114@mail.gmail.com>
Message-ID: <47F927B8.4030402@kievinfo.com>

Dan Kegel wrote:
> On Sun, Apr 6, 2008 at 11:56 AM, Chris Morgan <chmorgan at gmail.com> wrote:
>> The appdb code currently prunes the list to several of the most recent
>>  versions so people don't submit entries against older or obsolete
>>  versions.
> 
> Of course.  It's just a question of the right cutoff.
> It seems reasonable to me to include the version bundled with gutsy,
> even if it's getting old, because gutsy is so popular.

That's the whole point of requiring upgrades. And ubuntu can package a newer 
version to their distro as well. I don't see not point in supporting this. 
All Wine versions can and should be considered as bug fixes.

So I really against this. For now we have to force users upgrade if distro 
doesn't.

Vitaliy.


From luis.busquets at ilidium.com  Sun Apr  6 14:59:11 2008
From: luis.busquets at ilidium.com (Luis Busquets)
Date: Sun, 06 Apr 2008 21:59:11 +0200
Subject: d3dx9: Implementation of D3DXGetShaderSize 2/3
In-Reply-To: <d658b69e0804060550n1a31505p695b6280332177e6@mail.gmail.com>
References: <47F8036A.5030408@ilidium.com>
	<d658b69e0804060550n1a31505p695b6280332177e6@mail.gmail.com>
Message-ID: <47F92B8F.5040002@ilidium.com>

The +1 of the end is because finally address points to the end token. So 
+1 is the end token. This function has been tested with all shaders of 
Civilization 4 and has responded successfully.

The attached patch has included the suggestions.


H. Verbeet escribi?:
> On 06/04/2008, Luis Busquets <luis.busquets at ilidium.com> wrote:
>   
>> This function obtains the size of a shader bytestream. It does so looking
>> for the End token.
>>
>>     
>
>   
>> +UINT D3DXGetShaderSize(DWORD * pFunction)
>>     
> I would expect this to take a const pointer. Also, there's no reason
> to use Microsoft's (broken) naming conventions for function arguments.
>
>   
>> + while (*address!=0x0000ffff) {
>> +   /*Let's check if the next DWORD is a comment*/
>> +   if ((*address&0x0000ffff)==0x0000fffe) {
>> +                address=address+((*address >> 0x10) & 0x00007fff);
>> +                }
>> +   address=address+0x1;
>> +  }
>>     
> It would help readability quite a bit to use the proper constants
> here. Also, please try to use an indentation style consistent with the
> rest of the dll and wine (this goes for the other patches as well).
>
>   
>> + size=(address-pFunction+0x1)*sizeof(DWORD);
>>     
> Why the +1 here? Does it return the size without the end token itself?
> Tests and comments are always helpful there.
>
>
> The following (untested!) implementation looks more reasonable to me:
>
> UINT D3DXGetShaderSize(const DWORD *byte_code)
> {
>     const DWORD *ptr = byte_code;
>
>     if (!ptr) return 0;
>
>     /* Look for the END token, skipping the VERSION token */
>     while (*++ptr != D3DSIO_END) {
>         /* Skip comments */
>         if ((*ptr & D3DSI_OPCODE_MASK) == D3DSIO_COMMENT) {
>             ptr += ((*ptr & D3DSI_COMMENTSIZE_MASK) >> D3DSI_COMMENTSIZE_SHIFT);
>         }
>     }
>
>     /* Return the shader size in bytes, excluding the END token. */
>     return (ptr - (byte_code + 1)) * sizeof(*ptr);
> }
>
>
>   

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 1f829dfdd01058915e0ef05d63579a11129ae0bc.diff
Type: text/x-patch
Size: 1717 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080406/834867d9/attachment-0001.bin 

From hverbeet at gmail.com  Sun Apr  6 15:40:53 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Sun, 6 Apr 2008 22:40:53 +0200
Subject: d3dx9: Implementation of D3DXGetShaderSize 2/3
In-Reply-To: <47F92B8F.5040002@ilidium.com>
References: <47F8036A.5030408@ilidium.com>
	<d658b69e0804060550n1a31505p695b6280332177e6@mail.gmail.com>
	<47F92B8F.5040002@ilidium.com>
Message-ID: <d658b69e0804061340l10d9d20aj6ff56a84a404c712@mail.gmail.com>

On 06/04/2008, Luis Busquets <luis.busquets at ilidium.com> wrote:
> The +1 of the end is because finally address points to the end token. So +1
> is the end token. This function has been tested with all shaders of
> Civilization 4 and has responded successfully.
>
My bad, I misread that as (address-(pFunction+0x1)) instead of
((address-pFunction)+0x1)

> +    while (*address!=D3DVS_END()) {
I do think D3DSIO_END would be more appropriate here.


From chmorgan at gmail.com  Sun Apr  6 15:49:41 2008
From: chmorgan at gmail.com (Chris Morgan)
Date: Sun, 6 Apr 2008 16:49:41 -0400
Subject: appdb needs to list 0.9.47 in the pulldown, please
In-Reply-To: <a71bd89a0804061202u69df1d1co87edc8f8506a2114@mail.gmail.com>
References: <a71bd89a0804061147v71eefcd5lfc39d600b4669fc2@mail.gmail.com>
	<f3f1b91a0804061156q529d417bn304bbc8883d0eacf@mail.gmail.com>
	<a71bd89a0804061202u69df1d1co87edc8f8506a2114@mail.gmail.com>
Message-ID: <f3f1b91a0804061349k498913c8jcd227a94e14a8de3@mail.gmail.com>

On Sun, Apr 6, 2008 at 3:02 PM, Dan Kegel <dank at kegel.com> wrote:
> On Sun, Apr 6, 2008 at 11:56 AM, Chris Morgan <chmorgan at gmail.com> wrote:
>  > The appdb code currently prunes the list to several of the most recent
>  >  versions so people don't submit entries against older or obsolete
>  >  versions.
>
>  Of course.  It's just a question of the right cutoff.
>  It seems reasonable to me to include the version bundled with gutsy,
>  even if it's getting old, because gutsy is so popular.
>

If we wait another 18 days can we ask users of gutsy to upgrade to hardy? ;-)

 If we ask users to put the wine ubuntu repository in their
sources.list file won't that let them continue to keep up with newer
releases without much difficulty?


>
>  >  Is it really useful to have test results submitted such an old version
>  >  when we almost always ask users to upgrade to the latest version in
>  >  the #winehq channel or in bugzilla?
>
>  Perhaps.  Some things did run ok with it, and we have had some
>  regressions since then.
>

If we don't plan on releasing new versions based on the release in
gutsy, 0.9.47, then I think we've got to consider that version to be
obsolete and unsupported. It also doesn't make much sense for us to be
storing test results for older versions except so we can perform
analysis of the results. We can change the wording to be more explicit
about not submitting results from older versions.


>
>  >  We do mention that if their version is older than the listed version
>  >  the user should upgrade. Users that submit results with the wrong or
>  >  old version may mean well but may not be the kind of test results we
>  >  want to rely on.
>
>  Sure, but one goes to market with the users one has, not with the
>  users one wishes one had :-)
>  - Dan
>

I agree, we can't always choose the kind of data we get. It's up to us
to decide which test results to keep and which ones to discard.

Chris


From dank at kegel.com  Sun Apr  6 16:05:10 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 6 Apr 2008 14:05:10 -0700
Subject: appdb needs to list 0.9.47 in the pulldown, please
In-Reply-To: <f3f1b91a0804061349k498913c8jcd227a94e14a8de3@mail.gmail.com>
References: <a71bd89a0804061147v71eefcd5lfc39d600b4669fc2@mail.gmail.com>
	<f3f1b91a0804061156q529d417bn304bbc8883d0eacf@mail.gmail.com>
	<a71bd89a0804061202u69df1d1co87edc8f8506a2114@mail.gmail.com>
	<f3f1b91a0804061349k498913c8jcd227a94e14a8de3@mail.gmail.com>
Message-ID: <a71bd89a0804061405o7dc65871v94df2bea12329507@mail.gmail.com>

On Sun, Apr 6, 2008 at 1:49 PM, Chris Morgan <chmorgan at gmail.com> wrote:
>  >  It seems reasonable to me to include the version bundled with gutsy,
>  >  even if it's getting old, because gutsy is so popular.
>
>  If we wait another 18 days can we ask users of gutsy to upgrade to hardy? ;-)

Of course.

>   If we ask users to put the wine ubuntu repository in their
>  sources.list file won't that let them continue to keep up with newer
>  releases without much difficulty?

All of your suggestions are along the lines "change the user's behavior"
rather than "adapt winehq to the user's behavior".  While all your
suggestions are fine, they don't change the fact that users are
misbehaving because the appdb doesn't allow reports with Gutsy's
version of wine.
This problem will keep happening with future releases of Ubuntu
if we cut off the version of wine too early, as we do now.

>  If we don't plan on releasing new versions based on the release in
>  gutsy, 0.9.47, then I think we've got to consider that version to be
>  obsolete and unsupported.

By your logic, we should not allow any reports against anything
but the latest version of wine.

>  I agree, we can't always choose the kind of data we get. It's up to us
>  to decide which test results to keep and which ones to discard.

Whatever.  I'm tired of discussing this with you.  If the appdb maintainers
agree with me, they'll make the change.  I don't enough to keep arguing.
- Dan


From stefan at codeweavers.com  Sun Apr  6 16:48:45 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sun, 6 Apr 2008 23:48:45 +0200
Subject: [PATCH 03/15] wined3d: In palette9_changed skip check if
	dxVersion <= 7.
In-Reply-To: <47F93B30.2000405@inbox.lv>
References: <47F93B30.2000405@inbox.lv>
Message-ID: <200804062348.45756.stefan@codeweavers.com>

Am Sonntag, 6. April 2008 23:05:52 schrieb Alexander Dorofeyev:
> Stops it from producing misleading messages in apps that don't use d3d8/9
> style palettes.
Is there no other way to do this? In my opinion dxVersion checks are ugly and 
dxVersion should go away


From chmorgan at gmail.com  Sun Apr  6 16:55:56 2008
From: chmorgan at gmail.com (Chris Morgan)
Date: Sun, 6 Apr 2008 17:55:56 -0400
Subject: appdb needs to list 0.9.47 in the pulldown, please
In-Reply-To: <a71bd89a0804061405o7dc65871v94df2bea12329507@mail.gmail.com>
References: <a71bd89a0804061147v71eefcd5lfc39d600b4669fc2@mail.gmail.com>
	<f3f1b91a0804061156q529d417bn304bbc8883d0eacf@mail.gmail.com>
	<a71bd89a0804061202u69df1d1co87edc8f8506a2114@mail.gmail.com>
	<f3f1b91a0804061349k498913c8jcd227a94e14a8de3@mail.gmail.com>
	<a71bd89a0804061405o7dc65871v94df2bea12329507@mail.gmail.com>
Message-ID: <f3f1b91a0804061455u649eca21v7ccaec9efcc702d4@mail.gmail.com>

On Sun, Apr 6, 2008 at 5:05 PM, Dan Kegel <dank at kegel.com> wrote:
> On Sun, Apr 6, 2008 at 1:49 PM, Chris Morgan <chmorgan at gmail.com> wrote:
>  >  >  It seems reasonable to me to include the version bundled with gutsy,
>  >  >  even if it's getting old, because gutsy is so popular.
>  >
>  >  If we wait another 18 days can we ask users of gutsy to upgrade to hardy? ;-)
>
>  Of course.
>
>
>  >   If we ask users to put the wine ubuntu repository in their
>  >  sources.list file won't that let them continue to keep up with newer
>  >  releases without much difficulty?
>
>  All of your suggestions are along the lines "change the user's behavior"
>  rather than "adapt winehq to the user's behavior".  While all your
>  suggestions are fine, they don't change the fact that users are
>  misbehaving because the appdb doesn't allow reports with Gutsy's
>  version of wine.

I'm all for adapting our behavior to better fit with the behavior of
our users. I've spent hundreds of hours working on improving the
appdb.

If there was a good reason stated to accept results for obsoleted
versions then I'd agree with you. In the future I can see a need to
pin certain versions to the available versions list, certainly 1.0
seems like a pretty obvious version to pin to the list for a period of
time.

There are several issues with keeping older test results. We run the
risk of confusing users by showing ratings for Wine releases so old
that the current behavior doesn't match. We can hide these older
versions but why accept them for submission then? If we show them then
we need to consider how to present the ratings so users of newer
versions don't get confused with older versions that come with some
distributions.

By accepting results for older versions we may not be making the user
fully aware that their version is considered to be old.

It's a complex issue that deserves more discussion and may require
more php and ui work to present properly to the user.


>  This problem will keep happening with future releases of Ubuntu
>  if we cut off the version of wine too early, as we do now.
>

I'm a fan of ubuntu, run it on all of my machines etc but that doesn't
automatically mean that test results for older versions are useful. We
are rapidly approaching a 1.0 release and each incremental release has
a wide range of improvements. A user of Gutsy may find it useful to
see test results for 0.9.47 but its likely even more useful for us to
help them upgrade to a version we support, currently the latest
incremental release.


>
>  >  If we don't plan on releasing new versions based on the release in
>  >  gutsy, 0.9.47, then I think we've got to consider that version to be
>  >  obsolete and unsupported.
>
>  By your logic, we should not allow any reports against anything
>  but the latest version of wine.
>

The reason I kept the last several entries on the list was because
some people tend to lag behind in their wine versions. Its
understandable for us to have a window of versions so we can get
reasonably current test results, even if not the most recent test
results. Already the list contains a handful of previous releases,
several months of obsolete versions.


>
>  >  I agree, we can't always choose the kind of data we get. It's up to us
>  >  to decide which test results to keep and which ones to discard.
>
>  Whatever.  I'm tired of discussing this with you.  If the appdb maintainers
>  agree with me, they'll make the change.  I don't enough to keep arguing.
>  - Dan
>

I'm not opposed to a patch that re-adds 0.9.47 version to the list but
I'd like to see a patch that adds a table to keep pinned versions and
php code to manage this list.

Chris


From jerome.gardou at gmail.com  Sun Apr  6 08:37:40 2008
From: jerome.gardou at gmail.com (=?utf-8?q?J=C3=A9r=C3=B4me_Gardou?=)
Date: Sun, 6 Apr 2008 15:37:40 +0200
Subject: ntdll:Add a semi-stub for SystemExecutionState in
	NtPowerInformation
In-Reply-To: <200804052308.59896.jerome.gardou@gmail.com>
References: <200804052308.59896.jerome.gardou@gmail.com>
Message-ID: <200804061537.40814.jerome.gardou@gmail.com>

Le Saturday 05 April 2008 23:08:59, vous avez ?crit?:
> This adds a semi-stub for SystemExecutionState in NtPowerInformation,
> always considering that the user is acting with the computer.

Please ignore this one, I sent the wrong file.


From alexd4 at inbox.lv  Sun Apr  6 17:46:06 2008
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Mon, 07 Apr 2008 01:46:06 +0300
Subject: [PATCH 03/15] wined3d: In palette9_changed skip check if	dxVersion
	<= 7.
In-Reply-To: <200804062348.45756.stefan@codeweavers.com>
References: <47F93B30.2000405@inbox.lv>
	<200804062348.45756.stefan@codeweavers.com>
Message-ID: <47F952AE.1060001@inbox.lv>

Stefan D?singer wrote:
> Am Sonntag, 6. April 2008 23:05:52 schrieb Alexander Dorofeyev:
>> Stops it from producing misleading messages in apps that don't use d3d8/9
>> style palettes.
> Is there no other way to do this? In my opinion dxVersion checks are ugly and 
> dxVersion should go away

Not that I'm aware of. Of course, callers of palette9_changed could do that 
check, but that isn't a meaningful difference. But somewhere it got to be 
determined whether device palettes or per-surface palettes are used, and the one 
and only thing that decides it is the version of directx used.


From actong88 at gmail.com  Sun Apr  6 20:21:27 2008
From: actong88 at gmail.com (Allan Tong)
Date: Sun, 6 Apr 2008 21:21:27 -0400
Subject: [PATCH 14/15] wined3d: Add device->isInDraw checks in
	LoadLocation.
In-Reply-To: <47F93B51.1050508@inbox.lv>
References: <47F93B51.1050508@inbox.lv>
Message-ID: <d75158870804061821k44bfa3aavbe17806d2e5ffea2@mail.gmail.com>

On Sun, Apr 6, 2008 at 5:06 PM, Alexander Dorofeyev <alexd4 at inbox.lv> wrote:
>
>  Prevents calling ActivateContext while holding gl lock, e.g. when
> preloading texture in sampler().

There may be a problem here with drawPrimitive, which calls
LoadLocation before ActivateContext while having isInDraw=TRUE.  If
the primary render target is an offscreen FBO surface, LoadLocation
will follow the SFLAG_INTEXTURE path and it may end up making gl calls
without a context in place.

 - Allan


From austinenglish at gmail.com  Sun Apr  6 21:14:59 2008
From: austinenglish at gmail.com (Austin English)
Date: Sun, 6 Apr 2008 21:14:59 -0500
Subject: appdb needs to list 0.9.47 in the pulldown, please
In-Reply-To: <f3f1b91a0804061455u649eca21v7ccaec9efcc702d4@mail.gmail.com>
References: <a71bd89a0804061147v71eefcd5lfc39d600b4669fc2@mail.gmail.com>
	<f3f1b91a0804061156q529d417bn304bbc8883d0eacf@mail.gmail.com>
	<a71bd89a0804061202u69df1d1co87edc8f8506a2114@mail.gmail.com>
	<f3f1b91a0804061349k498913c8jcd227a94e14a8de3@mail.gmail.com>
	<a71bd89a0804061405o7dc65871v94df2bea12329507@mail.gmail.com>
	<f3f1b91a0804061455u649eca21v7ccaec9efcc702d4@mail.gmail.com>
Message-ID: <b6bb06270804061914w18debe8cqa8d4201064f2958a@mail.gmail.com>

On Sun, Apr 6, 2008 at 4:55 PM, Chris Morgan <chmorgan at gmail.com> wrote:
> On Sun, Apr 6, 2008 at 5:05 PM, Dan Kegel <dank at kegel.com> wrote:
>  > On Sun, Apr 6, 2008 at 1:49 PM, Chris Morgan <chmorgan at gmail.com> wrote:
>  >  >  >  It seems reasonable to me to include the version bundled with gutsy,
>  >  >  >  even if it's getting old, because gutsy is so popular.
>  >

Has anyone considering talking to Canonical about getting a more
recent wine version included in wine? While they understandably don't
want to introduce too new of versions, they also need to take into
account that we release every two weeks, much faster than most other
projects.


From dmitry at codeweavers.com  Sun Apr  6 22:25:47 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Mon, 7 Apr 2008 12:25:47 +0900
Subject: LoadStringW [1/2]
References: <4794545B.4000909@procyongames.com><005101c85c07$b280a180$a600fea9@DMITRY><000601c85c08$f006a440$a600fea9@DMITRY><4794FD3E.2080204@procyongames.com><22821af30801211217g22c09c8bu597659ab11aafff0@mail.gmail.com><479504E4.4080401@procyongames.com><22821af30801211252l30be545cqc9cf37bb4b89451c@mail.gmail.com><47950AEF.9060409@procyongames.com><Pine.LNX.4.62.0804032333300.6745@tvarka.ar.fi.lt><006401c895f9$07c167d0$a600fea9@DMITRY>
	<Pine.LNX.4.62.0804061603190.17765@tvarka.ar.fi.lt>
Message-ID: <001e01c8985f$1449e000$a600fea9@DMITRY>

"Saulius Krasuckas" <saulius2 at ar.fi.lt> wrote:

>> If the regression can be identified by someone able to read the code and 
>> not by a regression test that doesn't matter.
> 
> Could you show me appropriate code lines of LoadStringA and a logic to 
> follow, please?  I am schocked.
> 
> Dmitry, for me your statement is true only in the case of reading original 
> code of appropriate DLL from MS :(

I suspect that you will be shocked even more if someone would say that
something is really wrong out there if there is a need to explain what
this list is about, how the patch review process is going, and which code
is reviewed in the process.

-- 
Dmitry.


From dmitry at codeweavers.com  Sun Apr  6 23:06:13 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Mon, 7 Apr 2008 13:06:13 +0900
Subject: ntoskrnl.exe: [1/2] Implement KeQueryActiveProcessors
References: <1207509909.7210.8.camel@p4>
Message-ID: <010001c89865$03c7e550$a600fea9@DMITRY>

"Detlef Riekenberg" <wine.dev at web.de> wrote:

> +KAFFINITY WINAPI KeQueryActiveProcessors( void )
> +{
> +    DWORD_PTR   AffinityMask;
> +
> +    if (GetProcessAffinityMask( GetCurrentProcess(), &AffinityMask, NULL)) {
> +        return AffinityMask;
> +    }
> +
> +    /* No Idea, what to do, when GetProcessAffinityMask fail.
> +       We use the first Processor */
> +    return 1;
> +}

GetProcessAffinityMask() should never fail for the current process, so there is
no need to add bogus code for that case.

-- 
Dmitry.


From dmitry at codeweavers.com  Sun Apr  6 23:08:17 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Mon, 7 Apr 2008 13:08:17 +0900
Subject: ntoskrnl.exe: [2/2] Implement KeQueryInterruptTime
References: <1207509947.7210.11.camel@p4>
Message-ID: <010101c89865$083a5aa0$a600fea9@DMITRY>

"Detlef Riekenberg" <wine.dev at web.de> wrote:

> +ULONGLONG WINAPI KeQueryInterruptTime( void )
> +{
> +    ULONGLONG   totaltime;
> +
> +    KeQueryTickCount( (LARGE_INTEGER *) &totaltime);
> +    return totaltime;
> +}

Why not have a local variable of type LARGE_INTEGER and return
li.QuadPart ?

-- 
Dmitry.


From alexd4 at inbox.lv  Mon Apr  7 01:30:20 2008
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Mon, 07 Apr 2008 09:30:20 +0300
Subject: [PATCH 14/15] wined3d: Add device->isInDraw checks
	in	LoadLocation.
In-Reply-To: <d75158870804061821k44bfa3aavbe17806d2e5ffea2@mail.gmail.com>
References: <47F93B51.1050508@inbox.lv>
	<d75158870804061821k44bfa3aavbe17806d2e5ffea2@mail.gmail.com>
Message-ID: <47F9BF7C.9020009@inbox.lv>

Oh, you are right. Must be fixed some other way then, I guess, maybe moving 
assignment to isInDraw lower or moving ActivateContext higher. From what I 
understood from Bioshock bug (http://bugs.winehq.org/show_bug.cgi?id=9973), 
moving ActivateContext in drawPrimitive produces bugs in other programs, right? 
Could you add to that bug a short description of what games etc needed to 
reproduce these problems?

Allan Tong wrote:
> On Sun, Apr 6, 2008 at 5:06 PM, Alexander Dorofeyev <alexd4 at inbox.lv> wrote:
>>  Prevents calling ActivateContext while holding gl lock, e.g. when
>> preloading texture in sampler().
> 
> There may be a problem here with drawPrimitive, which calls
> LoadLocation before ActivateContext while having isInDraw=TRUE.  If
> the primary render target is an offscreen FBO surface, LoadLocation
> will follow the SFLAG_INTEXTURE path and it may end up making gl calls
> without a context in place.
> 
>  - Allan



From kai.blin at gmail.com  Mon Apr  7 02:07:25 2008
From: kai.blin at gmail.com (Kai Blin)
Date: Mon, 7 Apr 2008 09:07:25 +0200
Subject: appdb needs to list 0.9.47 in the pulldown, please
In-Reply-To: <b6bb06270804061914w18debe8cqa8d4201064f2958a@mail.gmail.com>
References: <a71bd89a0804061147v71eefcd5lfc39d600b4669fc2@mail.gmail.com>
	<f3f1b91a0804061455u649eca21v7ccaec9efcc702d4@mail.gmail.com>
	<b6bb06270804061914w18debe8cqa8d4201064f2958a@mail.gmail.com>
Message-ID: <200804070907.29375.kai.blin@gmail.com>

On Monday 07 April 2008 04:14:59 Austin English wrote:

> Has anyone considering talking to Canonical about getting a more
> recent wine version included in wine? While they understandably don't
> want to introduce too new of versions, they also need to take into
> account that we release every two weeks, much faster than most other
> projects.

Not going to work. The whole point of a distribution release is to keep the 
versions of the programs stable and just do security fixes. That way, you're 
safe from any potential regression in the programs you're using. I agree that 
Wine tends to release too often for the usual distro release cycle, but I'd 
argue that so far we've not done a too good job about _not_ having 
regressions. So I doubt the distros will upgrade the Wine versions 
post-release.

Cheers,
Kai

-- 
Kai Blin
WorldForge developer  http://www.worldforge.org/
Wine developer        http://wiki.winehq.org/KaiBlin
Samba team member     http://www.samba.org/samba/team/
--
Will code for cotton.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080407/468f7fe5/attachment.pgp 

From fgouget at free.fr  Mon Apr  7 02:53:11 2008
From: fgouget at free.fr (Francois Gouget)
Date: Mon, 7 Apr 2008 09:53:11 +0200 (CEST)
Subject: Proposal: versioning .wine directory
In-Reply-To: <200803302037.56555.stefan@codeweavers.com>
References: <a71bd89a0803300838j438965alaa1af35f50e13e1a@mail.gmail.com>
	<22821af30803301135x3b584ef4j1dc6c2d2574ddb45@mail.gmail.com>
	<b6bb06270803301146t1fc093exda603020e8dfdb9a@mail.gmail.com>
	<200803302037.56555.stefan@codeweavers.com>
Message-ID: <alpine.DEB.1.00.0804070951420.31312@amboise.dolphin>

On Sun, 30 Mar 2008, Stefan D?singer wrote:

> Am Sonntag, 30. M?rz 2008 20:46:08 schrieb Austin English:
> > My comment from the bug:
> > "How about a little file in .wine  or a registry key that is read upon
> > running wine, and should match the current wine version. If it doesn't,
> > call wineprefixcreate (or pop up an error saying that the registry is
> > outdated), which then updates that key to the current wine version.
> > Shouldn't be too much overhead and prevents quite a few problems."
> In the past I've had more problems with wineprefixcreate trashing my registry 
> than I had with outdated registry entries. Especially if you have Internet 
> Explorer or the DirectX SDK or runtime installed running wineprefixcreate has 
> bad side effects.

If that's still the case it's probably because wine.inf overwrites 
registry keys that it shouldn't and then this needs fixing. Otherwise it 
means we cannot do upgrades at all.


-- 
Francois Gouget <fgouget at free.fr>              http://fgouget.free.fr/
            "Lotto: A tax on people who are bad at math." -- unknown
          "Windows: Microsoft's tax on computer illiterates." -- WE7U

From fgouget at free.fr  Mon Apr  7 03:02:28 2008
From: fgouget at free.fr (Francois Gouget)
Date: Mon, 7 Apr 2008 10:02:28 +0200 (CEST)
Subject: Proposal: versioning .wine directory
In-Reply-To: <19e31a080803312157g5fbf318gb8d41edc44b5afe@mail.gmail.com>
References: <a71bd89a0803300838j438965alaa1af35f50e13e1a@mail.gmail.com>
	<47F1AE9D.6020500@gmail.com>
	<19e31a080803312157g5fbf318gb8d41edc44b5afe@mail.gmail.com>
Message-ID: <alpine.DEB.1.00.0804070955280.31312@amboise.dolphin>

On Tue, 1 Apr 2008, Steven Edwards wrote:

> On Mon, Mar 31, 2008 at 11:40 PM, TheBlunderbuss
> <tehblunderbuss at gmail.com> wrote:
> >  I like it, since I already do something like this!
> >  How about a more surreptitious way of marking versions? Maybe a reg key
> >  or other file.
> >  This way, users might not be tempted to rename their ~/.wine and also
> >  keep the 1.0 transition smoother for scripts, say.
> 
> Embedding the full version number maybe including the git ID of the
> source used as a string value in the Wine key should be enough.

Git commitids cannot be used for this purpose because they are not 
ordered. This means you'd have no idea if 
f294dda7498052dd7d3fa69d87cc539fa633217f is a pre-1.0 or not, 5 years 
old or a few minutes old. So you'd never know what to do / tell the user 
just based on the Git commitid.

So including the Git commitid is feasible and maybe even a good idea, 
but its only use would be for developers. Even then it would be better 
if it was embedded in the individual dll's version information as they 
may not all come from the same codebase.

-- 
Francois Gouget <fgouget at free.fr>              http://fgouget.free.fr/
             Research is the transformation of money to knowledge.
            Innovation is the transformation of knowledge to money.
                              -- Dr. Hans Meixner


From stefan at codeweavers.com  Mon Apr  7 03:05:05 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Mon, 7 Apr 2008 10:05:05 +0200
Subject: [PATCH 14/15] wined3d: Add device->isInDraw checks
	=?iso-8859-1?q?in=09LoadLocation=2E?=
In-Reply-To: <47F9BF7C.9020009@inbox.lv>
References: <47F93B51.1050508@inbox.lv>
	<d75158870804061821k44bfa3aavbe17806d2e5ffea2@mail.gmail.com>
	<47F9BF7C.9020009@inbox.lv>
Message-ID: <200804071005.05714.stefan@codeweavers.com>

Am Montag, 7. April 2008 08:30:20 schrieb Alexander Dorofeyev:
> Oh, you are right. Must be fixed some other way then, I guess, maybe moving
> assignment to isInDraw lower or moving ActivateContext higher. From what I
> understood from Bioshock bug (http://bugs.winehq.org/show_bug.cgi?id=9973),
> moving ActivateContext in drawPrimitive produces bugs in other programs,
> right? Could you add to that bug a short description of what games etc
> needed to reproduce these problems?
There are two design issues here:

One is that FindContext, which executes before the wglMakeCurrent call does 
OpenGL calls. In some situations it has to do, e.g. reading the texture from 
a Pbuffer before switching to some other buffer, in some cases it can't, e.g. 
on a thread switch. I am not sure about the solution yet, but maybe we have 
to ActivateContext the old render target in FindContext before reading back 
textures if we find a thread switch and target switch at the same time.

The other issue, and that's the problem with Bioshock, is that ActivateContext 
isn't really aware of the FBO stuff. I've been discussing this with Henri 
some time ago, but we didn't find a solution. The nicest way would be to make 
ActivateContext select tge fbo, color buffer 0 and the depth stencil, and to 
make color buffers 1+ regular states handled in the state table. 
Unfortunately that doesn't work because drivers don't like it if we activate 
an incomplete fbo.



From fgouget at free.fr  Mon Apr  7 03:40:41 2008
From: fgouget at free.fr (Francois Gouget)
Date: Mon, 7 Apr 2008 10:40:41 +0200 (CEST)
Subject: MinGW cross compilation fails for d3dx9_36/tests
In-Reply-To: <19e31a080803281222g10621351x11c51ba81e1ee7cf@mail.gmail.com>
References: <47E8C0FC.2010700@gmail.com>
	<22821af30803250217t702d8cd7if98959c80e236b47@mail.gmail.com>
	<47E8C57C.9030708@gmail.com>
	<22821af30803261142k52502f40mb9a51993fb86593e@mail.gmail.com>
	<47EAA1C0.5050004@gmail.com>
	<78a7dad00803280244y228a3397ubcd6f2952e714335@mail.gmail.com>
	<00b601c890d2$919ac3b0$a600fea9@DMITRY>
	<3f4fd2640803280635t19f23f8eu135353fea418f70@mail.gmail.com>
	<19e31a080803281153u4fbfa11fm76d80446662b5bf4@mail.gmail.com>
	<22821af30803281201m61f97a09g50ab810d0d73b60e@mail.gmail.com>
	<19e31a080803281222g10621351x11c51ba81e1ee7cf@mail.gmail.com>
Message-ID: <alpine.DEB.1.00.0804071039060.31312@amboise.dolphin>

On Fri, 28 Mar 2008, Steven Edwards wrote:

> On Fri, Mar 28, 2008 at 3:01 PM, James Hawkins <truiken at gmail.com> wrote:
> >  What is the process for making this switch?  Do we need to contact
> >  Paul Millar?  The lack of a new winetest is putting a hamper on our
> >  efforts to fix up the tests in Windows.
> 
> There should just be a few rules that need to be changed as far as I
> know. Thats all that was needed for the programs case, I cannot Imagen
> why the tests would be any more complex. If Alexandre has not already
> done so, I'll look at it and submit patches tonight.

Maybe we can have separate targets:
make crosstest    would build PE tests using Wine's headers and libraries
make mingwtest    would build PE tests using MinGW's headers and libraries

This would let us test either configuration.

-- 
Francois Gouget <fgouget at free.fr>              http://fgouget.free.fr/
                         Stolen from an Internet user:
              "f u cn rd ths, u cn gt a gd jb n cmptr prgrmmng !"


From fgouget at free.fr  Mon Apr  7 04:30:56 2008
From: fgouget at free.fr (Francois Gouget)
Date: Mon, 7 Apr 2008 11:30:56 +0200 (CEST)
Subject: appdb needs to list 0.9.47 in the pulldown, please
In-Reply-To: <f3f1b91a0804061455u649eca21v7ccaec9efcc702d4@mail.gmail.com>
References: <a71bd89a0804061147v71eefcd5lfc39d600b4669fc2@mail.gmail.com>
	<f3f1b91a0804061156q529d417bn304bbc8883d0eacf@mail.gmail.com>
	<a71bd89a0804061202u69df1d1co87edc8f8506a2114@mail.gmail.com>
	<f3f1b91a0804061349k498913c8jcd227a94e14a8de3@mail.gmail.com>
	<a71bd89a0804061405o7dc65871v94df2bea12329507@mail.gmail.com>
	<f3f1b91a0804061455u649eca21v7ccaec9efcc702d4@mail.gmail.com>
Message-ID: <alpine.DEB.1.00.0804071124550.31312@amboise.dolphin>

On Sun, 6 Apr 2008, Chris Morgan wrote:
[...]
> I'm all for adapting our behavior to better fit with the behavior of
> our users. I've spent hundreds of hours working on improving the
> appdb.
> 
> If there was a good reason stated to accept results for obsoleted
> versions then I'd agree with you. In the future I can see a need to
> pin certain versions to the available versions list, certainly 1.0
> seems like a pretty obvious version to pin to the list for a period of
> time.

If the cutoff is '0.9.48' (for instance), then maybe we could add a 
'pre-0.9.48' version. That way users looking for '0.9.47' would know 
what to use. This would also let bugzilla maintainers easily spot bugs 
against obsolete versions.

Then when the cutoff evolves to 0.9.53 or whatever we would rename the 
'pre-0.9.48' version to 'pre-0.9.53', etc. If renaming versions is not 
allowed in Bugzilla, then we'd need a more stable name for the catch all 
version, maybe something like 'older versions' or ome such.

The one remaining problem may be to get the version order-right but that 
can probably be solved by getting creative with the version name, e.g. 
'0.9.47.or.older'.


-- 
Francois Gouget <fgouget at free.fr>              http://fgouget.free.fr/
     We are Pentium of Borg. You will be approximated. Division is futile.


From hverbeet at gmail.com  Mon Apr  7 04:34:33 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Mon, 7 Apr 2008 11:34:33 +0200
Subject: wined3d: Check for NULL vertex declarations
In-Reply-To: <200804070203.25962.chris.kcat@gmail.com>
References: <200804070203.25962.chris.kcat@gmail.com>
Message-ID: <d658b69e0804070234r33bf7d53m7e3b98514db2f174@mail.gmail.com>

On 07/04/2008, Chris Robinson <chris.kcat at gmail.com> wrote:
> +    if(!This->stateBlock->vertexDecl) {
> +        WARN("(%p) : Called without a valid vertex buffer set\n", This);
That WARN is misleading.


From stefan at codeweavers.com  Mon Apr  7 04:43:50 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Mon, 7 Apr 2008 11:43:50 +0200
Subject: wined3d: Check for NULL vertex declarations
In-Reply-To: <d658b69e0804070234r33bf7d53m7e3b98514db2f174@mail.gmail.com>
References: <200804070203.25962.chris.kcat@gmail.com>
	<d658b69e0804070234r33bf7d53m7e3b98514db2f174@mail.gmail.com>
Message-ID: <200804071143.51170.stefan@codeweavers.com>

Am Montag, 7. April 2008 11:34:33 schrieb H. Verbeet:
> On 07/04/2008, Chris Robinson <chris.kcat at gmail.com> wrote:
> > +    if(!This->stateBlock->vertexDecl) {
> > +        WARN("(%p) : Called without a valid vertex buffer set\n", This);
>
> That WARN is misleading.
This problem also affects the other draw calls, DrawIndexedPrimitiveUP, 
DrawPrimitive and drawPrimitiveUP. In a certain way it even affects 
DrawRectPatch and DrawTriPatch(when tesselating a new patch)


From stefan at codeweavers.com  Mon Apr  7 04:43:50 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Mon, 7 Apr 2008 11:43:50 +0200
Subject: wined3d: Check for NULL vertex declarations
In-Reply-To: <d658b69e0804070234r33bf7d53m7e3b98514db2f174@mail.gmail.com>
References: <200804070203.25962.chris.kcat@gmail.com>
	<d658b69e0804070234r33bf7d53m7e3b98514db2f174@mail.gmail.com>
Message-ID: <200804071143.51170.stefan@codeweavers.com>

Am Montag, 7. April 2008 11:34:33 schrieb H. Verbeet:
> On 07/04/2008, Chris Robinson <chris.kcat at gmail.com> wrote:
> > +    if(!This->stateBlock->vertexDecl) {
> > +        WARN("(%p) : Called without a valid vertex buffer set\n", This);
>
> That WARN is misleading.
This problem also affects the other draw calls, DrawIndexedPrimitiveUP, 
DrawPrimitive and drawPrimitiveUP. In a certain way it even affects 
DrawRectPatch and DrawTriPatch(when tesselating a new patch)


From stefan at codeweavers.com  Mon Apr  7 04:43:50 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Mon, 7 Apr 2008 11:43:50 +0200
Subject: wined3d: Check for NULL vertex declarations
In-Reply-To: <d658b69e0804070234r33bf7d53m7e3b98514db2f174@mail.gmail.com>
References: <200804070203.25962.chris.kcat@gmail.com>
	<d658b69e0804070234r33bf7d53m7e3b98514db2f174@mail.gmail.com>
Message-ID: <200804071143.51170.stefan@codeweavers.com>

Am Montag, 7. April 2008 11:34:33 schrieb H. Verbeet:
> On 07/04/2008, Chris Robinson <chris.kcat at gmail.com> wrote:
> > +    if(!This->stateBlock->vertexDecl) {
> > +        WARN("(%p) : Called without a valid vertex buffer set\n", This);
>
> That WARN is misleading.
This problem also affects the other draw calls, DrawIndexedPrimitiveUP, 
DrawPrimitive and drawPrimitiveUP. In a certain way it even affects 
DrawRectPatch and DrawTriPatch(when tesselating a new patch)


From dank at kegel.com  Mon Apr  7 06:31:48 2008
From: dank at kegel.com (Dan Kegel)
Date: Mon, 7 Apr 2008 04:31:48 -0700
Subject: appdb needs to list 0.9.47 in the pulldown, please
In-Reply-To: <alpine.DEB.1.00.0804071124550.31312@amboise.dolphin>
References: <a71bd89a0804061147v71eefcd5lfc39d600b4669fc2@mail.gmail.com>
	<f3f1b91a0804061156q529d417bn304bbc8883d0eacf@mail.gmail.com>
	<a71bd89a0804061202u69df1d1co87edc8f8506a2114@mail.gmail.com>
	<f3f1b91a0804061349k498913c8jcd227a94e14a8de3@mail.gmail.com>
	<a71bd89a0804061405o7dc65871v94df2bea12329507@mail.gmail.com>
	<f3f1b91a0804061455u649eca21v7ccaec9efcc702d4@mail.gmail.com>
	<alpine.DEB.1.00.0804071124550.31312@amboise.dolphin>
Message-ID: <a71bd89a0804070431i2c50896dr764445ff4acfe4d7@mail.gmail.com>

On Mon, Apr 7, 2008 at 2:30 AM, Francois Gouget <fgouget at free.fr> wrote:
>  If the cutoff is '0.9.48' (for instance), then maybe we could add a
>  'pre-0.9.48' version.

Sounds too confusing to me, offhand.  I'd rather stick with the current
situation of having a too-early cutoff.

>  That way users looking for '0.9.47' would know
>  what to use. This would also let bugzilla maintainers easily spot bugs
>  against obsolete versions.

You mean appdb...
- Dan


From dank at kegel.com  Mon Apr  7 07:40:14 2008
From: dank at kegel.com (Dan Kegel)
Date: Mon, 7 Apr 2008 05:40:14 -0700
Subject: Fwd: [ubuntu-x] Future of digitizing tablet support in xorg?
In-Reply-To: <20080407044655.GC15327@bryceharrington.org>
References: <a71bd89a0804061105m4156aeb9oba00328186fb31e1@mail.gmail.com>
	<20080407044655.GC15327@bryceharrington.org>
Message-ID: <a71bd89a0804070540s1ad86ebat1ac6cb088a1a49a0@mail.gmail.com>

I ran one of our X issues by Bryce Harrington.  Here's his reply:


---------- Forwarded message ----------
From: Bryce Harrington <bryce at canonical.com>
Date: Sun, Apr 6, 2008 at 9:46 PM
Subject: Re: [ubuntu-x] Future of digitizing tablet support in xorg?
To: Dan Kegel <dank at kegel.com>
Cc: ubuntu-x at lists.ubuntu.com



On Sun, Apr 06, 2008 at 11:05:30AM -0700, Dan Kegel wrote:
 > At the moment, users of digitizing tablet
 > often have to compile x drivers themselves (!), e.g.
 > https://help.ubuntu.com/community/Wacom
 > https://help.ubuntu.com/community/TabletSetupWizardpen
 > which seems rather a throwback to the 90's.
 > And even if they don't have to compile the drivers
 > themselves, it seems users still have to edit xorg.conf.
 >
 > What are the prospects for moving from the current
 > situation to plug'n'play nirvana?
 >
 > I ask because Wine is getting good enough that
 > tablet issues like this are starting to become limiting
 > factors for Photoshop use in Ubuntu.

 For hardy we experimented with the new input hotplugging in xserver 1.4
 (Timo in particular did extensive testing of it).  Unfortunately, the
 new HAL approach with fdi files was proving to be even more complicated
 to configure than editing xorg.conf.  Timo's testing also was turning up
 bugs a bit too readily.  So we decided to hold off on it for now, and
 stick with the devil we know.

 The main deficiency that needs to be addressed is input configuration.
 The input hotplugging seems to work fine with default parameters, but as
 soon as a user wishes to set things to non-default values things get
 complicated.  I think before we can really seriously consider moving to
 it, we need to have some configuration tools.

 So, I would like to see as a start, at least some sort of command line
 tool - the input device equivalent of 'xrandr'.  GUI tools would be nice
 but can come in time.

 In addition, as I understand it, each of the input devices need to be
 updated to take advantage of input hotplug - much as each video driver
 has had to be updated to use Xrandr.  So even though some drivers have
 transitioned, it may behoove us to wait until a larger proportion are
 updated.

 Bryce


From uli at suse.de  Mon Apr  7 04:59:06 2008
From: uli at suse.de (Ulrich Hecht)
Date: Mon, 7 Apr 2008 11:59:06 +0200
Subject: WINEDLLPATH, ddiwrapper,
	msvcrt40 (Re: wine based win32 printer drivers)
In-Reply-To: <780857.19559.qm@web23108.mail.ird.yahoo.com>
References: <780857.19559.qm@web23108.mail.ird.yahoo.com>
Message-ID: <200804071159.06739.uli@suse.de>

Hi!

On Saturday 05 April 2008, Hin-Tak Leung wrote:
> 2) (to uli and Till) - do you mind if I put a mod/update of ddiwrapper
> out publicly, or uli can release a new one that works with current
> wine?

Hand it over, and I'll put it on the FTP server and update our package. 

CU
Uli

-- 
SUSE LINUX Products GmbH, GF: Markus Rex, HRB 16746 (AG N?rnberg)


From hverbeet at gmail.com  Mon Apr  7 08:44:14 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Mon, 7 Apr 2008 15:44:14 +0200
Subject: d3dx8 :Fix D3DXCreateMatrixStack
In-Reply-To: <5f9140a20804070031g3198085ewf2f70bc194a2a1ab@mail.gmail.com>
References: <5f9140a20804070031g3198085ewf2f70bc194a2a1ab@mail.gmail.com>
Message-ID: <d658b69e0804070644i56884aeap3762023ffba7df8a@mail.gmail.com>

On 07/04/2008, David Adam <david.adam.cnrs at gmail.com> wrote:
>
The commit comment for this patch is rather non-descriptive... what is
this supposed to fix?
An array based stack seems more appropriate than a list based one for
ID3DXMATRIXStack, why change that?


From tony.wasserka at freenet.de  Mon Apr  7 10:22:38 2008
From: tony.wasserka at freenet.de (tony.wasserka at freenet.de)
Date: Mon, 07 Apr 2008 17:22:38 +0200
Subject: d3dx8 :Fix D3DXCreateMatrixStack
Message-ID: <E1JitB8-0006fE-OI@www13.emo.freenet-rz.de>

> The commit comment for this patch is rather non-descriptive... what is
> this supposed to fix?
> An array based stack seems more appropriate than a list based one for
> ID3DXMATRIXStack, why change that?

I think so, too (after taking a closer look at the interface documentation at msdn).
Though it ain't really a good argument, but msdn gives a code example
where they show that they use arrays internally:

http://msdn2.microsoft.com/en-us/library/bb174057(VS.85).aspx
m_pstack[m_currentPos] = m_pstack[m_currentPos] * (*pMat);





Unbegrenzter Speicher, Top-Spamschutz, 120 SMS und eigene E-MailDomain inkl.
http://office.freenet.de/dienste/emailoffice/produktuebersicht/power/mail/index.html



From hverbeet at gmail.com  Mon Apr  7 11:08:35 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Mon, 7 Apr 2008 18:08:35 +0200
Subject: d3dx8: D3DXCreateMatrix
In-Reply-To: <5f9140a20804070857x66fcb39dnd61ae52d8f41210c@mail.gmail.com>
References: <5f9140a20804070857x66fcb39dnd61ae52d8f41210c@mail.gmail.com>
Message-ID: <d658b69e0804070908r4ebc59f1s4fe8d7df4b3c4770@mail.gmail.com>

On 07/04/2008, David Adam <david.adam.cnrs at gmail.com> wrote:
> I agree that the good implementation is with array.
>
> The bad thing is that we must bound the size of the array ourself. I think
> that a size of 64 or 128 for the array is enough, right?
>
Well no, you keep track of the array size and grow it when it's too
small when doing a push.


From tony.wasserka at freenet.de  Mon Apr  7 11:46:25 2008
From: tony.wasserka at freenet.de (tony.wasserka at freenet.de)
Date: Mon, 07 Apr 2008 18:46:25 +0200
Subject: d3dx8: D3DXCreateMatrixStack
Message-ID: <E1JiuUD-0002aL-US@www15.emo.freenet-rz.de>

> Well no, you keep track of the array size and grow it when it's too
> small when doing a push.

i.e. HeapReAlloc
http://msdn2.microsoft.com/en-us/library/aa366704(VS.85).aspx

You may optimize that if you allocate space for 2 or so matrices at once,
as it decreases the number of HeapReAlloc calls. However, for a basic
implementation this isn't relevant, yet.











From david.adam.cnrs at gmail.com  Mon Apr  7 10:57:18 2008
From: david.adam.cnrs at gmail.com (David Adam)
Date: Mon, 7 Apr 2008 17:57:18 +0200
Subject: d3dx8: D3DXCreateMatrix
Message-ID: <5f9140a20804070857x66fcb39dnd61ae52d8f41210c@mail.gmail.com>

I agree that the good implementation is with array.

The bad thing is that we must bound the size of the array ourself. I think
that a size of 64 or 128 for the array is enough, right?

The advantage of a list is that we do not need to take care about the size.

David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080407/66374a19/attachment.htm 

From htl10 at users.sourceforge.net  Mon Apr  7 13:02:02 2008
From: htl10 at users.sourceforge.net (Hin-Tak Leung)
Date: Mon, 7 Apr 2008 18:02:02 +0000 (GMT)
Subject: a proposed fix for bug 11690 concerning hhctrl.ocx
Message-ID: <421448.94978.qm@web23114.mail.ird.yahoo.com>

Hi Jacek and James - according to git, you two are the ones last working on the part 
of code which I have a possible fix for bug 11690 (see the bug report for somebody 
tested okay something like this), so I'd like to see what you think of this patch, specially (and others can chip in as well...) Here is what I think:

NavigateToUrl() in hhctrl.ocx/help.c is only used by the HH_HELP_CONTEXT case in HtmpHelpW() in hhctrl.ocx/hhctrl.c - I think in some circumstances, it may return a full url, but in the case of bug 11690, it returns a "relative" one inside the same CHM,
so the code in NavigateToUrl() should drop through to look up in chm. The top part of
NavigateToUrl() is really wrong because it assumes a IWebbrowser_navigate would fail
on a relative url and drop through, but the way I see it, Iwebbrower_navigate should return the status of whether talking to IE/gecko is successful, not whether they gets "404 not found".

I have a few questions for you two:
1) is there any known case where HH_HELP_CONTEXT returns a fully formed URL? (i.e. if 
this change is committed, it is going to break something else?)

2) Since NavigateToUrl is only used once (and it needs to drop through to NavigateToChm() in most cases, pending your answer question 1), wouldn't it make sense
to just remove it?

Thanks,
Hin-Tak 


      ___________________________________________________________ 
Yahoo! For Good helps you make a difference  

http://uk.promotions.yahoo.com/forgood/


From htl10 at users.sourceforge.net  Mon Apr  7 13:41:47 2008
From: htl10 at users.sourceforge.net (Hin-Tak Leung)
Date: Mon, 7 Apr 2008 18:41:47 +0000 (GMT)
Subject: a proposed fix for bug 11690 concerning hhctrl.ocx
Message-ID: <75057.76372.qm@web23109.mail.ird.yahoo.com>

apologies - there was a typo in that patch - should be looking for "://"
rather than "::/" . Otherwise my questions are the same.


--- On Mon, 7/4/08, Hin-Tak Leung <htl10 at users.sourceforge.net> wrote:

> From: Hin-Tak Leung <htl10 at users.sourceforge.net>
> Subject: a proposed fix for bug 11690 concerning hhctrl.ocx
> To: jacek at codeweavers.com, truiken at gmail.com
> Cc: wine-devel at winehq.org
> Date: Monday, 7 April, 2008, 7:02 PM
> Hi Jacek and James - according to git, you two are the ones
> last working on the part 
> of code which I have a possible fix for bug 11690 (see the
> bug report for somebody 
> tested okay something like this), so I'd like to see
> what you think of this patch, specially (and others can
> chip in as well...) Here is what I think:
> 
> NavigateToUrl() in hhctrl.ocx/help.c is only used by the
> HH_HELP_CONTEXT case in HtmpHelpW() in hhctrl.ocx/hhctrl.c
> - I think in some circumstances, it may return a full url,
> but in the case of bug 11690, it returns a
> "relative" one inside the same CHM,
> so the code in NavigateToUrl() should drop through to look
> up in chm. The top part of
> NavigateToUrl() is really wrong because it assumes a
> IWebbrowser_navigate would fail
> on a relative url and drop through, but the way I see it,
> Iwebbrower_navigate should return the status of whether
> talking to IE/gecko is successful, not whether they gets
> "404 not found".
> 
> I have a few questions for you two:
> 1) is there any known case where HH_HELP_CONTEXT returns a
> fully formed URL? (i.e. if 
> this change is committed, it is going to break something
> else?)
> 
> 2) Since NavigateToUrl is only used once (and it needs to
> drop through to NavigateToChm() in most cases, pending your
> answer question 1), wouldn't it make sense
> to just remove it?
> 
> Thanks,
> Hin-Tak 
> 
> 
>      
> ___________________________________________________________
> 
> Yahoo! For Good helps you make a difference  
> 
> http://uk.promotions.yahoo.com/forgood/


      ___________________________________________________________ 
Yahoo! For Good helps you make a difference  

http://uk.promotions.yahoo.com/forgood/


From wine.dev at web.de  Mon Apr  7 14:18:41 2008
From: wine.dev at web.de (Detlef Riekenberg)
Date: Mon, 07 Apr 2008 21:18:41 +0200
Subject: ntoskrnl.exe: [2/2][try 2] Implement KeQueryInterruptTime
In-Reply-To: <010101c89865$083a5aa0$a600fea9@DMITRY>
References: <1207509947.7210.11.camel@p4>
	<010101c89865$083a5aa0$a600fea9@DMITRY>
Message-ID: <1207595921.7208.17.camel@p4>

Updated with the hints from Dmitry:

On Mo, 2008-04-07 at 13:08 +0900, Dmitry Timoshkov wrote:
> Why not have a local variable of type LARGE_INTEGER and return
> li.QuadPart ? 

Thanks.


Changelog:
ntoskrnl.exe: Implement KeQueryInterruptTime



-- 
 
By by ... Detlef

-------------- next part --------------


From wine.dev at web.de  Mon Apr  7 14:15:46 2008
From: wine.dev at web.de (Detlef Riekenberg)
Date: Mon, 7 Apr 2008 21:15:46 +0200
Subject: [PATCH] ntoskrnl.exe: Implement KeQueryInterruptTime
Message-ID: <mailman.343.1207595943.3731.wine-devel@winehq.org>

---
 dlls/ntoskrnl.exe/ntoskrnl.c        |   15 +++++++++++++++
 dlls/ntoskrnl.exe/ntoskrnl.exe.spec |    2 +-
 2 files changed, 16 insertions(+), 1 deletions(-)

diff --git a/dlls/ntoskrnl.exe/ntoskrnl.c b/dlls/ntoskrnl.exe/ntoskrnl.c
index cd155f7..cf1603a 100644
--- a/dlls/ntoskrnl.exe/ntoskrnl.c
+++ b/dlls/ntoskrnl.exe/ntoskrnl.c
@@ -529,6 +529,21 @@ KAFFINITY WINAPI KeQueryActiveProcessors( void )
 }
 
 
+/**********************************************************************
+ *           KeQueryInterruptTime   (NTOSKRNL.EXE.@)
+ *
+ * Return the interrupt time count
+ *
+ */
+ULONGLONG WINAPI KeQueryInterruptTime( void )
+{
+    LARGE_INTEGER totaltime;
+
+    KeQueryTickCount(&totaltime);
+    return totaltime.QuadPart;
+}
+
+
 /***********************************************************************
  *           KeQuerySystemTime   (NTOSKRNL.EXE.@)
  */
diff --git a/dlls/ntoskrnl.exe/ntoskrnl.exe.spec b/dlls/ntoskrnl.exe/ntoskrnl.exe.spec
index dbab0fa..3aef928 100644
--- a/dlls/ntoskrnl.exe/ntoskrnl.exe.spec
+++ b/dlls/ntoskrnl.exe/ntoskrnl.exe.spec
@@ -570,7 +570,7 @@
 @ stub KeProfileInterruptWithSource
 @ stub KePulseEvent
 @ stdcall KeQueryActiveProcessors()
-@ stub KeQueryInterruptTime
+@ stdcall KeQueryInterruptTime()
 @ stub KeQueryPriorityThread
 @ stub KeQueryRuntimeThread
 @ stdcall KeQuerySystemTime(ptr)
-- 
1.5.3.6


--=-oFvDd6DcI7KSHqULwGWS--



From xixsimplicityxix at gmail.com  Mon Apr  7 16:05:02 2008
From: xixsimplicityxix at gmail.com (John Klehm)
Date: Mon, 7 Apr 2008 16:05:02 -0500
Subject: appDB: Nice URLs live demo and code review
Message-ID: <78a7dad00804071405u1e227840r37c45d7f839b9c85@mail.gmail.com>

Give nice urls a whirl at:
http://appdb.klehm.net/app/"yoursearchtermhere"

Search Examples:
http://appdb.klehm.net/app/adobe
http://appdb.klehm.net/app/visual

Direct Link Examples:
http://appdb.klehm.net/app/photoshop
http://appdb.klehm.net/app/command-conquer-red-alert-2

See the nice urls being used internally:
http://appdb.klehm.net/appbrowse.php?iCatId=5


Right now as it is I have it indexing only the app family names; no
versions or vendors get any love.

There is one piece of functionality missing before this can go in and
that is to do an index of a new record upon creation.

If anyone wants to test just apply the patch set and then flip
APPDB_ENABLE_NICE_URLS_INDEXER to true and then run: runIndexer.php.
Be sure to flip enable indexer back to false before doing anything
else =P.

You also need to set allow_url_fopen = On in your php.ini.
If this is deemed to be unacceptable then we have to functionalize the
objectManager.php file so matchByVerbAndTerm can generate similar
output.  Using url fopen allows easiest integration.


After that you should be good to go to test.

Essentially less terms will work better and the matching "nice" name
depends entirely upon whatever the maintainer entered for the app
family name.

Let me know if any changes need be made otherwise ill send it in later
this week.

Regards,
John Klehm
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: 0001-htaccess-enable-rewrite-engine-and-provide-rule.patch.txt
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20080407/a7c6e2da/attachment-0007.txt 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: 0002-config.php-Add-global-switches-for-nice-urls-fu.patch.txt
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20080407/a7c6e2da/attachment-0008.txt 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: 0003-include-nice_urls.php-Util-functions-for-nice-u.patch.txt
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20080407/a7c6e2da/attachment-0009.txt 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: 0004-runIndexer.php-Script-that-indexes-existing-dat.patch.txt
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20080407/a7c6e2da/attachment-0010.txt 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: 0005-matchByVerbAndTerm.php-view-that-calls-into-the.patch.txt
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20080407/a7c6e2da/attachment-0011.txt 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: 0006-apidb.sql-Add-search-index-table.patch.txt
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20080407/a7c6e2da/attachment-0012.txt 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: 0007-include-application.php-if-nice-urls-are-on-the.patch.txt
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20080407/a7c6e2da/attachment-0013.txt 

From hintak_leung at yahoo.co.uk  Mon Apr  7 13:09:09 2008
From: hintak_leung at yahoo.co.uk (Hin-Tak Leung)
Date: Mon, 7 Apr 2008 18:09:09 +0000 (GMT)
Subject: a proposed fix for bug 11690 concerning hhctrl.ocx
Message-ID: <909850.98444.qm@web23112.mail.ird.yahoo.com>

apologies - there was a typo in that patch - should be looking for "://"
rather than "::/" . Otherwise my questions are the same.

--- On Mon, 7/4/08, Hin-Tak Leung <htl10 at users.sourceforge.net> wrote:

> From: Hin-Tak Leung <htl10 at users.sourceforge.net>
> Subject: a proposed fix for bug 11690 concerning hhctrl.ocx
> To: jacek at codeweavers.com, truiken at gmail.com
> Cc: wine-devel at winehq.org
> Date: Monday, 7 April, 2008, 7:02 PM
> Hi Jacek and James - according to git, you two are the ones
> last working on the part 
> of code which I have a possible fix for bug 11690 (see the
> bug report for somebody 
> tested okay something like this), so I'd like to see
> what you think of this patch, specially (and others can
> chip in as well...) Here is what I think:
> 
> NavigateToUrl() in hhctrl.ocx/help.c is only used by the
> HH_HELP_CONTEXT case in HtmpHelpW() in hhctrl.ocx/hhctrl.c
> - I think in some circumstances, it may return a full url,
> but in the case of bug 11690, it returns a
> "relative" one inside the same CHM,
> so the code in NavigateToUrl() should drop through to look
> up in chm. The top part of
> NavigateToUrl() is really wrong because it assumes a
> IWebbrowser_navigate would fail
> on a relative url and drop through, but the way I see it,
> Iwebbrower_navigate should return the status of whether
> talking to IE/gecko is successful, not whether they gets
> "404 not found".
> 
> I have a few questions for you two:
> 1) is there any known case where HH_HELP_CONTEXT returns a
> fully formed URL? (i.e. if 
> this change is committed, it is going to break something
> else?)
> 
> 2) Since NavigateToUrl is only used once (and it needs to
> drop through to NavigateToChm() in most cases, pending your
> answer question 1), wouldn't it make sense
> to just remove it?
> 
> Thanks,
> Hin-Tak 
> 
> 
>      
> ___________________________________________________________
> 
> Yahoo! For Good helps you make a difference  
> 
> http://uk.promotions.yahoo.com/forgood/


      ___________________________________________________________ 
Yahoo! For Good helps you make a difference  

http://uk.promotions.yahoo.com/forgood/


From chmorgan at gmail.com  Mon Apr  7 16:41:01 2008
From: chmorgan at gmail.com (Chris Morgan)
Date: Mon, 7 Apr 2008 17:41:01 -0400
Subject: appDB: Nice URLs live demo and code review
In-Reply-To: <78a7dad00804071405u1e227840r37c45d7f839b9c85@mail.gmail.com>
References: <78a7dad00804071405u1e227840r37c45d7f839b9c85@mail.gmail.com>
Message-ID: <f3f1b91a0804071441p22999575j70c27ae3303671a1@mail.gmail.com>

Hey John.

Looks like you've gotten the nice urls working, great job man. It will
be great to have this before 1.0 is shipped since it will make our
urls a lot nicer looking.

I had a few comments about the code changes. You don't follow the
variable naming convention of the appdb. We have some prefixes for
variables that we use to keep the types of variables straight, you can
find these in the coding standards file in the root of the appdb tree.

The code in 0005-matchByVerbAndTerm.php-view-that-calls-into-the.patch.txt
looks like it is using query_appdb() to perform a direct query. The
indexing code also appears to do this. We prefer using the query
wrapper function query_parameters() as this performs escaping of input
parameters and helps to reduce the possibility of sql injection
vulnerabilities.

I noticed the code to perform the grouped inserts. What is the
performance difference between perform the inserts individually vs.
grouped together? If we run the indexer daily and its relatively quick
we may be able to drop the complexity of worrying about how many
inserts we can group together.

0005-matchByVerbAndTerm.php-view-that-calls-into-the.patch.txt appears
to be generating output for display. It would be useful to have some
comments at the head of the file to describe what the file is used for
and why it would need to conditionally output lists when don't find a
object page match.

Thanks,
Chris




On Mon, Apr 7, 2008 at 5:05 PM, John Klehm <xixsimplicityxix at gmail.com> wrote:
> Give nice urls a whirl at:
>  http://appdb.klehm.net/app/"yoursearchtermhere"
>
>  Search Examples:
>  http://appdb.klehm.net/app/adobe
>  http://appdb.klehm.net/app/visual
>
>  Direct Link Examples:
>  http://appdb.klehm.net/app/photoshop
>  http://appdb.klehm.net/app/command-conquer-red-alert-2
>
>  See the nice urls being used internally:
>  http://appdb.klehm.net/appbrowse.php?iCatId=5
>
>
>  Right now as it is I have it indexing only the app family names; no
>  versions or vendors get any love.
>
>  There is one piece of functionality missing before this can go in and
>  that is to do an index of a new record upon creation.
>
>  If anyone wants to test just apply the patch set and then flip
>  APPDB_ENABLE_NICE_URLS_INDEXER to true and then run: runIndexer.php.
>  Be sure to flip enable indexer back to false before doing anything
>  else =P.
>
>  You also need to set allow_url_fopen = On in your php.ini.
>  If this is deemed to be unacceptable then we have to functionalize the
>  objectManager.php file so matchByVerbAndTerm can generate similar
>  output.  Using url fopen allows easiest integration.
>
>
>  After that you should be good to go to test.
>
>  Essentially less terms will work better and the matching "nice" name
>  depends entirely upon whatever the maintainer entered for the app
>  family name.
>
>  Let me know if any changes need be made otherwise ill send it in later
>  this week.
>
>  Regards,
>  John Klehm
>
>
>
>


From actong88 at gmail.com  Mon Apr  7 16:54:03 2008
From: actong88 at gmail.com (Allan Tong)
Date: Mon, 7 Apr 2008 17:54:03 -0400
Subject: [PATCH 14/15] wined3d: Add device->isInDraw checks in
	LoadLocation.
In-Reply-To: <47F9BF7C.9020009@inbox.lv>
References: <47F93B51.1050508@inbox.lv>
	<d75158870804061821k44bfa3aavbe17806d2e5ffea2@mail.gmail.com>
	<47F9BF7C.9020009@inbox.lv>
Message-ID: <d75158870804071454p4e9cd5c8u44c0dc719ff6f2e5@mail.gmail.com>

On Mon, Apr 7, 2008 at 2:30 AM, Alexander Dorofeyev <alexd4 at inbox.lv> wrote:
> Oh, you are right. Must be fixed some other way then, I guess, maybe moving
> assignment to isInDraw lower or moving ActivateContext higher. From what I
> understood from Bioshock bug (http://bugs.winehq.org/show_bug.cgi?id=9973),
> moving ActivateContext in drawPrimitive produces bugs in other programs,
> right? Could you add to that bug a short description of what games etc
> needed to reproduce these problems?

I added a comment to the bug, but I'm afraid I don't really know the
details about how to reproduce the problem as I never experienced it.
I think Stefan was the one who mentioned the rendering problems in HL2
Lost Coast, so maybe he can give you more details?

On another note, what are the thoughts about leaving these
ActivateContext calls the way they are now?  As things currently
stand, a lot of these calls are only interested in making sure there
is an active gl context by doing ActivateContext(device,
device->lastActiveRenderTarget, CTXUSAGE_RESOURCELOAD).  This is
essentially a NOP if there was a previous call to ActivateContext, so
if you have something like:

ActivateContext(device, target, usage);
...
ENTER_GL();
...
ActivateContext(device, lastActiveRenderTarget, CTXUSAGE_RESOURCELOAD);
...
LEAVE_GL();


the second ActivateContext should be harmless, even if it's not ideal
from a design standpoint.

 - Allan


From ken at codeweavers.com  Mon Apr  7 17:18:30 2008
From: ken at codeweavers.com (Ken Thomases)
Date: Mon, 7 Apr 2008 17:18:30 -0500
Subject: Alexandre Julliard : winex11: Fix handling of property sizes for
	64-bit platforms.
In-Reply-To: <E1Jipry-0000po-OY@wine.codeweavers.com>
References: <E1Jipry-0000po-OY@wine.codeweavers.com>
Message-ID: <4E48F8CB-620B-4BAB-9461-FB1374FC368D@codeweavers.com>

On Apr 7, 2008, at 6:50 AM, Alexandre Julliard wrote:
> Module: wine
> Branch: master
> Commit: 3bfa90eedafc9bd2faf9bc421caa172547e8ddd6
> URL:    http://source.winehq.org/git/wine.git/? 
> a=commit;h=3bfa90eedafc9bd2faf9bc421caa172547e8ddd6
>
> Author: Alexandre Julliard <julliard at winehq.org>
> Date:   Mon Apr  7 11:41:54 2008 +0200
>
> winex11: Fix handling of property sizes for 64-bit platforms.
>
> diff --git a/dlls/winex11.drv/clipboard.c b/dlls/winex11.drv/ 
> clipboard.c
> index 2996857..2404a71 100644
> --- a/dlls/winex11.drv/clipboard.c
> +++ b/dlls/winex11.drv/clipboard.c
> @@ -1902,8 +1902,8 @@ static int X11DRV_CLIPBOARD_QueryAvailableData 
> (LPCLIPBOARDINFO lpcbinfo)
>          * The TARGETS property should have returned us a list of  
> atoms
>          * corresponding to each selection target format supported.
>          */
> -       if (atype == XA_ATOM || atype == x11drv_atom(TARGETS))
> -           X11DRV_CLIPBOARD_InsertSelectionProperties(display,  
> targetList, (cSelectionTargets * aformat / (8 * sizeof(Atom))));
> +       if (aformat == 32 && (atype == XA_ATOM || atype ==  
> x11drv_atom(TARGETS)))
> +           X11DRV_CLIPBOARD_InsertSelectionProperties(display,  
> targetList, cSelectionTargets);
>
>         /* Free the list of targets */
>         wine_tsx11_lock();

This appears to revert a30327afef7b08d1aac1943ded64ee363a61c537.   
That commit worked around a quartz-wm bug where it responds to the  
TARGETS query with a format of 8.

-Ken


From xixsimplicityxix at gmail.com  Mon Apr  7 17:35:45 2008
From: xixsimplicityxix at gmail.com (John Klehm)
Date: Mon, 7 Apr 2008 17:35:45 -0500
Subject: appDB: Nice URLs live demo and code review
In-Reply-To: <f3f1b91a0804071441p22999575j70c27ae3303671a1@mail.gmail.com>
References: <78a7dad00804071405u1e227840r37c45d7f839b9c85@mail.gmail.com>
	<f3f1b91a0804071441p22999575j70c27ae3303671a1@mail.gmail.com>
Message-ID: <78a7dad00804071535r75c3bc5fxc97513666be3419c@mail.gmail.com>

On Mon, Apr 7, 2008 at 4:41 PM, Chris Morgan <chmorgan at gmail.com> wrote:
> Hey John.
>
>  Looks like you've gotten the nice urls working, great job man. It will
>  be great to have this before 1.0 is shipped since it will make our
>  urls a lot nicer looking.
>
>  I had a few comments about the code changes. You don't follow the
>  variable naming convention of the appdb. We have some prefixes for
>  variables that we use to keep the types of variables straight, you can
>  find these in the coding standards file in the root of the appdb tree.
>

Right, oops.

>  The code in 0005-matchByVerbAndTerm.php-view-that-calls-into-the.patch.txt
>  looks like it is using query_appdb() to perform a direct query. The
>  indexing code also appears to do this. We prefer using the query
>  wrapper function query_parameters() as this performs escaping of input
>  parameters and helps to reduce the possibility of sql injection
>  vulnerabilities.
>

Well I can certainly use that.  For the params I do call
appdb_escape_query => calls mysql_real_escape_string which I had
thought was the "your injects stop here" escaping func =P

>  I noticed the code to perform the grouped inserts. What is the
>  performance difference between perform the inserts individually vs.
>  grouped together? If we run the indexer daily and its relatively quick
>  we may be able to drop the complexity of worrying about how many
>  inserts we can group together.
>
Well the runIndexer.php is just a one time thing to create the intial
index. If it were run twice there would be doubles of every previous
entry.  Once we have it for the existing data any new data can be
indexed when its state becomes 'accepted' or however the add new app
flow goes.  I have not implemented the "add index values on data
creation" functionality yet though.

Regarding multiple inserts I think this is what was in my head when I
wrote that:

http://dev.mysql.com/doc/refman/5.0/en/insert-speed.html
Right where it reads "You can use the following methods to speed up inserts"

If the multiple inserts are a concern its easy to run them one at a
time just set the config switch APPDB_MYSQL_MAX_INSERTS_PER_QUERY to 1
in the config.php file.

>  0005-matchByVerbAndTerm.php-view-that-calls-into-the.patch.txt appears
>  to be generating output for display. It would be useful to have some
>  comments at the head of the file to describe what the file is used for
>  and why it would need to conditionally output lists when don't find a
>  object page match.
>

Sure Ill write out the code paths in comments at the top, that file
does do a bit.

Thanks for the feedback! =))

John


From alexd4 at inbox.lv  Mon Apr  7 17:35:14 2008
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Tue, 08 Apr 2008 01:35:14 +0300
Subject: [PATCH 14/15] wined3d: Add device->isInDraw checks
	in	LoadLocation.
In-Reply-To: <d75158870804071454p4e9cd5c8u44c0dc719ff6f2e5@mail.gmail.com>
References: <47F93B51.1050508@inbox.lv>	<d75158870804061821k44bfa3aavbe17806d2e5ffea2@mail.gmail.com>	<47F9BF7C.9020009@inbox.lv>
	<d75158870804071454p4e9cd5c8u44c0dc719ff6f2e5@mail.gmail.com>
Message-ID: <47FAA1A2.1030704@inbox.lv>

There's a little problem with consistency about these things. In various related 
routines and paths, there were (and still are) both places that check isInDraw 
and places that don't check it. read_from_framebuffer and 
IWineD3DSurfaceImpl_BindTexture that can be called from LoadLocation are 
examples of each kind. Some kind of single scheme would make it easier to 
follow. Also even NOP ActivateContext(device, lastActiveRenderTarget, 
CTXUSAGE_RESOURCELOAD) create some false positives when using debug traces to 
identify potential problem places where ActivateContext is used inside 
ENTER_GL/LEAVE_GL.

On the other hand, it is pretty tricky. Also Stefan believes adding isInDraw 
checks everywhere isn't especially nice, but ultimately to prevent all 
situations of ActivateContext inside ENTER_GL/LEAVE_GL  with isInDraw approach 
this would've to be added in more places. I'm not sure about this myself, 
perhaps I'll better not hurry with it and some better ideas may come.

Allan Tong wrote:
> I added a comment to the bug, but I'm afraid I don't really know the
> details about how to reproduce the problem as I never experienced it.
> I think Stefan was the one who mentioned the rendering problems in HL2
> Lost Coast, so maybe he can give you more details?
> 
> On another note, what are the thoughts about leaving these
> ActivateContext calls the way they are now?  As things currently
> stand, a lot of these calls are only interested in making sure there
> is an active gl context by doing ActivateContext(device,
> device->lastActiveRenderTarget, CTXUSAGE_RESOURCELOAD).  This is
> essentially a NOP if there was a previous call to ActivateContext, so
> if you have something like:
> 
> ActivateContext(device, target, usage);
> ...
> ENTER_GL();
> ...
> ActivateContext(device, lastActiveRenderTarget, CTXUSAGE_RESOURCELOAD);
> ...
> LEAVE_GL();
> 
> 
> the second ActivateContext should be harmless, even if it's not ideal
> from a design standpoint.
> 
>  - Allan



From smoki00790 at gmail.com  Mon Apr  7 18:37:36 2008
From: smoki00790 at gmail.com (=?ISO-8859-2?Q?Milan_Kosti=E6?=)
Date: Tue, 8 Apr 2008 01:37:36 +0200
Subject: GL_ATI_fragment_shader and GL_INVALID 0x501, 0x502
Message-ID: <e1d9e62c0804071637n76680520ge942d21e4bf8f81f@mail.gmail.com>

 Ok i'm tested wine and his new GL_ATI_fragment_shader support with
9250 card nad Mesa/DRI driver. Now env bumpmaping and dot3 tests in
3DMark2001 seems to work good, but in car test high ground texture is
black. In DungeonSiege2 i disabled ps in winecfg, because it has same
problem (and more) flickering and black textureon the ground (river
water not show, but on sea it has...). With Painkiller, nothing helps
to start game (disabled ps in winecfg not help), only solution is to
change textured units in driconf from 6 to 5 (this disable
GL_ATI_fragment_shader in driver). I check also NFS: Hot Pursuit2, in
wine-0.58> (this is from some earlier versions, but problem is same)
it has these fixmes:

 fixme:d3d_texture:IWineD3DBaseTextureImpl_ApplyStateChanges
>>>>>>>>>>>>>>>>> GL_INVALID_VALUE (0x501) from glTexParameteri
GL_TEXTURE_MAX_ANISOTROPY_EXT ... @ basetexture.c / 463
 fixme:d3d:get_src_and_opr Unhandled texture argWINED3DTA_SPECULAR

 and now:

 fixme:d3d_texture:IWineD3DBaseTextureImpl_ApplyStateChanges
>>>>>>>>>>>>>>>>> GL_INVALID_VALUE (0x501) from glTexParameteri
GL_TEXTURE_MAX_ANISOTROPY_EXT ... @ basetexture.c / 488
 fixme:d3d_shader:shader_arb_generate_vshader HW VertexShader Error at
position 499: "1046: '.' expected but ';' found"
 fixme:d3d_shader:gen_ati_shader >>>>>>>>>>>>>>>>>
GL_INVALID_OPERATION (0x502) from GL_EXTCALL(glEndFragmentShaderATI())
@ ati_fragment_shader.c / 774

 this fixmes is shifted many times, when i stop/start the some race,
leave the menu, etc. This is first game in which i see gen_ati_shader
in exchange of unhandle texture (NV_combiner thing).

 I wish to ask what is that GL_INVALID_VALUE (0x501) and
GL_INVALID_OPERATION (0x502)??? This 0x501 i can see in many games.


From twickline at gmail.com  Mon Apr  7 19:20:35 2008
From: twickline at gmail.com (Tom Wickline)
Date: Mon, 7 Apr 2008 20:20:35 -0400
Subject: Free apps bundled with msvcr70?
In-Reply-To: <a71bd89a0804061143v1352e387mbf1ff57264eefe27@mail.gmail.com>
References: <a71bd89a0804061143v1352e387mbf1ff57264eefe27@mail.gmail.com>
Message-ID: <53e3a9930804071720m3ce002aby809783c1a5dfb556@mail.gmail.com>

On Sun, Apr 6, 2008 at 2:43 PM, Dan Kegel <dank at kegel.com> wrote:
> (This may sound like a repeat question, but last time I
>  was asking about msvcr71, and thanks to the answers,
>  that's now in winetricks.)
>
>  Anybody have a good download link for an app that
>  comes bundled with msvcr70 and msvcp70,
>  i.e. one that was compiled with visual studio 2002?
>
>
>

Looks as if both of them come with Microsoft .NET Framework 1.0

http://support.microsoft.com/dllhelp/?fid=96502&l=55&det=1

http://support.microsoft.com/dllhelp/

Tom


From twickline at gmail.com  Mon Apr  7 19:26:58 2008
From: twickline at gmail.com (Tom Wickline)
Date: Mon, 7 Apr 2008 20:26:58 -0400
Subject: Free apps bundled with msvcr70?
In-Reply-To: <53e3a9930804071720m3ce002aby809783c1a5dfb556@mail.gmail.com>
References: <a71bd89a0804061143v1352e387mbf1ff57264eefe27@mail.gmail.com>
	<53e3a9930804071720m3ce002aby809783c1a5dfb556@mail.gmail.com>
Message-ID: <53e3a9930804071726s4847648fq95cce01b829ba6e6@mail.gmail.com>

>
>  Looks as if both of them come with Microsoft .NET Framework 1.0
>
>  http://support.microsoft.com/dllhelp/?fid=96502&l=55&det=1
>
>  http://support.microsoft.com/dllhelp/
>
>  Tom
>

Info:
http://web.mit.edu/Kerberos/kfw-2.6/kfw-2.6.5/relnotes.html#requirements

Links:
http://web.mit.edu/kerberos/dist/index.html

http://www.microsoft.com/downloads/details.aspx?FamilyID=9F10CA3B-44DA-4EDF-A5DA-1AEAF5C88165&displaylang=en


From dank at kegel.com  Mon Apr  7 19:52:05 2008
From: dank at kegel.com (Dan Kegel)
Date: Mon, 7 Apr 2008 17:52:05 -0700
Subject: Free apps bundled with msvcr70?
In-Reply-To: <53e3a9930804071726s4847648fq95cce01b829ba6e6@mail.gmail.com>
References: <a71bd89a0804061143v1352e387mbf1ff57264eefe27@mail.gmail.com>
	<53e3a9930804071720m3ce002aby809783c1a5dfb556@mail.gmail.com>
	<53e3a9930804071726s4847648fq95cce01b829ba6e6@mail.gmail.com>
Message-ID: <a71bd89a0804071752y759bc94cx3b18eb604cdd6602@mail.gmail.com>

On Mon, Apr 7, 2008 at 5:26 PM, Tom Wickline <twickline at gmail.com> wrote:
>  http://web.mit.edu/kerberos/dist/index.html

That's a fine tip, thanks.  (The .net installer doesn't count,
it's not free.)
- Dan


From raccoonone at procyongames.com  Mon Apr  7 22:12:45 2008
From: raccoonone at procyongames.com (Christopher)
Date: Mon, 07 Apr 2008 20:12:45 -0700
Subject: USB Human Interface Device support
In-Reply-To: <b130c85e0803252322s168b9ad3i90b4a93ceca92b51@mail.gmail.com>
References: <47E88B3A.3060003@procyongames.com>	
	<3a768c550803250737n28f9a235ga84d52bc817c3502@mail.gmail.com>	
	<b130c85e0803251348k554ca9b4g1c387b6acc533413@mail.gmail.com>	
	<47E9E70E.6030509@procyongames.com>
	<b130c85e0803252322s168b9ad3i90b4a93ceca92b51@mail.gmail.com>
Message-ID: <47FAE2AD.3040506@procyongames.com>

Maarten Lankhorst wrote:
>   
> It probably asks for the specific keys in
> \ENUM\category\devicename\idname so if you copy these over it will
> probably work. WINEDEBUG=+setupapi is your friend.
>
> Cheers,
> Maarten.
>
>
>   
Thanks for the suggestion. I tried that, and now that some page fault 
bugs are fixed it gets a little further. However looking at the 
+setupapi,+hid traces there are a whole bunch of calls to 
SetupDiEnumDeviceInterfaces and SetupDiGetDeviceInterfaceDetailA, but 
after that nothing and the controller still isn't detected by PhoenixRC. 
Anyone have a suggest as to what I should look into next? I've tried 
transferring both the deviceclasses regkey for HID, and the enum regkeys 
for HID.

Thanks,
Christopher


From stefan at codeweavers.com  Tue Apr  8 00:57:21 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Tue, 8 Apr 2008 07:57:21 +0200
Subject: [PATCH 14/15] wined3d: Add device->isInDraw checks
	=?iso-8859-1?q?in=09LoadLocation=2E?=
In-Reply-To: <47FAA1A2.1030704@inbox.lv>
References: <47F93B51.1050508@inbox.lv>
	<d75158870804071454p4e9cd5c8u44c0dc719ff6f2e5@mail.gmail.com>
	<47FAA1A2.1030704@inbox.lv>
Message-ID: <200804080757.22033.stefan@codeweavers.com>

Am Dienstag, 8. April 2008 00:35:14 schrieb Alexander Dorofeyev:
> On the other hand, it is pretty tricky. Also Stefan believes adding
> isInDraw checks everywhere isn't especially nice, but ultimately to prevent
> all situations of ActivateContext inside ENTER_GL/LEAVE_GL  with isInDraw
> approach this would've to be added in more places. I'm not sure about this
> myself, perhaps I'll better not hurry with it and some better ideas may
> come.
The original idea of this flag was to mark that the stateblock is finalized. 
It was never intended to give information about the opengl state(which this 
patches are doing), so if we're doing that we have to work out some ruleset 
about it.


From stefan at codeweavers.com  Tue Apr  8 01:08:13 2008
From: stefan at codeweavers.com (Stefan =?utf-8?q?D=C3=B6singer?=)
Date: Tue, 8 Apr 2008 08:08:13 +0200
Subject: GL_ATI_fragment_shader and GL_INVALID 0x501, 0x502
In-Reply-To: <e1d9e62c0804071637n76680520ge942d21e4bf8f81f@mail.gmail.com>
References: <e1d9e62c0804071637n76680520ge942d21e4bf8f81f@mail.gmail.com>
Message-ID: <200804080808.14011.stefan@codeweavers.com>

Am Dienstag, 8. April 2008 01:37:36 schrieb Milan Kosti?:
>  I wish to ask what is that GL_INVALID_VALUE (0x501) and
> GL_INVALID_OPERATION (0x502)??? This 0x501 i can see in many games.
GL_INVALID_OPERATION and _VALUE opengl errors. That they show up doesn't give 
more information beyond "meh, this doesn't work", it depends on the other 
details.
 
First of all, which mesa version do you have? Please consider updating to 
7.0.x if you have something older.

>  Ok i'm tested wine and his new GL_ATI_fragment_shader support with
> 9250 card nad Mesa/DRI driver. Now env bumpmaping and dot3 tests in
> 3DMark2001 seems to work good, but in car test high ground texture is
> black. 
I tested 3dmark2001, and I am pretty sure that the texture in the high car 
test worked. I have a radeon 9000 card though, and I talked to a Mesa dev who 
said that there are differences between various card revisions.

> In DungeonSiege2 i disabled ps in winecfg, because it has same 
> problem (and more) flickering and black textureon the ground (river
> water not show, but on sea it has...). With Painkiller, nothing helps
> to start game (disabled ps in winecfg not help), only solution is to
> change textured units in driconf from 6 to 5 (this disable
> GL_ATI_fragment_shader in driver).
Can you file bug reports for those issues if they persist with newer mesa 
versions? Please CC me on those reports.

> I check also NFS: Hot Pursuit2, in 

>  fixme:d3d_texture:IWineD3DBaseTextureImpl_ApplyStateChanges
>
> >>>>>>>>>>>>>>>>> GL_INVALID_VALUE (0x501) from glTexParameteri
>
> GL_TEXTURE_MAX_ANISOTROPY_EXT ... @ basetexture.c / 488
>  fixme:d3d_shader:shader_arb_generate_vshader HW VertexShader Error at
> position 499: "1046: '.' expected but ';' found"
That's a vertex shader issue. I guess the "problem" here is that with the 
availability of more texture rendering features the game switched into a 
different rendering mode which Wine or Mesa do not like too much.

>  fixme:d3d_shader:gen_ati_shader >>>>>>>>>>>>>>>>>
> GL_INVALID_OPERATION (0x502) from GL_EXTCALL(glEndFragmentShaderATI())
> @ ati_fragment_shader.c / 774
I didn't put checkGLcall statements to each fragment operation during shader 
creation to prevent the code from being even more convoluted, but you can add 
them for testing and see which part exactly fails.



From ryuzaki90 at gmail.com  Mon Apr  7 18:27:12 2008
From: ryuzaki90 at gmail.com (Bryan Haskins)
Date: Mon, 7 Apr 2008 19:27:12 -0400
Subject: AppDB Error, must enter to the "what didn't work" section?
Message-ID: <7e33d29b0804071627i68fa18fdkb250115b88331863@mail.gmail.com>

" The following errors were found* Please enter what did not work."
I understand the mechanics of why it says that, but realistically, should it
for this field, be required to have data? For example, with me running WoW,
it's flawless for me. Absolutely no problems, and I'm rating it platinum. If
we're rating it platinum should this at least not be required then?
Conversely, it should be required as a field, when it is rated anything but
platinum, by definition.

Just something I noticed.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080407/3b14d70e/attachment.htm 

From scott at open-vote.org  Tue Apr  8 01:40:29 2008
From: scott at open-vote.org (Scott Ritchie)
Date: Mon, 07 Apr 2008 23:40:29 -0700
Subject: appdb needs to list 0.9.47 in the pulldown, please
In-Reply-To: <f3f1b91a0804061455u649eca21v7ccaec9efcc702d4@mail.gmail.com>
References: <a71bd89a0804061147v71eefcd5lfc39d600b4669fc2@mail.gmail.com>	<f3f1b91a0804061156q529d417bn304bbc8883d0eacf@mail.gmail.com>	<a71bd89a0804061202u69df1d1co87edc8f8506a2114@mail.gmail.com>	<f3f1b91a0804061349k498913c8jcd227a94e14a8de3@mail.gmail.com>	<a71bd89a0804061405o7dc65871v94df2bea12329507@mail.gmail.com>
	<f3f1b91a0804061455u649eca21v7ccaec9efcc702d4@mail.gmail.com>
Message-ID: <47FB135D.3030004@open-vote.org>

Chris Morgan wrote:
> On Sun, Apr 6, 2008 at 5:05 PM, Dan Kegel <dank at kegel.com> wrote:
>> On Sun, Apr 6, 2008 at 1:49 PM, Chris Morgan <chmorgan at gmail.com> wrote:
>>  >  >  It seems reasonable to me to include the version bundled with gutsy,
>>  >  >  even if it's getting old, because gutsy is so popular.
>>  >
>>  >  If we wait another 18 days can we ask users of gutsy to upgrade to hardy? ;-)
>>
>>  Of course.
>>
>>
>>  >   If we ask users to put the wine ubuntu repository in their
>>  >  sources.list file won't that let them continue to keep up with newer
>>  >  releases without much difficulty?
>>
>>  All of your suggestions are along the lines "change the user's behavior"
>>  rather than "adapt winehq to the user's behavior".  While all your
>>  suggestions are fine, they don't change the fact that users are
>>  misbehaving because the appdb doesn't allow reports with Gutsy's
>>  version of wine.
> 
> I'm all for adapting our behavior to better fit with the behavior of
> our users. I've spent hundreds of hours working on improving the
> appdb.
> 
> If there was a good reason stated to accept results for obsoleted
> versions then I'd agree with you. In the future I can see a need to
> pin certain versions to the available versions list, certainly 1.0
> seems like a pretty obvious version to pin to the list for a period of
> time.
> 
> There are several issues with keeping older test results. We run the
> risk of confusing users by showing ratings for Wine releases so old
> that the current behavior doesn't match. We can hide these older
> versions but why accept them for submission then? If we show them then
> we need to consider how to present the ratings so users of newer
> versions don't get confused with older versions that come with some
> distributions.
> 

My policy for Ubuntu is this: there should be no regressions from the
Wine included in one Ubuntu release to the next.  That means, for Hardy,
no regressions from 0.9.47 to whatever I put in Hardy (which will
probably be 0.9.59 after a patch or two).

It's a lot easier for me to do this if we don't prohibit test data for
that version.

> 
> I'm a fan of ubuntu, run it on all of my machines etc but that doesn't
> automatically mean that test results for older versions are useful. We
> are rapidly approaching a 1.0 release and each incremental release has
> a wide range of improvements. A user of Gutsy may find it useful to
> see test results for 0.9.47 but its likely even more useful for us to
> help them upgrade to a version we support, currently the latest
> incremental release.
> 

If their applications are working, then users shouldn't be using the apt
repository and latest Wine version because it might introduce a
regression.  We are, in a very real sense, making AppDB less useful for
them by not including the results.

> I'm not opposed to a patch that re-adds 0.9.47 version to the list but
> I'd like to see a patch that adds a table to keep pinned versions and
> php code to manage this list.
> 

It's not that big a deal now, so long as the Hardy version (0.9.59
likely) stays around for a while ;)

Thanks,
Scott Ritchie


From kai.blin at gmail.com  Tue Apr  8 02:49:27 2008
From: kai.blin at gmail.com (Kai Blin)
Date: Tue, 8 Apr 2008 09:49:27 +0200
Subject: Debian repository down
Message-ID: <200804080949.37628.kai.blin@gmail.com>

Hi folks,

some user just reported on IRC that the wine.budgetdedicated.com repo is down. 
Seems like it's dead for over a day already. Do we know what's up with that 
and do we have an ETA for when it'll be back?

Cheers,
Kai
-- 
Kai Blin
WorldForge developer  http://www.worldforge.org/
Wine developer        http://wiki.winehq.org/KaiBlin
Samba team member     http://www.samba.org/samba/team/
--
Will code for cotton.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080408/6a13a166/attachment.pgp 

From scott at open-vote.org  Tue Apr  8 03:26:28 2008
From: scott at open-vote.org (Scott Ritchie)
Date: Tue, 08 Apr 2008 01:26:28 -0700
Subject: Debian repository down
In-Reply-To: <200804080949.37628.kai.blin@gmail.com>
References: <200804080949.37628.kai.blin@gmail.com>
Message-ID: <47FB2C34.9030706@open-vote.org>

Kai Blin wrote:
> Hi folks,
> 
> some user just reported on IRC that the wine.budgetdedicated.com repo is down. 
> Seems like it's dead for over a day already. Do we know what's up with that 
> and do we have an ETA for when it'll be back?
> 
> Cheers,
> Kai
> 
> 
> ------------------------------------------------------------------------
> 
> 
No, I don't.

I can still ssh into the server, occasionally, but I don't know why it's
 basically unreachable over http.

Thanks,
Scott Ritchie


From tokul at users.sourceforge.net  Tue Apr  8 03:26:34 2008
From: tokul at users.sourceforge.net (Tomas Kuliavas)
Date: Tue, 8 Apr 2008 11:26:34 +0300 (EEST)
Subject: Debian repository down
In-Reply-To: <47FB2C34.9030706@open-vote.org>
References: <200804080949.37628.kai.blin@gmail.com>
	<47FB2C34.9030706@open-vote.org>
Message-ID: <50967.195.22.180.233.1207643194.nsm@avilys.eik.lt>

>> some user just reported on IRC that the wine.budgetdedicated.com repo is
>> down.
>> Seems like it's dead for over a day already. Do we know what's up with
>> that
>> and do we have an ETA for when it'll be back?
>>
>>
> No, I don't.
>
> I can still ssh into the server, occasionally, but I don't know why it's
>  basically unreachable over http.

Maybe firewall drops packets or some QoS/throttling services or DOS. If
service is not available, connections don't timeout.

-- 
Tomas



From julliard at winehq.org  Tue Apr  8 04:42:41 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Tue, 08 Apr 2008 11:42:41 +0200
Subject: Alexandre Julliard : winex11: Fix handling of property sizes for
	64-bit platforms.
In-Reply-To: <4E48F8CB-620B-4BAB-9461-FB1374FC368D@codeweavers.com> (Ken
	Thomases's message of "Mon, 7 Apr 2008 17:18:30 -0500")
References: <E1Jipry-0000po-OY@wine.codeweavers.com>
	<4E48F8CB-620B-4BAB-9461-FB1374FC368D@codeweavers.com>
Message-ID: <87iqyslm26.fsf@wine.dyndns.org>

Ken Thomases <ken at codeweavers.com> writes:

> This appears to revert a30327afef7b08d1aac1943ded64ee363a61c537.   
> That commit worked around a quartz-wm bug where it responds to the  
> TARGETS query with a format of 8.

Yes, that commit is incorrect. I'll put in a better fix.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Tue Apr  8 06:22:12 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Tue, 08 Apr 2008 13:22:12 +0200
Subject: [1/2] qedit: Implement IMediaDet_put_Filename.
In-Reply-To: <20080408001014.GA11580@linux.ucla.edu> (Dan Hipschman's message
	of "Mon, 7 Apr 2008 17:10:14 -0700")
References: <20080408001014.GA11580@linux.ucla.edu>
Message-ID: <87ej9glhgb.fsf@wine.dyndns.org>

Dan Hipschman <dsh at linux.ucla.edu> writes:

> +#define RELEASE(iface)                              \
> +    do                                              \
> +        if (iface)                                  \
> +        {                                           \
> +            IUnknown_Release((IUnknown *) iface);   \
> +            iface = NULL;                           \
> +        }                                           \
> +    while (0)

Please avoid that sort of thing, it's ugly to modify what looks like an
input argument inside a macro. Besides, you really don't need a macro
for two lines of code.

-- 
Alexandre Julliard
julliard at winehq.org


From dank at kegel.com  Tue Apr  8 08:30:37 2008
From: dank at kegel.com (Dan Kegel)
Date: Tue, 8 Apr 2008 06:30:37 -0700
Subject: appdb needs to list 0.9.47 in the pulldown, please
In-Reply-To: <47FB135D.3030004@open-vote.org>
References: <a71bd89a0804061147v71eefcd5lfc39d600b4669fc2@mail.gmail.com>
	<f3f1b91a0804061156q529d417bn304bbc8883d0eacf@mail.gmail.com>
	<a71bd89a0804061202u69df1d1co87edc8f8506a2114@mail.gmail.com>
	<f3f1b91a0804061349k498913c8jcd227a94e14a8de3@mail.gmail.com>
	<a71bd89a0804061405o7dc65871v94df2bea12329507@mail.gmail.com>
	<f3f1b91a0804061455u649eca21v7ccaec9efcc702d4@mail.gmail.com>
	<47FB135D.3030004@open-vote.org>
Message-ID: <a71bd89a0804080630v6ca06862gfed1549c74092e4e@mail.gmail.com>

On Mon, Apr 7, 2008 at 11:40 PM, Scott Ritchie <scott at open-vote.org> wrote:
>  It's not that big a deal now, so long as the Hardy version (0.9.59
>  likely) stays around for a while ;)

I think Chris was planning on removing 0.9.59 from
the list way before Hardy is unsupported.  Chris?


From alex at thehandofagony.com  Tue Apr  8 08:42:52 2008
From: alex at thehandofagony.com (Alexander Nicolaysen =?utf-8?q?S=C3=B8rnes?=)
Date: Tue, 8 Apr 2008 15:42:52 +0200
Subject: AppDB Error, must enter to the "what didn't work" section?
In-Reply-To: <7e33d29b0804071627i68fa18fdkb250115b88331863@mail.gmail.com>
References: <7e33d29b0804071627i68fa18fdkb250115b88331863@mail.gmail.com>
Message-ID: <200804081542.52425.alex@thehandofagony.com>

> " The following errors were found* Please enter what did not work."
> I understand the mechanics of why it says that, but realistically, should
> it for this field, be required to have data? For example, with me running
> WoW, it's flawless for me. Absolutely no problems, and I'm rating it
> platinum. If we're rating it platinum should this at least not be required
> then? Conversely, it should be required as a field, when it is rated
> anything but platinum, by definition.
>
> Just something I noticed.

Nice catch!  I've sent a patch for it


Alexander N. S?rnes


From hverbeet at gmail.com  Tue Apr  8 08:55:55 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Tue, 8 Apr 2008 15:55:55 +0200
Subject: [3/10] WineD3D: Make the min mip lookup type a texture property
In-Reply-To: <200804081539.20152.stefan@codeweavers.com>
References: <200804081539.20152.stefan@codeweavers.com>
Message-ID: <d658b69e0804080655r20486262ta763a2df7361228f@mail.gmail.com>

Shouldn't this be a property of the format rather than the texture?


From stefan at codeweavers.com  Tue Apr  8 09:03:08 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Tue, 8 Apr 2008 16:03:08 +0200
Subject: [3/10] WineD3D: Make the min mip lookup type a texture property
In-Reply-To: <d658b69e0804080655r20486262ta763a2df7361228f@mail.gmail.com>
References: <200804081539.20152.stefan@codeweavers.com>
	<d658b69e0804080655r20486262ta763a2df7361228f@mail.gmail.com>
Message-ID: <200804081603.08629.stefan@codeweavers.com>

Am Dienstag, 8. April 2008 15:55:55 schrieb H. Verbeet:
> Shouldn't this be a property of the format rather than the texture?
I thought so as well, but the format already has the property in the form of 
the flag, so it would be duplicated there. I also want to use a custom 
filtering table for texture_rectangle textures, in which case I have to make 
this a per-texture property anyway.


From thunderbird2k at gmx.net  Tue Apr  8 10:40:19 2008
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Tue, 08 Apr 2008 17:40:19 +0200
Subject: [1/10] WineD3D: Store the number of aux buffers in the context
In-Reply-To: <200804081538.44277.stefan@codeweavers.com>
References: <200804081538.44277.stefan@codeweavers.com>
Message-ID: <20080408154019.232540@gmx.net>

Detecting the number of aux buffers is trivial and can be done using the fake GL context as it is a WGL pixel format property.

Roderick
-- 
Ist Ihr Browser Vista-kompatibel? Jetzt die neuesten 
Browser-Versionen downloaden: http://www.gmx.net/de/go/browser


From stefan at codeweavers.com  Tue Apr  8 11:38:53 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Tue, 8 Apr 2008 18:38:53 +0200
Subject: [1/10] WineD3D: Store the number of aux buffers in the context
In-Reply-To: <20080408154019.232540@gmx.net>
References: <200804081538.44277.stefan@codeweavers.com>
	<20080408154019.232540@gmx.net>
Message-ID: <200804081838.53609.stefan@codeweavers.com>

Am Dienstag, 8. April 2008 17:40:19 schrieb Roderick Colenbrander:
> Detecting the number of aux buffers is trivial and can be done using the
> fake GL context as it is a WGL pixel format property.
Not quite: What if a card supports AUX buffers with the R5G6B5 equivalent, but 
not with A8R8G8B8? Of course I could try to create the fake format with aux 
buffers enabled, but who tells me if the number of aux buffers is going to 
work with the format the application wants later?


From winehacker at gmail.com  Tue Apr  8 12:59:54 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Tue, 8 Apr 2008 13:59:54 -0400
Subject: optimizations for 1.0
Message-ID: <19e31a080804081059y57be05c2k3a2f9c51646b8b8c@mail.gmail.com>

Hi,
Given we are coming up close to the freeze, I think this may be a good
time to look in to optimizations. I propose we spend some time trying
different compilers and profiling Wine under different usage patterns
to see what type of speedup we can get. I'm going to see if its
possible to compile Wine with LLVM and I think it would be a good idea
if someone with an ICC license gave it another shot. Also any gentoo
users lurking, now would be a good time to go crazy with your compiler
flags, run some benchmarks and file bug reports.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From thunderbird2k at gmx.net  Tue Apr  8 13:04:30 2008
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Tue, 08 Apr 2008 20:04:30 +0200
Subject: [1/10] WineD3D: Store the number of aux buffers in the context
In-Reply-To: <200804081838.53609.stefan@codeweavers.com>
References: <200804081538.44277.stefan@codeweavers.com>
	<20080408154019.232540@gmx.net>
	<200804081838.53609.stefan@codeweavers.com>
Message-ID: <20080408180430.71850@gmx.net>

> > Detecting the number of aux buffers is trivial and can be done using the
> > fake GL context as it is a WGL pixel format property.
> Not quite: What if a card supports AUX buffers with the R5G6B5 equivalent,
> but 
> not with A8R8G8B8? Of course I could try to create the fake format with
> aux 
> buffers enabled, but who tells me if the number of aux buffers is going to
> work with the format the application wants later?

As I said before aux buffers are a WGL pixel format property. The pixel format selection code needs to take care of it. Right now it already tries to locate a format with aux buffers but it isn't failproof yet (wglChoosePixelFormatARB searches for an exact match or else for something with better capabilities; this is a little too strict for us) I'm working on better pixel format selection code but my time is very limited right now.

Roderick
-- 
Psst! Geheimtipp: Online Games kostenlos spielen bei den GMX Free Games! 
http://games.entertainment.gmx.net/de/entertainment/games/free


From pure_evil at mail.bg  Tue Apr  8 12:51:43 2008
From: pure_evil at mail.bg (pure_evil at mail.bg)
Date: Tue, 8 Apr 2008 20:51:43 +0300
Subject: winecfg turned into control-panel-applets. see patch.
Message-ID: <200804082051.43074.pure_evil@mail.bg>

Well, this is my first patch. Here goes.

It *enhances* winecfg's source and creates a winecfgcpl.cpl, which, when 
placed into ~/.wine/drive_c/windows/system32 shows the different "tabs" as 
different applets (six of them), visible via "wine control".

1.) Enhancements to winecfg - now the winecfg accepts new kind of console 
parameters which determine what tab(s) to show you. 

For all of you console junkies out there /like me!/ - this means that 
typing "winecfg audio" shows only the audio tab, "winecfg desktop" - the 
desktop integration tab and so forth for all six tabs. What "winecfg 
applications" does I leave to you ;)

2.) Based on the enhancements in winecfg, the .CPL itself. Each *applet* that 
appears in the control panel, calls winecfg with the appropriate parameter to 
get the job done.

CPL features:
-> six icons (drawn by me :D )
-> six control panel applets -> no longer an empty control panel
-> translation capability for the Title/Description. Control Panel does not 
support Unicode atm, so the Bulgarian translation is the same as the English 
one; but the capability is there.

This is what I have produced so far on the winecfg->wine control migration 
idea. 
Feedback?
-------------- next part --------------
A non-text attachment was scrubbed...
Name: winecfg2cpl.patch.tar.gz
Type: application/x-tgz
Size: 15719 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080408/bdcdd212/attachment.bin 

From chmorgan at gmail.com  Tue Apr  8 13:15:04 2008
From: chmorgan at gmail.com (Chris Morgan)
Date: Tue, 8 Apr 2008 14:15:04 -0400
Subject: appdb needs to list 0.9.47 in the pulldown, please
In-Reply-To: <a71bd89a0804080630v6ca06862gfed1549c74092e4e@mail.gmail.com>
References: <a71bd89a0804061147v71eefcd5lfc39d600b4669fc2@mail.gmail.com>
	<f3f1b91a0804061156q529d417bn304bbc8883d0eacf@mail.gmail.com>
	<a71bd89a0804061202u69df1d1co87edc8f8506a2114@mail.gmail.com>
	<f3f1b91a0804061349k498913c8jcd227a94e14a8de3@mail.gmail.com>
	<a71bd89a0804061405o7dc65871v94df2bea12329507@mail.gmail.com>
	<f3f1b91a0804061455u649eca21v7ccaec9efcc702d4@mail.gmail.com>
	<47FB135D.3030004@open-vote.org>
	<a71bd89a0804080630v6ca06862gfed1549c74092e4e@mail.gmail.com>
Message-ID: <f3f1b91a0804081115y3d55e918ubc5a8a1f3bbfc738@mail.gmail.com>

On Tue, Apr 8, 2008 at 9:30 AM, Dan Kegel <dank at kegel.com> wrote:
> On Mon, Apr 7, 2008 at 11:40 PM, Scott Ritchie <scott at open-vote.org> wrote:
>  >  It's not that big a deal now, so long as the Hardy version (0.9.59
>  >  likely) stays around for a while ;)
>
>  I think Chris was planning on removing 0.9.59 from
>  the list way before Hardy is unsupported.  Chris?
>

Will Hardy upgrade to Wine 1.0 when it is released? I don't believe
anyone is opposed to keeping particular important releases on the list
but do we do that for distributions upon request? Only ones with lots
of users of wine? The question I had was what results from an older
version buy us or other users. If users can easily upgrade via using
the winehq source in Ubuntu's then maybe it isn't as big of a deal.
The reason for pruning the list was to avoid results from old versions
and to simplify the test submission process by reducing the number of
entries in that dropdown.

It seems like we need to come up with a criteria to pin versions.

I'll submit a bug for it on bugzilla today so we don't forget that we
need to add that feature with the goal of having it before 1.0 is
shipped but maybe we'll have it sooner.

Chris


From stefan at codeweavers.com  Tue Apr  8 13:20:58 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Tue, 8 Apr 2008 20:20:58 +0200
Subject: [1/10] WineD3D: Store the number of aux buffers in the context
In-Reply-To: <20080408180430.71850@gmx.net>
References: <200804081538.44277.stefan@codeweavers.com>
	<200804081838.53609.stefan@codeweavers.com>
	<20080408180430.71850@gmx.net>
Message-ID: <200804082020.58185.stefan@codeweavers.com>

Am Dienstag, 8. April 2008 20:04:30 schrieb Roderick Colenbrander:
> > > Detecting the number of aux buffers is trivial and can be done using
> > > the fake GL context as it is a WGL pixel format property.
> >
> > Not quite: What if a card supports AUX buffers with the R5G6B5
> > equivalent, but
> > not with A8R8G8B8? Of course I could try to create the fake format with
> > aux
> > buffers enabled, but who tells me if the number of aux buffers is going
> > to work with the format the application wants later?
>
> As I said before aux buffers are a WGL pixel format property. The pixel
> format selection code needs to take care of it. Right now it already tries
> to locate a format with aux buffers but it isn't failproof yet
Sure. The fact that it *may* depend on the other settings of the pixel format 
means I can't generally say "this GL implementation supports aux buffers" - I 
have to decide on that per created GL context and drawable. That's why I have 
the flag in the context and not the GL info structure



From scott at open-vote.org  Tue Apr  8 14:22:09 2008
From: scott at open-vote.org (Scott Ritchie)
Date: Tue, 08 Apr 2008 12:22:09 -0700
Subject: Debian repository down
In-Reply-To: <50967.195.22.180.233.1207643194.nsm@avilys.eik.lt>
References: <200804080949.37628.kai.blin@gmail.com>	<47FB2C34.9030706@open-vote.org>
	<50967.195.22.180.233.1207643194.nsm@avilys.eik.lt>
Message-ID: <47FBC5E1.6070702@open-vote.org>

Tomas Kuliavas wrote:
>>> some user just reported on IRC that the wine.budgetdedicated.com repo is
>>> down.
>>> Seems like it's dead for over a day already. Do we know what's up with
>>> that
>>> and do we have an ETA for when it'll be back?
>>>
>>>
>> No, I don't.
>>
>> I can still ssh into the server, occasionally, but I don't know why it's
>>  basically unreachable over http.
> 
> Maybe firewall drops packets or some QoS/throttling services or DOS. If
> service is not available, connections don't timeout.
> 

Everything is fixed now.  Budgetdedicated have awesome support :)

Thanks,
Scott Ritchie


From tokul at users.sourceforge.net  Tue Apr  8 14:36:06 2008
From: tokul at users.sourceforge.net (Tomas Kuliavas)
Date: Tue, 8 Apr 2008 22:36:06 +0300 (EEST)
Subject: Debian repository down
In-Reply-To: <47FBC5E1.6070702@open-vote.org>
References: <200804080949.37628.kai.blin@gmail.com>
	<47FB2C34.9030706@open-vote.org>
	<50967.195.22.180.233.1207643194.nsm@avilys.eik.lt>
	<47FBC5E1.6070702@open-vote.org>
Message-ID: <56771.78.61.224.253.1207683366.nsm@avilys.eik.lt>

> Tomas Kuliavas wrote:
>>>> some user just reported on IRC that the wine.budgetdedicated.com repo
>>>> is
>>>> down.
>>>> Seems like it's dead for over a day already. Do we know what's up with
>>>> that
>>>> and do we have an ETA for when it'll be back?
>>>>
>>>>
>>> No, I don't.
>>>
>>> I can still ssh into the server, occasionally, but I don't know why
>>> it's
>>>  basically unreachable over http.
>>
>> Maybe firewall drops packets or some QoS/throttling services or DOS. If
>> service is not available, connections don't timeout.
>>
>
> Everything is fixed now.  Budgetdedicated have awesome support :)

tomas at kirke:~$ LANG=en_US date
Tue Apr  8 22:43:27 EEST 2008
tomas at kirke:~$ sudo wget
http://wine.budgetdedicated.com/apt/sources.list.d/etch.list -O
/etc/apt/sources.list.d/winehq.list
--22:43:29--  http://wine.budgetdedicated.com/apt/sources.list.d/etch.list
           => `/etc/apt/sources.list.d/winehq.list'
Resolving wine.budgetdedicated.com... 81.171.111.184,
2001:4de0:aaac:0:2456::2
Connecting to wine.budgetdedicated.com|81.171.111.184|:80... failed:
Connection refused.
Connecting to wine.budgetdedicated.com|2001:4de0:aaac:0:2456::2|:80...
failed: Network is unreachable.
tomas at kirke:~$


How about usable IPV4 address?

-- 
Tomas



From david.adam.cnrs at gmail.com  Tue Apr  8 02:00:51 2008
From: david.adam.cnrs at gmail.com (David Adam)
Date: Tue, 8 Apr 2008 09:00:51 +0200
Subject: Implementation of D3DXGetFVFVertexSize with tests
Message-ID: <5f9140a20804080000y28d69660wae0007b0aab4736e@mail.gmail.com>

Hello,

to keep the code readable, you should put your function in a new file. For
instance,
d3dx8/mesh.c would be fine  (msdn put this functio in the mesh category).
Otherwise, the whole code is going to implemented in the file
d3dx8/d3dx8_main.c.

What is the purpose of the line

+    ok(TRUE,"prueba");
?

Moreover, I think that this test should be implemented in d3dx8 too. If you
want to test the difference between d3d8 and d3dx9, you should duplicate the
test in d3dx9 then.

David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080408/b5f0362a/attachment.htm 

From gmane at drealm.info  Tue Apr  8 11:30:39 2008
From: gmane at drealm.info (Peter L Jones)
Date: Tue, 08 Apr 2008 17:30:39 +0100
Subject: wineasio 0.7.4
Message-ID: <ftg6jf$bph$1@ger.gmane.org>

Hi all,

The on-going development of wineasio continues with the release of 0.7.4.  This
release is primarily aimed at fixing a couple of bugs and addressing some JACK
xrun issues.

I'm most interested in hearing from people who are having xruns with the 0.7.x
series but for whom 0.5 (or 0.6a) works.

Regards,

-- Peter
http://sourceforge.net/projects/wineasio



From scott at open-vote.org  Tue Apr  8 15:19:27 2008
From: scott at open-vote.org (Scott Ritchie)
Date: Tue, 08 Apr 2008 13:19:27 -0700
Subject: optimizations for 1.0
In-Reply-To: <19e31a080804081059y57be05c2k3a2f9c51646b8b8c@mail.gmail.com>
References: <19e31a080804081059y57be05c2k3a2f9c51646b8b8c@mail.gmail.com>
Message-ID: <47FBD34F.4030609@open-vote.org>

Steven Edwards wrote:
> Hi,
> Given we are coming up close to the freeze, I think this may be a good
> time to look in to optimizations. I propose we spend some time trying
> different compilers and profiling Wine under different usage patterns
> to see what type of speedup we can get. I'm going to see if its
> possible to compile Wine with LLVM and I think it would be a good idea
> if someone with an ICC license gave it another shot. Also any gentoo
> users lurking, now would be a good time to go crazy with your compiler
> flags, run some benchmarks and file bug reports.
> 

I'd settle for someone telling me which GCC version to use.  If you are
doing optimization testing, please make sure to test that copy
protection hasn't broken as well :)

Thanks,
Scott Ritchie


From stefan at codeweavers.com  Tue Apr  8 15:46:58 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Tue, 8 Apr 2008 22:46:58 +0200
Subject: dlls/d3d9/tests/visual.c cleanup
In-Reply-To: <alpine.LSU.1.00.0804081709300.22304@acrux.dbai.tuwien.ac.at>
References: <Pine.LNX.4.64.0801121848470.4453@acrux.dbai.tuwien.ac.at>
	<87bq7oiiye.fsf@wine.dyndns.org>
	<alpine.LSU.1.00.0804081709300.22304@acrux.dbai.tuwien.ac.at>
Message-ID: <200804082246.58195.stefan@codeweavers.com>

Am Dienstag, 8. April 2008 18:08:15 schrieb Gerald Pfeifer:
> On Mon, 14 Jan 2008, Alexandre Julliard wrote:
> > These tests don't make much sense, with or without your fix, plus the
> > error messages don't match the tests. This needs more work.
>
> It seems this was added with 2007-11-07 with the following log entry:
>
>   Stefan D?singer <stefan at codeweavers.com>
>   wined3d: Shader Model 3.0 varying tests.
>
> I've seen patches in this area cleaning up some stuff.  Does this
> address the issues you were seeing?  Otherwise, I'd hope Stefan can
> have a look.
>
> Here is an updated patch of mine.
The patch should be OK as it is a NOP functionally. I wonder why it is needed 
though, since I think that if all 3 lines look the same they're easier to 
read, but beauty is arguable. Does the patch fix some compiler warnings with 
some extra warnings enabled?





From dank at kegel.com  Tue Apr  8 16:15:48 2008
From: dank at kegel.com (Dan Kegel)
Date: Tue, 8 Apr 2008 14:15:48 -0700
Subject: New winetricks 20080408: fixed dcom98
Message-ID: <a71bd89a0804081415k62bc134aoe17a1c2426520c09@mail.gmail.com>

Another day, another winetricks release.  James Hawkins
noticed that installing native dcom98 breaks everything
now because it breaks three of the .exe's that wine starts
internally.   So I've updated winetricks to avoid overriding
rpcrt4, ole32, and oleaut32 for those three exe.  Once
again, dcom98 is your friend.

As always, the latest winetricks is online at
  http://kegel.com/wine/winetricks
and the change history is online at
  http://winezeug.googlecode.com/
- Dan


From m.b.lankhorst at gmail.com  Tue Apr  8 16:22:55 2008
From: m.b.lankhorst at gmail.com (Maarten Lankhorst)
Date: Tue, 8 Apr 2008 14:22:55 -0700
Subject: quartz: Add missing lock releases on some code paths (Smatch).
In-Reply-To: <20080408211319.GA1868@redhat.com>
References: <20080408211319.GA1868@redhat.com>
Message-ID: <b130c85e0804081422i13a108f2m38321f5ce4168e5e@mail.gmail.com>

Hello,

2008/4/8, Michael Stefaniuc <mstefani at redhat.de>:
>  not sure if it's supposed to not release the thread_lock in that case
>  or if that's an omission that got copied around.
+1, thanks for catching.

Cheers,
Maarten.


From scott at open-vote.org  Tue Apr  8 16:23:23 2008
From: scott at open-vote.org (Scott Ritchie)
Date: Tue, 08 Apr 2008 14:23:23 -0700
Subject: Debian repository down
In-Reply-To: <56771.78.61.224.253.1207683366.nsm@avilys.eik.lt>
References: <200804080949.37628.kai.blin@gmail.com>
	<47FB2C34.9030706@open-vote.org>
	<50967.195.22.180.233.1207643194.nsm@avilys.eik.lt>
	<47FBC5E1.6070702@open-vote.org>
	<56771.78.61.224.253.1207683366.nsm@avilys.eik.lt>
Message-ID: <47FBE24B.2030205@open-vote.org>

Tomas Kuliavas wrote:
>> Tomas Kuliavas wrote:
>>>>> some user just reported on IRC that the wine.budgetdedicated.com repo
>>>>> is
>>>>> down.
>>>>> Seems like it's dead for over a day already. Do we know what's up with
>>>>> that
>>>>> and do we have an ETA for when it'll be back?
>>>>>
>>>>>
>>>> No, I don't.
>>>>
>>>> I can still ssh into the server, occasionally, but I don't know why
>>>> it's
>>>>  basically unreachable over http.
>>> Maybe firewall drops packets or some QoS/throttling services or DOS. If
>>> service is not available, connections don't timeout.
>>>
>> Everything is fixed now.  Budgetdedicated have awesome support :)
> 
> tomas at kirke:~$ LANG=en_US date
> Tue Apr  8 22:43:27 EEST 2008
> tomas at kirke:~$ sudo wget
> http://wine.budgetdedicated.com/apt/sources.list.d/etch.list -O
> /etc/apt/sources.list.d/winehq.list
> --22:43:29--  http://wine.budgetdedicated.com/apt/sources.list.d/etch.list
>            => `/etc/apt/sources.list.d/winehq.list'
> Resolving wine.budgetdedicated.com... 81.171.111.184,
> 2001:4de0:aaac:0:2456::2
> Connecting to wine.budgetdedicated.com|81.171.111.184|:80... failed:
> Connection refused.
> Connecting to wine.budgetdedicated.com|2001:4de0:aaac:0:2456::2|:80...
> failed: Network is unreachable.
> tomas at kirke:~$
> 
> 
> How about usable IPV4 address?
> 

Sorry I had to restart apache again on it.  My mistake ;)

Thanks,
Scott Ritchie


From bon at elektron.ikp.physik.tu-darmstadt.de  Tue Apr  8 17:16:01 2008
From: bon at elektron.ikp.physik.tu-darmstadt.de (Uwe Bonnes)
Date: Wed, 9 Apr 2008 00:16:01 +0200
Subject: Implementation of D3DXGetFVFVertexSize with tests
In-Reply-To: <5f9140a20804080000y28d69660wae0007b0aab4736e@mail.gmail.com>
References: <5f9140a20804080000y28d69660wae0007b0aab4736e@mail.gmail.com>
Message-ID: <18427.61089.952796.412252@hertz.ikp.physik.tu-darmstadt.de>

>>>>> "David" == David Adam <david.adam.cnrs at gmail.com> writes:

...

    David> What is the purpose of the line

    David> + ok(TRUE,"prueba"); ?

"prueba" could be spanish for test.

    David> David Hello,<br><br>to keep the code readable, you should put

Please, no HTML in mails
-- 
Uwe Bonnes                bon at elektron.ikp.physik.tu-darmstadt.de

Institut fuer Kernphysik  Schlossgartenstrasse 9  64289 Darmstadt
--------- Tel. 06151 162516 -------- Fax. 06151 164321 ----------


From winehacker at gmail.com  Tue Apr  8 17:21:59 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Tue, 8 Apr 2008 18:21:59 -0400
Subject: optimizations for 1.0
In-Reply-To: <47FBD34F.4030609@open-vote.org>
References: <19e31a080804081059y57be05c2k3a2f9c51646b8b8c@mail.gmail.com>
	<47FBD34F.4030609@open-vote.org>
Message-ID: <19e31a080804081521p4106c3b6x45765c683a60f133@mail.gmail.com>

On Tue, Apr 8, 2008 at 4:19 PM, Scott Ritchie <scott at open-vote.org> wrote:
>  I'd settle for someone telling me which GCC version to use.  If you are
>  doing optimization testing, please make sure to test that copy
>  protection hasn't broken as well :)

Good point. I just tested LLVM 2.2 on OS X and it produces a totally
broken Wine so thats out. I see ICC has an eval version for OS X so I
am going to give it a shot next.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From stefandoesinger at gmx.at  Tue Apr  8 17:25:35 2008
From: stefandoesinger at gmx.at (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Wed, 9 Apr 2008 00:25:35 +0200
Subject: XDC 2008 wishlist
In-Reply-To: <20080404165503.107670@gmx.net>
References: <200804041716.58458.stefandoesinger@gmx.at>
	<20080404165503.107670@gmx.net>
Message-ID: <200804090025.35434.stefandoesinger@gmx.at>

Am Freitag, 4. April 2008 18:55:03 schrieb Roderick Colenbrander:
> Most xorg devs aren't a big fan of pbuffers but they are part of the GLX
> 1.3 spec which drivers want to support these days. Some drivers are
> considering to just fail on pbuffer creation. Encourage them to offer
> pbuffer support on some visuals/fbconfigs. A lot of windows apps rely on
> their presence including Wow in opengl32 mode and lots of other (older)
> programs.
Can we emulate pbuffers via FBOs, or are there some problems? Pbuffer support 
is troublesome on MacOS and the ATI binary driver as well, so even if the 
xorg devs implement it we'll be stuck with a partial fix only


From fgouget at free.fr  Tue Apr  8 18:06:20 2008
From: fgouget at free.fr (Francois Gouget)
Date: Wed, 9 Apr 2008 01:06:20 +0200 (CEST)
Subject: Reece Dunn : comdlg32: Fix building the tests with MSVC headers.
In-Reply-To: <E1JdtAy-0002EV-Jx@wine.codeweavers.com>
References: <E1JdtAy-0002EV-Jx@wine.codeweavers.com>
Message-ID: <alpine.DEB.1.10.0804090104490.20134@amboise.dolphin>

On Mon, 24 Mar 2008, Alexandre Julliard wrote:
[...]
> Commit: ae32a7fe0473aebb875b26083c1567ff046c3b80
> URL:    http://source.winehq.org/git/wine.git/?a=commit;h=ae32a7fe0473aebb875b26083c1567ff046c3b80
> 
> Author: Reece Dunn <msclrhd at googlemail.com>
> Date:   Sat Mar 22 22:50:43 2008 +0000
> 
> comdlg32: Fix building the tests with MSVC headers.
[...]
> +++ b/dlls/comdlg32/tests/printdlg.c
> @@ -26,6 +26,7 @@
>  #include "winerror.h"
>  #include "wingdi.h"
>  #include "winuser.h"
> +#include "objbase.h"

The question is why didn't this fail in Wine in the first place? The 
Wine headers must be different in some way which causes the compile to 
succeed when it should have failed. Thus they should be fixed.


-- 
Francois Gouget <fgouget at free.fr>              http://fgouget.free.fr/
                            $live{free} || die "";


From smoki00790 at gmail.com  Tue Apr  8 19:11:36 2008
From: smoki00790 at gmail.com (=?ISO-8859-2?Q?Milan_Kosti=E6?=)
Date: Wed, 9 Apr 2008 02:11:36 +0200
Subject: GL_ATI_fragment_shader and GL_INVALID 0x501, 0x502
In-Reply-To: <200804080808.14011.stefan@codeweavers.com>
References: <e1d9e62c0804071637n76680520ge942d21e4bf8f81f@mail.gmail.com>
	<200804080808.14011.stefan@codeweavers.com>
Message-ID: <e1d9e62c0804081711s23046a9aq7991a85522cee457@mail.gmail.com>

 I'm use Mesa 7.0.1 mainly because performance is the best and not
have glitches in some cases like newer, but tried wine-0.9.59 with
7.02 and 7.0.3 also. My card is HIS 9250 128MB/128bit (1002:5960
17af:2020). This r200 performance issues started with this patch:

 http://gitweb.freedesktop.org/?p=mesa/mesa.git;a=commit;h=e279a0a076b7a3c8d60138c19870784c260c9d67

 I'm atached some screenshots with or w/o ps enabled using Mesa 7.0.3
for this to show, clean .wine directory (just winecfg and then install
3DMark) default driver setup and default 3DMark2001 setup (just used
800x600 for windowed screenshoots, checked 'emulate a virtual desktop'
in winecfg).
 All these primers work good in previous versions of wine (except with
properly moving water (river and sea) and portals showing in DS2 (that
work good when i add once again 'mat[12] = mat[8]; mat[13] = mat[9];'
in utils.c) i know that is another thing, but helps), but not working
good with wine-0.9.59 with ps enabled. Exeption from this is
Painkiller which starting only with disabled ps, registy key
DisabledExtensions GL_ATI_fragment_shaders also not help and that
disabled one textured unit in driver is needed from time to time (not
always), also this
happens in all 7.0.x Mesas.

 http://rapidshare.com/files/105988005/wine-0.9.59_tests.tar.gz.html

 NOTE: i mainly use extern libtxc_dxtn.so (for this tests w or w/o -
same results), because some native games Regnum Online, Quake4...
needs it to working properly, also Indiana Jones: Emperors Tomb with
wine even refuses to start without it.

 I'm registered to bugzilla, but everytime it says that my password is
not good (maybe my firewall issues?), because of that i use mailists
to inform devs about bugs (i have many to fill like SeriousSam FE/SE
resolution regression, same game engine: SE starts(but crash on exit),
FE not even start, SE crash when resolution changes and in both games
this work good with 0.9.45 and older like .39, .29... Icculus
installers for these games work good, but have other issues. All this
is tested on: same card, same X server, same distro, same driver, same
Mesa, etc:).


From thestig at google.com  Tue Apr  8 19:26:31 2008
From: thestig at google.com (Lei Zhang)
Date: Tue, 8 Apr 2008 17:26:31 -0700
Subject: Add GdipCreateFontFamilyFromName stub try2
In-Reply-To: <1206500308.7076.1.camel@mighmos>
References: <1206500308.7076.1.camel@mighmos>
Message-ID: <558b2f5c0804081726u2c77aea6s2bde534b95aa66c0@mail.gmail.com>

On Tue, Mar 25, 2008 at 7:58 PM, Adam Petaccia <adam at tpetaccia.com> wrote:
> This is needed, along with some other patches I'll be sending later to
>  make Richard Gariott's Tabula Rasa updater not crash at startup.
>

gcc says:

font.c:126: warning: ISO C90 forbids mixed declarations and code
font.c:131: warning: assignment discards qualifiers from pointer target type

This doesn't work:

ffamily->FamilyName = name;

What happens is FontFamily is NULL?

*FontFamily = ffamily;


From dmitry at codeweavers.com  Tue Apr  8 20:26:20 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Wed, 9 Apr 2008 10:26:20 +0900
Subject: optimizations for 1.0
References: <19e31a080804081059y57be05c2k3a2f9c51646b8b8c@mail.gmail.com><47FBD34F.4030609@open-vote.org>
	<19e31a080804081521p4106c3b6x45765c683a60f133@mail.gmail.com>
Message-ID: <000a01c899e0$bab50a50$a600fea9@DMITRY>

"Steven Edwards" <winehacker at gmail.com> wrote:

> Good point. I just tested LLVM 2.2 on OS X and it produces a totally
> broken Wine so thats out. I see ICC has an eval version for OS X so I
> am going to give it a shot next.

Why not start with Linux first? In that case you have much more helping
hands if you are in trouble, you avoid Mac specific code paths that may
distort the picture, and Linux has oprofile - unbeatable choice.

-- 
Dmitry.


From smoki00790 at gmail.com  Tue Apr  8 20:49:07 2008
From: smoki00790 at gmail.com (=?ISO-8859-2?Q?Milan_Kosti=E6?=)
Date: Wed, 9 Apr 2008 03:49:07 +0200
Subject: GL_ATI_fragment_shader and GL_INVALID 0x501, 0x502
In-Reply-To: <e1d9e62c0804081711s23046a9aq7991a85522cee457@mail.gmail.com>
References: <e1d9e62c0804071637n76680520ge942d21e4bf8f81f@mail.gmail.com>
	<200804080808.14011.stefan@codeweavers.com>
	<e1d9e62c0804081711s23046a9aq7991a85522cee457@mail.gmail.com>
Message-ID: <e1d9e62c0804081849h3310a6e1md373d28ece59674b@mail.gmail.com>

 Forgot to say that Indiana Jones: Emperors Tomb start and load level
with or without enabled ps in winecfg, but if GL_ATI_fragment_shader
is enabled in driver (ie 6 units in driconf), when it load level then
i got hard freeze and must reboot computer on button
(CTRL+ALT+Backspace and CTRL+ALT+D not help, it's only possibly to
move mouse (no click) and nothing else).
 When 5 units is used then everything goes fine, but that is without
this shader:(.


From smoki00790 at gmail.com  Tue Apr  8 21:48:18 2008
From: smoki00790 at gmail.com (=?ISO-8859-2?Q?Milan_Kosti=E6?=)
Date: Wed, 9 Apr 2008 04:48:18 +0200
Subject: GL_ATI_fragment_shader and GL_INVALID 0x501, 0x502
In-Reply-To: <e1d9e62c0804081849h3310a6e1md373d28ece59674b@mail.gmail.com>
References: <e1d9e62c0804071637n76680520ge942d21e4bf8f81f@mail.gmail.com>
	<200804080808.14011.stefan@codeweavers.com>
	<e1d9e62c0804081711s23046a9aq7991a85522cee457@mail.gmail.com>
	<e1d9e62c0804081849h3310a6e1md373d28ece59674b@mail.gmail.com>
Message-ID: <e1d9e62c0804081948o62484fdbqe8259da8a94059b1@mail.gmail.com>

 Btw Stefan, many thanks to you for implement and support this old and
forgotten but powerful extension, it's nice to see that
"metal-blending" shading again in action and all that working in wine,
an example like in this demo (http://www.humus.ca/3D/GameEngine.zip).
Thanks again:).


From winehacker at gmail.com  Tue Apr  8 21:54:05 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Tue, 8 Apr 2008 22:54:05 -0400
Subject: optimizations for 1.0
In-Reply-To: <000a01c899e0$bab50a50$a600fea9@DMITRY>
References: <19e31a080804081059y57be05c2k3a2f9c51646b8b8c@mail.gmail.com>
	<47FBD34F.4030609@open-vote.org>
	<19e31a080804081521p4106c3b6x45765c683a60f133@mail.gmail.com>
	<000a01c899e0$bab50a50$a600fea9@DMITRY>
Message-ID: <19e31a080804081954x63dd863by7847d7a48c8477a0@mail.gmail.com>

On Tue, Apr 8, 2008 at 9:26 PM, Dmitry Timoshkov <dmitry at codeweavers.com> wrote:
>  Why not start with Linux first? In that case you have much more helping
>  hands if you are in trouble, you avoid Mac specific code paths that may
>  distort the picture, and Linux has oprofile - unbeatable choice.

 I have a 64bit linux host and using -m32 with llvmgcc does not seem
to be very well documented. I expect to have problems with icc on
x86-64 also. Preconfigured LLVM packages for 2.2 work out of the box
on OS X where the current Ubuntu binary is at like 1.7 which does not
support inline asm. Don't worry, I'll try it in a 32bit linux vm with
my own build of llvm trunk and icc when I have more time.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From thestig at google.com  Wed Apr  9 01:01:59 2008
From: thestig at google.com (Lei Zhang)
Date: Tue, 8 Apr 2008 23:01:59 -0700
Subject: [PATCH] user32: on VK_RETURN, send WM_COMMAND to ancestor,
	not parent.
In-Reply-To: <558b2f5c0804042155h783268f0m2419aa2f65cf2a19@mail.gmail.com>
References: <558b2f5c0804040020w77698ed0v324e7dbae792098b@mail.gmail.com>
	<00a901c89657$3abcc4f0$a600fea9@DMITRY>
	<558b2f5c0804040747s3eb841cfma07c0b6ca236e8c1@mail.gmail.com>
	<018501c8966e$f65e4000$a600fea9@DMITRY>
	<558b2f5c0804041111v2daf31e4sbbf874e4424c1be4@mail.gmail.com>
	<558b2f5c0804042155h783268f0m2419aa2f65cf2a19@mail.gmail.com>
Message-ID: <558b2f5c0804082301j31820986v72b2cd1baf6a2867@mail.gmail.com>

On Fri, Apr 4, 2008 at 9:55 PM, Lei Zhang <thestig at google.com> wrote:
>
> On Fri, Apr 4, 2008 at 11:11 AM, Lei Zhang <thestig at google.com> wrote:
>  >
>  > On Fri, Apr 4, 2008 at 9:14 AM, Dmitry Timoshkov <dmitry at codeweavers.com> wrote:
>  >  > "Lei Zhang" <thestig at google.com> wrote:
>  >  >
>  >  >
>  >  > > The edit control is the child of a dialog box bar, which is in turn
>  >  > > the child of another dialog box foo. SetParent() is not involved, if
>  >  > > that's what you mean.
>  >  > >
>  >  >
>  >  >  Seems that's not the case then, from your test it looks more like
>  >  >  a WM_COMMAND forwarding from a child dialog to the parent one.
>  >  >
>  >  >  --
>  >  >  Dmitry.
>  >  >
>  >
>  >  I'm pretty sure the parent dialog is getting the WM_COMMAND directly.
>  >  It is not the case where the child dialog gets a WM_COMMAND, and
>  >  forwards it to its parent.
>  >
>  >  Running the test on Windows, the child dialog gets two WM_COMMANDS -
>  >  EN_SETFOCUS and EN_KILLFOCUS. Then the parent dialog gets WM_COMMAND
>  >  with IDOK.
>  >
>  >  - Lei
>  >
>
>  Ah, this is because the child dialog has the DS_CONTROL style. I
>  should test for that and handle it appropriately.
>
>  - Lei
>

I thought maybe the DS_CONTROL style caused the message to get
propagated up, like in DIALOG_FindMsgDestination(). So I did more
tests.

I removed the DS_CONTROL style, but that didn't change the result of
the test. I also tried something more elaborate, where we have a
series of dialog windows, each of which contains another dialog
window... until the last one which contains the edit control. When I
send the edit control the VK_RETURN, the top most dialog window gets
the WM_COMMAND with wparam=IDOK. None of the dialog boxes between the
edit control and its ancestor gets the WM_COMMAND msg.


From thunderbird2k at gmx.net  Wed Apr  9 01:06:13 2008
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Wed, 09 Apr 2008 08:06:13 +0200
Subject: XDC 2008 wishlist
In-Reply-To: <200804090025.35434.stefandoesinger@gmx.at>
References: <200804041716.58458.stefandoesinger@gmx.at>
	<20080404165503.107670@gmx.net>
	<200804090025.35434.stefandoesinger@gmx.at>
Message-ID: <20080409060613.327140@gmx.net>

> > Most xorg devs aren't a big fan of pbuffers but they are part of the GLX
> > 1.3 spec which drivers want to support these days. Some drivers are
> > considering to just fail on pbuffer creation. Encourage them to offer
> > pbuffer support on some visuals/fbconfigs. A lot of windows apps rely on
> > their presence including Wow in opengl32 mode and lots of other (older)
> > programs.
> Can we emulate pbuffers via FBOs, or are there some problems? Pbuffer
> support 
> is troublesome on MacOS and the ATI binary driver as well, so even if the 
> xorg devs implement it we'll be stuck with a partial fix only

In theory you might be able to offer this emulation but I think it will be very tricky and it might not work well at all. Remember pbuffers are WGL things while FBOs require a GLX/WGL context. You would have to override a bunch of GL calls, states .. I don't think this works well. Second WGL allows you to query the capabilities of a pbuffer, we would have to fake most settings which might not result in optimal performance (e.g. color bits, stencil ..).

Mainly overriding stuff and the requirement of a GLX/WGL context is problematic I think. I fear a half baked implementation which works for some of the easier apps. The drivers could also emulate pbuffers using FBOs and they might have less issues.

Roderick
-- 
GMX startet ShortView.de. Hier findest Du Leute mit Deinen Interessen!
Jetzt dabei sein: http://www.shortview.de/?mc=sv_ext_mf at gmx


From dmitry at codeweavers.com  Wed Apr  9 01:24:31 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Wed, 9 Apr 2008 15:24:31 +0900
Subject: Updated three Power Profile functions to match MSDN
References: <ed7be3850804081928i666ced0ch51e8d8ede8a9a2cc@mail.gmail.com>
Message-ID: <00a801c89a0a$607c52d0$a600fea9@DMITRY>

"Black Dragon" <blackdragon1157 at gmail.com> wrote:

First of all Wine doesn't accept patches from an anonymous person,
please use your real name.

> +   if(PowerCaps.SystemS4==TRUE && PowerCaps.HiberFilePresent==TRUE) { return TRUE; }
> +   else return FALSE;

You should never compare against TRUE, and add braces only when necessary:

return PowerCaps.SystemS4 && PowerCaps.HiberFilePresent;

is much shorter and clearer.
 
> +   if(PowerCaps.SystemS5==TRUE) { return TRUE; }
> +   else return FALSE;

Same here:

return PowerCaps.SystemS5;

or

return PowerCaps.SystemS5 != 0;
 
> +   if(PowerCaps.SystemS1==TRUE && PowerCaps.SystemS2==TRUE && PowerCaps.SystemS3==TRUE) { return true; }
> +   else return FALSE;

Same here, also don't use 'true', it's not portable.


-- 
Dmitry.


From dmitry at codeweavers.com  Wed Apr  9 01:27:36 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Wed, 9 Apr 2008 15:27:36 +0900
Subject: [PATCH] user32: on VK_RETURN, send WM_COMMAND to ancestor,
	not parent.
References: <558b2f5c0804040020w77698ed0v324e7dbae792098b@mail.gmail.com><00a901c89657$3abcc4f0$a600fea9@DMITRY><558b2f5c0804040747s3eb841cfma07c0b6ca236e8c1@mail.gmail.com><018501c8966e$f65e4000$a600fea9@DMITRY><558b2f5c0804041111v2daf31e4sbbf874e4424c1be4@mail.gmail.com><558b2f5c0804042155h783268f0m2419aa2f65cf2a19@mail.gmail.com>
	<558b2f5c0804082301j31820986v72b2cd1baf6a2867@mail.gmail.com>
Message-ID: <00b701c89a0a$cf37a4e0$a600fea9@DMITRY>

"Lei Zhang" <thestig at google.com> wrote:

> I thought maybe the DS_CONTROL style caused the message to get
> propagated up, like in DIALOG_FindMsgDestination(). So I did more
> tests.
> 
> I removed the DS_CONTROL style, but that didn't change the result of
> the test. I also tried something more elaborate, where we have a
> series of dialog windows, each of which contains another dialog
> window... until the last one which contains the edit control. When I
> send the edit control the VK_RETURN, the top most dialog window gets
> the WM_COMMAND with wparam=IDOK. None of the dialog boxes between the
> edit control and its ancestor gets the WM_COMMAND msg.

I'd like to see a fully fledged message test for this, with all 'parent'
messages logged, and full window tree parent->child1->child2 checked.

-- 
Dmitry.


From hverbeet at gmail.com  Wed Apr  9 01:39:40 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Wed, 9 Apr 2008 08:39:40 +0200
Subject: d3dx8 [6/7] Implement D3DXMatrixStack_Push
In-Reply-To: <5f9140a20804080119t63829fdn4e654d16d182e676@mail.gmail.com>
References: <5f9140a20804080119t63829fdn4e654d16d182e676@mail.gmail.com>
Message-ID: <d658b69e0804082339j25986923g844a8f6b7282b7b3@mail.gmail.com>

On 08/04/2008, David Adam <david.adam.cnrs at gmail.com> wrote:
> +    This->current = This->current +1;
> +    HeapReAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, This->matrix, (This->current +1) * sizeof(D3DXMATRIX) );
> +    if ( This->matrix == NULL ) return E_OUTOFMEMORY;

Aside from being a bit suboptimal (doing a realloc on every push),
this probably doesn't do what you want. Consider what happens to the
size of the array when you do something like push/pop/push/pop/...etc.

It would be better to keep track of the current stack size, and then
grow it by a factor (eg. 2 or 1.5) if a push would overflow the
current stack. You could also consider shrinking the array again if a
pop would make it use less than a certain percentage of the current
size (eg. a third).

You should also assign the result of HeapReAlloc() to This->matrix
again. Although it's quite possible for HeapReAlloc to just grow the
current block without changing its location, there's no guarantee it
will. The NULL check is useless this way.


From msclrhd at googlemail.com  Wed Apr  9 01:14:54 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Wed, 9 Apr 2008 07:14:54 +0100
Subject: Reece Dunn : comdlg32: Fix building the tests with MSVC headers.
In-Reply-To: <alpine.DEB.1.10.0804090104490.20134@amboise.dolphin>
References: <E1JdtAy-0002EV-Jx@wine.codeweavers.com>
	<alpine.DEB.1.10.0804090104490.20134@amboise.dolphin>
Message-ID: <3f4fd2640804082314y32a2e333h1d1b31dabc64ee04@mail.gmail.com>

On 09/04/2008, Francois Gouget <fgouget at free.fr> wrote:
> On Mon, 24 Mar 2008, Alexandre Julliard wrote:
>  [...]
>  > Commit: ae32a7fe0473aebb875b26083c1567ff046c3b80
>  > URL:    http://source.winehq.org/git/wine.git/?a=commit;h=ae32a7fe0473aebb875b26083c1567ff046c3b80
>  >
>  > Author: Reece Dunn <msclrhd at googlemail.com>
>  > Date:   Sat Mar 22 22:50:43 2008 +0000
>  >
>  > comdlg32: Fix building the tests with MSVC headers.
>  [...]
>  > +++ b/dlls/comdlg32/tests/printdlg.c
>  > @@ -26,6 +26,7 @@
>  >  #include "winerror.h"
>  >  #include "wingdi.h"
>  >  #include "winuser.h"
>  > +#include "objbase.h"
>
>  The question is why didn't this fail in Wine in the first place? The
>  Wine headers must be different in some way which causes the compile to
>  succeed when it should have failed. Thus they should be fixed.

With the current Vista SDK headers (not sure about older ones), in
commdlg.h PRINTDLGEXA/W is wrapped in a #ifdef STDMETHOD guard along
with the definition of IPrintDialogCallback, IPrintDialogServices and
PRINTPAGERANGE. Thus, using the SDK headers it does not find
LPPRINTDLGEXW without objbase.h to get the definition of STDMETHOD.

Looking at the Wine headers, the PRINTDLGEXA/W datastructure is not
guarded in this way and the lpCallback member is void* not LPUNKNOWN
as it is in the SDK headers.

- Reece


From hverbeet at gmail.com  Wed Apr  9 01:47:55 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Wed, 9 Apr 2008 08:47:55 +0200
Subject: d3dx8 {5/7] Implement D3DXMatrixStack_Pop
In-Reply-To: <5f9140a20804080118h3378f9deta9f8aed058911862@mail.gmail.com>
References: <5f9140a20804080118h3378f9deta9f8aed058911862@mail.gmail.com>
Message-ID: <d658b69e0804082347g5a21562ehcd87a7d1c2049f68@mail.gmail.com>

On 08/04/2008, David Adam <david.adam.cnrs at gmail.com> wrote:
> +    if ( This->current == 0 )
> +    {
> +     HeapFree(GetProcessHeap(), 0, This->matrix);
> +     return D3DERR_INVALIDCALL;
> +    }
> +    This->current = This->current -1;
If This->current was 0 when calling Pop, it now points at a
non-existing item. This would probably break things like LoadMatrix,
GetTop, etc. Also, calling Pop again would result in a double free of
This->matrix.


From hverbeet at gmail.com  Wed Apr  9 01:51:38 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Wed, 9 Apr 2008 08:51:38 +0200
Subject: d3dx8: [7/7] Add tests for MatrixStack
In-Reply-To: <5f9140a20804080120t3f39e703xb5d6a588982538cc@mail.gmail.com>
References: <5f9140a20804080120t3f39e703xb5d6a588982538cc@mail.gmail.com>
Message-ID: <d658b69e0804082351t609cac28sb12f754fbb50699a@mail.gmail.com>

On 08/04/2008, David Adam <david.adam.cnrs at gmail.com> wrote:
>
While it's certainly good to test the normal usage of the API, it's
also useful to test the behaviour of error conditions
(Pop/LoadMatrix/GetTop on an empty stack, etc).


From dank at kegel.com  Wed Apr  9 01:56:59 2008
From: dank at kegel.com (Dan Kegel)
Date: Tue, 8 Apr 2008 23:56:59 -0700
Subject: .net 2 first light on nontrivial apps
Message-ID: <a71bd89a0804082356w7414de5fufe9e2792e824c88f@mail.gmail.com>

It looks like 'winetricks dotnet20' and current wine
is good enough that .net support isn't quite the
limiting factor anymore!  See
http://bugs.winehq.org/show_bug.cgi?id=8499
http://bugs.winehq.org/show_bug.cgi?id=12457
http://bugs.winehq.org/show_bug.cgi?id=12458
for three sizeable apps that actually put up
their GUIs, at least briefly.  MySQL Workbench
actually runs well enough to explore the GUI.


From hverbeet at gmail.com  Wed Apr  9 02:03:39 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Wed, 9 Apr 2008 09:03:39 +0200
Subject: d3dx9: Implement D3DXGetShaderSize with tests 3/4
In-Reply-To: <47FBBDB6.60706@ilidium.com>
References: <47FBBDB6.60706@ilidium.com>
Message-ID: <d658b69e0804090003l39d928e7w2c4234499486a1b0@mail.gmail.com>

On 08/04/2008, Luis Busquets <luis.busquets at ilidium.com> wrote:
> This patch implements the function D3DXGetShaderSize and adds tests to two
> simple shader which have been extrated from d3d9/tests/shader.c
>
> +    /* We have to look for the end token 0x0000ffff which is D3DVS_END or D3DPS_END as both values are the same*/
> +    while (*address!=D3DVS_END()) {
The comment about D3DSIO_END still stands.

> +#define compare_shader_sizes(shader, exp) \
> +    shade=(DWORD *)shader; \
> +    got=D3DXGetShaderSize(shader); \
> +    ok(got==exp, "Expected: %d, Got: %d\n", exp, got);
This is pretty ugly, but I guess it works.

> +    compare_shader_sizes (simple_vs, 84);
> +    compare_shader_sizes (simple_ps, 88);
Please also test passing a NULL shader.
(FWIW, sizeof(simple_vs) should also work instead of hardcoding 84
here, same for simple_ps)


From hverbeet at gmail.com  Wed Apr  9 02:07:39 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Wed, 9 Apr 2008 09:07:39 +0200
Subject: d3dx8: D3DXGetFVFVertexSize 2/4
In-Reply-To: <47FBBDB0.6010708@ilidium.com>
References: <47FBBDB0.6010708@ilidium.com>
Message-ID: <d658b69e0804090007t619c4647gcb608d8c044f8ab9@mail.gmail.com>

On 08/04/2008, Luis Busquets <luis.busquets at ilidium.com> wrote:
> Implementation of D3DXGetFVFVertexSize. With this patch WINE responds
> correctly to the tests of D3DXGetFVFVertexSize sent in patch 1/4 of today.
>
You have to either send the implementation first and the test
afterwards, or wrap the test in a todo_wine block, and remove it when
you send the implementation.


From hverbeet at gmail.com  Wed Apr  9 02:11:54 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Wed, 9 Apr 2008 09:11:54 +0200
Subject: d3dx9: Implement D3DXGetShaderVersion with tests 4/4
In-Reply-To: <47FBBDBB.4000506@ilidium.com>
References: <47FBBDBB.4000506@ilidium.com>
Message-ID: <d658b69e0804090011s62bd60f3n54faa5ab6b4a2e2@mail.gmail.com>

On 08/04/2008, Luis Busquets <luis.busquets at ilidium.com> wrote:
> This patch implements D3DXGetShaderVersion and adds tests to two simple
> shader which have been extrated from d3d9/tests/shader.c
>
> +    compare_shader_versions (simple_vs, 0xFFFE0101);
> +    compare_shader_versions (simple_ps, 0xFFFF0101);
D3DVS_VERSION(1, 1) and D3DPS_VERSION(1, 1) would be more appropriate
than 0xFFFE0101 and 0xFFFF0101 here.


From stefan at codeweavers.com  Wed Apr  9 02:18:12 2008
From: stefan at codeweavers.com (Stefan =?utf-8?q?D=C3=B6singer?=)
Date: Wed, 9 Apr 2008 09:18:12 +0200
Subject: GL_ATI_fragment_shader and GL_INVALID 0x501, 0x502
In-Reply-To: <e1d9e62c0804081849h3310a6e1md373d28ece59674b@mail.gmail.com>
References: <e1d9e62c0804071637n76680520ge942d21e4bf8f81f@mail.gmail.com>
	<e1d9e62c0804081711s23046a9aq7991a85522cee457@mail.gmail.com>
	<e1d9e62c0804081849h3310a6e1md373d28ece59674b@mail.gmail.com>
Message-ID: <200804090918.12309.stefan@codeweavers.com>

Am Mittwoch, 9. April 2008 03:49:07 schrieb Milan Kosti?:
>  Forgot to say that Indiana Jones: Emperors Tomb start and load level
> with or without enabled ps in winecfg, but if GL_ATI_fragment_shader
> is enabled in driver (ie 6 units in driconf), when it load level then
> i got hard freeze and must reboot computer on button
> (CTRL+ALT+Backspace and CTRL+ALT+D not help, it's only possibly to
> move mouse (no click) and nothing else).
>  When 5 units is used then everything goes fine, but that is without
> this shader:(.
In that case you should file a Mesa bug report. If your computer crashes it's 
by definition a driver bug, not a Wine bug. With a few bug reports the Mesa 
devs will see that the r200 isn't dead yet.


From hverbeet at gmail.com  Wed Apr  9 02:20:32 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Wed, 9 Apr 2008 09:20:32 +0200
Subject: [10/10] d3d9: Some Windows drivers set undefined attributes to 0.0
In-Reply-To: <200804081541.39186.stefan@codeweavers.com>
References: <200804081541.39186.stefan@codeweavers.com>
Message-ID: <d658b69e0804090020k2dcf61d7l85d4d46977ed3380@mail.gmail.com>

On 08/04/2008, Stefan D?singer <stefan at codeweavers.com> wrote:
>  +    Sleep(100000);
Is that Sleep() really needed?


From saulius2 at ar.fi.lt  Wed Apr  9 04:20:58 2008
From: saulius2 at ar.fi.lt (Saulius Krasuckas)
Date: Wed, 9 Apr 2008 12:20:58 +0300 (EEST)
Subject: LoadStringW [1/2]
In-Reply-To: <001e01c8985f$1449e000$a600fea9@DMITRY>
References: <4794545B.4000909@procyongames.com><005101c85c07$b280a180$a600fea9@DMITRY><000601c85c08$f006a440$a600fea9@DMITRY><4794FD3E.2080204@procyongames.com><22821af30801211217g22c09c8bu597659ab11aafff0@mail.gmail.com><479504E4.4080401@procyongames.com><22821af30801211252l30be545cqc9cf37bb4b89451c@mail.gmail.com><47950AEF.9060409@procyongames.com><Pine.LNX.4.62.0804032333300.6745@tvarka.ar.fi.lt><006401c895f9$07c167d0$a600fea9@DMITRY>
	<Pine.LNX.4.62.0804061603190.17765@tvarka.ar.fi.lt>
	<001e01c8985f$1449e000$a600fea9@DMITRY>
Message-ID: <Pine.LNX.4.62.0804091213280.6351@tvarka.ar.fi.lt>

* On Mon, 7 Apr 2008, Dmitry Timoshkov wrote:
> * "Saulius Krasuckas" <saulius2 at ar.fi.lt> wrote:
> > 
> > > If the regression can be identified by someone able to read the code 
> > > and not by a regression test that doesn't matter.
> > 
> > Could you show me appropriate code lines of LoadStringA and a logic to 
> > follow, please?  I am schocked.
> > 
> > Dmitry, for me your statement is true only in the case of reading 
> > original code of appropriate DLL from MS :(
> 
> I suspect that you will be shocked even more if someone would say that
> something is really wrong out there if there is a need to explain what
> this list is about, 

And I am not asking for this.  Plus, You still have not answered my 
question: how regression in question can be identified only by reading 
Wine code (at least in case of LoadStringA).

> how the patch review process is going, and which code is reviewed in the 
> process.

So do you say Wine HQs aren't willing to attract more casual contributors 
to Wine code via wine-devel@ anymore? :(


From julliard at winehq.org  Wed Apr  9 04:13:22 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 09 Apr 2008 11:13:22 +0200
Subject: [PATCH 1/2] user32: add edit control check to see if its in a
	dialog on WM_CHAR/VK_RETURN.
In-Reply-To: <558b2f5c0804081604p514ef000oc0f6dba892e286af@mail.gmail.com>
	(Lei Zhang's message of "Tue, 8 Apr 2008 16:04:50 -0700")
References: <558b2f5c0804081604p514ef000oc0f6dba892e286af@mail.gmail.com>
Message-ID: <87k5j7jsr1.fsf@wine.dyndns.org>

"Lei Zhang" <thestig at google.com> writes:

> +static BOOL EDIT_IsInsideDialog(EDITSTATE *es)
> +{
> +    static WCHAR dialog_class[] = {'#','3','2','7','7','0',0};
> +    WCHAR name[8];
> +    int r;
> +
> +    r = GetClassNameW(es->hwndParent, name, 8);
> +    if (r > 0)
> +        if (!lstrcmpW(name, dialog_class))
> +            return TRUE;
> +    return FALSE;
> +}

You should test the WIN_ISDIALOG flag instead.

-- 
Alexandre Julliard
julliard at winehq.org


From dmitry at codeweavers.com  Wed Apr  9 04:28:34 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Wed, 9 Apr 2008 18:28:34 +0900
Subject: LoadStringW [1/2]
References: <4794545B.4000909@procyongames.com><005101c85c07$b280a180$a600fea9@DMITRY><000601c85c08$f006a440$a600fea9@DMITRY><4794FD3E.2080204@procyongames.com><22821af30801211217g22c09c8bu597659ab11aafff0@mail.gmail.com><479504E4.4080401@procyongames.com><22821af30801211252l30be545cqc9cf37bb4b89451c@mail.gmail.com><47950AEF.9060409@procyongames.com><Pine.LNX.4.62.0804032333300.6745@tvarka.ar.fi.lt><006401c895f9$07c167d0$a600fea9@DMITRY><Pine.LNX.4.62.0804061603190.17765@tvarka.ar.fi.lt><001e01c8985f$1449e000$a600fea9@DMITRY>
	<Pine.LNX.4.62.0804091213280.6351@tvarka.ar.fi.lt>
Message-ID: <027701c89a24$1752ed70$a600fea9@DMITRY>

"Saulius Krasuckas" <saulius2 at ar.fi.lt> wrote:

> And I am not asking for this.  Plus, You still have not answered my 
> question: how regression in question can be identified only by reading 
> Wine code (at least in case of LoadStringA).

I have no idea how the word 'only' has appeared in the sentence above,
and why it's not clear to you that reading Wine code is one of possible
ways to understand what the patchs does, and see possible improvements or
regressions caused by a patch. Or you know development methods which don't
require reading and understanding the code you are going to modify?

>> how the patch review process is going, and which code is reviewed in the 
>> process.
> 
> So do you say Wine HQs aren't willing to attract more casual contributors 
> to Wine code via wine-devel@ anymore? :(

I don't follow your logic here.

-- 
Dmitry.


From hverbeet at gmail.com  Wed Apr  9 04:34:16 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Wed, 9 Apr 2008 11:34:16 +0200
Subject: Implement D3DXMatrixStack_Push
In-Reply-To: <5f9140a20804090154q53cdf45bn1ffb68c18a7f21ca@mail.gmail.com>
References: <5f9140a20804090154q53cdf45bn1ffb68c18a7f21ca@mail.gmail.com>
Message-ID: <d658b69e0804090234j317eed10yd7e337f1cb01ac00@mail.gmail.com>

On 09/04/2008, David Adam <david.adam.cnrs at gmail.com> wrote:
> This would increase the size of the stack exponentially. Would it be better
> to do this:
>
> Take a stack_size_reference (for instance 32 items)
> When This->current =32, then increase the size of the stack of
> stack_size_reference (that is 64 items now)
> Then when This->current is =64, again increase the size of the stack of
> stack_size_reference (that is 98 items now), and so on....
>
>
> This would increase the size of the stack linearly instead of exponentially.
>
Growing exponentially is intended. If HeapReAlloc can't simply grow
the current block, it has to copy the contents over to a new memory
location. If the stack becomes larger, the relative time it costs to
do the copy becomes more and more expensive compared to the actual
push. Growing by a factor instead of by a constant size keeps the
amortized running time for a series of pushes constant independent of
the the array size. (Not that I expect a matrix stack to become large
enough for this to matter a whole lot, but that's the reasoning.)

> > You should also assign the result of HeapReAlloc() to This->matrix
> > again.
>
> I thought that
>
>  HeapReAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, This->matrix, ..........);
>
>
> do exactly what you say
It can't do that. HeapReAlloc takes a pointer to a memory location, so
it can change the memory at that location, but it can't change the
pointer itself.


From smoki00790 at gmail.com  Wed Apr  9 05:12:20 2008
From: smoki00790 at gmail.com (=?ISO-8859-2?Q?Milan_Kosti=E6?=)
Date: Wed, 9 Apr 2008 12:12:20 +0200
Subject: GL_ATI_fragment_shader and GL_INVALID 0x501, 0x502
In-Reply-To: <200804090918.12309.stefan@codeweavers.com>
References: <e1d9e62c0804071637n76680520ge942d21e4bf8f81f@mail.gmail.com>
	<e1d9e62c0804081711s23046a9aq7991a85522cee457@mail.gmail.com>
	<e1d9e62c0804081849h3310a6e1md373d28ece59674b@mail.gmail.com>
	<200804090918.12309.stefan@codeweavers.com>
Message-ID: <e1d9e62c0804090312m41dbf12bta045b2c5272106bf@mail.gmail.com>

 Eh yes, i just checked what is difference between 9000 and 9250 and
find that 9000 has 4/2 units, but 9250 has 4/1. One physical unit
left! And this is likely problem because ati_fs is linked to max units
which is 6 in driver, but this card has only 5;). Seems to one is
emulated:D. I don't know, i think that my neighbour have 9100 (which
also has 4/2) in his vault and i'm must wine:) with that card first
(which is very possibly not working?:D) and if that is bug, i will
fill one massive bug for that thing on Mesa side:) and just hope that
someone of retired r200 devs will go back to business and improve
driver... Thanks for reading all this posts anyway.


From bunglehead at gmail.com  Wed Apr  9 05:37:38 2008
From: bunglehead at gmail.com (Nikolay Sivov)
Date: Wed, 9 Apr 2008 14:37:38 +0400
Subject: gdiplus: GdipAddPathArcI, GdipAddPathBezier implementation
Message-ID: <db9c62d60804090337h16932fc4wc176663d33e3d1af@mail.gmail.com>

Is it something wrong  with this patch?

Changelog:
  - GdipAddPathArcI, GdipAddPathBezier implemented using existing calls

Index: dlls/gdiplus/gdiplus.spec
===================================================================
RCS file: /home/wine/wine/dlls/gdiplus/gdiplus.spec,v
retrieving revision 1.170
diff -u -r1.170 gdiplus.spec
--- dlls/gdiplus/gdiplus.spec    24 Mar 2008 12:57:16 -0000    1.170
+++ dlls/gdiplus/gdiplus.spec    7 Apr 2008 18:57:29 -0000
@@ -1,6 +1,6 @@
@ stdcall GdipAddPathArc(ptr long long long long long long)
-@ stub GdipAddPathArcI
-@ stub GdipAddPathBezier
+@ stdcall GdipAddPathArcI(ptr long long long long long long)
+@ stdcall GdipAddPathBezier(ptr long long long long long long long long)
@ stdcall GdipAddPathBezierI(ptr long long long long long long long long)
@ stdcall GdipAddPathBeziers(ptr ptr long)
@ stub GdipAddPathBeziersI
Index: dlls/gdiplus/graphicspath.c
===================================================================
RCS file: /home/wine/wine/dlls/gdiplus/graphicspath.c,v
retrieving revision 1.33
diff -u -r1.33 graphicspath.c
--- dlls/gdiplus/graphicspath.c    4 Apr 2008 11:24:06 -0000    1.33
+++ dlls/gdiplus/graphicspath.c    7 Apr 2008 18:56:45 -0000
@@ -97,6 +97,13 @@
   return Ok;
}

+GpStatus WINGDIPAPI GdipAddPathArcI(GpPath *path, INT x1, INT y1, INT x2,
+    INT y2, REAL startAngle, REAL sweepAngle)
+{
+    TRACE("%p %d %d %d %d %f %f\n",path,x1,y1,x2,y2,startAngle,sweepAngle);
+    return GdipAddPathArc(path, (REAL)x1, (REAL)y1, (REAL)x2, {REAL)y2,
startAngle, sweepAngle);
+}
+
GpStatus WINGDIPAPI GdipAddPathBezierI(GpPath *path, INT x1, INT y1, INT x2,
   INT y2, INT x3, INT y3, INT x4, INT y4)
{
@@ -158,6 +165,23 @@
   return Ok;
}

+GpStatus WINGDIPAPI GdipAddPathBezier(GpPath *path, REAL x1, REAL y1, REAL
x2, REAL y2, REAL x3, REAL y3, REAL x4, REAL y4)
+{
+    GpPointF points[3];
+
+    points[0].X = x1;
+    points[0].Y = y1;
+    points[1].X = x2;
+    points[1].Y = y2;
+    points[2].X = x3;
+    points[2].Y = y3;
+    points[3].X = x4;
+    points[3].Y = y4;
+
+    TRACE("%p %f %f %f %f %f %f\n",path,x1,y1,x2,y2,x3,y3,x4,y4);
+    return GdipAddPathBeziers(path, points, 4);
+}
+
GpStatus WINGDIPAPI GdipAddPathEllipse(GpPath *path, REAL x, REAL y, REAL
width,
   REAL height)
{

Index: include/gdiplusflat.h
===================================================================
RCS file: /home/wine/wine/include/gdiplusflat.h,v
retrieving revision 1.155
diff -u -r1.155 gdiplusflat.h
--- include/gdiplusflat.h    24 Mar 2008 12:57:16 -0000    1.155
+++ include/gdiplusflat.h    7 Apr 2008 18:55:25 -0000
@@ -182,6 +182,8 @@
GpStatus WINGDIPAPI GdipSetTextureTransform(GpTexture *,GDIPCONST
GpMatrix*);

GpStatus WINGDIPAPI GdipAddPathArc(GpPath*,REAL,REAL,REAL,REAL,REAL,REAL);
+GpStatus WINGDIPAPI GdipAddPathArcI(GpPath*,INT,INT,INT,INT,REAL,REAL);
+GpStatus WINGDIPAPI
GdipAddPathBezier(GpPath*,REAL,REAL,REAL,REAL,REAL,REAL,REAL,REAL);
GpStatus WINGDIPAPI
GdipAddPathBezierI(GpPath*,INT,INT,INT,INT,INT,INT,INT,INT);
GpStatus WINGDIPAPI GdipAddPathBeziers(GpPath*,GDIPCONST GpPointF*,INT);
GpStatus WINGDIPAPI GdipAddPathEllipse(GpPath*,REAL,REAL,REAL,REAL);
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080409/0d615f75/attachment.htm 

From luis.busquets at ilidium.com  Wed Apr  9 05:52:34 2008
From: luis.busquets at ilidium.com (Luis Busquets)
Date: Wed, 09 Apr 2008 12:52:34 +0200
Subject: d3dx8: D3DXGetFVFVertexSize 2/4
In-Reply-To: <d658b69e0804090007t619c4647gcb608d8c044f8ab9@mail.gmail.com>
References: <47FBBDB0.6010708@ilidium.com>
	<d658b69e0804090007t619c4647gcb608d8c044f8ab9@mail.gmail.com>
Message-ID: <47FC9FF2.8050604@ilidium.com>

I do not understand what you mean. I have added the test in patch 1/4 
and the implementation in 2/4. I have done so as D3DXGetFVFVertexSize 
was already implemented as a stub and test 1/4 obviously shows that 
until you apply implmentation 2/4. Is this not correct?

How should I proceed? Do I merge both patches (1 and) in just one?

H. Verbeet escribio':
> On 08/04/2008, Luis Busquets <luis.busquets at ilidium.com> wrote:
>   
>> Implementation of D3DXGetFVFVertexSize. With this patch WINE responds
>> correctly to the tests of D3DXGetFVFVertexSize sent in patch 1/4 of today.
>>
>>     
> You have to either send the implementation first and the test
> afterwards, or wrap the test in a todo_wine block, and remove it when
> you send the implementation.
>
>
>   

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080409/e110c398/attachment.htm 

From tony.wasserka at freenet.de  Wed Apr  9 06:27:41 2008
From: tony.wasserka at freenet.de (tony.wasserka at freenet.de)
Date: Wed, 09 Apr 2008 13:27:41 +0200
Subject: d3dx8 [6/7] Implement D3DXMatrixStack_Push
Message-ID: <E1JjYSr-0001tH-DU@www9.emo.freenet-rz.de>

> > +    This->current = This->current +1;
> > +    HeapReAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, This->matrix, (This->current +1) * sizeof(D3DXMATRIX) );
> > +    if ( This->matrix == NULL ) return E_OUTOFMEMORY;

> Aside from being a bit suboptimal (doing a realloc on every push),
> this probably doesn't do what you want. Consider what happens to the
> size of the array when you do something like push/pop/push/pop/...etc.
> 
> It would be better to keep track of the current stack size, and then
> grow it by a factor (eg. 2 or 1.5) if a push would overflow the
> current stack. You could also consider shrinking the array again if a
> pop would make it use less than a certain percentage of the current
> size (eg. a third).
> 
> You should also assign the result of HeapReAlloc() to This->matrix
> again. Although it's quite possible for HeapReAlloc to just grow the
> current block without changing its location, there's no guarantee it
> will. The NULL check is useless this way.

Just a little addition, I think we should resize the stack differently at different situations, i.e.:
- resize it to (This->current+3) if This->currect<5 (something around that is the minimum number of matrices for which anyone would even bother using a MatrixStack)
- resize it to (This->current*2) if This->current<12 (when it seems like the application's gonna push many matrices on the stack)
- resize it to (This->current+16) if This->current>=12 (when *2 could waste memory)
However, I don't know if these numbers are optimal, it's just a suggestion.

For the Pop function, I agree that you should free some memory when it's unused, but my suggestion from above fits here, too. However, one third is okay, too, as it isn't that relevant here.











From stefan at codeweavers.com  Wed Apr  9 07:16:44 2008
From: stefan at codeweavers.com (Stefan =?utf-8?q?D=C3=B6singer?=)
Date: Wed, 9 Apr 2008 14:16:44 +0200
Subject: GL_ATI_fragment_shader and GL_INVALID 0x501, 0x502
In-Reply-To: <e1d9e62c0804090312m41dbf12bta045b2c5272106bf@mail.gmail.com>
References: <e1d9e62c0804071637n76680520ge942d21e4bf8f81f@mail.gmail.com>
	<200804090918.12309.stefan@codeweavers.com>
	<e1d9e62c0804090312m41dbf12bta045b2c5272106bf@mail.gmail.com>
Message-ID: <200804091416.44718.stefan@codeweavers.com>

Am Mittwoch, 9. April 2008 12:12:20 schrieb Milan Kosti?:
>  Eh yes, i just checked what is difference between 9000 and 9250 and
> find that 9000 has 4/2 units, but 9250 has 4/1. One physical unit
> left! And this is likely problem because ati_fs is linked to max units
> which is 6 in driver, but this card has only 5;). Seems to one is
> emulated:D. I don't know, i think that my neighbour have 9100 (which
> also has 4/2) in his vault and i'm must wine:) with that card first
> (which is very possibly not working?:D) and if that is bug, i will
> fill one massive bug for that thing on Mesa side:) and just hope that
> someone of retired r200 devs will go back to business and improve
> driver... Thanks for reading all this posts anyway.
I doubt 3DMark2001 uses all 6 texture units even in the high shader test 
because it works on Nvidia cards which only support 4 simultaneous textures. 
If it uses 4 textures and 6 or more texture stages(ie, texture stage settings 
that do not sample from a texture), it might be worth looking into the 
texture map stuff we're using with the nvidia register combiner code. With 
atifs we can support 6 simultaneous textures and 8 texture stages.


From saulius2 at ar.fi.lt  Wed Apr  9 07:09:46 2008
From: saulius2 at ar.fi.lt (Saulius Krasuckas)
Date: Wed, 9 Apr 2008 15:09:46 +0300 (EEST)
Subject: LoadStringW [1/2]
In-Reply-To: <027701c89a24$1752ed70$a600fea9@DMITRY>
References: <4794545B.4000909@procyongames.com><005101c85c07$b280a180$a600fea9@DMITRY><000601c85c08$f006a440$a600fea9@DMITRY><4794FD3E.2080204@procyongames.com><22821af30801211217g22c09c8bu597659ab11aafff0@mail.gmail.com><479504E4.4080401@procyongames.com><22821af30801211252l30be545cqc9cf37bb4b89451c@mail.gmail.com><47950AEF.9060409@procyongames.com><Pine.LNX.4.62.0804032333300.6745@tvarka.ar.fi.lt><006401c895f9$07c167d0$a600fea9@DMITRY><Pine.LNX.4.62.0804061603190.17765@tvarka.ar.fi.lt><001e01c8985f$1449e000$a600fea9@DMITRY>
	<Pine.LNX.4.62.0804091213280.6351@tvarka.ar.fi.lt>
	<027701c89a24$1752ed70$a600fea9@DMITRY>
Message-ID: <Pine.LNX.4.62.0804091444050.6351@tvarka.ar.fi.lt>

* On Wed, 9 Apr 2008, Dmitry Timoshkov wrote:
> * "Saulius Krasuckas" <saulius2 at ar.fi.lt> wrote:
> > 
> > You still have not answered my question: how regression in question 
> > can be identified only by reading Wine code (at least in case of 
> > LoadStringA).
> 
> I have no idea how the word 'only' has appeared in the sentence above,

I am sorry for my hurry, it's really unnecessary here.

> and why it's not clear to you that reading Wine code is one of possible
> ways to understand what the patchs does, and see possible improvements or
> regressions caused by a patch. Or you know development methods which don't
> require reading and understanding the code you are going to modify?

Well, what I meant was if you haven't tested LoadStringA in Windows, then 
reading code won't help you to see a bug in it.  Excuse me my English, if 
earlier msgs of mine didn't sound like that.

Such is specifity (peculiarity) of any API translator, no?

> I don't follow your logic here.

Well, switching to private comm.


From smoki00790 at gmail.com  Wed Apr  9 07:33:26 2008
From: smoki00790 at gmail.com (=?ISO-8859-2?Q?Milan_Kosti=E6?=)
Date: Wed, 9 Apr 2008 14:33:26 +0200
Subject: GL_ATI_fragment_shader and GL_INVALID 0x501, 0x502
In-Reply-To: <200804091416.44718.stefan@codeweavers.com>
References: <e1d9e62c0804071637n76680520ge942d21e4bf8f81f@mail.gmail.com>
	<200804090918.12309.stefan@codeweavers.com>
	<e1d9e62c0804090312m41dbf12bta045b2c5272106bf@mail.gmail.com>
	<200804091416.44718.stefan@codeweavers.com>
Message-ID: <e1d9e62c0804090533g5b505f43od13e67b41c322024@mail.gmail.com>

 Yes that's sounds good! And to say that i'm checkedout more about
diffs with our cards and found something in wikipedia article. 9000
and 9250 both has 4/1 units, cards are with the same units setup, only
rv280 has 8x AGP bus. And 9000 pro version is same, but with higher
core and memory clocks and better bandwidth.

 http://en.wikipedia.org/wiki/Comparison_of_ATI_graphics_processing_units

 And then that's not a problem:(. I don't know what to say to the Mesa
developers: I'm have hard freeze with current wine, with just one game
when units are on default? Huh, I don't think thats will remove all
this bugs.


From wine-devel at kievinfo.com  Wed Apr  9 08:22:17 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Wed, 09 Apr 2008 07:22:17 -0600
Subject: d3dx8: D3DXGetFVFVertexSize 2/4
In-Reply-To: <47FC9FF2.8050604@ilidium.com>
References: <47FBBDB0.6010708@ilidium.com>	<d658b69e0804090007t619c4647gcb608d8c044f8ab9@mail.gmail.com>
	<47FC9FF2.8050604@ilidium.com>
Message-ID: <47FCC309.9020202@kievinfo.com>

Luis Busquets wrote:
> H. Verbeet escribi?:
>> On 08/04/2008, Luis Busquets <luis.busquets at ilidium.com> wrote:
>>   
>>> Implementation of D3DXGetFVFVertexSize. With this patch WINE responds
>>> correctly to the tests of D3DXGetFVFVertexSize sent in patch 1/4 of today.
>>>
>>>     
>> You have to either send the implementation first and the test
>> afterwards, or wrap the test in a todo_wine block, and remove it when
>> you send the implementation.
>>
 > I do not understand what you mean. I have added the test in patch 1/4
 > and the implementation in 2/4. I have done so as D3DXGetFVFVertexSize
 > was already implemented as a stub and test 1/4 obviously shows that
 > until you apply implmentation 2/4. Is this not correct?
 >
 > How should I proceed? Do I merge both patches (1 and) in just one?
 >
Regardless of what you adding and when tests should never fail or your patch 
will be rejected.

If you adding tests first that don't pass on current Wine mark each test 
with todo_wine. This is special wrapper around the test that indicates it's 
ok for this test to fail.

When you running tests manually it will still appear they fail. But when you 
run 'make test' those tests will pass.


Vitaliy.


From rob at codeweavers.com  Wed Apr  9 08:39:50 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Wed, 09 Apr 2008 14:39:50 +0100
Subject: msdmo: Array parameter is passed to function as pointer so loses
	size	information
In-Reply-To: <200804072239.34412.andrew.talbot@talbotville.com>
References: <200804072239.34412.andrew.talbot@talbotville.com>
Message-ID: <47FCC726.60406@codeweavers.com>

Andrew Talbot wrote:
> @@ -291,8 +291,9 @@ lend:
>   *
>   * Get DMP Name from the registry
>   */
> -HRESULT WINAPI DMOGetName(REFCLSID clsidDMO, WCHAR szName[80])
> +HRESULT WINAPI DMOGetName(REFCLSID clsidDMO, WCHAR szName[])
>  {
> +#define NAME_SIZE   80  /* Size of szName[] */
>      WCHAR szguid[64];
>      HRESULT hres;
>      HKEY hrkey = 0;
> @@ -311,7 +312,7 @@ HRESULT WINAPI DMOGetName(REFCLSID clsidDMO, WCHAR szName[80])
>      if (ERROR_SUCCESS != hres)
>          goto lend;
>  
> -    count = sizeof(szName);
> +    count = NAME_SIZE;
>      hres = RegQueryValueExW(hkey, NULL, NULL, NULL, 
>          (LPBYTE) szName, &count); 
>   

This is incorrect. count is the size in bytes of the buffer passed in 
(szName) and so should be sizeof(szName) not 
sizeof(szName)/sizeof(szName[0]) (i.e. 80).

I see this patch has already been committed, so 
a9200b24014607c4c82fb052b97de88daa804a81 should be reverted.

If you want to pick up errors like passing the wrong size into functions 
then I would suggest using an automatic checker that is able to use 
semantic information, like Microsoft's PREfast.

-- 
Rob Shearman



From dank at kegel.com  Wed Apr  9 09:03:47 2008
From: dank at kegel.com (Dan Kegel)
Date: Wed, 9 Apr 2008 07:03:47 -0700
Subject: New winetricks-20080409: new verb vista, don't get confused by WGETRC,
	use curl and openssl if needed
Message-ID: <a71bd89a0804090703t2c61214y9d8b35a3ee7c9484@mail.gmail.com>

Another day, another winetricks.

Version 20080409 has the following changes:

Added winver=vista, since I found an app that refuses to install
if winnt <= 502.

Use curl and openssl instead of wget and sha1sum if needed (e.g. on
mac), as suggested by Ryan Schmidt

Use -nd option with wget, as suggested by Hin-Tak Leung

As always, winetricks is available at
   http://kegel.com/wine/winetricks


From thestig at google.com  Wed Apr  9 11:13:01 2008
From: thestig at google.com (Lei Zhang)
Date: Wed, 9 Apr 2008 09:13:01 -0700
Subject: Updated three Power Profile functions to match MSDN
In-Reply-To: <00a801c89a0a$607c52d0$a600fea9@DMITRY>
References: <ed7be3850804081928i666ced0ch51e8d8ede8a9a2cc@mail.gmail.com>
	<00a801c89a0a$607c52d0$a600fea9@DMITRY>
Message-ID: <558b2f5c0804090913y33f85d7ag30c9ecbcff1de6e9@mail.gmail.com>

On Tue, Apr 8, 2008 at 11:24 PM, Dmitry Timoshkov
<dmitry at codeweavers.com> wrote:
> "Black Dragon" <blackdragon1157 at gmail.com> wrote:
>
>  First of all Wine doesn't accept patches from an anonymous person,
>  please use your real name.
>

He did use his real name in the attachment. Probably just need to
configure his email client properly.


From zgs at seas.upenn.edu  Wed Apr  9 11:25:20 2008
From: zgs at seas.upenn.edu (Zachary Goldberg)
Date: Wed, 9 Apr 2008 12:25:20 -0400
Subject: .net 2 first light on nontrivial apps
In-Reply-To: <a71bd89a0804082356w7414de5fufe9e2792e824c88f@mail.gmail.com>
References: <a71bd89a0804082356w7414de5fufe9e2792e824c88f@mail.gmail.com>
Message-ID: <b050a5e70804090925j4680f52ah8f65010b8e7482e2@mail.gmail.com>

On Wed, Apr 9, 2008 at 2:56 AM, Dan Kegel <dank at kegel.com> wrote:
> It looks like 'winetricks dotnet20' and current wine
>  is good enough that .net support isn't quite the
>  limiting factor anymore!  See
>  http://bugs.winehq.org/show_bug.cgi?id=8499
>  http://bugs.winehq.org/show_bug.cgi?id=12457
>  http://bugs.winehq.org/show_bug.cgi?id=12458
>  for three sizeable apps that actually put up
>  their GUIs, at least briefly.  MySQL Workbench
>  actually runs well enough to explore the GUI.
>
>
>

Hm, looks like we'll have to begin to get used to
"System.NotImplementedException"s :).  Do crashing .net apps still
print the full wine stack trace as well?



-- 
Zachary Goldberg
Computer Science & Engineering
Electrical Captain of Penn Electric Race Team
School of Engineering at the University of Pennsylvania


From Andrew.Talbot at talbotville.com  Wed Apr  9 11:54:53 2008
From: Andrew.Talbot at talbotville.com (Andrew Talbot)
Date: Wed, 09 Apr 2008 17:54:53 +0100
Subject: msdmo: Array parameter is passed to function as pointer so loses
	size	information
References: <200804072239.34412.andrew.talbot@talbotville.com>
	<47FCC726.60406@codeweavers.com>
Message-ID: <ftisct$ha8$1@ger.gmane.org>

Robert Shearman wrote:
> This is incorrect. count is the size in bytes of the buffer passed in
> (szName) and so should be sizeof(szName) not
> sizeof(szName)/sizeof(szName[0]) (i.e. 80).
> 

Are you sure? MSDN says "szName: Array of 80 Unicode characters that
receives the name of the DMO".

> If you want to pick up errors like passing the wrong size into functions
> then I would suggest using an automatic checker that is able to use
> semantic information, like Microsoft's PREfast.
> 

Your implied presumption may not be correct. But, in any case, when arrays
are passed as arguments to functions they are converted to pointers, so
sizeof(szName) would represent the size of a pointer to the array, not the
size of the array itself.

-- 
Andy.




From dank at kegel.com  Wed Apr  9 11:56:44 2008
From: dank at kegel.com (Dan Kegel)
Date: Wed, 9 Apr 2008 09:56:44 -0700
Subject: .net 2 first light on nontrivial apps
In-Reply-To: <b050a5e70804090925j4680f52ah8f65010b8e7482e2@mail.gmail.com>
References: <a71bd89a0804082356w7414de5fufe9e2792e824c88f@mail.gmail.com>
	<b050a5e70804090925j4680f52ah8f65010b8e7482e2@mail.gmail.com>
Message-ID: <a71bd89a0804090956i10e26ddem6b239b5add853e54@mail.gmail.com>

On Wed, Apr 9, 2008 at 9:25 AM, Zachary Goldberg <zgs at seas.upenn.edu> wrote:
>  Hm, looks like we'll have to begin to get used to
>  "System.NotImplementedException"s :).  Do crashing .net apps still
>  print the full wine stack trace as well?

Not usefully, that I could see, anyway.  Maybe if run inside winedbg.


From austinenglish at gmail.com  Wed Apr  9 12:08:40 2008
From: austinenglish at gmail.com (Austin English)
Date: Wed, 9 Apr 2008 12:08:40 -0500
Subject: Compile broken on Ubuntu Hardy/gutsy/feisty
Message-ID: <b6bb06270804091008t7b558a3cu84807ca16405f7f7@mail.gmail.com>

In today's git, I can't compile in either my Kubuntu Hardy or Ubuntu
feisty machines. A user also reported this on wine-user (1), using
Ubuntu Gutsy (64bit). Compile is failing in make depend on:

make[2]: Entering directory `/home/austin/wine-git/dlls/qedit/tests'
../../../tools/makedep -C. -S../../.. -T../../..  mediadet.c  qedit.rc
sound_test.avi: No such file or directory
  sound_test.avi was first included from qedit.rc:25
make[2]: *** [depend] Error 1
make[2]: Leaving directory `/home/austin/wine-git/dlls/qedit/tests'
make[1]: *** [qedit/tests/__depend__] Error 2
make[1]: Leaving directory `/home/austin/wine-git/dlls'
make: *** [dlls/__depend__] Error 2

Regression test points to:

austin at austin-desktop:~/wine-git$ git bisect good
d3061d48e1c78c331b93be7a880876ebff2730dd is first bad commit
commit d3061d48e1c78c331b93be7a880876ebff2730dd
Author: Dan Hipschman <dsh at linux.ucla.edu>
Date:   Tue Apr 8 16:53:52 2008 -0700

    qedit: Implement IMediaDet_get_OutputStreams.

:040000 040000 a897c878bae291a217075d8a2db3c6d04de1ad2a
6d6e883a2629e004b361ceb844a0ca0680a1fa75 M      dlls

The patch below fixes it:
diff --git a/dlls/qedit/tests/qedit.rc b/dlls/qedit/tests/qedit.rc
index a0b8b80..733beac 100644
--- a/dlls/qedit/tests/qedit.rc
+++ b/dlls/qedit/tests/qedit.rc
@@ -22,5 +22,5 @@

 /* @makedep: test.avi */
 TEST_AVI_RES       AVI_RES_TYPE test.avi
-/* @makedep: sound_test.avi */
+/* @makedep: test_sound.avi */
 TEST_SOUND_AVI_RES AVI_RES_TYPE test_sound.avi

I'll submit it to wine-patches.
(1) http://forum.winehq.org/viewtopic.php?t=498


From david.adam.cnrs at gmail.com  Wed Apr  9 03:54:37 2008
From: david.adam.cnrs at gmail.com (David Adam)
Date: Wed, 9 Apr 2008 10:54:37 +0200
Subject: Implement D3DXMatrixStack_Push
Message-ID: <5f9140a20804090154q53cdf45bn1ffb68c18a7f21ca@mail.gmail.com>

On 08/04/2008, David Adam <david.adam.cnrs at gmail.com
<http://www.winehq.org/mailman/listinfo/wine-patches>> wrote:
>* +    This->current = This->current +1;
*>* +    HeapReAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, This->matrix,
(This->current +1) * sizeof(D3DXMATRIX) );
*>* +    if ( This->matrix == NULL ) return E_OUTOFMEMORY;
*
> Aside from being a bit suboptimal (doing a realloc on every push),
> this probably doesn't do what you want. Consider what happens to the
> size of the array when you do something like push/pop/push/pop/...etc.
>
> It would be better to keep track of the current stack size, and then
> grow it by a factor (eg. 2 or 1.5) if a push would overflow the
> current stack.
> You could also consider shrinking the array again if a
> pop would make it use less than a certain percentage of the current
> size (eg. a third).

This would increase the size of the stack exponentially. Would it be
better to do this:
Take a stack_size_reference (for instance 32 items)
When This->current =32, then increase the size of the stack of
stack_size_reference (that is 64 items now)
Then when This->current is =64, again increase the size of the stack
of stack_size_reference (that is 98 items now), and so on....

This would increase the size of the stack linearly instead of exponentially.

In the opposite, for MatrixStack_Pop, assume that the size of the
stack is 98 and This->current is 64.
Then one could shrink the size of the stack from 98 to
98-size_stack_reference that is 64.


> You should also assign the result of HeapReAlloc() to This->matrix
> again.

*I thought that

 HeapReAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, This->matrix, ..........);**
*
do exactly what you say


Although it's quite possible for HeapReAlloc to just grow the
> current block without changing its location, there's no guarantee it
> will. The NULL check is useless this way.

Thanks for your very useful feedback.

David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080409/b9f859ed/attachment.htm 

From dsh at linux.ucla.edu  Wed Apr  9 12:59:26 2008
From: dsh at linux.ucla.edu (Dan Hipschman)
Date: Wed, 9 Apr 2008 10:59:26 -0700
Subject: qedit: fix compile error in qedit.rc
In-Reply-To: <b6bb06270804091010t1cf55a99xed92e5fa49bd495b@mail.gmail.com>
References: <b6bb06270804091010t1cf55a99xed92e5fa49bd495b@mail.gmail.com>
Message-ID: <20080409175926.GH11580@linux.ucla.edu>

On Wed, Apr 09, 2008 at 12:10:55PM -0500, Austin English wrote:
>  /* @makedep: test.avi */
>  TEST_AVI_RES       AVI_RES_TYPE test.avi
> -/* @makedep: sound_test.avi */
> +/* @makedep: test_sound.avi */
>  TEST_SOUND_AVI_RES AVI_RES_TYPE test_sound.avi

Oops, sorry, and thanks for fixing it.


From wine.dev at web.de  Wed Apr  9 13:13:44 2008
From: wine.dev at web.de (Detlef Riekenberg)
Date: Wed, 09 Apr 2008 20:13:44 +0200
Subject: [2/2] winspool.drv: GetDefaultPrinterW reads the value from
	data in registry
In-Reply-To: <200804081539.16315.kondratyuk@etersoft.ru>
References: <200804081539.16315.kondratyuk@etersoft.ru>
Message-ID: <1207764825.15786.13.camel@p4>

On Di, 2008-04-08 at 15:39 +0400, Konstantin Kondratyuk wrote:
> -    if (!GetProfileStringW(windowsW, deviceW, emptyStringW, buffer,
> len))
> +    if(!RegOpenKeyW(HKEY_CURRENT_USER, user_default_reg_key, &hKey) 
> +            && !RegQueryValueExW(hKey, keyname, NULL, &type,
> (LPBYTE)buffer, &bufsize))
> +    {
> +        TRACE("Get value from registry\n");
> +        RegCloseKey( hKey );
> +    }

win3.x and win9.x use only "win.ini".
We need to fix bug #4096, before we can switch to the Registry.

> +    else if (!GetProfileStringW(windowsW, deviceW, emptyStringW,
> buffer, len))

There is no need for a Fallback, when bug #4096 is fixed.


-- 
 
By by ... Detlef




From stefan at codeweavers.com  Wed Apr  9 13:37:07 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Wed, 9 Apr 2008 20:37:07 +0200
Subject: Implement D3DXMatrixStack_Push
In-Reply-To: <5f9140a20804090154q53cdf45bn1ffb68c18a7f21ca@mail.gmail.com>
References: <5f9140a20804090154q53cdf45bn1ffb68c18a7f21ca@mail.gmail.com>
Message-ID: <200804092037.07459.stefan@codeweavers.com>

Am Mittwoch, 9. April 2008 10:54:37 schrieb David Adam:
> On 08/04/2008, David Adam <david.adam.cnrs at gmail.com
>
> <http://www.winehq.org/mailman/listinfo/wine-patches>> wrote:
> >* +    This->current = This->current +1;
>
> *>* +    HeapReAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, This->matrix,
> (This->current +1) * sizeof(D3DXMATRIX) );
> *>* +    if ( This->matrix == NULL ) return E_OUTOFMEMORY;
> *
>
> > Aside from being a bit suboptimal (doing a realloc on every push),
> > this probably doesn't do what you want. Consider what happens to the
> > size of the array when you do something like push/pop/push/pop/...etc.
> >
> > It would be better to keep track of the current stack size, and then
> > grow it by a factor (eg. 2 or 1.5) if a push would overflow the
> > current stack.
> > You could also consider shrinking the array again if a
> > pop would make it use less than a certain percentage of the current
> > size (eg. a third).
>
> This would increase the size of the stack exponentially. Would it be
> better to do this:
> Take a stack_size_reference (for instance 32 items)
> When This->current =32, then increase the size of the stack of
> stack_size_reference (that is 64 items now)
> Then when This->current is =64, again increase the size of the stack
> of stack_size_reference (that is 98 items now), and so on....
>
> This would increase the size of the stack linearly instead of
> exponentially.
You usually grow the memory by a factor of the old size because this reduces 
the number of needed grows. So growing the stack is an O(log(n)) instead of 
O(n), which is a huge difference.

The drawback is that you have potentially more wasted memory. I don't know 
what the theory says to that though. The amount of wasted memory is always 
smaller than the amount of used memory at least if you double the size and 
smaller if you grow it by 1/2 of the existing size, ...


From xixsimplicityxix at gmail.com  Wed Apr  9 13:38:01 2008
From: xixsimplicityxix at gmail.com (John Klehm)
Date: Wed, 9 Apr 2008 13:38:01 -0500
Subject: msdmo: Array parameter is passed to function as pointer so loses
	size information
In-Reply-To: <ftisct$ha8$1@ger.gmane.org>
References: <200804072239.34412.andrew.talbot@talbotville.com>
	<47FCC726.60406@codeweavers.com> <ftisct$ha8$1@ger.gmane.org>
Message-ID: <78a7dad00804091138o50a3d2ejb90c6dfaca771505@mail.gmail.com>

On Wed, Apr 9, 2008 at 11:54 AM, Andrew Talbot
<Andrew.Talbot at talbotville.com> wrote:
> Robert Shearman wrote:
>  > This is incorrect. count is the size in bytes of the buffer passed in
>  > (szName) and so should be sizeof(szName) not
>  > sizeof(szName)/sizeof(szName[0]) (i.e. 80).
>  >
>
Andrew T is right about arrays being decayed to pointers when passed
into functions, so sizeof(szName) is going to reuturn 4 or 8 or
whatever.  If count needs to be the size of the buffer shouldn't it
be:

count = NAME_SIZE * sizeof(WCHAR);

but probably better would be DMO_MAX_NAME_SIZE and be in a header
somewhere (dmo.h?)?

Regards,
John


From thestig at google.com  Wed Apr  9 13:38:29 2008
From: thestig at google.com (Lei Zhang)
Date: Wed, 9 Apr 2008 11:38:29 -0700
Subject: [PATCH 3/3] user32: fix a typo. (resend)
Message-ID: <558b2f5c0804091138q32a7aac4pb91993c34189667a@mail.gmail.com>

Resending...
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: 0003-user32-fix-a-typo.txt
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20080409/adfdcdce/attachment.txt 

From Andrew.Talbot at talbotville.com  Wed Apr  9 14:18:19 2008
From: Andrew.Talbot at talbotville.com (Andrew Talbot)
Date: Wed, 09 Apr 2008 20:18:19 +0100
Subject: msdmo: Array parameter is passed to function as pointer so loses
	size information
References: <200804072239.34412.andrew.talbot@talbotville.com>
	<47FCC726.60406@codeweavers.com> <ftisct$ha8$1@ger.gmane.org>
	<78a7dad00804091138o50a3d2ejb90c6dfaca771505@mail.gmail.com>
Message-ID: <ftj4pr$i1a$1@ger.gmane.org>

John Klehm wrote:

If count needs to be the size of the buffer shouldn't it
> be:
> 
> count = NAME_SIZE * sizeof(WCHAR);
> 
> but probably better would be DMO_MAX_NAME_SIZE and be in a header
> somewhere (dmo.h?)?
> 
> Regards,
> John

Ah yes, whoops. I'm pretty sure I had just that lined up, but I reckon I
must have done an 'undo' or something and taken off the multiplier. I'm
hesitant to create a header just for one constant, so I shall send a patch
to bring in the multiplier and with the more descriptive name, since
Alexandre rightly dropped my descriptive comment.

Thanks for catching that!

-- 
Andy.




From hverbeet at gmail.com  Wed Apr  9 15:41:25 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Wed, 9 Apr 2008 22:41:25 +0200
Subject: Implement D3DXMatrixStack_Push
In-Reply-To: <200804092037.07459.stefan@codeweavers.com>
References: <5f9140a20804090154q53cdf45bn1ffb68c18a7f21ca@mail.gmail.com>
	<200804092037.07459.stefan@codeweavers.com>
Message-ID: <d658b69e0804091341m2a745e50w740ca0ce1b91c6a1@mail.gmail.com>

On 09/04/2008, Stefan D?singer <stefan at codeweavers.com> wrote:
> You usually grow the memory by a factor of the old size because this reduces
>  the number of needed grows. So growing the stack is an O(log(n)) instead of
>  O(n), which is a huge difference.
>
No, the amortized time per push is O(1). The realloc becomes more
expensive as the array gets larger.

>  The drawback is that you have potentially more wasted memory. I don't know
>  what the theory says to that though. The amount of wasted memory is always
>  smaller than the amount of used memory at least if you double the size and
>  smaller if you grow it by 1/2 of the existing size, ...
>
On average the percentage of wasted memory is (factor - 1) / 2. You
make a trade of between memory usage and run time when picking the
factor.


From wine.dev at web.de  Wed Apr  9 15:42:32 2008
From: wine.dev at web.de (Detlef Riekenberg)
Date: Wed, 09 Apr 2008 22:42:32 +0200
Subject: Compile broken on Ubuntu Hardy/gutsy/feisty
In-Reply-To: <b6bb06270804091008t7b558a3cu84807ca16405f7f7@mail.gmail.com>
References: <b6bb06270804091008t7b558a3cu84807ca16405f7f7@mail.gmail.com>
Message-ID: <1207773752.15786.15.camel@p4>

On Mi, 2008-04-09 at 12:08 -0500, Austin English wrote:
> In today's git, I can't compile in either my Kubuntu Hardy or Ubuntu
> feisty machines. A user also reported this on wine-user (1), using
> Ubuntu Gutsy (64bit). Compile is failing in make depend on:

It's fixed in git. Mikolaj did a Patch hours ago.


-- 
 
By by ... Detlef




From stefan at codeweavers.com  Wed Apr  9 15:58:41 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Wed, 9 Apr 2008 22:58:41 +0200
Subject: Implement D3DXMatrixStack_Push
In-Reply-To: <d658b69e0804091341m2a745e50w740ca0ce1b91c6a1@mail.gmail.com>
References: <5f9140a20804090154q53cdf45bn1ffb68c18a7f21ca@mail.gmail.com>
	<200804092037.07459.stefan@codeweavers.com>
	<d658b69e0804091341m2a745e50w740ca0ce1b91c6a1@mail.gmail.com>
Message-ID: <200804092258.41769.stefan@codeweavers.com>

Am Mittwoch, 9. April 2008 22:41:25 schrieb H. Verbeet:
> On 09/04/2008, Stefan D?singer <stefan at codeweavers.com> wrote:
> > You usually grow the memory by a factor of the old size because this
> > reduces the number of needed grows. So growing the stack is an O(log(n))
> > instead of O(n), which is a huge difference.
>
> No, the amortized time per push is O(1). The realloc becomes more
> expensive as the array gets larger.
Good point



From truiken at gmail.com  Wed Apr  9 16:22:29 2008
From: truiken at gmail.com (James Hawkins)
Date: Wed, 9 Apr 2008 16:22:29 -0500
Subject: msdmo: Fix calculation of array size in bytes
In-Reply-To: <200804092216.37221.andrew.talbot@talbotville.com>
References: <200804092216.37221.andrew.talbot@talbotville.com>
Message-ID: <22821af30804091422i30d02be6k585100de1304a7d1@mail.gmail.com>

On Wed, Apr 9, 2008 at 4:16 PM, Andrew Talbot
<andrew.talbot at talbotville.com> wrote:
> Changelog:
>     msdmo: Fix calculation of array size in bytes.
>
>  diff --git a/dlls/msdmo/dmoreg.c b/dlls/msdmo/dmoreg.c
>  index f6d71bd..c6eb1b6 100644
>  --- a/dlls/msdmo/dmoreg.c
>  +++ b/dlls/msdmo/dmoreg.c
>  @@ -293,11 +293,11 @@ lend:
>   */
>   HRESULT WINAPI DMOGetName(REFCLSID clsidDMO, WCHAR szName[])
>   {
>  -#define NAME_SIZE   80  /* Size of szName[] */
>      WCHAR szguid[64];
>      HRESULT hres;
>      HKEY hrkey = 0;
>      HKEY hkey = 0;
>  +    enum {max_name_len = 80};
>      DWORD count;
>
>      TRACE("%s\n", debugstr_guid(clsidDMO));
>

Don't you think a static const int would be even better?

-- 
James Hawkins


From winehacker at gmail.com  Wed Apr  9 16:24:29 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Wed, 9 Apr 2008 17:24:29 -0400
Subject: optimizations for 1.0
In-Reply-To: <19e31a080804081954x63dd863by7847d7a48c8477a0@mail.gmail.com>
References: <19e31a080804081059y57be05c2k3a2f9c51646b8b8c@mail.gmail.com>
	<47FBD34F.4030609@open-vote.org>
	<19e31a080804081521p4106c3b6x45765c683a60f133@mail.gmail.com>
	<000a01c899e0$bab50a50$a600fea9@DMITRY>
	<19e31a080804081954x63dd863by7847d7a48c8477a0@mail.gmail.com>
Message-ID: <19e31a080804091424l19d5824fx3af46dd24d3b834f@mail.gmail.com>

On Tue, Apr 8, 2008 at 10:54 PM, Steven Edwards <winehacker at gmail.com> wrote:
>   I have a 64bit linux host and using -m32 with llvmgcc does not seem
>  to be very well documented. I expect to have problems with icc on
>  x86-64 also. Preconfigured LLVM packages for 2.2 work out of the box
>  on OS X where the current Ubuntu binary is at like 1.7 which does not
>  support inline asm. Don't worry, I'll try it in a 32bit linux vm with
>  my own build of llvm trunk and icc when I have more time.

I wasted a bit more time on this than I should have but I was able to
get the 32bit icc to work on my 64bit host to compile Wine with a few
hacks. I've documented the process on the wiki and submitted Wine test
results. If anyone else has time, please try icc on a 32bit host and
let me know if you get a crash when compiling oleaut32. Later when I
have more time I am going to run some benchmarks comparing a directx
game under wine compiled with gcc and icc.

http://wiki.winehq.org/icc
-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0003-icc-hacks.patch
Type: text/x-patch
Size: 5474 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080409/44363ca6/attachment.bin 

From Andrew.Talbot at talbotville.com  Wed Apr  9 16:58:31 2008
From: Andrew.Talbot at talbotville.com (Andrew Talbot)
Date: Wed, 09 Apr 2008 22:58:31 +0100
Subject: msdmo: Fix calculation of array size in bytes
References: <200804092216.37221.andrew.talbot@talbotville.com>
	<22821af30804091422i30d02be6k585100de1304a7d1@mail.gmail.com>
Message-ID: <ftje67$m53$1@ger.gmane.org>

James Hawkins wrote:

> 
> Don't you think a static const int would be even better?
> 

Indeed. Re-submission imminent.

Thanks,

-- 
Andy.




From stefan at codeweavers.com  Wed Apr  9 18:05:11 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Thu, 10 Apr 2008 01:05:11 +0200
Subject: [1/2] WineD3D: Do not activate CTXUSAGE_BLIT for fb -> texture
	reading
In-Reply-To: <200804100042.04689.stefan@codeweavers.com>
References: <200804100042.04689.stefan@codeweavers.com>
Message-ID: <200804100105.11201.stefan@codeweavers.com>

Am Donnerstag, 10. April 2008 00:42:04 schrieb Stefan D?singer:
> This ActivateContext call slipped in with patch
> ba90a740beb9ce9a839cc843db8d87f5a37becdd. Roderick, was there a particular
> reason why you activate CTXUSAGE_BLIT here, or was it just a copypaste
> mistake from the glReadPixels codepath?
I see now why the ActivateContext call is there. If the LoadLocation is not 
called from the PreLoad readback then a different surface might be active. 
Also CTXUSAGE_BLIT seems to be necessary in some situations, but I don't know 
which yet. I guess more investigation is needed here

So please do not apply the patches yet


From leslie_alistair at hotmail.com  Wed Apr  9 19:05:22 2008
From: leslie_alistair at hotmail.com (Alistair Leslie-Hughes)
Date: Thu, 10 Apr 2008 10:05:22 +1000
Subject: New winetricks-20080409: new verb vista,
	don't get confused by WGETRC, use curl and openssl if needed
References: <a71bd89a0804090703t2c61214y9d8b35a3ee7c9484@mail.gmail.com>
Message-ID: <ftjlf0$ata$1@ger.gmane.org>

"Dan Kegel" <dank at kegel.com> wrote in message 
news:a71bd89a0804090703t2c61214y9d8b35a3ee7c9484 at mail.gmail.com...
> Another day, another winetricks.
>
> Version 20080409 has the following changes:
>
> Added winver=vista, since I found an app that refuses to install
> if winnt <= 502.
>
> Use curl and openssl instead of wget and sha1sum if needed (e.g. on
> mac), as suggested by Ryan Schmidt
>
> Use -nd option with wget, as suggested by Hin-Tak Leung
>
> As always, winetricks is available at
>   http://kegel.com/wine/winetricks
Hi Dan,
  MDAC 2.7 needs to run under w2k or less or nothing will be installed.

Best Regards
 Alistair Leslie-Hughes 




From austinenglish at gmail.com  Wed Apr  9 20:04:42 2008
From: austinenglish at gmail.com (Austin English)
Date: Wed, 9 Apr 2008 20:04:42 -0500
Subject: %ALLUSERSPROFILE%
Message-ID: <b6bb06270804091804v362a2db6pdc8a1ad9d0886029@mail.gmail.com>

Wanted to get clarification before going through the trouble of
writing this patch.

Where would you prefer this variable Alexandre? I've seen two responses:

http://www.winehq.org/pipermail/wine-devel/2007-May/056555.html

http://www.winehq.org/pipermail/wine-devel/2005-March/035004.html

Trying to fix 7292 as well as a few others with this, but didn't want
to waste time on the wrong approach.

- Austin


From thestig at google.com  Wed Apr  9 20:15:14 2008
From: thestig at google.com (Lei Zhang)
Date: Wed, 9 Apr 2008 18:15:14 -0700
Subject: %ALLUSERSPROFILE%
In-Reply-To: <b6bb06270804091804v362a2db6pdc8a1ad9d0886029@mail.gmail.com>
References: <b6bb06270804091804v362a2db6pdc8a1ad9d0886029@mail.gmail.com>
Message-ID: <558b2f5c0804091815m193b6877pc385d843dbeabedf@mail.gmail.com>

On Wed, Apr 9, 2008 at 6:04 PM, Austin English <austinenglish at gmail.com> wrote:
> Wanted to get clarification before going through the trouble of
>  writing this patch.
>
>  Where would you prefer this variable Alexandre? I've seen two responses:
>
>  http://www.winehq.org/pipermail/wine-devel/2007-May/056555.html
>
>  http://www.winehq.org/pipermail/wine-devel/2005-March/035004.html
>
>  Trying to fix 7292 as well as a few others with this, but didn't want
>  to waste time on the wrong approach.
>
>  - Austin

From: http://bugs.winehq.org/show_bug.cgi?id=11058#c11

"It probably needs to be in shell32 since there is apparently no
exported dirid for it. The important thing is that it must be
localizable, that's why it can't be hardcoded to "All Users" in
wine.inf. Currently it's not handled quite right in shell32 either, so
that would probably have to be fixed first.


From thestig at google.com  Wed Apr  9 22:50:23 2008
From: thestig at google.com (Lei Zhang)
Date: Wed, 9 Apr 2008 20:50:23 -0700
Subject: [PATCH] user32: on VK_RETURN, send WM_COMMAND to ancestor,
	not parent.
In-Reply-To: <00b701c89a0a$cf37a4e0$a600fea9@DMITRY>
References: <558b2f5c0804040020w77698ed0v324e7dbae792098b@mail.gmail.com>
	<00a901c89657$3abcc4f0$a600fea9@DMITRY>
	<558b2f5c0804040747s3eb841cfma07c0b6ca236e8c1@mail.gmail.com>
	<018501c8966e$f65e4000$a600fea9@DMITRY>
	<558b2f5c0804041111v2daf31e4sbbf874e4424c1be4@mail.gmail.com>
	<558b2f5c0804042155h783268f0m2419aa2f65cf2a19@mail.gmail.com>
	<558b2f5c0804082301j31820986v72b2cd1baf6a2867@mail.gmail.com>
	<00b701c89a0a$cf37a4e0$a600fea9@DMITRY>
Message-ID: <558b2f5c0804092050h705eafd8g1880cc8c6796e62c@mail.gmail.com>

On Tue, Apr 8, 2008 at 11:27 PM, Dmitry Timoshkov
<dmitry at codeweavers.com> wrote:
> "Lei Zhang" <thestig at google.com> wrote:
>
>
> > I thought maybe the DS_CONTROL style caused the message to get
> > propagated up, like in DIALOG_FindMsgDestination(). So I did more
> > tests.
> >
> > I removed the DS_CONTROL style, but that didn't change the result of
> > the test. I also tried something more elaborate, where we have a
> > series of dialog windows, each of which contains another dialog
> > window... until the last one which contains the edit control. When I
> > send the edit control the VK_RETURN, the top most dialog window gets
> > the WM_COMMAND with wparam=IDOK. None of the dialog boxes between the
> > edit control and its ancestor gets the WM_COMMAND msg.
> >
>
>  I'd like to see a fully fledged message test for this, with all 'parent'
>  messages logged, and full window tree parent->child1->child2 checked.
>
>  --
>  Dmitry.
>

Nevermind, this patch is wrong. I already sent a patch to unbreak all
the dialog problems I caused.


From dmitry at codeweavers.com  Wed Apr  9 23:02:59 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Thu, 10 Apr 2008 13:02:59 +0900
Subject: kernel32: Fix for WritePrivateProfileString Sharing Problem
	[1/2](ATTEMPT 2)
References: <4c1ac96d0804092040m7e75f77ayce1a1274ddc9f404@mail.gmail.com>
Message-ID: <017b01c89abf$c56f35d0$a600fea9@DMITRY>

"Erich Hoover" <ehoover at mines.edu> wrote:

> +    oldError = GetLastError();
> +    /* Read and Write sharing are necessary if a flush is performed on an open file */
> +    hFile = CreateFileW(CurProfile->filename, GENERIC_WRITE, FILE_SHARE_READ | FILE_SHARE_WRITE, NULL, CREATE_ALWAYS, 
> FILE_ATTRIBUTE_NORMAL, NULL);
>      if (hFile == INVALID_HANDLE_VALUE)
>      {
>          WARN("could not save profile file %s (error was %d)\n", debugstr_w(CurProfile->filename), GetLastError());
>          return FALSE;
>      }
> +    /* The operation has succeed, do not over-write the error code */
> +    SetLastError(oldError);

It's been said many times that if you need to save/restore last error value
you are doing something wrong.

> +    /* Get* routines set S_OK on success, Write* routines return last error */
> +    SetLastError(S_OK);

There is no point in setting or checking last error value on success in vast
majority of cases, do you have an app that depends on this? Besides, S_OK is
an OLE error code and can not be used in kernel.

-- 
Dmitry. 



From jwhite at codeweavers.com  Wed Apr  9 23:04:06 2008
From: jwhite at codeweavers.com (Jeremy White)
Date: Wed, 09 Apr 2008 23:04:06 -0500
Subject: Reference information on CreateScalableFontResource
Message-ID: <47FD91B6.3010902@codeweavers.com>

I'm doing a brain dump for posterity on this task; you can tune out
of this email; it's mostly meant for Google archiving purposes.

I've spent far more time than I should on this implementation;
I originally did a quick + dirty version that was not binary
compatible with Windows .fot files.  Worked like a charm; I could
run Civ III (yay!).

But Alexandre said, gee, it should be easy to make it create a binary
compatible .fot file, take an afternoon and do that, why don't you, Jer?
Several weeks and a lot of swearing later, I now know far more about the
format of .fot files and fontdir resource structures than I care to.

I'm attaching a program that was useful to me; it dumped many chunks
of info about a .ttf file from FreeType.  Comparing that to a .fot file
generated on Windows was helpful.  I'm also attaching a hex dump of a .fot
file with my annotation on the basic structure.

The hard parts were that the .fot format seems to be an NE image, but
it seems to have subtle bugs in it and that the FONTDIR resource structure
is not well documented.  I've mostly sussed out how to use Freetype
to replicate most of the members; there are still a few I don't have
quite right.  (And I probably get this all wrong in non US or double
byte locales.  :-/)

The previous patches contain essentially all of my hard won knowledge
of the FONTDIR structure.

Cheers,

Jeremy
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dumpttf.c
Type: text/x-csrc
Size: 6680 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080409/8bc8eeaa/attachment.c 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: lucon.hexdump
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20080409/8bc8eeaa/attachment.txt 

From dmitry at codeweavers.com  Wed Apr  9 23:24:34 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Thu, 10 Apr 2008 13:24:34 +0900
Subject: Reference information on CreateScalableFontResource
References: <47FD91B6.3010902@codeweavers.com>
Message-ID: <019e01c89ac2$c98971a0$a600fea9@DMITRY>

"Jeremy White" <jwhite at codeweavers.com> wrote:

> The hard parts were that the .fot format seems to be an NE image, but
> it seems to have subtle bugs in it and that the FONTDIR resource structure
> is not well documented.  I've mostly sussed out how to use Freetype
> to replicate most of the members; there are still a few I don't have
> quite right.  (And I probably get this all wrong in non US or double
> byte locales.  :-/)
> 
> The previous patches contain essentially all of my hard won knowledge
> of the FONTDIR structure.

FONTDIR and all related font structures are well described in Windows 3.1
DDK I used to have (and use) 15 years ago. I put some knowledge about it
when I was fixing after Huw tools/fnt2fon.c, that's a good piece of knowledge
about Windows .fon files.

-- 
Dmitry.


From ehoover at mines.edu  Wed Apr  9 23:25:58 2008
From: ehoover at mines.edu (Erich Hoover)
Date: Wed, 9 Apr 2008 22:25:58 -0600
Subject: kernel32: Fix for WritePrivateProfileString Sharing Problem
	[1/2](ATTEMPT 2)
In-Reply-To: <017b01c89abf$c56f35d0$a600fea9@DMITRY>
References: <4c1ac96d0804092040m7e75f77ayce1a1274ddc9f404@mail.gmail.com>
	<017b01c89abf$c56f35d0$a600fea9@DMITRY>
Message-ID: <4c1ac96d0804092125n5a73dd43v4a37e3297f451fea@mail.gmail.com>

On Wed, Apr 9, 2008 at 10:02 PM, Dmitry Timoshkov <dmitry at codeweavers.com>
wrote:

> "Erich Hoover" <ehoover at mines.edu> wrote:
>
>  +    oldError = GetLastError();
> > +    /* Read and Write sharing are necessary if a flush is performed on
> > an open file */
> > +    hFile = CreateFileW(CurProfile->filename, GENERIC_WRITE,
> > FILE_SHARE_READ | FILE_SHARE_WRITE, NULL, CREATE_ALWAYS,
> > FILE_ATTRIBUTE_NORMAL, NULL);
> >     if (hFile == INVALID_HANDLE_VALUE)
> >     {
> >         WARN("could not save profile file %s (error was %d)\n",
> > debugstr_w(CurProfile->filename), GetLastError());
> >         return FALSE;
> >     }
> > +    /* The operation has succeed, do not over-write the error code */
> > +    SetLastError(oldError);
> >
>
> It's been said many times that if you need to save/restore last error
> value
> you are doing something wrong.


Well, I could call NtCreateFile directly so that the error code never gets
set in the first place...


>
>  +    /* Get* routines set S_OK on success, Write* routines return last
> > error */
> > +    SetLastError(S_OK);
> >
>
> There is no point in setting or checking last error value on success in
> vast
> majority of cases, do you have an app that depends on this? Besides, S_OK
> is
> an OLE error code and can not be used in kernel.
>

This was done to satisfy a problem pointed out in the previous attempt, that
patch broke a test in test_profile_sections where it checks that
GetPrivateProfileSectionA()'s GetLastError() is S_OK.  I figured that the
code should be consistent with the (existing) test, if you think it's more
appropriate then both could be changed to ERROR_SUCCESS.


> --
> Dmitry.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080409/57163703/attachment.htm 

From Stefan.Leichter at camline.com  Thu Apr 10 00:54:55 2008
From: Stefan.Leichter at camline.com (Stefan Leichter)
Date: Thu, 10 Apr 2008 07:54:55 +0200
Subject: make install broken
Message-ID: <200804100754.55966.Stefan.Leichter@camline.com>

Hello,

installing wine does not longer work for me. It fails with:

make[2]: Entering directory `/usr/src/wine/wine-build/programs/xcopy'
/usr/bin/install -c   xcopy.exe.so /usr/local/lib/wine/xcopy.exe.so
make[2]: Leaving directory `/usr/src/wine/wine-build/programs/xcopy'
make[1]: *** Keine Regel vorhanden, um das Target ?winelauncher?,
  ben?tigt von ?install?, zu erstellen.  Schluss.
make[1]: Leaving directory `/usr/src/wine/wine-build/programs'
make: *** [programs/__install__] Fehler 2

The difference from my build system to the most others is, that i do out of 
tree builds.

Bye Stefan


From kondratyuk at etersoft.ru  Thu Apr 10 01:02:31 2008
From: kondratyuk at etersoft.ru (Konstantin Kondratyuk)
Date: Thu, 10 Apr 2008 10:02:31 +0400
Subject: [2/2] winspool.drv: GetDefaultPrinterW reads the value from data
	in registry
In-Reply-To: <1207764825.15786.13.camel@p4>
References: <200804081539.16315.kondratyuk@etersoft.ru>
	<1207764825.15786.13.camel@p4>
Message-ID: <200804101002.31921.kondratyuk@etersoft.ru>

On Wednesday 09 April 2008 22:13:44 Detlef Riekenberg wrote:
> win3.x and win9.x use only "win.ini".
> We need to fix bug #4096, before we can switch to the Registry.

Thanks for advice! I will try to fix it.

-- 
Best regards,
Konstantin Kondratyuk.


From thestig at google.com  Thu Apr 10 01:25:45 2008
From: thestig at google.com (Lei Zhang)
Date: Wed, 9 Apr 2008 23:25:45 -0700
Subject: make install broken
In-Reply-To: <200804100754.55966.Stefan.Leichter@camline.com>
References: <200804100754.55966.Stefan.Leichter@camline.com>
Message-ID: <558b2f5c0804092325v64970393y31ea59516a8c5112@mail.gmail.com>

On Wed, Apr 9, 2008 at 10:54 PM, Stefan Leichter
<Stefan.Leichter at camline.com> wrote:
> Hello,
>
>  installing wine does not longer work for me. It fails with:
>
>  make[2]: Entering directory `/usr/src/wine/wine-build/programs/xcopy'
>  /usr/bin/install -c   xcopy.exe.so /usr/local/lib/wine/xcopy.exe.so
>  make[2]: Leaving directory `/usr/src/wine/wine-build/programs/xcopy'
>  make[1]: *** Keine Regel vorhanden, um das Target ?winelauncher?,
>   ben?tigt von ?install?, zu erstellen.  Schluss.
>  make[1]: Leaving directory `/usr/src/wine/wine-build/programs'
>  make: *** [programs/__install__] Fehler 2
>
>  The difference from my build system to the most others is, that i do out of
>  tree builds.
>
>  Bye Stefan
>
>
>

Ditto, in English:

/usr/bin/ginstall -c   xcopy.exe.so /tmp/winefoo/lib/wine/xcopy.exe.so
make[2]: Leaving directory `/home/leiz/wine-git/programs/xcopy'
make[1]: *** No rule to make target `winelauncher', needed by `install'.  Stop.
make[1]: Leaving directory `/home/leiz/wine-git/programs'
make: *** [programs/__install__] Error 2


From julliard at winehq.org  Thu Apr 10 03:36:40 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 10 Apr 2008 10:36:40 +0200
Subject: [PATCH 14/22] gdiplus: add a stub for
	GdipSetImageAttributesRemapTable.
In-Reply-To: <558b2f5c0804091409w622674e3v7578e76df2e027ee@mail.gmail.com>
	(Lei Zhang's message of "Wed, 9 Apr 2008 14:09:21 -0700")
References: <558b2f5c0804091409w622674e3v7578e76df2e027ee@mail.gmail.com>
Message-ID: <87y77mhzs7.fsf@wine.dyndns.org>

"Lei Zhang" <thestig at google.com> writes:

> @@ -62,6 +64,13 @@ typedef ImageAbort GetThumbnailImageAbort;
>  
>  #ifdef __cplusplus
>  
> +/* FIXME: missing the methods. */
> +class Color
> +{
> +public:
> +    ARGB color;
> +};
> +

I think this belong in gdipluscolor.h.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Thu Apr 10 04:15:56 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 10 Apr 2008 11:15:56 +0200
Subject: msvcrtd: add DllMain
In-Reply-To: <461528.38620.qm@web23212.mail.ird.yahoo.com> (Louis. Lenders's
	message of "Thu, 10 Apr 2008 07:51:09 +0000 (GMT)")
References: <461528.38620.qm@web23212.mail.ird.yahoo.com>
Message-ID: <87tziahxyr.fsf@wine.dyndns.org>

"Louis. Lenders" <xerox_xerox2000 at yahoo.co.uk> writes:

> Hi, this is for  bug http://bugs.winehq.org/show_bug.cgi?id=5133
>
> It looks like several apps (like Rubies, and Resolume and i guess
> several others) are shipped with a copy of this dll (along with
> msvcr71 and others). So i think it's ok to use this native dll then,
> and that is what this patch does. In this way this patch fixes bug
> #5133

It doesn't fix anything, it just hides the bug.

-- 
Alexandre Julliard
julliard at winehq.org


From rob at codeweavers.com  Thu Apr 10 06:08:48 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Thu, 10 Apr 2008 12:08:48 +0100
Subject: msdmo: Array parameter is passed to function as pointer so loses
	size	information
In-Reply-To: <ftisct$ha8$1@ger.gmane.org>
References: <200804072239.34412.andrew.talbot@talbotville.com>	<47FCC726.60406@codeweavers.com>
	<ftisct$ha8$1@ger.gmane.org>
Message-ID: <47FDF540.5000705@codeweavers.com>

Andrew Talbot wrote:
> Robert Shearman wrote:
>   
>> This is incorrect. count is the size in bytes of the buffer passed in
>> (szName) and so should be sizeof(szName) not
>> sizeof(szName)/sizeof(szName[0]) (i.e. 80).
>>
>>     
>
> Are you sure? MSDN says "szName: Array of 80 Unicode characters that
> receives the name of the DMO".
>   

It doesn't matter what MSDN says about szName, RegQueryValueExW still 
takes the size in bytes, not characters. I.e. count should be set to 
NAME_SIZE * sizeof(WCHAR), not NAME_SIZE.

> But, in any case, when arrays
> are passed as arguments to functions they are converted to pointers, so
> sizeof(szName) would represent the size of a pointer to the array, not the
> size of the array itself.

I didn't realise this before but the attached test program prints:
$ ./atest
sizeof(array) = 4
So you are right. Still, my point stands that the code is still passing 
in a smaller size than the size of the buffer and so is not correct.

-- 
Rob Shearman

-------------- next part --------------
A non-text attachment was scrubbed...
Name: atest.c
Type: text/x-csrc
Size: 166 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080410/eaf8d2ee/attachment.c 

From xerox_xerox2000 at yahoo.co.uk  Thu Apr 10 05:23:23 2008
From: xerox_xerox2000 at yahoo.co.uk (Louis. Lenders)
Date: Thu, 10 Apr 2008 10:23:23 +0000 (GMT)
Subject: msvcrtd: add DllMain
Message-ID: <587403.98763.qm@web23214.mail.ird.yahoo.com>



----- Original Message ----
From: Alexandre Julliard <julliard at winehq.org>
To: Louis. Lenders <xerox_xerox2000 at yahoo.co.uk>
Cc: wine-devel at winehq.org
Sent: Thursday, 10 April, 2008 5:15:56 AM
Subject: Re: msvcrtd: add DllMain

"Louis. Lenders" <xerox_xerox2000 at yahoo.co.uk> writes:

> Hi, this is for  bug http://bugs.winehq.org/show_bug.cgi?id=5133
>
> It looks like several apps (like Rubies, and Resolume and i guess
> several others) are shipped with a copy of this dll (along with
> msvcr71 and others). So i think it's ok to use this native dll then,
> and that is what this patch does. In this way this patch fixes bug
> #5133

It doesn't fix anything, it just hides the bug.

-- 
Alexandre Julliard
julliard at winehq.org


Maybe "fix" wasn't the right word; on the other hand, if you call it hiding a bug, then we're hiding tons of bugs, like in gdiplus, that also loads the native gdiplus, if that is shipped with the application. Anyway, if you don't like it that  way, just  leave it 




      ___________________________________________________________ 
Yahoo! For Good helps you make a difference  

http://uk.promotions.yahoo.com/forgood/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080410/67094cf2/attachment.htm 

From scott at open-vote.org  Thu Apr 10 06:00:47 2008
From: scott at open-vote.org (Scott Ritchie)
Date: Thu, 10 Apr 2008 04:00:47 -0700
Subject: Including Mono within a Wine package - should Wine expect this?
Message-ID: <47FDF35F.9030203@open-vote.org>

I'm trying to decide if it's a good idea to create wine-mono and
wine-gecko packages depended on by the wine package.

wine-gecko seems easy enough: we just install a local copy of the gecko
engine, and then Wine grabs it as soon as it's needed.  I'm even
thinking of modifying wineprefixcreate to essentially do winetricks
gecko at the end, unless someone can point out how that would have bad
consequences.

wine-mono would function similarly.  Is there any reason not to install
it around wineprefixcreate time?  I'm assuming Microsoft .net or a later
mono can be installed to replace mono afterwards (if not this is
probably a bug). Even so, does this seem like a good idea?

Have any other packagers thought of something like this?  The biggest
issue at this point seems to be dealing with the fact that gecko can
only be built on Windows.  I'm not sure how to build the Windows version
of Mono either.

Thanks,
Scott Ritchie


From julliard at winehq.org  Thu Apr 10 08:06:27 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 10 Apr 2008 15:06:27 +0200
Subject: conflict between Wine and Solaris list.h fixed by AlekZ's
	workaround (Bug 11463)
In-Reply-To: <47FE0528.5030105@sun.com> (Petr Sumbera's message of "Thu, 10
	Apr 2008 14:16:40 +0200")
References: <47FE0528.5030105@sun.com>
Message-ID: <87lk3lj1v0.fsf@wine.dyndns.org>

Petr Sumbera <Petr.Sumbera at Sun.COM> writes:

> diff --git a/server/fd.c b/server/fd.c
> index 41e404c..0010bab 100644
> --- a/server/fd.c
> +++ b/server/fd.c
> @@ -71,6 +71,18 @@
>  #include <sys/types.h>
>  #include <unistd.h>
>  
> +/*
> + struct list is defined at sys/list_impl.h on solaris
> + this patches work around it.
> +*/
> +#define list WINELIST
> +#define list_remove WINELIST_REMOVE
> +#define list_next WINELIST_NEXT
> +#define list_prev WINELIST_PREV
> +#define list_head WINELIST_HEAD
> +#define list_tail WINELIST_TAIL
> +#define list_move_tail WINELIST_MOVE_TAIL
> +

You should do this the other way around, by defining list to
solaris_list before including the offending header, and undefining
it afterwards. This way the Wine code itself isn't impacted by
redefinitions.

-- 
Alexandre Julliard
julliard at winehq.org


From juan.lang at gmail.com  Thu Apr 10 08:17:55 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Thu, 10 Apr 2008 06:17:55 -0700
Subject: shell32: Implement ParseDisplayName for EntireNetwork in the
	Network Places shell folder.
Message-ID: <3a768c550804100617i1dbf9c4dsd7910c817b01ca34@mail.gmail.com>

Hi Rob,

+        strcpy(pData->u.network.szNames, "Entire Network");

Is this not locale-dependent?
--Juan


From rob at codeweavers.com  Thu Apr 10 09:24:09 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Thu, 10 Apr 2008 15:24:09 +0100
Subject: shell32: Implement ParseDisplayName for EntireNetwork in the
	Network Places shell folder.
In-Reply-To: <3a768c550804100617i1dbf9c4dsd7910c817b01ca34@mail.gmail.com>
References: <3a768c550804100617i1dbf9c4dsd7910c817b01ca34@mail.gmail.com>
Message-ID: <47FE2309.7090602@codeweavers.com>

Juan Lang wrote:
> Hi Rob,
>
> +        strcpy(pData->u.network.szNames, "Entire Network");
>
> Is this not locale-dependent?

I don't believe so. ParseDisplayName (which isn't implemented yet) will 
do the mapping between the PIDL and the name the user sees, which 
doesn't have to depend on pData->u.network.szNames.

-- 
Rob Shearman



From austinenglish at gmail.com  Thu Apr 10 08:31:51 2008
From: austinenglish at gmail.com (Austin English)
Date: Thu, 10 Apr 2008 08:31:51 -0500
Subject: make install broken
In-Reply-To: <558b2f5c0804092325v64970393y31ea59516a8c5112@mail.gmail.com>
References: <200804100754.55966.Stefan.Leichter@camline.com>
	<558b2f5c0804092325v64970393y31ea59516a8c5112@mail.gmail.com>
Message-ID: <b6bb06270804100631i45100eaeva2946060f8642372@mail.gmail.com>

On Thu, Apr 10, 2008 at 1:25 AM, Lei Zhang <thestig at google.com> wrote:
>
> On Wed, Apr 9, 2008 at 10:54 PM, Stefan Leichter
>  <Stefan.Leichter at camline.com> wrote:
>  > Hello,
>  >
>  >  installing wine does not longer work for me. It fails with:
>  >
>  >  make[2]: Entering directory `/usr/src/wine/wine-build/programs/xcopy'
>  >  /usr/bin/install -c   xcopy.exe.so /usr/local/lib/wine/xcopy.exe.so
>  >  make[2]: Leaving directory `/usr/src/wine/wine-build/programs/xcopy'
>  >  make[1]: *** Keine Regel vorhanden, um das Target ?winelauncher?,
>  >   ben?tigt von ?install?, zu erstellen.  Schluss.
>  >  make[1]: Leaving directory `/usr/src/wine/wine-build/programs'
>  >  make: *** [programs/__install__] Fehler 2
>  >
>  >  The difference from my build system to the most others is, that i do out of
>  >  tree builds.
>  >
>  >  Bye Stefan
>  >
>  >
>  >
>
>  Ditto, in English:
>
>  /usr/bin/ginstall -c   xcopy.exe.so /tmp/winefoo/lib/wine/xcopy.exe.so
>  make[2]: Leaving directory `/home/leiz/wine-git/programs/xcopy'
>  make[1]: *** No rule to make target `winelauncher', needed by `install'.  Stop.
>  make[1]: Leaving directory `/home/leiz/wine-git/programs'
>  make: *** [programs/__install__] Error 2
>
>
>

http://source.winehq.org/git/wine.git/?a=commitdiff;h=d270a9603261d7d3693b375e3e6f7809501d821a

Alexandre removed the winelauncher script, which is probably the
source of your problem. Might have to manually remove it from
/usr/bin?

From juan.lang at gmail.com  Thu Apr 10 08:33:20 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Thu, 10 Apr 2008 06:33:20 -0700
Subject: shell32: Implement ParseDisplayName for EntireNetwork in the
	Network Places shell folder.
In-Reply-To: <47FE2309.7090602@codeweavers.com>
References: <3a768c550804100617i1dbf9c4dsd7910c817b01ca34@mail.gmail.com>
	<47FE2309.7090602@codeweavers.com>
Message-ID: <3a768c550804100633vc442cb7j3d35056cb79c89c1@mail.gmail.com>

> I don't believe so. ParseDisplayName (which isn't implemented yet) will do
> the mapping between the PIDL and the name the user sees, which doesn't have
> to depend on pData->u.network.szNames.

Right.  I was expecting that the Network Places shell folder would
have to be hooked up to MPR, in which case pData->u.network.szNames
would most logically match what it uses.  But since it isn't yet, I'll
defer comment.
--Juan


From dank at kegel.com  Thu Apr 10 08:45:32 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 10 Apr 2008 06:45:32 -0700
Subject: Including Mono within a Wine package - should Wine expect this?
Message-ID: <a71bd89a0804100645y2b7f9c94n719ab5f19374db04@mail.gmail.com>

A wine-gecko package would be very useful.

Wine-mono on the other hand is probably premature.
How many apps are helped at the moment by
  winetricks mono12
?  I don't think it's a large number.

The wine-gecko package should just be a repackaging
of the same blob that is normally downloaded,
at least until we figure out how to do a proper cross-build.


From infyquest at gmail.com  Thu Apr 10 09:30:00 2008
From: infyquest at gmail.com (Vijay Kiran Kamuju)
Date: Thu, 10 Apr 2008 10:30:00 -0400
Subject: [PATCH] winecfg => control panel applets patch
Message-ID: <36bf289b0804100730p3642f426vdb7439ea09b238a2@mail.gmail.com>

Hi,

This is regarding the control panel applet patch you have submitted to
wine-patches.
I would like to have the applets should be part of wine's control program.
They would be better be as files in the /programs/control/
And you should extend the existing control.exe  and winecfg in wine to
open these applets.

Please correct me if I am wrong.
Just my 2 cents.

----
VJ


From wine-devel at kievinfo.com  Thu Apr 10 09:42:41 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Thu, 10 Apr 2008 08:42:41 -0600
Subject: [PATCH] winecfg => control panel applets patch
In-Reply-To: <200804101047.28206.pure_evil@mail.bg>
References: <200804101047.28206.pure_evil@mail.bg>
Message-ID: <47FE2761.3050502@kievinfo.com>

pure_evil at mail.bg wrote:
> Allows access to different winecfg tabs via control-panel applets (without 
> showing all of the cfg's tabs when accessed thusly)
>    
> +LONG APIENTRY EXECUTE_APPLET(HWND hwndCpl, UINT message, LPARAM lParam1, 
> LPARAM lParam2)
> +{
> +
> + int NumOfApplet = (int)lParam1;
> +
> + switch (NumOfApplet)
> + {
> +
> +  case 0:

You patch is wrapped. Also please for new files follow standard Wine codding 
style - 4 spaces indentation, no tabs.

> +    /*It would get messier with an or statement everywhere, so...*/
> +    BOOL Do_App = FALSE;
> +    BOOL Do_Lib = FALSE;
> +    BOOL Do_Graph = FALSE;
> +    BOOL Do_Desktop = FALSE;
> +    BOOL Do_Drives = FALSE;
> +    BOOL Do_Audio = FALSE;

> +    if (display_what_tabs == 2) { Do_Lib = TRUE; }
> +    if (display_what_tabs == 3) { Do_Graph = TRUE; }
> +    if (display_what_tabs == 4) { Do_Desktop = TRUE; }
> +    if (display_what_tabs == 5) { Do_Drives = TRUE; }
> +    if (display_what_tabs == 6) { Do_Audio = TRUE; }

> +   if ( lstrcmpi(CommandLine,"applications") == 0 ) display_what_tabs = 1;
> +   if ( lstrcmpi(CommandLine,"libraries") == 0 ) display_what_tabs = 2;
> +   if ( lstrcmpi(CommandLine,"graphics") == 0 ) display_what_tabs = 3;
> +   if ( lstrcmpi(CommandLine,"desktop") == 0 ) display_what_tabs = 4;
> +   if ( lstrcmpi(CommandLine,"drives") == 0 ) display_what_tabs = 5;
> +   if ( lstrcmpi(CommandLine,"audio") == 0 ) display_what_tabs = 6;


This is ugly and redundant. You should make it a bit-mask instead. However 
with all this you removing really big functionality from the winecfg - 
ability to set this on per application basis.

Vitaliy.


From jwhite at codeweavers.com  Thu Apr 10 10:54:10 2008
From: jwhite at codeweavers.com (Jeremy White)
Date: Thu, 10 Apr 2008 10:54:10 -0500
Subject: Reference information on CreateScalableFontResource
In-Reply-To: <019e01c89ac2$c98971a0$a600fea9@DMITRY>
References: <47FD91B6.3010902@codeweavers.com>
	<019e01c89ac2$c98971a0$a600fea9@DMITRY>
Message-ID: <47FE3822.6040806@codeweavers.com>

> FONTDIR and all related font structures are well described in Windows 3.1
> DDK I used to have (and use) 15 years ago. I put some knowledge about it
> when I was fixing after Huw tools/fnt2fon.c, that's a good piece of 
> knowledge
> about Windows .fon files.
> 

Where in the DDK?  I can't find any place that clearly defines the
FONTDIR structure in the 3.11 DDK I am looking at.

For example, by inspection, I see that the value placed by Windows
mostly lines up with the structure we have defined in
wine/wingdi16.h.   (And you can find that definition of FONTDIR
if you google around on the web).

But in the DDK, I find only FONTINFO and other structures; not FONTDIR.

What I really wanted to know was how the tail end of that structure
was really mapped out.

That is, if I compare it to the FONTDIR16 structure we have, it
seems as though the data written by windows matches pretty well
up until dfDefaultChar.  At that point, the order is:

   BYTE   always 0x1    (might be dfDefaultChar, but not clear)
   BYTE   always 0x2    (might be dfBreakChar, but not clear)
   WORD   always 0x0    (might be WidthBytes, but not clear)
   DWORD  always 0x0    (might be dfDevice, but not clear)
   DWORD  always 0x76, which is the location
          in the struct of the Family name, suggests dfFace is
          a reasonable name for this field
   BYTE   mystery1      (mostly 0x9, sometimes 0xa, 0xb, or 0x6)
   BYTE   mystery2      always 0
   BYTE   mystery3      always 0
   BYTE   mystery4      is sometimes 0xf0, appears to be linked
                        to cases where the firstchar and last char
                        both are in the 0xf0XX range
                        [named dfReserved in the FONTDIR16 struct]
   BYTE   mystery5      always 0xff
   ZSTRING family name
   ZSTRING family name  (again)
   ZSTRING style name
       I'm pretty sure the latter 3 are in a constrained buffer
       of about 40 bytes; haven't nailed that down just yet.


And the sad truth is that what I mostly need is the ability to
turn information I can get from Freetype into matching FONTDIR
information, and that's just not likely to be documented anywhere.

Cheers,

Jeremy


From Andrew.Talbot at talbotville.com  Thu Apr 10 11:57:42 2008
From: Andrew.Talbot at talbotville.com (Andrew Talbot)
Date: Thu, 10 Apr 2008 17:57:42 +0100
Subject: msdmo: Array parameter is passed to function as pointer so loses
	size	information
References: <200804072239.34412.andrew.talbot@talbotville.com>	<47FCC726.60406@codeweavers.com>
	<ftisct$ha8$1@ger.gmane.org> <47FDF540.5000705@codeweavers.com>
Message-ID: <ftlgu6$k2m$1@ger.gmane.org>

Robert Shearman wrote:

> It doesn't matter what MSDN says about szName, RegQueryValueExW still
> takes the size in bytes, not characters. I.e. count should be set to
> NAME_SIZE * sizeof(WCHAR), not NAME_SIZE.
> 

Hi Robert,

Yes, indeed. I believe I may have had an editing accident with that one.

> [...] [M]y point stands that the code is still passing
> in a smaller size than the size of the buffer and so is not correct.
> 

You were indeed right on that and I was wrong. I only looked at what was
coming in and not at what was being done to it subsequently. Thanks for the
feedback.

-- 
Andy.




From pure_evil at mail.bg  Thu Apr 10 13:12:05 2008
From: pure_evil at mail.bg (pure_evil at mail.bg)
Date: Thu, 10 Apr 2008 21:12:05 +0300
Subject: [PATCH] winecfg => control panel applets patch
In-Reply-To: <36bf289b0804100730p3642f426vdb7439ea09b238a2@mail.gmail.com>
References: <36bf289b0804100730p3642f426vdb7439ea09b238a2@mail.gmail.com>
Message-ID: <200804102112.05883.pure_evil@mail.bg>

> I would like to have the applets should be part of wine's control program.
Hmmm, I followed usual windows proceedings, e.g. the applet is not actually a 
part of the control panel program itself, it's a .CPL.

> They would be better be as files in the /programs/control/
Well, cpls are basically DLLs that export a function -> CPlApplet -> so (based 
on Dan Kegel's advice) i put them in dlls. 
They're not *programs* strictly speaking.

Hmm, I could use more feedback on that one.
> And you should extend the existing control.exe  and winecfg in wine to
> open these applets.
control.exe opens cpls just fine; I only extended winecfg to make it suitable 
for being launched from within a cpl to perform only the particular task.




From pure_evil at mail.bg  Thu Apr 10 13:33:48 2008
From: pure_evil at mail.bg (pure_evil at mail.bg)
Date: Thu, 10 Apr 2008 21:33:48 +0300
Subject: [PATCH] winecfg => control panel applets patch
Message-ID: <200804102133.48658.pure_evil@mail.bg>

> You patch is wrapped. Also please for new files follow standard Wine codding 
> style - 4 spaces indentation, no tabs.
Sorry about that, I'll fix it in the morning. (I should've attached it as a 
text file :( )

> This is ugly and redundant.
yes, but at least it's easily readable - same local variable name within one 
function serves to store the temporal result, and an *input* variable by the 
same name is used in the other function (to catch that same result). 

> However   with all this you removing really big functionality from the 
winecfg - ability to set this on per application basis.

+    if (display_what_tabs == 1) 
+    { Do_App = TRUE;  /*well, application settings do require more tabs.*/
+      Do_Lib = TRUE;
+      NUM_PROPERTY_PAGES = 3;
+    }
^^This (a few lines below) took care of that.^^

This piece of code explains why I went for bools in the first place - for 
example, you draw the library tab A.) when you want to draw only them 
(general library settings), B.) when you want application-specific settings 
("winecfg applications") and C.) when you want the entire winecfg. That 
would've been a lot messier with a triple "or" rather than a simple 
IF (Do_Lib) { }.


From dank at kegel.com  Thu Apr 10 13:22:41 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 10 Apr 2008 11:22:41 -0700
Subject: Microsoft Tax Day Wine Tasting & Networking Event
Message-ID: <a71bd89a0804101122o71eee258va31554e7c2e07138@mail.gmail.com>

It's an April 15th event sponsored by Microsoft, but
it sure sounds like something we should be holding on our own terms :-)

http://www.microsoft.com/events/EventDetails.aspx?CMTYSvcSource=MSCOMMedia&Params=~CMTYDataSvcParams%5E~arg+Name%3D%22ID%22+Value%3D%221032374035%22%2F%5E~arg+Name%3D%22ProviderID%22+Value%3D%22A6B43178-497C-4225-BA42-DF595171F04C%22%2F%5E~arg+Name%3D%22lang%22+Value%3D%22en%22%2F%5E~arg+Name%3D%22cr%22+Value%3D%22US%22%2F%5E~sParams%5E~%2FsParams%5E~%2FCMTYDataSvcParams%5E


From dank at kegel.com  Thu Apr 10 13:42:16 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 10 Apr 2008 11:42:16 -0700
Subject: AVI file format documentation
Message-ID: <a71bd89a0804101142g699fdc9k7ebd4ce3f44e208a@mail.gmail.com>

Maarten stumbled across what he said was very useful
documentation about the AVI file format.  For future reference,
here it is:
http://sunsson.iptime.org/projects/juliet/wiki/MediaFileFormat


From dsh at linux.ucla.edu  Thu Apr 10 13:55:32 2008
From: dsh at linux.ucla.edu (Dan Hipschman)
Date: Thu, 10 Apr 2008 11:55:32 -0700
Subject: Microsoft Tax Day Wine Tasting & Networking Event
In-Reply-To: <a71bd89a0804101122o71eee258va31554e7c2e07138@mail.gmail.com>
References: <a71bd89a0804101122o71eee258va31554e7c2e07138@mail.gmail.com>
Message-ID: <20080410185531.GL11580@linux.ucla.edu>

On Thu, Apr 10, 2008 at 11:22:41AM -0700, Dan Kegel wrote:
> It's an April 15th event sponsored by Microsoft, but
> it sure sounds like something we should be holding on our own terms :-)
> 
>
http://www.microsoft.com/events/EventDetails.aspx?CMTYSvcSource=MSCOMMedia... (snip)

That's a long URL (and hard to capture in Mutt).  Here's a shorter one:
http://tinyurl.com/6cvlz8  :)


From jwhite at codeweavers.com  Thu Apr 10 14:05:10 2008
From: jwhite at codeweavers.com (Jeremy White)
Date: Thu, 10 Apr 2008 14:05:10 -0500
Subject: WineConf 2008
Message-ID: <47FE64E6.3050303@codeweavers.com>

Hi Folks,

I'd like to start the planning for WineConf 2008.

My sense is that 3 years in Europe and 1 year in the US
is a reasonable balance, so I feel it makes sense to
try to have it over here this year.

Further, I would like to host WineConf this year in St. Paul, Minnesota,
for a variety of reasons.  First, it's a lot easier for me to help
plan if it's here.  Second, it's nice for CodeWeavers; it means we
can have everyone, not just the developers, all together.  Having Mandi
able to physically intimidate people is very helpful for us, after all <grin>.

My thought was to do it in late September, early October, so
that the weather would not be so extreme.  I realize that veterans
of our last Minnesota meeting will be disappointed at the lack
of the Ice Palace, but we'll try to find a way to make it up to you.

Also, I know the travel costs will be hard for many people, given current
travel costs, so I'm hoping to contribute funds (and perhaps
do some fund raising) to help cover travel costs for Wine
contributors.

At any rate, that's my idea.  I'm willing to be swayed if people
object violently, or if a clear consensus for an alternate emerges.

Thoughts?  Comments?

Cheers,

Jeremy


From winehacker at gmail.com  Thu Apr 10 14:26:11 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Thu, 10 Apr 2008 15:26:11 -0400
Subject: WineConf 2008
In-Reply-To: <47FE64E6.3050303@codeweavers.com>
References: <47FE64E6.3050303@codeweavers.com>
Message-ID: <19e31a080804101226h6732d82cx29d029c8a24340a6@mail.gmail.com>

On Thu, Apr 10, 2008 at 3:05 PM, Jeremy White <jwhite at codeweavers.com> wrote:
>  At any rate, that's my idea.  I'm willing to be swayed if people
>  object violently, or if a clear consensus for an alternate emerges.
>
>  Thoughts?  Comments?

It may be nothing more than hot air from our European brethren but the
consensus I've felt is that most of the discussions I've had with some
members at the last few conferences is that they don't want to deal
with the hassle of US security and privacy issues. I don't really
blame them if this is true and they decide to boycott wineconf as a
form of economic protest.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From jwhite at winehq.org  Thu Apr 10 14:29:02 2008
From: jwhite at winehq.org (Jeremy White)
Date: Thu, 10 Apr 2008 14:29:02 -0500
Subject: Wine booth/BOF and Linuxworld San Francisco, Aug 2008?
In-Reply-To: <47D64A2C.7070807@open-vote.org>
References: <a71bd89a0803101914v628d0bc9l65880a6458b97633@mail.gmail.com>	<200803110838.07439.kai.blin@gmail.com>
	<47D64A2C.7070807@open-vote.org>
Message-ID: <47FE6A7E.7090808@winehq.org>

Hi folks,

I'm on the IDG mailing list, and just got a deadline notice,
and thought I'd relay it in case someone still wanted to apply
for a booth and hadn't done so yet:

----

The deadline for submitting for a .org Pavilion application is
Friday, April 11, 2008

Submit proposal(s) here:
http://emessaging.vertexcommunication.com/ct/3352956:1363855011:m:3:22215624:DEAF60A80A7E2685C96822942C620253

All accepted and rejected proposals will be notified in late
May.

----

Cheers,

Jeremy


From juan.lang at gmail.com  Thu Apr 10 14:42:51 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Thu, 10 Apr 2008 12:42:51 -0700
Subject: WineConf 2008
In-Reply-To: <47FE64E6.3050303@codeweavers.com>
References: <47FE64E6.3050303@codeweavers.com>
Message-ID: <3a768c550804101242u113fce7dg88c5cd789dfbb894@mail.gmail.com>

>  Thoughts?

+1 to a US conference.
--Juan


From tehblunderbuss at gmail.com  Thu Apr 10 14:50:01 2008
From: tehblunderbuss at gmail.com (TheBlunderbuss)
Date: Thu, 10 Apr 2008 14:50:01 -0500
Subject: WineConf 2008
In-Reply-To: <19e31a080804101226h6732d82cx29d029c8a24340a6@mail.gmail.com>
References: <47FE64E6.3050303@codeweavers.com>
	<19e31a080804101226h6732d82cx29d029c8a24340a6@mail.gmail.com>
Message-ID: <47FE6F69.4020709@gmail.com>

An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080410/790bb7a4/attachment.htm 

From wine-devel at kievinfo.com  Thu Apr 10 14:52:17 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Thu, 10 Apr 2008 13:52:17 -0600
Subject: Please add wine-0.9.59 to bugzilla
Message-ID: <47FE6FF1.30002@kievinfo.com>

Could someone add the newest Wine version to buzilla?

Vitaliy.


From austinenglish at gmail.com  Thu Apr 10 14:57:21 2008
From: austinenglish at gmail.com (Austin English)
Date: Thu, 10 Apr 2008 14:57:21 -0500
Subject: cachedmetrics - still used?
Message-ID: <b6bb06270804101257j60cf6e40n3042b57532648a12@mail.gmail.com>

Looking at documentation/PACKAGING, it seems there's quite a bit of
outdated info (hasn't been updated in 2-3 years...). Anywho, I'm
preparing a few updates for it, but wanted to verify that
cachedmetrics is no longer used. There's a few references to it on
AppDB, but only one reference in the code, and a few on wine-devel
(all of which are pretty old). Is it safe to remove this info?

-Austin


From stefan at codeweavers.com  Thu Apr 10 18:06:54 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Fri, 11 Apr 2008 01:06:54 +0200
Subject: GL_ATI_fragment_shader and GL_INVALID 0x501, 0x502
In-Reply-To: <e1d9e62c0804090533g5b505f43od13e67b41c322024@mail.gmail.com>
References: <e1d9e62c0804071637n76680520ge942d21e4bf8f81f@mail.gmail.com>
	<200804091416.44718.stefan@codeweavers.com>
	<e1d9e62c0804090533g5b505f43od13e67b41c322024@mail.gmail.com>
Message-ID: <200804110106.54219.stefan@codeweavers.com>

Hi,
I just tried 3DMark2001, and I can confirm the black textures in the high car 
test, so it is not your different card. I am pretty sure this used to work 
though...




From dank at kegel.com  Thu Apr 10 20:00:29 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 10 Apr 2008 18:00:29 -0700
Subject: New Valgrind errors in user32
Message-ID: <a71bd89a0804101800k6b1a306ay45b285875de07fd4@mail.gmail.com>

Hey Lei,
this morning's git brought one new valgrind error, and it happens to
be in a file you touched in the last day or so:
+ Conditional jump or move depends on uninitialised value(s)
+    at  EDIT_BuildLineDefs_ML (edit.c:1280)
+    by  EDIT_EM_ReplaceSel (edit.c:3260)
+    by  EDIT_WM_Char (edit.c:4035)
+    by  EditWndProc_common (edit.c:859)
+    by  EditWndProcA (edit.c:1103)
+    by  (within /home/dank/wine-git/dlls/user32/user32.dll.so)
+    by  call_window_proc (winproc.c:457)
+    by  WINPROC_call_window (winproc.c:2207)
+    by  call_window_proc (message.c:1616)
+    by  send_message (message.c:2438)
+    by  SendMessageA (message.c:2583)
+    by  test_enter (edit.c:1654)
+    by  func_edit (edit.c:1977)
+    by  run_test (test.h:406)
+    by  main (test.h:455)

Could you have a look?

See
http://kegel.com/wine/valgrind/logs-2008-04-10/vg-user32_edit-diff.txt
http://kegel.com/wine/valgrind/logs-2008-04-10/vg-user32_edit.txt

Thanks,
Dan


From kai.blin at gmail.com  Thu Apr 10 20:01:25 2008
From: kai.blin at gmail.com (Kai Blin)
Date: Fri, 11 Apr 2008 03:01:25 +0200
Subject: WineConf 2008
In-Reply-To: <47FE64E6.3050303@codeweavers.com>
References: <47FE64E6.3050303@codeweavers.com>
Message-ID: <200804110301.37702.kai.blin@gmail.com>

On Thursday 10 April 2008 21:05:10 Jeremy White wrote:

> My sense is that 3 years in Europe and 1 year in the US
> is a reasonable balance, so I feel it makes sense to
> try to have it over here this year.

Fine with me. I'm hoping to fit it into my US trip schedule for this year.

>
> My thought was to do it in late September, early October, so
> that the weather would not be so extreme.

I'm probably going to travel to the US twice this year, once for the GSoC 
mentor summit and maybe to the CIFS workshop if we can talk JRA into 
organizing another one. If WineConf is close to one of those trips, I'll be 
glad to stop by in MN. I'm probably not going to fly to the US three times, 
as being a tall guy in economy class really sucks.

Unfortunately, I don't have exact dates for the two scheduled trips yet.

Cheers,
Kai

-- 
Kai Blin
WorldForge developer  http://www.worldforge.org/
Wine developer        http://wiki.winehq.org/KaiBlin
Samba team member     http://www.samba.org/samba/team/
--
Will code for cotton.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080411/ed52aae4/attachment.pgp 

From scott at open-vote.org  Thu Apr 10 21:40:30 2008
From: scott at open-vote.org (Scott Ritchie)
Date: Thu, 10 Apr 2008 19:40:30 -0700
Subject: Including Mono within a Wine package - should Wine expect this?
In-Reply-To: <a71bd89a0804100645y2b7f9c94n719ab5f19374db04@mail.gmail.com>
References: <a71bd89a0804100645y2b7f9c94n719ab5f19374db04@mail.gmail.com>
Message-ID: <47FECF9E.1030309@open-vote.org>

Dan Kegel wrote:
> A wine-gecko package would be very useful.
> 
> Wine-mono on the other hand is probably premature.
> How many apps are helped at the moment by
>   winetricks mono12
> ?  I don't think it's a large number.

Honestly I don't know.  Is this due to inadequacies in the current mono,
or inadequacies in Wine?

Either way, Mono 2.0 will finally come out around the same time as Wine
1.0 (quarter 2 of 2008), and I suspect the number of applications Mono
helps will greatly improve by then.

> 
> The wine-gecko package should just be a repackaging
> of the same blob that is normally downloaded,
> at least until we figure out how to do a proper cross-build.
> 
> 

Agreed.  The one tricky thing here is making a proper "source" package.
 There is some precedent for source packages that don't actually build
on the architecture they're for.  The ia32-libs package, for instance,
contains both binary and source versions of the 32 bit libraries since
it's solely for 64 bit arches, however to build those binaries requires
use of a 32 bit system.

Similarly, we can ship a wine-gecko "source" package which includes
binary and source, with the readme detailing how to actually build the
binary from the source (ie, use Windows).  Meanwhile the source package
"builds" by just copying the binary into the right place (much like how
ia32-libs builds).

Thanks,
Scott Ritchie


From dank at kegel.com  Thu Apr 10 21:54:30 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 10 Apr 2008 19:54:30 -0700
Subject: Including Mono within a Wine package - should Wine expect this?
In-Reply-To: <47FECF9E.1030309@open-vote.org>
References: <a71bd89a0804100645y2b7f9c94n719ab5f19374db04@mail.gmail.com>
	<47FECF9E.1030309@open-vote.org>
Message-ID: <a71bd89a0804101954w31a24e2fn72c027796b771a6e@mail.gmail.com>

On Thu, Apr 10, 2008 at 7:40 PM, Scott Ritchie <scott at open-vote.org> wrote:
>  > Wine-mono on the other hand is probably premature.
>  > How many apps are helped at the moment by
>  >   winetricks mono12
>  > ?  I don't think it's a large number.
>
>  Honestly I don't know.  Is this due to inadequacies in the current mono,
>  or inadequacies in Wine?

Mono doesn't even try to handle mixed-mode assemblies (i.e. ones
that contain some native code).  And by gum, every .net app built
by Microsoft tools seems to include some native code for some odd
reason.  Go figure!

>  Either way, Mono 2.0 will finally come out around the same time as Wine
>  1.0 (quarter 2 of 2008), and I suspect the number of applications Mono
>  helps will greatly improve by then.

Maybe, but only apps that have been properly cleaned of native code.
- Dan


From ivg231 at gmail.com  Thu Apr 10 11:13:51 2008
From: ivg231 at gmail.com (Ivan Gyurdiev)
Date: Thu, 10 Apr 2008 12:13:51 -0400
Subject: tools: Add Spanish Translation to wine.desktop
In-Reply-To: <47FE618B.1070403@ilidium.com>
References: <47FE618B.1070403@ilidium.com>
Message-ID: <47FE3CBF.8020409@gmail.com>

 > Name=Wine Windows Emulator

I like the expanded version better:
    "Wine is not an emulator windows emulator".

Should help clear up any questions people might have :)





From wine-devel at kievinfo.com  Thu Apr 10 23:48:23 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Thu, 10 Apr 2008 22:48:23 -0600
Subject: Valgrind false positive or?
Message-ID: <47FEED97.1000205@kievinfo.com>

Trying to understand what is that valgrind doesn't like?

==22938== Invalid write of size 1
==22938==    at 0x4024D55: memcpy (mc_replace_strmem.c:402)
==22938==    by 0x7BC64405: setup_exception_record (signal_i386.c:795)
==22938==    by 0x7BC65793: segv_handler (signal_i386.c:1310)
==22938==    by 0x419160F: (within /lib/libpthread-2.6.1.so)
==22938==  Address 0x7f22c7de is not stack'd, malloc'd or (recently) free'd

http://source.winehq.org/source/dlls/ntdll/signal_i386.c#L756
http://source.winehq.org/source/dlls/ntdll/signal_i386.c#L1093
http://source.winehq.org/source/dlls/ntdll/signal_i386.c#L1310

Everything seems to be correct. Any ideas?

Vitaliy.


From dank at kegel.com  Fri Apr 11 00:04:38 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 10 Apr 2008 22:04:38 -0700
Subject: Valgrind false positive or?
Message-ID: <a71bd89a0804102204jca7410ftf32996c6123bdf5c@mail.gmail.com>

Vitaliy wrote:

>==22938== Invalid write of size 1
>==22938==    at 0x4024D55: memcpy (mc_replace_strmem.c:402)
>==22938==    by 0x7BC64405: setup_exception_record (signal_i386.c:795)
>==22938==    by 0x7BC65793: segv_handler (signal_i386.c:1310)

What test was this?  Sometimes a little more context helps.


From dank at kegel.com  Fri Apr 11 00:06:09 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 10 Apr 2008 22:06:09 -0700
Subject: AVI file format documentation
In-Reply-To: <a71bd89a0804101142g699fdc9k7ebd4ce3f44e208a@mail.gmail.com>
References: <a71bd89a0804101142g699fdc9k7ebd4ce3f44e208a@mail.gmail.com>
Message-ID: <a71bd89a0804102206m6b5fe0d2g6d564c5826b17476@mail.gmail.com>

On Thu, Apr 10, 2008 at 11:42 AM, Dan Kegel <dank at kegel.com> wrote:
> Maarten stumbled across what he said was very useful
>  documentation about the AVI file format.  For future reference,
>  here it is:
>  http://sunsson.iptime.org/projects/juliet/wiki/MediaFileFormat

Sorry for the spam, but here's one more document he found
that deals with really big avi files:
http://the-labs.com/Video/odmlff2-avidef.pdf
- Dan


From wine-devel at kievinfo.com  Fri Apr 11 00:06:30 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Thu, 10 Apr 2008 23:06:30 -0600
Subject: Valgrind false positive or?
In-Reply-To: <a71bd89a0804102204jca7410ftf32996c6123bdf5c@mail.gmail.com>
References: <a71bd89a0804102204jca7410ftf32996c6123bdf5c@mail.gmail.com>
Message-ID: <47FEF1D6.9040002@kievinfo.com>

Dan Kegel wrote:
> Vitaliy wrote:
> 
>> ==22938== Invalid write of size 1
>> ==22938==    at 0x4024D55: memcpy (mc_replace_strmem.c:402)
>> ==22938==    by 0x7BC64405: setup_exception_record (signal_i386.c:795)
>> ==22938==    by 0x7BC65793: segv_handler (signal_i386.c:1310)
> 
> What test was this?  Sometimes a little more context helps.
Well that was Steam not a test.


From dank at kegel.com  Fri Apr 11 00:55:39 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 10 Apr 2008 22:55:39 -0700
Subject: Valgrind false positive or?
In-Reply-To: <a71bd89a0804102204jca7410ftf32996c6123bdf5c@mail.gmail.com>
References: <a71bd89a0804102204jca7410ftf32996c6123bdf5c@mail.gmail.com>
Message-ID: <a71bd89a0804102255u5e859085gce928918d879268e@mail.gmail.com>

Sounds like one you'll probably just have to ignore.


From stefan at codeweavers.com  Fri Apr 11 01:21:24 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Fri, 11 Apr 2008 08:21:24 +0200
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <200804110031.13345.stefan@codeweavers.com>
References: <200804110031.13345.stefan@codeweavers.com>
Message-ID: <200804110821.25111.stefan@codeweavers.com>

Am Freitag, 11. April 2008 00:31:13 schrieb Stefan D?singer:
> The drawback of this is that now the workaround for the mesa atifs bug
> minimally affects nvidia cards too. It's a bit tricky to design around
> driver bugs :-/
Use this patch instead, the last one had a small but pretty bad bug that 
broken GLSL
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-WineD3D-Use-the-shader-backend-to-enable-disable.patch
Type: text/x-diff
Size: 10157 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080411/b7b37638/attachment-0001.patch 

From hverbeet at gmail.com  Fri Apr 11 01:58:05 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Fri, 11 Apr 2008 08:58:05 +0200
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <200804110821.25111.stefan@codeweavers.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804110821.25111.stefan@codeweavers.com>
Message-ID: <d658b69e0804102358w6d8241c0l4592e1be20f9dc6c@mail.gmail.com>

On 11/04/2008, Stefan D?singer <stefan at codeweavers.com> wrote:
> Am Freitag, 11. April 2008 00:31:13 schrieb Stefan D?singer:
>
> > The drawback of this is that now the workaround for the mesa atifs bug
>  > minimally affects nvidia cards too. It's a bit tricky to design around
>  > driver bugs :-/
>
> Use this patch instead, the last one had a small but pretty bad bug that
>  broken GLSL
>
This patch doesn't make sense at all. Wasn't ATIFS supposed to be an
implementation of fixed function fragment processing for ATI cards? In
that case it doesn't make sense to only use it on cards that don't
support ARB or GLSL. That will only make newer ATI cards have worse
fixed function fragment processing (assuming ATIFS works as
advertised). Of course what it comes down to again is that the shader
backend isn't the right place to implement this. (Not to mention the
issue of making a workaround for a Mesa bug part of the shader
infrastructure... that bug should be fixed in Mesa.)

> +    void (*shader_fragment_enable)(IWineD3DDevice *iface, BOOL enable);
The name "shader_fragment_enable" is ambiguous at best within the
context of a shader backend.


From dmitry at codeweavers.com  Fri Apr 11 02:38:22 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 11 Apr 2008 16:38:22 +0900
Subject: Reference information on CreateScalableFontResource
References: <47FD91B6.3010902@codeweavers.com><019e01c89ac2$c98971a0$a600fea9@DMITRY>
	<47FE3822.6040806@codeweavers.com>
Message-ID: <004a01c89ba7$0846f1d0$a600fea9@DMITRY>

"Jeremy White" <jwhite at codeweavers.com> wrote:

>> FONTDIR and all related font structures are well described in Windows 3.1
>> DDK I used to have (and use) 15 years ago. I put some knowledge about it
>> when I was fixing after Huw tools/fnt2fon.c, that's a good piece of 
>> knowledge
>> about Windows .fon files.
>> 
> 
> Where in the DDK?  I can't find any place that clearly defines the
> FONTDIR structure in the 3.11 DDK I am looking at.

If I recall correctly it was in the book devoted to developing printer drivers,
around PFM file structure and device font description.

> For example, by inspection, I see that the value placed by Windows
> mostly lines up with the structure we have defined in
> wine/wingdi16.h.   (And you can find that definition of FONTDIR
> if you google around on the web).
> 
> But in the DDK, I find only FONTINFO and other structures; not FONTDIR.
> 
> What I really wanted to know was how the tail end of that structure
> was really mapped out.
> 
> That is, if I compare it to the FONTDIR16 structure we have, it
> seems as though the data written by windows matches pretty well
> up until dfDefaultChar.  At that point, the order is:
> 
>   BYTE   always 0x1    (might be dfDefaultChar, but not clear)
>   BYTE   always 0x2    (might be dfBreakChar, but not clear)
>   WORD   always 0x0    (might be WidthBytes, but not clear)
>   DWORD  always 0x0    (might be dfDevice, but not clear)
>   DWORD  always 0x76, which is the location
>          in the struct of the Family name, suggests dfFace is
>          a reasonable name for this field
>   BYTE   mystery1      (mostly 0x9, sometimes 0xa, 0xb, or 0x6)
>   BYTE   mystery2      always 0
>   BYTE   mystery3      always 0
>   BYTE   mystery4      is sometimes 0xf0, appears to be linked
>                        to cases where the firstchar and last char
>                        both are in the 0xf0XX range
>                        [named dfReserved in the FONTDIR16 struct]
>   BYTE   mystery5      always 0xff
>   ZSTRING family name
>   ZSTRING family name  (again)
>   ZSTRING style name
>       I'm pretty sure the latter 3 are in a constrained buffer
>       of about 40 bytes; haven't nailed that down just yet.

Last field in the FONDIR structure should be dfBitsOffset, followed
by font name. As you can see from fnt2fon.c not the whole FONTINFO16
structure is used, but only 0x72 bytes including dfVersion, dfSize,
dfCopyright.

Also, I'd avoid using FreeType directly altogether, and used Win32
APIs instead to load a TTF file and get all required font info from it.

-- 
Dmitry.


From dmitry at codeweavers.com  Fri Apr 11 02:46:18 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 11 Apr 2008 16:46:18 +0900
Subject: AVI file format documentation
References: <a71bd89a0804101142g699fdc9k7ebd4ce3f44e208a@mail.gmail.com>
Message-ID: <005501c89ba8$22d255c0$a600fea9@DMITRY>

"Dan Kegel" <dank at kegel.com> wrote:

> Maarten stumbled across what he said was very useful
> documentation about the AVI file format.  For future reference,
> here it is:
> http://sunsson.iptime.org/projects/juliet/wiki/MediaFileFormat

AVI files are just RIFF files, and RIFF file format is very well documented,
and should be well supported in Wine: mmioOpen, mmioDescend, etc.

Both dlls/mciavi32 and dlls/avifil32 are able to parse and play AVI files.

-- 
Dmitry.


From m.b.lankhorst at gmail.com  Fri Apr 11 02:55:29 2008
From: m.b.lankhorst at gmail.com (Maarten Lankhorst)
Date: Fri, 11 Apr 2008 00:55:29 -0700
Subject: AVI file format documentation
In-Reply-To: <005501c89ba8$22d255c0$a600fea9@DMITRY>
References: <a71bd89a0804101142g699fdc9k7ebd4ce3f44e208a@mail.gmail.com>
	<005501c89ba8$22d255c0$a600fea9@DMITRY>
Message-ID: <b130c85e0804110055q4247a5e2rc7312b19c5992ee0@mail.gmail.com>

Hello Dmitry,

2008/4/11, Dmitry Timoshkov <dmitry at codeweavers.com>:
> "Dan Kegel" <dank at kegel.com> wrote:
> > Maarten stumbled across what he said was very useful
>  > documentation about the AVI file format.  For future reference,
>  > here it is:
>  > http://sunsson.iptime.org/projects/juliet/wiki/MediaFileFormat
> AVI files are just RIFF files, and RIFF file format is very well documented,
>  and should be well supported in Wine: mmioOpen, mmioDescend, etc.
>
>  Both dlls/mciavi32 and dlls/avifil32 are able to parse and play AVI files.
I don't think I can use that from quartz though. It uses the
asyncreader primitives and I don't believe there is such thing as a
IRiffReader interface. ;-)

Also, I don't think avifill and mciavi currently support seeking, that
is very important as well.

Cheers,
Maarten.


From stefan at codeweavers.com  Fri Apr 11 02:59:56 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Fri, 11 Apr 2008 09:59:56 +0200
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <d658b69e0804102358w6d8241c0l4592e1be20f9dc6c@mail.gmail.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804110821.25111.stefan@codeweavers.com>
	<d658b69e0804102358w6d8241c0l4592e1be20f9dc6c@mail.gmail.com>
Message-ID: <200804110959.56731.stefan@codeweavers.com>

Am Freitag, 11. April 2008 08:58:05 schrieb H. Verbeet:

First of all: We really want that patch to go in, Wine is currently badly 
broken on fglrx.

> This patch doesn't make sense at all. Wasn't ATIFS supposed to be an
> implementation of fixed function fragment processing for ATI cards? In
> that case it doesn't make sense to only use it on cards that don't
> support ARB or GLSL. That will only make newer ATI cards have worse
> fixed function fragment processing (assuming ATIFS works as
> advertised). Of course what it comes down to again is that the shader
> backend isn't the right place to implement this.
We need that in a shader backend if we are ever going to implement pixel 
shaders using atifs. We also have to make nvts/nvrc a shader backend if we 
ever implement pixel shaders using that extension.

As for the worse fragment processing on newer ATI cards: We do not want to use 
ATIFS on those cards anyway, because ATIFS has a hardcoded limitation of 6 
simultanous textures, whereas radeon 9500+ cards support 8 textures with 
regular OpenGL fixed function processing. Also fglrx supports 
GL_ATI_envmap_bumpmap on those cards, so we have bump mapping without ATIFS 
as well(Still missing stuff like specular color input and rare blending 
parameters though). For newer ATI cards we need an ARBFP / GLSL pipeline 
replacement, no matter what we do with ATIFS.

Remember, my original patchset used ATIFS with newer cards as well. Ivan did 
not like the 3 inherited atifs backends, so I've limited ATIFS to its final 
use in a 'perfect' wine that has an ARBFP and GLSL replacement.


> (Not to mention the 
> issue of making a workaround for a Mesa bug part of the shader
> infrastructure... that bug should be fixed in Mesa.)
It is fixed there already, but we're using the workaround to allow users of 
older Mesa versions to run the tests without crashing. If it's just about me 
we can take the workaround out again, I have the newest Mesa code...


From hverbeet at gmail.com  Fri Apr 11 03:39:13 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Fri, 11 Apr 2008 10:39:13 +0200
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <200804110959.56731.stefan@codeweavers.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804110821.25111.stefan@codeweavers.com>
	<d658b69e0804102358w6d8241c0l4592e1be20f9dc6c@mail.gmail.com>
	<200804110959.56731.stefan@codeweavers.com>
Message-ID: <d658b69e0804110139n5182168bk54498b4e2ba02a7e@mail.gmail.com>

On 11/04/2008, Stefan D?singer <stefan at codeweavers.com> wrote:
>  > This patch doesn't make sense at all. Wasn't ATIFS supposed to be an
>  > implementation of fixed function fragment processing for ATI cards? In
>  > that case it doesn't make sense to only use it on cards that don't
>  > support ARB or GLSL. That will only make newer ATI cards have worse
>  > fixed function fragment processing (assuming ATIFS works as
>  > advertised). Of course what it comes down to again is that the shader
>  > backend isn't the right place to implement this.
>
> We need that in a shader backend if we are ever going to implement pixel
>  shaders using atifs. We also have to make nvts/nvrc a shader backend if we
>  ever implement pixel shaders using that extension.
I'm not convinced we should lump that together in the shader backend
just because it uses the same GL extension, but I guess we've been
through that discussion. Fact is that we don't currently implement
pixel shaders using atifs, and nobody knows how long it may take
before we will, if ever.

>  As for the worse fragment processing on newer ATI cards: We do not want to use
>  ATIFS on those cards anyway, because ATIFS has a hardcoded limitation of 6
>  simultanous textures, whereas radeon 9500+ cards support 8 textures with
>  regular OpenGL fixed function processing. Also fglrx supports
>  GL_ATI_envmap_bumpmap on those cards, so we have bump mapping without ATIFS
>  as well(Still missing stuff like specular color input and rare blending
>  parameters though). For newer ATI cards we need an ARBFP / GLSL pipeline
>  replacement, no matter what we do with ATIFS.
>
I think in practice the specular color input is probably more
important than the two extra textures. It's pretty rare for programs
to hit the nvrc limit of 4, and if they do they don't usually break as
bad as when they try to use the missing specular input.

>  First of all: We really want that patch to go in, Wine is currently badly
>  broken on fglrx.
Yes it's broken, but I'm not convinced this is the right way to fix
it. (I'd be fine with committing this just to fix the breakage, but I
do think this is simply more evidence that the atifs stuff is in the
wrong place.) Ultimately I'm just giving my opinion of course, it's up
to you and Alexandre to decide what to do with that.


From mstefani at redhat.com  Fri Apr 11 04:15:07 2008
From: mstefani at redhat.com (Michael Stefaniuc)
Date: Fri, 11 Apr 2008 11:15:07 +0200
Subject: WineConf 2008
In-Reply-To: <47FE64E6.3050303@codeweavers.com>
References: <47FE64E6.3050303@codeweavers.com>
Message-ID: <47FF2C1B.2040004@redhat.com>

Jeremy White wrote:
> I'd like to start the planning for WineConf 2008.
> 
> My sense is that 3 years in Europe and 1 year in the US
> is a reasonable balance, so I feel it makes sense to
> try to have it over here this year.
> 
> Further, I would like to host WineConf this year in St. Paul, Minnesota,
> for a variety of reasons.  First, it's a lot easier for me to help
> plan if it's here.  Second, it's nice for CodeWeavers; it means we
> can have everyone, not just the developers, all together.  Having Mandi
> able to physically intimidate people is very helpful for us, after all <grin>.
> 
> My thought was to do it in late September, early October, so
That's the worst possible date for me. Anyw way to move it to beginning 
of September or end of October?

> that the weather would not be so extreme.  I realize that veterans
> of our last Minnesota meeting will be disappointed at the lack
> of the Ice Palace, but we'll try to find a way to make it up to you.
> 
> Also, I know the travel costs will be hard for many people, given current
> travel costs, so I'm hoping to contribute funds (and perhaps
> do some fund raising) to help cover travel costs for Wine
> contributors.
> 
> At any rate, that's my idea.  I'm willing to be swayed if people
> object violently, or if a clear consensus for an alternate emerges.

bye
	michael


From julliard at winehq.org  Fri Apr 11 04:22:12 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 11 Apr 2008 11:22:12 +0200
Subject: ntdll: Fix a test that fails on both win2k and winxp
In-Reply-To: <22821af30804101608o1e3a7f58p928efcee4a4d09b8@mail.gmail.com>
	(James Hawkins's message of "Thu, 10 Apr 2008 18:08:40 -0500")
References: <22821af30804101608o1e3a7f58p928efcee4a4d09b8@mail.gmail.com>
Message-ID: <87od8ghhkr.fsf@wine.dyndns.org>

"James Hawkins" <jhawkins at codeweavers.com> writes:

> Changelog:
> * Fix a test that fails on both win2k and winxp.

This will break the test for win9x.

-- 
Alexandre Julliard
julliard at winehq.org


From dmitry at codeweavers.com  Fri Apr 11 04:52:50 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 11 Apr 2008 18:52:50 +0900
Subject: tools: Fix font structure layout for 64-bit mode
References: <E1JkE7U-0006vH-7H@mail.codeweavers.com>
	<20080411194617.9b6870ba.mle+win@mega-nerd.com>
Message-ID: <003301c89bb9$cfc0e740$a600fea9@DMITRY>

"Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:

> I quick question from someone relatively new to wine development.
> 
> Are these 64-bit fixes aimed at compiling wine for 64 bit CPUs
> but running win32 apps or for running win64 apps?

Both.

-- 
Dmitry.


From dmitry at codeweavers.com  Fri Apr 11 05:01:20 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 11 Apr 2008 19:01:20 +0900
Subject: AVI file format documentation
References: <a71bd89a0804101142g699fdc9k7ebd4ce3f44e208a@mail.gmail.com><005501c89ba8$22d255c0$a600fea9@DMITRY>
	<b130c85e0804110055q4247a5e2rc7312b19c5992ee0@mail.gmail.com>
Message-ID: <004001c89bbb$0108e950$a600fea9@DMITRY>

"Maarten Lankhorst" <m.b.lankhorst at gmail.com> wrote:

>>  Both dlls/mciavi32 and dlls/avifil32 are able to parse and play AVI files.
> I don't think I can use that from quartz though. It uses the
> asyncreader primitives and I don't believe there is such thing as a
> IRiffReader interface. ;-)

There is no such a thing as IRiffReader interface at all.

> Also, I don't think avifill and mciavi currently support seeking, that
> is very important as well.

That depends on what you mean by "seeking". If that's what commonly used
for moving from one frame to another, or from one position in stream to
another there is nothing magic to implement.

-- 
Dmitry.


From julliard at winehq.org  Fri Apr 11 05:02:44 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 11 Apr 2008 12:02:44 +0200
Subject: kernel32: Fix for WritePrivateProfileString Sharing Problem [1/2]
	(ATTEMPT 3)
In-Reply-To: <4c1ac96d0804101824t55851a07k1cecbde8399af6a6@mail.gmail.com>
	(Erich Hoover's message of "Thu, 10 Apr 2008 19:24:15 -0600")
References: <4c1ac96d0804101758r6f7d58beve93f1a1cc164486f@mail.gmail.com>
	<4c1ac96d0804101824t55851a07k1cecbde8399af6a6@mail.gmail.com>
Message-ID: <87d4owhfp7.fsf@wine.dyndns.org>

"Erich Hoover" <ehoover at mines.edu> writes:

> Description:
>     Fixes incorrect file sharing mode in PROFILE_FlushFile and PROFILE_Open
> that result in WritePrivateProfileString failing under certain
> circumstances.  This problem is specifically evident in the "Thief: Deadly
> Shadows" installer (demo and full), which writes an empty config file that
> later causes the game to crash (Bug #5024). This version is functionally
> equivalent to Attempt 2; however, it uses NtCreateFile so there is no need
> to push and pop the error code.  This version also sets ERROR_SUCCESS, as
> opposed to S_OK, for Get* functions.  Conformance test included in part 2.

There's no need to use ntdll functions, last error doesn't matter on
success, and if it does it should be set at the end of the function
anyway (with test cases showing that it's really supposed to).

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Fri Apr 11 06:02:27 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 11 Apr 2008 13:02:27 +0200
Subject: [1/3] setupapi: Add a test for SetupDiGetDeviceRegistryProperty
	and SetupDiSetDeviceRegistryProperty
In-Reply-To: <200804111336.57900.amorozov@etersoft.ru> (Alexander Morozov's
	message of "Fri, 11 Apr 2008 13:36:57 +0400")
References: <200804111336.57900.amorozov@etersoft.ru>
Message-ID: <8763uohcxo.fsf@wine.dyndns.org>

Alexander Morozov <amorozov at etersoft.ru> writes:

> +    if (wide)
> +    {
> +        pSetupDiGetClassDevs = (void *)pSetupDiGetClassDevsW;
> +        pSetupDiSetDeviceRegistryProperty = (void *)pSetupDiSetDeviceRegistryPropertyW;
> +        pSetupDiGetDeviceRegistryProperty = (void *)pSetupDiGetDeviceRegistryPropertyW;
> +        pSetupDiCreateDeviceInfo = (void *)pSetupDiCreateDeviceInfoW;
> +        devName = (void *)devNameW;
> +        friendlyName = (void *)friendlyNameW;
> +        buflen = 6 * sizeof(WCHAR);
> +        buf = (void *)bufW;
> +    }
> +    else
> +    {
> +        pSetupDiGetClassDevs = (void *)pSetupDiGetClassDevsA;
> +        pSetupDiSetDeviceRegistryProperty = (void *)pSetupDiSetDeviceRegistryPropertyA;
> +        pSetupDiGetDeviceRegistryProperty = (void *)pSetupDiGetDeviceRegistryPropertyA;
> +        pSetupDiCreateDeviceInfo = (void *)pSetupDiCreateDeviceInfoA;
> +        devName = (void *)devNameA;
> +        friendlyName = (void *)friendlyNameA;
> +        buflen = 6;
> +        buf = (void *)bufA;
> +    }

That's ugly, it's bypassing all type checking. There's no reason to test
everything twice, in most cases the A function calls the W one, so
testing the A one automatically tests both. If there are differences you
really need to test, please do that explicitly by duplicating the test.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Fri Apr 11 06:18:58 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 11 Apr 2008 13:18:58 +0200
Subject: [PATCH 1/2] winecfg: Add option to let wine decorate windows
In-Reply-To: <47FE7555.1090100@comcast.net> (Matthew D'Asaro's message of
	"Thu, 10 Apr 2008 13:15:17 -0700")
References: <47FE7555.1090100@comcast.net>
Message-ID: <871w5chc65.fsf@wine.dyndns.org>

Matthew D'Asaro <medasaro at comcast.net> writes:

> Some applications such as iTunes, Winamp, Windows Media Player, Office
> 2007, etc. look best without the Linux windows manager decorations on
> them. This patch adds an option to winecfg which
> allows an application's windows to be managed by the Linux window
> manager, but to be decorated by wine. This can also be useful for
> debugging some window management problems. The modification to the
> winecfg dialog is only in English as I don't know any of the other
> languages.

I put the patch in, but this winecfg page really needs to be redesigned,
the decorated/managed/desktop options are mutually exclusive, so it
should use radio buttons. Also the explanations should be moved out to a
tooltip or some sort of help option. Any volunteer?

-- 
Alexandre Julliard
julliard at winehq.org


From scott at open-vote.org  Fri Apr 11 06:50:05 2008
From: scott at open-vote.org (Scott Ritchie)
Date: Fri, 11 Apr 2008 04:50:05 -0700
Subject: Including Mono within a Wine package - should Wine expect this?
In-Reply-To: <a71bd89a0804101954w31a24e2fn72c027796b771a6e@mail.gmail.com>
References: <a71bd89a0804100645y2b7f9c94n719ab5f19374db04@mail.gmail.com>	
	<47FECF9E.1030309@open-vote.org>
	<a71bd89a0804101954w31a24e2fn72c027796b771a6e@mail.gmail.com>
Message-ID: <47FF506D.4010102@open-vote.org>

Dan Kegel wrote:
> On Thu, Apr 10, 2008 at 7:40 PM, Scott Ritchie <scott at open-vote.org> wrote:
>>  > Wine-mono on the other hand is probably premature.
>>  > How many apps are helped at the moment by
>>  >   winetricks mono12
>>  > ?  I don't think it's a large number.
>>
>>  Honestly I don't know.  Is this due to inadequacies in the current mono,
>>  or inadequacies in Wine?
> 
> Mono doesn't even try to handle mixed-mode assemblies (i.e. ones
> that contain some native code).  And by gum, every .net app built
> by Microsoft tools seems to include some native code for some odd
> reason.  Go figure!

Is this true even for the Windows version of Mono?  If Mono is supposed
to be a replacement for what the .net framework provides, then it seems
like duplicating this functionality on Windows (and therefore Wine)
would be part of it.

I did some searching as for why this is the case.  This link:
http://www.jprl.com/Blog/archive/development/mono/2008/Jan-27.html
indicates that the main issue is the loader supporting PE files, which
is what Wine already does.

> 
>>  Either way, Mono 2.0 will finally come out around the same time as Wine
>>  1.0 (quarter 2 of 2008), and I suspect the number of applications Mono
>>  helps will greatly improve by then.
> 
> Maybe, but only apps that have been properly cleaned of native code.
> - Dan

Hmm...it seems like gluing Mono and Wine together would require a bit
more collaboration than the two projects have.

Thanks,
Scott Ritchie


From thunderbird2k at gmx.net  Fri Apr 11 07:50:59 2008
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Fri, 11 Apr 2008 14:50:59 +0200
Subject: Including Mono within a Wine package - should Wine expect this?
In-Reply-To: <47FF506D.4010102@open-vote.org>
References: <a71bd89a0804100645y2b7f9c94n719ab5f19374db04@mail.gmail.com>	
	<47FECF9E.1030309@open-vote.org>
	<a71bd89a0804101954w31a24e2fn72c027796b771a6e@mail.gmail.com>
	<47FF506D.4010102@open-vote.org>
Message-ID: <20080411125059.293230@gmx.net>

> Dan Kegel wrote:
> > On Thu, Apr 10, 2008 at 7:40 PM, Scott Ritchie <scott at open-vote.org>
> wrote:
> >>  > Wine-mono on the other hand is probably premature.
> >>  > How many apps are helped at the moment by
> >>  >   winetricks mono12
> >>  > ?  I don't think it's a large number.
> >>
> >>  Honestly I don't know.  Is this due to inadequacies in the current
> mono,
> >>  or inadequacies in Wine?
> > 
> > Mono doesn't even try to handle mixed-mode assemblies (i.e. ones
> > that contain some native code).  And by gum, every .net app built
> > by Microsoft tools seems to include some native code for some odd
> > reason.  Go figure!
> 
> Is this true even for the Windows version of Mono?  If Mono is supposed
> to be a replacement for what the .net framework provides, then it seems
> like duplicating this functionality on Windows (and therefore Wine)
> would be part of it.
> 
> I did some searching as for why this is the case.  This link:
> http://www.jprl.com/Blog/archive/development/mono/2008/Jan-27.html
> indicates that the main issue is the loader supporting PE files, which
> is what Wine already does.
> 
> > 
> >>  Either way, Mono 2.0 will finally come out around the same time as
> Wine
> >>  1.0 (quarter 2 of 2008), and I suspect the number of applications Mono
> >>  helps will greatly improve by then.
> > 
> > Maybe, but only apps that have been properly cleaned of native code.
> > - Dan
> 
> Hmm...it seems like gluing Mono and Wine together would require a bit
> more collaboration than the two projects have.
> 
> Thanks,
> Scott Ritchie
> 

For a part the issue is that lots of programs are hybrid ones. Some of them behave 'nicely' in the way they just call a few functions from a native win32 dll. I think apps that embed COM objects (like a Word viewer, ..) are worse as mono doesn't offer this at all. The most problematic thing is that mono's windows.forms is fully managed while microsoft just layered it on top of gdi32/gdiplus/user32. This allows you to use standard win32 apis on most windows.forms controls to override behavior. A lot of apps do this, so even if you could access native win32 dlls, magic like this won't work at all. Second COM objects might also rely on evil win32 magic.

All in all mono only works on a few well behaved apps and most don't behave well. PersonallY I think a win32 mono package for wine is nearly useless.

Roderick
-- 
Psst! Geheimtipp: Online Games kostenlos spielen bei den GMX Free Games! 
http://games.entertainment.gmx.net/de/entertainment/games/free


From stefan at codeweavers.com  Fri Apr 11 07:50:39 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Fri, 11 Apr 2008 14:50:39 +0200
Subject: GL_ATI_fragment_shader and GL_INVALID 0x501, 0x502
In-Reply-To: <200804110106.54219.stefan@codeweavers.com>
References: <e1d9e62c0804071637n76680520ge942d21e4bf8f81f@mail.gmail.com>
	<e1d9e62c0804090533g5b505f43od13e67b41c322024@mail.gmail.com>
	<200804110106.54219.stefan@codeweavers.com>
Message-ID: <200804111450.40053.stefan@codeweavers.com>

Am Freitag, 11. April 2008 01:06:54 schrieb Stefan D?singer:
> Hi,
> I just tried 3DMark2001, and I can confirm the black textures in the high
> car test, so it is not your different card. I am pretty sure this used to
> work though...
Can you try the attached hack? If fixes the black textures in 3DMark 2001 for 
me.


-------------- next part --------------
A non-text attachment was scrubbed...
Name: atifs-hack
Type: text/x-diff
Size: 1853 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080411/742618b8/attachment.diff 

From dmitry at codeweavers.com  Fri Apr 11 08:03:56 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 11 Apr 2008 22:03:56 +0900
Subject: gdi32: Add a test to highlight the CreateCompatibleDC
	problemdescribed in bug #12493
References: <003701c89bd3$a7144f70$652ad40a@colinhome>
Message-ID: <034101c89bd4$8274e4d0$a600fea9@DMITRY>

"Colin Finck" <mail at colinfinck.de> wrote:

> Changelog:
>  Add a gdi32 test to highlight the CreateCompatibleDC problem described in
> bug #12493

If the test fails in current Wine code you need to use todo_wine
so that 'make test' still passes.

-- 
Dmitry.


From ehoover at mines.edu  Fri Apr 11 08:44:03 2008
From: ehoover at mines.edu (Erich Hoover)
Date: Fri, 11 Apr 2008 07:44:03 -0600
Subject: kernel32: Fix for WritePrivateProfileString Sharing Problem [1/2]
	(ATTEMPT 3)
In-Reply-To: <87d4owhfp7.fsf@wine.dyndns.org>
References: <4c1ac96d0804101758r6f7d58beve93f1a1cc164486f@mail.gmail.com>
	<4c1ac96d0804101824t55851a07k1cecbde8399af6a6@mail.gmail.com>
	<87d4owhfp7.fsf@wine.dyndns.org>
Message-ID: <4c1ac96d0804110644g7deae904k4d9cf0947bcd4622@mail.gmail.com>

> There's no need to use ntdll functions,

I submitted prior patches that did not use ntdll, there was a complaint
about that approach since it had to push and pop the last error:
http://www.winehq.org/pipermail/wine-devel/2008-April/064657.html

> last error doesn't matter on success, and if it does it should be set at
the end of the function
anyway (with test cases showing that it's really supposed to).

The very last test in "test_profile_sections" (an existing test) requires
GetPrivateProfileSectionA to return S_OK (ERROR_SUCCESS).  I originally
submitted a patch that broke this test (plus exposed another problem, but
we'll take one step at a time).  There was a complaint about this, but it
was a really long time ago so it'd take me a while to find that email.
Essentially, the write functions need to return the last error from before
they were called (part 2/2 is a conformance test for this) and the get
functions need to set the last error to ERROR_SUCCESS (as shown by an
existing test, though it actually tests against the value-equivalent S_OK).

Erich Hoover
ehoover at mines.edu

On Fri, Apr 11, 2008 at 4:02 AM, Alexandre Julliard <julliard at winehq.org>
wrote:

> "Erich Hoover" <ehoover at mines.edu> writes:
>
> > Description:
> >     Fixes incorrect file sharing mode in PROFILE_FlushFile and
> PROFILE_Open
> > that result in WritePrivateProfileString failing under certain
> > circumstances.  This problem is specifically evident in the "Thief:
> Deadly
> > Shadows" installer (demo and full), which writes an empty config file
> that
> > later causes the game to crash (Bug #5024). This version is functionally
> > equivalent to Attempt 2; however, it uses NtCreateFile so there is no
> need
> > to push and pop the error code.  This version also sets ERROR_SUCCESS,
> as
> > opposed to S_OK, for Get* functions.  Conformance test included in part
> 2.
>
> There's no need to use ntdll functions, last error doesn't matter on
> success, and if it does it should be set at the end of the function
> anyway (with test cases showing that it's really supposed to).
>
> --
> Alexandre Julliard
> julliard at winehq.org
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080411/71276b9a/attachment.htm 

From stefan at codeweavers.com  Fri Apr 11 08:56:12 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Fri, 11 Apr 2008 15:56:12 +0200
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <d658b69e0804110139n5182168bk54498b4e2ba02a7e@mail.gmail.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804110959.56731.stefan@codeweavers.com>
	<d658b69e0804110139n5182168bk54498b4e2ba02a7e@mail.gmail.com>
Message-ID: <200804111556.12566.stefan@codeweavers.com>

Am Freitag, 11. April 2008 10:39:13 schrieb H. Verbeet:
> I think in practice the specular color input is probably more
> important than the two extra textures. It's pretty rare for programs
> to hit the nvrc limit of 4, and if they do they don't usually break as
> bad as when they try to use the missing specular input.
Not really, many games check the MaxSimultaneousTextures cap and use that 
value even if they are using pixel shaders. E.g. HL2 fails in dxlevel 81 with 
that with ARB shaders because it checks that cap if it finds SM 1.x, and Age 
of Empires 3 fails as well. Call of duty 4 is another popular example, it 
requires 8 fixed function textures. (COD4 wants TSSARGTEMP as well, so that 
point is moot)



From hverbeet at gmail.com  Fri Apr 11 09:10:49 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Fri, 11 Apr 2008 16:10:49 +0200
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <200804111556.12566.stefan@codeweavers.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804110959.56731.stefan@codeweavers.com>
	<d658b69e0804110139n5182168bk54498b4e2ba02a7e@mail.gmail.com>
	<200804111556.12566.stefan@codeweavers.com>
Message-ID: <d658b69e0804110710x284c217l84fd271aa01cc7da@mail.gmail.com>

On 11/04/2008, Stefan D?singer <stefan at codeweavers.com> wrote:
> Not really, many games check the MaxSimultaneousTextures cap and use that
>  value even if they are using pixel shaders. E.g. HL2 fails in dxlevel 81 with
>  that with ARB shaders because it checks that cap if it finds SM 1.x, and Age
>  of Empires 3 fails as well. Call of duty 4 is another popular example, it
>  requires 8 fixed function textures. (COD4 wants TSSARGTEMP as well, so that
>  point is moot)
>
Sure, but they don't generally break if you just return 8 there.
(Compared to eg. HL2/CSS in dxlevel70 without D3DTA_SPECULAR). Of
course the proper way to get around all of the issues at the same time
would be to write a real GLSL fixed function fragment processing
implementation, but that doesn't change the fact that the current
situation is pretty ugly.


From stefan at codeweavers.com  Fri Apr 11 09:18:49 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Fri, 11 Apr 2008 16:18:49 +0200
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <d658b69e0804110139n5182168bk54498b4e2ba02a7e@mail.gmail.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804110959.56731.stefan@codeweavers.com>
	<d658b69e0804110139n5182168bk54498b4e2ba02a7e@mail.gmail.com>
Message-ID: <200804111618.49900.stefan@codeweavers.com>

Alexandre didn't commit the patch, I think we should come to an agreement on 
this issue, otherwise it is going to come up again and again.

The requirements I have in mind are these:

1) The state table should be selectable based on the available opengl features 
and possibly registry settings. I think we all agree on that

2) We want a fixed function vertex and fragment pipeline replacement with ARB 
and GLSL

3) We want to be able to support pixel shaders with atifs and nvts. I don't 
know if that will ever be implemented, but if we choose a design that makes 
this hard or impossible that's not going to help

4) Even if we have an ARB/GLSL replacement, it should be possible to use D3D 
shaders but still use the opengl fixed function pipeline

5) A nice to have is to be able to use the replacement pipelines together with 
shaders, but that is not a hard requirement for me. We need an ARB and GLSL 
replacement anyway.

---

I understand Henri's suggestion this way: Don't put the state table into the 
shader backend(*), but select it separately. This way the ATIFS pipeline 
replacement doesn't have to be a shader model. That way we can choose the ARB 
shader backend and ATIFS state table on r200 cards, and use GLSL and ATIFS on 
newer cards.

That way we get full shader support and still the advantages of the pipeline 
replacement without using 3 inherited shader backends. Then the state table 
could have some backend to enable / disable ATIFS like in this patch. (The 
bottom line of the patch here is that we should enable the extension we 
*use*, and not what happens to be available).

The state table would report the fixed function caps it has, and the shader 
backend reports the programmable pipeline caps. GetDeviceCaps has to collect 
the caps from multiple places, but that isn't an issue IMO.

Is that correct, or did I missunderstand something?

However, I see two issues with that:

*) In which place do we decide which program/shader to use in the end? If we 
have an ARB fixed function replacement program and an ARB program generated 
from a D3D shader? Currently this happens to work because ARB/GLSL override 
NVTS and NVRC, but this fails if we have a shader and ffp implementation 
using the same extension

*) What do we do if a shader implementation wants to overwrite some states for 
its programmable pipeline work? For example take my GLSL clipplane patch: The 
ARB shader backend disables clipplanes when a shader is used. This example is 
about a driver bug, but there are others as well: ATIFS and NVTS with a pixel 
shader implementation will have to override a part of the sampler setting(the 
stuff that is currently done in activate_dimensions)

How would you deal with this?

Stefan

(*): Ivan and I agreed on a discussion on IRC that "shader backend" is not a 
good name. The shader backends today are more a pipeline implementation 
rather than a shader implemenation, and should be renamed accordingly. I did 
not rename them yet because I am not 100% happy with the name "pipeline" yet.


From Petr.Sumbera at Sun.COM  Fri Apr 11 09:26:05 2008
From: Petr.Sumbera at Sun.COM (Petr Sumbera)
Date: Fri, 11 Apr 2008 16:26:05 +0200
Subject: Trouble in compiling Wine 0.9.57 and 0.9.58 on Solaris 10 08/07
Message-ID: <47FF74FD.4060307@sun.com>

 >isinf is a function / macro which returns wether or not a float is 
positive
 >infinite or negative infinite. I think it is a standard C function. Maybe
 >solaris declares it in some header that needs to be included, like math.h?

I have logged for this bug: http://bugs.winehq.org/show_bug.cgi?id=12008

Not sure where to find it exactly. But isinf seems to be defined by ISO 
99 (not by standard C).

Regards,

Petr


From dank at kegel.com  Fri Apr 11 09:27:46 2008
From: dank at kegel.com (Dan Kegel)
Date: Fri, 11 Apr 2008 07:27:46 -0700
Subject: Wine malware story
Message-ID: <a71bd89a0804110727q4c51f129y741c60bbed240e19@mail.gmail.com>

http://www.thaibrother.com/blog/?p=1047
is a fairly thin article about malware in wine;
it's worth mentioning only because it shows
the issue is getting discussed more.


From stefan at codeweavers.com  Fri Apr 11 09:32:54 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Fri, 11 Apr 2008 16:32:54 +0200
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <d658b69e0804110710x284c217l84fd271aa01cc7da@mail.gmail.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804111556.12566.stefan@codeweavers.com>
	<d658b69e0804110710x284c217l84fd271aa01cc7da@mail.gmail.com>
Message-ID: <200804111632.54903.stefan@codeweavers.com>

Am Freitag, 11. April 2008 16:10:49 schrieb H. Verbeet:
> Sure, but they don't generally break if you just return 8 there.
> (Compared to eg. HL2/CSS in dxlevel70 without D3DTA_SPECULAR). Of
> course the proper way to get around all of the issues at the same time
> would be to write a real GLSL fixed function fragment processing
> implementation, but that doesn't change the fact that the current
> situation is pretty ugly.
I don't think it's the D3DTA_SPECULAR that breaks things. HL2 doesn't use it. 
If it finds pixel shader support advertised it suddenly works without 
D3DTA_SPECULAR support and does not use pixel shaders either, so I think 
there's a different capability flag issue there(or HL2 is just broken on 
cards without pixel shader support nowadays).


From frank.richter at gmail.com  Fri Apr 11 09:39:11 2008
From: frank.richter at gmail.com (Frank Richter)
Date: Fri, 11 Apr 2008 16:39:11 +0200
Subject: [PATCH] winecfg => control panel applets patch
In-Reply-To: <200804101047.28206.pure_evil@mail.bg>
References: <200804101047.28206.pure_evil@mail.bg>
Message-ID: <ftnt6f$nrm$1@ger.gmane.org>

On 10.04.2008 09:47, pure_evil at mail.bg wrote:
> However, since control panel does not utilize Unicode yet, the additionalb 
> Bulgarian translation matches the English one.

So what's the point of that "translation" then? Right now it doesn't add 
anything worthwhile but increases the patch size - not good.

You probably increase the chance of your patch being accepted by leaving 
out that not-really-a-translation. I'd recommend you submit that as a 
patch at a later point of time. It probably also makes sense to properly 
"unicodify" the control panel before supplying a language that needs it.

-f.r.



From chris.kcat at gmail.com  Fri Apr 11 10:22:20 2008
From: chris.kcat at gmail.com (Chris Robinson)
Date: Fri, 11 Apr 2008 08:22:20 -0700
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <200804111618.49900.stefan@codeweavers.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<d658b69e0804110139n5182168bk54498b4e2ba02a7e@mail.gmail.com>
	<200804111618.49900.stefan@codeweavers.com>
Message-ID: <200804110822.21012.chris.kcat@gmail.com>

On Friday 11 April 2008 07:18:49 am Stefan D?singer wrote:
> Alexandre didn't commit the patch, I think we should come to an agreement
> on this issue, otherwise it is going to come up again and again.

For my own 2 cents on the issue, I think the fixed-function replacements 
should work through the selected shader backend. For example, if someone has 
GLSL enabled, the fixed-function replacement should be done through GLSL, and 
if ARB is used, it should done through ARB shaders. In this way, the atifs 
fixed-function replacement should never be used when the ARB or GLSL shader 
backend is used (one shader mode shouldn't supercede another while the 
program is running).

This would ensure compatibility on the OpenGL side when D3D's fixed-function 
pipeline is mixed with D3D shaders, still leave room for a proper atifs/nvts 
shader backend, and not introduce problems related to how one shader backend 
might interact with another. It honestly doesn't make sense to me why wined3d 
should just jump in and start using atifs/nvts shaders for fixed-function 
replacements, when the selected shader mode is ARB or GLSL. And really, 
atifs/nvts should be last-ditch resorts because they are only available on 
selected vendors, while ARB and GLSL are more widespread (eg. on Intel, 
MESA).

Ideally, in my mind, wined3d should autoselect one shader mode (unless a 
registry option is present to force one). It would be selected based on 
availability:

* if nv vertex/fragment programs are available, they should be used as a 
suppliment to the ARB shader backend (giving up to SM3.0 (4.0, actually), 
with functionality that most closely follows D3D)
* else if GLSL is available, that should be used (giving SM2.0/3.0)
* else if ARB shaders are available, then they should be used (giving PS1.1 
and VS1.4)
* else if atifs/nvts are available, use them (giving SM1.x)
* else disable D3D shaders

In all cases, it should pick one and stick with it through the life of the 
process, for both D3D shaders and D3D fixed-function. Don't use atifs if ARB 
is available, don't use GLSL if nv-supplimented ARB is available, etc.

Though, perhaps I'm misunderstanding the whole issue, and I'm spouting 
non-sense..


From mikolaj at zalewski.pl  Fri Apr 11 10:24:48 2008
From: mikolaj at zalewski.pl (=?UTF-8?B?TWlrb8WCYWogWmFsZXdza2k=?=)
Date: Fri, 11 Apr 2008 17:24:48 +0200
Subject: [PATCH] winecfg => control panel applets patch
In-Reply-To: <ftnt6f$nrm$1@ger.gmane.org>
References: <200804101047.28206.pure_evil@mail.bg> <ftnt6f$nrm$1@ger.gmane.org>
Message-ID: <47FF82C0.4030306@zalewski.pl>

Frank Richter wrote:

>On 10.04.2008 09:47, pure_evil at mail.bg wrote:
>  
>
>>However, since control panel does not utilize Unicode yet, the additionalb 
>>Bulgarian translation matches the English one.
>>    
>>
  Even for non-Unicode apps you should have no problems with adding a 
Bulgarian translation to a GUI app (when Bulgarian is selected as your 
preferred language the active codepage will be chosen accordingly). 
Maybe you used a wrong charset? You should use the Windows charset or 
use #pragma (see 
http://wiki.winehq.org/Developers-Hints?highlight=%28Developers%29#head-ef42a958e4f633dbd4a0ae42649fa02a4d1827fd 
)

Miko?aj Zalewski


From most at museresearch.com  Fri Apr 11 12:12:26 2008
From: most at museresearch.com (Michael Ost)
Date: Fri, 11 Apr 2008 10:12:26 -0700
Subject: Wine malware story
In-Reply-To: <mailman.5.1207933202.27994.wine-devel@winehq.org>
References: <mailman.5.1207933202.27994.wine-devel@winehq.org>
Message-ID: <47FF9BFA.9070900@museresearch.com>

"Dan Kegel" <dank at kegel.com> wrote:
> http://www.thaibrother.com/blog/?p=1047
> is a fairly thin article about malware in wine;
> it's worth mentioning only because it shows
> the issue is getting discussed more.

As Wine gains functionality --- supporting Windows services, binary 
drivers, registry startup programs, etc --- it seems like it will be 
more vulnerable on this score.

 From my somewhat naive point of view regarding Windows malware, I would 
like to see Wine have the option of only running the app that I asked it 
to and not a bunch of other stuff that gets auto-loaded and run.

An option like that could be billed as making Wine "safer" than Windows.

I'm also really glad that my Wine-based product is moving away from 
running Wine as root!

Cheers... mo


From zgs at seas.upenn.edu  Fri Apr 11 12:41:14 2008
From: zgs at seas.upenn.edu (Zachary Goldberg)
Date: Fri, 11 Apr 2008 13:41:14 -0400
Subject: [Wine] Uninstallation of Programs
In-Reply-To: <b6bb06270804111009x43dff92bh472e2f1b9d6c8130@mail.gmail.com>
References: <1207933293.m2f.3286@forum.winehq.org>
	<b6bb06270804111009x43dff92bh472e2f1b9d6c8130@mail.gmail.com>
Message-ID: <b050a5e70804111041k48e3d7bepeb55b83bdcd4b488@mail.gmail.com>

On Fri, Apr 11, 2008 at 1:09 PM, Austin English <austinenglish at gmail.com> wrote:
> On Fri, Apr 11, 2008 at 12:01 PM, pdsmith <wineforum-user at winehq.org> wrote:

<snip>

>
>  $ wine uninstaller
>
>  Will launch the uninstaller, but it doesn't always work too well, and
>  it's not a high priority to fix.

Should we perhaps reconsider that for 1.0?  Perhaps something worth
fixing during the freeze?

> If you want to remove all programs
>  and settings, you can do
>  $ rm -rf ~/.wine
>
>  To start fresh. It will be recreated whenever you run any wine program.
>
>



-- 
Zachary Goldberg
Computer Science & Engineering
Electrical Captain of Penn Electric Race Team
School of Engineering at the University of Pennsylvania


From austinenglish at gmail.com  Fri Apr 11 13:06:00 2008
From: austinenglish at gmail.com (Austin English)
Date: Fri, 11 Apr 2008 13:06:00 -0500
Subject: [Wine] Uninstallation of Programs
In-Reply-To: <b050a5e70804111041k48e3d7bepeb55b83bdcd4b488@mail.gmail.com>
References: <1207933293.m2f.3286@forum.winehq.org>
	<b6bb06270804111009x43dff92bh472e2f1b9d6c8130@mail.gmail.com>
	<b050a5e70804111041k48e3d7bepeb55b83bdcd4b488@mail.gmail.com>
Message-ID: <b6bb06270804111106g585d3961m81bbfc76879fe60a@mail.gmail.com>

On Fri, Apr 11, 2008 at 12:41 PM, Zachary Goldberg <zgs at seas.upenn.edu> wrote:
> On Fri, Apr 11, 2008 at 1:09 PM, Austin English <austinenglish at gmail.com> wrote:
>  > On Fri, Apr 11, 2008 at 12:01 PM, pdsmith <wineforum-user at winehq.org> wrote:
>
>  <snip>
>
>
>  >
>  >  $ wine uninstaller
>  >
>  >  Will launch the uninstaller, but it doesn't always work too well, and
>  >  it's not a high priority to fix.
>
>  Should we perhaps reconsider that for 1.0?  Perhaps something worth
>  fixing during the freeze?
>
>
>
>  > If you want to remove all programs
>  >  and settings, you can do
>  >  $ rm -rf ~/.wine
>  >
>  >  To start fresh. It will be recreated whenever you run any wine program.
>  >
>  >
>
>
>
>  --
>  Zachary Goldberg
>  Computer Science & Engineering
>  Electrical Captain of Penn Electric Race Team
>  School of Engineering at the University of Pennsylvania
>

A) It's a bit late to add bugs to 1.0.0. Maybe 1.2.0
B) Uninstalling apps in wine isn't that important. A simple rm -rf
~/.wine does the same. I grant that it's difficult if you have a lot
of apps installed, but you could avoid this with using differing
wineprefixes.
C) There are many more important bugs to fix.


From juan.lang at gmail.com  Fri Apr 11 13:08:49 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Fri, 11 Apr 2008 11:08:49 -0700
Subject: [Wine] Uninstallation of Programs
In-Reply-To: <b6bb06270804111106g585d3961m81bbfc76879fe60a@mail.gmail.com>
References: <1207933293.m2f.3286@forum.winehq.org>
	<b6bb06270804111009x43dff92bh472e2f1b9d6c8130@mail.gmail.com>
	<b050a5e70804111041k48e3d7bepeb55b83bdcd4b488@mail.gmail.com>
	<b6bb06270804111106g585d3961m81bbfc76879fe60a@mail.gmail.com>
Message-ID: <3a768c550804111108r695b8673h19d13a4c840f2229@mail.gmail.com>

>  B) Uninstalling apps in wine isn't that important. A simple rm -rf
>  ~/.wine does the same.

Not entirely.  It doesn't remove desktop icons, menu entries, etc.
--Juan


From zgs at seas.upenn.edu  Fri Apr 11 13:11:05 2008
From: zgs at seas.upenn.edu (Zachary Goldberg)
Date: Fri, 11 Apr 2008 14:11:05 -0400
Subject: [Wine] Uninstallation of Programs
In-Reply-To: <3a768c550804111108r695b8673h19d13a4c840f2229@mail.gmail.com>
References: <1207933293.m2f.3286@forum.winehq.org>
	<b6bb06270804111009x43dff92bh472e2f1b9d6c8130@mail.gmail.com>
	<b050a5e70804111041k48e3d7bepeb55b83bdcd4b488@mail.gmail.com>
	<b6bb06270804111106g585d3961m81bbfc76879fe60a@mail.gmail.com>
	<3a768c550804111108r695b8673h19d13a4c840f2229@mail.gmail.com>
Message-ID: <b050a5e70804111111q5fa7443an55ed6cf11ea0c4b4@mail.gmail.com>

On Fri, Apr 11, 2008 at 2:08 PM, Juan Lang <juan.lang at gmail.com> wrote:
> >  B) Uninstalling apps in wine isn't that important. A simple rm -rf
>  >  ~/.wine does the same.
>
>  Not entirely.  It doesn't remove desktop icons, menu entries, etc.
>  --Juan
>

I agree that its certainly not necessary functionality wise, but to
what extend are we going for polish and shine for 1.0 as a whole
package, including bundled apps?  I feel like 1.0 is as good a time as
ever to try and make some of these things work.

-- 
Zachary Goldberg
Computer Science & Engineering
Electrical Captain of Penn Electric Race Team
School of Engineering at the University of Pennsylvania


From kacper.pluta at gmail.com  Fri Apr 11 13:11:05 2008
From: kacper.pluta at gmail.com (Kacper Pluta)
Date: Fri, 11 Apr 2008 20:11:05 +0200
Subject: Better sound support
Message-ID: <47FFA9B9.1010703@gmail.com>

Hey, do you plan on enabling handling of 24bit sound and sampling
frequencies 96000 or 192000? Lots of musicians using Linux need to use
VST and VSTi plugins (through FST and other methods). Unfortunately
quality of music you can acquire isn't realy high if you wish to use it
professionally. I'd also suggest correcting MIDI handling and
integrating wine with wineasio, which would enable using VST and VSTi on
a quite high level, as well as use other programmes.



From stefan at codeweavers.com  Fri Apr 11 10:35:21 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Fri, 11 Apr 2008 17:35:21 +0200
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <200804110822.21012.chris.kcat@gmail.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804111618.49900.stefan@codeweavers.com>
	<200804110822.21012.chris.kcat@gmail.com>
Message-ID: <200804111735.21536.stefan@codeweavers.com>

Am Freitag, 11. April 2008 17:22:20 schrieb Chris Robinson:
> In all cases, it should pick one and stick with it through the life of the
> process, for both D3D shaders and D3D fixed-function. Don't use atifs if
> ARB is available, don't use GLSL if nv-supplimented ARB is available, etc.
There are three issues that lead to this discussion:

*) We may want to mix shader backends. GLSL is a pain on MacOS at least on the 
vertex side, but it works okish on the fragment shader side. It may be 
helpful to compile a ARB vertex shader and a GLSL pixel shader. Also an ARB 
replacement may be faster there because the GLSL compiler on MacOS often 
creates slow code.

*) We have an NVTS and ATIFS replacement now, but no ARB or GLSL fragment 
processing code, and it would be cool if we can make use of the ATIFS code on 
newer cards as well. NVTS currently works because it is included in the 
baseshader/fixed function backend.

*) It's also about getting the design right in principle, and finding a design 
that doesn't need an entire rework when dx10 and geometry shaders are 
introduced.


From zgs at seas.upenn.edu  Fri Apr 11 13:15:50 2008
From: zgs at seas.upenn.edu (Zachary Goldberg)
Date: Fri, 11 Apr 2008 14:15:50 -0400
Subject: [Wine] Uninstallation of Programs
In-Reply-To: <3a768c550804111112w6aeee430h560765c07ab05b33@mail.gmail.com>
References: <1207933293.m2f.3286@forum.winehq.org>
	<b6bb06270804111009x43dff92bh472e2f1b9d6c8130@mail.gmail.com>
	<b050a5e70804111041k48e3d7bepeb55b83bdcd4b488@mail.gmail.com>
	<b6bb06270804111106g585d3961m81bbfc76879fe60a@mail.gmail.com>
	<3a768c550804111108r695b8673h19d13a4c840f2229@mail.gmail.com>
	<b050a5e70804111111q5fa7443an55ed6cf11ea0c4b4@mail.gmail.com>
	<3a768c550804111112w6aeee430h560765c07ab05b33@mail.gmail.com>
Message-ID: <b050a5e70804111115k26ddc247l2a742f43817709e1@mail.gmail.com>

On Fri, Apr 11, 2008 at 2:12 PM, Juan Lang <juan.lang at gmail.com> wrote:
> >  I agree that its certainly not necessary functionality wise, but to
>  >  what extend are we going for polish and shine for 1.0 as a whole
>  >  package, including bundled apps?  I feel like 1.0 is as good a time as
>  >  ever to try and make some of these things work.
>
>  I don't think patches will ever be refused outside the code freeze ;-)
>  --Juan
>

My current semester ends during the code freeze :/.  Perhaps post 1.0 though.

-- 
Zachary Goldberg
Computer Science & Engineering
Electrical Captain of Penn Electric Race Team
School of Engineering at the University of Pennsylvania


From pure_evil at mail.bg  Fri Apr 11 13:29:45 2008
From: pure_evil at mail.bg (pure_evil at mail.bg)
Date: Fri, 11 Apr 2008 21:29:45 +0300
Subject: [PATCH] winecfg => control panel applets patch
Message-ID: <200804112129.45779.pure_evil@mail.bg>

> However, since control panel does not utilize Unicode yet, the additionalb 
> Bulgarian translation matches the English one.

> So what's the point of that "translation" then? Right now it doesn't add 
> anything worthwhile but increases the patch size - not good.
Well, it was intended as a template and as a "forward compatibility" thing. 
(I know, it's REALLY annoying to have a stub mark the beginning of a 400 
lines+ of patch. ugh. don't know why that one came to be the first file... 
It's place is somewhere in-between the icons IMHO.)

> You probably increase the chance of your patch being accepted by leaving 
> out that not-really-a-translation. I'd recommend you submit that as a 
> patch at a later point of time. It probably also makes sense to properly 
> "unicodify" the control panel before supplying a language that needs it.

Control panel doesn't support Unicode, so I could've dropped all that language 
mumbo-jumbo alltogether - it indeed adds a lot of overhead and complexity to 
the entire thing. However, I wanted to provide a forward-compatible solution 
(and, Dan Kegel said straight: go for Unicode!), rather than coding 
for-the-moment. 
(which also explains the *not-so-optimal* way I handled the winecfg mod 
itself. Now I understand a new tab is to be added... and with a slight 
modification, a seventh applet will appear. (and it'll require less time to 
do than to draw the icon)

And really, introducing a new capability (home-grown applets), modifying 
winecfg -and- unicodifying control panel at the same time would've been a tad 
overkill. I was thinking of (should the control panel be accepted at all) 
unicodifying the control and providing the right translation for the applets 
in the next patch, in which case I'd be modifying only the pre-existing .rc 
rather than poking in the applet source.

/Then again, a few languages might not actually require Unicode for those 
texts, so, someone seeing that it's capable of being translated speaking the 
right language.../


From austinenglish at gmail.com  Fri Apr 11 13:16:40 2008
From: austinenglish at gmail.com (Austin English)
Date: Fri, 11 Apr 2008 13:16:40 -0500
Subject: [Wine] Uninstallation of Programs
In-Reply-To: <3a768c550804111112w6aeee430h560765c07ab05b33@mail.gmail.com>
References: <1207933293.m2f.3286@forum.winehq.org>
	<b6bb06270804111009x43dff92bh472e2f1b9d6c8130@mail.gmail.com>
	<b050a5e70804111041k48e3d7bepeb55b83bdcd4b488@mail.gmail.com>
	<b6bb06270804111106g585d3961m81bbfc76879fe60a@mail.gmail.com>
	<3a768c550804111108r695b8673h19d13a4c840f2229@mail.gmail.com>
	<b050a5e70804111111q5fa7443an55ed6cf11ea0c4b4@mail.gmail.com>
	<3a768c550804111112w6aeee430h560765c07ab05b33@mail.gmail.com>
Message-ID: <b6bb06270804111116k29aaaa07j836394f915098d30@mail.gmail.com>

On Fri, Apr 11, 2008 at 1:12 PM, Juan Lang <juan.lang at gmail.com> wrote:
> >  I agree that its certainly not necessary functionality wise, but to
>  >  what extend are we going for polish and shine for 1.0 as a whole
>  >  package, including bundled apps?  I feel like 1.0 is as good a time as
>  >  ever to try and make some of these things work.
>
>  I don't think patches will ever be refused outside the code freeze ;-)
>  --Juan
>

Doesn't seem to be any uninstaller metabug/general bug, so I nominated
steam uninstall for 1.2:
http://bugs.winehq.org/show_bug.cgi?id=9114

That way at least one uninstaller is on the list, we can add more
later when/if needed.

Removing icons is already nominated ,see:
http://bugs.winehq.org/show_bug.cgi?id=10277


From mail at colinfinck.de  Fri Apr 11 08:25:48 2008
From: mail at colinfinck.de (Colin Finck)
Date: Fri, 11 Apr 2008 15:25:48 +0200
Subject: gdi32: Add a test to highlight the CreateCompatibleDC
	problemdescribed in bug #12493
In-Reply-To: <034101c89bd4$8274e4d0$a600fea9@DMITRY>
References: <003701c89bd3$a7144f70$652ad40a@colinhome>
	<034101c89bd4$8274e4d0$a600fea9@DMITRY>
Message-ID: <004201c89bd7$8e5ea3a0$652ad40a@colinhome>

Dmitry Timoshkov wrote:
> If the test fails in current Wine code you need to use todo_wine
> so that 'make test' still passes.

Ok, I submitted an updated patch:
http://www.winehq.org/pipermail/wine-patches/2008-April/053202.html

Best regards,

Colin Finck



From kacper.pluta at gmail.com  Fri Apr 11 12:07:56 2008
From: kacper.pluta at gmail.com (Kacper Pluta)
Date: Fri, 11 Apr 2008 19:07:56 +0200
Subject: Better sound support
Message-ID: <47FF9AEC.6060700@gmail.com>

Hey, do you plan on enabling handling of 24bit sound and sampling 
frequencies 96000 or 192000? Lots of musicians using Linux need to use 
VST and VSTi plugins (through FST and other methods). Unfortunately 
quality of music you can acquire isn't realy high if you wish to use it 
professionally. I'd also suggest correcting MIDI handling and 
integrating wine with wineasio, which would enable using VST and VSTi on 
a quite high level, as well as use other programmes.


From pure_evil at mail.bg  Fri Apr 11 13:50:01 2008
From: pure_evil at mail.bg (pure_evil at mail.bg)
Date: Fri, 11 Apr 2008 21:50:01 +0300
Subject: [PATCH] winecfg => control panel applets patch
Message-ID: <200804112150.01559.pure_evil@mail.bg>

Frank Richter wrote:

>On 10.04.2008 09:47, pure_evil at mail.bg wrote:
>  
>
>>However, since control panel does not utilize Unicode yet, the additionalb 
>>Bulgarian translation matches the English one.
>>    
>>
>  Even for non-Unicode apps you should have no problems with adding a 
> Bulgarian translation to a GUI app (when Bulgarian is selected as your 
> preferred language the active codepage will be chosen accordingly). 
> Maybe you used a wrong charset? You should use the Windows charset or 
> use #pragma (see 
>http://wiki.winehq.org/Developers-Hints?highlight=%28Developers%29#head-ef42a958e4f633dbd4a0ae42649fa02a4d1827fd 
>)

>Miko?aj Zalewski
Hmmm, I'll have to check up on that. The translations themselves are for the 
description/title that appears under the applet in the control panel. 
Once launched,(LANG=bg_BG) the winecfg translations take over and no problem 
there, just the unicode thing looks like rubbish under the icon. And, has 
twice as many characters as the text itself, which points to a problem within 
the control, rather than the codepage (?) - most probably, usage of ASCII 
rather than Unicode in control itself.

-ugh if this message also ends up as a new thread I'm gonna shoot KMail and 
try to get a decent program that doesn't f* up mail lists... suggestions?-


From chris.kcat at gmail.com  Fri Apr 11 13:41:57 2008
From: chris.kcat at gmail.com (Chris Robinson)
Date: Fri, 11 Apr 2008 11:41:57 -0700
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <200804111735.21536.stefan@codeweavers.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804110822.21012.chris.kcat@gmail.com>
	<200804111735.21536.stefan@codeweavers.com>
Message-ID: <200804111141.58596.chris.kcat@gmail.com>

On Friday 11 April 2008 08:35:21 am Stefan D?singer wrote:
> *) We may want to mix shader backends. GLSL is a pain on MacOS at least on
> the vertex side, but it works okish on the fragment shader side. It may be
> helpful to compile a ARB vertex shader and a GLSL pixel shader. Also an ARB
> replacement may be faster there because the GLSL compiler on MacOS often
> creates slow code.

As far as I can see, OSX's broken drivers are the only reason you'd not want 
to use GLSL when nothing else of better capability is available. For that 
case, there's two options: for nVidia users, extend ARB shaders with nv 
programs and use them (likely suprassing GLSL performance), and for other 
cards, bug Apple for proper drivers. IMHO, I don't think WineD3D should be 
that hindered and cause WineD3D issues with other vendors because Apple 
insists on making drivers themselves, and doing a poor job at it.

> *) We have an NVTS and ATIFS replacement now, but no ARB or GLSL fragment
> processing code, and it would be cool if we can make use of the ATIFS code
> on newer cards as well. NVTS currently works because it is included in the
> baseshader/fixed function backend.

Why would it be cool to use ATIFS on newer cards? It'd be cool if we had 
something lean, sleek, and working. Mixing output shader modes is just asking 
for problems, IMO.

> *) It's also about getting the design right in principle, and finding a
> design that doesn't need an entire rework when dx10 and geometry shaders
> are introduced.

As it is, I imagine WineD3D will need to be reworked for D3D10 no matter what 
we do here. Unless someone has a working design plan for what changes are 
needed by D3D10 for WineD3D, we're ultimately just guessing about what may 
work best (not to mention it'll be using GL3 instead of the current stuff, so 
whatever's picked may not even be efficient API-wise for it).


From mikolaj at zalewski.pl  Fri Apr 11 13:43:27 2008
From: mikolaj at zalewski.pl (=?UTF-8?B?TWlrb8WCYWogWmFsZXdza2k=?=)
Date: Fri, 11 Apr 2008 20:43:27 +0200
Subject: [PATCH] winecfg => control panel applets patch
In-Reply-To: <200804112150.01559.pure_evil@mail.bg>
References: <200804112150.01559.pure_evil@mail.bg>
Message-ID: <47FFB14F.7010208@zalewski.pl>


>Hmmm, I'll have to check up on that. The translations themselves are for the 
>description/title that appears under the applet in the control panel. 
>Once launched,(LANG=bg_BG) the winecfg translations take over and no problem 
>there, just the unicode thing looks like rubbish under the icon. And, has 
>twice as many characters as the text itself, which points to a problem within 
>the control, rather than the codepage (?) - most probably, usage of ASCII 
>rather than Unicode in control itself.
>  
>
  If there are twice as many characters in the text as there should be 
then you have probably encoded the file in UTF-8. Try to add '#pragma 
code_page(65001)' at the top and '#pragma code_page(default)' at the 
bottom of Bg.rc. By default wrc expects the string to be in the Windows 
codepage for the specified language.

Miko?aj Zalewski


From juan.lang at gmail.com  Fri Apr 11 13:12:33 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Fri, 11 Apr 2008 11:12:33 -0700
Subject: [Wine] Uninstallation of Programs
In-Reply-To: <b050a5e70804111111q5fa7443an55ed6cf11ea0c4b4@mail.gmail.com>
References: <1207933293.m2f.3286@forum.winehq.org>
	<b6bb06270804111009x43dff92bh472e2f1b9d6c8130@mail.gmail.com>
	<b050a5e70804111041k48e3d7bepeb55b83bdcd4b488@mail.gmail.com>
	<b6bb06270804111106g585d3961m81bbfc76879fe60a@mail.gmail.com>
	<3a768c550804111108r695b8673h19d13a4c840f2229@mail.gmail.com>
	<b050a5e70804111111q5fa7443an55ed6cf11ea0c4b4@mail.gmail.com>
Message-ID: <3a768c550804111112w6aeee430h560765c07ab05b33@mail.gmail.com>

>  I agree that its certainly not necessary functionality wise, but to
>  what extend are we going for polish and shine for 1.0 as a whole
>  package, including bundled apps?  I feel like 1.0 is as good a time as
>  ever to try and make some of these things work.

I don't think patches will ever be refused outside the code freeze ;-)
--Juan


From hverbeet at gmail.com  Fri Apr 11 15:42:17 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Fri, 11 Apr 2008 22:42:17 +0200
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <200804111618.49900.stefan@codeweavers.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804110959.56731.stefan@codeweavers.com>
	<d658b69e0804110139n5182168bk54498b4e2ba02a7e@mail.gmail.com>
	<200804111618.49900.stefan@codeweavers.com>
Message-ID: <d658b69e0804111342t214f49b1t5faea9081e8b70b8@mail.gmail.com>

On 11/04/2008, Stefan D?singer <stefan at codeweavers.com> wrote:
>  1) The state table should be selectable based on the available opengl features
>  and possibly registry settings. I think we all agree on that
>
Up to the level of being able to use different state handlers in
different situations. I don't necessarily agree with copying and
swapping the entire table in one piece.

>  2) We want a fixed function vertex and fragment pipeline replacement with ARB
>  and GLSL
>
Only GLSL is a requirement for me. ARB could be nice, but is probably redundant.

>  3) We want to be able to support pixel shaders with atifs and nvts. I don't
>  know if that will ever be implemented, but if we choose a design that makes
>  this hard or impossible that's not going to help
>
This is not a hard requirement for me, although I certainly think we
should be able to create a design that allows for this.

>  4) Even if we have an ARB/GLSL replacement, it should be possible to use D3D
>  shaders but still use the opengl fixed function pipeline
>
Agreed.

>  5) A nice to have is to be able to use the replacement pipelines together with
>  shaders, but that is not a hard requirement for me. We need an ARB and GLSL
>  replacement anyway.
>
I assume you mean atifs & nvrc specifically here, in which case this
is probably a bit more important than "nice to have". The most tricky
situation to support here will be cards that support vertex shaders,
but not fragment shaders. If we want to support pixel shaders using
atifs / nvrc we have to allow mixing GLSL / ARB with nvrc / atifs for
it to be of any use.


>  I understand Henri's suggestion this way: Don't put the state table into the
>  shader backend(*), but select it separately. This way the ATIFS pipeline
>  replacement doesn't have to be a shader model. That way we can choose the ARB
>  shader backend and ATIFS state table on r200 cards, and use GLSL and ATIFS on
>  newer cards.
>
>  That way we get full shader support and still the advantages of the pipeline
>  replacement without using 3 inherited shader backends. Then the state table
>  could have some backend to enable / disable ATIFS like in this patch. (The
>  bottom line of the patch here is that we should enable the extension we
>  *use*, and not what happens to be available).
>
>  The state table would report the fixed function caps it has, and the shader
>  backend reports the programmable pipeline caps. GetDeviceCaps has to collect
>  the caps from multiple places, but that isn't an issue IMO.
>
>  Is that correct, or did I missunderstand something?
>
My main point is that a fixed function replacement and the shader
backend should be two different things, at least interface wise. My
suggestion for an implementation would be somethingg like this:

  - Split the state table in three pieces: vertex processing states
(eg. lighting, materials, etc), fragment processing states (eg.
texture stage stuff) and other states (eg. blending states). Aside
from being clearer this allows you to swap these parts out
independently from each other and possibly skip applying them as a
whole in case a shader is active for that part of the pipeline (I
imagine this could have some performance advantages as well, although
I'm not sure how much).
  - Allow the state table more explicitly to have some state of its
own. It currently has the list of dirty states of course, but it's
more managed by the device than by the statetable as such. In effect
this would introduce a state management object.

The basic setup would be something like this:

struct shader_backend_t
{
    void (*shader_select)(void *data, BOOL usePS, BOOL useVS);
    void (*shader_load_constants)(void *data, char usePS, char useVS);
    ...
};

struct state_management_t
{
    void (*mark_state_dirty)(void *data, DWORD state);
    void (*apply_states)(void *data);
    ...
};

struct IWineD3DDeviceImpl {
    ...
    struct state_management_t vertex_state_manager;
    struct state_management_t fragment_state_manager;
    struct state_management_t other_state_manager;
    struct shader_backend_t shader_backend;

    void *vertex_private_data;
    void *fragment_private_data;
    void *other_private_data;
    void *shader_private_data;
    ...
};

/* Usage */
device->vertex_state_manager->mark_state_dirty(device->vertex_private_data,
state);
device->fragment_state_manager->mark_state_dirty(device->fragment_private_data,
state);
etc.
...
if (!use_vs) {
	device->vertex_state_manager->apply_states(device->vertex_private_data);
}
if (!use_ps) {
	device->fragment_state_manager->apply_states(device->fragment_private_data);
}
device->shader_backend->select_shader(device->shader_private_date,
use_vs, use_ps);


Some example configurations:

GLSL FFP, GLSL shaders
	device = {glsl_vsm, glsl_fsm, ff_osm, glsl_shader_backend,
glsl_private_data, glsl_private_data, ff_private_data,
glsl_private_data};

Fixed function vertex, ATIFS fragment processing, GLSL shader backend
	device = {ff_vsm, atifs_fsm, ff_osm, glsl_shader_backend,
ff_private_data, atifs_private_data, ff_private_data,
glsl_private_data};

ARB vertex FFP, Fixed function fragment, ARB shaders
	device = arb_vsm, ff_fsm, ff_osm, arb_shader_backend,
arb_ffp_private_data, ff_private_data, ff_private_data,
arb_shader_private_data};

This doesn't support mixing eg. ARB vertex shaders with NVRC pixel
shaders, but it would "simply" be a matter of splitting up the shader
backend in a similar way to the state table. Important to note here is
that the private data could be shared between fixed function
replacements and the shader backend, like in the case of GLSL. I could
imagine using a structure more similar to state_management_t for the
shader backend as well.

Of course there are a number of variations you can make on this
(perhaps most notably storing the call tables and private data in the
same struct), but I think the important parts are the split between
vertex/fragment/other/shader, and the state management having private
data.

>  However, I see two issues with that:
>
>  *) In which place do we decide which program/shader to use in the end? If we
>  have an ARB fixed function replacement program and an ARB program generated
>  from a D3D shader? Currently this happens to work because ARB/GLSL override
>  NVTS and NVRC, but this fails if we have a shader and ffp implementation
>  using the same extension
>
The private data between the FFP replacement and the shader backend
can be shared. That means our general GLSL management stuff can see
you've got eg. a FFP vertex shader and a pixel shader and link them
together.

>  *) What do we do if a shader implementation wants to overwrite some states for
>  its programmable pipeline work? For example take my GLSL clipplane patch: The
>  ARB shader backend disables clipplanes when a shader is used. This example is
>  about a driver bug, but there are others as well: ATIFS and NVTS with a pixel
>  shader implementation will have to override a part of the sampler setting(the
>  stuff that is currently done in activate_dimensions)
>
>  How would you deal with this?
>
I guess this will mostly be an issue for states that end up being in
the "other" category. In general I think that as long as it's only for
a couple of states we can just keep doing more or less what we
currently do and check if the relevant state management backend is
used.


From spedrosa at gmail.com  Fri Apr 11 15:44:32 2008
From: spedrosa at gmail.com (Stephen Eilert)
Date: Fri, 11 Apr 2008 17:44:32 -0300
Subject: Better sound support
In-Reply-To: <47FFA9B9.1010703@gmail.com>
References: <47FFA9B9.1010703@gmail.com>
Message-ID: <47FFCDB0.5050209@gmail.com>

Kacper Pluta wrote:
> Hey, do you plan on enabling handling of 24bit sound and sampling
> frequencies 96000 or 192000? Lots of musicians using Linux need to use
> VST and VSTi plugins (through FST and other methods). Unfortunately
> quality of music you can acquire isn't realy high if you wish to use it
> professionally. I'd also suggest correcting MIDI handling and
> integrating wine with wineasio, which would enable using VST and VSTi on
> a quite high level, as well as use other programmes.
>
>
>
>   
I'd suggest creating a bug report in bugs.winehq.org, detailing the 
broken applications and/or plugins while you wait for a developer answer.


Stephen


From msclrhd at googlemail.com  Fri Apr 11 17:22:36 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Fri, 11 Apr 2008 23:22:36 +0100
Subject: Wine running (not so) random applications (with a few bugs)...
Message-ID: <3f4fd2640804111522hd90189nff24318252b2f59@mail.gmail.com>

Several releases back, I tried getting the Cepstral SwiftTalker
Text-To-Speech program working, but to no avail. I tried again last
night and was surprised that it worked! So I decided to throw several
applications at Wine out of the box, with no modifications and see how
well it did.

These are my findings:


== Firefox 3 (Beta 4)

I have basically reproduced Dan Kegel's findings (including bugs 12305
and 1237). I also successfully upgraded from beta 4 to 5 and ran in
both XP and Vista modes. Other things I noticed:

  * firefox dialogs (e.g. the "Default Browser" dialog) are cropped at
the bottom, cutting off the buttons (bug 12511).

Verdict: Very close to perfect. Usable for most things with a few
minor annoyances.


== Cepstral SwiftTalker (http://downloads.cepstral.com/downloads/)

This is a text-to-speech program that I use constantly. It now works
under Wine - yay! Using an unregistered voice, voice rendering is
smooth and sentence reading highlighting is synchronised perfectly,
even at 374 words per minute!

Issues:

  * Ctrl+Home and Ctrl+End don't work as on Windows (go to the
start/end of the document). This is the same in notepad (bug 12512).

  * Changing the voice speed also changes the font to Courier New
Italic. It looks like the SwiftTalker application is using Courier New
initially (and rendering correctly on startup), but when you edit the
Tools->Options, it does not find Courier New in the available fonts
(bug 12513).

  * There is a slight audio glitch when using a registered voice that
is noticeable either as a pop or as an overlapped playback with the
previous word whenever there is a sentence changeover. This is hardly
noticable on the default 170 WPM, but is more pronounced on my default
247 WPM setting.

Verdict: Near perfect. The audio glitch can get irritating at times
and is the only thing preventing me giving this a Perfect verdict.


== Popcap Games

There can't be an application test list without mentioning games, so
here we are. The games tested were:
  * Peggle (http://popcap.com/games/peggle)
  * Bejeweled 2 (http://popcap.com/games/bejeweled2)

The games run smoothly, including sound, full screen graphics and
custom cursors.

Issues:

  * The installer fails to create Uhttp://mail.google.com/mail/RL
links (e.g. http://www.popcap.com)

  * Selecting hardware acceleration from within Peggle causes the game
to render a black screen.

Verdict: Perfect.


== Yahoo Games (http://games.yahoo.com/downloads)

Even more games, e.g. Aveyond.

Issues:

  * Could not get past the initial page as the gecko HTML engine
failed to install resulting in the "HTML rendering is currently
disabled" text appearing. This is a regression, as it worked in older
versions of Wine. NOTE: I haven't done a bisect yet.

Verdict: Non-starter.


Thanks for all the great work. Wine keeps on improving release on
release and continues to amaze me. Special thanks to the CodeWeavers
team and the DirectX developers for all the hard work gone into making
Wine what it is today.

- Reece


From stefan at codeweavers.com  Fri Apr 11 17:57:57 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sat, 12 Apr 2008 00:57:57 +0200
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <d658b69e0804111342t214f49b1t5faea9081e8b70b8@mail.gmail.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804111618.49900.stefan@codeweavers.com>
	<d658b69e0804111342t214f49b1t5faea9081e8b70b8@mail.gmail.com>
Message-ID: <200804120057.57495.stefan@codeweavers.com>

Am Freitag, 11. April 2008 22:42:17 schrieb H. Verbeet:

I did not yet read it in depth, so I am just replying to a few concerns I 
spotted. I'll look at it more in-depth tomorrow.

> >  1) The state table should be selectable based on the available opengl
> > features and possibly registry settings. I think we all agree on that
>
> Up to the level of being able to use different state handlers in
> different situations. I don't necessarily agree with copying and
> swapping the entire table in one piece.
Agreed, we just want to be able to swap states, in which way is open.

> >  2) We want a fixed function vertex and fragment pipeline replacement
> > with ARB and GLSL
>
> Only GLSL is a requirement for me. ARB could be nice, but is probably
> redundant.
Intel cards? Also GLSL has the problem with the link times.

> >  5) A nice to have is to be able to use the replacement pipelines
> > together with shaders, but that is not a hard requirement for me. We need
> > an ARB and GLSL replacement anyway.
>
> I assume you mean atifs & nvrc specifically here, in which case this
> is probably a bit more important than "nice to have". The most tricky
> situation to support here will be cards that support vertex shaders,
> but not fragment shaders. If we want to support pixel shaders using
> atifs / nvrc we have to allow mixing GLSL / ARB with nvrc / atifs for
> it to be of any use.
The current implementation allows that, we're using ATIFS+ARBVP

>  Aside
> from being clearer this allows you to swap these parts out
> independently from each other and possibly skip applying them as a
> whole in case a shader is active for that part of the pipeline (I
> imagine this could have some performance advantages as well, although
> I'm not sure how much).
For the performance, it depends on the app. If we skip applying (redundant) 
fixed function settings when a shader is used, we have to reapply all of them 
the shader use might have changed when the shader is deactivated. It's a 
decision between making shader on-off switches cheap vs filtering out 
redundant state changes done by the app. Currently there is no additional 
fixed function pipeline cost involved when using shaders as long as the app 
doesn't touch the ffp states.

> struct IWineD3DDeviceImpl {
>     ...
>     struct state_management_t vertex_state_manager;
>     struct state_management_t fragment_state_manager;
>     struct state_management_t other_state_manager;
>     struct shader_backend_t shader_backend;
>
>     void *vertex_private_data;
>     void *fragment_private_data;
>     void *other_private_data;
>     void *shader_private_data;
>     ...
> };
One of the reasons for using a single state table was that we have 
interconnections between the vertex states, fragment states and other states. 
For example, where would you put the vertex buffer loading? Is that 
an "other" state, or a vertex state? The FVF and the vertex shader influence 
if we're entering the FF or shader vertex processing codepaths. The FVF 
affects fogging, which is a vertex state in some shader implementations(nvts, 
atifs), but implemented in pixel shaders in GLSL and ARB. The texture 
transform flags are a fixed function vertex state on paper, but we have to 
compile the D3DTTFF_PROJECTED flag into the fragment shader. (we already do 
so, that's documented on the msdn, so clearly a missdesign on Microsoft's 
side). There are many more examples of vertex-fragment-other state 
interconnections.

> This doesn't support mixing eg. ARB vertex shaders with NVRC pixel
> shaders, but it would "simply" be a matter of splitting up the shader
> backend in a similar way to the state table. Important to note here is
> that the private data could be shared between fixed function
> replacements and the shader backend, like in the case of GLSL. I could
> imagine using a structure more similar to state_management_t for the
> shader backend as well.
The unsplit shader backend is the current d3d shader implementation + Ivan's 
pipeline linker object. If you split them up, where do you set GLSL shader 
constants?

Also note that the GLSL pixel shaders depend on the type of vertex 
processing(non-GLSL or GLSL) to load the 3.0 varyings correctly. We could get 
rid of that by requiring GLSL vp, but that would break requirement 4, using 
the GL fixed function pipeline.

My concern is that if you split vertex processing and fragment processing up, 
you need a linker object that deals with linking. This linker object has know 
about the vertex and fragment processing state handlers and tables, thus 
creating a special linker for each vs-ps-vff-ffp-other combination. I don't 
have any objections against that in principle, but I am afraid that due to 
the high interconnection between vertex, fragment and other states we would 
end up with implementing most things in the linker.


From bmschwar at fas.harvard.edu  Fri Apr 11 17:59:29 2008
From: bmschwar at fas.harvard.edu (Benjamin M. Schwartz)
Date: Fri, 11 Apr 2008 18:59:29 -0400
Subject: Wine on OLPC
Message-ID: <47FFED51.30608@fas.harvard.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Dear Wine developers,
I am attempting to package Wine for OLPC.  My goal is to enable packaging
individual windows programs into OLPC "Activity bundles" with wine.  I
have encountered a handful of problems along the way.  One of them is bug
#12507, for which I have sent a patch.  A few others are:

1. Decorations on the Desktop window.
I am running in Desktop mode, because this provides the best integration
with the OLPC operating system.  However, the desktop window has
decorations on it, which I do not want.  I want the desktop to be a
fullscreen window.  It seems that recent patches to x11drv may make this
possible, but I could find no way in 0.9.59.

What should I do to run the Desktop as a full-screen window, or as a
normal window without decorations?

2. Non-ownership of .wine/
The OLPC security system is designed to run each program under a different
unix uid, as a form of lightweight sandboxing.  My system is set up to
create a .wine/ directory the first time the program is run.  The second
time the application is run, it doesn't work because the .wine directory
is owned b a different user, so I get "path/.wine is not owned by you".  I
have tried doing "chmod a+rwx" to .wine/ on the first run, but Wine still
refuses to run, even though it has full access, because it's not the owner.

Would you consider patches to exchange the uid check for a rwx access check?

Thank you,
Ben
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.7 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFH/+1RUJT6e6HFtqQRAs0RAJ9o1HzIsoCMLUPCC1GJKnOJikIBtACgiLBH
uy8KO8KlGm4/ZD+7jXcQrrg=
=mi64
-----END PGP SIGNATURE-----


From truiken at gmail.com  Fri Apr 11 18:07:23 2008
From: truiken at gmail.com (James Hawkins)
Date: Fri, 11 Apr 2008 18:07:23 -0500
Subject: Wine on OLPC
In-Reply-To: <47FFED51.30608@fas.harvard.edu>
References: <47FFED51.30608@fas.harvard.edu>
Message-ID: <22821af30804111607g283f398cg914e4461ba06c70d@mail.gmail.com>

On Fri, Apr 11, 2008 at 5:59 PM, Benjamin M. Schwartz
<bmschwar at fas.harvard.edu> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
>  Hash: SHA1
>
>  Dear Wine developers,
>  I am attempting to package Wine for OLPC.  My goal is to enable packaging
>  individual windows programs into OLPC "Activity bundles" with wine.  I
>  have encountered a handful of problems along the way.  One of them is bug
>  #12507, for which I have sent a patch.  A few others are:
>
>  1. Decorations on the Desktop window.
>  I am running in Desktop mode, because this provides the best integration
>  with the OLPC operating system.  However, the desktop window has
>  decorations on it, which I do not want.  I want the desktop to be a
>  fullscreen window.  It seems that recent patches to x11drv may make this
>  possible, but I could find no way in 0.9.59.
>
>  What should I do to run the Desktop as a full-screen window, or as a
>  normal window without decorations?
>
>  2. Non-ownership of .wine/
>  The OLPC security system is designed to run each program under a different
>  unix uid, as a form of lightweight sandboxing.  My system is set up to
>  create a .wine/ directory the first time the program is run.  The second
>  time the application is run, it doesn't work because the .wine directory
>  is owned b a different user, so I get "path/.wine is not owned by you".  I
>  have tried doing "chmod a+rwx" to .wine/ on the first run, but Wine still
>  refuses to run, even though it has full access, because it's not the owner.
>
>  Would you consider patches to exchange the uid check for a rwx access check?
>

No, that check was added to keep users from running Wine as root.

-- 
James Hawkins


From bmschwar at fas.harvard.edu  Fri Apr 11 18:11:33 2008
From: bmschwar at fas.harvard.edu (Benjamin M. Schwartz)
Date: Fri, 11 Apr 2008 19:11:33 -0400
Subject: Wine on OLPC
In-Reply-To: <22821af30804111607g283f398cg914e4461ba06c70d@mail.gmail.com>
References: <47FFED51.30608@fas.harvard.edu>
	<22821af30804111607g283f398cg914e4461ba06c70d@mail.gmail.com>
Message-ID: <47FFF025.1070405@fas.harvard.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

James Hawkins wrote:
| On Fri, Apr 11, 2008 at 5:59 PM, Benjamin M. Schwartz
|>  Would you consider patches to exchange the uid check for a rwx access
check?
| No, that check was added to keep users from running Wine as root.

Then why not prevent users from running Wine as root?  This does not
prevent that.

- --Ben

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.7 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFH//AlUJT6e6HFtqQRAnGPAKCAwosTbtenZNqiufqhirJ55D6s2wCghD2P
wQSesLf3GT8XO6M/s+Qb/+k=
=9RI/
-----END PGP SIGNATURE-----


From thestig at google.com  Fri Apr 11 18:13:06 2008
From: thestig at google.com (Lei Zhang)
Date: Fri, 11 Apr 2008 16:13:06 -0700
Subject: New Valgrind errors in user32
In-Reply-To: <a71bd89a0804101800k6b1a306ay45b285875de07fd4@mail.gmail.com>
References: <a71bd89a0804101800k6b1a306ay45b285875de07fd4@mail.gmail.com>
Message-ID: <558b2f5c0804111613j4cfb9e3aic72658463b78feee@mail.gmail.com>

On Thu, Apr 10, 2008 at 6:00 PM, Dan Kegel <dank at kegel.com> wrote:
> Hey Lei,
>  this morning's git brought one new valgrind error, and it happens to
>  be in a file you touched in the last day or so:
>  + Conditional jump or move depends on uninitialised value(s)
>  +    at  EDIT_BuildLineDefs_ML (edit.c:1280)
>  +    by  EDIT_EM_ReplaceSel (edit.c:3260)
>  +    by  EDIT_WM_Char (edit.c:4035)
>  +    by  EditWndProc_common (edit.c:859)
>  +    by  EditWndProcA (edit.c:1103)
>  +    by  (within /home/dank/wine-git/dlls/user32/user32.dll.so)
>  +    by  call_window_proc (winproc.c:457)
>  +    by  WINPROC_call_window (winproc.c:2207)
>  +    by  call_window_proc (message.c:1616)
>  +    by  send_message (message.c:2438)
>  +    by  SendMessageA (message.c:2583)
>  +    by  test_enter (edit.c:1654)
>  +    by  func_edit (edit.c:1977)
>  +    by  run_test (test.h:406)
>  +    by  main (test.h:455)
>
>  Could you have a look?
>
>  See
>  http://kegel.com/wine/valgrind/logs-2008-04-10/vg-user32_edit-diff.txt
>  http://kegel.com/wine/valgrind/logs-2008-04-10/vg-user32_edit.txt
>
>  Thanks,
>  Dan
>

Sure, I can take a look. I think it occurred mainly because our tests
exercise more of the code base now.


From stefandoesinger at gmx.at  Fri Apr 11 18:18:56 2008
From: stefandoesinger at gmx.at (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sat, 12 Apr 2008 01:18:56 +0200
Subject: Better sound support
In-Reply-To: <47FFCDB0.5050209@gmail.com>
References: <47FFA9B9.1010703@gmail.com> <47FFCDB0.5050209@gmail.com>
Message-ID: <200804120118.57042.stefandoesinger@gmx.at>

Am Freitag, 11. April 2008 22:44:32 schrieb Stephen Eilert:
> Kacper Pluta wrote:
> > Hey, do you plan on enabling handling of 24bit sound and sampling
> > frequencies 96000 or 192000? Lots of musicians using Linux need to use
> > VST and VSTi plugins (through FST and other methods). Unfortunately
> > quality of music you can acquire isn't realy high if you wish to use it
> > professionally. I'd also suggest correcting MIDI handling and
> > integrating wine with wineasio, which would enable using VST and VSTi on
> > a quite high level, as well as use other programmes.
>
> I'd suggest creating a bug report in bugs.winehq.org, detailing the
> broken applications and/or plugins while you wait for a developer answer.
My alternative suggestion is to look at that himself ;-) . Posting wishlists 
usually doesn't help with open source projects, but filing *good* bug reports 
or personally working on the issue or funding someone to work on it does.


From luis.busquets at ilidium.com  Fri Apr 11 18:20:38 2008
From: luis.busquets at ilidium.com (Luis Busquets)
Date: Sat, 12 Apr 2008 01:20:38 +0200
Subject: Several patches for D3DX
Message-ID: <47FFF246.4090003@ilidium.com>

Is there still any problem with each of the attached patches or are they 
going to be committed?
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 3f4ea1b791c5792f4225493d7e3ff2d8c25f385d.diff
Type: text/x-patch
Size: 2591 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080412/505d157d/attachment-0003.bin 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 25ffebe8877fd886c61ce3ebc8534255f0627bc4.diff
Type: text/x-patch
Size: 6951 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080412/505d157d/attachment-0004.bin 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: f715cf4f1241acf214d1098ca295833c9af4276e.diff
Type: text/x-patch
Size: 6200 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080412/505d157d/attachment-0005.bin 

From truiken at gmail.com  Fri Apr 11 18:22:02 2008
From: truiken at gmail.com (James Hawkins)
Date: Fri, 11 Apr 2008 18:22:02 -0500
Subject: Wine on OLPC
In-Reply-To: <47FFF025.1070405@fas.harvard.edu>
References: <47FFED51.30608@fas.harvard.edu>
	<22821af30804111607g283f398cg914e4461ba06c70d@mail.gmail.com>
	<47FFF025.1070405@fas.harvard.edu>
Message-ID: <22821af30804111622o5313a0adu74f68daa564597a8@mail.gmail.com>

On Fri, Apr 11, 2008 at 6:11 PM, Benjamin M. Schwartz
<bmschwar at fas.harvard.edu> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
>  Hash: SHA1
>
>  James Hawkins wrote:
>  | On Fri, Apr 11, 2008 at 5:59 PM, Benjamin M. Schwartz
>  |>  Would you consider patches to exchange the uid check for a rwx access
>  check?
>  | No, that check was added to keep users from running Wine as root.
>
>  Then why not prevent users from running Wine as root?  This does not
>  prevent that.
>

It prevents this case:

$ sudo wine app.exe

and we've already decided that we're not going to outright prevent
users from running wine as root.  There are certain circumstances
where it's required.

-- 
James Hawkins


From truiken at gmail.com  Fri Apr 11 18:27:53 2008
From: truiken at gmail.com (James Hawkins)
Date: Fri, 11 Apr 2008 18:27:53 -0500
Subject: Several patches for D3DX
In-Reply-To: <47FFF246.4090003@ilidium.com>
References: <47FFF246.4090003@ilidium.com>
Message-ID: <22821af30804111627ha04dbdfqac2c115e9f473c01@mail.gmail.com>

On Fri, Apr 11, 2008 at 6:20 PM, Luis Busquets
<luis.busquets at ilidium.com> wrote:
> Is there still any problem with each of the attached patches or are they
> going to be committed?
>

+WINAPI DWORD D3DXGetShaderVersion(CONST DWORD *pFunction)
+{
+    DWORD ver;
+    if (!pFunction)
+     {
+      return 0;
+      }
+    /* The first DWORD of the stream is the version Token */
+   ver=*pFunction;
+   return ver;
+}

I can't attest to any of the rest, but the style in this function is
horrendous.  Your spacing is all over the place.  Also, correctness of
this function aside, the function can be written so much simpler as:

WINAPI DWORD D3DXGetShaderVersion(CONST DWORD *pFunction)
{
    return (pFunction) ? *pFunction : 0;
}

-- 
James Hawkins


From stefan at codeweavers.com  Fri Apr 11 18:41:06 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sat, 12 Apr 2008 01:41:06 +0200
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <200804111141.58596.chris.kcat@gmail.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804111735.21536.stefan@codeweavers.com>
	<200804111141.58596.chris.kcat@gmail.com>
Message-ID: <200804120141.06956.stefan@codeweavers.com>

Am Freitag, 11. April 2008 20:41:57 schrieb Chris Robinson:
> As far as I can see, OSX's broken drivers are the only reason you'd not
> want to use GLSL when nothing else of better capability is available. For
> that case, there's two options: for nVidia users, extend ARB shaders with
> nv programs and use them (likely suprassing GLSL performance), and for
> other cards, bug Apple for proper drivers. IMHO, I don't think WineD3D
> should be that hindered and cause WineD3D issues with other vendors because
> Apple insists on making drivers themselves, and doing a poor job at it.
I don't know who exactly writes the Apple drivers, but the Mac drivers have a 
few identical issues as the Linux ATI driver.

We have to face that driver bugs are reality. I think we are having more 
issues in form of user complaints due to the driver<->wined3d connection than 
the wined3d<->application one. I doubt Apple is going to fix their vertex 
shader bugs anytime soon. They come up weekly or monthly on their development 
lists, no official statement yet.

> Why would it be cool to use ATIFS on newer cards? It'd be cool if we had
> something lean, sleek, and working. Mixing output shader modes is just
> asking for problems, IMO.
For one part it is helpful for testing, and it is a temporary solution until 
we have an ARB and GLSL pipeline replacement(post 1.0 most likely)

> As it is, I imagine WineD3D will need to be reworked for D3D10 no matter
> what we do here. Unless someone has a working design plan for what changes
> are needed by D3D10 for WineD3D, we're ultimately just guessing about what
> may work best (not to mention it'll be using GL3 instead of the current
> stuff, so whatever's picked may not even be efficient API-wise for it).
I have a rough design plan

-> Replace the current d3d9 shader language with an intermediate language 
generated by the shader compiler and assembler library I am working on(see 
the other thread). d3d9 will feed a d3d9 shader into that lib and get a 
parsed shader back that it passes to wined3d, d3d10 works similarly.

-> Extending pixel shader and vertex shader support to 4.0 is fairly easy with 
whatever design we choose. Just extend the existing code.

-> Adding geometry shaders should work with the one-in-all shader backend. Add 
geometry shaders next to pixel and vertex and link all 3 together. I don't 
know the details with Henri's suggestion, but I think we'd just add an extra 
geometry state handler and extend the shader backend(or add a new shader 
backend if we split things up)

-> OpenGL 3.0 needs the finalized GL 3 spec. If GLSL is unmodified(I think 
so), we can just reuse the existing GLSL shader backend. Otherwise we have to 
create a new one, and depending on how similar they are maintain it as a 
separate backend or overwrite a few parts via inheritance.

-> The non-shader parts of GL3 need a separation of the management code and GL 
specific code. For the state setters, we either need an entirely different 
set of state setters, or we can reuse a fully-GLSLed pipeline implementation. 
For textures, surfaces, buffers, devices we can move the management code into 
a base class and inherit a GL2 and GL3 class, similarly to 
BaseSurface-D3DSurface-GDISurface

-> A major API rewrite in D3D10 is the new resource model. Basically we have 
to make IndexBuffers, VertexBuffers and Surfaces general "Buffers". IB and VB 
can be just replaced by the buffer d3d <= 9 wise, for surfaces we have to 
create a derived class where we add D3D <= 9 surface specific methods like 
Blt, the Container texture, Palettes, etc. Textures should be replaced with 
the more flexible ShaderResourceView objects. (I don't know if one buffer can 
be used in more than one resource view object. If yes than that might be an 
issue, as it means that a surface can be part of many textures e.g. as a mip 
level)

-> Vertex declarations? They are some shader resource view as well now, I have 
to look at them more in detail. Maybe we can just reuse them unmodified.

-> Pixel formats: We need tests to find out what the d3d10 formats need, but 
basically replace the WINED3DFORMAT enum with a d3d10-like one and add 
private values for d3d <= 9 formats missing in d3d10 like P8, X4R4G4B4. The 
DXGI_FORMATs are nicer than the D3D9 ones IMO.

-> One open issue: Where do we implement srgb reading switching? In WineD3D or 
D3D9?

There will surely be more open issues, this is just a rough plan.


From wine-devel at kievinfo.com  Fri Apr 11 18:53:51 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Fri, 11 Apr 2008 17:53:51 -0600
Subject: Please add wine-0.9.59 to bugzilla
In-Reply-To: <47FE6FF1.30002@kievinfo.com>
References: <47FE6FF1.30002@kievinfo.com>
Message-ID: <47FFFA0F.70604@kievinfo.com>

Vitaliy Margolen wrote:
> Could someone add the newest Wine version to buzilla?
> 
> Vitaliy.
> 
> 
Any one alive from bugzilla admins?

Vitaliy.


From bmschwar at fas.harvard.edu  Fri Apr 11 19:45:20 2008
From: bmschwar at fas.harvard.edu (Benjamin M. Schwartz)
Date: Fri, 11 Apr 2008 20:45:20 -0400
Subject: Wine on OLPC
In-Reply-To: <22821af30804111622o5313a0adu74f68daa564597a8@mail.gmail.com>
References: <47FFED51.30608@fas.harvard.edu>	<22821af30804111607g283f398cg914e4461ba06c70d@mail.gmail.com>	<47FFF025.1070405@fas.harvard.edu>
	<22821af30804111622o5313a0adu74f68daa564597a8@mail.gmail.com>
Message-ID: <48000620.6020902@fas.harvard.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

James Hawkins wrote:
| On Fri, Apr 11, 2008 at 6:11 PM, Benjamin M. Schwartz
| <bmschwar at fas.harvard.edu> wrote:
|> -----BEGIN PGP SIGNED MESSAGE-----
|>  Hash: SHA1
|>
|>  James Hawkins wrote:
|>  | On Fri, Apr 11, 2008 at 5:59 PM, Benjamin M. Schwartz
|>  |>  Would you consider patches to exchange the uid check for a rwx access
|>  check?
|>  | No, that check was added to keep users from running Wine as root.
|>
|>  Then why not prevent users from running Wine as root?  This does not
|>  prevent that.
|>
|
| It prevents this case:
|
| $ sudo wine app.exe
|
| and we've already decided that we're not going to outright prevent
| users from running wine as root.  There are certain circumstances
| where it's required.

Then how about a patch that specifically prevents users from running wine
as root over a profile that is not owned by root? I am trying to run wine
as a non-root user over a profile owned by another non-root user that has
been chmod'ed appropriately.

- --Ben

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.7 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFIAAYgUJT6e6HFtqQRAq+UAJ9tyF1GeAKaM10mRLfU0EOJI/nySwCfZi9Y
1zqdhyT1XzY+nfmCUkHLYqo=
=6bQm
-----END PGP SIGNATURE-----


From truiken at gmail.com  Fri Apr 11 19:53:46 2008
From: truiken at gmail.com (James Hawkins)
Date: Fri, 11 Apr 2008 19:53:46 -0500
Subject: Wine on OLPC
In-Reply-To: <48000620.6020902@fas.harvard.edu>
References: <47FFED51.30608@fas.harvard.edu>
	<22821af30804111607g283f398cg914e4461ba06c70d@mail.gmail.com>
	<47FFF025.1070405@fas.harvard.edu>
	<22821af30804111622o5313a0adu74f68daa564597a8@mail.gmail.com>
	<48000620.6020902@fas.harvard.edu>
Message-ID: <22821af30804111753h40f9219fq783d57847534f9d3@mail.gmail.com>

On Fri, Apr 11, 2008 at 7:45 PM, Benjamin M. Schwartz
<bmschwar at fas.harvard.edu> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
>  Hash: SHA1
>
>  James Hawkins wrote:
>  | On Fri, Apr 11, 2008 at 6:11 PM, Benjamin M. Schwartz
>  | <bmschwar at fas.harvard.edu> wrote:
>  |> -----BEGIN PGP SIGNED MESSAGE-----
>  |>  Hash: SHA1
>  |>
>  |>  James Hawkins wrote:
>  |>  | On Fri, Apr 11, 2008 at 5:59 PM, Benjamin M. Schwartz
>  |>  |>  Would you consider patches to exchange the uid check for a rwx
> access
>  |>  check?
>  |>  | No, that check was added to keep users from running Wine as root.
>  |>
>  |>  Then why not prevent users from running Wine as root?  This does not
>  |>  prevent that.
>  |>
>  |
>  | It prevents this case:
>  |
>  | $ sudo wine app.exe
>  |
>  | and we've already decided that we're not going to outright prevent
>  | users from running wine as root.  There are certain circumstances
>  | where it's required.
>
>  Then how about a patch that specifically prevents users from running wine
>  as root over a profile that is not owned by root? I am trying to run wine
>  as a non-root user over a profile owned by another non-root user that has
>  been chmod'ed appropriately.
>

Running as root was just a specific example.  The second case isn't
allowed either.

-- 
James Hawkins


From thestig at google.com  Fri Apr 11 20:21:40 2008
From: thestig at google.com (Lei Zhang)
Date: Fri, 11 Apr 2008 18:21:40 -0700
Subject: Please add wine-0.9.59 to bugzilla
In-Reply-To: <47FFFA0F.70604@kievinfo.com>
References: <47FE6FF1.30002@kievinfo.com> <47FFFA0F.70604@kievinfo.com>
Message-ID: <558b2f5c0804111821k1443f1d9t4eaed825440d5f6a@mail.gmail.com>

On Fri, Apr 11, 2008 at 4:53 PM, Vitaliy Margolen
<wine-devel at kievinfo.com> wrote:
> Vitaliy Margolen wrote:
>  > Could someone add the newest Wine version to buzilla?
>  >
>  > Vitaliy.
>  >
>  >
>  Any one alive from bugzilla admins?
>
>  Vitaliy.
>
>
>

Maybe Dan K. can do this. I'll bug him tomorrow at Lug Radio Live.


From hverbeet at gmail.com  Fri Apr 11 21:27:07 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Sat, 12 Apr 2008 04:27:07 +0200
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <200804120057.57495.stefan@codeweavers.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804111618.49900.stefan@codeweavers.com>
	<d658b69e0804111342t214f49b1t5faea9081e8b70b8@mail.gmail.com>
	<200804120057.57495.stefan@codeweavers.com>
Message-ID: <d658b69e0804111927p2e3d7e36q98bba32d724f5a4f@mail.gmail.com>

On 12/04/2008, Stefan D?singer <stefan at codeweavers.com> wrote:
>  > >  2) We want a fixed function vertex and fragment pipeline replacement
>  > > with ARB and GLSL
>  >
>  > Only GLSL is a requirement for me. ARB could be nice, but is probably
>  > redundant.
>
> Intel cards? Also GLSL has the problem with the link times.
>
I'm currently not too bothered about Intel cards, although that might
change in the future. Either way, it's certainly possible to create an
ARB implementation, it's more a matter of priority.

>  >  Aside
>  > from being clearer this allows you to swap these parts out
>  > independently from each other and possibly skip applying them as a
>  > whole in case a shader is active for that part of the pipeline (I
>  > imagine this could have some performance advantages as well, although
>  > I'm not sure how much).
>
> For the performance, it depends on the app. If we skip applying (redundant)
>  fixed function settings when a shader is used, we have to reapply all of them
>  the shader use might have changed when the shader is deactivated. It's a
>  decision between making shader on-off switches cheap vs filtering out
>  redundant state changes done by the app. Currently there is no additional
>  fixed function pipeline cost involved when using shaders as long as the app
>  doesn't touch the ffp states.
>
I'm not sure I follow your reasoning here. Just to be clear, I'm only
talking about applying states, not marking them dirty. In the worst
case it simply means you apply them when switching back to fixed
function instead of in the current draw call, but you could
potentially save some redundant state applications while the shader is
active. However, what I was actually wondering about is if it might be
more expensive on some drivers to do fixed function state changes
while a shader is active.

> One of the reasons for using a single state table was that we have
>  interconnections between the vertex states, fragment states and other states.
>  For example, where would you put the vertex buffer loading? Is that
>  an "other" state, or a vertex state? The FVF and the vertex shader influence
>  if we're entering the FF or shader vertex processing codepaths. The FVF
>  affects fogging, which is a vertex state in some shader implementations(nvts,
>  atifs), but implemented in pixel shaders in GLSL and ARB. The texture
>  transform flags are a fixed function vertex state on paper, but we have to
>  compile the D3DTTFF_PROJECTED flag into the fragment shader. (we already do
>  so, that's documented on the msdn, so clearly a missdesign on Microsoft's
>  side). There are many more examples of vertex-fragment-other state
>  interconnections.
>
Anything that gets ignored when a vertex shader is active gets put in
the vertex states, anything that gets ignored when a fragment shader
is active should be part of the fragment states. Resource loading
would be part of the "other" states. Most of the connections you
mention appear to be connections on the D3D side, these would have no
consequences for a separation on the GL side of things. Iow, it's
perfectly valid for a state in the vertex block and a state in the
fragment block to read from the same D3D state.

>  > This doesn't support mixing eg. ARB vertex shaders with NVRC pixel
>  > shaders, but it would "simply" be a matter of splitting up the shader
>  > backend in a similar way to the state table. Important to note here is
>  > that the private data could be shared between fixed function
>  > replacements and the shader backend, like in the case of GLSL. I could
>  > imagine using a structure more similar to state_management_t for the
>  > shader backend as well.
>
> The unsplit shader backend is the current d3d shader implementation + Ivan's
>  pipeline linker object. If you split them up, where do you set GLSL shader
>  constants?
>
In the shader backend. Splitting things up doesn't change much there.
You could decide to not even expose constant loading though, and
instead just mark the state dirty on the shader backend. Deciding when
to load constants then becomes the responsibility of the shader
backend.

>  Also note that the GLSL pixel shaders depend on the type of vertex
>  processing(non-GLSL or GLSL) to load the 3.0 varyings correctly. We could get
>  rid of that by requiring GLSL vp, but that would break requirement 4, using
>  the GL fixed function pipeline.
>

From hverbeet at gmail.com  Fri Apr 11 22:07:49 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Sat, 12 Apr 2008 05:07:49 +0200
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <200804120141.06956.stefan@codeweavers.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804111735.21536.stefan@codeweavers.com>
	<200804111141.58596.chris.kcat@gmail.com>
	<200804120141.06956.stefan@codeweavers.com>
Message-ID: <d658b69e0804112007q21370d34hb543fd2af65a674b@mail.gmail.com>

On 12/04/2008, Stefan D?singer <stefan at codeweavers.com> wrote:
>  We have to face that driver bugs are reality. I think we are having more
>  issues in form of user complaints due to the driver<->wined3d connection than
>  the wined3d<->application one. I doubt Apple is going to fix their vertex
>  shader bugs anytime soon. They come up weekly or monthly on their development
>  lists, no official statement yet.
>
This is probably more of a concern to CW than Wine in general, but I
guess it's a somewhat valid issue. The issue then becomes more one of
how much ugliness we're willing to accept in the Wine tree in order to
work around obviously broken drivers.

>  > As it is, I imagine WineD3D will need to be reworked for D3D10 no matter
>  > what we do here. Unless someone has a working design plan for what changes
>  > are needed by D3D10 for WineD3D, we're ultimately just guessing about what
>  > may work best (not to mention it'll be using GL3 instead of the current
>  > stuff, so whatever's picked may not even be efficient API-wise for it).
>
> I have a rough design plan
>
>  -> Replace the current d3d9 shader language with an intermediate language
>  generated by the shader compiler and assembler library I am working on(see
>  the other thread). d3d9 will feed a d3d9 shader into that lib and get a
>  parsed shader back that it passes to wined3d, d3d10 works similarly.
>
I thought we decided on IRC that it would make more sense to call the
shader library from wined3d rather than d3d8, d3d9 and d3d10.

>  -> Adding geometry shaders should work with the one-in-all shader backend. Add
>  geometry shaders next to pixel and vertex and link all 3 together. I don't
>  know the details with Henri's suggestion, but I think we'd just add an extra
>  geometry state handler and extend the shader backend(or add a new shader
>  backend if we split things up)
>
A geometry state handler would only make sense if you would want to
add a "fixed function geometry processing replacement". Just
supporting the shaders only requires adding them to the shader backend
(split up or not).

>  -> OpenGL 3.0 needs the finalized GL 3 spec. If GLSL is unmodified(I think
>  so), we can just reuse the existing GLSL shader backend. Otherwise we have to
>  create a new one, and depending on how similar they are maintain it as a
>  separate backend or overwrite a few parts via inheritance.
>
AFAIK GLSL will be mostly unchanged, although supposedly it will also
allow things like bindable uniforms and binding separate programs for
vertex/fragment/geometry stages. This would allow us to get rid of our
main use of GLSL linking.

>  -> The non-shader parts of GL3 need a separation of the management code and GL
>  specific code. For the state setters, we either need an entirely different
>  set of state setters, or we can reuse a fully-GLSLed pipeline implementation.
>  For textures, surfaces, buffers, devices we can move the management code into
>  a base class and inherit a GL2 and GL3 class, similarly to
>  BaseSurface-D3DSurface-GDISurface
>
I think going the GLSL way makes sense there. Anything supporting GL3
should fully support GLSL already, and I'm not even sure GL3 will
support a traditional fixed function pipeline.


From ead1234 at hotmail.com  Fri Apr 11 22:27:03 2008
From: ead1234 at hotmail.com (EA Durbin)
Date: Fri, 11 Apr 2008 22:27:03 -0500
Subject: [Wine] Uninstallation of Programs
In-Reply-To: <b6bb06270804111116k29aaaa07j836394f915098d30@mail.gmail.com>
References: <1207933293.m2f.3286@forum.winehq.org>
	<b6bb06270804111009x43dff92bh472e2f1b9d6c8130@mail.gmail.com>
	<b050a5e70804111041k48e3d7bepeb55b83bdcd4b488@mail.gmail.com>
	<b6bb06270804111106g585d3961m81bbfc76879fe60a@mail.gmail.com>
	<3a768c550804111108r695b8673h19d13a4c840f2229@mail.gmail.com>
	<b050a5e70804111111q5fa7443an55ed6cf11ea0c4b4@mail.gmail.com>
	<3a768c550804111112w6aeee430h560765c07ab05b33@mail.gmail.com> 
	<b6bb06270804111116k29aaaa07j836394f915098d30@mail.gmail.com>
Message-ID: <BAY101-W51671DEB2A74DC1490BD05ABEE0@phx.gbl>



> On Fri, Apr 11, 2008 at 1:12 PM, Juan Lang  wrote:
>>>  I agree that its certainly not necessary functionality wise, but to
>> >  what extend are we going for polish and shine for 1.0 as a whole
>> >  package, including bundled apps?  I feel like 1.0 is as good a time as
>> >  ever to try and make some of these things work.


 It would at least be nice to have an easy to way to get rid of some of the clutter under the wine gnome menu from installed applications when 1.0 comes out.

_________________________________________________________________
Going green? See the top 12 foods to eat organic.
http://green.msn.com/galleries/photos/photos.aspx?gid=164&ocid=T003MSN51N1653A

From m.b.lankhorst at gmail.com  Fri Apr 11 22:48:58 2008
From: m.b.lankhorst at gmail.com (Maarten Lankhorst)
Date: Fri, 11 Apr 2008 20:48:58 -0700
Subject: Better sound support
In-Reply-To: <47FF9AEC.6060700@gmail.com>
References: <47FF9AEC.6060700@gmail.com>
Message-ID: <b130c85e0804112048h1d856acamcb95c9556d79b013@mail.gmail.com>

Hello,

2008/4/11, Kacper Pluta <kacper.pluta at gmail.com>:
> Hey, do you plan on enabling handling of 24bit sound and sampling
>  frequencies 96000 or 192000? Lots of musicians using Linux need to use
>  VST and VSTi plugins (through FST and other methods). Unfortunately
>  quality of music you can acquire isn't realy high if you wish to use it
>  professionally. I'd also suggest correcting MIDI handling and
>  integrating wine with wineasio, which would enable using VST and VSTi on
>  a quite high level, as well as use other programmes.

As far as I can tell, 96k and 192k works in wine without problem, 24
bits doesn't entirely work, as I didn't implement volume changing. If
you do that it can be enabled in winecfg. Just tweak the registry to
set sound to 24 bits and fix the volume error that pops up, it
shouldn't be that hard. Bonus if you can do it for 32 bits as well.

More work would be implementing >2 speakers in directsound, that
doesn't work yet and since I don't have such a speaker setup I can't
test it. Direct routing to the jack api might work, but I never tried
jack.

Cheers,
Maarten.


From bmschwar at fas.harvard.edu  Fri Apr 11 23:54:44 2008
From: bmschwar at fas.harvard.edu (Benjamin M. Schwartz)
Date: Sat, 12 Apr 2008 00:54:44 -0400
Subject: Wine on OLPC
In-Reply-To: <22821af30804111753h40f9219fq783d57847534f9d3@mail.gmail.com>
References: <47FFED51.30608@fas.harvard.edu>	<22821af30804111607g283f398cg914e4461ba06c70d@mail.gmail.com>	<47FFF025.1070405@fas.harvard.edu>	<22821af30804111622o5313a0adu74f68daa564597a8@mail.gmail.com>	<48000620.6020902@fas.harvard.edu>
	<22821af30804111753h40f9219fq783d57847534f9d3@mail.gmail.com>
Message-ID: <48004094.6010602@fas.harvard.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

James Hawkins wrote:
| On Fri, Apr 11, 2008 at 7:45 PM, Benjamin M. Schwartz
|>  Then how about a patch that specifically prevents users from running wine
|>  as root over a profile that is not owned by root? I am trying to run wine
|>  as a non-root user over a profile owned by another non-root user that has
|>  been chmod'ed appropriately.
|>
|
| Running as root was just a specific example.  The second case isn't
| allowed either.
|
I appear to have hit a nerve here; "isn't allowed" is surprisingly strong
language for an open source software project.

I'm particularly surprised because I cannot imagine any reasonable
scenario in which allowing non-root users to run in .wine/ directories
that they do not own is a security risk.  There is no privilege escalation
here; the non-root user is still required by the kernel to operate within
the bounds of posix permissions.

I need the ability to run in profiles as a user who is not the "owner" of
the files on disk.  I am doing this quite specifically because, in my
case, this greatly _increases_ the security of the system.  In fact, it
allows complete sandboxing of each Wine instance, isolating it from the
rest of the system by kernel-level mechanisms.

I would prefer not to maintain a patched fork of Wine just to get this
trivial feature.  That doesn't benefit anyone.  I'm sure we can find a way
to provide this ability without compromising the security of users in the
general case.

- --Ben
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.7 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFIAECTUJT6e6HFtqQRAhwNAJ0eFd/fPB6BcNh5jTt+qU4xqhzaAQCfU2DJ
sYTFIFQaXVn0jyWkJGsi9Fo=
=lF7k
-----END PGP SIGNATURE-----


From research at science.su  Sat Apr 12 00:34:02 2008
From: research at science.su (L. Rahyen)
Date: Sat, 12 Apr 2008 05:34:02 +0000
Subject: Wine on OLPC
In-Reply-To: <48004094.6010602@fas.harvard.edu>
References: <47FFED51.30608@fas.harvard.edu>
	<22821af30804111753h40f9219fq783d57847534f9d3@mail.gmail.com>
	<48004094.6010602@fas.harvard.edu>
Message-ID: <200804120534.02815.research@science.su>

On Saturday April 12 2008 04:54:44 Benjamin M. Schwartz wrote:
> I need the ability to run in profiles as a user who is not the "owner" of
> the files on disk.
> ...
> I would prefer not to maintain a patched fork of Wine just to get this
> trivial feature.  That doesn't benefit anyone.  I'm sure we can find a way
> to provide this ability without compromising the security of users in the
> general case.

	Well, you probably want to see http://bugs.winehq.org/show_bug.cgi?id=11112 - 
there you find a discussion about this issue.
	Personally, I use attached hack for now until above bug will be FIXED.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: remove-owner-check.diff
Type: text/x-diff
Size: 549 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080412/e68fa24d/attachment.diff 

From smoki00790 at gmail.com  Sat Apr 12 02:02:02 2008
From: smoki00790 at gmail.com (=?ISO-8859-2?Q?Milan_Kosti=E6?=)
Date: Sat, 12 Apr 2008 09:02:02 +0200
Subject: GL_ATI_fragment_shader and GL_INVALID 0x501, 0x502
In-Reply-To: <200804111450.40053.stefan@codeweavers.com>
References: <e1d9e62c0804071637n76680520ge942d21e4bf8f81f@mail.gmail.com>
	<e1d9e62c0804090533g5b505f43od13e67b41c322024@mail.gmail.com>
	<200804110106.54219.stefan@codeweavers.com>
	<200804111450.40053.stefan@codeweavers.com>
Message-ID: <e1d9e62c0804120002p7b5548f5s42aa5154d2e4bcaf@mail.gmail.com>

 Checked and works, that seems to did a trick on everything:). In car
chase (high) and in demo with statue. Now river is showing in DS2,
there is no more flickering textures and menu also not show black
texture. Thanks:).

 Textures is good in DS2, on start perform good, but now if i played
for a while (10-15 minutes), performance is getting been worst and
worst... I will test more times just to be sure of this, because i
think that's also case without this hack.

 Painkiller now start when i disabled ps (not need 5 units in driconf
anymore to start), but thats just start. Now when it load level it
slowing down things and sometimes hang there, sometimes not, but in
both cases start to quickly use HD swap:). This is happen because this
game needs s3tc to be enabled in driconf and if it is then just works,
but now that is ati_fs there, seems to work only when ps is disabled
in winecfg, with enabled not even start. There is a log from console,
maybe it's usefull to you.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: pk_log.tar.gz
Type: application/x-gzip
Size: 2955 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080412/104d0475/attachment.bin 

From austinenglish at gmail.com  Sat Apr 12 04:33:51 2008
From: austinenglish at gmail.com (Austin English)
Date: Sat, 12 Apr 2008 04:33:51 -0500
Subject: Testcases: Call for volunteers
Message-ID: <b6bb06270804120233v5dae75fap57915dec23e2b9a0@mail.gmail.com>

Over the past few days I've had a bit of time to kill, and spent quite
a bit of it triaging bugs in bugzilla (mostly checking up on
old/abandoned bugs, but also,  tagging quite a few patches/test
cases).

In the process, I've tagged quite a few bugs (currently, 66 open, 9
closed) that have test cases attached. While not all are in C, or
easily portable to the wine test suite, I'd appreciate it if those of
you with time to spare could take a look at any test cases in your
area of expertise and port those tests to the wine test suite.

Here is the current  list:
http://bugs.winehq.org/buglist.cgi?keywords=testcase

The more conformance tests we can add, the fewer regressions post 1.0,
so in the end, less  work :-).

- Austin


From stefan at codeweavers.com  Sat Apr 12 06:34:12 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sat, 12 Apr 2008 13:34:12 +0200
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <d658b69e0804111927p2e3d7e36q98bba32d724f5a4f@mail.gmail.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804120057.57495.stefan@codeweavers.com>
	<d658b69e0804111927p2e3d7e36q98bba32d724f5a4f@mail.gmail.com>
Message-ID: <200804121334.12321.stefan@codeweavers.com>

Am Samstag, 12. April 2008 04:27:07 schrieb H. Verbeet:

> Anything that gets ignored when a vertex shader is active gets put in
> the vertex states, anything that gets ignored when a fragment shader
> is active should be part of the fragment states. Resource loading
> would be part of the "other" states.
GL named arrays get ignored when a vertex shader is in use, unless the shader 
explicitly uses them...

> Most of the connections you 
> mention appear to be connections on the D3D side, these would have no
> consequences for a separation on the GL side of things. Iow, it's
> perfectly valid for a state in the vertex block and a state in the
> fragment block to read from the same D3D state.
So if e.g. the vertex declaration is changed you would dirtify many states:
-> misc stream sources
-> vertex shader(use it or not?)
-> Fog
-> Fixed function vertex processing matrices(rhw vertices or not)
-> texture transforms
-> (a few others as well)
I have no problem with doing that, changing the vdecl is an expensive business 
no matter what we do, just asking to make sure I understand what you mean. 
How do you control which gl states are dirtified by which d3d state? This 
will depend on the combination of backends you use.

There are quite a few opengl connections as well, although they work 
differently.It's more the various interactions between shader extensions. In 
quite a few cases the fragment processing implementation has to configure the 
vertex processing correctly to feed it in the right way, and also the other 
way round.

For example, to stick to the texture transform flags. Let's consider we're 
using fixed function D3D vertex processing in whatever GL extension. Now 
enter fragment processing and D3DTTFF_PROJECTED:

-> With fixed function GL or a NVTS fixed function replacement we have to make 
sure that the 4th coordinate is 1.0 to disabe the GL division if 
TTFF_PROJECTED is not set, and if it is set with TTFF_COUNT3 make sure that 
the 3rd coord is copied to the 4th
-> With GLSL or ARB fixed function replacement we can handle the lack of 
TTFF_PROJECTED properly, but not COUNT3
-> With ATIFS we can handle everything properly in the replacement shader
-> With an ARB, GLSL or ATIFS D3D shader we don't need any special texture 
transform fixups
-> With an NVTS D3D shader we have to take care about disabling projected 
textures in vertex processing again

That means different fragment processing implementations have different vertex 
processing requirements. Now you could make that a flag in the fragment 
processing and pixel shader implementation. You'd need 4 
flags(nonshader_unprojected, shader_unprojected, nonshader_count3, 
shader_count3). Are you sure the flags won't grow out of control?

Another example is fogging. Fog is overwritten by ARB and GLSL, but not ATIFS 
and NVTS(as far as I can see). Is fog a vertex or fragment state? How do you 
share the quite complex fog applying code between the ATIFS, NVTS and GL 
fixed function implementation if you make it a fragment state?

> >  Also note that the GLSL pixel shaders depend on the type of vertex
> >  processing(non-GLSL or GLSL) to load the 3.0 varyings correctly. We
> > could get rid of that by requiring GLSL vp, but that would break
> > requirement 4, using the GL fixed function pipeline.
>
> From the shader's point of view a pipeline replacement should be
> indistinguishable from real fixed function processing, other than that
> in case of GLSL you have to link it together into a single program.
PS 3.0 shaders read texcoords and colors from custom varyings, and D3DCOLOR0, 
1, TEXCOORD0-7 are linked to their predecessors. That way a 3.0 pshader can 
interact with fixed function vertex processing and rhw drawing.(fixed 
function vertex processing is broken on ATI on Windows, but I don't want to 
justify the design with an ATI driver bug. RHW+3.0 is used by e.g. Age of 
Empires 3).

Where would you write the TEXCOORD0-7 and D3DCOLOR0 and 1 varyings from a GLSL 
vertex shader, and where do you read them from in the pixel shader? Keep 
indirect varying addressing in the pshader in mind.

> It's a concern when mixing different shader backends, but I'm not sure
> there's a lot we can do about it there. For fixed function
> replacements it shouldn't matter though, because you always write to
> the predefined fixed function outputs. In that case linking is only an
> issue for GLSL FFP + GLSL shader, which is trivial to implement.
When you're not able to link ARBVP+ATIFS pixel shaders or ATIVP+NVTS then that 
defeats the point of implementing pixel shaders with them, so we have to do 
something about them.

From the mail from yesterday:
> The private data between the FFP replacement and the shader backend
> can be shared. That means our general GLSL management stuff can see
> you've got eg. a FFP vertex shader and a pixel shader and link them
> together.
I am using GLSL for pixel shaders. Can I share my private data with a GLSL 
fragment replacement, or do I have to bother that the fixed function fragment 
processing might be done using ATIFS? Not using GLSL pshaders + ATIFS was one 
of the symtoms for you that "the shader backend isn't the right place to 
implement this".

---

> I'm currently not too bothered about Intel cards, although that might
> change in the future. Either way, it's certainly possible to create an
> ARB implementation, it's more a matter of priority.
They are pretty widespread and are even used in the EEEPC, so I think dealing 
with these cards will become a priority soon, at least for me. Unfortunately 
the driver sucks in terms of stability and performance.


From stefan at codeweavers.com  Sat Apr 12 06:41:15 2008
From: stefan at codeweavers.com (Stefan =?utf-8?q?D=C3=B6singer?=)
Date: Sat, 12 Apr 2008 13:41:15 +0200
Subject: GL_ATI_fragment_shader and GL_INVALID 0x501, 0x502
In-Reply-To: <e1d9e62c0804120002p7b5548f5s42aa5154d2e4bcaf@mail.gmail.com>
References: <e1d9e62c0804071637n76680520ge942d21e4bf8f81f@mail.gmail.com>
	<200804111450.40053.stefan@codeweavers.com>
	<e1d9e62c0804120002p7b5548f5s42aa5154d2e4bcaf@mail.gmail.com>
Message-ID: <200804121341.15300.stefan@codeweavers.com>

Am Samstag, 12. April 2008 09:02:02 schrieb Milan Kosti?:
>  Textures is good in DS2, on start perform good, but now if i played
> for a while (10-15 minutes), performance is getting been worst and
> worst... I will test more times just to be sure of this, because i
> think that's also case without this hack.
There's at least one "bug" in our fragment shader management code, and most 
likely a 2nd one. The first issue is that the searching for fragment shaders 
is rather simple and expensive. We'll have to replace the linear search at 
least with a sorted array, or possibly a hashmap.

The other problem, I noticed that during the 3DMark debugging, is that for 
some reason fragment shaders with identical settings are duplicated. That 
leads to more shaders to manage, and triggers the above issue.


From stefan at codeweavers.com  Sat Apr 12 07:25:12 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sat, 12 Apr 2008 14:25:12 +0200
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <d658b69e0804112007q21370d34hb543fd2af65a674b@mail.gmail.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804120141.06956.stefan@codeweavers.com>
	<d658b69e0804112007q21370d34hb543fd2af65a674b@mail.gmail.com>
Message-ID: <200804121425.12910.stefan@codeweavers.com>

Am Samstag, 12. April 2008 05:07:49 schrieb H. Verbeet:
> I thought we decided on IRC that it would make more sense to call the
> shader library from wined3d rather than d3d8, d3d9 and d3d10.
From where we call the shader library isn't all that important to me. For me 
it's mainly important that the shader library parses the d3d9 and d3d10 
shader and the wined3d GL shader generator works on Wine's internal shader 
representation

> I think going the GLSL way makes sense there. Anything supporting GL3
> should fully support GLSL already, and I'm not even sure GL3 will
> support a traditional fixed function pipeline.
What I meant is that it depends on how shaders will look in GL 3.0. If it is 
GLSL as it is now, we can just use the GLSL shader backend. If it is vastly 
different we'll need a new one.


From hverbeet at gmail.com  Sat Apr 12 08:06:38 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Sat, 12 Apr 2008 15:06:38 +0200
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <200804121334.12321.stefan@codeweavers.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804120057.57495.stefan@codeweavers.com>
	<d658b69e0804111927p2e3d7e36q98bba32d724f5a4f@mail.gmail.com>
	<200804121334.12321.stefan@codeweavers.com>
Message-ID: <d658b69e0804120606k747928b2qd079aef9ce179289@mail.gmail.com>

On 12/04/2008, Stefan D?singer <stefan at codeweavers.com> wrote:
> Am Samstag, 12. April 2008 04:27:07 schrieb H. Verbeet:
>  > Anything that gets ignored when a vertex shader is active gets put in
>  > the vertex states, anything that gets ignored when a fragment shader
>  > is active should be part of the fragment states. Resource loading
>  > would be part of the "other" states.
>
> GL named arrays get ignored when a vertex shader is in use, unless the shader
>  explicitly uses them...
>
It doesn't get ignored, you still do the upload and the data is still
available should the shader choose to use it. Still, I probably
should've phrased it as "functionality that gets replaced by a vertex
/ fragment shader".

>  > Most of the connections you
>  > mention appear to be connections on the D3D side, these would have no
>  > consequences for a separation on the GL side of things. Iow, it's
>  > perfectly valid for a state in the vertex block and a state in the
>  > fragment block to read from the same D3D state.
>
> So if e.g. the vertex declaration is changed you would dirtify many states:
>  -> misc stream sources
>  -> vertex shader(use it or not?)
>  -> Fog
>  -> Fixed function vertex processing matrices(rhw vertices or not)
>  -> texture transforms
>  -> (a few others as well)
>  I have no problem with doing that, changing the vdecl is an expensive business
>  no matter what we do, just asking to make sure I understand what you mean.
>  How do you control which gl states are dirtified by which d3d state? This
>  will depend on the combination of backends you use.
>
I'm not sure about the exact splitup you're using here, but it would
mean potentially dirtifying multiple states, yes. I could imagine it
as simply dirtifying the vertexdeclaration state on both the vertex
and fragment state tables.

>  There are quite a few opengl connections as well, although they work
>  differently.It's more the various interactions between shader extensions. In
>  quite a few cases the fragment processing implementation has to configure the
>  vertex processing correctly to feed it in the right way, and also the other
>  way round.
>
>  For example, to stick to the texture transform flags. Let's consider we're
>  using fixed function D3D vertex processing in whatever GL extension. Now
>  enter fragment processing and D3DTTFF_PROJECTED:
>
>  -> With fixed function GL or a NVTS fixed function replacement we have to make
>  sure that the 4th coordinate is 1.0 to disabe the GL division if
>  TTFF_PROJECTED is not set, and if it is set with TTFF_COUNT3 make sure that
>  the 3rd coord is copied to the 4th
>  -> With GLSL or ARB fixed function replacement we can handle the lack of
>  TTFF_PROJECTED properly, but not COUNT3
>  -> With ATIFS we can handle everything properly in the replacement shader
>  -> With an ARB, GLSL or ATIFS D3D shader we don't need any special texture
>  transform fixups
>  -> With an NVTS D3D shader we have to take care about disabling projected
>  textures in vertex processing again
>
>  That means different fragment processing implementations have different vertex
>  processing requirements. Now you could make that a flag in the fragment
>  processing and pixel shader implementation. You'd need 4
>  flags(nonshader_unprojected, shader_unprojected, nonshader_count3,
>  shader_count3). Are you sure the flags won't grow out of control?
>
You only need two. One to toggle writing 1.0 to the 4th coordinate
when needed, and one to toggle copying the 3th coordinate to the 4th
when needed. It would certainly beat doing an extension check for
every possible backend. Right now we always do the fixup, so in that
respect it would be an improvement as well.

>  Another example is fogging. Fog is overwritten by ARB and GLSL, but not ATIFS
>  and NVTS(as far as I can see). Is fog a vertex or fragment state? How do you
>  share the quite complex fog applying code between the ATIFS, NVTS and GL
>  fixed function implementation if you make it a fragment state?
>
That depends on the fog type. Vertex fog is a vertex state, fragment
fog is a fragment state. Changing the type would obviously have
interactions with both parts of the pipeline. As for applying the
state, there's no reason different implementations can call a common
function in eg. utils.c to calculate things like the fog mode, type,
start, end, etc. One could argue it doesn't belong in state_fog() in
the first place.

>  > From the shader's point of view a pipeline replacement should be
>  > indistinguishable from real fixed function processing, other than that
>  > in case of GLSL you have to link it together into a single program.
>
> PS 3.0 shaders read texcoords and colors from custom varyings, and D3DCOLOR0,
>  1, TEXCOORD0-7 are linked to their predecessors. That way a 3.0 pshader can
>  interact with fixed function vertex processing and rhw drawing.(fixed
>  function vertex processing is broken on ATI on Windows, but I don't want to
>  justify the design with an ATI driver bug. RHW+3.0 is used by e.g. Age of
>  Empires 3).
>
>  Where would you write the TEXCOORD0-7 and D3DCOLOR0 and 1 varyings from a GLSL
>  vertex shader, and where do you read them from in the pixel shader? Keep
>  indirect varying addressing in the pshader in mind.
>
Just to be clear, with "GLSL vertex shader" you mean "GLSL vertex
processing replacement", right? A vertex processing replacement shader
would write to the regular fixed function output, ie gl_FrontColor,
gl_FrontSecondaryColor, gl_TexCoord[], etc. The fragment shader would
read them the same way as it does when paired with fixed function or
pre-3.0 vertex shaders.

>  > It's a concern when mixing different shader backends, but I'm not sure
>  > there's a lot we can do about it there. For fixed function
>  > replacements it shouldn't matter though, because you always write to
>  > the predefined fixed function outputs. In that case linking is only an
>  > issue for GLSL FFP + GLSL shader, which is trivial to implement.
>
> When you're not able to link ARBVP+ATIFS pixel shaders or ATIVP+NVTS then that
>  defeats the point of implementing pixel shaders with them, so we have to do
>  something about them.
>
Actually, I'm not sure what I was thinking here. It should only be a
concern when mixing two SM3.0+ shaders between different backends,
which atifs and nvts are never going to support. The only combination
that would need some kind of linking would be GLSL SM3.0 vertex
shaders with GLSL SM3.0 fragment shaders, but we currently handle that
and it could pretty much continue to keep working the same way. ARBVP
+ ATIFS PS or ATIVP + NVTS PS should work without problem, if you
split up the shader backend. I still think it's premature to worry too
much about that at the moment, since it's a separate issue from how
you split up the state management.

>  From the mail from yesterday:
>
> > The private data between the FFP replacement and the shader backend
>  > can be shared. That means our general GLSL management stuff can see
>  > you've got eg. a FFP vertex shader and a pixel shader and link them
>  > together.
>
> I am using GLSL for pixel shaders. Can I share my private data with a GLSL
>  fragment replacement, or do I have to bother that the fixed function fragment
>  processing might be done using ATIFS? Not using GLSL pshaders + ATIFS was one
>  of the symtoms for you that "the shader backend isn't the right place to
>  implement this".
>
Pixel shaders + fragment processing replacement doesn't make sense.
Either a GLSL vertex processing replacement + GLSL pixel shader or a
GLSL vertex shader + GLSL fragment processing replacement would work
though. The "GLSL pipeline object" would know if it's being used as
vertex and/or fragment replacement and link everything together. In
case atifs is used no linking is required.

Basically you should think of the GLSL private data + vertex
processing replacement + fragment processing replacement + shader
backend as a single object exposing three different interfaces. Call
it a "pipeline object" if you like.

>  > I'm currently not too bothered about Intel cards, although that might
>  > change in the future. Either way, it's certainly possible to create an
>  > ARB implementation, it's more a matter of priority.
>
> They are pretty widespread and are even used in the EEEPC, so I think dealing
>  with these cards will become a priority soon, at least for me. Unfortunately
>  the driver sucks in terms of stability and performance.
>
Are those cards powerful enough to support a fixed function replacement?


From ovek at arcticnet.no  Sat Apr 12 10:19:37 2008
From: ovek at arcticnet.no (Ove Kaaven)
Date: Sat, 12 Apr 2008 17:19:37 +0200
Subject: Wine on OLPC
In-Reply-To: <48004094.6010602@fas.harvard.edu>
References: <47FFED51.30608@fas.harvard.edu>	<22821af30804111607g283f398cg914e4461ba06c70d@mail.gmail.com>	<47FFF025.1070405@fas.harvard.edu>	<22821af30804111622o5313a0adu74f68daa564597a8@mail.gmail.com>	<48000620.6020902@fas.harvard.edu>	<22821af30804111753h40f9219fq783d57847534f9d3@mail.gmail.com>
	<48004094.6010602@fas.harvard.edu>
Message-ID: <4800D309.4090406@arcticnet.no>

Benjamin M. Schwartz skrev:
> I'm particularly surprised because I cannot imagine any reasonable
> scenario in which allowing non-root users to run in .wine/ directories
> that they do not own is a security risk.  There is no privilege escalation
> here; the non-root user is still required by the kernel to operate within
> the bounds of posix permissions.

That's not quite correct. If user B can run user A's installation of 
Wine, then user B can easily install some script or program that gets 
executed automatically (wineboot) the next time user A runs Wine; from 
there, user B can gain unlimited access to user A's account. (Or, 
perhaps, vice versa.)

I think that's not really the point of the check, though. Perhaps more 
problematic is probably that if user B runs user A's Wine, then files 
written (registry included) might become owned by B, with the result 
that next time user A wants to start Wine, it can't access them. (The 
most frequent problem here is the one when user B called "root", but not 
necessarily.)

And of course, if user A and user B happens to run Wine 
*simultaneously*, they're going to overwrite each other's files and end 
up with a broken Wine installation.

> I need the ability to run in profiles as a user who is not the "owner" of
> the files on disk.  I am doing this quite specifically because, in my
> case, this greatly _increases_ the security of the system.

You have a poor understanding of Unix security if you think it's good 
that files and whatever uses them are on different accounts, and if you 
think making a (fake) Windows installation publicly accessible (and 
modifiable) by every other user on the system can possibly be called secure.

I'm not sure why you even need to. If you're running Wine as a different 
user, why shouldn't that different user own its own .wine/ directory?




From stefan at codeweavers.com  Sat Apr 12 10:05:26 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sat, 12 Apr 2008 17:05:26 +0200
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <d658b69e0804120606k747928b2qd079aef9ce179289@mail.gmail.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804121334.12321.stefan@codeweavers.com>
	<d658b69e0804120606k747928b2qd079aef9ce179289@mail.gmail.com>
Message-ID: <200804121705.26521.stefan@codeweavers.com>

Am Samstag, 12. April 2008 15:06:38 schrieb H. Verbeet:
> It doesn't get ignored, you still do the upload and the data is still
> available should the shader choose to use it. Still, I probably
> should've phrased it as "functionality that gets replaced by a vertex
> / fragment shader".
But since D3D vertex shaders always read the numbered arrays and fixed 
function always reads the named arrays the named arrays get de-facto replaced 
as far as we're concerned.

> >  That means different fragment processing implementations have different
> > vertex processing requirements. Now you could make that a flag in the
> > fragment processing and pixel shader implementation. You'd need 4
> >  flags(nonshader_unprojected, shader_unprojected, nonshader_count3,
> >  shader_count3). Are you sure the flags won't grow out of control?
>
> You only need two. One to toggle writing 1.0 to the 4th coordinate
> when needed, and one to toggle copying the 3th coordinate to the 4th
> when needed. It would certainly beat doing an extension check for
> every possible backend. Right now we always do the fixup, so in that
> respect it would be an improvement as well.
I'm working on a patch that makes the atifs shader code take care of applying 
the texture transform matrix. That works naturally without any flags or 
backend check if you don't try to split vertex and fragment processing by 
force.

> That depends on the fog type. Vertex fog is a vertex state, fragment
> fog is a fragment state. Changing the type would obviously have
> interactions with both parts of the pipeline.
On the GL side both vertex and fragment fog are applied to the same GL state. 
Using a ARBFP or GLSL fragment shader replaces vertex fog as well, so you'll 
have to implement both types in the fragment processing replacement.

The fog settings depend on the vertex decl(XYZ vs XYZRHW) and the shader 
properties("foggy shader"). That means the fragment processing code(pixel 
shader and ffp replacement) would look at the core of the vertex processing 
settings. Doesn't that defeat separating them in the first place?

(I understand that you want to split the state types on the GL side, not the 
D3D side. But when you split applying of one D3D state in 3 pieces, I fail to 
see how it is cleaner)

You didn't answer how you plan to implement state dirtification. You have a 
SetRenderState call that changes render state X. Which implementation 
state(s) do you dirtify? Ie:

> 
device->fragment_state_manager->mark_state_dirty(device->fragment_private_data,
> state);

Where does "state" come from?

> if (!use_vs) {
>     device->vertex_state_manager->apply_states(device->vertex_private_data);
> }
> ...
This would be done where?

> >  Where would you write the TEXCOORD0-7 and D3DCOLOR0 and 1 varyings from
> > a GLSL vertex shader, and where do you read them from in the pixel
> > shader? Keep indirect varying addressing in the pshader in mind.
>
> Just to be clear, with "GLSL vertex shader" you mean "GLSL vertex
> processing replacement", right? A vertex processing replacement shader
> would write to the regular fixed function output, ie gl_FrontColor,
> gl_FrontSecondaryColor, gl_TexCoord[], etc. The fragment shader would
> read them the same way as it does when paired with fixed function or
> pre-3.0 vertex shaders.
No, I mean a D3D (3.0) vertex shader that is translated and running via GLSL. 
Currently the pixel shader decides where the vertex shader(all versions) 
writes the varyings to(generate_param_reorder_function). If a fixed function 
vertex replacement shader and pre-3.0 shader writes to the regular fixed 
function output, how would you run a pixel shader like the one in 
vshader_version_varying_test() in visual.c together with a 1.x or 2.0 vertex 
shader, or XYZRHW data from a GLSL vertex pipeline replacement shader? (With 
the fixed function GL vertex pipeline we're screwed, but we aren't 
necessarily screwed with a GLSL vertex pipeline replacement)

> Pixel shaders + fragment processing replacement doesn't make sense.
> Either a GLSL vertex processing replacement + GLSL pixel shader or a
> GLSL vertex shader + GLSL fragment processing replacement would work
> though. The "GLSL pipeline object" would know if it's being used as
> vertex and/or fragment replacement and link everything together. In
> case atifs is used no linking is required.
What I meant was that: Scenario 1:
GLSL is used for pixel shaders and fragment pipeline replacement. How do I 
find out if I have to link the fragment replacement GLSL shader or the pixel 
shader GLSL shader into my program I activate? -> Share private data between 
GLSL shader backend and GLSL fixed function object

Followup scenario 2: We don't have a GLSL fixed function backend yet. I have 
an ATI X1600 card, I am using GLSL for pixel shaders, and I am using ATIFS 
for the pipeline replacement. The GLSL pixel shader code reads the GLSL 
fragment pipeline replacement private data. -> This GLSL fragment replacement 
private data is either nonexistant or hanging around without code maintaining 
it. How do we deal with that?

> > They are pretty widespread and are even used in the EEEPC, so I think
> > dealing with these cards will become a priority soon, at least for me.
> > Unfortunately the driver sucks in terms of stability and performance.
>
> Are those cards powerful enough to support a fixed function replacement?
Afaik the older cards do not support vertex processing, it's done in software, 
so it depends on the driver. On the fragment side they are pretty solid and 
work only with programmable fragment processing internally. The newer X3100 
only supports programmable vertex and fragment processing in hardware, so a 
pipeline replacement is either done by us or the driver. It might be powerful 
enough for GLSL as well though.


From wine-devel at kievinfo.com  Sat Apr 12 10:22:07 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sat, 12 Apr 2008 09:22:07 -0600
Subject: Dead-loop in IWineD3DTextureImpl_PreLoad
Message-ID: <4800D39F.2000809@kievinfo.com>

Can some one take a look at this (bug 11630)?

I'm not sure how it works at all now:
IWineD3DTexture_PreLoad:144: http://source.winehq.org/source/dlls/wined3d/texture.c#L144
IWineD3DSurface_LoadTexture:488: http://source.winehq.org/source/dlls/wined3d/surface.c#L488

And of course container is Texture so the loop starts again until Wine runs out of stack.

Vitaliy.


From bmschwar at fas.harvard.edu  Sat Apr 12 10:37:07 2008
From: bmschwar at fas.harvard.edu (Benjamin M. Schwartz)
Date: Sat, 12 Apr 2008 11:37:07 -0400
Subject: Wine on OLPC
In-Reply-To: <4800D309.4090406@arcticnet.no>
References: <47FFED51.30608@fas.harvard.edu>	<22821af30804111607g283f398cg914e4461ba06c70d@mail.gmail.com>	<47FFF025.1070405@fas.harvard.edu>	<22821af30804111622o5313a0adu74f68daa564597a8@mail.gmail.com>	<48000620.6020902@fas.harvard.edu>	<22821af30804111753h40f9219fq783d57847534f9d3@mail.gmail.com>	<48004094.6010602@fas.harvard.edu>
	<4800D309.4090406@arcticnet.no>
Message-ID: <4800D723.8000104@fas.harvard.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Ove Kaaven wrote:
| Benjamin M. Schwartz skrev:
|> I'm particularly surprised because I cannot imagine any reasonable
|> scenario in which allowing non-root users to run in .wine/ directories
|> that they do not own is a security risk.  There is no privilege escalation
|> here; the non-root user is still required by the kernel to operate within
|> the bounds of posix permissions.
|
| That's not quite correct. If user B can run user A's installation of
| Wine, then user B can easily install some script or program that gets
| executed automatically (wineboot) the next time user A runs Wine; from
| there, user B can gain unlimited access to user A's account. (Or,
| perhaps, vice versa.)

My home directory is not world-writable.  Is yours?

|
| I think that's not really the point of the check, though. Perhaps more
| problematic is probably that if user B runs user A's Wine, then files
| written (registry included) might become owned by B, with the result
| that next time user A wants to start Wine, it can't access them. (The
| most frequent problem here is the one when user B called "root", but not
| necessarily.)

This only works if one user is root; otherwise (under any normal unix
permissions setup) multiple users do not have write access to each other's
.wine/ directories.

|
| And of course, if user A and user B happens to run Wine
| *simultaneously*, they're going to overwrite each other's files and end
| up with a broken Wine installation.

That is definitely an interesting problem, as noted in the very
comprehensive bug #11112.  The suggested solution of introducing a
lockfile does seem appropriate; it's how every other unix application
solves this problem.  In my case, I have external mechanisms to ensure
that multiple instances of wine are never running simultaneously.

|
|> I need the ability to run in profiles as a user who is not the "owner" of
|> the files on disk.  I am doing this quite specifically because, in my
|> case, this greatly _increases_ the security of the system.
|
| You have a poor understanding of Unix security if you think it's good
| that files and whatever uses them are on different accounts, and if you
| think making a (fake) Windows installation publicly accessible (and
| modifiable) by every other user on the system can possibly be called secure.

I'm afraid there is not space here to describe the Rainbow security
system.  However, I am operating in a special environment in which the
system has a single human user, and unix uid's have been repurposed to
provide software isolation.  I am not, in fact, suggesting making .wine/
publicly accessible.  I am actually using "chmod g+rwx" to make .wine/
available to a particular application, because each application has a
unique gid.  Also, Rainbow uses namespaced bindmounts in such a way that
applications not running with the gid in question cannot even determine
that this .wine/ directory exists.

See http://wiki.laptop.org/go/Rainbow

|
| I'm not sure why you even need to. If you're running Wine as a different
| user, why shouldn't that different user own its own .wine/ directory?

Rainbow works by generating a new uid every time an application is
launched.  Therefore, the second time the same human runs a wine-based
program, it runs under a different uid.  In order to provide continuity of
state, I need to be able to run in a permanent .wine/ despite having a uid
that is constantly changing.

Bug #11112 suggests that it may be possible to solve this problem using
dynamically generated symlinks.  I will try that.

- --Ben
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.7 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFIANcjUJT6e6HFtqQRAnHdAKCUxI/2HvzfiEjloGjwkcIiZ24ZpACcDBZ+
Cq9UlZY0euM9DHwlmyusyV4=
=C/Un
-----END PGP SIGNATURE-----


From Andrew.Talbot at talbotville.com  Sat Apr 12 10:54:41 2008
From: Andrew.Talbot at talbotville.com (Andrew Talbot)
Date: Sat, 12 Apr 2008 16:54:41 +0100
Subject: AVI file format documentation
References: <a71bd89a0804101142g699fdc9k7ebd4ce3f44e208a@mail.gmail.com><005501c89ba8$22d255c0$a600fea9@DMITRY>
	<b130c85e0804110055q4247a5e2rc7312b19c5992ee0@mail.gmail.com>
	<004001c89bbb$0108e950$a600fea9@DMITRY>
Message-ID: <ftqm01$bg6$1@ger.gmane.org>

While we are on the subject of AVI files: could someone please take a look
at the function IAVIStream_fnWriteData() in avifil32/avifile.c? There is an
unused variable "dwPos" (line 1326), which has been there since this
function was first implemented (2002-10-18), I could just remove this
variable, but I think the calculation of available space may be incorrect
anyway. Comments please!

Thanks,

-- 
Andy.




From luis.busquets at ilidium.com  Sat Apr 12 11:11:05 2008
From: luis.busquets at ilidium.com (Luis Busquets)
Date: Sat, 12 Apr 2008 18:11:05 +0200
Subject: Several patches for D3DX
In-Reply-To: <22821af30804111627ha04dbdfqac2c115e9f473c01@mail.gmail.com>
References: <47FFF246.4090003@ilidium.com>
	<22821af30804111627ha04dbdfqac2c115e9f473c01@mail.gmail.com>
Message-ID: <4800DF19.2040009@ilidium.com>

Thanks for your sincere response. I am aware that there are diverse 
styles of writing the functions and all can be criticised: some for its 
complexity, others for its unreadability, others for its length... 
Anyway at this point in time , what I see as evident is that the three 
implementations that I have submitted comply with their attached tests 
and I have tried to include all the modifications proposed. Although in 
my opinion the best would be to commit these patches and, if needed, 
increase the beautiness of the code in particular direction later, for 
me it is evident that it is not hard to implement these three functions 
in one way or another.

Therefore, in the case that the implementations submitted are not liked, 
please, I ask a more experienced programmer to submit his/her 
implementations and commit them to the tree for these really trivial 
functions (D3DXGetShaderVersion, D3DXGetShaderSize, D3DXGetFVFVertexSize).

James Hawkins escribi?:
> On Fri, Apr 11, 2008 at 6:20 PM, Luis Busquets
> <luis.busquets at ilidium.com> wrote:
>   
>> Is there still any problem with each of the attached patches or are they
>> going to be committed?
>>
>>     
>
> +WINAPI DWORD D3DXGetShaderVersion(CONST DWORD *pFunction)
> +{
> +    DWORD ver;
> +    if (!pFunction)
> +     {
> +      return 0;
> +      }
> +    /* The first DWORD of the stream is the version Token */
> +   ver=*pFunction;
> +   return ver;
> +}
>
> I can't attest to any of the rest, but the style in this function is
> horrendous.  Your spacing is all over the place.  Also, correctness of
> this function aside, the function can be written so much simpler as:
>
> WINAPI DWORD D3DXGetShaderVersion(CONST DWORD *pFunction)
> {
>     return (pFunction) ? *pFunction : 0;
> }
>
>   



From truiken at gmail.com  Sat Apr 12 11:14:58 2008
From: truiken at gmail.com (James Hawkins)
Date: Sat, 12 Apr 2008 11:14:58 -0500
Subject: Several patches for D3DX
In-Reply-To: <4800DF19.2040009@ilidium.com>
References: <47FFF246.4090003@ilidium.com>
	<22821af30804111627ha04dbdfqac2c115e9f473c01@mail.gmail.com>
	<4800DF19.2040009@ilidium.com>
Message-ID: <22821af30804120914q16d9636dl1b2d0bc64408f173@mail.gmail.com>

On Sat, Apr 12, 2008 at 11:11 AM, Luis Busquets
<luis.busquets at ilidium.com> wrote:
> Thanks for your sincere response. I am aware that there are diverse styles
> of writing the functions and all can be criticised: some for its complexity,
> others for its unreadability, others for its length... Anyway at this point
> in time , what I see as evident is that the three implementations that I
> have submitted comply with their attached tests and I have tried to include
> all the modifications proposed. Although in my opinion the best would be to
> commit these patches and, if needed, increase the beautiness of the code in
> particular direction later, for me it is evident that it is not hard to
> implement these three functions in one way or another.
>
>  Therefore, in the case that the implementations submitted are not liked,
> please, I ask a more experienced programmer to submit his/her
> implementations and commit them to the tree for these really trivial
> functions (D3DXGetShaderVersion, D3DXGetShaderSize, D3DXGetFVFVertexSize).
>

That's definitely not going to happen.  Style consistency is of utmost
importance when submitting patches.  Very rarely does Julliard accept
a style "beautification" patch.  It has to be right the first time
it's committed.  Also, we're all busy working on whatever we're
working on, so you either fix them up and resend, or they're going to
bit-rot.  P.S. please bottom-post in this mailing list.

-- 
James Hawkins


From ovek at arcticnet.no  Sat Apr 12 11:22:39 2008
From: ovek at arcticnet.no (Ove Kaaven)
Date: Sat, 12 Apr 2008 18:22:39 +0200
Subject: Wine on OLPC
In-Reply-To: <4800D723.8000104@fas.harvard.edu>
References: <47FFED51.30608@fas.harvard.edu>	<22821af30804111607g283f398cg914e4461ba06c70d@mail.gmail.com>	<47FFF025.1070405@fas.harvard.edu>	<22821af30804111622o5313a0adu74f68daa564597a8@mail.gmail.com>	<48000620.6020902@fas.harvard.edu>	<22821af30804111753h40f9219fq783d57847534f9d3@mail.gmail.com>	<48004094.6010602@fas.harvard.edu>
	<4800D309.4090406@arcticnet.no> <4800D723.8000104@fas.harvard.edu>
Message-ID: <4800E1CF.6090508@arcticnet.no>

Benjamin M. Schwartz skrev:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Ove Kaaven wrote:
> | Benjamin M. Schwartz skrev:
> |> I'm particularly surprised because I cannot imagine any reasonable
> |> scenario in which allowing non-root users to run in .wine/ directories
> |> that they do not own is a security risk.  There is no privilege 
> escalation
> |> here; the non-root user is still required by the kernel to operate 
> within
> |> the bounds of posix permissions.
> |
> | That's not quite correct. If user B can run user A's installation of
> | Wine, then user B can easily install some script or program that gets
> | executed automatically (wineboot) the next time user A runs Wine; from
> | there, user B can gain unlimited access to user A's account. (Or,
> | perhaps, vice versa.)
> 
> My home directory is not world-writable.  Is yours?

Obviously you missed the point. If I have access to your .wine 
directory, then I can compromise your entire account and everything it 
owns, it doesn't matter whether it's world-writable or not. And 
similarly, you can compromise mine, it doesn't matter what permissions 
my home directory has. Any .wine can be converted into a SSH server, FTP 
server, spam proxy, whatever you fancy, as soon as someone runs Wine.

> | I think that's not really the point of the check, though. Perhaps more
> | problematic is probably that if user B runs user A's Wine, then files
> | written (registry included) might become owned by B, with the result
> | that next time user A wants to start Wine, it can't access them. (The
> | most frequent problem here is the one when user B called "root", but not
> | necessarily.)
> 
> This only works if one user is root; otherwise (under any normal unix
> permissions setup) multiple users do not have write access to each other's
> .wine/ directories.

But in your original post, you used chmod a+rwx precisely to give 
multiple users write access to each other's .wine directories. And since 
you're apparently arguing against that trick here, I guess you're seeing 
a reason why wine disallows it.

> | And of course, if user A and user B happens to run Wine
> | *simultaneously*, they're going to overwrite each other's files and end
> | up with a broken Wine installation.
> 
> That is definitely an interesting problem, as noted in the very
> comprehensive bug #11112.  The suggested solution of introducing a
> lockfile does seem appropriate; it's how every other unix application
> solves this problem.

For applications that need to process a file for a couple of seconds, 
sure. But Wine might run for hours or days, so in a multiuser setting, a 
lock file that locks out other users until the first user exits is not 
enough.

> |> I need the ability to run in profiles as a user who is not the 
> "owner" of
> |> the files on disk.  I am doing this quite specifically because, in my
> |> case, this greatly _increases_ the security of the system.
> |
> | You have a poor understanding of Unix security if you think it's good
> | that files and whatever uses them are on different accounts, and if you
> | think making a (fake) Windows installation publicly accessible (and
> | modifiable) by every other user on the system can possibly be called 
> secure.
> 
> I'm afraid there is not space here to describe the Rainbow security
> system.  However, I am operating in a special environment in which the
> system has a single human user, and unix uid's have been repurposed to
> provide software isolation.  I am not, in fact, suggesting making .wine/
> publicly accessible.  I am actually using "chmod g+rwx" to make .wine/
> available to a particular application, because each application has a
> unique gid.  Also, Rainbow uses namespaced bindmounts in such a way that
> applications not running with the gid in question cannot even determine
> that this .wine/ directory exists.

Well, you could perhaps relax the Wine checks for this special case, but 
such a patch could still not avoid "compromising the security of users 
in the general case".

> Bug #11112 suggests that it may be possible to solve this problem using
> dynamically generated symlinks.  I will try that.

The big reason .wine has to be owned by the right user is that the 
wineserver socket is stored there. That's what the check really 
protects. Everything else can be symlinked in, yes.





From bmschwar at fas.harvard.edu  Sat Apr 12 11:52:11 2008
From: bmschwar at fas.harvard.edu (Benjamin M. Schwartz)
Date: Sat, 12 Apr 2008 12:52:11 -0400
Subject: Wine on OLPC
In-Reply-To: <4800E1CF.6090508@arcticnet.no>
References: <47FFED51.30608@fas.harvard.edu>	<22821af30804111607g283f398cg914e4461ba06c70d@mail.gmail.com>	<47FFF025.1070405@fas.harvard.edu>	<22821af30804111622o5313a0adu74f68daa564597a8@mail.gmail.com>	<48000620.6020902@fas.harvard.edu>	<22821af30804111753h40f9219fq783d57847534f9d3@mail.gmail.com>	<48004094.6010602@fas.harvard.edu>	<4800D309.4090406@arcticnet.no>
	<4800D723.8000104@fas.harvard.edu> <4800E1CF.6090508@arcticnet.no>
Message-ID: <4800E8BB.1000808@fas.harvard.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Ove Kaaven wrote:
| Benjamin M. Schwartz skrev:
|> Bug #11112 suggests that it may be possible to solve this problem using
|> dynamically generated symlinks.  I will try that.
|
| The big reason .wine has to be owned by the right user is that the
| wineserver socket is stored there. That's what the check really
| protects. Everything else can be symlinked in, yes.

This appears to have worked.  WINEPREFIX cannot be a symlink, but making
it a directory with 5 symlinks in it solves the problem.

If the developers want to create a high barrier to running Wine under
multiple uid's, this is not a bad balance point.  Perhaps I will document it.

- --Ben
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.7 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFIAOi7UJT6e6HFtqQRAk1tAJ0cWn0ufywjXm2hrLBd3K0iN7KEyACfQfkz
iABAYzKR4F2amr7DtVVsy5o=
=KJ6Y
-----END PGP SIGNATURE-----


From hverbeet at gmail.com  Sat Apr 12 12:55:53 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Sat, 12 Apr 2008 19:55:53 +0200
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <200804121705.26521.stefan@codeweavers.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804121334.12321.stefan@codeweavers.com>
	<d658b69e0804120606k747928b2qd079aef9ce179289@mail.gmail.com>
	<200804121705.26521.stefan@codeweavers.com>
Message-ID: <d658b69e0804121055v5aebcab5jb190bb7bd3c10c4b@mail.gmail.com>

On 12/04/2008, Stefan D?singer <stefan at codeweavers.com> wrote:
> But since D3D vertex shaders always read the numbered arrays and fixed
>  function always reads the named arrays the named arrays get de-facto replaced
>  as far as we're concerned.
>
Which is completely irrelevant for classifying the operation.
Please read the ARB_vertex_program spec, issue 3 and the
ARB_fragment_program spec, issue 13 to get a better idea of what
shaders replace and what they don't.

>  > You only need two. One to toggle writing 1.0 to the 4th coordinate
>  > when needed, and one to toggle copying the 3th coordinate to the 4th
>  > when needed. It would certainly beat doing an extension check for
>  > every possible backend. Right now we always do the fixup, so in that
>  > respect it would be an improvement as well.
>
> I'm working on a patch that makes the atifs shader code take care of applying
>  the texture transform matrix. That works naturally without any flags or
>  backend check if you don't try to split vertex and fragment processing by
>  force.
>
If the issue is that you've got an interest in keeping the existing
structure because you've already written code on top of it there's not
much point in having this discussion in the first place. If that's not
the issue, I'd like to mention that the whole point of having
interfaces is that you can avoid ugliness like setting vertex
processing state in the fragment processing part of the pipeline.
There's also nothing forceful about splitting your pipeline in vertex
and fragment processing, that's how the hardware works, it's how GL
works, and it's how D3D works.

>  > That depends on the fog type. Vertex fog is a vertex state, fragment
>  > fog is a fragment state. Changing the type would obviously have
>  > interactions with both parts of the pipeline.
>
> On the GL side both vertex and fragment fog are applied to the same GL state.
>  Using a ARBFP or GLSL fragment shader replaces vertex fog as well, so you'll
>  have to implement both types in the fragment processing replacement.
>
The fog blending is a fragment operation, yes. Coordinate calculation
depends on the coordinate source and fog hint, and can happen either
during vertex processing, fragment processing or not at all if fog
coordinates are specified.

>  The fog settings depend on the vertex decl(XYZ vs XYZRHW) and the shader
>  properties("foggy shader"). That means the fragment processing code(pixel
>  shader and ffp replacement) would look at the core of the vertex processing
>  settings. Doesn't that defeat separating them in the first place?
>
No, like you correctly mention below, the point is to separate the
implementation, not where the implementation gets its information from
on the D3D side.

>  (I understand that you want to split the state types on the GL side, not the
>  D3D side. But when you split applying of one D3D state in 3 pieces, I fail to
>  see how it is cleaner)
>
This would hardly be something new. You mentioned the
vertexdeclaration state yourself that modifies multiple GL states, and
it's hardly the only one.

>  You didn't answer how you plan to implement state dirtification. You have a
>  SetRenderState call that changes render state X. Which implementation
>  state(s) do you dirtify? Ie:
>
>
>  >
>  device->fragment_state_manager->mark_state_dirty(device->fragment_private_data,
>  > state);
>
>
> Where does "state" come from?
>
I don't remember you asking, but I see no reason to change the basic
way dirtification is currently done.

>
>  > if (!use_vs) {
>  >     device->vertex_state_manager->apply_states(device->vertex_private_data);
>  > }
>
> > ...
>  This would be done where?
>
ActivateContext, CTXUSAGE_DRAWPRIM. (Yes it should probably be part of
the context, not the device, my bad.)

> No, I mean a D3D (3.0) vertex shader that is translated and running via GLSL.
>  Currently the pixel shader decides where the vertex shader(all versions)
>  writes the varyings to(generate_param_reorder_function). If a fixed function
>  vertex replacement shader and pre-3.0 shader writes to the regular fixed
>  function output, how would you run a pixel shader like the one in
>  vshader_version_varying_test() in visual.c together with a 1.x or 2.0 vertex
>  shader, or XYZRHW data from a GLSL vertex pipeline replacement shader? (With
>  the fixed function GL vertex pipeline we're screwed, but we aren't
>  necessarily screwed with a GLSL vertex pipeline replacement)
>
The pipeline object would certainly have access to all the information
required to create such a reordering function, but I fail to see how
it's relevant at this point. The idea here certainly isn't to
magically fix all state and shader related issues in wined3d, it's
just about making fixed function replacement shaders possible in a
maintainable way.

> What I meant was that: Scenario 1:
>  GLSL is used for pixel shaders and fragment pipeline replacement. How do I
>  find out if I have to link the fragment replacement GLSL shader or the pixel
>  shader GLSL shader into my program I activate? -> Share private data between
>  GLSL shader backend and GLSL fixed function object
>
>  Followup scenario 2: We don't have a GLSL fixed function backend yet. I have
>  an ATI X1600 card, I am using GLSL for pixel shaders, and I am using ATIFS
>  for the pipeline replacement. The GLSL pixel shader code reads the GLSL
>  fragment pipeline replacement private data. -> This GLSL fragment replacement
>  private data is either nonexistant or hanging around without code maintaining
>  it. How do we deal with that?
>
Not exactly. In the first place, if there's no GLSL fixed function
implementation you'll never have to link to it, simple as that. Now in
case there *is* a GLSL fixed function replacement but it isn't used
(for whatever reason), that simply means the GLSL pipeline object's
private data will tell it it doesn't have to link anything (or rather,
*not* tell it it has to link to the ffp replacement).

There really is no distinction between "pixel shader private data" and
"ffp replacement private data", they're both pointers to the same
block of memory, and eg. the shader backend will always only get
passed its own private data.

I'd also like to note that most of the issues you bring up are not new
or specific to this design at all, and some of them wouldn't work at
all with the current structure.


From kai.blin at gmail.com  Sat Apr 12 17:14:51 2008
From: kai.blin at gmail.com (Kai Blin)
Date: Sun, 13 Apr 2008 00:14:51 +0200
Subject: Trying to get a grip on how to handle bug reports.
Message-ID: <200804130014.58380.kai.blin@gmail.com>

Hi folks,

I seem to have done something wrong referring a user to a closed bug report 
that seemed to be related to the problem he was having. (See bug 11639 for 
more context)

So in order to avoid me being the cause a user defiles the holy status of a 
closed bug, I'd like to have some clear rules on how to handle related bug 
reports.

And you folks wonder why we don't have a healthy user community. Sometimes I 
feel like talking to a brick wall.

Kai

-- 
Kai Blin
WorldForge developer  http://www.worldforge.org/
Wine developer        http://wiki.winehq.org/KaiBlin
Samba team member     http://www.samba.org/samba/team/
--
Will code for cotton.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080413/c552ae9d/attachment.pgp 

From stefan at codeweavers.com  Sat Apr 12 17:28:16 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sun, 13 Apr 2008 00:28:16 +0200
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <d658b69e0804121055v5aebcab5jb190bb7bd3c10c4b@mail.gmail.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804121705.26521.stefan@codeweavers.com>
	<d658b69e0804121055v5aebcab5jb190bb7bd3c10c4b@mail.gmail.com>
Message-ID: <200804130028.16152.stefan@codeweavers.com>

Am Samstag, 12. April 2008 19:55:53 schrieb H. Verbeet:
> Which is completely irrelevant for classifying the operation.
> Please read the ARB_vertex_program spec, issue 3 and the
> ARB_fragment_program spec, issue 13 to get a better idea of what
> shaders replace and what they don't.
Yes, GL says so, but I think strictly sticking to the GL classification is a 
bad idea, see below.

> If the issue is that you've got an interest in keeping the existing
> structure because you've already written code on top of it there's not
> much point in having this discussion in the first place. If that's not
> the issue, I'd like to mention that the whole point of having
> interfaces is that you can avoid ugliness like setting vertex
> processing state in the fragment processing part of the pipeline.
> There's also nothing forceful about splitting your pipeline in vertex
> and fragment processing, that's how the hardware works, it's how GL
> works, and it's how D3D works.
I agree that GL works that way(fragment-vertex split), and almost certainly 
graphics hardware as well, although we don't know unless we look at the 
drivers(how the hardware works is irrelevant since GL abstracts that). 
However, D3D does *not* work that way, otherwise there would not be any issue 
to discuss here, since then D3D states would perfectly match the GL ones. 

As I understand it, this discussion comes down to the designing the state 
setting interface and implementation in an OpenGL oriented way or a D3D 
oriented way.

@ keeping old code: That's not too much of an issue, but you attacked my 
design on the grounds of a missing implementation of a functionality, so I 
explained how that would be implemented.

> > device->fragment_state_manager->mark_state_dirty(device->fragment_private
> >_data,
> >
> >  > state);
> >
> > Where does "state" come from?
>
> I don't remember you asking, but I see no reason to change the basic
> way dirtification is currently done.
Where does SetRenderState(or any other state setter) know if it has to dirtify 
a fragment, vertex, misc state, or multiples of them?

> >  > if (!use_vs) {
> >  >    
> >  > device->vertex_state_manager->apply_states(device->vertex_private_data
> >  >); }
> > >
> > > ...
> >
> >  This would be done where?
>
> ActivateContext, CTXUSAGE_DRAWPRIM. (Yes it should probably be part of
> the context, not the device, my bad.)
That means polling the states that use_vs() and use_ps() check for changes 
instead of getting notified about changes, as well as polling the 
SetPixelShader and SetVertexShader settings(via select_shader()). Avoiding 
polling was one of the goals of the state management rewrite more than a year 
ago. I don't think there's any relevant performance penalty in doing the 
little polling you suggest, but where do we draw the line?

> The pipeline object would certainly have access to all the information
> required to create such a reordering function, but I fail to see how
> it's relevant at this point. The idea here certainly isn't to
> magically fix all state and shader related issues in wined3d, it's
> just about making fixed function replacement shaders possible in a
> maintainable way.
It is insofar relevant as it affects the issues we can later on fix with the 
pipeline replacement and which we cannot. If the GLSL vertex pipeline 
replacement shader can only write to the builtin varying because the pixel 
shader input expects it that way, we'll never be able to fix the todo_wines 
in fixed_function_varying_test() in visual.c

> ...
> There really is no distinction between "pixel shader private data" and
> "ffp replacement private data", they're both pointers to the same
> block of memory, and eg. the shader backend will always only get
> passed its own private data.
Point taken, I see now how you can sort that out the fixed function 
replacement vs shader activation in the same backend via the private data. 
You'll have to watch out though that the default initialization value is a 
valid "do not load a replacement shader" request.

> I'd also like to note that most of the issues you bring up are not new
> or specific to this design at all, and some of them wouldn't work at
> all with the current structure.
Surely they aren't specific, but I do not see any that would not work with the 
current structure. Agreed, using ATIFS fragment processing + ARBFP / GLSL 
pixel shaders needs 3 inherited ATIFS shader backends, which is ugly, I 
agree. But it does not hide the ugliness and makes the issues that mixing GL 
shader functionality causes explicit. It does not limit the fixed function 
replacement to the lowest common denoimator(GL fixed function) and allows us 
to flexibly use additional features of GL extensions or GLSL to fix bugs we'd 
otherwise have to mark as WONTFIX.

I think designing the state setting interface in a D3D oriented way is better 
because it is opengl extension independent. If the state setting API is built 
on the GL state classifications some additional layer to deal with the 
differences of the state implementations is needed(e.g. by giving vertex, 
fragment and misc state setters a full state table each). Additionally with 
the splitup there is the already discussed hidden issue of implementation 
interactions which I don't think can be consumed in the abstraction layers, 
and the mentioned issue with the lowest common denominator interface of the 
fixed function replacement shaders.


From truiken at gmail.com  Sat Apr 12 17:57:52 2008
From: truiken at gmail.com (James Hawkins)
Date: Sat, 12 Apr 2008 17:57:52 -0500
Subject: Trying to get a grip on how to handle bug reports.
In-Reply-To: <200804130014.58380.kai.blin@gmail.com>
References: <200804130014.58380.kai.blin@gmail.com>
Message-ID: <22821af30804121557t2e560a85ub1d5a9ecc55dbadb@mail.gmail.com>

On Sat, Apr 12, 2008 at 5:14 PM, Kai Blin <kai.blin at gmail.com> wrote:
> Hi folks,
>
>  I seem to have done something wrong referring a user to a closed bug report
>  that seemed to be related to the problem he was having. (See bug 11639 for
>  more context)
>
>  So in order to avoid me being the cause a user defiles the holy status of a
>  closed bug, I'd like to have some clear rules on how to handle related bug
>  reports.
>

It's actually a lot simpler than that.  While we don't want users
filing duplicate bug reports, a bug can't be a duplicate of another
bug that is already fixed.  The right thing to do would be to tell
that user to file a new bug report, referring to the closed bug report
if he really feels like it.  Sure they very well maybe be related, but
the fact remains that one bug is fixed, while another bug is not
fixed.  Thus, they're not the same bug.  By the way, if you really
want to help this situation, I don't recommend the sarcasm.

>  And you folks wonder why we don't have a healthy user community. Sometimes I
>  feel like talking to a brick wall.
>

http://bugs.winehq.org/show_bug.cgi?id=11639#c16
http://bugs.winehq.org/show_bug.cgi?id=11639#c18

Those are links to my comments for the bug report in question.  The
user was told to file a new bug report.  Once the user kept commenting
in the closed bug report (and not filing a new bug report), I told him
to stop posting in a closed bug.  Since when is this not standard?

-- 
James Hawkins


From ivg231 at gmail.com  Fri Apr 11 21:27:01 2008
From: ivg231 at gmail.com (Ivan Gyurdiev)
Date: Fri, 11 Apr 2008 22:27:01 -0400
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <200804111618.49900.stefan@codeweavers.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804110959.56731.stefan@codeweavers.com>
	<d658b69e0804110139n5182168bk54498b4e2ba02a7e@mail.gmail.com>
	<200804111618.49900.stefan@codeweavers.com>
Message-ID: <48001DF5.3050401@gmail.com>

Stefan D?singer wrote:
> Alexandre didn't commit the patch, I think we should come to an agreement on 
> this issue, otherwise it is going to come up again and again.
>   
The fundamental issue is pretty straightforward - not sure why it's so 
difficult to come to an agreement.

    - You want to mix and match vertex and fragment GL backends
    - The only maintainable way to do that is to define an interface 
between vertex and fragment objects

    - You're concerned about the interface constraining the ability of 
fragment to talk to vertex
    - Write a smarter interface, I also suggested an object to manage it 
(linker).

You can't have it both ways - ability to mix and match backends, and 
unconstrained interface. The interface doesn't have to be "the lowest 
common denominator" - it could be the highest common denominator if 
properly written. As Henri pointed out the fact that both GL and the 
hardware are vertex/fragment aligned naturally suggests we should break 
up things the same way. Even the D3D programmable pipeline is broken up 
this way (there are Pixel and Vertex shader objects) - and the fixed 
pipeline is going away, so if anything we should move away from its 
interface.

    - You want to replace the fixed pipeline using GL shaders.
    - Then replace the fixed pipeline - this has nothing to do with the 
programmable pipeline, therefore should not affect any programmable 
pipeline interfaces.

You've pointed out that shader_backend_t is more aligned to a GL 
extension than it is to a D3D shader. If that's the case I see little 
value to having that interface - it will just cause confusion as 
unrelated functionalities are packed into it. The disparity between GL 
extensions will get greater as we try to add new features using a 
particular extension, and we'll see a lot of functions that are just 
empty forwards to other "shader backends", since they don't support 
something themselves.

Ivan



From dmitry at codeweavers.com  Sun Apr 13 00:51:23 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sun, 13 Apr 2008 14:51:23 +0900
Subject: wine.info add fake dlls for msacm32.drv and midimap.dll
References: <19e31a080804122129j75bc068cr1fe1e023e05aa011@mail.gmail.com>
Message-ID: <024001c89d2a$698bdc60$a600fea9@DMITRY>

"Steven Edwards" <winehacker at gmail.com> wrote:

> trace:winmm:DllMain 0x7e250000 0x1 (nil)
> trace:winmm:MMDRV_Init () trace:winmm:MMDRV_Install
> ('winealsa.drv', 'winealsa.drv', mapper=N);
> warn:winmm:MMDRV_Install Couldn't open driver 'winealsa.drv'
> trace:winmm:MMDRV_Install ('wineoss.drv', 'wineoss.drv',
> mapper=N); warn:winmm:MMDRV_Install Couldn't open driver 'wineoss.drv'
> trace:winmm:MMDRV_Install ('winecoreaudio.drv',
> 'winecoreaudio.drv', mapper=N); warn:winmm:MMDRV_Install
> Couldn't open driver 'winecoreaudio.drv'
> trace:winmm:MMDRV_Install ('wavemapper', 'msacm32.drv',
> mapper=Y); warn:winmm:MMDRV_Install Couldn't open driver 'msacm32.drv'
> trace:winmm:MMDRV_Install ('midimapper', 'midimap.dll',
> mapper=Y); warn:winmm:MMDRV_Install Couldn't open driver 'midimap.dll'
> 
> With this patch the firefox thinstall demo bug 10905 now works. I
> expect there may be other problems with other thinstall applications
> as he thinks there may be some changes that need to be done on their
> end to better accommodate Wine. I don't know if this really should be
> the case as it works on Windows and we should try to mimic that
> behavior.

DLLs are being added to wine.inf only if an app does check for a dll
existence, which is not the case here. You need to investigate further
what is going on.

-- 
Dmitry.


From winehacker at gmail.com  Sun Apr 13 00:56:29 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Sun, 13 Apr 2008 01:56:29 -0400
Subject: wine.info add fake dlls for msacm32.drv and midimap.dll
In-Reply-To: <024001c89d2a$698bdc60$a600fea9@DMITRY>
References: <19e31a080804122129j75bc068cr1fe1e023e05aa011@mail.gmail.com>
	<024001c89d2a$698bdc60$a600fea9@DMITRY>
Message-ID: <19e31a080804122256h6b4a5534m6b61acae87f8c479@mail.gmail.com>

Hi,

On Sun, Apr 13, 2008 at 1:51 AM, Dmitry Timoshkov
<dmitry at codeweavers.com> wrote:
>  DLLs are being added to wine.inf only if an app does check for a dll
>  existence, which is not the case here. You need to investigate further
>  what is going on.

This is what Ge said

--

I dug a bit deeper and understand what's going on now. Winmm (in driver.c)
will try to load the low-level drivers using LoadLibrary. Thinstall
intercepts that LoadLibrary call and tries to locate the driver, e.g.
wineoss.drv, using the normal Windows search path for DLLs. We can't find
the file because its not stored in the "normal" places like
C:\Windows\System32 but in the build tree. So we fail the load and return
error code 2 (ERROR_FILE_NOT_FOUND). Wine's LoadLibrary knows where to
search in the build tree and would have no problem locating it.

Unfortunately, we can't just pass the call on the Windows (or rather Wine)
if we can't find a file. The reason we can't find a file might be that the
application has deleted it. When a virtualized app deletes a file, we don't
really delete the file but mark it internally as deleted. If we pass on a
LoadLibrary call to Windows on a file that doesn't exist as far as the app
is concerned, Windows would still happily load it (we only hide the file
from the app, not from Windows).

--

If I understand the issue correctly the problem is in Wine. The
application works on Windows no problem. The Thinstall LoadLibrary
hook can't be expected to know about builtin dlls if its searching the
default directories or looking up KnownDLLs in the registry and they
are not there, then failure is by design.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From winehacker at gmail.com  Sun Apr 13 00:57:07 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Sun, 13 Apr 2008 01:57:07 -0400
Subject: wine.info add fake dlls for msacm32.drv and midimap.dll
In-Reply-To: <19e31a080804122256h6b4a5534m6b61acae87f8c479@mail.gmail.com>
References: <19e31a080804122129j75bc068cr1fe1e023e05aa011@mail.gmail.com>
	<024001c89d2a$698bdc60$a600fea9@DMITRY>
	<19e31a080804122256h6b4a5534m6b61acae87f8c479@mail.gmail.com>
Message-ID: <19e31a080804122257k21435dc0w65e76e9084651a8@mail.gmail.com>

On Sun, Apr 13, 2008 at 1:56 AM, Steven Edwards <winehacker at gmail.com> wrote:

>  If I understand the issue correctly the problem is in Wine. The
>  application works on Windows no problem. The Thinstall LoadLibrary
>  hook can't be expected to know about builtin dlls if its searching the
>  default directories or looking up KnownDLLs in the registry and they
>  are not there, then failure is by design.

This part was my thoughts on the subject.



-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From dank at kegel.com  Sun Apr 13 00:58:45 2008
From: dank at kegel.com (Dan Kegel)
Date: Sat, 12 Apr 2008 22:58:45 -0700
Subject: Trying to get a grip on how to handle bug reports.
Message-ID: <a71bd89a0804122258s5e9e9a11i417729a30feb762b@mail.gmail.com>

James wrote:
> [ http://bugs.winehq.org/show_bug.cgi?id=11639#c15 et seq.]
> Once the user kept commenting
> in the closed bug report (and not filing a new bug report), I told him
> to stop posting in a closed bug.  Since when is this not standard?

The problem is, the user felt he was treated rudely:
"I will report a new bug, but don't treat me like i'm an
idiot or someone who deliberatly is spamming in closed bug reports."
and I tend to agree.  In this case, the user didn't need
education, he just needed to be gently told that
a new bug needs to be filed.
- Dan


From dmitry at codeweavers.com  Sun Apr 13 05:46:08 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sun, 13 Apr 2008 19:46:08 +0900
Subject: urlmon: add stub for CoInternetSetFeatureEnabled
References: <784229.68185.qm@web23202.mail.ird.yahoo.com>
Message-ID: <003301c89d53$97751be0$a600fea9@DMITRY>

"Louis. Lenders" <xerox_xerox2000 at yahoo.co.uk> wrote:

> +HRESULT WINAPI  CoInternetSetFeatureEnabled(INTERNETFEATURELIST Feature, DWORD flags, BOOL fEnable)
> +{
> +    FIXME("%p, 0x%08x, %x, stub\n", &Feature, flags, fEnable);
> +    return E_NOTIMPL;
> +}
> diff --git a/dlls/urlmon/urlmon.spec b/dlls/urlmon/urlmon.spec
> index 1fa2f94..e89e049 100644
> --- a/dlls/urlmon/urlmon.spec
> +++ b/dlls/urlmon/urlmon.spec
> @@ -19,6 +19,7 @@
> @ stdcall CoInternetGetSession(long ptr long)
> @ stdcall CoInternetParseUrl(wstr long long wstr long ptr long)
> @ stdcall CoInternetQueryInfo(ptr long long ptr long ptr long)
> +@ stdcall CoInternetSetFeatureEnabled(ptr long long)

The first parameter of CoInternetSetFeatureEnabled is not a pointer even
if you pretend it is in the FIXME. Also Please use consistent spacing and
naming of variables (preferring 1 space and no hungarian/upper cased names).

-- 
Dmitry.


From bmschwar at fas.harvard.edu  Sun Apr 13 10:07:14 2008
From: bmschwar at fas.harvard.edu (Benjamin M. Schwartz)
Date: Sun, 13 Apr 2008 11:07:14 -0400
Subject: Desktop, x11drv, and _NET_WM_WINDOW_TYPE_DIALOG
Message-ID: <480221A2.8030403@fas.harvard.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

According to xprop, Wine is creating the desktop window with
_NET_WM_WINDOW_TYPE = _NET_WM_WINDOW_TYPE_DIALOG.  This is problematic for
me, because of the way my window manager (Matchbox) handles dialogs.  Is
there a reason that the desktop is not _NET_WM_WINDOW_TYPE_NORMAL?

I have tried to trace this through the code, and I wind up at
x11drv/desktop.c, but I don't see any reference to DIALOG there.
Alternatively, perhaps it is set with MAKEINTATOM at the top of
explorer/desktop.c, but I'm not sure how to interpret that constant.

- --Ben
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.7 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFIAiGiUJT6e6HFtqQRAvgmAJ0XJohI9u7VYzorTgKenG1qJpJzeACdEiqR
dUAVRyREOtjfx/bAgrUUeQ8=
=PkkE
-----END PGP SIGNATURE-----


From tony.wasserka at freenet.de  Sun Apr 13 11:22:29 2008
From: tony.wasserka at freenet.de (tony.wasserka at freenet.de)
Date: Sun, 13 Apr 2008 18:22:29 +0200
Subject: d3dx9_36: Add stubs and implementations for D3DXCreateTexturexx
Message-ID: <E1Jl4yL-00045q-1D@www19.emo.freenet-rz.de>

Hi,
Are you still working on the texture functions?
I'd need them for completing my ID3DXSprite implementation,
so if you don't mind I could complete your started patches.

Best regards,
    Tony




Unbegrenzter Speicher, Top-Spamschutz, 120 SMS und eigene E-MailDomain inkl.
http://office.freenet.de/dienste/emailoffice/produktuebersicht/power/mail/index.html



From winehacker at gmail.com  Sun Apr 13 12:11:41 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Sun, 13 Apr 2008 13:11:41 -0400
Subject: Including Mono within a Wine package - should Wine expect this?
In-Reply-To: <20080411125059.293230@gmx.net>
References: <a71bd89a0804100645y2b7f9c94n719ab5f19374db04@mail.gmail.com>
	<47FECF9E.1030309@open-vote.org>
	<a71bd89a0804101954w31a24e2fn72c027796b771a6e@mail.gmail.com>
	<47FF506D.4010102@open-vote.org> <20080411125059.293230@gmx.net>
Message-ID: <19e31a080804131011s11342880qd0ee9d2981a1c9be@mail.gmail.com>

On Fri, Apr 11, 2008 at 8:50 AM, Roderick Colenbrander
<thunderbird2k at gmx.net> wrote:
>  For a part the issue is that lots of programs are hybrid ones. Some of them behave 'nicely' in the way they just call a few functions from a native win32 dll. I think apps that embed COM objects (like a Word viewer, ..) are worse as mono doesn't offer this at all. The most problematic thing is that mono's windows.forms is fully managed while microsoft just layered it on top of gdi32/gdiplus/user32. This allows you to use standard win32 apis on most windows.forms controls to override behavior. A lot of apps do this, so even if you could access native win32 dlls, magic like this won't work at all. Second COM objects might also rely on evil win32 magic.

Rather than ignoring mono these issues make it sound like Wine and
mono should try to work together again. The EULA for the .NET runtime
prohibits distributing it and using it on non-windows licensed systems
so we are in much the same legal situation with IE where we have to
have a replacement.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From wine-devel at kievinfo.com  Sun Apr 13 12:54:53 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sun, 13 Apr 2008 11:54:53 -0600
Subject: loader: print a better message about reserving memory
In-Reply-To: <b6bb06270804122057n31449f68l6767edff89c1256e@mail.gmail.com>
References: <b6bb06270804122057n31449f68l6767edff89c1256e@mail.gmail.com>
Message-ID: <480248ED.1090207@kievinfo.com>

Austin English wrote:
> With ubuntu updating to the 2.6.24 kernel, a lot more people are
> running into errors about reserving memory. This patch adds a
> suggestion to check  /etc/sysctl.conf.
> 
> You may need to edit /etc/sysctl.conf to give Wine access to this memory.\n",

Can you be more specific what did Ubuntu do to break Wine?

Vitaliy.


From wine-devel at kievinfo.com  Sun Apr 13 13:07:29 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sun, 13 Apr 2008 12:07:29 -0600
Subject: dinput: Convert keyboard buffer from internal data format to
	user data format
In-Reply-To: <4802384D.1090704@gmail.com>
References: <4802384D.1090704@gmail.com>
Message-ID: <48024BE1.1090008@kievinfo.com>

Sergey Khodych wrote:
> 
> 
> 
Any particular reason for this? Do you have a program that sets different 
data format? The reason I ask - copying 256 bytes is much faster then 
iterating over the whole data format and copying one byte at a time.

Vitaliy.


From wine-devel at kievinfo.com  Sun Apr 13 13:15:30 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sun, 13 Apr 2008 12:15:30 -0600
Subject: dinput: Implement DIPROP_KEYNAME property for keyboard device
In-Reply-To: <48023854.9020308@gmail.com>
References: <48023854.9020308@gmail.com>
Message-ID: <48024DC2.3020008@kievinfo.com>

Sergey Khodych wrote:
> 
> 
> ------------------------------------------------------------------------
> 
> 

> +static HRESULT WINAPI SysKeyboardAImpl_GetProperty(
> ...
> +    if (TRACE_ON(dinput))
> +        _dump_DIPROPHEADER(pdiph);
Please drop the TRACE_ON check - it's being done in dump function.

> ...
> +                hr = SysKeyboardWImpl_GetObjectInfo( (LPDIRECTINPUTDEVICE8W)iface , &didoi,
> +                                                     ps->diph.dwObj, ps->diph.dwHow );

You mixing unicode and ascii. Also if you are implementing 
SysKeyboardAImpl_GetProperty you should also implement it's unicode 
counterpart SysKeyboardWImpl_GetProperty.

And please use 4-space indent.

Vitaliy.


From luis.busquets at ilidium.com  Sun Apr 13 13:41:05 2008
From: luis.busquets at ilidium.com (Luis Busquets)
Date: Sun, 13 Apr 2008 20:41:05 +0200
Subject: d3dx9_36: Add stubs and implementations for D3DXCreateTexturexx
In-Reply-To: <E1Jl4yL-00045q-1D@www19.emo.freenet-rz.de>
References: <E1Jl4yL-00045q-1D@www19.emo.freenet-rz.de>
Message-ID: <480253C1.9010604@ilidium.com>

The files that I have for textures are attached.

tony.wasserka at freenet.de escribi?:
> Hi,
> Are you still working on the texture functions?
> I'd need them for completing my ID3DXSprite implementation,
> so if you don't mind I could complete your started patches.
>
> Best regards,
>     Tony
>
>
>
>
> Unbegrenzter Speicher, Top-Spamschutz, 120 SMS und eigene E-MailDomain inkl.
> http://office.freenet.de/dienste/emailoffice/produktuebersicht/power/mail/index.html
>
>   

-------------- next part --------------
A non-text attachment was scrubbed...
Name: cubetexture.c
Type: text/x-csrc
Size: 3357 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080413/4a09b2e4/attachment.c 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: texture.c
Type: text/x-csrc
Size: 1932 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080413/4a09b2e4/attachment-0001.c 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: volumetexture.c
Type: text/x-csrc
Size: 2049 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080413/4a09b2e4/attachment-0002.c 

From alexd4 at inbox.lv  Sun Apr 13 14:01:38 2008
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Sun, 13 Apr 2008 22:01:38 +0300
Subject: Trying to get a grip on how to handle bug reports.
In-Reply-To: <22821af30804121557t2e560a85ub1d5a9ecc55dbadb@mail.gmail.com>
References: <200804130014.58380.kai.blin@gmail.com>
	<22821af30804121557t2e560a85ub1d5a9ecc55dbadb@mail.gmail.com>
Message-ID: <48025892.3090502@inbox.lv>

James Hawkins wrote:
> On Sat, Apr 12, 2008 at 5:14 PM, Kai Blin <kai.blin at gmail.com> wrote:
>> Hi folks,
>>
>>  I seem to have done something wrong referring a user to a closed bug report
>>  that seemed to be related to the problem he was having. (See bug 11639 for
>>  more context)
>>
>>  So in order to avoid me being the cause a user defiles the holy status of a
>>  closed bug, I'd like to have some clear rules on how to handle related bug
>>  reports.
>>
> 
> It's actually a lot simpler than that.  While we don't want users
> filing duplicate bug reports, a bug can't be a duplicate of another
> bug that is already fixed.  The right thing to do would be to tell
> that user to file a new bug report, referring to the closed bug report
> if he really feels like it.  Sure they very well maybe be related, but
> the fact remains that one bug is fixed, while another bug is not
> fixed.  Thus, they're not the same bug.  By the way, if you really
> want to help this situation, I don't recommend the sarcasm.
> 
>>  And you folks wonder why we don't have a healthy user community. Sometimes I
>>  feel like talking to a brick wall.
>>
> 
> http://bugs.winehq.org/show_bug.cgi?id=11639#c16
> http://bugs.winehq.org/show_bug.cgi?id=11639#c18
> 
> Those are links to my comments for the bug report in question.  The
> user was told to file a new bug report.  Once the user kept commenting
> in the closed bug report (and not filing a new bug report), I told him
> to stop posting in a closed bug.  Since when is this not standard?
> 

I think bugzilla operators are a bit too trigger happy lately, in particular 
with abandoning bugs. For example: http://bugs.winehq.org/show_bug.cgi?id=12437

"The tests aren't time consuming, but if you choose to not do the tests, we'll
have to close this bug as abandoned."

And there's a link mentioned in comments to downloadable trial that can 
(reportedly) be used to reproduce. Sure, the user should've filled the URL 
field. But, it's pointless to expect users to 1) do everything right 2) follow 
their bugs indefinitely (sometimes for years). 3) always be willing to do time 
consuming and otherwise demanding operations like regression test.

If a user submitted enough info to make it possible for developer to reproduce 
or otherwise make sense of a bug, he has already done a commendable job. IMHO 
care should be taken not to "abandon" bugs without good reason, such as bug 
description that makes no sense, absence of any useful logs and obscure app for 
which no download can be googled and user not responding for a long period of time.


From stefan at codeweavers.com  Sun Apr 13 14:26:19 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sun, 13 Apr 2008 21:26:19 +0200
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <48001DF5.3050401@gmail.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804111618.49900.stefan@codeweavers.com>
	<48001DF5.3050401@gmail.com>
Message-ID: <200804132126.19422.stefan@codeweavers.com>

Am Samstag, 12. April 2008 04:27:01 schrieb Ivan Gyurdiev:
> Stefan D?singer wrote:
> > Alexandre didn't commit the patch, I think we should come to an agreement
> > on this issue, otherwise it is going to come up again and again.
>
> The fundamental issue is pretty straightforward - not sure why it's so
> difficult to come to an agreement.
>
>     - You want to mix and match vertex and fragment GL backends
>     - The only maintainable way to do that is to define an interface
> between vertex and fragment objects
I certainly see the advantages of a constrained interface, I just don't 
see(and still don't see) how it can be designed cleanly without greatly 
limiting functionality of the pipeline / shader implementation.

I discussed the topic with Henri on IRC again(@Henri: Please correct me if I 
missunderstood you), and he explained that his plans consider making GLSL 
vertex shaders, GLSL vertex replacement, GLSL fragment replacement and GLSL 
fragment replacement one object with different interfaces. So we can have 
backchannel communication between the various interface implementations(e.g. 
flags or private data) which keeps everything flexible. It's not precisely 
nice(backchannel communication somewhat defeats the point of interfaces), but 
my design has ugliness as well, so I can live with that.

What's most important to me about this is that we don't have to close any bug 
as WONTFIX due to design constraints. So I can stop feeling strongly against 
splitting up the interface since the implementations remain the same.

Now the main issue with not splitting up the interfaces I see is that it is 
unclear what code in state.c(or the shader backend's state table) changes 
which GL state. If state_something changes both vertex and fragment GL states 
I can't overwrite it properly in the ATIFS/NVRC code without messing with the 
vertex side as well.

I have a few remaining issues though:
-> With splitting up the state table there are now 5 "root" states which have 
to be polled for changes in CTXUSAGE_DRAWPRIM setting, also the 
GL_TEXTURE_SHADER_NV and GL_FRAGMENT_SHADER_ATI states need to be polled for 
enabling/disabling. Is there no way to avoid that?

-> Some cross pipeline part communication issues are still remaining, see 
below

-> Increased state dirtification complexity: Now each Set*State has to find 
out which part of the pipeline it has to dirtify(a switch-case statement or 
probably table referencing), and has to dirtify up to 3 pipelines. That's not 
precicely going to help performance.

I know that Ivan doesn't really care about that, especially since it's not an 
algorithmic complexity change. However, performance is a top priority issue, 
and no gamer will accept the next-gen hardware excuse for inefficient code.

I mainly want to avoid more bad PR like this:
http://www.phoronix.com/scan.php?page=article&item=938
http://www.phoronix.com/scan.php?page=article&item=crossover_games

The 2nd article would be good for me if it was due to a tuneup in cxgames, but 
it is a regression in wine instead. Yes, that's phoronix and all, and the 
first article's regressions are technically perfectly explainable. Still new 
features don't have to come with performance costs. I have a ~5% performance 
regression myself which I don't know where it comes from.

So I propose the following plan:

1) We commit the patch to fix fglrx

2) We keep the shader / ffp interface as it is for Wine 1.0. We freeze in two 
weeks. I am away for one week now, so if anyone wants any shader interface 
changes in 1.0 he'll have to do it himself

3) We investigate where the recent performance regression(s) came from

4) We audit the state handlers in state.c and find out which D3D state handler 
changes which parts of the GL pipeline and find states that touch more than 
one part and why.

5) Build a battle plan how to separate the following D3D states in various GL 
pipeline parts:

-> Vertex shaders - streams. The tricky part here is that the fixed function 
GL vertex pipeline needs named arrays, while an ARB/GLSL vertex pipeline 
needs numbered arrays(otherwise no vertex blending emulation). How do we 
communicate the need for numbered arrays, and the choosen assignment?

-> vertex decl - loaded pointers. We're currently checking the vertex shader 
and fog states when a vertex buffer offset it changed, that is not needed

-> Samplers - GL_TEXTURE_xD enable - colorop. That's a major pain for ATIFS 
and even more NVTS. I haven't found a nicer implementation using split up 
interfaces

-> How do we deal with the depth blit shaders? Do they belong to the shader 
backend, or to something else?

-> Should we move the SetupForBlit to some of the shader code? The blitting 
and state switching might be more efficient if we're using shaders for it and 
just set a ARB / GLSL shader instead of falling back to the absolute low 
level limit and killing all states

-> Texture transform flags, clipping, more?

My ultimate hope is to have a clean assignment for each code referenced by the 
state table to the pipeline part, so instead of splitting up the state table 
in code we have a programming guidelines about which part of the state table 
may be changed by which pipeline replacement to avoid the additional run-time 
costs. If that turns out to be impossible we need a clear assignment anyway 
for a splitup.

6) Investigate the performance implications of the state management, state 
polling, the current conditional state linking state dirtification checks and 
the driver side cost of fixed function state changing while a 

What are your opinions? (btw, I don't think I can implement that stuff alone 
anytime soon, I am pretty busy the next months)

> Even the D3D programmable pipeline is broken up 
> this way (there are Pixel and Vertex shader objects) - and the fixed 
> pipeline is going away, so if anything we should move away from its 
> interface.
One could argue that the name "pixel shader" already shows that Direct3D does 
not separate the pipeline parts properly(GL_NV_texture_shader, issue 1). 
Ironically pixel processing is one of the only remaining parts of Direct3D10 
that is not programmable.


From dank at kegel.com  Sun Apr 13 14:28:33 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 13 Apr 2008 12:28:33 -0700
Subject: Including Mono within a Wine package - should Wine expect this?
In-Reply-To: <19e31a080804131011s11342880qd0ee9d2981a1c9be@mail.gmail.com>
References: <a71bd89a0804100645y2b7f9c94n719ab5f19374db04@mail.gmail.com>
	<47FECF9E.1030309@open-vote.org>
	<a71bd89a0804101954w31a24e2fn72c027796b771a6e@mail.gmail.com>
	<47FF506D.4010102@open-vote.org> <20080411125059.293230@gmx.net>
	<19e31a080804131011s11342880qd0ee9d2981a1c9be@mail.gmail.com>
Message-ID: <a71bd89a0804131228w188ecd20r9802c35198b25764@mail.gmail.com>

On Sun, Apr 13, 2008 at 10:11 AM, Steven Edwards <winehacker at gmail.com> wrote:
>  Rather than ignoring mono these issues make it sound like Wine and
>  mono should try to work together again. The EULA for the .NET runtime
>  prohibits distributing it and using it on non-windows licensed systems
>  so we are in much the same legal situation with IE where we have to
>  have a replacement.

Yes, exactly.  I've been discussing this a bit on the mono list.

There are two big pieces of work needed:
1) support for mixed assemblies in Mono for Windows
2) porting Mono's WinForms on top of Wine gdiplus
instead of Mono gdiplus (and making it more win32-ish as
a result)

This would be a fine summer project for somebody properly motivated.

There will be more incentive to do this as we get Microsoft .NET working
better, and it becomes clearer just how many applications need one
or the other of the two items above to run.

In short: I think the path to Mono+Wine nivana at the moment leads
directly through enemy territory: we have to get MS .net working better first
before it's clear it'll be worth it.
- Dan


From truiken at gmail.com  Sun Apr 13 14:28:15 2008
From: truiken at gmail.com (James Hawkins)
Date: Sun, 13 Apr 2008 14:28:15 -0500
Subject: Trying to get a grip on how to handle bug reports.
In-Reply-To: <48025892.3090502@inbox.lv>
References: <200804130014.58380.kai.blin@gmail.com>
	<22821af30804121557t2e560a85ub1d5a9ecc55dbadb@mail.gmail.com>
	<48025892.3090502@inbox.lv>
Message-ID: <22821af30804131228j7cd7d16cva450906cb2f0b54@mail.gmail.com>

On Sun, Apr 13, 2008 at 2:01 PM, Alexander Dorofeyev <alexd4 at inbox.lv> wrote:
>
> James Hawkins wrote:
>  > On Sat, Apr 12, 2008 at 5:14 PM, Kai Blin <kai.blin at gmail.com> wrote:
>  >> Hi folks,
>  >>
>  >>  I seem to have done something wrong referring a user to a closed bug report
>  >>  that seemed to be related to the problem he was having. (See bug 11639 for
>  >>  more context)
>  >>
>  >>  So in order to avoid me being the cause a user defiles the holy status of a
>  >>  closed bug, I'd like to have some clear rules on how to handle related bug
>  >>  reports.
>  >>
>  >
>  > It's actually a lot simpler than that.  While we don't want users
>  > filing duplicate bug reports, a bug can't be a duplicate of another
>  > bug that is already fixed.  The right thing to do would be to tell
>  > that user to file a new bug report, referring to the closed bug report
>  > if he really feels like it.  Sure they very well maybe be related, but
>  > the fact remains that one bug is fixed, while another bug is not
>  > fixed.  Thus, they're not the same bug.  By the way, if you really
>  > want to help this situation, I don't recommend the sarcasm.
>  >
>  >>  And you folks wonder why we don't have a healthy user community. Sometimes I
>  >>  feel like talking to a brick wall.
>  >>
>  >
>  > http://bugs.winehq.org/show_bug.cgi?id=11639#c16
>  > http://bugs.winehq.org/show_bug.cgi?id=11639#c18
>  >
>  > Those are links to my comments for the bug report in question.  The
>  > user was told to file a new bug report.  Once the user kept commenting
>  > in the closed bug report (and not filing a new bug report), I told him
>  > to stop posting in a closed bug.  Since when is this not standard?
>  >
>
>  I think bugzilla operators are a bit too trigger happy lately, in particular
>  with abandoning bugs. For example: http://bugs.winehq.org/show_bug.cgi?id=12437
>
>  "The tests aren't time consuming, but if you choose to not do the tests, we'll
>  have to close this bug as abandoned."
>

Can we all stop with the sensationalist comments?  Seriously.  If
you'll actually read what I said, I made no threats, nor was I rude.
I also didn't change the resolution of the bug, so where's the
trigger-pulling you refer to?  The only mistake I made, which was a
mistake on the part of everyone triaging this bug, was that I didn't
know the bug was freely reproducible.  That's the worst I did, and
that's not a big deal, and certainly not worth your reply.

>  And there's a link mentioned in comments to downloadable trial that can
>  (reportedly) be used to reproduce. Sure, the user should've filled the URL
>  field. But, it's pointless to expect users to 1) do everything right 2) follow
>  their bugs indefinitely (sometimes for years). 3) always be willing to do time
>  consuming and otherwise demanding operations like regression test.
>

On behalf of the regular bugzilla moderators (of which there are very
few), I'll go over the policy we have in place to keep, or strive to
attain, a manageable bugzilla database.  There are only a few
conditions that warrant abandoning a bug:

a) the bug must not be freely reproducible
b) the reporter has not responded to a request for more information in
at least 3 months, or
c) the reporter will not or can not provide the information requested,
usually not doing the regression testing

If you have a problem with any of these policies, bring it up in
wine-devel, but don't single me out.  We devote so much of our free
time to keep our bugzilla manageable, and a big part of that is
weeding out bugs which we can do nothing about (abandoned).

>  If a user submitted enough info to make it possible for developer to reproduce
>  or otherwise make sense of a bug, he has already done a commendable job. IMHO
>  care should be taken not to "abandon" bugs without good reason, such as bug
>  description that makes no sense, absence of any useful logs and obscure app for
>  which no download can be googled and user not responding for a long period of time.
>

Besides the reproducible part of this last paragraph, you're
describing an invalid bug, not abandoned.

-- 
James Hawkins


From dank at kegel.com  Sun Apr 13 14:37:15 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 13 Apr 2008 12:37:15 -0700
Subject: Trying to get a grip on how to handle bug reports.
Message-ID: <a71bd89a0804131237na75a460kfb7a494d866f8467@mail.gmail.com>

James wrote:
> If you'll actually read what I said, I made no threats, nor was I rude.

IMHO the cumulative attitude of your comments, especially

http://bugs.winehq.org/show_bug.cgi?id=11639#c18
Stop posting in a closed bug report!  You've already been told to open a new
bug report..

was in fact somewhat rude.
- Dan


From dank at kegel.com  Sun Apr 13 14:43:09 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 13 Apr 2008 12:43:09 -0700
Subject: loader: print a better message about reserving memory
Message-ID: <a71bd89a0804131243x4aab745dv1fd9eab359b6c7b1@mail.gmail.com>

Vitaliy wrote:
>Austin English wrote:
>> With ubuntu updating to the 2.6.24 kernel, a lot more people are
>> running into errors about reserving memory. This patch adds a
>> suggestion to check  /etc/sysctl.conf.
>>
>> You may need to edit /etc/sysctl.conf to give Wine access to this memory.\n",
>
>Can you be more specific what did Ubuntu do to break Wine?

It would have been helpful if Austin had linked to the bug report
from his patch.  I went and filed a (very well documented :-) bug report
http://bugs.winehq.org/show_bug.cgi?id=12548
that turned out to be a dup of the one Austin had been discussing
the bug in.

Austin's patch is helpful, but I think we can do better.  For instance,
we could ship a helper app that pops up a gui
and asks whether the user wants us to work around the problem
(by doing  gksudo sysctl -w vm.mmap_min_addr=0, say)
and run it in the preloader if we can't map the lowest page.


From kornelpal at gmail.com  Sun Apr 13 14:55:28 2008
From: kornelpal at gmail.com (=?iso-8859-1?B?S29ybulsIFDhbA==?=)
Date: Sun, 13 Apr 2008 21:55:28 +0200
Subject: Including Mono within a Wine package - should Wine expect this?
References: <a71bd89a0804100645y2b7f9c94n719ab5f19374db04@mail.gmail.com><47FECF9E.1030309@open-vote.org><a71bd89a0804101954w31a24e2fn72c027796b771a6e@mail.gmail.com><47FF506D.4010102@open-vote.org>
	<20080411125059.293230@gmx.net><19e31a080804131011s11342880qd0ee9d2981a1c9be@mail.gmail.com>
	<a71bd89a0804131228w188ecd20r9802c35198b25764@mail.gmail.com>
Message-ID: <002601c89da0$54349700$c542ee55@kornelpal.hu>

Hi,

> 1) support for mixed assemblies in Mono for Windows

I'm trying to do some work on that.

> 2) porting Mono's WinForms on top of Wine gdiplus
> instead of Mono gdiplus (and making it more win32-ish as
> a result)

Mono is using MS GDI+ on Windows since it uses GDI+. Mono's libgdiplus is 
only used on non-Windows platforms. If Wine's GDI+ is not supported by Mono 
(I haven't tried) it's Wine's GDI+ that has to be fixed because Mono works 
perfectly with MS GDI+.

I also suggested on mono-devel-list that process creation and module loading 
for managed modules should be supported by ntdll.dll via callbacks to 
mscoree.dll as described in
http://lists.ximian.com/pipermail/mono-devel-list/2008-April/027491.html

Korn?l 



From austinenglish at gmail.com  Sun Apr 13 15:24:51 2008
From: austinenglish at gmail.com (Austin English)
Date: Sun, 13 Apr 2008 15:24:51 -0500
Subject: loader: print a better message about reserving memory
In-Reply-To: <a71bd89a0804131243x4aab745dv1fd9eab359b6c7b1@mail.gmail.com>
References: <a71bd89a0804131243x4aab745dv1fd9eab359b6c7b1@mail.gmail.com>
Message-ID: <b6bb06270804131324k675bea62nfe006c02f41f6d50@mail.gmail.com>

On Sun, Apr 13, 2008 at 2:43 PM, Dan Kegel <dank at kegel.com> wrote:
> Vitaliy wrote:
>  >Austin English wrote:
>  >> With ubuntu updating to the 2.6.24 kernel, a lot more people are
>  >> running into errors about reserving memory. This patch adds a
>  >> suggestion to check  /etc/sysctl.conf.
>  >>
>  >> You may need to edit /etc/sysctl.conf to give Wine access to this memory.\n",
>  >
>  >Can you be more specific what did Ubuntu do to break Wine?
>
>  It would have been helpful if Austin had linked to the bug report
>  from his patch.  I went and filed a (very well documented :-) bug report
>
> http://bugs.winehq.org/show_bug.cgi?id=12548
>  that turned out to be a dup of the one Austin had been discussing
>  the bug in.
>
>  Austin's patch is helpful, but I think we can do better.  For instance,
>  we could ship a helper app that pops up a gui
>  and asks whether the user wants us to work around the problem
>  (by doing  gksudo sysctl -w vm.mmap_min_addr=0, say)
>  and run it in the preloader if we can't map the lowest page.
>
>
>

I had started to notice it whenever ubuntu upgraded the hardy kernel
to 2.6.24. A helper app would be good, but in the meantime, I think a
link to a wiki page with links to the bug #'s, etc would be helpful. I
wrote the patch before your (very detailed :-D) report, however.


From r.kalbermatter at hccnet.nl  Sun Apr 13 15:28:16 2008
From: r.kalbermatter at hccnet.nl (Rolf Kalbermatter)
Date: Sun, 13 Apr 2008 22:28:16 +0200
Subject: Trouble in compiling Wine 0.9.57 and 0.9.58 on Solaris 10 08/07
In-Reply-To: <47FF74FD.4060307@sun.com>
References: <47FF74FD.4060307@sun.com>
Message-ID: <00a101c89da4$e7f77210$4001a8c0@NATERS>

Petr Sumbera [mailto:Petr.Sumbera at Sun.COM] 

>  >isinf is a function / macro which returns wether or not a 
> float is positive  >infinite or negative infinite. I think it 
> is a standard C function. Maybe  >solaris declares it in some 
> header that needs to be included, like math.h?
> 
> I have logged for this bug: 
> http://bugs.winehq.org/show_bug.cgi?id=12008
> 
> Not sure where to find it exactly. But isinf seems to be 
> defined by ISO
> 99 (not by standard C).

Following link might give some details about Sun Solaris support of
infinintes
and also ideas how to solve that problem.

http://www.google.nl/codesearch?q=isinf&ie=UTF-8&oe=utf-8&rls=org.mozilla:en
-US:official&client=firefox-a&um=1&sa=X&oi=codesearch_group&resnum=4&ct=titl
e

Rolf Kalbermatter



From dank at kegel.com  Sun Apr 13 15:50:58 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 13 Apr 2008 13:50:58 -0700
Subject: Including Mono within a Wine package - should Wine expect this?
In-Reply-To: <002601c89da0$54349700$c542ee55@kornelpal.hu>
References: <a71bd89a0804100645y2b7f9c94n719ab5f19374db04@mail.gmail.com>
	<47FECF9E.1030309@open-vote.org>
	<a71bd89a0804101954w31a24e2fn72c027796b771a6e@mail.gmail.com>
	<47FF506D.4010102@open-vote.org> <20080411125059.293230@gmx.net>
	<19e31a080804131011s11342880qd0ee9d2981a1c9be@mail.gmail.com>
	<a71bd89a0804131228w188ecd20r9802c35198b25764@mail.gmail.com>
	<002601c89da0$54349700$c542ee55@kornelpal.hu>
Message-ID: <a71bd89a0804131350o4935bf68n1de7253d00ab1e6e@mail.gmail.com>

On Sun, Apr 13, 2008 at 12:55 PM, Korn?l P?l <kornelpal at gmail.com> wrote:
> > 1) support for mixed assemblies in Mono for Windows
>
>  I'm trying to do some work on that.

Cool!

> > 2) porting Mono's WinForms on top of Wine gdiplus
> > instead of Mono gdiplus (and making it more win32-ish as
> > a result)
>
>  Mono is using MS GDI+ on Windows since it uses GDI+. Mono's libgdiplus is
> only used on non-Windows platforms.

I guess I assumed that Mono used native WinForms on Windows,
and that its winforms code was only used on Linux.  I clearly
don't know enough about Mono to discuss it intelligently :-)

>  I also suggested on mono-devel-list that process creation and module
> loading for managed modules should be supported by ntdll.dll via callbacks
> to mscoree.dll as described in
>  http://lists.ximian.com/pipermail/mono-devel-list/2008-April/027491.html

That's interesting info, thanks.

At the moment you seem to be taking the lead on these issues.
Please let us know how it goes.
- Dan


From scott at open-vote.org  Sun Apr 13 16:05:31 2008
From: scott at open-vote.org (Scott Ritchie)
Date: Sun, 13 Apr 2008 14:05:31 -0700
Subject: cachedmetrics - still used?
In-Reply-To: <b6bb06270804101257j60cf6e40n3042b57532648a12@mail.gmail.com>
References: <b6bb06270804101257j60cf6e40n3042b57532648a12@mail.gmail.com>
Message-ID: <4802759B.2010903@open-vote.org>

Austin English wrote:
> Looking at documentation/PACKAGING, it seems there's quite a bit of
> outdated info (hasn't been updated in 2-3 years...). Anywho, I'm
> preparing a few updates for it, but wanted to verify that
> cachedmetrics is no longer used. There's a few references to it on
> AppDB, but only one reference in the code, and a few on wine-devel
> (all of which are pretty old). Is it safe to remove this info?
> 
> -Austin
> 

That documentation really should be deleted and moved to the wiki.

Thanks,
Scott Ritchie


From alexd4 at inbox.lv  Sun Apr 13 16:03:00 2008
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Mon, 14 Apr 2008 00:03:00 +0300
Subject: Lots of input messages lingering in server slowing down wine
	tremendously?
Message-ID: <48027504.8070908@inbox.lv>

Hi.

There was a problem found recently in a fan-made mod of Forsaken (game), that 
certain input combinations were slowing wine very seriously. Holding down a 
keyboard button and moving mouse was found to be especially devastating to 
performance (200 fps to 10fps in a matter of 10-20 seconds).

With help from people who develop this mod, I was able to isolate it in a very 
small and simplistic testcase, which shows this same problem. It will be 
included as attachment. Holding a key and moving mouse over the window steadily 
increases main loop latency from 10 to 50 (and even 100) in a short time, 
especially so if quickly clicking both mouse buttons as well. In a game this 
means going from 100 fps to 20 or 10 just because of input messages. Has to be 
noted that in the actual game the rate of slowdown seemed at least 2-3 times 
faster for reasons I don't know, but the testcase still should enough to show 
the problem.

Now, I do realize that what the testcase is doing is bad practice, it's 
basically refusing to process certain types of messages, and PeekMessage just 
once during a loop is probably bad as well, but that's what the game was 
originally doing in its main game loop. They do plan to fix it in the game. 
Still, there are several concerns about it:

1) No slowdown happens of Windows as far as I can tell. No matter how much I 
move the mouse holding key and clicking madly, it shows same stable 15-16 ticks 
latency in the testcase. I don't know what it does, but somehow it handles this 
situation better than Wine.

2) Can this (broken) way of doing things be exposing some inefficiency in 
message handling, maybe something that could use optimization? I tried to put 
debug hacks into queue_hardware_message(), it seems that when slowdown is 
already VERY bad in Forsaken (10fps), message queue in wine server has about 400 
or maybe 600 messages. Is that kind of processing overhead per message 
inevitable? (This is happening on AMD Athlon(tm) 3200+). Perhaps somebody who 
knows that part of code well may be interested in looking into performance 
issues in this case. Because, if 400-600 messages in the queue slow down the 
application to a crawl, then who knows, perhaps it decreases performance of more 
well-behaved but input-intensive apps as well, just less drastically (holding 
one or several keys to move, all the while aiming with mouse and abusing mouse 
buttons is a common thing in games, so there can be quite a few input messages 
flooding the server).

The reason I decided to post it to wine-devel is because I'm not sure if this 
kind of thing is expected and unavoidable or a bug that can be fixed, so better 
to hear some comments first, then a bug entry can be opened if needed.
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: msgstresstest.c
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20080414/16487cbc/attachment-0001.txt 

From wine.dev at web.de  Sun Apr 13 16:18:13 2008
From: wine.dev at web.de (Detlef Riekenberg)
Date: Sun, 13 Apr 2008 23:18:13 +0200
Subject: [2/6] winspool/tests: Add tests for AddForm
In-Reply-To: <48015156.3060900@gmx.net>
References: <48015156.3060900@gmx.net>
Message-ID: <1208121493.7178.17.camel@p4>

On So, 2008-04-13 at 02:18 +0200, Marcel Partap wrote:
> Subject: [PATCH] winspool/tests: Add tests for AddForm

A test for AddForm / DeleteForm can't work with the stubs in our
"winspool.drv".
The implementation is needed first.

> +    SetLastError(MAGIC_DEAD);

Plase do not use MAGIG_DEAD, it was a mistake in my first Patchset.
Use the real Value instead.

> +    res = AddFormA(NULL, 0, NULL);
> +    RETURN_ON_DEACTIVATED_SPOOLER(res);
> +    ok( !res && (GetLastError() == ERROR_INVALID_LEVEL),
> +        "returned %d with %d (expected '0' with ERROR_INVALID_LEVEL)\n", res, GetLastError());
> +
> +    SetLastError(MAGIC_DEAD);
> +    res = AddFormA((HANDLE)MAGIC_DEAD, 1, NULL);

> +    RETURN_ON_DEACTIVATED_SPOOLER(res);

Use this macro only once.
I did not test, which AddFormA return RPC_S_SERVER_UNAVAILABLE.

Did you test the code with a non - admin account?
Many functions in winspool.drv return ERROR_ACCESS_DENIED


-- 
 
By by ... Detlef




From wine.dev at web.de  Sun Apr 13 16:21:35 2008
From: wine.dev at web.de (Detlef Riekenberg)
Date: Sun, 13 Apr 2008 23:21:35 +0200
Subject: [3/6] winspool: Implement AddFormA/W for level 1 forms
In-Reply-To: <48015158.8050902@gmx.net>
References: <48015158.8050902@gmx.net>
Message-ID: <1208121695.7178.20.camel@p4>

On So, 2008-04-13 at 02:18 +0200, Marcel Partap wrote:
> + *
> + * FIXME: no level 2 support
> + *
>   */
>  BOOL WINAPI AddFormW(HANDLE hPrinter, DWORD Level, LPBYTE pForm)

"FIXME:" is not a valid section in our API-Documentation

Please use "NOTES" or "BUGS"


-- 
 
By by ... Detlef




From wine.dev at web.de  Sun Apr 13 16:24:02 2008
From: wine.dev at web.de (Detlef Riekenberg)
Date: Sun, 13 Apr 2008 23:24:02 +0200
Subject: [5/6] winspool: Implement DeleteFormA/W
In-Reply-To: <4801515D.20407@gmx.net>
References: <4801515D.20407@gmx.net>
Message-ID: <1208121842.7178.23.camel@p4>

On So, 2008-04-13 at 02:18 +0200, Marcel Partap wrote:
> +    formNameW = HeapAlloc(GetProcessHeap(), 0, len * sizeof(WCHAR));
> +    MultiByteToWideChar(CP_ACP, 0, pFormName, -1, formNameW, len);
> +    return DeleteFormW(hPrinter, formNameW); 

Memory-leak: formnameW


-- 
 
By by ... Detlef




From austinenglish at gmail.com  Sun Apr 13 16:24:30 2008
From: austinenglish at gmail.com (Austin English)
Date: Sun, 13 Apr 2008 16:24:30 -0500
Subject: cachedmetrics - still used?
In-Reply-To: <4802759B.2010903@open-vote.org>
References: <b6bb06270804101257j60cf6e40n3042b57532648a12@mail.gmail.com>
	<4802759B.2010903@open-vote.org>
Message-ID: <b6bb06270804131424x6cecccd7o13cec26875fa0978@mail.gmail.com>

On Sun, Apr 13, 2008 at 4:05 PM, Scott Ritchie <scott at open-vote.org> wrote:
>
> Austin English wrote:
>  > Looking at documentation/PACKAGING, it seems there's quite a bit of
>  > outdated info (hasn't been updated in 2-3 years...). Anywho, I'm
>  > preparing a few updates for it, but wanted to verify that
>  > cachedmetrics is no longer used. There's a few references to it on
>  > AppDB, but only one reference in the code, and a few on wine-devel
>  > (all of which are pretty old). Is it safe to remove this info?
>  >
>  > -Austin
>  >
>
>  That documentation really should be deleted and moved to the wiki.
>
>  Thanks,
>  Scott Ritchie
>

I just created http://wiki.winehq.org/Packaging

I just dumped my updated PACKING file, which is still incomplete. I
removed some old stuff, e.g., references to using windows partitions,
cachedmetrics, etc. Added info on optional packages, but it still
needs quite a bit of work (as well as wiki formatting).  Wine
components definitely needs updating, as well as the general info
about where to install files/etc.


From hintak_leung at yahoo.co.uk  Sun Apr 13 08:37:48 2008
From: hintak_leung at yahoo.co.uk (Hin-Tak Leung)
Date: Sun, 13 Apr 2008 14:37:48 +0100
Subject: urlmon: add stub for CoInternetSetFeatureEnabled
In-Reply-To: <003301c89d53$97751be0$a600fea9@DMITRY>
References: <784229.68185.qm@web23202.mail.ird.yahoo.com>
	<003301c89d53$97751be0$a600fea9@DMITRY>
Message-ID: <48020CAC.3090105@yahoo.co.uk>

Dmitry Timoshkov wrote:
> "Louis. Lenders" <xerox_xerox2000 at yahoo.co.uk> wrote:
> 
>> +HRESULT WINAPI  CoInternetSetFeatureEnabled(INTERNETFEATURELIST Feature, DWORD flags, BOOL fEnable)
>> +{
>> +    FIXME("%p, 0x%08x, %x, stub\n", &Feature, flags, fEnable);
>> +    return E_NOTIMPL;
>> +}
>> diff --git a/dlls/urlmon/urlmon.spec b/dlls/urlmon/urlmon.spec
>> index 1fa2f94..e89e049 100644
>> --- a/dlls/urlmon/urlmon.spec
>> +++ b/dlls/urlmon/urlmon.spec
>> @@ -19,6 +19,7 @@
>> @ stdcall CoInternetGetSession(long ptr long)
>> @ stdcall CoInternetParseUrl(wstr long long wstr long ptr long)
>> @ stdcall CoInternetQueryInfo(ptr long long ptr long ptr long)
>> +@ stdcall CoInternetSetFeatureEnabled(ptr long long)
> 
> The first parameter of CoInternetSetFeatureEnabled is not a pointer even
> if you pretend it is in the FIXME. Also Please use consistent spacing and
> naming of variables (preferring 1 space and no hungarian/upper cased names).
> 

oh, I just made the same comment (http://bugs.winehq.org/show_bug.cgi?id=12406#c7 ):

I had a look at this - INTERNETFEATURELIST is a enum, not a long pointer;
oh, and the stub code itself should go into internet.c (where similiarly
named/used functions resides), instead of urlmon_main.c .

Other than these, the patch took the doc explorer further, so
I think basically just needs a 'FIXME("Not implemented\n");' to be sent off...



From stefan at codeweavers.com  Sun Apr 13 16:08:19 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sun, 13 Apr 2008 23:08:19 +0200
Subject: Trouble in compiling Wine 0.9.57 and 0.9.58 on Solaris 10 08/07
In-Reply-To: <00a101c89da4$e7f77210$4001a8c0@NATERS>
References: <47FF74FD.4060307@sun.com> <00a101c89da4$e7f77210$4001a8c0@NATERS>
Message-ID: <200804132308.19873.stefan@codeweavers.com>

Am Sonntag, 13. April 2008 22:28:16 schrieb Rolf Kalbermatter:
> Following link might give some details about Sun Solaris support of
> infinintes
> and also ideas how to solve that problem.
Yes, that would work. Any build system guru who could implement that? I think 
it is not a good idea to put that into wined3d


From fgouget at free.fr  Sun Apr 13 18:08:47 2008
From: fgouget at free.fr (Francois Gouget)
Date: Mon, 14 Apr 2008 01:08:47 +0200 (CEST)
Subject: Better sound support
In-Reply-To: <47FF9AEC.6060700@gmail.com>
References: <47FF9AEC.6060700@gmail.com>
Message-ID: <alpine.DEB.1.10.0804140105250.12478@amboise.dolphin>

On Fri, 11 Apr 2008, Kacper Pluta wrote:
[...]
> I'd also suggest correcting MIDI handling and integrating wine with 
> wineasio, which would enable using VST and VSTi on a quite high level, 
> as well as use other programmes.

There's a wineasio project which is in a separate tree, partly for 
licensing reasons. See http://sourceforge.net/projects/wineasio for more 
details.

-- 
Francois Gouget <fgouget at free.fr>              http://fgouget.free.fr/
           Demander si un ordinateur peut penser revient


From dank at kegel.com  Sun Apr 13 21:15:49 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 13 Apr 2008 19:15:49 -0700
Subject: Wine 1.0 status: T minus 61 days, 69 bugs to go
Message-ID: <a71bd89a0804131915i519b4cb0q3f9418b66ecb2655@mail.gmail.com>

19 days to code freeze (!)

Big news of the week is an apparant regression in one of
the release criteria apps.  Also, happily, two bugs I had
pushed off to 1.2 got fixed anyway (demonstrating the
honorary nature of the release manager position :-)

Changes since last week:

Deferred earlier, but fixed anyway:
3534 	user32 	14 	Systray icons are not transparent...

Deferred earlier, but patch that really fixes it submitted, so undeferred:
10905  	shell32  0  	thinstall firefox demo requires native msvcrt

Deferred:
6254   richedit    4       Installer infinite loop from rich text error

New:
12561  -unknown  0  	Photoshop CS alt key for clone/healing - possible
regression

Here's the full list of current bugs:

11420 advapi32  0  service control manager API problem: name of named
objects might differ (client vs. service process)
556   build-en  1  Reconcile the Windows and Wine spec files
1114  comctl32  3  Winrar2.90/3.00: Comboex doesn't trigger a event
when you mouse-click in some value of it
2493  comctl32  2  Multi-select listview: Shift-arrow up only selects
top two items
4372  comctl32  1  listview: cannot drag several items
11509 crypt32   0  Wordviewer 2003 is unable to open documents
encrypted with AES
5535  directx-  17 Planescape:Torment doesn't work
9030  directx-  0  army men hangs on black screen
11681 directx-  17 Add support for video overlay
3270  gdi32     15 Problem with minimized top-level windows
6519  gdi32     7  Wine blacks out rotated font bitmap
7571  gdi32     1  Accented character glyphs are mixed up with
TrueType fonts (affects e.g. Lotus Notes R5)
9771  gdi32     42 Steam Friends doesn't work (fails to render
correctly or refresh)
5024  kernel32  4  Thief: Deadly Shadows crashes:page fault on read
access to 0x0000040c
5351  kernel32  11 Windows Installer 3.1 cannot install because of
non-standard drive labeling
5541  kernel32  0  WriteConsole can't write to stdout; affects e.g.
wsh's cscript's usage message
9039  kernel32  0  GS-Auftrag Professional SQL aborts on startup
9484  kernel32  19 Program refuses to run because of
ProtectCD/ProtectDISC copy-protection
7098  mscoree   1  RufzXP crashes on startup, needs
mscoree.dll.CorBindToRuntimeEx
8783  ntdll     13 USB serial ports do not work
9356  ntdll     8  Serial communication not working since wine-0.9.33
2539  ole       3  XDND (Drag and drop for X Windows) doesn't copy text
6607  ole       10 Drag and Drop not working
8095  ole       0  PQ Teaching toy crashes
9942  ole       2  Powerpoint Viewer 2007 crashes opening .pptx files
5926  programs  1  Wine does not provide an implementation of winhlp32.exe
5163  setupapi  13 Office XP 2002 crashes on installation
3546  shdocvw   2  CLSID_InternetShortcut not available...
6095  shdocvw   13 MOTD in counter-strike 1.6 and counter-strike
source does not render
8898  shdocvw   0  Run Time Error "445": Object doesn't support this
action in Europa Knowledgebase
9304  shdocvw   4  Temple of Elemental Evil demo doesn't start - gui
irresponsive
8439  shell32   8  Visual Studio .NET (7) install fails
9809  shell32   4  Autodesk Revit Architecture 2008 install fails
10905 shell32   0  thinstall firefox demo requires native msvcrt
11742 shlwapi   9  Small .net 1.1 app (FastMD5 1.3) fails to start up
12074 testcase  2  The conformance tests fail on Windows
6604  tools     3  Ship icons for the wine-tools that can be used in
.desktop files
12561 -unknown  0  Photoshop CS alt key for clone/healing - possible regression
5055  -unknown  5  Deleting files from a window in wine doesn't send
them to the Trash
5061  -unknown  6  Copying from Windows Firefox in Wine and pasting to
Linux OpenOffice pastes metadata as data
5402  -unknown  0  Trying to run PhotoStitch 3.1
5844  -unknown  12 tray minimize
5948  -unknown  1  Star Trek: Armada does not install
7404  -unknown  3  ShowWindow(SW_MINIMIZE) should not generate a
WM_PAINT message
7477  -unknown  1  Uplink demo crashes
8125  -unknown  0  Marratech 6.1 crashes on start
9178  -unknown  8  "hello world" dos program hangs
9916  -unknown  6  "make test" usually fails
9959  -unknown  9  Make wine updates work even if the registry changed
10147 -unknown  1  Word Viewer 2003 - Tab behavior differs from Windows
10815 -unknown  2  Cannot drag images into Adobe Photoshop 7 from the
web / desktop
11281 -unknown  4  CJK input many issues
12097 -unknown  3  Wine 1.0 should not ship out-of-sync resource translations
12246 -unknown  2  "make test" gives different results with and
without warn+heap
664   user32    7  The help menu functionality inside programs is
broken (messaging problem)
3023  user32    5  Orcad - "Place Part" never tries to put down a part
4523  user32    5  Can't copy from Firefox 1.5 and paste into
OpenOffice 2 under Wine
124   wineserv  2  Review of Wine Server Protocol
1990  winex11.  1  modifier keys not released when switching desktop
2368  winex11.  7  Wine loses its X-Window when switching to another
virt. desktop in Fvwm
3297  winex11.  12 UpdateWindow() doesn't call XFlush()
5623  winex11.  4  GetAsyncKeyState wrong if querying process doesn't have focus
5828  winex11.  25 Command and Conquer Generals (Zero Hour) doesn't
change the mouse cursor from the default X mouse
7372  winex11.  12 can't copy and paste between gnome apps eg
openoffice or gimp and wine apps such as dreamweaver or adobe
photoshop
10984 winex11.  5  sun jre 5 update 10 installer hangs in 0.9.52
11019 winex11.  3  matlab r14 and r16 (7.0.4 and 7.3.0) and
WriteItNow3.1.0s hang if X in 24bpp mode
5625  wininet   4  Wine does not handle internet proxy settings conveniently
9787  winsock   47 Warcraft3 Battle.net Doesn't work (Needs AcceptEx)
12005 wintab32  1  Regression in pressure sensitivity with wizardpen
tablet driver and Photoshop 7


From kai.blin at gmail.com  Sun Apr 13 23:37:20 2008
From: kai.blin at gmail.com (Kai Blin)
Date: Mon, 14 Apr 2008 06:37:20 +0200
Subject: Wine 1.0 status: T minus 61 days, 69 bugs to go
In-Reply-To: <a71bd89a0804131915i519b4cb0q3f9418b66ecb2655@mail.gmail.com>
References: <a71bd89a0804131915i519b4cb0q3f9418b66ecb2655@mail.gmail.com>
Message-ID: <200804140637.28093.kai.blin@gmail.com>

On Monday 14 April 2008 04:15:49 Dan Kegel wrote:

> New:
> 12561  -unknown  0  	Photoshop CS alt key for clone/healing - possible
> regression

This is probably related to http://bugs.winehq.org/show_bug.cgi?id=12543 which 
in turn seems to be caused by the fix for 
http://bugs.winehq.org/show_bug.cgi?id=11639

Cheers,
Kai

-- 
Kai Blin
WorldForge developer  http://www.worldforge.org/
Wine developer        http://wiki.winehq.org/KaiBlin
Samba team member     http://www.samba.org/samba/team/
--
Will code for cotton.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080414/a0e894e2/attachment.pgp 

From zgs at seas.upenn.edu  Sun Apr 13 23:53:56 2008
From: zgs at seas.upenn.edu (Zachary Goldberg)
Date: Mon, 14 Apr 2008 00:53:56 -0400
Subject: shell32: implement SHGetFolderPathAndSubDirA/W [2nd resend]
In-Reply-To: <87wsnj6lhq.fsf@wine.dyndns.org>
References: <200803272257.23004.Stefan.Leichter@camline.com>
	<87wsnj6lhq.fsf@wine.dyndns.org>
Message-ID: <b050a5e70804132153i566fa5xcfe8b3673089a4da@mail.gmail.com>

On Mon, Mar 31, 2008 at 10:01 AM, Alexandre Julliard
<julliard at winehq.org> wrote:
> Stefan Leichter <Stefan.Leichter at camline.com> writes:
>
>  > +    if (pszSubPath && (length = MultiByteToWideChar(CP_ACP, 0, pszSubPath, -1, NULL, 0))) {
>  > +        pszSubPathW = HeapAlloc(GetProcessHeap(), 0, length * sizeof(WCHAR));
>  > +        if(!pszSubPathW)
>  > +            return HRESULT_FROM_WIN32(ERROR_NOT_ENOUGH_MEMORY);
>
>  You are leaking memory on error. Also I don't think it makes sense to
>  test the return value of MultiByteToWideChar, it shouldn't fail in this
>  case (or if you test it, then you need to handle the error properly, not
>  use an empty path instead).
>
>  --
>  Alexandre Julliard
>  julliard at winehq.org
>
>
>

Stefan,

Any progress on this?

-- 
Zachary Goldberg
Computer Science & Engineering
Electrical Captain of Penn Electric Race Team
School of Engineering at the University of Pennsylvania


From thunderbird2k at gmx.net  Mon Apr 14 01:14:00 2008
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Mon, 14 Apr 2008 08:14:00 +0200
Subject: Including Mono within a Wine package - should Wine expect this?
In-Reply-To: <a71bd89a0804131228w188ecd20r9802c35198b25764@mail.gmail.com>
References: <a71bd89a0804100645y2b7f9c94n719ab5f19374db04@mail.gmail.com>
	<47FECF9E.1030309@open-vote.org>
	<a71bd89a0804101954w31a24e2fn72c027796b771a6e@mail.gmail.com>
	<47FF506D.4010102@open-vote.org> <20080411125059.293230@gmx.net>
	<19e31a080804131011s11342880qd0ee9d2981a1c9be@mail.gmail.com>
	<a71bd89a0804131228w188ecd20r9802c35198b25764@mail.gmail.com>
Message-ID: <20080414061400.39750@gmx.net>

> On Sun, Apr 13, 2008 at 10:11 AM, Steven Edwards <winehacker at gmail.com>
> wrote:
> >  Rather than ignoring mono these issues make it sound like Wine and
> >  mono should try to work together again. The EULA for the .NET runtime
> >  prohibits distributing it and using it on non-windows licensed systems
> >  so we are in much the same legal situation with IE where we have to
> >  have a replacement.
> 
> Yes, exactly.  I've been discussing this a bit on the mono list.
> 
> There are two big pieces of work needed:
> 1) support for mixed assemblies in Mono for Windows
> 2) porting Mono's WinForms on top of Wine gdiplus
> instead of Mono gdiplus (and making it more win32-ish as
> a result)
> 
> This would be a fine summer project for somebody properly motivated.
> 
> There will be more incentive to do this as we get Microsoft .NET working
> better, and it becomes clearer just how many applications need one
> or the other of the two items above to run.
> 
> In short: I think the path to Mono+Wine nivana at the moment leads
> directly through enemy territory: we have to get MS .net working better
> first
> before it's clear it'll be worth it.
> - Dan
> 

What we really need is mono's windows.forms to be layered on top of gdi32 and user32 for windows controls like buttons, textboxes and so on .. As lots of programs do overrides using native dlls on them, so that's why it should be real windows controls with a wndproc.

Ironically the current situation is for a part our own issue. Years ago Mono's windows.forms used winelib. They moved to a managed implementation because they had wine integration issues and we weren't that cooperative. Further they didn't like the 2d performance much (likely due to the lack of a dib engine ..). They might be reluctant to Wine.

Roderick 
-- 
Der GMX SmartSurfer hilft bis zu 70% Ihrer Onlinekosten zu sparen! 
Ideal f?r Modem und ISDN: http://www.gmx.net/de/go/smartsurfer


From Stefan.Leichter at camLine.com  Mon Apr 14 01:37:57 2008
From: Stefan.Leichter at camLine.com (Stefan Leichter)
Date: Mon, 14 Apr 2008 08:37:57 +0200
Subject: shell32: implement SHGetFolderPathAndSubDirA/W [2nd resend]
In-Reply-To: <b050a5e70804132153i566fa5xcfe8b3673089a4da@mail.gmail.com>
References: <200803272257.23004.Stefan.Leichter@camline.com>	
	<87wsnj6lhq.fsf@wine.dyndns.org>
	<b050a5e70804132153i566fa5xcfe8b3673089a4da@mail.gmail.com>
Message-ID: <4802FBC5.30806@camLine.com>

Zachary Goldberg schrieb:
> On Mon, Mar 31, 2008 at 10:01 AM, Alexandre Julliard
> <julliard at winehq.org> wrote:
>> Stefan Leichter <Stefan.Leichter at camline.com> writes:
>>
>>  > +    if (pszSubPath && (length = MultiByteToWideChar(CP_ACP, 0, pszSubPath, -1, NULL, 0))) {
>>  > +        pszSubPathW = HeapAlloc(GetProcessHeap(), 0, length * sizeof(WCHAR));
>>  > +        if(!pszSubPathW)
>>  > +            return HRESULT_FROM_WIN32(ERROR_NOT_ENOUGH_MEMORY);
>>
>>  You are leaking memory on error. Also I don't think it makes sense to
>>  test the return value of MultiByteToWideChar, it shouldn't fail in this
>>  case (or if you test it, then you need to handle the error properly, not
>>  use an empty path instead).
>>
>>  --
>>  Alexandre Julliard
>>  julliard at winehq.org
>>
>>
>>
> 
> Stefan,
> 
> Any progress on this?
> 
Yes,

http://www.winehq.org/pipermail/wine-patches/2008-April/053246.html

Stefan


From stefan at codeweavers.com  Mon Apr 14 03:26:37 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Mon, 14 Apr 2008 10:26:37 +0200
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <200804132126.19422.stefan@codeweavers.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<48001DF5.3050401@gmail.com>
	<200804132126.19422.stefan@codeweavers.com>
Message-ID: <200804141026.37428.stefan@codeweavers.com>

A small implementation change plan:

With Henri's suggestion, we have two levels of indirection, one that maps a 
D3D state to a pipeline part and a state, and one that maps a pipeline part 
and a state to an application function. Since both states are known at latest 
at device creation time, we can remove one indirection there.

So my suggestion is this: Instead of trying to keep the single table in code, 
add 3 pipeline stage backends, like Henri suggested: A vertex one, a fragment 
and a misc backend. The pipeline backend has a description structure which 
contains a priv data creation and destruction data, possibly some flags to 
tell other parts of the pipeline how to communicate with it and a set of 
states and application functions:

struct pipeline_backend {
	DWORD state;		/* State this sets */
	apply_func apply;	/* Apply function like the current state mgmt uses */
	DWORD representative;/* For state grouping */
}

state and representative work like the current state identifiers via 
STATE_RENDER(x), STATE_TEXTURESTAGE(x, y), etc. The apply function takes the 
stateblock, state and context as argument, as usual.

The current global state table(s) are removed. At device creation(or Init3D or 
somewhere else) we select a vertex, fragment and misc state backend and a 
shader backend. The device contains a full state table like the current 
FFPStateTable / ATIFSStateTable. A pipeline compiler(is there some better 
name?) iterates over the 3 partial state tables and inserts them in the 
device's state table. If a state is handled by more than one pipeline part, a 
helper function can be used which calls the callbacks in a row. That's not as 
efficient as the current inlining, but it should be at least as fast as in 
Henri's proposal, and I can live with that.

Advantages:
-> We can split up pipeline part handlers and select them dynamically etc
-> We have no additional overhead in the rendering loop since we only deal 
with one state table there
-> Minimal state polling because pixel and vertex shaders are dirtifyable 
states

Problems:
-> The issues from the last mail still apply and need to be solved(not a 
problem, just mentioning)

-> Shaders not 100% separated from the fixed function pipeline since both are 
equal states in the vertex and fragment pipelines

-> No state handler or shader_select is not guaranted to be applied each draw, 
so we can't use them to enable GL_FRAGMENT_SHADER_ATI and 
GL_TEXTURE_SHADER_ATI. That will have to be a fixed function fragment 
pipeline callback. If there's a shader implementation using that extension in 
use as well, they can sort this out via private data sharing.
(Note: we would get away with using the colorop setter for this, because after 
device creation this state is dirty, after a blit it is dirty, and otherwise 
the extension will be enabled anyway. I don't particularly like that as it is 
a rather fragile setup)

-> What do we do if a state has different representatives in different 
pipeline parts? E.g. the vdecl and vertex shader will be linked in both misc 
and vertex pipeline backend. In the misc backend, the stream sources will be 
added there as well. This means that if a stream source is changed the VDECL 
fog/lighting changes will be performed needlessly(it happens currently as 
well, so it won't be a regression). There may be other such state groups, but 
I can't think of any right now.

Does that sound like a reasonable idea?


From scott at open-vote.org  Mon Apr 14 03:39:08 2008
From: scott at open-vote.org (Scott Ritchie)
Date: Mon, 14 Apr 2008 01:39:08 -0700
Subject: Feature Request: Registry / winecfg entry for launching an application
	in a wineexplorer window
Message-ID: <4803182C.9070209@open-vote.org>

I have a few full screen applications that I'd like to run contained in
small windows.  Currently, in order to run them this way, I have to
either open winecfg and set a virtual desktop or launch the application
on the terminal with: wine explorer /desktop=name,1024x768 app.exe

What I'd like is something that does this for me similar to app
defaults.  That way I could run the application by double clicking it
(or from the shortcut in the start menu) and have it contained in the
window I want.

Ideally I'd be able to enable this setting from a right
click->properties menu, however that work isn't necessarily needed
within Wine other than support for modifying this new key using
something like reg.exe on the terminal.

It seems like it'd be fairly simple to implement, too.  Any thoughts?

Thanks,
Scott Ritchie


From austinenglish at gmail.com  Mon Apr 14 05:23:55 2008
From: austinenglish at gmail.com (Austin English)
Date: Mon, 14 Apr 2008 05:23:55 -0500
Subject: Feature Request: Registry / winecfg entry for launching an
	application in a wineexplorer window
In-Reply-To: <4803182C.9070209@open-vote.org>
References: <4803182C.9070209@open-vote.org>
Message-ID: <b6bb06270804140323h337208dcoaed798540f800b1@mail.gmail.com>

On Mon, Apr 14, 2008 at 3:39 AM, Scott Ritchie <scott at open-vote.org> wrote:
> I have a few full screen applications that I'd like to run contained in
>  small windows.  Currently, in order to run them this way, I have to
>  either open winecfg and set a virtual desktop or launch the application
>  on the terminal with: wine explorer /desktop=name,1024x768 app.exe
>
>  What I'd like is something that does this for me similar to app
>  defaults.  That way I could run the application by double clicking it
>  (or from the shortcut in the start menu) and have it contained in the
>  window I want.
>
>  Ideally I'd be able to enable this setting from a right
>  click->properties menu, however that work isn't necessarily needed
>  within Wine other than support for modifying this new key using
>  something like reg.exe on the terminal.
>
>  It seems like it'd be fairly simple to implement, too.  Any thoughts?
>
>  Thanks,
>  Scott Ritchie
>
>
>

There was a similar request in a  bug a few weeks ago. Someone made
the comment that  since Windows's explorer doesn't support this, we
can't, even though running it on a per-app basis  with the 'wine
explorer /desktop=name,1024x768 app.exe" workaround allows it to work.
I asked for an explanation in the bug, but received no response (I
can't find the bug off hand, I'll keep looking).


From mrmessiah at gmail.com  Mon Apr 14 05:39:37 2008
From: mrmessiah at gmail.com (Chris Howe)
Date: Mon, 14 Apr 2008 11:39:37 +0100
Subject: Feature Request: Registry / winecfg entry for launching an
	application in a wineexplorer window
In-Reply-To: <b6bb06270804140323h337208dcoaed798540f800b1@mail.gmail.com>
References: <4803182C.9070209@open-vote.org>
	<b6bb06270804140323h337208dcoaed798540f800b1@mail.gmail.com>
Message-ID: <39c14e440804140339y4979331didff42e4345558f24@mail.gmail.com>

On Mon, Apr 14, 2008 at 11:23 AM, Austin English <austinenglish at gmail.com>
wrote:

>
> There was a similar request in a  bug a few weeks ago. Someone made
> the comment that  since Windows's explorer doesn't support this, we
> can't, even though running it on a per-app basis  with the 'wine
> explorer /desktop=name,1024x768 app.exe" workaround allows it to work.
>

As WINE is not a Windows Emulator, but rather a means to get Windows
applications to run in Linux, I see no reason why this shouldn't be allowed
in WINE's explorer.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080414/b6c006d1/attachment.htm 

From julliard at winehq.org  Mon Apr 14 05:57:45 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 14 Apr 2008 12:57:45 +0200
Subject: wine.info add fake dlls for msacm32.drv and midimap.dll
In-Reply-To: <19e31a080804122256h6b4a5534m6b61acae87f8c479@mail.gmail.com>
	(Steven Edwards's message of "Sun, 13 Apr 2008 01:56:29 -0400")
References: <19e31a080804122129j75bc068cr1fe1e023e05aa011@mail.gmail.com>
	<024001c89d2a$698bdc60$a600fea9@DMITRY>
	<19e31a080804122256h6b4a5534m6b61acae87f8c479@mail.gmail.com>
Message-ID: <87wsn07lg6.fsf@wine.dyndns.org>

"Steven Edwards" <winehacker at gmail.com> writes:

> If I understand the issue correctly the problem is in Wine. The
> application works on Windows no problem. The Thinstall LoadLibrary
> hook can't be expected to know about builtin dlls if its searching the
> default directories or looking up KnownDLLs in the registry and they
> are not there, then failure is by design.

This would require creating fake dlls for every single dll we support.
That's a bit problematic considering that we need to load the dll to
retrieve the proper info.

It seems broken for Thinstall to try to second-guess the library search
algorithm, especially now with activation contexts and the like. I'd
argue that they should forward the call to LoadLibrary unless the file
has been explicitly deleted.

-- 
Alexandre Julliard
julliard at winehq.org


From chris.kcat at gmail.com  Mon Apr 14 07:34:33 2008
From: chris.kcat at gmail.com (Chris Robinson)
Date: Mon, 14 Apr 2008 05:34:33 -0700
Subject: Feature Request: Registry / winecfg entry for launching an
	application in a wineexplorer window
In-Reply-To: <4803182C.9070209@open-vote.org>
References: <4803182C.9070209@open-vote.org>
Message-ID: <200804140534.33333.chris.kcat@gmail.com>

On Monday 14 April 2008 01:39:08 am Scott Ritchie wrote:
> I have a few full screen applications that I'd like to run contained in
> small windows.  Currently, in order to run them this way, I have to
> either open winecfg and set a virtual desktop or launch the application
> on the terminal with: wine explorer /desktop=name,1024x768 app.exe
>
> What I'd like is something that does this for me similar to app
> defaults.  That way I could run the application by double clicking it
> (or from the shortcut in the start menu) and have it contained in the
> window I want.

IIRC, the problem is you can't have two Wine processes using two different 
desktops. Try this: start an app without virtual desktop and leave it 
running, run winecfg and turn on virtual desktop (make sure to click Apply), 
then try to start another app. It won't use a virtual desktop.

I'm also not sure virtual desktop mode should be seen as a way to force 
fullscreen apps into a windowed mode, because that's not what it does. The 
app takes up the whole desktop still, it's just contained within a window 
that Wine controls for better compatibility, like the unmanaged windows 
setting.


From Petr.Sumbera at Sun.COM  Mon Apr 14 08:17:34 2008
From: Petr.Sumbera at Sun.COM (Petr Sumbera)
Date: Mon, 14 Apr 2008 15:17:34 +0200
Subject: error: `XICCallback' undeclared (Solaris build problem)
Message-ID: <4803596E.1030800@sun.com>

Hi all,

It seems that following change from last Friday broke Solaris build:

http://source.winehq.org/git/wine.git/?a=commitdiff;h=185157cb6eb25bc5e75e9a260b593e98153d2255

This is probably because Solaris /usr/include/X11/Xlib.h doesn't define 
XICCallback.

-bash-3.2$ grep XICCallback /usr/include/X11/Xlib.h
-bash-3.2$

Compilation error is following:

gcc -c -I. -I. -I../../include -I../../include  -D__WINESRC__ 
-D_REENTRANT -fPIC -Wall -pipe -fno-strict-aliasing 
-Wdeclaration-after-statement -Wwrite-strings -Wpointer-arith 
-std=gnu99  -o xim.o xim.c
xim.c: In function `X11DRV_DestroyIM':
xim.c:371: warning: passing arg 5 of `XRegisterIMInstantiateCallback' 
from incompatible pointer type
xim.c: In function `X11DRV_OpenIM':
xim.c:398: warning: assignment from incompatible pointer type
xim.c:475: warning: passing arg 5 of `XUnregisterIMInstantiateCallback' 
from incompatible pointer type
xim.c: In function `X11DRV_SetupXIM':
xim.c:485: warning: passing arg 5 of `XRegisterIMInstantiateCallback' 
from incompatible pointer type
xim.c: In function `X11DRV_CreateIC':
xim.c:504: error: `XICCallback' undeclared (first use in this function)
xim.c:504: error: (Each undeclared identifier is reported only once
xim.c:504: error: for each function it appears in.)
xim.c:504: error: syntax error before "destroy"
xim.c:500: warning: unused variable `spot'
xim.c:501: warning: unused variable `preedit'
xim.c:502: warning: unused variable `status'
xim.c:503: warning: unused variable `xic'
...

Any idea or comment to this?

Thanks,

Petr


From dank at kegel.com  Mon Apr 14 10:09:26 2008
From: dank at kegel.com (Dan Kegel)
Date: Mon, 14 Apr 2008 08:09:26 -0700
Subject: Including Mono within a Wine package - should Wine expect this?
In-Reply-To: <20080414061400.39750@gmx.net>
References: <a71bd89a0804100645y2b7f9c94n719ab5f19374db04@mail.gmail.com>
	<47FECF9E.1030309@open-vote.org>
	<a71bd89a0804101954w31a24e2fn72c027796b771a6e@mail.gmail.com>
	<47FF506D.4010102@open-vote.org> <20080411125059.293230@gmx.net>
	<19e31a080804131011s11342880qd0ee9d2981a1c9be@mail.gmail.com>
	<a71bd89a0804131228w188ecd20r9802c35198b25764@mail.gmail.com>
	<20080414061400.39750@gmx.net>
Message-ID: <a71bd89a0804140809s1d1af678uf5a6170ab5a1ae97@mail.gmail.com>

On Sun, Apr 13, 2008 at 11:14 PM, Roderick Colenbrander
<thunderbird2k at gmx.net> wrote:
>  What we really need is mono's windows.forms to be layered on top of gdi32 and user32 for windows controls like buttons, textboxes and so on .. As lots of programs do overrides using native dlls on them, so that's why it should be real windows controls with a wndproc.
>
>  Ironically the current situation is for a part our own issue. Years ago Mono's windows.forms used winelib. They moved to a managed implementation because they had wine integration issues and we weren't that cooperative. Further they didn't like the 2d performance much (likely due to the lack of a dib engine ..). They might be reluctant to Wine.

Yup.  We have to really get our act together, then undoing the fork
might make sense.


From lich at math.spbu.ru  Mon Apr 14 11:30:40 2008
From: lich at math.spbu.ru (Kirill K. Smirnov)
Date: Mon, 14 Apr 2008 20:30:40 +0400
Subject: ws2_32: Work around the host name resolving to 127.x.x.x when using
	that for binding.
Message-ID: <200804142030.41154.lich@math.spbu.ru>

Hi,

nitpick:
> +                        /* Trying to bind to the default hots interface, 
using
Typo in word 'host'?

--
Kirill


From frick at sc-networks.de  Mon Apr 14 11:29:32 2008
From: frick at sc-networks.de (Christoph Frick)
Date: Mon, 14 Apr 2008 18:29:32 +0200
Subject: ws2_32: Work around the host name resolving to 127.x.x.x when
	using that for binding.
In-Reply-To: <200804141605.23704.kai.blin@gmail.com>
References: <200804141605.23704.kai.blin@gmail.com>
Message-ID: <20080414162932.GX5348@byleth.sc-networks.de>

On Mon, Apr 14, 2008 at 04:05:23PM +0200, Kai Blin wrote:

Hi Kai, et all,

> +static const char magic_loopback_addr[] = {127, 12, 34, 56};

in the past wine used to work quite well with the ip-address configured
using the places in the windows registry (msdn or something similar kept
an howto for setting the ips in win98 and 2k (and look alikes)). now
that wine tries to get its ip from the /etc/hosts (or whereever?) i
noticed some problems with hosting games. as msdn keeps firing errors at
me i go and ask the list about this.

i always though windows (at least until xp?) is not capable of listening
to requests bound to an ip/interface? with the recent changes the games
listen to lo0 and will never ever accept anything. i had to change my
/etc/hosts now to make it work again; yet it will fail with more than
one nic (i have to change /etc/hosts again).

long story short:

- does any windows version at all support the idea behind giving an ip
  to listen for connections like unix/linux/bsd does?

- and even if: who runs some windows software in wine that needs this
  features and is not able to fix the problem with the firewall or other
  restrictions on the unix end?

if no: what would be needed to change the listening to 0.0.0.0 by
default? a patch and a test?

-- 
cu
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 163 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080414/46088c15/attachment.pgp 

From zgs at seas.upenn.edu  Mon Apr 14 11:40:51 2008
From: zgs at seas.upenn.edu (Zachary Goldberg)
Date: Mon, 14 Apr 2008 12:40:51 -0400
Subject: Lug Radio Live 2008 wine talk. Slides online, comments welcome.
In-Reply-To: <1207299933.6522.112.camel@jernst-desktop>
References: <a71bd89a0804032026s2f87faa7v27641421c4e07ac1@mail.gmail.com>
	<1207299933.6522.112.camel@jernst-desktop>
Message-ID: <b050a5e70804140940s34467fddv51596d108024f4a4@mail.gmail.com>

Dan,

Any links for us to hear your discussion this past weekend?

--Zach

On Fri, Apr 4, 2008 at 5:05 AM, Jonathan Ernst <jonathan at ernstfamily.ch> wrote:
> ?Hello,
>
>  Le jeudi 03 avril 2008 ? 20:26 -0700, Dan Kegel a ?crit :
>  > [...]
>
>
>  > The slides are pretty basic; I'll talk a lot around them.
>  > If anybody feels like reviewing the slides
>  > and giving feedback, I'd appreciate it.
>
>
>  Slide 4 :
>
>  You might be interested to add some, government related, recent
>  migrations in Europe to this slide :
>
>  French Police ~70'000 seats
>  http://www.cnet.com/8301-13505_1-9861472-16.html
>
>  Geneva, Switzerland schools 9'000 seats
>  http://www.tdg.ch/pages/home/tribune_de_geneve/recherche/recherche_3_2_1/(contenu)/211880
>
>  http://www.google.com/translate?u=http%3A%2F%2Fwww.tdg.ch%2Fpages%2Fhome
>  %2Ftribune_de_geneve%2Frecherche%2Frecherche_3_2_1%2F(contenu)%
>  2F211880&langpair=fr|en&hl=fr&ie=UTF8
>
>  Slide 13 :
>
>  Maybe add "2008: Codeweavers releases Crossover Games"
>
>  I'm looking forward to hearing this second Wine related LugRadio.
>
>  Best regards.
>
>  Jonathan
>
>
>
>
>
>



-- 
Zachary Goldberg
Computer Science & Engineering
Electrical Captain of Penn Electric Race Team
School of Engineering at the University of Pennsylvania

From paulc at voip.null.ro  Mon Apr 14 11:42:26 2008
From: paulc at voip.null.ro (Paul Chitescu)
Date: Mon, 14 Apr 2008 19:42:26 +0300 (EEST)
Subject: ws2_32: Work around the host name resolving to 127.x.x.x when
	using that for binding.
In-Reply-To: <20080414162932.GX5348@byleth.sc-networks.de>
References: <200804141605.23704.kai.blin@gmail.com>
	<20080414162932.GX5348@byleth.sc-networks.de>
Message-ID: <Pine.LNX.4.64.0804141934580.24510@dragoshel>

On Mon, 14 Apr 2008, Christoph Frick wrote:
> On Mon, Apr 14, 2008 at 04:05:23PM +0200, Kai Blin wrote:
>
> Hi Kai, et all,
>
>> +static const char magic_loopback_addr[] = {127, 12, 34, 56};
>
> in the past wine used to work quite well with the ip-address configured
> using the places in the windows registry (msdn or something similar kept
> an howto for setting the ips in win98 and 2k (and look alikes)). now
> that wine tries to get its ip from the /etc/hosts (or whereever?) i
> noticed some problems with hosting games. as msdn keeps firing errors at
> me i go and ask the list about this.
>
> i always though windows (at least until xp?) is not capable of listening
> to requests bound to an ip/interface? with the recent changes the games
> listen to lo0 and will never ever accept anything. i had to change my
> /etc/hosts now to make it work again; yet it will fail with more than
> one nic (i have to change /etc/hosts again).
>
> long story short:
>
> - does any windows version at all support the idea behind giving an ip
>  to listen for connections like unix/linux/bsd does?
>
> - and even if: who runs some windows software in wine that needs this
>  features and is not able to fix the problem with the firewall or other
>  restrictions on the unix end?
>
> if no: what would be needed to change the listening to 0.0.0.0 by
> default? a patch and a test?
>
> -- 
> cu

Hi!

All versions of Windows support binding to an IP address - although the 
(preferred) method used for enumerating interfaces and their IP address 
varies with version (not that there is a portable way across *NIXes).

Binding to a specific address is the only easy way of detecting which 
interface an UDP packet was received on since recvfrom() only gives source 
address, not destination. Listening on 0.0.0.0 would make impossible to 
tell which interface a packet was received on. Furthermore, a program that 
explicitely tries to bind to each interface would fail all but the first 
bind and possibly bail out. Probably many games that use UDP would break.

Regards,

Paul Chitescu


From austinenglish at gmail.com  Mon Apr 14 12:04:23 2008
From: austinenglish at gmail.com (Austin English)
Date: Mon, 14 Apr 2008 12:04:23 -0500
Subject: Feature Request: Registry / winecfg entry for launching an
	application in a wineexplorer window
In-Reply-To: <200804140534.33333.chris.kcat@gmail.com>
References: <4803182C.9070209@open-vote.org>
	<200804140534.33333.chris.kcat@gmail.com>
Message-ID: <b6bb06270804141004nd99e48are3158647a4482bc2@mail.gmail.com>

On Mon, Apr 14, 2008 at 7:34 AM, Chris Robinson <chris.kcat at gmail.com> wrote:
>  IIRC, the problem is you can't have two Wine processes using two different
>  desktops. Try this: start an app without virtual desktop and leave it
>  running, run winecfg and turn on virtual desktop (make sure to click Apply),
>  then try to start another app. It won't use a virtual desktop.
>
>

Terminal one:
$ rm -rf ~/.wine
$ wine notepad

Terminal two:
$ winecfg # enable virtual desktop
$ winemine # doesn't go in virtual desktop
$ wine explorer /desktop=name,1024x768 winemine # goes in virtual desktop

Now can someone please explain why this is? Is it because using the
workaround a second explorer process is started? If so, we can extend
the same process and run those apps needing workarounds in a virtual
desktop...


From slash at ma.neweb.ne.jp  Mon Apr 14 12:26:09 2008
From: slash at ma.neweb.ne.jp (Kusanagi Kouichi)
Date: Tue, 15 Apr 2008 02:26:09 +0900
Subject: error: `XICCallback' undeclared (Solaris build problem)
In-Reply-To: <4803596E.1030800@sun.com>
References: <4803596E.1030800@sun.com>
Message-ID: <200804141726096658890006MAA5@nm06mta.auone-net.jp>

Does this patch fix the problem?

diff --git a/dlls/winex11.drv/xim.c b/dlls/winex11.drv/xim.c
index d4df9f7..b66cf87 100644
--- a/dlls/winex11.drv/xim.c
+++ b/dlls/winex11.drv/xim.c
@@ -501,7 +501,7 @@ XIC X11DRV_CreateIC(XIM xim, struct x11drv_win_data *data)
     XVaNestedList preedit = NULL;
     XVaNestedList status = NULL;
     XIC xic;
-    XICCallback destroy = {(XPointer)data, X11DRV_DestroyIC};
+    XIMCallback destroy = {(XPointer)data, (XIMProc)X11DRV_DestroyIC};
     XIMCallback P_StartCB;
     XIMCallback P_DoneCB;
     XIMCallback P_DrawCB;


From rob at codeweavers.com  Mon Apr 14 12:36:44 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Mon, 14 Apr 2008 18:36:44 +0100
Subject: error: `XICCallback' undeclared (Solaris build problem)
In-Reply-To: <200804141726096658890006MAA5@nm06mta.auone-net.jp>
References: <4803596E.1030800@sun.com>
	<200804141726096658890006MAA5@nm06mta.auone-net.jp>
Message-ID: <4803962C.8060801@codeweavers.com>

Kusanagi Kouichi wrote:
> Does this patch fix the problem?
>
> -    XICCallback destroy = {(XPointer)data, X11DRV_DestroyIC};
> +    XIMCallback destroy = {(XPointer)data, (XIMProc)X11DRV_DestroyIC};
>   

I think a configure check may be a more appropriate fix.

-- 
Rob Shearman



From kai.blin at gmail.com  Mon Apr 14 12:41:55 2008
From: kai.blin at gmail.com (Kai Blin)
Date: Mon, 14 Apr 2008 19:41:55 +0200
Subject: ws2_32: Work around the host name resolving to 127.x.x.x when
	using that for binding.
In-Reply-To: <200804142030.41154.lich@math.spbu.ru>
References: <200804142030.41154.lich@math.spbu.ru>
Message-ID: <200804141942.00589.kai.blin@gmail.com>

On Monday 14 April 2008 18:30:40 Kirill K. Smirnov wrote:
> Hi,
>
> nitpick:
> > +                        /* Trying to bind to the default hots interface,

Thanks for the catch, revised patch sent.

Cheers,
Kai
-- 
Kai Blin
WorldForge developer  http://www.worldforge.org/
Wine developer        http://wiki.winehq.org/KaiBlin
Samba team member     http://www.samba.org/samba/team/
--
Will code for cotton.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080414/fb79f269/attachment.pgp 

From stefan at codeweavers.com  Mon Apr 14 12:45:45 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Mon, 14 Apr 2008 19:45:45 +0200
Subject: IWineD3DBaseTextureImpl_SetAutoGenFilterType missing break inside
	switch
In-Reply-To: <47CC5ABB01651443A88DB8EC5B4D657BE6404B@S4DE8PSAANK.mitte.t-com.de>
References: <47CC5ABB01651443A88DB8EC5B4D657BE6404B@S4DE8PSAANK.mitte.t-com.de>
Message-ID: <200804141945.45824.stefan@codeweavers.com>

Am Montag, 14. April 2008 17:16:25 schrieb Hoehle, Joerg-Cyril:
> Hi,
>
> regardless of issue
> http://bugs.winehq.org/show_bug.cgi?id=11167
> which suggests that the function is incorrect it its use of GL parameters,
> so it needs fixing, you may wish to apply the following (minor) patch.
>
> dlls/wined3d/basetexture.c:IWineD3DBaseTextureImpl_SetAutoGenFilterType
> missing break inside switch
The patch looks ok.


From julliard at winehq.org  Mon Apr 14 14:00:47 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 14 Apr 2008 21:00:47 +0200
Subject: [1/2] shlwapi: Fixed the todo blocks in the SHCreateStreamOnFile
	tests. [try 2]
In-Reply-To: <3f4fd2640804130613q1c93aea4wa57f609446beadca@mail.gmail.com>
	(Reece Dunn's message of "Sun, 13 Apr 2008 14:13:36 +0100")
References: <3f4fd2640804130613q1c93aea4wa57f609446beadca@mail.gmail.com>
Message-ID: <87wsn05kio.fsf@wine.dyndns.org>

"Reece Dunn" <msclrhd at googlemail.com> writes:

> @@ -120,12 +119,12 @@ static HRESULT WINAPI IStream_fnRead(IStream *iface, void* pv, ULONG cb, ULONG*
>    TRACE("(%p,%p,0x%08x,%p)\n", This, pv, cb, pcbRead);
>  
>    if (!pv)
> -    return STG_E_INVALIDPOINTER;
> +    return S_OK;

It's very unlikely that this is the correct behavior in all cases.

> @@ -459,7 +458,9 @@ HRESULT WINAPI SHCreateStreamOnFileEx(LPCWSTR lpszPath, DWORD dwMode,
>    switch(STGM_CREATE_MODE(dwMode))
>    {
>    case STGM_FAILIFTHERE:
> -    dwCreate = OPEN_EXISTING;
> +    if (bCreate && PathFileExistsW(lpszPath))
> +      return HRESULT_FROM_WIN32(ERROR_FILE_EXISTS);
> +    dwCreate = bCreate ? CREATE_ALWAYS : OPEN_EXISTING;

That case should be handled by CreateFile, you shouldn't check for the
file existence explicitly.

-- 
Alexandre Julliard
julliard at winehq.org


From khodych at gmail.com  Mon Apr 14 14:03:37 2008
From: khodych at gmail.com (Sergey Khodych)
Date: Mon, 14 Apr 2008 22:03:37 +0300
Subject: dinput: Convert keyboard buffer from internal data format to
	user data format
In-Reply-To: <48024BE1.1090008@kievinfo.com>
References: <4802384D.1090704@gmail.com> <48024BE1.1090008@kievinfo.com>
Message-ID: <4803AA89.3070806@gmail.com>

A possibility of using custom data format, for any type of devices, is
described in DirectX SDK documentation.
For example Monolith's  F.E.A.R. use this method.

> Any particular reason for this? Do you have a program that sets different 
> data format? The reason I ask - copying 256 bytes is much faster then 
> iterating over the whole data format and copying one byte at a time.
> 
> Vitaliy.
> 
> 
> 




From khodych at gmail.com  Mon Apr 14 14:07:22 2008
From: khodych at gmail.com (Sergey Khodych)
Date: Mon, 14 Apr 2008 22:07:22 +0300
Subject: dinput: Implement DIPROP_KEYNAME property for keyboard device
In-Reply-To: <48024DC2.3020008@kievinfo.com>
References: <48023854.9020308@gmail.com> <48024DC2.3020008@kievinfo.com>
Message-ID: <4803AB6A.3040900@gmail.com>

> 
>> ...
>> +                hr = SysKeyboardWImpl_GetObjectInfo( (LPDIRECTINPUTDEVICE8W)iface , &didoi,
>> +                                                     ps->diph.dwObj, ps->diph.dwHow );
> 
> You mixing unicode and ascii. Also if you are implementing 
> SysKeyboardAImpl_GetProperty you should also implement it's unicode 
> counterpart SysKeyboardWImpl_GetProperty.
Realization of GetProperty for keyboard device for unicode and ascii do
not differ at this time.









From htl10 at users.sourceforge.net  Mon Apr 14 14:19:37 2008
From: htl10 at users.sourceforge.net (Hin-Tak Leung)
Date: Mon, 14 Apr 2008 19:19:37 +0000 (GMT)
Subject: Including Mono within a Wine package - should Wine expect this?
In-Reply-To: <a71bd89a0804131350o4935bf68n1de7253d00ab1e6e@mail.gmail.com>
Message-ID: <666369.76248.qm@web23115.mail.ird.yahoo.com>

--- On Sun, 13/4/08, Dan Kegel <dank at kegel.com> wrote:
<snipped>
> > > 2) porting Mono's WinForms on top of Wine
> gdiplus
> > > instead of Mono gdiplus (and making it more
> win32-ish as
> > > a result)
> >
> >  Mono is using MS GDI+ on Windows since it uses GDI+.
> Mono's libgdiplus is
> > only used on non-Windows platforms.
> 
> I guess I assumed that Mono used native WinForms on
> Windows,
> and that its winforms code was only used on Linux.  I
> clearly
> don't know enough about Mono to discuss it
> intelligently :-)
<snipped>

I can't comment on anything else, but after trying to get a .NET WinForms application
(mentioned in some of the bugs I filed) for a few months under the 3 options of 
native linux mono, wine+.NET and wine+mono, I can say that win32 mono uses P/Invoke
*differently* from how .NET2 does it, and the missing APIs required to get an
application to work with the wine + win32 mono and wine +MS.NET combo is different.
So some part of the applications runs better with wine + win32 mono and some better
with wine + MS.NET ... win32 mono and MS.NET just seems to have different native code dependencies.




      ___________________________________________________________ 
Yahoo! For Good helps you make a difference  

http://uk.promotions.yahoo.com/forgood/


From juan.lang at gmail.com  Mon Apr 14 14:20:19 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Mon, 14 Apr 2008 12:20:19 -0700
Subject: gdiplus: (try2) GdipCloneStringFormat
Message-ID: <3a768c550804141220g4c819a61s979ee74e2ef8add7@mail.gmail.com>

Hi Nikolay,

+GpStatus WINGDIPAPI GdipCloneStrinFormat(GDIPCONST

Typo:  s/StrinFormat/StringFormat/
--Juan


From julliard at winehq.org  Mon Apr 14 15:04:26 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 14 Apr 2008 22:04:26 +0200
Subject: [PATCH 1/6] includes: update aviriff header file
In-Reply-To: <b130c85e0804141221t23034cfcuab1c4936543a9697@mail.gmail.com>
	(Maarten Lankhorst's message of "Mon, 14 Apr 2008 12:21:24 -0700")
References: <b130c85e0804141221t23034cfcuab1c4936543a9697@mail.gmail.com>
Message-ID: <87prss5hkl.fsf@wine.dyndns.org>

"Maarten Lankhorst" <m.b.lankhorst at gmail.com> writes:

> @@ -161,4 +186,135 @@ typedef struct _avimetaindex
>      DWORD adwIndex[0];
>  } AVIMETAINDEX;
>  
> -/* FIXME: index structures missing */
> +#define ckidAVISUPERINDEX FCC('i','n','d','x')
> +typedef struct _avisuperindex {
> +    FOURCC fcc;
> +    UINT cb;
> +    WORD wLongsPerEntry;
> +    BYTE bIndexSubType;
> +    BYTE bIndexType;
> +    DWORD nEntriesInUse;
> +    DWORD dwChunkId;
> +    DWORD dwReserved[3];
> +    struct _avisuperindex_entry {
> +        DWORDLONG qwOffset;
> +        DWORD dwSize;
> +        DWORD dwDuration;
> +    } aIndex[0];
> +} AVISUPERINDEX;

Zero-size arrays are not portable, and this is not what the MS header
does anyway.

-- 
Alexandre Julliard
julliard at winehq.org


From slash at ma.neweb.ne.jp  Mon Apr 14 16:03:53 2008
From: slash at ma.neweb.ne.jp (Kusanagi Kouichi)
Date: Tue, 15 Apr 2008 06:03:53 +0900
Subject: error: `XICCallback' undeclared (Solaris build problem)
In-Reply-To: <4803962C.8060801@codeweavers.com>
References: <4803596E.1030800@sun.com>
	<200804141726096658890006MAA5@nm06mta.auone-net.jp>
	<4803962C.8060801@codeweavers.com>
Message-ID: <200804142103535878180006MA82@nm06mta.auone-net.jp>

On Mon, Apr 14, 2008 at 06:36:44PM +0100, Robert Shearman wrote:
> 
> I think a configure check may be a more appropriate fix.
> 

I don't know proper way to check whether XICCallback is defined.
But this seems to work.

diff --git a/configure b/configure
index b66a40a..01fdf19 100755
--- a/configure
+++ b/configure
@@ -10686,6 +10686,115 @@ esac
 fi
 
 
+                { echo "$as_me:$LINENO: checking for XICCallback.callback" >&5
+echo $ECHO_N "checking for XICCallback.callback... $ECHO_C" >&6; }
+if test "${ac_cv_member_XICCallback_callback+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+#ifdef HAVE_X11_XLIB_H
+#include <X11/Xlib.h>
+#endif
+
+int
+main ()
+{
+static XICCallback ac_aggr;
+if (ac_aggr.callback)
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext
+if { (ac_try="$ac_compile"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
+  (eval "$ac_compile") 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && {
+	 test -z "$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest.$ac_objext; then
+  ac_cv_member_XICCallback_callback=yes
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+	cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+#ifdef HAVE_X11_XLIB_H
+#include <X11/Xlib.h>
+#endif
+
+int
+main ()
+{
+static XICCallback ac_aggr;
+if (sizeof ac_aggr.callback)
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext
+if { (ac_try="$ac_compile"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
+  (eval "$ac_compile") 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && {
+	 test -z "$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest.$ac_objext; then
+  ac_cv_member_XICCallback_callback=yes
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+	ac_cv_member_XICCallback_callback=no
+fi
+
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+{ echo "$as_me:$LINENO: result: $ac_cv_member_XICCallback_callback" >&5
+echo "${ECHO_T}$ac_cv_member_XICCallback_callback" >&6; }
+if test $ac_cv_member_XICCallback_callback = yes; then
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_XICCALLBACK_CALLBACK 1
+_ACEOF
+
+
+fi
+
+
 
         opengl_msg=""
     if test "x$with_opengl" != "xno"
diff --git a/configure.ac b/configure.ac
index e9dadee..b5c4bf2 100644
--- a/configure.ac
+++ b/configure.ac
@@ -698,6 +698,12 @@ then
         WINE_NOTICE_WITH(xcomposite,[test "x$ac_cv_lib_soname_Xcomposite" = "x"],
                          [libxcomposite development files not found, Xcomposite won't be supported.])
 
+        dnl *** Check for XICCallback struct
+        AC_CHECK_MEMBERS([XICCallback.callback],,,
+[#ifdef HAVE_X11_XLIB_H
+#include <X11/Xlib.h>
+#endif])
+
     dnl *** End of X11/Xlib.h check
 
     dnl Check for the presence of OpenGL
diff --git a/dlls/winex11.drv/xim.c b/dlls/winex11.drv/xim.c
index d4df9f7..85d37e8 100644
--- a/dlls/winex11.drv/xim.c
+++ b/dlls/winex11.drv/xim.c
@@ -501,11 +501,13 @@ XIC X11DRV_CreateIC(XIM xim, struct x11drv_win_data *data)
     XVaNestedList preedit = NULL;
     XVaNestedList status = NULL;
     XIC xic;
-    XICCallback destroy = {(XPointer)data, X11DRV_DestroyIC};
-    XIMCallback P_StartCB;
-    XIMCallback P_DoneCB;
-    XIMCallback P_DrawCB;
-    XIMCallback P_CaretCB;
+#ifdef HAVE_XICCALLBACK_CALLBACK
+    XICCallback destroy = {(XPointer)data, (XICProc)X11DRV_DestroyIC};
+    XICCallback P_StartCB, P_DoneCB, P_DrawCB, P_CaretCB;
+#else
+    XIMCallback destroy = {(XPointer)data, (XIMProc)X11DRV_DestroyIC};
+    XIMCallback P_StartCB, P_DoneCB, P_DrawCB, P_CaretCB;
+#endif
     LANGID langid = PRIMARYLANGID(LANGIDFROMLCID(GetThreadLocale()));
     Window win = data->whole_window;
 
@@ -531,13 +533,20 @@ XIC X11DRV_CreateIC(XIM xim, struct x11drv_win_data *data)
 
     /* create callbacks */
     P_StartCB.client_data = NULL;
-    P_StartCB.callback = (XIMProc)XIMPreEditStartCallback;
     P_DoneCB.client_data = NULL;
-    P_DoneCB.callback = (XIMProc)XIMPreEditDoneCallback;
     P_DrawCB.client_data = NULL;
-    P_DrawCB.callback = (XIMProc)XIMPreEditDrawCallback;
     P_CaretCB.client_data = NULL;
+#ifdef HAVE_XICCALLBACK_CALLBACK
+    P_StartCB.callback = (XICProc)XIMPreEditStartCallback;
+    P_DoneCB.callback = (XICProc)XIMPreEditDoneCallback;
+    P_DrawCB.callback = (XICProc)XIMPreEditDrawCallback;
+    P_CaretCB.callback = (XICProc)XIMPreEditCaretCallback;
+#else
+    P_StartCB.callback = (XIMProc)XIMPreEditStartCallback;
+    P_DoneCB.callback = (XIMProc)XIMPreEditDoneCallback;
+    P_DrawCB.callback = (XIMProc)XIMPreEditDrawCallback;
     P_CaretCB.callback = (XIMProc)XIMPreEditCaretCallback;
+#endif
 
     if ((ximStyle & (XIMPreeditNothing | XIMPreeditNone)) == 0)
     {
diff --git a/include/config.h.in b/include/config.h.in
index ac464db..f867662 100644
--- a/include/config.h.in
+++ b/include/config.h.in
@@ -945,6 +945,9 @@
 /* Define to 1 if you have the <X11/Xutil.h> header file. */
 #undef HAVE_X11_XUTIL_H
 
+/* Define to 1 if `callback' is member of `XICCallback'. */
+#undef HAVE_XICCALLBACK_CALLBACK
+
 /* Define if you have the XKB extension */
 #undef HAVE_XKB
 


From kai.blin at gmail.com  Mon Apr 14 16:04:52 2008
From: kai.blin at gmail.com (Kai Blin)
Date: Mon, 14 Apr 2008 23:04:52 +0200
Subject: ws2_32: Work around the host name resolving to 127.x.x.x when
	using that for binding.
In-Reply-To: <Pine.LNX.4.64.0804141934580.24510@dragoshel>
References: <200804141605.23704.kai.blin@gmail.com>
	<20080414162932.GX5348@byleth.sc-networks.de>
	<Pine.LNX.4.64.0804141934580.24510@dragoshel>
Message-ID: <200804142304.58241.kai.blin@gmail.com>

On Monday 14 April 2008 18:42:26 Paul Chitescu wrote:

> Binding to a specific address is the only easy way of detecting which
> interface an UDP packet was received on since recvfrom() only gives source
> address, not destination. Listening on 0.0.0.0 would make impossible to
> tell which interface a packet was received on. Furthermore, a program that
> explicitely tries to bind to each interface would fail all but the first
> bind and possibly bail out. Probably many games that use UDP would break.

I'm currently trying to fix apps that fail doing the following (which seems to 
be a popular way among game developers), in pseudo-code. 

hostname = gethostname();
hostent = gethostbyname(hostname);
sockaddr->sin_addr = hostent->addr;
sock = socket();
bind(sock, sockaddr);

Which, as Christoph noted, cause windows apps to bind to loopback addresses, 
breaking the networking. This only started to happen recently as recently 
Linux distros started mapping the machine's hostname to a loopback address. I 
don't think Wine ever used the registry for anything like that.

Cheers,
Kai

-- 
Kai Blin
WorldForge developer  http://www.worldforge.org/
Wine developer        http://wiki.winehq.org/KaiBlin
Samba team member     http://www.samba.org/samba/team/
--
Will code for cotton.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080414/f44e06c8/attachment.pgp 

From Stefan.Leichter at camline.com  Mon Apr 14 16:11:01 2008
From: Stefan.Leichter at camline.com (Stefan Leichter)
Date: Mon, 14 Apr 2008 23:11:01 +0200
Subject: winex11: Standardize a stub trace and add a trailing '\n'.
In-Reply-To: <alpine.DEB.1.10.0804140101131.12478@amboise.dolphin>
References: <alpine.DEB.1.10.0804140101131.12478@amboise.dolphin>
Message-ID: <200804142311.01886.Stefan.Leichter@camline.com>

Am Monday 14 April 2008 01:01 schrieb Francois Gouget:
> ---
> +    FIXME("(%p, %x): stub\n");

You forgot the parameters hIMC and fFlag

Bye Stefan


From julliard at winehq.org  Mon Apr 14 16:11:46 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 14 Apr 2008 23:11:46 +0200
Subject: error: `XICCallback' undeclared (Solaris build problem)
In-Reply-To: <200804142103535878180006MA82@nm06mta.auone-net.jp> (Kusanagi
	Kouichi's message of "Tue, 15 Apr 2008 06:03:53 +0900")
References: <4803596E.1030800@sun.com>
	<200804141726096658890006MAA5@nm06mta.auone-net.jp>
	<4803962C.8060801@codeweavers.com>
	<200804142103535878180006MA82@nm06mta.auone-net.jp>
Message-ID: <87d4os5egd.fsf@wine.dyndns.org>

Kusanagi Kouichi <slash at ma.neweb.ne.jp> writes:

> On Mon, Apr 14, 2008 at 06:36:44PM +0100, Robert Shearman wrote:
>> 
>> I think a configure check may be a more appropriate fix.
>> 
>
> I don't know proper way to check whether XICCallback is defined.
> But this seems to work.

Is it just the type that is not defined, or is the callback feature
itself not supported?

-- 
Alexandre Julliard
julliard at winehq.org


From slash at ma.neweb.ne.jp  Mon Apr 14 18:09:02 2008
From: slash at ma.neweb.ne.jp (Kusanagi Kouichi)
Date: Tue, 15 Apr 2008 08:09:02 +0900
Subject: error: `XICCallback' undeclared (Solaris build problem)
In-Reply-To: <87d4os5egd.fsf@wine.dyndns.org>
References: <4803596E.1030800@sun.com>
	<200804141726096658890006MAA5@nm06mta.auone-net.jp>
	<4803962C.8060801@codeweavers.com>
	<200804142103535878180006MA82@nm06mta.auone-net.jp>
	<87d4os5egd.fsf@wine.dyndns.org>
Message-ID: <200804142309031987210006MAC3@nm06mta.auone-net.jp>

On Mon, Apr 14, 2008 at 11:11:46PM +0200, Alexandre Julliard wrote:
> Kusanagi Kouichi <slash at ma.neweb.ne.jp> writes:
> 
> > On Mon, Apr 14, 2008 at 06:36:44PM +0100, Robert Shearman wrote:
> >> 
> >> I think a configure check may be a more appropriate fix.
> >> 
> >
> > I don't know proper way to check whether XICCallback is defined.
> > But this seems to work.
> 
> Is it just the type that is not defined, or is the callback feature
> itself not supported?

Solaris ought to support callback. Thus existence of XICCallback will be
irrelevant to callback functionality.


From juan.lang at gmail.com  Mon Apr 14 18:58:13 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Mon, 14 Apr 2008 16:58:13 -0700
Subject: Apparently it is possible to have chm file without #STRINGS in it,
	so we should not stop processing file at it. Fixes bug #12498
Message-ID: <3a768c550804141658x6051f8a3raadc85603cedc023@mail.gmail.com>

Hi Tomasz,

-        info->WinType.pszToc = strdupW(info->pCHMInfo->defToc);
+        info->WinType.pszToc = strdupW(info->pCHMInfo->defToc ?
info->pCHMInfo->defToc : null);

Please don't use null, it's not portable.  Also, what has this change
accomplished?  If strdupW succeeds when passed NULL, the existing line
would already have done the same thing, so you've added a test for no
benefit.
--Juan


From ivg231 at gmail.com  Mon Apr 14 00:08:30 2008
From: ivg231 at gmail.com (Ivan Gyurdiev)
Date: Mon, 14 Apr 2008 01:08:30 -0400
Subject: WineD3D: WineD3D: Use the shader backend to enable / disable
	atifs and nvts
In-Reply-To: <200804132126.19422.stefan@codeweavers.com>
References: <200804110031.13345.stefan@codeweavers.com>
	<200804111618.49900.stefan@codeweavers.com>
	<48001DF5.3050401@gmail.com>
	<200804132126.19422.stefan@codeweavers.com>
Message-ID: <4802E6CE.9070001@gmail.com>


> What are your opinions?
I can't comment on the specifics of the state table design - would have 
to leave that to Henri. However, anything that increases modularity is a 
good thing. I'm in favor of the overall direction to break up the 
pipeline into component stages.  Smaller components are more easy to 
manage - specifically in your case this should allow separate backends 
to be chosen per pipeline stage.

It seems reasonable that these changes would be deferred until after 1.0.

Ivan


From wine-devel at kievinfo.com  Mon Apr 14 21:03:02 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Mon, 14 Apr 2008 20:03:02 -0600
Subject: dinput: Convert keyboard buffer from internal data format to
	user data format
In-Reply-To: <4803AA89.3070806@gmail.com>
References: <4802384D.1090704@gmail.com> <48024BE1.1090008@kievinfo.com>
	<4803AA89.3070806@gmail.com>
Message-ID: <48040CD6.2030105@kievinfo.com>

Sergey Khodych wrote:
>> Any particular reason for this? Do you have a program that sets different 
>> data format? The reason I ask - copying 256 bytes is much faster then 
>> iterating over the whole data format and copying one byte at a time.
>>
> A possibility of using custom data format, for any type of devices, is
> described in DirectX SDK documentation.
> For example Monolith's  F.E.A.R. use this method.

That is not what I asked. If you read MSDN it tells lots of things that are 
not true. Also I do not recall seeing any problems with FEAR game that were 
related dinput. If you have that bug handle please point me to it.

Vitaliy.


From wine-devel at kievinfo.com  Mon Apr 14 21:06:30 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Mon, 14 Apr 2008 20:06:30 -0600
Subject: dinput: Implement DIPROP_KEYNAME property for keyboard device
In-Reply-To: <4803AB6A.3040900@gmail.com>
References: <48023854.9020308@gmail.com> <48024DC2.3020008@kievinfo.com>
	<4803AB6A.3040900@gmail.com>
Message-ID: <48040DA6.6090708@kievinfo.com>

Sergey Khodych wrote:
>>> ...
>>> +                hr = SysKeyboardWImpl_GetObjectInfo( (LPDIRECTINPUTDEVICE8W)iface , &didoi,
>>> +                                                     ps->diph.dwObj, ps->diph.dwHow );
>> You mixing unicode and ascii. Also if you are implementing 
>> SysKeyboardAImpl_GetProperty you should also implement it's unicode 
>> counterpart SysKeyboardWImpl_GetProperty.
> Realization of GetProperty for keyboard device for unicode and ascii do
> not differ at this time.
> 

In ascii function you are calling unicode function and copying it's output 
(unicode string) to the ascii string buffer. This is wrong. Also because 
these functions deal with strings you have to implement both ascii and 
unicode functions at the same time. You can't forward one to the other.

Vitaliy.



From wine-devel at kievinfo.com  Mon Apr 14 21:11:41 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Mon, 14 Apr 2008 20:11:41 -0600
Subject: Feature Request: Registry / winecfg entry for launching
	an	application in a wineexplorer window
In-Reply-To: <b6bb06270804141004nd99e48are3158647a4482bc2@mail.gmail.com>
References: <4803182C.9070209@open-vote.org>	<200804140534.33333.chris.kcat@gmail.com>
	<b6bb06270804141004nd99e48are3158647a4482bc2@mail.gmail.com>
Message-ID: <48040EDD.7010708@kievinfo.com>

Austin English wrote:
> On Mon, Apr 14, 2008 at 7:34 AM, Chris Robinson <chris.kcat at gmail.com> wrote:
>>  IIRC, the problem is you can't have two Wine processes using two different
>>  desktops. Try this: start an app without virtual desktop and leave it
>>  running, run winecfg and turn on virtual desktop (make sure to click Apply),
>>  then try to start another app. It won't use a virtual desktop.
>>
>>
> 
> Terminal one:
> $ rm -rf ~/.wine
> $ wine notepad
> 
> Terminal two:
> $ winecfg # enable virtual desktop
> $ winemine # doesn't go in virtual desktop
> $ wine explorer /desktop=name,1024x768 winemine # goes in virtual desktop
> 
That's by design when you change configuration via winecfg it applies to 
"default" desktop only. And if it's already active (desktop for your 
notepad) it won't just become virtual desktop. When you using "name" that 
creates separate desktop with that name and requested parameters.

Vitaliy


From frick at sc-networks.de  Tue Apr 15 02:45:43 2008
From: frick at sc-networks.de (Christoph Frick)
Date: Tue, 15 Apr 2008 09:45:43 +0200
Subject: ws2_32: Work around the host name resolving to 127.x.x.x when
	using that for binding.
In-Reply-To: <200804142304.58241.kai.blin@gmail.com>
References: <200804141605.23704.kai.blin@gmail.com>
	<20080414162932.GX5348@byleth.sc-networks.de>
	<Pine.LNX.4.64.0804141934580.24510@dragoshel>
	<200804142304.58241.kai.blin@gmail.com>
Message-ID: <20080415074543.GY5348@byleth.sc-networks.de>

On Mon, Apr 14, 2008 at 11:04:52PM +0200, Kai Blin wrote:

> > Binding to a specific address is the only easy way of detecting
> > which interface an UDP packet was received on since recvfrom() only
> > gives source address, not destination. Listening on 0.0.0.0 would
> > make impossible to tell which interface a packet was received on.
> > Furthermore, a program that explicitely tries to bind to each
> > interface would fail all but the first bind and possibly bail out.
> > Probably many games that use UDP would break.

does then windows actually handle also the other way around? like i
listen on 127.0.0.1:12345 in windows and i will not be able to connect
to 192.168.1.1:12345 on the same machine? i know it is "supported" - but
i have the nagging doubt, that it will not work the same way as in unix
but wine maps this behaviour as as unix would do it the same way.
IANAE...

> Which, as Christoph noted, cause windows apps to bind to loopback
> addresses, breaking the networking. This only started to happen
> recently as recently Linux distros started mapping the machine's
> hostname to a loopback address. I don't think Wine ever used the
> registry for anything like that.

not wine in its guts - the apps. wine now uses the /etc/hosts to
determine the ip of the machine and put this informations in the places,
where windows keeps them. one of this places was the registry
(.../nettrans/tcpip/... or something). some apps use this informations.
maybe 

-- 
cu
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 163 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080415/7bdb9694/attachment.pgp 

From Petr.Sumbera at Sun.COM  Tue Apr 15 03:19:18 2008
From: Petr.Sumbera at Sun.COM (Petr Sumbera)
Date: Tue, 15 Apr 2008 10:19:18 +0200
Subject: error: `XICCallback' undeclared (Solaris build problem)
In-Reply-To: <200804141726096658890006MAA5@nm06mta.auone-net.jp>
References: <4803596E.1030800@sun.com>
	<200804141726096658890006MAA5@nm06mta.auone-net.jp>
Message-ID: <48046506.8010007@sun.com>

I can confirm that this works (I mean it compiles).

Thanks,

Petr

Kusanagi Kouichi wrote:
> Does this patch fix the problem?
> 
> diff --git a/dlls/winex11.drv/xim.c b/dlls/winex11.drv/xim.c
> index d4df9f7..b66cf87 100644
> --- a/dlls/winex11.drv/xim.c
> +++ b/dlls/winex11.drv/xim.c
> @@ -501,7 +501,7 @@ XIC X11DRV_CreateIC(XIM xim, struct x11drv_win_data *data)
>      XVaNestedList preedit = NULL;
>      XVaNestedList status = NULL;
>      XIC xic;
> -    XICCallback destroy = {(XPointer)data, X11DRV_DestroyIC};
> +    XIMCallback destroy = {(XPointer)data, (XIMProc)X11DRV_DestroyIC};
>      XIMCallback P_StartCB;
>      XIMCallback P_DoneCB;
>      XIMCallback P_DrawCB;



From dmitry at codeweavers.com  Tue Apr 15 03:52:03 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Tue, 15 Apr 2008 17:52:03 +0900
Subject: [WineHQ][WWN] WWN 345
References: <20080415034454.D66A4166CF23@bluesata.com>
Message-ID: <001c01c89ed5$fbf92150$a600fea9@DMITRY>

"Zachary Goldberg" <zgs at seas.upenn.edu> wrote:

> +<section
> + title="News: new WineTricks, 1.0 status updates and more"
> + subject="Wine"
> + archive="http://www.xkcd.com"
> + posts="0"
> +>

How is the url above related to the title?

-- 
Dmitry.


From Petr.Sumbera at Sun.COM  Tue Apr 15 04:13:08 2008
From: Petr.Sumbera at Sun.COM (Petr Sumbera)
Date: Tue, 15 Apr 2008 11:13:08 +0200
Subject: error: `XICCallback' undeclared (Solaris build problem)
In-Reply-To: <200804142103535878180006MA82@nm06mta.auone-net.jp>
References: <4803596E.1030800@sun.com>
	<200804141726096658890006MAA5@nm06mta.auone-net.jp>
	<4803962C.8060801@codeweavers.com>
	<200804142103535878180006MA82@nm06mta.auone-net.jp>
Message-ID: <480471A4.3090902@sun.com>

This works properly on Solaris. Please submit patch if everybody is 
happy with it.

Thanks,

Petr

Kusanagi Kouichi wrote:
> On Mon, Apr 14, 2008 at 06:36:44PM +0100, Robert Shearman wrote:
>> I think a configure check may be a more appropriate fix.
>>
> 
> I don't know proper way to check whether XICCallback is defined.
> But this seems to work.
> 
> diff --git a/configure b/configure
> index b66a40a..01fdf19 100755
> --- a/configure
> +++ b/configure
> @@ -10686,6 +10686,115 @@ esac
>  fi
>  
>  
> +                { echo "$as_me:$LINENO: checking for XICCallback.callback" >&5
> +echo $ECHO_N "checking for XICCallback.callback... $ECHO_C" >&6; }
> +if test "${ac_cv_member_XICCallback_callback+set}" = set; then
> +  echo $ECHO_N "(cached) $ECHO_C" >&6
> +else
> +  cat >conftest.$ac_ext <<_ACEOF
> +/* confdefs.h.  */
> +_ACEOF
> +cat confdefs.h >>conftest.$ac_ext
> +cat >>conftest.$ac_ext <<_ACEOF
> +/* end confdefs.h.  */
> +#ifdef HAVE_X11_XLIB_H
> +#include <X11/Xlib.h>
> +#endif
> +
> +int
> +main ()
> +{
> +static XICCallback ac_aggr;
> +if (ac_aggr.callback)
> +return 0;
> +  ;
> +  return 0;
> +}
> +_ACEOF
> +rm -f conftest.$ac_objext
> +if { (ac_try="$ac_compile"
> +case "(($ac_try" in
> +  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
> +  *) ac_try_echo=$ac_try;;
> +esac
> +eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
> +  (eval "$ac_compile") 2>conftest.er1
> +  ac_status=$?
> +  grep -v '^ *+' conftest.er1 >conftest.err
> +  rm -f conftest.er1
> +  cat conftest.err >&5
> +  echo "$as_me:$LINENO: \$? = $ac_status" >&5
> +  (exit $ac_status); } && {
> +	 test -z "$ac_c_werror_flag" ||
> +	 test ! -s conftest.err
> +       } && test -s conftest.$ac_objext; then
> +  ac_cv_member_XICCallback_callback=yes
> +else
> +  echo "$as_me: failed program was:" >&5
> +sed 's/^/| /' conftest.$ac_ext >&5
> +
> +	cat >conftest.$ac_ext <<_ACEOF
> +/* confdefs.h.  */
> +_ACEOF
> +cat confdefs.h >>conftest.$ac_ext
> +cat >>conftest.$ac_ext <<_ACEOF
> +/* end confdefs.h.  */
> +#ifdef HAVE_X11_XLIB_H
> +#include <X11/Xlib.h>
> +#endif
> +
> +int
> +main ()
> +{
> +static XICCallback ac_aggr;
> +if (sizeof ac_aggr.callback)
> +return 0;
> +  ;
> +  return 0;
> +}
> +_ACEOF
> +rm -f conftest.$ac_objext
> +if { (ac_try="$ac_compile"
> +case "(($ac_try" in
> +  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
> +  *) ac_try_echo=$ac_try;;
> +esac
> +eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
> +  (eval "$ac_compile") 2>conftest.er1
> +  ac_status=$?
> +  grep -v '^ *+' conftest.er1 >conftest.err
> +  rm -f conftest.er1
> +  cat conftest.err >&5
> +  echo "$as_me:$LINENO: \$? = $ac_status" >&5
> +  (exit $ac_status); } && {
> +	 test -z "$ac_c_werror_flag" ||
> +	 test ! -s conftest.err
> +       } && test -s conftest.$ac_objext; then
> +  ac_cv_member_XICCallback_callback=yes
> +else
> +  echo "$as_me: failed program was:" >&5
> +sed 's/^/| /' conftest.$ac_ext >&5
> +
> +	ac_cv_member_XICCallback_callback=no
> +fi
> +
> +rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
> +fi
> +
> +rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
> +fi
> +{ echo "$as_me:$LINENO: result: $ac_cv_member_XICCallback_callback" >&5
> +echo "${ECHO_T}$ac_cv_member_XICCallback_callback" >&6; }
> +if test $ac_cv_member_XICCallback_callback = yes; then
> +
> +cat >>confdefs.h <<_ACEOF
> +#define HAVE_XICCALLBACK_CALLBACK 1
> +_ACEOF
> +
> +
> +fi
> +
> +
>  
>          opengl_msg=""
>      if test "x$with_opengl" != "xno"
> diff --git a/configure.ac b/configure.ac
> index e9dadee..b5c4bf2 100644
> --- a/configure.ac
> +++ b/configure.ac
> @@ -698,6 +698,12 @@ then
>          WINE_NOTICE_WITH(xcomposite,[test "x$ac_cv_lib_soname_Xcomposite" = "x"],
>                           [libxcomposite development files not found, Xcomposite won't be supported.])
>  
> +        dnl *** Check for XICCallback struct
> +        AC_CHECK_MEMBERS([XICCallback.callback],,,
> +[#ifdef HAVE_X11_XLIB_H
> +#include <X11/Xlib.h>
> +#endif])
> +
>      dnl *** End of X11/Xlib.h check
>  
>      dnl Check for the presence of OpenGL
> diff --git a/dlls/winex11.drv/xim.c b/dlls/winex11.drv/xim.c
> index d4df9f7..85d37e8 100644
> --- a/dlls/winex11.drv/xim.c
> +++ b/dlls/winex11.drv/xim.c
> @@ -501,11 +501,13 @@ XIC X11DRV_CreateIC(XIM xim, struct x11drv_win_data *data)
>      XVaNestedList preedit = NULL;
>      XVaNestedList status = NULL;
>      XIC xic;
> -    XICCallback destroy = {(XPointer)data, X11DRV_DestroyIC};
> -    XIMCallback P_StartCB;
> -    XIMCallback P_DoneCB;
> -    XIMCallback P_DrawCB;
> -    XIMCallback P_CaretCB;
> +#ifdef HAVE_XICCALLBACK_CALLBACK
> +    XICCallback destroy = {(XPointer)data, (XICProc)X11DRV_DestroyIC};
> +    XICCallback P_StartCB, P_DoneCB, P_DrawCB, P_CaretCB;
> +#else
> +    XIMCallback destroy = {(XPointer)data, (XIMProc)X11DRV_DestroyIC};
> +    XIMCallback P_StartCB, P_DoneCB, P_DrawCB, P_CaretCB;
> +#endif
>      LANGID langid = PRIMARYLANGID(LANGIDFROMLCID(GetThreadLocale()));
>      Window win = data->whole_window;
>  
> @@ -531,13 +533,20 @@ XIC X11DRV_CreateIC(XIM xim, struct x11drv_win_data *data)
>  
>      /* create callbacks */
>      P_StartCB.client_data = NULL;
> -    P_StartCB.callback = (XIMProc)XIMPreEditStartCallback;
>      P_DoneCB.client_data = NULL;
> -    P_DoneCB.callback = (XIMProc)XIMPreEditDoneCallback;
>      P_DrawCB.client_data = NULL;
> -    P_DrawCB.callback = (XIMProc)XIMPreEditDrawCallback;
>      P_CaretCB.client_data = NULL;
> +#ifdef HAVE_XICCALLBACK_CALLBACK
> +    P_StartCB.callback = (XICProc)XIMPreEditStartCallback;
> +    P_DoneCB.callback = (XICProc)XIMPreEditDoneCallback;
> +    P_DrawCB.callback = (XICProc)XIMPreEditDrawCallback;
> +    P_CaretCB.callback = (XICProc)XIMPreEditCaretCallback;
> +#else
> +    P_StartCB.callback = (XIMProc)XIMPreEditStartCallback;
> +    P_DoneCB.callback = (XIMProc)XIMPreEditDoneCallback;
> +    P_DrawCB.callback = (XIMProc)XIMPreEditDrawCallback;
>      P_CaretCB.callback = (XIMProc)XIMPreEditCaretCallback;
> +#endif
>  
>      if ((ximStyle & (XIMPreeditNothing | XIMPreeditNone)) == 0)
>      {
> diff --git a/include/config.h.in b/include/config.h.in
> index ac464db..f867662 100644
> --- a/include/config.h.in
> +++ b/include/config.h.in
> @@ -945,6 +945,9 @@
>  /* Define to 1 if you have the <X11/Xutil.h> header file. */
>  #undef HAVE_X11_XUTIL_H
>  
> +/* Define to 1 if `callback' is member of `XICCallback'. */
> +#undef HAVE_XICCALLBACK_CALLBACK
> +
>  /* Define if you have the XKB extension */
>  #undef HAVE_XKB
>  



From julliard at winehq.org  Tue Apr 15 05:29:02 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Tue, 15 Apr 2008 12:29:02 +0200
Subject: start.exe: updated French translation
In-Reply-To: <1208208634.6722.32.camel@jernst-laptop> (Jonathan Ernst's
	message of "Mon, 14 Apr 2008 23:30:34 +0200")
References: <1208208634.6722.32.camel@jernst-laptop>
Message-ID: <873apno1ht.fsf@wine.dyndns.org>

Jonathan Ernst <jonathan at ernstfamily.ch> writes:

> @@ -24,41 +24,42 @@ LANGUAGE LANG_FRENCH, SUBLANG_NEUTRAL
>  
>  STRINGTABLE DISCARDABLE
>  {
> -STRING_USAGE,                                   "Lance un programme, ou ouvre un document dans le programme normalement utilis? avec cette extension. \n\
> +STRING_USAGE,                                   "Lance un programme, ou ouvre un document dans le programme normalement utilis?? avec cette extension. \n\

If you are converting the file to utf-8 you also have to add the
appropriate pragmas.

-- 
Alexandre Julliard
julliard at winehq.org


From kornelpal at gmail.com  Tue Apr 15 05:53:04 2008
From: kornelpal at gmail.com (=?iso-8859-1?B?S29ybulsIFDhbA==?=)
Date: Tue, 15 Apr 2008 12:53:04 +0200
Subject: Including Mono within a Wine package - should Wine expect this?
References: <666369.76248.qm@web23115.mail.ird.yahoo.com>
Message-ID: <007c01c89ee6$e2be05f0$387326c3@kornelpal.hu>

Hi,

> From: "Hin-Tak Leung" <htl10 at users.sourceforge.net>
> I can't comment on anything else, but after trying to get a .NET WinForms 
> application
> (mentioned in some of the bugs I filed) for a few months under the 3 
> options of
> native linux mono, wine+.NET and wine+mono, I can say that win32 mono uses 
> P/Invoke
> *differently* from how .NET2 does it, and the missing APIs required to get 
> an
> application to work with the wine + win32 mono and wine +MS.NET combo is 
> different.
> So some part of the applications runs better with wine + win32 mono and 
> some better
> with wine + MS.NET ... win32 mono and MS.NET just seems to have different 
> native code dependencies.

The only major difference I know is that Mono uses UTF-8 instead of ACP for 
ANSI functions. If you know some serious issues please feel free to file bug 
report(s) at Mono's Bugzilla.

> From: "Dan Kegel" <dank at kegel.com>
>>  http://lists.ximian.com/pipermail/mono-devel-list/2008-April/027491.html
>
> That's interesting info, thanks.
>
> At the moment you seem to be taking the lead on these issues.
> Please let us know how it goes.

I have made some progess and now I am able to call unmanaged methods from 
managed methods and also implemented some mscoree.dll hacks that make 
possible to use the NT loader (LoadLibrary). Unfortunately the loader uses 
mscoree.dll located in system32 anyway so I had to modify it's export 
address table in memory. And I also had to implement base relocation and 
import adress table processing for EXE modules because that is not done by 
NT. Processes could only be created from managed EXE files with some more 
intrusive mscoree.dll hacks (mscoree.dll file or registy modifications).

Korn?l 



From dmitry at codeweavers.com  Tue Apr 15 06:07:38 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Tue, 15 Apr 2008 20:07:38 +0900
Subject: Including Mono within a Wine package - should Wine expect this?
References: <666369.76248.qm@web23115.mail.ird.yahoo.com>
	<007c01c89ee6$e2be05f0$387326c3@kornelpal.hu>
Message-ID: <013701c89ee8$ecc90f20$a600fea9@DMITRY>

"Korn?l P?l" <kornelpal at gmail.com> wrote:

> The only major difference I know is that Mono uses UTF-8 instead of ACP for
> ANSI functions.

UTF-8 will break most of Windows applications since they don't expect to see
strings in a multibyte encoding.

-- 
Dmitry.



From paulc at voip.null.ro  Tue Apr 15 06:11:46 2008
From: paulc at voip.null.ro (Paul Chitescu)
Date: Tue, 15 Apr 2008 14:11:46 +0300 (EEST)
Subject: ws2_32: Work around the host name resolving to 127.x.x.x when
	using that for binding.
In-Reply-To: <200804142304.58241.kai.blin@gmail.com>
References: <200804141605.23704.kai.blin@gmail.com>
	<20080414162932.GX5348@byleth.sc-networks.de>
	<Pine.LNX.4.64.0804141934580.24510@dragoshel>
	<200804142304.58241.kai.blin@gmail.com>
Message-ID: <Pine.LNX.4.64.0804151402290.15822@dragoshel>

On Mon, 14 Apr 2008, Kai Blin wrote:
> On Monday 14 April 2008 18:42:26 Paul Chitescu wrote:
>
>> Binding to a specific address is the only easy way of detecting which
>> interface an UDP packet was received on since recvfrom() only gives source
>> address, not destination. Listening on 0.0.0.0 would make impossible to
>> tell which interface a packet was received on. Furthermore, a program that
>> explicitely tries to bind to each interface would fail all but the first
>> bind and possibly bail out. Probably many games that use UDP would break.
>
> I'm currently trying to fix apps that fail doing the following (which seems to
> be a popular way among game developers), in pseudo-code.
>
> hostname = gethostname();
> hostent = gethostbyname(hostname);
> sockaddr->sin_addr = hostent->addr;
> sock = socket();
> bind(sock, sockaddr);
>
> Which, as Christoph noted, cause windows apps to bind to loopback addresses,
> breaking the networking. This only started to happen recently as recently
> Linux distros started mapping the machine's hostname to a loopback address. I
> don't think Wine ever used the registry for anything like that.
>
> Cheers,
> Kai
>
> -- 
> Kai Blin
> WorldForge developer  http://www.worldforge.org/
> Wine developer        http://wiki.winehq.org/KaiBlin
> Samba team member     http://www.samba.org/samba/team/
> --
> Will code for cotton.


Hi, Kai!

Your patch seems quite safe to me as it checks lots of stuff. I disagreed 
to Christoph Frick's proposal of always binding to 0.0.0.0

As a security enhancement, what about randomly initializing the last 3 
octets of magic_loopback_addr at every run instance? This could help fend 
off potential attacks targeted at buggy applications running in Wine by 
sending this special address over some other protocol. A remote attacker 
can convince a local application to listen on all interfaces including 
Internet attached ones while thinking it (safely) listens only on 
loopback.

Regards,

Paul Chitescu


From kornelpal at gmail.com  Tue Apr 15 06:22:10 2008
From: kornelpal at gmail.com (=?iso-8859-1?B?S29ybulsIFDhbA==?=)
Date: Tue, 15 Apr 2008 13:22:10 +0200
Subject: Including Mono within a Wine package - should Wine expect this?
References: <666369.76248.qm@web23115.mail.ird.yahoo.com>
	<007c01c89ee6$e2be05f0$387326c3@kornelpal.hu>
	<013701c89ee8$ecc90f20$a600fea9@DMITRY>
Message-ID: <000c01c89eea$f3406a40$387326c3@kornelpal.hu>

>> The only major difference I know is that Mono uses UTF-8 instead of ACP 
>> for
>> ANSI functions.
>
> UTF-8 will break most of Windows applications since they don't expect to 
> see
> strings in a multibyte encoding.

I know that. And the problem is that there is a mess of ACP and UTF-8 inside 
native code of Mono. I tried to change things several times but none of them 
were accepted.

Korn?l 



From ovek at arcticnet.no  Tue Apr 15 06:29:22 2008
From: ovek at arcticnet.no (Ove Kaaven)
Date: Tue, 15 Apr 2008 13:29:22 +0200
Subject: Including Mono within a Wine package - should Wine expect this?
In-Reply-To: <47FECF9E.1030309@open-vote.org>
References: <a71bd89a0804100645y2b7f9c94n719ab5f19374db04@mail.gmail.com>
	<47FECF9E.1030309@open-vote.org>
Message-ID: <48049192.4090906@arcticnet.no>

Scott Ritchie skrev:
> Agreed.  The one tricky thing here is making a proper "source" package.
>  There is some precedent for source packages that don't actually build
> on the architecture they're for.  The ia32-libs package, for instance,
> contains both binary and source versions of the 32 bit libraries since
> it's solely for 64 bit arches, however to build those binaries requires
> use of a 32 bit system.
> 
> Similarly, we can ship a wine-gecko "source" package which includes
> binary and source, with the readme detailing how to actually build the
> binary from the source (ie, use Windows).  Meanwhile the source package
> "builds" by just copying the binary into the right place (much like how
> ia32-libs builds).

Debian would not accept this into main. Perhaps into contrib, maybe. For 
example, DFSG-free Java programs that must be compiled with a non-free 
Java compiler (because the free compilers aren't good enough) goes into 
contrib, not main (though even here, it should be possible to 
auto-rebuild the package).

Debian's ia32-libs package isn't an example of a whole lot. It grabs 
compiled binaries from the official Debian archive, and nowhere else. It 
isn't built on a 32-bit system. If ia32-libs had contained binaries that 
could not be built 100% automatically using Debian's official archive 
(and only the official archive), it probably wouldn't have gotten into 
Debian. Besides, ia32-libs is not meant to be a long-lived package, 
it'll go away eventually.




From msclrhd at googlemail.com  Tue Apr 15 03:03:03 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Tue, 15 Apr 2008 09:03:03 +0100
Subject: [1/2] shlwapi: Fixed the todo blocks in the SHCreateStreamOnFile
	tests. [try 2]
In-Reply-To: <87wsn05kio.fsf@wine.dyndns.org>
References: <3f4fd2640804130613q1c93aea4wa57f609446beadca@mail.gmail.com>
	<87wsn05kio.fsf@wine.dyndns.org>
Message-ID: <3f4fd2640804150103v735792cat246c2511ae855ecd@mail.gmail.com>

On 14/04/2008, Alexandre Julliard <julliard at winehq.org> wrote:
> "Reece Dunn" <msclrhd at googlemail.com> writes:
>
>  > @@ -120,12 +119,12 @@ static HRESULT WINAPI IStream_fnRead(IStream *iface, void* pv, ULONG cb, ULONG*
>  >    TRACE("(%p,%p,0x%08x,%p)\n", This, pv, cb, pcbRead);
>  >
>  >    if (!pv)
>  > -    return STG_E_INVALIDPOINTER;
>  > +    return S_OK;
>
>  It's very unlikely that this is the correct behavior in all cases.

That is what the tests appear to be implying. Unless they are
returning S_OK if there is no content to be read, but that wouldn't
make any sense, unless the parameter is passed directly to ReadFile
without any checking and that is how ReadFile behaves.

In that case, I'll leave this as a todo_wine block for the time being
until there is a more complete set of tests for the read method.

>  > @@ -459,7 +458,9 @@ HRESULT WINAPI SHCreateStreamOnFileEx(LPCWSTR lpszPath, DWORD dwMode,
>  >    switch(STGM_CREATE_MODE(dwMode))
>  >    {
>  >    case STGM_FAILIFTHERE:
>  > -    dwCreate = OPEN_EXISTING;
>  > +    if (bCreate && PathFileExistsW(lpszPath))
>  > +      return HRESULT_FROM_WIN32(ERROR_FILE_EXISTS);
>  > +    dwCreate = bCreate ? CREATE_ALWAYS : OPEN_EXISTING;
>
>  That case should be handled by CreateFile, you shouldn't check for the
>  file existence explicitly.

The MSDN documentation for CreateFile
(http://msdn2.microsoft.com/en-us/library/aa363858.aspx) suggests that
CREATE_NEW has the desired behaviour. However, the Wine implementation
is not handling this correctly. Therefore, I'll improve the CreateFile
tests to test the CREATE_NEW behaviour.

I will also resubmit this patch with those tests marked as todo_wine.

- Reece


From msclrhd at googlemail.com  Tue Apr 15 03:27:27 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Tue, 15 Apr 2008 09:27:27 +0100
Subject: [1/2] shlwapi: Fixed the todo blocks in the SHCreateStreamOnFile
	tests. [try 2]
In-Reply-To: <3f4fd2640804150103v735792cat246c2511ae855ecd@mail.gmail.com>
References: <3f4fd2640804130613q1c93aea4wa57f609446beadca@mail.gmail.com>
	<87wsn05kio.fsf@wine.dyndns.org>
	<3f4fd2640804150103v735792cat246c2511ae855ecd@mail.gmail.com>
Message-ID: <3f4fd2640804150127lcc87fb6n5c673e8f4c066fe6@mail.gmail.com>

On 15/04/2008, Reece Dunn <msclrhd at googlemail.com> wrote:
> On 14/04/2008, Alexandre Julliard <julliard at winehq.org> wrote:
>  > "Reece Dunn" <msclrhd at googlemail.com> writes:
>  >  > @@ -459,7 +458,9 @@ HRESULT WINAPI SHCreateStreamOnFileEx(LPCWSTR lpszPath, DWORD dwMode,
>  >  >    switch(STGM_CREATE_MODE(dwMode))
>  >  >    {
>  >  >    case STGM_FAILIFTHERE:
>  >  > -    dwCreate = OPEN_EXISTING;
>  >  > +    if (bCreate && PathFileExistsW(lpszPath))
>  >  > +      return HRESULT_FROM_WIN32(ERROR_FILE_EXISTS);
>  >  > +    dwCreate = bCreate ? CREATE_ALWAYS : OPEN_EXISTING;
>  >
>  >  That case should be handled by CreateFile, you shouldn't check for the
>  >  file existence explicitly.
>
> The MSDN documentation for CreateFile
>  (http://msdn2.microsoft.com/en-us/library/aa363858.aspx) suggests that
>  CREATE_NEW has the desired behaviour. However, the Wine implementation
>  is not handling this correctly. Therefore, I'll improve the CreateFile
>  tests to test the CREATE_NEW behaviour.

There were tests for the CREATE_NEW case in kernel32/tests/file.c,
verifying this behaviour. I tracked the problem down to a strange way
of converting a GetLastError status to a HRESULT. Fixing that got the
desired behaviour (see my new patch).

- Reece


From developers at tefnet.pl  Tue Apr 15 05:26:09 2008
From: developers at tefnet.pl (Tomasz Jezierski - Tefnet)
Date: Tue, 15 Apr 2008 12:26:09 +0200
Subject: [Fwd: Re: Apparently it is possible to have chm file without
	#STRINGS in it, so we should not stop processing file at it. Fixes bug
	#12498]
Message-ID: <1208255169.14006.1.camel@tefdemo>


ups.. forgot to CC:

-------- Przekazywana wiadomo?? ----------
Od: Tomasz Jezierski - Tefnet <developers at tefnet.pl>
Do: Juan Lang <juan.lang at gmail.com>
Temat: Re: Apparently it is possible to have chm file without #STRINGS
in it, so we should not stop processing file at it. Fixes bug #12498
Data: Tue, 15 Apr 2008 08:31:23 +0200

Dnia 14-04-2008, pon o godzinie 16:58 -0700, Juan Lang pisze:
> Hi Tomasz,
> 
> -        info->WinType.pszToc = strdupW(info->pCHMInfo->defToc);
> +        info->WinType.pszToc = strdupW(info->pCHMInfo->defToc ?
> info->pCHMInfo->defToc : null);
> 
Sorry, didn't know that... I saw that "small" null is used one line
under:
info->WinType.pszIndex = strdupW(null);
so I used it too.

Have you tried patch without this "if"? In my case it crashes without it
when I try to open chm from bug #12498... i don't know if strdupW can
dup NULL as well as null?





From aric at codeweavers.com  Tue Apr 15 07:24:57 2008
From: aric at codeweavers.com (Aric Stewart)
Date: Tue, 15 Apr 2008 07:24:57 -0500
Subject: IMM / IME work
Message-ID: <48049E99.7060205@codeweavers.com>

Hello all,

   I know this will only interest a small portion of you but thought i 
would give a quick update on the state of IMM32 since I have brought it 
to a major milestone.

   All the main patches are in which now separate IMM32 and IMEs. There 
is still more work to do but the major framework is in place. X11 XIM 
processing should be unchanged. However wine can now begin to  load 
native windows IMEs as well.

  I have tested with windows ATOK20 (a popular Japanese IME) and 
successfully had text processing in a fully IME aware application. There 
are still clear issues to resolve in many aspects of this processing but 
we have forward progress.

  ImmInstallIME does not work yet, nor does switching keyboards.  So to 
get the native IME to work you need to add this registry key.

[System\\CurrentControlSet\\Control\\Keyboard Layouts\\<keyboard layout>]
"Ime File"=<IME filename>

so for example for ATOK20 in Japanese i used.

[System\\CurrentControlSet\\Control\\Keyboard Layouts\\e0010411]
"Ime File"="ATOK20W.IME"

I would love to hear how well things work.  I am sure using native IMEs 
will quickly show us many places where IMM32 needs to be improved.

One issues I am going to investigate next is that sometimes non x11drv 
ime initialization, if occurring too early, causes x11drv to fail to 
create windows.  I have not investigated with the latest changes to 
xim.c  (which may already correct this problem) but if you see this 
problem this patch may help and i believe the 
IME_UpdateAssociation(NULL) is already unneeded.


diff --git a/dlls/winex11.drv/xim.c b/dlls/winex11.drv/xim.c
index d4df9f7..0c98136 100644
--- a/dlls/winex11.drv/xim.c
+++ b/dlls/winex11.drv/xim.c
@@ -475,7 +475,6 @@ static void X11DRV_OpenIM(Display *display, XPointer 
ptr, XP
      XUnregisterIMInstantiateCallback(display, NULL, NULL, NULL, 
X11DRV_OpenIM,
      wine_tsx11_unlock();
      IME_XIMPresent(TRUE);
-    IME_UpdateAssociation(NULL);
  }

thanks,
-aric


From vitperov at etersoft.ru  Tue Apr 15 07:54:45 2008
From: vitperov at etersoft.ru (Vitaly Perov)
Date: Tue, 15 Apr 2008 16:54:45 +0400
Subject: Bug with duplex printing
Message-ID: <200804151654.46205.vitperov@etersoft.ru>

Hi all,

I'm sorry. My English is not so good.

There is a bug. I have some idia how to solve it. I'm sure it's not good way 
to solve this problem.

The bug is the following:
You print one page with duplex printing, and the number of copies is 2.
The second page must be printed on the next page, but it is printed on the 
another side of this page.
This bug appears if an application is responsible for printing (almost always)
 
I have tried to print the following documents (duplex printing) into the file:
1) Document consists of 1 page, number of copies is 2;
2) Document consist of 2 pages, number of copies is 1;
Then I have compared theese documents with diff.
The documens differ only in some strings (date of creation)!

I have tried the same test in OpenOffice.
The results is the same!

I want to try this in Windows, but i can find a printer which can generate 
PostScript and supports Duplex mode.

The is several ways to solve it.
Application is responsible for printing. We print 2 copies and the number of 
pages is 1, 3, 5... etc. So after sending the first copy of document it 
must "tell" to the Windows/Wine, that new page must start from the new sheet 
of paper.
I think the are 2 ways:
1) The is special WINAPI function, that application call
2) The empty page after each copy of the document. It can be inserted by 
application or Windows/Wine.

I find out that there is no special WINAPI, so this bug can be solved only by 
inserting of empty page.

I have ascertained that the application a'm testing never asks whether printer 
support duplex. So I have decided, that Windows/Wine must insert empty page.

But the Windows/Wine can't get to know the number of pages, that application 
is going to print.

So I think, its only one way to add an empty page:
We must catch EndDoc, then scan the PostScript and count number of pages it is 
going to print. Then we devide number of pages over number of copies, and 
determine number of pages in one copy of the document. Then, if number of 
pages is 1, 3, 5 .. etc. we rescan the PostScript document, and insert empty 
page after last page of each copy.
I'm sure it's not good way to solve this problem.

So, if anybody have something to say, I would be appreciate.

Thank you.


-- 
Best wishes,
Vitaly Perov
Russia, Saint-Petersburg. www.etersoft.ru


From patrol at sinus.cz  Tue Apr 15 08:02:14 2008
From: patrol at sinus.cz (Pavel Troller)
Date: Tue, 15 Apr 2008 15:02:14 +0200
Subject: Unimplemented ntoskrnl functions ?
Message-ID: <20080415130214.GA21775@tangens.sinus.cz>

Hi!
  I'm solving the following problem:
  I would like to run the "Tibbo Device Server Toolkit" (TDSK) - see
http://www.tibbo.com/get_dst.php
  During installation of the product on a fresh wine (the last Sunday's git)
with a fresh .wine directory, it crashes with the following report:

wine: Call from 0x7b841720 to unimplemented function ntoskrnl.exe.KeInitializeEvent, aborting
wine: Unimplemented function ntoskrnl.exe.KeInitializeEvent called at address 0x7b841720 (thread 0021), starting debugger...
Unhandled exception: unimplemented function ntoskrnl.exe.KeInitializeEvent called in 32-bit code (0x7b841796).

  Is this function hard to implement ? I'm somewhat experienced with Linux
programming, but I know absolutely nothing about windoze. 

After a lot of time, if wineserver -k isn't applied, it reports another two
unimplemented functions - KeInitializeInterrupt and KeInitializeMutant. What
about these ?

With regards, Pavel Troller


From zgs at seas.upenn.edu  Tue Apr 15 08:35:46 2008
From: zgs at seas.upenn.edu (Zachary Goldberg)
Date: Tue, 15 Apr 2008 09:35:46 -0400
Subject: [WineHQ][WWN] WWN 345
In-Reply-To: <001c01c89ed5$fbf92150$a600fea9@DMITRY>
References: <20080415034454.D66A4166CF23@bluesata.com>
	<001c01c89ed5$fbf92150$a600fea9@DMITRY>
Message-ID: <b050a5e70804150635h59a90fe4q3af0f211c7b4fa93@mail.gmail.com>

On Tue, Apr 15, 2008 at 4:52 AM, Dmitry Timoshkov
<dmitry at codeweavers.com> wrote:
> "Zachary Goldberg" <zgs at seas.upenn.edu> wrote:
>
>
> > +<section
> > + title="News: new WineTricks, 1.0 status updates and more"
> > + subject="Wine"
> > + archive="http://www.xkcd.com"
> > + posts="0"
> > +>
> >
>
>  How is the url above related to the title?
>
>  --
>  Dmitry.
>

It isn't, I had nothing else to put.  I generally leave them blank but
I for some reason decided to throw xkcd in there this time.

-Zach


From hverbeet at gmail.com  Tue Apr 15 08:54:07 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Tue, 15 Apr 2008 15:54:07 +0200
Subject: d3dx9: Add d3dx9tex.h
In-Reply-To: <E1JllJQ-0003bt-Va@www13.emo.freenet-rz.de>
References: <E1JllJQ-0003bt-Va@www13.emo.freenet-rz.de>
Message-ID: <d658b69e0804150654q25d3bc53x9a5b6a52c362f174@mail.gmail.com>

On 15/04/2008, tony.wasserka at freenet.de <tony.wasserka at freenet.de> wrote:
>

> +#ifndef __WINE_D3DX9TEX_H
> +#define __WINE_D3DX9TEX_H
...
> +#endif /* __WINE_D3DX9CORE_H */
I didn't look at the rest of the patch in detail, but the comment
there doesn't match the actual #ifndef.


From paulc at voip.null.ro  Tue Apr 15 09:02:45 2008
From: paulc at voip.null.ro (Paul Chitescu)
Date: Tue, 15 Apr 2008 17:02:45 +0300 (EEST)
Subject: Unimplemented ntoskrnl functions ?
In-Reply-To: <20080415130214.GA21775@tangens.sinus.cz>
References: <20080415130214.GA21775@tangens.sinus.cz>
Message-ID: <Pine.LNX.4.64.0804151655570.15822@dragoshel>

On Tue, 15 Apr 2008, Pavel Troller wrote:
> Hi!
>  I'm solving the following problem:
>  I would like to run the "Tibbo Device Server Toolkit" (TDSK) - see
> http://www.tibbo.com/get_dst.php
>  During installation of the product on a fresh wine (the last Sunday's git)
> with a fresh .wine directory, it crashes with the following report:
>
> wine: Call from 0x7b841720 to unimplemented function ntoskrnl.exe.KeInitializeEvent, aborting
> wine: Unimplemented function ntoskrnl.exe.KeInitializeEvent called at address 0x7b841720 (thread 0021), starting debugger...
> Unhandled exception: unimplemented function ntoskrnl.exe.KeInitializeEvent called in 32-bit code (0x7b841796).
>
>  Is this function hard to implement ? I'm somewhat experienced with Linux
> programming, but I know absolutely nothing about windoze.
>
> After a lot of time, if wineserver -k isn't applied, it reports another two
> unimplemented functions - KeInitializeInterrupt and KeInitializeMutant. What
> about these ?
>
> With regards, Pavel Troller

Hi, Pavel!

You are trying to run the Windows device driver (a virtual port 
redirector) included with the application.

Wine does not really support Windows drivers - although some may load the 
functionality just isn't there. The application may run on a COM port 
supported by the operating system (Linux, etc.)

The installation failure is what you should aim to fix. A winedevice crash 
should not stop the installation.

Regards,

Paul Chitescu


From juan.lang at gmail.com  Tue Apr 15 09:14:58 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Tue, 15 Apr 2008 07:14:58 -0700
Subject: Apparently it is possible to have chm file without #STRINGS in it,
	so we should not stop processing file at it. Fixes bug #12498
In-Reply-To: <1208241074.18325.9.camel@zgierznet>
References: <3a768c550804141658x6051f8a3raadc85603cedc023@mail.gmail.com>
	<1208241074.18325.9.camel@zgierznet>
Message-ID: <3a768c550804150714q1c8b004dt9ed135c1be1d1439@mail.gmail.com>

>  Have you tried patch without this "if"? In my case it crashes without it
>  when I try to open chm from bug #12498... i don't know if strdupW can
>  dup NULL as well as null?

Aaaah...  Sorry, my mistake, I missed this declaration:
        static const WCHAR null[] = {0};
That solves that mystery.

In that case, one fix per patch, please.  This fix and the other are
unrelated:  one fixes a crash, the other deals with a missing #STRINGS
stream.  Thanks,
--Juan


From patrol at sinus.cz  Tue Apr 15 09:19:38 2008
From: patrol at sinus.cz (Pavel Troller)
Date: Tue, 15 Apr 2008 16:19:38 +0200
Subject: Unimplemented ntoskrnl functions ?
In-Reply-To: <Pine.LNX.4.64.0804151655570.15822@dragoshel>
References: <20080415130214.GA21775@tangens.sinus.cz>
	<Pine.LNX.4.64.0804151655570.15822@dragoshel>
Message-ID: <20080415141938.GA27081@tangens.sinus.cz>

> On Tue, 15 Apr 2008, Pavel Troller wrote:
> > Hi!
> >  I'm solving the following problem:
> >  I would like to run the "Tibbo Device Server Toolkit" (TDSK) - see
> > http://www.tibbo.com/get_dst.php
> >  During installation of the product on a fresh wine (the last Sunday's git)
> > with a fresh .wine directory, it crashes with the following report:
> >
> > wine: Call from 0x7b841720 to unimplemented function ntoskrnl.exe.KeInitializeEvent, aborting
> > wine: Unimplemented function ntoskrnl.exe.KeInitializeEvent called at address 0x7b841720 (thread 0021), starting debugger...
> > Unhandled exception: unimplemented function ntoskrnl.exe.KeInitializeEvent called in 32-bit code (0x7b841796).
> >
> >  Is this function hard to implement ? I'm somewhat experienced with Linux
> > programming, but I know absolutely nothing about windoze.
> >
> > After a lot of time, if wineserver -k isn't applied, it reports another two
> > unimplemented functions - KeInitializeInterrupt and KeInitializeMutant. What
> > about these ?
> >
> > With regards, Pavel Troller
> 
> Hi, Pavel!
> 
> You are trying to run the Windows device driver (a virtual port 
> redirector) included with the application.

Oh, I see. I actually don't want to use the device driver (Virtual Serial
Port - VSP), there is a native Linux driver for it. What I need, is to
manage the Tibbo devices, and this functionality is not available for Linux
and probably will never be.

> 
> Wine does not really support Windows drivers - although some may load the 
> functionality just isn't there. The application may run on a COM port 
> supported by the operating system (Linux, etc.)

The problem probably is, that the Device Server utilizes the underlying devices
for its operation, so it cannot be used without them. It uses some "out of band
channels" to communicate with Tibbos - for example, even if the IP address of
the device is lost/spontaneously changed, it can find it using special
broadcasts, show its current config, and change it (without losing this
"service connection"). I was hoping that maybe it will work independently of the
device driver, but it probably won't.

> 
> The installation failure is what you should aim to fix. A winedevice crash 
> should not stop the installation.
> 
> Regards,
> 
> Paul Chitescu
> 
Thank you for your valuable help! It looks that these devices are not for me
:-(.
   With regards, Pavel Troller


From juan.lang at gmail.com  Tue Apr 15 10:09:22 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Tue, 15 Apr 2008 08:09:22 -0700
Subject: Apparently it is possible to have chm file without #STRINGS in it,
	so we should not stop processing file at it. Fixes bug #12498
In-Reply-To: <1208271962.25171.16.camel@tefdemo>
References: <3a768c550804141658x6051f8a3raadc85603cedc023@mail.gmail.com>
	<1208241074.18325.9.camel@zgierznet>
	<3a768c550804150714q1c8b004dt9ed135c1be1d1439@mail.gmail.com>
	<1208271962.25171.16.camel@tefdemo>
Message-ID: <3a768c550804150809q1ed25390r46be73afd64382f1@mail.gmail.com>

>  > In that case, one fix per patch, please.  This fix and the other are
>  > unrelated:  one fixes a crash, the other deals with a missing #STRINGS
>  > stream.  Thanks,
>
>  No, I think that crash is only possible with my patch. Right now if
>  there is no #STRINGS it closes chm and stops processing.

Okay, I understand.  Your patch looks fine to me then.  You may wish
to resend, Alexandre may have other ideas ;-)
--Juan


From pnilsson at nullref.se  Tue Apr 15 11:17:29 2008
From: pnilsson at nullref.se (Philip Nilsson)
Date: Tue, 15 Apr 2008 18:17:29 +0200
Subject: d3dx9_36: Add stubs and implementations for D3DXCreateTexturexx
In-Reply-To: <E1Jl4yL-00045q-1D@www19.emo.freenet-rz.de>
References: <E1Jl4yL-00045q-1D@www19.emo.freenet-rz.de>
Message-ID: <20080415161729.GA4373@zorkmid.localnetwork>

On Sun, Apr 13, 2008 at 06:22:29PM +0200, tony.wasserka at freenet.de wrote:
> Hi,
> Are you still working on the texture functions?
> I'd need them for completing my ID3DXSprite implementation,
> so if you don't mind I could complete your started patches.
> 
> Best regards,
>     Tony

  I have a hacky implementation of D3DXLoadSurfaceFromMemory and
D3DXLoadSurfaceFromSurface, as well as a pretty good implementation of
D3DXCreateTexture and D3DXCheckTextureRequirements.

  I'll send in the patch for the last two when I have time, and have
looked it over a final time.  I pretty much abandoned the first two,
because there's got to be a whole lot of code somewhere in the tree
already.  It does work in some cases, however.  Attached in case it
might be helpful.

-- 
Philip Nilsson
-------------- next part --------------
A non-text attachment was scrubbed...
Name: surface.c
Type: text/x-csrc
Size: 8438 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080415/f19089b5/attachment-0001.c 

From luis.busquets at ilidium.com  Tue Apr 15 11:58:23 2008
From: luis.busquets at ilidium.com (Luis Busquets)
Date: Tue, 15 Apr 2008 18:58:23 +0200
Subject: quartz: FOURCC Error in compiling
Message-ID: <4804DEAF.7050809@ilidium.com>

When I try to compile the wine tree of today I get an error compiling 
avisplit.o: There is no rule to build fourcc.h needed for avisplit.o

/make[2]: *** No hay ninguna regla para construir el objetivo 
`fourcc.h', necesario para `avisplit.o'.  Alto.
make[2]: se sale del directorio `/wine-git/dlls/quartz'
make[1]: *** [quartz] Error 2
make[1]: se sale del directorio `/wine-git/dlls'
make: *** [dlls] Error 2
/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080415/f605e91f/attachment.htm 

From austinenglish at gmail.com  Tue Apr 15 12:07:48 2008
From: austinenglish at gmail.com (Austin English)
Date: Tue, 15 Apr 2008 12:07:48 -0500
Subject: Feature Request: Registry / winecfg entry for launching an
	application in a wineexplorer window
In-Reply-To: <48040EDD.7010708@kievinfo.com>
References: <4803182C.9070209@open-vote.org>
	<200804140534.33333.chris.kcat@gmail.com>
	<b6bb06270804141004nd99e48are3158647a4482bc2@mail.gmail.com>
	<48040EDD.7010708@kievinfo.com>
Message-ID: <b6bb06270804151007h717ebc48n7b33025c902f3985@mail.gmail.com>

On Mon, Apr 14, 2008 at 9:11 PM, Vitaliy Margolen
<wine-devel at kievinfo.com> wrote:
> Austin English wrote:
>  > On Mon, Apr 14, 2008 at 7:34 AM, Chris Robinson <chris.kcat at gmail.com> wrote:
>  >>  IIRC, the problem is you can't have two Wine processes using two different
>  >>  desktops. Try this: start an app without virtual desktop and leave it
>  >>  running, run winecfg and turn on virtual desktop (make sure to click Apply),
>  >>  then try to start another app. It won't use a virtual desktop.
>  >>
>  >>
>  >
>  > Terminal one:
>  > $ rm -rf ~/.wine
>  > $ wine notepad
>  >
>  > Terminal two:
>  > $ winecfg # enable virtual desktop
>  > $ winemine # doesn't go in virtual desktop
>  > $ wine explorer /desktop=name,1024x768 winemine # goes in virtual desktop
>  >
>  That's by design when you change configuration via winecfg it applies to
>  "default" desktop only. And if it's already active (desktop for your
>  notepad) it won't just become virtual desktop. When you using "name" that
>  creates separate desktop with that name and requested parameters.
>
>  Vitaliy
>
>
>

What would be lost by having those apps that someone wants to be in
their own virtual desktop each having their own (with unique names).
I.e., if you choose to give Starcraft and Wow each their own desktop,
but not notepad:
$ wine notepad #works in regular managed mode
$ wine wow.exe # would be equivalent to running wine explorer
/desktop=wow,1024x768 wow.exe
$ wine starcraft.exe # would be equivalent to running wine explorer
/desktop=starcraft,800x600 starcraft.exe

With the desktop names being either assigned by program name,
automatically assigned, or chosen by the user. Resolution could
default to 800 x 600, but also be customizable in winecfg.

Thoughts?


From thestig at google.com  Tue Apr 15 12:08:27 2008
From: thestig at google.com (Lei Zhang)
Date: Tue, 15 Apr 2008 10:08:27 -0700
Subject: quartz: FOURCC Error in compiling
In-Reply-To: <4804DEAF.7050809@ilidium.com>
References: <4804DEAF.7050809@ilidium.com>
Message-ID: <558b2f5c0804151008k78af8797tb6e20cfe35a9ad64@mail.gmail.com>

On Tue, Apr 15, 2008 at 9:58 AM, Luis Busquets
<luis.busquets at ilidium.com> wrote:
>
>  When I try to compile the wine tree of today I get an error compiling
> avisplit.o: There is no rule to build fourcc.h needed for avisplit.o
>
>  make[2]: *** No hay ninguna regla para construir el objetivo `fourcc.h',
> necesario para `avisplit.o'.  Alto.
>  make[2]: se sale del directorio `/wine-git/dlls/quartz'
>  make[1]: *** [quartz] Error 2
>  make[1]: se sale del directorio `/wine-git/dlls'
>  make: *** [dlls] Error 2
>

Try regenerating dlls/quartz/Makefile and it should compile again.


From rob at codeweavers.com  Tue Apr 15 12:40:13 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Tue, 15 Apr 2008 18:40:13 +0100
Subject: RFC: Fix for IWineMsiRemotePackage::FormatRecord
Message-ID: <4804E87D.2000209@codeweavers.com>

Hi,

Currently, the [out] value parameter for 
IWineMsiRemotePackage::FormatRecord doesn't have a level of indirection 
associated with it and so I would be very surprised if the typelib 
marshaller actually does the right thing in this case. Compiling with 
MIDL and with a future update to widl causes an error for this 
parameter. I'm proposing the attached patch to fix things, but I'm not 
able to test that this works correctly.

Thanks,

-- 
Rob Shearman

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-msi-Fix-the-value-parameter-of-IWineMsiRemotePackag.patch
Type: text/x-patch
Size: 0 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080415/d659e778/attachment.bin 

From rob at codeweavers.com  Tue Apr 15 05:33:43 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Tue, 15 Apr 2008 11:33:43 +0100
Subject: msi: Fix the value parameter of IWineMsiRemotePackage::FormatRecord to have the right level of indirection for an [out] parameter.
Message-ID: <mailman.388.1208281233.3731.wine-devel@winehq.org>

Remove the redundant size parameter and simplify the client code such that the remote function is only called once, with the value being automatically allocated. Add corresponding code on the server side to automatically allocate said value.
---
 dlls/msi/format.c      |   17 +----------------
 dlls/msi/msiserver.idl |    2 +-
 dlls/msi/package.c     |   13 +++++++++++--
 3 files changed, 13 insertions(+), 19 deletions(-)

diff --git a/dlls/msi/format.c b/dlls/msi/format.c
index f58f517..454142a 100644
--- a/dlls/msi/format.c
+++ b/dlls/msi/format.c
@@ -921,28 +921,13 @@ UINT WINAPI MsiFormatRecordW( MSIHANDLE hInstall, MSIHANDLE hRecord,
         HRESULT hr;
         IWineMsiRemotePackage *remote_package;
         BSTR value = NULL;
-        DWORD len;
         awstring wstr;
 
         remote_package = (IWineMsiRemotePackage *)msi_get_remote( hInstall );
         if (remote_package)
         {
-            len = 0;
             hr = IWineMsiRemotePackage_FormatRecord( remote_package, hRecord,
-                                                     NULL, &len );
-            if (FAILED(hr))
-                goto done;
-
-            len++;
-            value = SysAllocStringLen( NULL, len );
-            if (!value)
-            {
-                r = ERROR_OUTOFMEMORY;
-                goto done;
-            }
-
-            hr = IWineMsiRemotePackage_FormatRecord( remote_package, hRecord,
-                                                     value, &len );
+                                                     &value );
             if (FAILED(hr))
                 goto done;
 
diff --git a/dlls/msi/msiserver.idl b/dlls/msi/msiserver.idl
index d5b47ac..37aa91e 100644
--- a/dlls/msi/msiserver.idl
+++ b/dlls/msi/msiserver.idl
@@ -70,7 +70,7 @@ interface IWineMsiRemotePackage : IUnknown
     HRESULT SetComponentState( [in] BSTR component, [in] INSTALLSTATE state );
     HRESULT GetLanguage( [out] LANGID *language );
     HRESULT SetInstallLevel( [in] int level );
-    HRESULT FormatRecord( [in] MSIHANDLE record, [out] BSTR value, [out] DWORD *size );
+    HRESULT FormatRecord( [in] MSIHANDLE record, [out] BSTR *value );
     HRESULT EvaluateCondition( [in] BSTR condition );
 }
 
diff --git a/dlls/msi/package.c b/dlls/msi/package.c
index a587a63..f11b068 100644
--- a/dlls/msi/package.c
+++ b/dlls/msi/package.c
@@ -1812,10 +1812,19 @@ static HRESULT WINAPI mrp_SetInstallLevel( IWineMsiRemotePackage *iface, int lev
 }
 
 static HRESULT WINAPI mrp_FormatRecord( IWineMsiRemotePackage *iface, MSIHANDLE record,
-                                 BSTR value, DWORD *size )
+                                        BSTR *value)
 {
+    DWORD size = 0;
     msi_remote_package_impl* This = mrp_from_IWineMsiRemotePackage( iface );
-    UINT r = MsiFormatRecordW(This->package, record, (LPWSTR)value, size);
+    UINT r = MsiFormatRecordW(This->package, record, NULL, &size);
+    if (r == ERROR_SUCCESS)
+    {
+        *value = SysAllocStringLen(NULL, size);
+        if (!*value)
+            return E_OUTOFMEMORY;
+        size++;
+        r = MsiFormatRecordW(This->package, record, *value, &size);
+    }
     return HRESULT_FROM_WIN32(r);
 }
 
-- 
1.5.3.8


--------------050007050203060904040902--


From jnewman at codeweavers.com  Tue Apr 15 12:53:17 2008
From: jnewman at codeweavers.com (Jeremy Newman)
Date: Tue, 15 Apr 2008 12:53:17 -0500
Subject: [WineHQ] Assorted spelling fixes.
In-Reply-To: <alpine.DEB.1.10.0804151124480.31798@amboise.dolphin>
References: <alpine.DEB.1.10.0804151124480.31798@amboise.dolphin>
Message-ID: <4804EB8D.6070107@codeweavers.com>

This patch does not apply for me, I get the following errors:

jnewman at jnewman:/home/httpd/html/winehq_org$ git am ~/Downloads/patch.eml
Applying Assorted spelling fixes.
.dotest/patch:38: trailing whitespace.
     between GDI/USER and the KERNEL, that is not absolutely needed, must be
.dotest/patch:47: trailing whitespace.
<quote who="Patrick Stridvall">I think your original suggestion making Wine
.dotest/patch:60: trailing whitespace.
not very optimized so I wouldn't be surprised if it is _much_ slower.
.dotest/patch:69: trailing whitespace.
Ove's pthread hack is a good way to make more libc functions usable
.dotest/patch:82: trailing whitespace.
It is of course also possible to override these settings by explicitly 
using Wine's --dll command-line
error: patch failed: wwn/wn19990627_2.xml:474
error: wwn/wn19990627_2.xml: patch does not apply
error: patch failed: wwn/wn19990718_4.xml:394
error: wwn/wn19990718_4.xml: patch does not apply
error: patch failed: wwn/wn20000605_46.xml:364
error: wwn/wn20000605_46.xml: patch does not apply
error: patch failed: wwn/wn20001106_68.xml:566
error: wwn/wn20001106_68.xml: patch does not apply
error: patch failed: wwn/wn20010718_100.xml:342
error: wwn/wn20010718_100.xml: patch does not apply
error: patch failed: wwn/wn20011021_106.xml:422
error: wwn/wn20011021_106.xml: patch does not apply
error: patch failed: wwn/wn20020308_117.xml:720
error: wwn/wn20020308_117.xml: patch does not apply
error: patch failed: wwn/wn20030103_151.xml:437
error: wwn/wn20030103_151.xml: patch does not apply
error: patch failed: wwn/wn20030228_159.xml:566
error: wwn/wn20030228_159.xml: patch does not apply
error: patch failed: wwn/wn20030725_180.xml:165
error: wwn/wn20030725_180.xml: patch does not apply
error: patch failed: wwn/wn20030829_185.xml:381
error: wwn/wn20030829_185.xml: patch does not apply
error: patch failed: wwn/wn20041022_245.xml:162
error: wwn/wn20041022_245.xml: patch does not apply
error: patch failed: wwn/wn20041126_250.xml:337
error: wwn/wn20041126_250.xml: patch does not apply
error: patch failed: wwn/wn20050415_270.xml:257
error: wwn/wn20050415_270.xml: patch does not apply
error: patch failed: wwn/wn20050506_273.xml:354
error: wwn/wn20050506_273.xml: patch does not apply
error: patch failed: wwn/wn20050819_288.xml:286
error: wwn/wn20050819_288.xml: patch does not apply
error: patch failed: wwn/wn20051014_294.xml:155
error: wwn/wn20051014_294.xml: patch does not apply
error: patch failed: wwn/wn20051125_299.xml:294
error: wwn/wn20051125_299.xml: patch does not apply
error: patch failed: wwn/wn20060226_306.xml:208
error: wwn/wn20060226_306.xml: patch does not apply
error: patch failed: wwn/wn20060410_311.xml:321
error: wwn/wn20060410_311.xml: patch does not apply
error: patch failed: wwn/wn20060428_312.xml:287
error: wwn/wn20060428_312.xml: patch does not apply
error: patch failed: wwn/wn20070416_329.xml:304
error: wwn/wn20070416_329.xml: patch does not apply
Patch failed at 0001.
When you have resolved this problem run "git-am --resolved".
If you would prefer to skip this patch, instead run "git-am --skip".



Francois Gouget wrote:
> ---
> 
> The attachement will probably look a bit strange but it should work 
> anyway.
> 
>  wwn/wn19990627_2.xml   |    4 ++--
>  wwn/wn19990718_4.xml   |    4 ++--
>  wwn/wn20000605_46.xml  |    2 +-
>  wwn/wn20001106_68.xml  |    2 +-
>  wwn/wn20010718_100.xml |    2 +-
>  wwn/wn20011021_106.xml |    2 +-
>  wwn/wn20020308_117.xml |    2 +-
>  wwn/wn20030103_151.xml |    6 +++---
>  wwn/wn20030228_159.xml |    2 +-
>  wwn/wn20030725_180.xml |    2 +-
>  wwn/wn20030829_185.xml |    4 ++--
>  wwn/wn20041022_245.xml |    2 +-
>  wwn/wn20041126_250.xml |    2 +-
>  wwn/wn20050415_270.xml |    2 +-
>  wwn/wn20050506_273.xml |    4 ++--
>  wwn/wn20050819_288.xml |    2 +-
>  wwn/wn20051014_294.xml |    2 +-
>  wwn/wn20051125_299.xml |    2 +-
>  wwn/wn20060226_306.xml |    2 +-
>  wwn/wn20060410_311.xml |    2 +-
>  wwn/wn20060428_312.xml |    4 ++--
>  wwn/wn20070416_329.xml |    2 +-
>  22 files changed, 29 insertions(+), 29 deletions(-)
> 
> 
> ------------------------------------------------------------------------
> 
> 


From julliard at winehq.org  Tue Apr 15 13:05:08 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Tue, 15 Apr 2008 20:05:08 +0200
Subject: Feature Request: Registry / winecfg entry for launching an
	application in a wineexplorer window
In-Reply-To: <b6bb06270804151007h717ebc48n7b33025c902f3985@mail.gmail.com>
	(Austin English's message of "Tue, 15 Apr 2008 12:07:48 -0500")
References: <4803182C.9070209@open-vote.org>
	<200804140534.33333.chris.kcat@gmail.com>
	<b6bb06270804141004nd99e48are3158647a4482bc2@mail.gmail.com>
	<48040EDD.7010708@kievinfo.com>
	<b6bb06270804151007h717ebc48n7b33025c902f3985@mail.gmail.com>
Message-ID: <87od8bm1t7.fsf@wine.dyndns.org>

"Austin English" <austinenglish at gmail.com> writes:

> What would be lost by having those apps that someone wants to be in
> their own virtual desktop each having their own (with unique names).
> I.e., if you choose to give Starcraft and Wow each their own desktop,
> but not notepad:
> $ wine notepad #works in regular managed mode
> $ wine wow.exe # would be equivalent to running wine explorer
> /desktop=wow,1024x768 wow.exe
> $ wine starcraft.exe # would be equivalent to running wine explorer
> /desktop=starcraft,800x600 starcraft.exe
>
> With the desktop names being either assigned by program name,
> automatically assigned, or chosen by the user. Resolution could
> default to 800 x 600, but also be customizable in winecfg.
>
> Thoughts?

That's clearly something that would be nice to have, but it's not
trivial to do; otherwise it would have been done already, it has been
requested for a while now. Patches are welcome of course...

-- 
Alexandre Julliard
julliard at winehq.org


From jnewman at codeweavers.com  Tue Apr 15 13:18:20 2008
From: jnewman at codeweavers.com (Jeremy Newman)
Date: Tue, 15 Apr 2008 13:18:20 -0500
Subject: Full Screen Desktop Mode
Message-ID: <4804F16C.3050002@codeweavers.com>

Here is a feature request that I'd had in my head for quite some time 
now. I don't usually pass my crazy ideas on down through the devel pipe, 
but I feel this one is too good to pass up on.

Many of us still use desktop mode to get around issues with various 
window managers (compiz, metacity, etc). But running a game in desktop 
mode, you loose out on running full screen.

It would be slick if the Wine desktop could be switched into full screen 
on the fly with a hotkey (say Ctrl + Alt + Enter). So if you are running 
a 1280x800 Wine desktop on a 1680x1050 screen, and you hit the hotkey, 
the resolution would be switched to 1280x800 and the Wine desktop is 
your screen until you hit the hotkey to switch back, or you exit the 
program.

Sound fun?


From developers at tefnet.pl  Tue Apr 15 08:04:49 2008
From: developers at tefnet.pl (Tomasz Jezierski - Tefnet)
Date: Tue, 15 Apr 2008 15:04:49 +0200
Subject: hhctrl.ocx: Parse HTML entities in the table of contents.
In-Reply-To: <874pluwkj0.fsf@wine.dyndns.org>
References: <4657EA04.1010107@codeweavers.com> <874pluwkj0.fsf@wine.dyndns.org>
Message-ID: <1208264688.23885.17.camel@tefdemo>


Dnia 30-05-2007, ?ro o godzinie 14:41 +0200, Alexandre Julliard pisze:
> Robert Shearman <rob at codeweavers.com> writes:
> 
Hi, I found this patch from May which never got into wine.
http://www.winehq.org/pipermail/wine-patches/2007-May/039722.html

Could you explain me what is still wrong with it? I would like to fix
it.


> > +            p++;
> > +            if ((*p == 'X') || (*p == 'x'))
> > +            {
> > +                /* hexadecimal entity */
> > +                while ((*p >= '0' && *p <= '9') || (*p >= 'a' && *p <= 'f') ||
> > +                       (*p >= 'A' && *p <= 'F'))
> > +                    p++;
> > +                ch = strtolW(start + 2, NULL, 16);
> > +            }
> 
> This is still broken.
You said earlier:
"You should exit the loop at the first ';'. Also you have to increment
p first."

It looks like Robert did what you said?

> 
> > +            if (p - start - 1 <= sizeof(char_refs[0].name))
> > +            {
> > +                for (i = 0; i < sizeof(char_refs)/sizeof(char_refs[0]); i++)
> > +                    if (!strncmpW(char_refs[i].name, start + 1, p - start - 1))
> > +                        break;
> > +            }
> 
> This is still broken too.

You said earlier:
"The sizeof check doesn't make much sense, especially inside the
loop. What you need is to check that you reached the end of the string
if the strncmpW succeeded."

You mean to check if *p == 0 ?



While reading this patch I found another bug:

+            if (i == sizeof(char_refs)/sizeof(char_refs[0]))
+            {
+                FIXME("character entity %s not found\n", debugstr_wn(start + 1, p - start - 1));
+                continue;
+            }

I think *start should be changed to another char in that case, because if we will not change it, we will fall into infinite loop like it happens with help file in GPSTRACK from bug #6801.

Moreover we need full entity table, one of those mentioned by Hin-Tak Leung:
http://bugs.winehq.org/show_bug.cgi?id=6801#c28







From truiken at gmail.com  Tue Apr 15 15:12:32 2008
From: truiken at gmail.com (James Hawkins)
Date: Tue, 15 Apr 2008 15:12:32 -0500
Subject: RFC: Fix for IWineMsiRemotePackage::FormatRecord
In-Reply-To: <4804E87D.2000209@codeweavers.com>
References: <4804E87D.2000209@codeweavers.com>
Message-ID: <22821af30804151312u25bcbb4o8c95c63ce1fde6ff@mail.gmail.com>

On Tue, Apr 15, 2008 at 12:40 PM, Robert Shearman <rob at codeweavers.com> wrote:
> Hi,
>
>  Currently, the [out] value parameter for
> IWineMsiRemotePackage::FormatRecord doesn't have a level of indirection
> associated with it and so I would be very surprised if the typelib
> marshaller actually does the right thing in this case. Compiling with MIDL
> and with a future update to widl causes an error for this parameter. I'm
> proposing the attached patch to fix things, but I'm not able to test that
> this works correctly.
>

> Remove the redundant size parameter and simplify the client code such that the remote function is only called once, with the value being automatically allocated. Add corresponding code on the server side to automatically allocate said value.

Yea, this is good.  I remember that I had a problem with this when I
wrote it, but I wasn't sure of the right way to go.

-- 
James Hawkins


From rob at codeweavers.com  Tue Apr 15 15:41:01 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Tue, 15 Apr 2008 21:41:01 +0100
Subject: browseui: Remove unused variables
In-Reply-To: <200804152133.19736.andrew.talbot@talbotville.com>
References: <200804152133.19736.andrew.talbot@talbotville.com>
Message-ID: <480512DD.7010201@codeweavers.com>

Andrew Talbot wrote:
> @@ -299,7 +299,6 @@ static HRESULT WINAPI ProgressDialog_StartProgressDialog(IProgressDialog *iface,
>  {
>      ProgressDialog *This = (ProgressDialog *)iface;
>      struct create_params params;
> -    HANDLE hThread;
>  
>      TRACE("(%p, %p, %x, %p)\n", iface, punkEnableModeless, dwFlags, reserved);
>      if (punkEnableModeless || reserved)
> @@ -321,7 +320,7 @@ static HRESULT WINAPI ProgressDialog_StartProgressDialog(IProgressDialog *iface,
>      params.hwndParent = hwndParent;
>      params.hEvent = CreateEventW(NULL, TRUE, FALSE, NULL);
>  
> -    hThread = CreateThread(NULL, 0, dialog_thread, &params, 0, NULL);
> +    CreateThread(NULL, 0, dialog_thread, &params, 0, NULL);
>      WaitForSingleObject(params.hEvent, INFINITE);
>  
>      This->hwndDisabledParent = NULL;

A correct fix is to call CloseHandle(hThread), otherwise the handle is 
leaked.


-- 
Rob Shearman



From rob at codeweavers.com  Tue Apr 15 15:42:55 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Tue, 15 Apr 2008 21:42:55 +0100
Subject: comctl32: Remove unused variables
In-Reply-To: <200804152133.23009.andrew.talbot@talbotville.com>
References: <200804152133.23009.andrew.talbot@talbotville.com>
Message-ID: <4805134F.8010603@codeweavers.com>

Andrew Talbot wrote:
> @@ -967,16 +967,14 @@ static HFONT SYSLINK_SetFont (SYSLINK_INFO *infoPtr, HFONT hFont, BOOL bRedraw)
>   */
>  static LRESULT SYSLINK_SetText (SYSLINK_INFO *infoPtr, LPCWSTR Text)
>  {
> -    int textlen;
> -
>      /* clear the document */
>      SYSLINK_ClearDoc(infoPtr);
> -    
> -    if(Text == NULL || (textlen = lstrlenW(Text)) == 0)
> +
> +    if(Text == NULL || lstrlenW(Text) == 0)
>      {
>   

A better fix would be to use "*Text == 0" instead of "lstrlenW(Text) == 0".

-- 
Rob Shearman



From rob at codeweavers.com  Tue Apr 15 15:44:15 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Tue, 15 Apr 2008 21:44:15 +0100
Subject: dinput: Remove unused variables
In-Reply-To: <200804152133.26439.andrew.talbot@talbotville.com>
References: <200804152133.26439.andrew.talbot@talbotville.com>
Message-ID: <4805139F.5020203@codeweavers.com>

Andrew Talbot wrote:
> @@ -142,13 +142,12 @@ static INT find_joystick_devices(void)
>      {
>          CHAR device_name[MAX_PATH], *str;
>          INT len;
> -        int fd;
>  
>          len = sprintf(device_name, "%s%d", JOYDEV_NEW, i) + 1;
> -        if ((fd = open(device_name, O_RDONLY)) < 0)
> +        if (open(device_name, O_RDONLY) < 0)
>          {
>              len = sprintf(device_name, "%s%d", JOYDEV_OLD, i) + 1;
> -            if ((fd = open(device_name, O_RDONLY)) < 0) continue;
> +            if (open(device_name, O_RDONLY) < 0) continue;
>          }
>  
>          if (!(str = HeapAlloc(GetProcessHeap(), 0, len))) break;

Again, this needs to be fixed in another way as fd is being leaked.

-- 
Rob Shearman



From Andrew.Talbot at talbotville.com  Tue Apr 15 16:13:51 2008
From: Andrew.Talbot at talbotville.com (Andrew Talbot)
Date: Tue, 15 Apr 2008 22:13:51 +0100
Subject: browseui: Remove unused variables
References: <200804152133.19736.andrew.talbot@talbotville.com>
	<480512DD.7010201@codeweavers.com>
Message-ID: <fu35qf$sdn$1@ger.gmane.org>

Robert Shearman wrote:

> A correct fix is to call CloseHandle(hThread), otherwise the handle is
> leaked.
> 
Thanks, Rob. I've sent a replacement patch entitled
"browseui: Fix handle leak" to replace this.

-- 
Andy.




From Andrew.Talbot at talbotville.com  Tue Apr 15 16:56:24 2008
From: Andrew.Talbot at talbotville.com (Andrew Talbot)
Date: Tue, 15 Apr 2008 22:56:24 +0100
Subject: dinput: Remove unused variables
References: <200804152133.26439.andrew.talbot@talbotville.com>
	<4805139F.5020203@codeweavers.com>
Message-ID: <fu38a8$3pk$1@ger.gmane.org>

Robert Shearman wrote:

> Again, this needs to be fixed in another way as fd is being leaked.
> 

Thanks, again. I've sent a patch entitled
"dinput: Fix handle leak" to replace this.

-- 
Andy.




From khodych at gmail.com  Tue Apr 15 16:59:44 2008
From: khodych at gmail.com (Sergey Khodych)
Date: Wed, 16 Apr 2008 00:59:44 +0300
Subject: dinput: Implement DIPROP_KEYNAME property for keyboard device
In-Reply-To: <48040DA6.6090708@kievinfo.com>
References: <48023854.9020308@gmail.com>
	<48024DC2.3020008@kievinfo.com>	<4803AB6A.3040900@gmail.com>
	<48040DA6.6090708@kievinfo.com>
Message-ID: <48052550.4070504@gmail.com>

> In ascii function you are calling unicode function and copying it's output 
> (unicode string) to the ascii string buffer. This is wrong. Also because 
> these functions deal with strings you have to implement both ascii and 
> unicode functions at the same time. You can't forward one to the other.
Variable ps->wsz not a ascii string buffer because wsz field of struct
DIPROPSTRING has type WCHAR[MAX_PATH]. Function
IDirectInputDevice8::GetProperty works only with unicode strings.






From developers at tefnet.pl  Tue Apr 15 08:59:10 2008
From: developers at tefnet.pl (Tomasz Jezierski - Tefnet)
Date: Tue, 15 Apr 2008 15:59:10 +0200
Subject: hhctrl.ocx: Parse HTML entities in the table of contents.
Message-ID: <1208267950.25171.5.camel@tefdemo>

Dnia 30-05-2007, ?ro o godzinie 14:41 +0200, Alexandre Julliard pisze:
> Robert Shearman <rob at codeweavers.com> writes:
> 

Hi, I found this patch from May 2007 which never got into wine.
http://www.winehq.org/pipermail/wine-patches/2007-May/039722.html

Could you explain me what is still wrong with it? I would like to fix
it.


> > +            p++;
> > +            if ((*p == 'X') || (*p == 'x'))
> > +            {
> > +                /* hexadecimal entity */
> > +                while ((*p >= '0' && *p <= '9') || (*p >= 'a' && *p
<= 'f') ||
> > +                       (*p >= 'A' && *p <= 'F'))
> > +                    p++;
> > +                ch = strtolW(start + 2, NULL, 16);
> > +            }
> 
> This is still broken.

You said earlier:
"You should exit the loop at the first ';'. Also you have to increment
p first."

It looks like Robert did what you said?

> 
> > +            if (p - start - 1 <= sizeof(char_refs[0].name))
> > +            {
> > +                for (i = 0; i <
sizeof(char_refs)/sizeof(char_refs[0]); i++)
> > +                    if (!strncmpW(char_refs[i].name, start + 1, p -
start - 1))
> > +                        break;
> > +            }
> 
> This is still broken too.

You said earlier:
"The sizeof check doesn't make much sense, especially inside the
loop. What you need is to check that you reached the end of the string
if the strncmpW succeeded."

You mean to check if *p == 0 ?




While reading this patch I found another bug:

+            if (i == sizeof(char_refs)/sizeof(char_refs[0]))
+            {
+                FIXME("character entity %s not found\n",
debugstr_wn(start + 1, p - start - 1));
+                continue;
+            }

I think *start should be changed to another char in that case, because
if we will not change it, we will fall into infinite loop like it
happens with help file in GPSTRACK from bug #6801.

Moreover we need full entity table, one of those mentioned by Hin-Tak
Leung:
http://bugs.winehq.org/show_bug.cgi?id=6801#c28







From developers at tefnet.pl  Tue Apr 15 10:07:23 2008
From: developers at tefnet.pl (Tomasz Jezierski - Tefnet)
Date: Tue, 15 Apr 2008 17:07:23 +0200
Subject: Apparently it is possible to have chm file without #STRINGS in
	it, so we should not stop processing file at it. Fixes bug #12498
In-Reply-To: <3a768c550804150714q1c8b004dt9ed135c1be1d1439@mail.gmail.com>
References: <3a768c550804141658x6051f8a3raadc85603cedc023@mail.gmail.com>
	<1208241074.18325.9.camel@zgierznet>
	<3a768c550804150714q1c8b004dt9ed135c1be1d1439@mail.gmail.com>
Message-ID: <1208272043.25171.18.camel@tefdemo>

Dnia 15-04-2008, wto o godzinie 07:14 -0700, Juan Lang pisze:
> >  Have you tried patch without this "if"? In my case it crashes
without it
> >  when I try to open chm from bug #12498... i don't know if strdupW
can
> >  dup NULL as well as null?
> 
> Aaaah...  Sorry, my mistake, I missed this declaration:
>         static const WCHAR null[] = {0};
> That solves that mystery.
> 
> In that case, one fix per patch, please.  This fix and the other are
> unrelated:  one fixes a crash, the other deals with a missing #STRINGS
> stream.  Thanks,

No, I think that crash is only possible with my patch. Right now if
there is no #STRINGS it closes chm and stops processing.




From sonia.xapelli at ilidium.com  Tue Apr 15 11:03:00 2008
From: sonia.xapelli at ilidium.com (=?ISO-8859-1?Q?S=F2nia_Xapell=ED_Br=FA?=)
Date: Tue, 15 Apr 2008 18:03:00 +0200
Subject: quartz: FOURCC Error in compiling
Message-ID: <4804D1B4.6030505@ilidium.com>

When I try to compile the wine tree of today I get an error compiling 
avisplit.o: There is no rule to build fourcc.h needed for avisplit.o

/make[2]: *** No hay ninguna regla para construir el objetivo 
`fourcc.h', necesario para `avisplit.o'.  Alto.
make[2]: se sale del directorio `/wine-git/dlls/quartz'
make[1]: *** [quartz] Error 2
make[1]: se sale del directorio `/wine-git/dlls'
make: *** [dlls] Error 2
/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080415/5c60977e/attachment.htm 

From juan.lang at gmail.com  Tue Apr 15 17:48:59 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Tue, 15 Apr 2008 15:48:59 -0700
Subject: quartz: FOURCC Error in compiling
In-Reply-To: <4804D1B4.6030505@ilidium.com>
References: <4804D1B4.6030505@ilidium.com>
Message-ID: <3a768c550804151548p3802f790q98bbe4d320a34a2f@mail.gmail.com>

>  When I try to compile the wine tree of today I get an error compiling
> avisplit.o

This was already addressed:
http://www.winehq.org/pipermail/wine-devel/2008-April/064884.html
--Juan


From dank at kegel.com  Tue Apr 15 20:05:00 2008
From: dank at kegel.com (Dan Kegel)
Date: Tue, 15 Apr 2008 18:05:00 -0700
Subject: Something strange: installers not waiting for subinstallers any more?
Message-ID: <a71bd89a0804151805y2da885b8o12bdd3ba6a9b5a64@mail.gmail.com>

I just installed Photoshop CS2 trial using yesterday morning's cvs,
and there seemed to be two odd failure:
1) gecko didn't install properly
2) the outer installer declared victory way before the inner installer
was done unpacking

Mysterious, very mysterious.

Ah, well, I'll close my eyes and hope it goes away :-)


From juan.lang at gmail.com  Tue Apr 15 21:41:20 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Tue, 15 Apr 2008 19:41:20 -0700
Subject: Apparently it is possible to have chm file without #STRINGS in it,
	so we should not stop processing file at it. Fixes bug #12498
In-Reply-To: <993130.26158.qm@web23113.mail.ird.yahoo.com>
References: <3a768c550804150714q1c8b004dt9ed135c1be1d1439@mail.gmail.com>
	<993130.26158.qm@web23113.mail.ird.yahoo.com>
Message-ID: <3a768c550804151941n763185y73aad79a20fe0b46@mail.gmail.com>

>  Hmm, sorry, it is probably not a good idea to name a variable "null" -
>  it is just a little confusing. Maybe W_Null or even Wchar_Null or
>  to make it more obvious that it is a programmer-defined variable?

I agree, but Tomasz didn't name this variable, it was already in the
code--that's how I missed it.  I don't think it's a problem in this
patch.
--Juan


From wine-devel at kievinfo.com  Wed Apr 16 00:23:49 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Tue, 15 Apr 2008 23:23:49 -0600
Subject: dinput: Implement DIPROP_KEYNAME property for keyboard device
In-Reply-To: <48052550.4070504@gmail.com>
References: <48023854.9020308@gmail.com>	<48024DC2.3020008@kievinfo.com>	<4803AB6A.3040900@gmail.com>	<48040DA6.6090708@kievinfo.com>
	<48052550.4070504@gmail.com>
Message-ID: <48058D65.5000007@kievinfo.com>

Sergey Khodych wrote:
>> In ascii function you are calling unicode function and copying it's output 
>> (unicode string) to the ascii string buffer. This is wrong. Also because 
>> these functions deal with strings you have to implement both ascii and 
>> unicode functions at the same time. You can't forward one to the other.
> Variable ps->wsz not a ascii string buffer because wsz field of struct
> DIPROPSTRING has type WCHAR[MAX_PATH]. Function
> IDirectInputDevice8::GetProperty works only with unicode strings.
> 
No, there are 2 separate implementations - one ascii another unicode. During 
the object creation one would specify either ascii or unicode RIID.

Vitaliy.


From hintak_leung at yahoo.co.uk  Tue Apr 15 19:41:52 2008
From: hintak_leung at yahoo.co.uk (Hin-Tak Leung)
Date: Wed, 16 Apr 2008 00:41:52 +0000 (GMT)
Subject: Apparently it is possible to have chm file without #STRINGS in it,
	so we should not stop processing file at it. Fixes bug #12498
In-Reply-To: <3a768c550804150714q1c8b004dt9ed135c1be1d1439@mail.gmail.com>
Message-ID: <993130.26158.qm@web23113.mail.ird.yahoo.com>

--- On Tue, 15/4/08, Juan Lang <juan.lang at gmail.com> wrote:

> From: Juan Lang <juan.lang at gmail.com>
> Subject: Re: Apparently it is possible to have chm file without #STRINGS in it, so we should not stop processing file at it. Fixes bug #12498
> To: "Tomasz Jezierski - Tefnet" <developers at tefnet.pl>
> Cc: "Wine Developers List" <wine-devel at winehq.org>
> Date: Tuesday, 15 April, 2008, 3:14 PM
> >  Have you tried patch without this "if"? In
> my case it crashes without it
> >  when I try to open chm from bug #12498... i don't
> know if strdupW can
> >  dup NULL as well as null?
> 
> Aaaah...  Sorry, my mistake, I missed this declaration:
>         static const WCHAR null[] = {0};
> That solves that mystery.
> 
> In that case, one fix per patch, please.  This fix and the
> other are
> unrelated:  one fixes a crash, the other deals with a
> missing #STRINGS
> stream.  Thanks,
> --Juan

Hmm, sorry, it is probably not a good idea to name a variable "null" - 
it is just a little confusing. Maybe W_Null or even Wchar_Null or
to make it more obvious that it is a programmer-defined variable? 


      ___________________________________________________________ 
Yahoo! For Good helps you make a difference  

http://uk.promotions.yahoo.com/forgood/


From hintak_leung at yahoo.co.uk  Tue Apr 15 19:49:30 2008
From: hintak_leung at yahoo.co.uk (Hin-Tak Leung)
Date: Wed, 16 Apr 2008 00:49:30 +0000 (GMT)
Subject: hhctrl.ocx: Parse HTML entities in the table of contents.
In-Reply-To: <1208267950.25171.5.camel@tefdemo>
Message-ID: <326392.29812.qm@web23106.mail.ird.yahoo.com>




--- On Tue, 15/4/08, Tomasz Jezierski - Tefnet <developers at tefnet.pl> wrote:
<snipped>
> While reading this patch I found another bug:
> 
> +            if (i ==
> sizeof(char_refs)/sizeof(char_refs[0]))
> +            {
> +                FIXME("character entity %s not
> found\n",
> debugstr_wn(start + 1, p - start - 1));
> +                continue;
> +            }
> 
> I think *start should be changed to another char in that
> case, because
> if we will not change it, we will fall into infinite loop
> like it
> happens with help file in GPSTRACK from bug #6801.

I have experience the infinite loop myself, but I haven't quite checked
where it is - it happens if the table is incomplete and the code
encounters an html entity that's not mentioned in the table. I encountered it when I tried to view some help pages containing german &umlaute; 's
in another help file I happened to have around.
(gpstrack is about french accented characters.)

So in that sense, the patch is dangerous - infinite loop is far worse 
than not seeing a couple of help pages. I think it needs to do something sensible (e.g. don't translate) even if the table is incomplete.



      ___________________________________________________________ 
Yahoo! For Good helps you make a difference  

http://uk.promotions.yahoo.com/forgood/


From hintak_leung at yahoo.co.uk  Tue Apr 15 20:51:04 2008
From: hintak_leung at yahoo.co.uk (Hin-Tak Leung)
Date: Wed, 16 Apr 2008 01:51:04 +0000 (GMT)
Subject: ddiwrapper 0.3rc1
Message-ID: <718330.5702.qm@web23103.mail.ird.yahoo.com>

I have uploaded my mod'ed version of ddiwrapper to
http://www.linuxprinting.org/download/ddiwrapper/
and called it 0.3rc1. There are some stub codes which I added
to try to get the Konica-Minolta MC2500W XP driver to work without success, so they probably should be taken out, but they are fairly harmless and maybe useful to somebody else. I tried one of the Canon drivers and ddiwrapper worked as advertised. I have updated the change 
log and also added the following paragraph to the bottom of the README:

For Wine releases between Feb/March 2006 up to time of writing
(April 2008), it is necessary to comment out one line in the wine 
loader code to make ddiwrapper work:
====================================================
diff --git a/libs/wine/loader.c b/libs/wine/loader.c
index 0f05f0c..743d487 100644
--- a/libs/wine/loader.c
+++ b/libs/wine/loader.c
@@ -117,7 +117,7 @@ static void build_dll_path(void)
     if (dlldir)
     {
         dll_path_maxlen = strlen(dlldir);
-        dll_paths[nb_dll_paths++] = dlldir;
+        /* dll_paths[nb_dll_paths++] = dlldir; */
     }
     else if ((build_dir = wine_get_build_dir()))
     {
====================================================



      ___________________________________________________________ 
Yahoo! For Good helps you make a difference  

http://uk.promotions.yahoo.com/forgood/


From leslie_alistair at hotmail.com  Wed Apr 16 01:50:46 2008
From: leslie_alistair at hotmail.com (Alistair Leslie-Hughes)
Date: Wed, 16 Apr 2008 16:50:46 +1000
Subject: Help with configure option
Message-ID: <4805A1C6.1060107@hotmail.com>

Hi,
   I need to add an option, HAS_TEXTCONCAT_BUG to the configure script 
to check for a bug in libxml.  What file(s) do I have to change?

The file attached is an example to test for this issue. (returns -1 if 
the error exists)

Best Regards
  Alistair Leslie-Hughes
-------------- next part --------------
A non-text attachment was scrubbed...
Name: sampleXML.c
Type: text/x-csrc
Size: 307 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080416/5263d11b/attachment.c 

From wjsqudtlr at gmail.com  Wed Apr 16 01:45:50 2008
From: wjsqudtlr at gmail.com (ByeongSik Jeon)
Date: Wed, 16 Apr 2008 15:45:50 +0900
Subject: IMM / IME work
In-Reply-To: <48049E99.7060205@codeweavers.com>
References: <48049E99.7060205@codeweavers.com>
Message-ID: <1208328350.2682.16.camel@localhost>

Aric Stewart wrote:
>   I have tested with windows ATOK20 (a popular Japanese IME) and 
> successfully had text processing in a fully IME aware application.
Great!!!!

I have tested with "MS IME 2002(imekr61.ime)", "MS IME
2003(imekr70.ime)", and "Saenaru(saenaru.ime)" [1].
These all are works with next two patches.

Default conversion mode toggle key of Korean IME is Hangul( == XK_Hangul
== VK_Hangul). 

Regards...

Thanks.
----
[1] Saenaru, Korean Free IME, http://kldp.net/projects/saenaru/
    http://kldp.net/frs/download.php/4353/Saenaru-1.0.1.exe

    INSTALL & SETUP
    $ wine Saenaru-1.0.1.exe
    $ regedit wine_saenaru.reg

    Conversion mode toggle key: Shift+Space(by wine_saenaru.reg) or
Hangul(default)

-------------- next part --------------
REGEDIT4

[HKEY_LOCAL_MACHINE\Software\OpenHangulProject]

[HKEY_LOCAL_MACHINE\Software\OpenHangulProject\Saenaru]
@="C:\\WINDOWS\\IME\\Saenaru"
"LayoutFlag"=dword:00000001
"OptionFlag"=dword:00000080
"StatusPos"=dword:00000000

[HKEY_LOCAL_MACHINE\Software\OpenHangulProject\Saenaru\Dictionary]
@="nabi.dic"
"HanjaIndex"="jinsuk.dic"
"Symbol"="symwin.dic"
"Word"="word.dic"

[HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Keyboard Layouts\E0010412]
"IME file"="SAENARU.IME"

[HKEY_CURRENT_USER\Software\Wine\X11 Driver]
"UseXIM"="N"

From developers at tefnet.pl  Wed Apr 16 02:16:52 2008
From: developers at tefnet.pl (Tomasz Jezierski - Tefnet)
Date: Wed, 16 Apr 2008 09:16:52 +0200
Subject: hhctrl.ocx: Parse HTML entities in the table of contents.
In-Reply-To: <326392.29812.qm@web23106.mail.ird.yahoo.com>
References: <1208267950.25171.5.camel@tefdemo>
	<326392.29812.qm@web23106.mail.ird.yahoo.com>
Message-ID: <1208330212.19262.7.camel@tefdemo>


Dnia 16-04-2008, ?ro o godzinie 00:49 +0000, Hin-Tak Leung pisze:
> 
> 
> --- On Tue, 15/4/08, Tomasz Jezierski - Tefnet <developers at tefnet.pl> wrote:
> <snipped>
> > While reading this patch I found another bug:
> > 
> > +            if (i ==
> > sizeof(char_refs)/sizeof(char_refs[0]))
> > +            {
> > +                FIXME("character entity %s not
> > found\n",
> > debugstr_wn(start + 1, p - start - 1));
> > +                continue;
> > +            }
> > 
> > I think *start should be changed to another char in that
> > case, because
> > if we will not change it, we will fall into infinite loop
> > like it
> > happens with help file in GPSTRACK from bug #6801.
> 
> I have experience the infinite loop myself, but I haven't quite checked
> where it is - it happens if the table is incomplete and the code
> encounters an html entity that's not mentioned in the table. I encountered it when I tried to view some help pages containing german &umlaute; 's
> in another help file I happened to have around.
> (gpstrack is about french accented characters.)
> 
If you won't find entity in table and change ampersand to another char,
you won't get infinite loop, but I'm not sure what will happen if you
have &amp; in help, that might trigger loop too. Do you know any free
software in which I can craft such chm files?






From astrand at cendio.se  Wed Apr 16 07:04:40 2008
From: astrand at cendio.se (=?UTF-8?Q?Peter_=C3=85strand?=)
Date: Wed, 16 Apr 2008 14:04:40 +0200 (CEST)
Subject: Strange waveOutGetDevCaps calls in winmm/tests/wave.c
Message-ID: <Pine.LNX.4.64.0804161351210.19758@maggie.lkpg.cendio.se>


winmm/tests/wave.c currently contains:

    rc=waveOutGetDevCapsA(device,&capsA,4);
    ok(rc==MMSYSERR_NOERROR,
       "waveOutGetDevCapsA(%s): MMSYSERR_NOERROR expected, got %s\n",
       dev_name(device),wave_out_error(rc));

    rc=waveOutGetDevCapsW(device,&capsW,4);
    ok(rc==MMSYSERR_NOERROR || rc==MMSYSERR_NOTSUPPORTED,
       "waveOutGetDevCapsW(%s): MMSYSERR_NOERROR or MMSYSERR_NOTSUPPORTED "
       "expected, got %s\n",dev_name(device),wave_out_error(rc));

This seems wrong to me; the last argument should be the size of the
WAVEOUTCAPS structure, and there are no such structures that have size 4. 

The CapsW test fails with our sound driver (tlsnd) as well as Microsofts 
Terminal Services driver (rdpsnd).

The CapsA test doesn't fail, probably since winmm wraps CapsA calls with 
CapsW calls and then does memcpy. In either case, calling 
waveOutGetDevCaps sith size=4 is not valid, as far as I can tell. 
Theoretically, it might be in the future, though, if some small caps 
structure is invented. I suggest that these tests are removed altogether:

--- wave.c      29 Feb 2008 12:18:36 -0000      1.67
+++ wave.c      16 Apr 2008 12:03:44 -0000
@@ -853,16 +853,6 @@
        "expected, got %s\n",dev_name(device),wave_out_error(rc));
     }

-    rc=waveOutGetDevCapsA(device,&capsA,4);
-    ok(rc==MMSYSERR_NOERROR,
-       "waveOutGetDevCapsA(%s): MMSYSERR_NOERROR expected, got %s\n",
-       dev_name(device),wave_out_error(rc));
-
-    rc=waveOutGetDevCapsW(device,&capsW,4);
-    ok(rc==MMSYSERR_NOERROR || rc==MMSYSERR_NOTSUPPORTED,
-       "waveOutGetDevCapsW(%s): MMSYSERR_NOERROR or MMSYSERR_NOTSUPPORTED 
"
-       "expected, got %s\n",dev_name(device),wave_out_error(rc));
-
     nameA=NULL;
     rc=waveOutMessage((HWAVEOUT)device, DRV_QUERYDEVICEINTERFACESIZE,
                       (DWORD_PTR)&size, 0);

Regards, 
---
Peter ?strand		ThinLinc Chief Developer
Cendio AB		http://www.cendio.se
Wallenbergs gata 4
583 30 Link?ping	Phone: +46-13-21 46 00

From kornelpal at gmail.com  Wed Apr 16 07:15:13 2008
From: kornelpal at gmail.com (=?ISO-8859-1?B?S29ybulsIFDhbA==?=)
Date: Wed, 16 Apr 2008 14:15:13 +0200
Subject: Including Mono within a Wine package - should Wine expect this?
References: <a71bd89a0804100645y2b7f9c94n719ab5f19374db04@mail.gmail.com><47FECF9E.1030309@open-vote.org><a71bd89a0804101954w31a24e2fn72c027796b771a6e@mail.gmail.com><47FF506D.4010102@open-vote.org>
	<20080411125059.293230@gmx.net><19e31a080804131011s11342880qd0ee9d2981a1c9be@mail.gmail.com><a71bd89a0804131228w188ecd20r9802c35198b25764@mail.gmail.com><20080414061400.39750@gmx.net>
	<a71bd89a0804140809s1d1af678uf5a6170ab5a1ae97@mail.gmail.com>
Message-ID: <002c01c89fbb$875c8f30$4e42ee55@kornelpal.hu>

Hi,

I am almost complete with implementing mixed-mode support for Mono only some 
code cleanup is remaining. Note that however this still will not support 
MSVCRT becuase that assumes that is running on .NET Framework. Also note 
that applications using unmanaged API (COM interfaces and DLL exports) of 
.NET Framework will not be compatible with Mono because those APIs are not 
implemented by Mono.

If my patch will be accepted you will see the changes in SVN trunk of Mono.

> From: "Dan Kegel" <dank at kegel.com>
>> On Sun, Apr 13, 2008 at 11:14 PM, Roderick Colenbrander
>> <thunderbird2k at gmx.net> wrote:
>>>  What we really need is mono's windows.forms to be layered on top of 
>>> gdi32 and user32 for windows controls like buttons, textboxes and so on 
>>> .. As lots of programs do overrides using native dlls on them, so that's 
>>> why it should be real windows controls with a wndproc.
>>>
>>>  Ironically the current situation is for a part our own issue. Years ago 
>>> Mono's windows.forms used winelib. They moved to a managed 
>>> implementation because they had wine integration issues and we weren't 
>>> that cooperative. Further they didn't like the 2d performance much 
>>> (likely due to the lack of a dib engine ..). They might be reluctant to 
>>> Wine.
>>
>> Yup.  We have to really get our act together, then undoing the fork
>> might make sense.

Undoing the fork is not that easy because the current System.Windows.Forms 
uses it's own rendering engine and low level parts have been completely 
rewritten to support platform independent rendering and message processing. 
It supports low level WndProc functionality but I don't know how much is it 
compatible with Microsoft's implementation.

Korn?l 



From aric at codeweavers.com  Wed Apr 16 07:20:33 2008
From: aric at codeweavers.com (Aric Stewart)
Date: Wed, 16 Apr 2008 07:20:33 -0500
Subject: IMM / IME work
In-Reply-To: <1208328350.2682.16.camel@localhost>
References: <48049E99.7060205@codeweavers.com>
	<1208328350.2682.16.camel@localhost>
Message-ID: <4805EF11.7070004@codeweavers.com>

Wonderful!

I am glad you have this working for you as well.
I think this will make it much easier to test and greatly improve our 
IME support in WINE.

-aric

ByeongSik Jeon wrote:
> Aric Stewart wrote:
>>   I have tested with windows ATOK20 (a popular Japanese IME) and 
>> successfully had text processing in a fully IME aware application.
> Great!!!!
> 
> I have tested with "MS IME 2002(imekr61.ime)", "MS IME
> 2003(imekr70.ime)", and "Saenaru(saenaru.ime)" [1].
> These all are works with next two patches.
> 
> Default conversion mode toggle key of Korean IME is Hangul( == XK_Hangul
> == VK_Hangul). 
> 
> Regards...
> 
> Thanks.
> ----
> [1] Saenaru, Korean Free IME, http://kldp.net/projects/saenaru/
>     http://kldp.net/frs/download.php/4353/Saenaru-1.0.1.exe
> 
>     INSTALL & SETUP
>     $ wine Saenaru-1.0.1.exe
>     $ regedit wine_saenaru.reg
> 
>     Conversion mode toggle key: Shift+Space(by wine_saenaru.reg) or
> Hangul(default)
> 
> 


From julliard at winehq.org  Wed Apr 16 07:41:13 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 16 Apr 2008 14:41:13 +0200
Subject: [PATCH] [WinHelp]: fix regression introduced by Dmitry's Win64
	warning fixes
In-Reply-To: <20080414185700.22586.58253.stgit@localhost> (Eric Pouech's
	message of "Mon, 14 Apr 2008 20:57:01 +0200")
References: <20080414185700.22586.58253.stgit@localhost>
Message-ID: <87wsmykm52.fsf@wine.dyndns.org>

Eric Pouech <eric.pouech at orange.fr> writes:

> index 8181469..bf942a4 100644
> --- a/programs/winhelp/hlpfile.c
> +++ b/programs/winhelp/hlpfile.c
> @@ -158,8 +158,8 @@ HLPFILE_PAGE *HLPFILE_PageByOffset(HLPFILE* hlpfile, LONG offset)
>  static int comp_PageByHash(void *p, const void *key,
>                             int leaf, void** next)
>  {
> -    ULONG_PTR lKey = (LONG_PTR)key;
> -    ULONG_PTR lTest = GET_UINT(p, 0);
> +    LONG_PTR lKey = (LONG_PTR)key;
> +    LONG_PTR lTest = GET_UINT(p, 0);

This won't work on 64-bit. If the hash really needs to be signed (why?)
you need some extra casts.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Wed Apr 16 07:44:39 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 16 Apr 2008 14:44:39 +0200
Subject: [Fwd: Bug#476232: winebuild fails to build for powerpc]
In-Reply-To: <48048451.6040402@arcticnet.no> (Ove Kaaven's message of "Tue, 15
	Apr 2008 12:32:49 +0200")
References: <48048451.6040402@arcticnet.no>
Message-ID: <87skxmklzc.fsf@wine.dyndns.org>

Ove Kaaven <ovek at arcticnet.no> writes:

> @@ -368,7 +368,7 @@ void BuildSpec32File( DLLSPEC *spec )
>      else
>      {
>          output( "\n\t.section \".init\",\"ax\"\n" );
> -        output( "\tjmp 1f\n" );
> +        output( "\t%s 1f\n", get_asm_branch_mnemonic() );
>          output( "__wine_spec_pe_header:\n" );
>          output( "\t.skip %u\n", 65536 + page_size );
>          output( "1:\n" );

I don't think it makes sense to add functions that return specific asm
mnemonics, there's no guarantee that all platforms would use a single
jump instruction here. You should add a switch the way it is done for
instance in output_asm_constructor().

-- 
Alexandre Julliard
julliard at winehq.org


From scott at open-vote.org  Wed Apr 16 08:52:49 2008
From: scott at open-vote.org (Scott Ritchie)
Date: Wed, 16 Apr 2008 06:52:49 -0700
Subject: Including Mono within a Wine package - should Wine expect this?
In-Reply-To: <48049192.4090906@arcticnet.no>
References: <a71bd89a0804100645y2b7f9c94n719ab5f19374db04@mail.gmail.com>
	<47FECF9E.1030309@open-vote.org> <48049192.4090906@arcticnet.no>
Message-ID: <480604B1.4090105@open-vote.org>

Ove Kaaven wrote:
> Debian's ia32-libs package isn't an example of a whole lot. It grabs
> compiled binaries from the official Debian archive, and nowhere else. It
> isn't built on a 32-bit system. If ia32-libs had contained binaries that
> could not be built 100% automatically using Debian's official archive
> (and only the official archive), it probably wouldn't have gotten into
> Debian. Besides, ia32-libs is not meant to be a long-lived package,
> it'll go away eventually.
> 

We've been saying that for 3 years now, and we've only become MORE
dependent on ia32-libs in the process.  The chief culprit, of course, is
Wine, and Wine's need to run 32 bit applications isn't going away soon.

Really, what Debian (and Ubuntu) need is to replace the contents of the
ia32-libs package with proper 32 versions of package (sorta like how
lib32asound and lib32z1 are now).  Fixing that, however, is a bit beyond
the scope of the wine-devel list ;)

Thanks,
Scott Ritchie


From rob at codeweavers.com  Wed Apr 16 09:21:19 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Wed, 16 Apr 2008 15:21:19 +0100
Subject: Help with configure option
In-Reply-To: <4805A1C6.1060107@hotmail.com>
References: <4805A1C6.1060107@hotmail.com>
Message-ID: <48060B5F.9050403@codeweavers.com>

Alistair Leslie-Hughes wrote:
>   I need to add an option, HAS_TEXTCONCAT_BUG to the configure script 
> to check for a bug in libxml.  What file(s) do I have to change?
>
> The file attached is an example to test for this issue. (returns -1 if 
> the error exists)

The trouble is that because msxml3 links to a shared library, the 
library that the configure check is done against isn't necessarily the 
version that is used at runtime. (Think .debs for multiple distros and 
versions of those distros.)

Therefore, you may have to do the check at runtime. Where that check is 
implemented depends on what you need to do when you discover the buggy 
version is in use.

-- 
Rob Shearman



From rhysmcguckin at yahoo.com.au  Wed Apr 16 09:43:13 2008
From: rhysmcguckin at yahoo.com.au (Rhys McGuckin)
Date: Thu, 17 Apr 2008 00:43:13 +1000 (EST)
Subject: .NET 2.0 problematic DLL loading.
Message-ID: <701826.48135.qm@web90304.mail.mud.yahoo.com>

In reference to bug #11973, I've the following observation.

Using the native .NET 2.0 installed via winetricks, I located what is potentially a problem with the method that .NET is using to locate the DLLs that it wishes to load.

The problem seems to be that .NET is attempting to locate the various DLL's it is going to use, by searching various directory paths. Once this does not occur (by placing a native DLL into the windows/system32 path) it causing a crash further down. It doesn't seem to utilize the LoadLibrary initially to locate but another function (from memory I think it NtCreateFile). With the native DLL in place it starts to process properly, at least until it runs into other files not located (as stated above).

I believe that .NET 2.0 is assuming that the files are located within the directory path (this may be so that it can independently utilize application supplied DLL files - I read that WinXP supposedly uses this policy to reduce problems with DLL dependencies).
This of course, totally by-passes the built-in DLL files (which should be located using this method, except that they do not exist in the paths .NET searches).

There are two possible ways currently that I can think of, which would potentially solve this problem:
1. Have symbolic links within the system directory (I find this to be bad method, for multiple reasons)
2. Have some interception of the searching for files located within the system32, to include all of built-in dlls.

Unfortunately, since I don't know a huge amount about Wine yet, I have no idea on how to code the second one, and I think having a patch for this, may solve quite a few problems that currently exist with using .NET based programs.


       
---------------------------------
Get the name you always wanted with the new y7mail email address.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080417/03744c8e/attachment.htm 

From juan.lang at gmail.com  Wed Apr 16 09:44:13 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Wed, 16 Apr 2008 07:44:13 -0700
Subject: Strange waveOutGetDevCaps calls in winmm/tests/wave.c
In-Reply-To: <Pine.LNX.4.64.0804161351210.19758@maggie.lkpg.cendio.se>
References: <Pine.LNX.4.64.0804161351210.19758@maggie.lkpg.cendio.se>
Message-ID: <3a768c550804160744r285ab6a0j1a02b7892841e661@mail.gmail.com>

>  The CapsA test doesn't fail, probably since winmm wraps CapsA calls with
>  CapsW calls and then does memcpy. In either case, calling
>  waveOutGetDevCaps sith size=4 is not valid, as far as I can tell.
>  Theoretically, it might be in the future, though, if some small caps
>  structure is invented. I suggest that these tests are removed altogether:

Sounds reasonable to me; please send to wine-patches.
--Juan


From stefandoesinger at gmx.at  Wed Apr 16 10:17:15 2008
From: stefandoesinger at gmx.at (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Wed, 16 Apr 2008 17:17:15 +0200
Subject: .NET 2.0 problematic DLL loading.
In-Reply-To: <701826.48135.qm@web90304.mail.mud.yahoo.com>
References: <701826.48135.qm@web90304.mail.mud.yahoo.com>
Message-ID: <200804161717.16099.stefandoesinger@gmx.at>

Am Mittwoch, 16. April 2008 16:43:13 schrieb Rhys McGuckin:
> There are two possible ways currently that I can think of, which would
> potentially solve this problem: 1. Have symbolic links within the system
> directory (I find this to be bad method, for multiple reasons) 2. Have some
> interception of the searching for files located within the system32, to
> include all of built-in dlls.
Many applications behave that way, and we create fake .DLL files in system32. 
They are real PE files from their file header, but they do not contain the 
implementation. When an app tries to LoadLibrary this DLL we load the builtin 
one instead

So we just have to add the needed DLLs to the fake DLL list. We don't add one 
there without an application requiring it, because it makes it harder to 
install MS library packages. E.g. the IE6 installer fails unless the user 
deletes a bunch of those faked DLLs first


From Petr.Sumbera at Sun.COM  Wed Apr 16 10:41:27 2008
From: Petr.Sumbera at Sun.COM (Petr Sumbera)
Date: Wed, 16 Apr 2008 17:41:27 +0200
Subject: Trouble in compiling Wine 0.9.57 and 0.9.58 on Solaris 10 08/07
In-Reply-To: <200804132308.19873.stefan@codeweavers.com>
References: <47FF74FD.4060307@sun.com> <00a101c89da4$e7f77210$4001a8c0@NATERS>
	<200804132308.19873.stefan@codeweavers.com>
Message-ID: <48061E27.3070509@sun.com>

Stefan D?singer wrote:
> Am Sonntag, 13. April 2008 22:28:16 schrieb Rolf Kalbermatter:
>> Following link might give some details about Sun Solaris support of
>> infinintes
>> and also ideas how to solve that problem.
> Yes, that would work. Any build system guru who could implement that? I think 
> it is not a good idea to put that into wined3d

Well, we have only one isinf call in Wine so I think it isn't worst of 
creating Wine special isinf implementation. Instead I propose emulate 
isinf via finite() and isnand() (both coming from ieeefp.h).

Petr
-------------- next part --------------
A non-text attachment was scrubbed...
Name: isinf.diff
Type: text/x-patch
Size: 6091 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080416/ac058cec/attachment.bin 

From sh at sourcecode.de  Wed Apr 16 10:50:22 2008
From: sh at sourcecode.de (Stephan Hermann)
Date: Wed, 16 Apr 2008 17:50:22 +0200
Subject: Including Mono within a Wine package - should Wine expect this?
In-Reply-To: <480604B1.4090105@open-vote.org>
References: <a71bd89a0804100645y2b7f9c94n719ab5f19374db04@mail.gmail.com>
	<47FECF9E.1030309@open-vote.org> <48049192.4090906@arcticnet.no>
	<480604B1.4090105@open-vote.org>
Message-ID: <20080416175022.078a5b04@wz-pc-006.intern.netviewer.de>

On Wed, 16 Apr 2008 06:52:49 -0700
Scott Ritchie <scott at open-vote.org> wrote:

> Ove Kaaven wrote:
> > Debian's ia32-libs package isn't an example of a whole lot. It grabs
> > compiled binaries from the official Debian archive, and nowhere
> > else. It isn't built on a 32-bit system. If ia32-libs had contained
> > binaries that could not be built 100% automatically using Debian's
> > official archive (and only the official archive), it probably
> > wouldn't have gotten into Debian. Besides, ia32-libs is not meant
> > to be a long-lived package, it'll go away eventually.
> > 
> 
> We've been saying that for 3 years now, and we've only become MORE
> dependent on ia32-libs in the process.  The chief culprit, of course,
> is Wine, and Wine's need to run 32 bit applications isn't going away
> soon.
> 
> Really, what Debian (and Ubuntu) need is to replace the contents of
> the ia32-libs package with proper 32 versions of package (sorta like
> how lib32asound and lib32z1 are now).  Fixing that, however, is a bit
> beyond the scope of the wine-devel list ;)

The real problem with multi-arch libs is, that it's hard to maintain
inside debian packages at all...not that it's difficult to compile on
amd64 with -m32 , but regarding the different ways of debian/rules
writing with all different maintainer ways to write Makefiles for
accomplishing this tasks is the most difficult thing.

When there are people interested in going a hard way of fixing todays
situation in debian/ubuntu and other distris, please let's do it
, sane and with a plan.

Regards,
\sh
  


From bsjeon at hanmail.net  Wed Apr 16 01:55:25 2008
From: bsjeon at hanmail.net (ByeongSik Jeon)
Date: Wed, 16 Apr 2008 15:55:25 +0900
Subject: imm32: Implement the ImmSetConversionStatus.
Message-ID: <1208328925.2682.29.camel@localhost>

Tested with "MS IME 2002(imekr61.ime)", "MS IME
2003(imekr70.ime)", and "Saenaru(saenaru.ime, Korean Free IME)".

---
 dlls/imm32/imm.c |   29 ++++++++++++++++++++---------
 1 files changed, 20 insertions(+), 9 deletions(-)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 65e86a8886f5840a7dfb7600d5b2850832189abb.diff
Type: text/x-patch
Size: 1237 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080416/6ba47a50/attachment-0001.bin 

From ovek at arcticnet.no  Wed Apr 16 11:20:38 2008
From: ovek at arcticnet.no (Ove Kaaven)
Date: Wed, 16 Apr 2008 18:20:38 +0200
Subject: Including Mono within a Wine package - should Wine expect this?
In-Reply-To: <20080416175022.078a5b04@wz-pc-006.intern.netviewer.de>
References: <a71bd89a0804100645y2b7f9c94n719ab5f19374db04@mail.gmail.com>	<47FECF9E.1030309@open-vote.org>
	<48049192.4090906@arcticnet.no>	<480604B1.4090105@open-vote.org>
	<20080416175022.078a5b04@wz-pc-006.intern.netviewer.de>
Message-ID: <48062756.7070307@arcticnet.no>

Stephan Hermann skrev:
> When there are people interested in going a hard way of fixing todays
> situation in debian/ubuntu and other distris, please let's do it
> , sane and with a plan.

There's already work going on to try to get a better solution into 
Debian lenny. There's a new "ia32-libs-tools" package about to enter 
Debian unstable, which would make it possible to replace the big 
ia32-libs package with more fine-grained individual ia32-lib* packages. 
(It may not be true multiarch, but still a lot better than the current 
situation.)




From rhysmcguckin at yahoo.com.au  Wed Apr 16 11:31:35 2008
From: rhysmcguckin at yahoo.com.au (Rhys McGuckin)
Date: Thu, 17 Apr 2008 02:31:35 +1000 (EST)
Subject: .NET 2.0 problematic DLL loading.
In-Reply-To: <200804161717.16099.stefandoesinger@gmx.at>
Message-ID: <853444.79694.qm@web90301.mail.mud.yahoo.com>



Stefan D?singer <stefandoesinger at gmx.at> wrote:Many applications behave that way, and we create fake .DLL files in system32. 
They are real PE files from their file header, but they do not contain the 
implementation. When an app tries to LoadLibrary this DLL we load the builtin 
one instead

So we just have to add the needed DLLs to the fake DLL list. We don't add one 
there without an application requiring it, because it makes it harder to 
install MS library packages. E.g. the IE6 installer fails unless the user 
deletes a bunch of those faked DLLs first
The other problem was that it also failed attempting to find l_intl.nls. 
And is this list of fake DLLs application specific? 
Since I'm not sure what dlls all .NET 2.0 applications are going to try to search for, would we add all the DLLs that are central to windows?
The program that I am using that relies on .NET requires (imm32, lz32, iphlpapi, & l_intl.nls), before it runs into an unimplemented RAS function.



       
---------------------------------
Get the name you always wanted with the new y7mail email address.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080417/47c3d564/attachment.htm 

From truiken at gmail.com  Wed Apr 16 11:45:32 2008
From: truiken at gmail.com (James Hawkins)
Date: Wed, 16 Apr 2008 11:45:32 -0500
Subject: dlls/fusion/assembly.c -- no-op error checks
In-Reply-To: <alpine.LSU.1.10.0804161624400.6827@acrux.dbai.tuwien.ac.at>
References: <alpine.LSU.1.10.0804161624400.6827@acrux.dbai.tuwien.ac.at>
Message-ID: <22821af30804160945v2facb0efh61bcb5c81447efe3@mail.gmail.com>

On Wed, Apr 16, 2008 at 9:28 AM, Gerald Pfeifer <gerald at pfeifer.com> wrote:
> Both offset and tables[].offset are of unsigned types, so these two
>  checks for errors will never trigger.
>

The offsets are explicity set to -1 on line 242, so the check needs to
be for -1.  It won't work at all otherwise.

-- 
James Hawkins


From meissner at suse.de  Wed Apr 16 11:51:12 2008
From: meissner at suse.de (Marcus Meissner)
Date: Wed, 16 Apr 2008 18:51:12 +0200
Subject: fusion: Explicitly check for -1 for a missing table
In-Reply-To: <22821af30804160948u374eb9b6vb559827104802d3f@mail.gmail.com>
References: <22821af30804160948u374eb9b6vb559827104802d3f@mail.gmail.com>
Message-ID: <20080416165112.GA14495@suse.de>

On Wed, Apr 16, 2008 at 11:48:31AM -0500, James Hawkins wrote:
> Hi,
> 
> Changelog:
> * Explicitly check for -1 for a missing table.
> 
>  dlls/fusion/assembly.c |    4 ++--
>  1 files changed, 2 insertions(+), 2 deletions(-)
> 
> -- 
> James Hawkins

> diff --git a/dlls/fusion/assembly.c b/dlls/fusion/assembly.c
> index 024e611..eee889a 100644
> --- a/dlls/fusion/assembly.c
> +++ b/dlls/fusion/assembly.c
> @@ -416,7 +416,7 @@ HRESULT assembly_get_name(ASSEMBLY *assembly, LPSTR *name)
>      ULONG offset;
>  
>      offset = assembly->tables[0x20].offset; /* FIXME: add constants */
> -    if (offset < 0)
> +    if (offset == -1)
>          return E_FAIL;
>  
>      asmtbl = (ASSEMBLYTABLE *)assembly_data_offset(assembly, offset);
> @@ -527,7 +527,7 @@ HRESULT assembly_get_pubkey_token(ASSEMBLY *assembly, LPSTR *token)
>      *token = NULL;
>  
>      offset = assembly->tables[0x20].offset; /* FIXME: add constants */
> -    if (offset < 0)
> +    if (offset == -1)
>          return E_FAIL;

You should make offset "signed", or pass errors down in another way.
This will not work this way.

Ciao, Marcus


From truiken at gmail.com  Wed Apr 16 12:08:05 2008
From: truiken at gmail.com (James Hawkins)
Date: Wed, 16 Apr 2008 12:08:05 -0500
Subject: fusion: Explicitly check for -1 for a missing table
In-Reply-To: <20080416165112.GA14495@suse.de>
References: <22821af30804160948u374eb9b6vb559827104802d3f@mail.gmail.com>
	<20080416165112.GA14495@suse.de>
Message-ID: <22821af30804161008y2a4d93d3mf60fb88ed909503f@mail.gmail.com>

On Wed, Apr 16, 2008 at 11:51 AM, Marcus Meissner <meissner at suse.de> wrote:
>
> On Wed, Apr 16, 2008 at 11:48:31AM -0500, James Hawkins wrote:
>  > Hi,
>  >
>  > Changelog:
>  > * Explicitly check for -1 for a missing table.
>  >
>  >  dlls/fusion/assembly.c |    4 ++--
>  >  1 files changed, 2 insertions(+), 2 deletions(-)
>  >
>  > --
>  > James Hawkins
>
>  > diff --git a/dlls/fusion/assembly.c b/dlls/fusion/assembly.c
>  > index 024e611..eee889a 100644
>  > --- a/dlls/fusion/assembly.c
>  > +++ b/dlls/fusion/assembly.c
>  > @@ -416,7 +416,7 @@ HRESULT assembly_get_name(ASSEMBLY *assembly, LPSTR *name)
>  >      ULONG offset;
>  >
>  >      offset = assembly->tables[0x20].offset; /* FIXME: add constants */
>  > -    if (offset < 0)
>  > +    if (offset == -1)
>  >          return E_FAIL;
>  >
>  >      asmtbl = (ASSEMBLYTABLE *)assembly_data_offset(assembly, offset);
>  > @@ -527,7 +527,7 @@ HRESULT assembly_get_pubkey_token(ASSEMBLY *assembly, LPSTR *token)
>  >      *token = NULL;
>  >
>  >      offset = assembly->tables[0x20].offset; /* FIXME: add constants */
>  > -    if (offset < 0)
>  > +    if (offset == -1)
>  >          return E_FAIL;
>
>  You should make offset "signed", or pass errors down in another way.
>  This will not work this way.
>

It works just fine.  -1 is 4294967295 in ULONG (32bit), which is
exactly the same as offset on error (because we assigned it -1, but
the representation in memory is the same).  We do this several other
places in the code base.

-- 
James Hawkins


From truiken at gmail.com  Wed Apr 16 12:51:39 2008
From: truiken at gmail.com (James Hawkins)
Date: Wed, 16 Apr 2008 12:51:39 -0500
Subject: dlls/fusion/assembly.c -- no-op error checks
In-Reply-To: <alpine.LSU.1.10.0804161945300.6827@acrux.dbai.tuwien.ac.at>
References: <alpine.LSU.1.10.0804161624400.6827@acrux.dbai.tuwien.ac.at>
	<22821af30804160945v2facb0efh61bcb5c81447efe3@mail.gmail.com>
	<alpine.LSU.1.10.0804161945300.6827@acrux.dbai.tuwien.ac.at>
Message-ID: <22821af30804161051t5c731357ne65d475c44ef5736@mail.gmail.com>

On Wed, Apr 16, 2008 at 12:47 PM, Gerald Pfeifer <gerald at pfeifer.com> wrote:
> On Wed, 16 Apr 2008, James Hawkins wrote:
>  > The offsets are explicity set to -1 on line 242, so the check needs to
>  > be for -1.  It won't work at all otherwise.
>
>  Thanks, James!  I was looking for this, but must have missed it somehow.
>  I'm glad I Cc:d you. :-)
>
>  Please find the real fix below.
>

Beat ya to the punch :)

http://winehq.org/pipermail/wine-patches/2008-April/053446.html

-- 
James Hawkins


From rob at codeweavers.com  Wed Apr 16 13:09:10 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Wed, 16 Apr 2008 19:09:10 +0100
Subject: fusion: Explicitly check for -1 for a missing table
In-Reply-To: <22821af30804161008y2a4d93d3mf60fb88ed909503f@mail.gmail.com>
References: <22821af30804160948u374eb9b6vb559827104802d3f@mail.gmail.com>	<20080416165112.GA14495@suse.de>
	<22821af30804161008y2a4d93d3mf60fb88ed909503f@mail.gmail.com>
Message-ID: <480640C6.9080604@codeweavers.com>

James Hawkins wrote:
> It works just fine.  -1 is 4294967295 in ULONG (32bit), which is
> exactly the same as offset on error (because we assigned it -1, but
> the representation in memory is the same).

Then use ~0 so that the purpose is clearer. Adding a define for this 
value would probably further increase readability of the code.

> We do this several other
> places in the code base.

They should be changed too.

-- 
Rob Shearman



From gerald at pfeifer.com  Wed Apr 16 12:59:50 2008
From: gerald at pfeifer.com (Gerald Pfeifer)
Date: Wed, 16 Apr 2008 19:59:50 +0200 (CEST)
Subject: dlls/fusion/assembly.c -- no-op error checks
In-Reply-To: <22821af30804161051t5c731357ne65d475c44ef5736@mail.gmail.com>
References: <alpine.LSU.1.10.0804161624400.6827@acrux.dbai.tuwien.ac.at>
	<22821af30804160945v2facb0efh61bcb5c81447efe3@mail.gmail.com>
	<alpine.LSU.1.10.0804161945300.6827@acrux.dbai.tuwien.ac.at>
	<22821af30804161051t5c731357ne65d475c44ef5736@mail.gmail.com>
Message-ID: <alpine.LSU.1.10.0804161959180.6827@acrux.dbai.tuwien.ac.at>

On Wed, 16 Apr 2008, James Hawkins wrote:
> Beat ya to the punch :)

Better twice than not at all, to paraphrase a German saying. :-)

Gerald


From leslie_alistair at hotmail.com  Wed Apr 16 15:30:38 2008
From: leslie_alistair at hotmail.com (Alistair Leslie-Hughes)
Date: Thu, 17 Apr 2008 06:30:38 +1000
Subject: msxml3: Implement transformNode (try 3)
References: <ftvcka$qrg$1@ger.gmane.org>
Message-ID: <fu5nn3$3vc$1@ger.gmane.org>

"Alistair Leslie-Hughes" <leslie_alistair at hotmail.com> wrote in message 
news:ftvcka$qrg$1 at ger.gmane.org...
> Hi,
> Corrected issue with tests
>
> Changelog:
> msxml3: Implement transformNode
>
> Best Regards
>  Alistair Leslie-Hughes
>
Anything wrong with this patch?

Best Regards
 Alistair Leslie-Hughes 




From khodych at gmail.com  Wed Apr 16 16:47:05 2008
From: khodych at gmail.com (Sergey Khodych)
Date: Thu, 17 Apr 2008 00:47:05 +0300
Subject: dinput: Implement DIPROP_KEYNAME property for keyboard device
In-Reply-To: <48058D65.5000007@kievinfo.com>
References: <48023854.9020308@gmail.com>	<48024DC2.3020008@kievinfo.com>	<4803AB6A.3040900@gmail.com>	<48040DA6.6090708@kievinfo.com>	<48052550.4070504@gmail.com>
	<48058D65.5000007@kievinfo.com>
Message-ID: <480673D9.40609@gmail.com>

> No, there are 2 separate implementations - one ascii another unicode. During 
> the object creation one would specify either ascii or unicode RIID.

Objects IDirectInputDevice8W and IDirectInputDevice8A has function
GetProperty. This function get struct of type DIPROPSTRING as
input/output parameter in our case . This struct has output field wsz of
type WCHAR[ MAX_PATH ] and other input fields not depends of charset.
So type of returned data will be WCHAR[ MAX_PATH ] in both case.
So objects IDirectInputDevice8W and IDirectInputDevice8A has the same
implementation of function GetProperty and this implementation is for
Unicode in both case.




From wine-devel at kievinfo.com  Wed Apr 16 21:22:02 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Wed, 16 Apr 2008 20:22:02 -0600
Subject: dinput/tests: Add test to show dinput does not use user defined
	data   format for keyboard.
In-Reply-To: <48067251.5070202@gmail.com>
References: <48067251.5070202@gmail.com>
Message-ID: <4806B44A.8070708@kievinfo.com>

Sergey Khodych wrote:
> 
> +    hr = IDirectInputDevice_GetDeviceState(pKeyboard, sizeof(custom_state), custom_state);
> +    ok(SUCCEEDED(hr), "IDirectInputDevice_GetDeviceState(4,) failed: %s\n", DXGetErrorString8(hr));
> +    hr = IDirectInputDevice_GetDeviceState(pKeyboard, sizeof(kbd_state), kbd_state);
> +    ok(hr == DIERR_INVALIDPARAM, "IDirectInputDevice_GetDeviceState(256,) should have failed: %s\n", DXGetErrorString8(hr));

When you add tests that fail on Wine, you need to add todo_wine at front of 
them so "make test" will still succeed.

Vitaliy.


From wine-devel at kievinfo.com  Wed Apr 16 21:31:45 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Wed, 16 Apr 2008 20:31:45 -0600
Subject: dinput: Implement DIPROP_KEYNAME property for keyboard device
In-Reply-To: <480673D9.40609@gmail.com>
References: <48023854.9020308@gmail.com>	<48024DC2.3020008@kievinfo.com>	<4803AB6A.3040900@gmail.com>	<48040DA6.6090708@kievinfo.com>	<48052550.4070504@gmail.com>	<48058D65.5000007@kievinfo.com>
	<480673D9.40609@gmail.com>
Message-ID: <4806B691.3080205@kievinfo.com>

Sergey Khodych wrote:
>> No, there are 2 separate implementations - one ascii another unicode. During 
>> the object creation one would specify either ascii or unicode RIID.
> 
> Objects IDirectInputDevice8W and IDirectInputDevice8A has function
> GetProperty. This function get struct of type DIPROPSTRING as
> input/output parameter in our case . This struct has output field wsz of
> type WCHAR[ MAX_PATH ] and other input fields not depends of charset.
> So type of returned data will be WCHAR[ MAX_PATH ] in both case.
> So objects IDirectInputDevice8W and IDirectInputDevice8A has the same
> implementation of function GetProperty and this implementation is for
> Unicode in both case.
> 
> 
I'd like to see a test for this. So far I have not seen a case when ascii 
and unicode COM objects return the same exact unicode structure with unicode 
text. And we also seen number of cases when even SDK was wrong. Not even 
talking about MSDN.

Vitaliy


From eric.pouech at gmail.com  Thu Apr 17 00:54:40 2008
From: eric.pouech at gmail.com (Eric Pouech)
Date: Thu, 17 Apr 2008 07:54:40 +0200
Subject: [PATCH] [WinHelp]: fix regression introduced by Dmitry's Win64
	warning fixes
In-Reply-To: <87wsmykm52.fsf@wine.dyndns.org>
References: <20080414185700.22586.58253.stgit@localhost>
	<87wsmykm52.fsf@wine.dyndns.org>
Message-ID: <2611daec0804162254k2de2780dqdb54565165380548@mail.gmail.com>

>
>
> This won't work on 64-bit. If the hash really needs to be signed (why?)
> you need some extra casts.


signed comparison is needed below for finding the key in the btree
currently, most of the navigation in hlp files is broken because of this
patch
A+


> --
> Alexandre Julliard
> julliard at winehq.org
>
>
>


-- 
-- 
Eric Pouech
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080417/6dd16e54/attachment.htm 

From hintak_leung at yahoo.co.uk  Wed Apr 16 15:47:41 2008
From: hintak_leung at yahoo.co.uk (Hin-Tak Leung)
Date: Wed, 16 Apr 2008 20:47:41 +0000 (GMT)
Subject: hhctrl.ocx: Parse HTML entities in the table of contents.
In-Reply-To: <1208330212.19262.7.camel@tefdemo>
Message-ID: <460698.19166.qm@web23111.mail.ird.yahoo.com>


--- On Wed, 16/4/08, Tomasz Jezierski - Tefnet <developers at tefnet.pl> wrote:

<snipped>
> If you won't find entity in table and change ampersand
> to another char,
> you won't get infinite loop, but I'm not sure what
> will happen if you
> have &amp; in help, that might trigger loop too. Do you
> know any free
> software in which I can craft such chm files?

I don't know about "free", but the microsoft htmlhelp workshop is available 
for download... and you might be able to do something like that with it.

It is also a good source of information, BTW. Comes with an htmlhelp API reference. (I installed it under wine last week).

BTW, I keep forgetting - what is the policy about contributing code after
reading MSDN and official microsoft documentation available for download such as this? 

I think MSDN is okay, butactual source files (including include headers)
is not?


      ___________________________________________________________ 
Yahoo! For Good helps you make a difference  

http://uk.promotions.yahoo.com/forgood/


From julliard at winehq.org  Thu Apr 17 05:02:01 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 17 Apr 2008 12:02:01 +0200
Subject: [1/3] [try 2] setupapi: Add a test for
	SetupDiGetDeviceRegistryProperty and SetupDiSetDeviceRegistryProperty
In-Reply-To: <200804151203.08793.amorozov@etersoft.ru> (Alexander Morozov's
	message of "Tue, 15 Apr 2008 12:03:08 +0400")
References: <200804151203.08793.amorozov@etersoft.ru>
Message-ID: <87abjslrza.fsf@wine.dyndns.org>

Alexander Morozov <amorozov at etersoft.ru> writes:

> Changelog:
> Add a test for SetupDiGetDeviceRegistryProperty and 
> SetupDiSetDeviceRegistryProperty

This doesn't apply because there have been other changes in that area,
when resending a patch you need to first resync to the current tree.

-- 
Alexandre Julliard
julliard at winehq.org


From dank at kegel.com  Thu Apr 17 10:20:15 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 17 Apr 2008 08:20:15 -0700
Subject: Towards pure wine: a step by step approach
Message-ID: <a71bd89a0804170820j22f4a449h5ad00373b8b5e269@mail.gmail.com>

Errors reported by valgrind, coverity, and our conformance test suite
are all worth fixing... but fixing them *all* is like shovelling out
the dung from an infinitely large barn.  Various people have tried
fixing one kind of error or the other, but maybe a combined attack,
where we went module by module and fixed *all* of the valgrind,
coverity, and conformance test errors might be more fruitful
(or at least more satisfying).   Such an attempt should probably
start at the bottom, cleaning up modules in the order
  wineserver, ntdll, kernel32, gdi32, user32, ...

To that end, here are the combined known errors for the first few modules.

wineserver:

coverity:
cv219        FORWARD_NULL    UNINSPECTED      set_console_input_info
base/src/wine/server/console.c
cv220        FORWARD_NULL    UNINSPECTED
connect_process_winstation      base/src/wine/server/winstation.c

ntdll:

coverity:
cv48    FORWARD_NULL    UNINSPECTED      RtlAllocateHandle
base/src/wine/dlls/ntdll/handletable.c
cv55    FORWARD_NULL    UNINSPECTED        RtlCreateEnvironment
base/src/wine/dlls/ntdll/env.c
cv227   NEGATIVE_RETURNS        UNINSPECTED       read_changes_apc
   base/src/wine/dlls/ntdll/directory.c
cv248   NULL_RETURNS    UNINSPECTED       HEAP_FindFreeBlock
base/src/wine/dlls/ntdll/heap.c
cv343   REVERSE_INULL   UNINSPECTED       NtOpenSection
base/src/wine/dlls/ntdll/virtual.c
cv538   NULL_RETURNS    UNINSPECTED        HEApNtEnumerateSubKey
base/src/wine/dlls/ntdll/reg.c
cv644   REVERSE_INULL   UNINSPECTED       NtQueryInformationProcess
   base/src/wine/dlls/ntdll/process.c
cv658   FORWARD_NULL RNS        UNINSPECTED     RtlQueryRegistryValues
 base/src/wine/dlls/ntdll/reg.cdlls/ole32/ole2.c

valgrind:

http://kegel.com/wine/valgrind/logs-2008-04-10/vg-ntdll_env.txt
http://kegel.com/wine/valgrind/logs-2008-04-10/vg-ntdll_exception.txt
http://kegel.com/wine/valgrind/logs-2008-04-10/vg-ntdll_file.txt

conformance tests:
http://test.winehq.org/data/200804161000/#group_Wine:ntdll:change
http://test.winehq.org/data/200804161000/#group_XP:ntdll:exception

There, that doesn't look too awful, does it?  Only a few dozen little
problems to solve
and we'll have server and ntdll spic and span... and then on to the next module.

If we start with a small circle of pure modules, and vigorously defend
the modules
in that circle against regressions in any of valgrind, coverity, and
conformance tests,
we might make a noticable improvement in Wine's quality.
- Dan


From stephencooper96 at hotmail.com  Thu Apr 17 08:46:10 2008
From: stephencooper96 at hotmail.com (stephen cooper)
Date: Thu, 17 Apr 2008 13:46:10 +0000
Subject: installing wine into linux ubuntu
Message-ID: <BAY114-W5346A2814598953C9CA3EDB5E50@phx.gbl>


 ref. Linux Format DVD 104 April 2008From: stephen cooper (stephencooper96 at hotmail.com) 
I am new to Linux.I have just installed Linux UBUNTU 7.1 (gutsy) onto my computer with no problems. I want to install wine.I have written the source code onto my hard disc. (using tar ) When I run ./configure (.tools/wineinstall) I get an error -  C compiler cannot create executables. I am including the output from the config.log for wine installation below.  PLEASE ADVISE ME. Stephen Cooper.
This file contains any messages produced by compilers whilerunning configure, to aid debugging if configure makes a mistake.
It was created by Wine configure 0.9.54, which wasgenerated by GNU Autoconf 2.61.  Invocation command line was
  $ ./configure --verbose
## --------- #### Platform. #### --------- ##
hostname = stephen-desktopuname -m = i686uname -r = 2.6.22-14-genericuname -s = Linuxuname -v = #1 SMP Sun Oct 14 23:05:12 GMT 2007
/usr/bin/uname -p = unknown/bin/uname -X     = unknown
/bin/arch              = unknown/usr/bin/arch -k       = unknown/usr/convex/getsysinfo = unknown/usr/bin/hostinfo      = unknown/bin/machine           = unknown/usr/bin/oslevel       = unknown/bin/universe          = unknown
PATH: /usr/local/sbinPATH: /usr/local/binPATH: /usr/sbinPATH: /usr/binPATH: /sbinPATH: /binPATH: /usr/games
## ----------- #### Core tests. #### ----------- ##
configure:2100: checking build system typeconfigure:2118: result: i686-pc-linux-gnulibc1configure:2140: checking host system typeconfigure:2155: result: i686-pc-linux-gnulibc1configure:2221: checking whether make sets $(MAKE)configure:2242: result: yesconfigure:2299: checking for gccconfigure:2315: found /usr/bin/gccconfigure:2326: result: gccconfigure:2564: checking for C compiler versionconfigure:2571: gcc --version >&5gcc (GCC) 4.1.3 20070929 (prerelease) (Ubuntu 4.1.2-16ubuntu2)Copyright (C) 2006 Free Software Foundation, Inc.This is free software; see the source for copying conditions.  There is NOwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
configure:2574: $? = 0configure:2581: gcc -v >&5Using built-in specs.Target: i486-linux-gnuConfigured with: ../src/configure -v --enable-languages=c,c++,fortran,objc,obj-c++,treelang --prefix=/usr --enable-shared --with-system-zlib --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --enable-nls --with-gxx-include-dir=/usr/include/c++/4.1.3 --program-suffix=-4.1 --enable-__cxa_atexit --enable-clocale=gnu --enable-libstdcxx-debug --enable-mpfr --enable-checking=release i486-linux-gnuThread model: posixgcc version 4.1.3 20070929 (prerelease) (Ubuntu 4.1.2-16ubuntu2)configure:2584: $? = 0configure:2591: gcc -V >&5gcc: '-V' option must have argumentconfigure:2594: $? = 1configure:2617: checking for C compiler default output file nameconfigure:2644: gcc    conftest.c  >&5/usr/bin/ld: crt1.o: No such file: No such file or directorycollect2: ld returned 1 exit statusconfigure:2647: $? = 1configure:2685: result: configure: failed program was:| /* confdefs.h.  */| #define PACKAGE_NAME "Wine"| #define PACKAGE_TARNAME "wine"| #define PACKAGE_VERSION "0.9.54"| #define PACKAGE_STRING "Wine 0.9.54"| #define PACKAGE_BUGREPORT "wine-devel at winehq.org"| /* end confdefs.h.  */| | int| main ()| {| |   ;|   return 0;| }configure:2692: error: C compiler cannot create executablesSee `config.log' for more details.
## ---------------- #### Cache variables. #### ---------------- ##
ac_cv_build=i686-pc-linux-gnulibc1ac_cv_env_CCC_set=ac_cv_env_CCC_value=ac_cv_env_CC_set=ac_cv_env_CC_value=ac_cv_env_CFLAGS_set=ac_cv_env_CFLAGS_value=ac_cv_env_CPPFLAGS_set=ac_cv_env_CPPFLAGS_value=ac_cv_env_CPP_set=ac_cv_env_CPP_value=ac_cv_env_CXXFLAGS_set=ac_cv_env_CXXFLAGS_value=ac_cv_env_CXX_set=ac_cv_env_CXX_value=ac_cv_env_LDFLAGS_set=ac_cv_env_LDFLAGS_value=ac_cv_env_LIBS_set=ac_cv_env_LIBS_value=ac_cv_env_XMKMF_set=ac_cv_env_XMKMF_value=ac_cv_env_build_alias_set=ac_cv_env_build_alias_value=ac_cv_env_host_alias_set=ac_cv_env_host_alias_value=ac_cv_env_target_alias_set=ac_cv_env_target_alias_value=ac_cv_host=i686-pc-linux-gnulibc1ac_cv_prog_ac_ct_CC=gccac_cv_prog_make_make_set=yes
## ----------------- #### Output variables. #### ----------------- ##
ALSALIBS=''AR=''AS=''AUDIOIOLIBS=''BISON=''BUILTINFLAG=''CARBONLIB=''CC='gcc'CFLAGS=''COREAUDIO=''COREFOUNDATIONLIB=''CPP=''CPPBIN=''CPPFLAGS=''CROSSCC=''CROSSTEST=''CROSSWINDRES=''CRTLIBS=''CXX=''CXXFLAGS=''DEFS=''DEPENDENCIES=''DISKARBITRATIONLIB=''DLLEXT=''DLLFLAGS=''DLLTOOL=''DLLWRAP=''ECHO_C=''ECHO_N='-n'ECHO_T=''EGREP=''ESDCONFIG=''ESDINCL=''ESDLIBS=''EXEEXT=''EXTRACFLAGS=''EXTRA_BINARIES=''FLEX=''FONTCONFIGINCL=''FONTFORGE=''FONTSSUBDIRS=''FREETYPEINCL=''FREETYPELIBS=''GLU32FILES=''GPHOTO2INCL=''GPHOTO2LIBS=''GREP=''HALINCL=''IMPLIBEXT=''INSTALL_DATA=''INSTALL_PROGRAM=''INSTALL_SCRIPT=''IOKITLIB=''LCMSLIBS=''LD=''LDAPLIBS=''LDCONFIG=''LDD=''LDDLLFLAGS=''LDEXECFLAGS=''LDFLAGS=''LDPATH=''LDRPATH_INSTALL=''LDRPATH_LOCAL=''LDSHARED=''LIBDL=''LIBEXT=''LIBOBJS=''LIBPOLL=''LIBPTHREAD=''LIBS=''LINT=''LINTFLAGS=''LN=''LN_S=''LTLIBOBJS=''MAIN_BINARY=''MINGWAR=''NASLIBS=''OBJEXT=''OPENGLFILES=''OPENGL_LIBS=''PACKAGE_BUGREPORT='wine-devel at winehq.org'PACKAGE_NAME='Wine'PACKAGE_STRING='Wine 0.9.54'PACKAGE_TARNAME='wine'PACKAGE_VERSION='0.9.54'PATH_SEPARATOR=':'PKG_CONFIG=''PRELINK=''QUARTZFILES=''RANLIB=''RESOLVLIBS=''SANEINCL=''SECURITYLIB=''SET_MAKE=''SHELL='/bin/bash'SOCKETLIBS=''STRIP=''TOOLSDIR=''WIN16_FILES='$(WIN16_FILES)'WIN16_INSTALL='$(WIN16_INSTALL)'WINDRES=''XFILES=''XLIB=''XMKMF=''XML2INCL=''XML2LIBS=''XSLTINCL=''XSLTLIBS=''X_CFLAGS=''X_EXTRA_LIBS=''X_LIBS=''X_PRE_LIBS=''ac_ct_AS=''ac_ct_CC='gcc'ac_ct_CXX=''bindir='${exec_prefix}/bin'build='i686-pc-linux-gnulibc1'build_alias=''build_cpu='i686'build_os='linux-gnulibc1'build_vendor='pc'datadir='${datarootdir}'datarootdir='${prefix}/share'docdir='${datarootdir}/doc/${PACKAGE_TARNAME}'dvidir='${docdir}'exec_prefix='NONE'ft_devel=''gphoto2_devel=''gphoto2port_devel=''host='i686-pc-linux-gnulibc1'host_alias=''host_cpu='i686'host_os='linux-gnulibc1'host_vendor='pc'htmldir='${docdir}'includedir='${prefix}/include'infodir='${datarootdir}/info'libdir='${exec_prefix}/lib'libexecdir='${exec_prefix}/libexec'localedir='${datarootdir}/locale'localstatedir='${prefix}/var'mandir='${datarootdir}/man'oldincludedir='/usr/include'pdfdir='${docdir}'prefix='NONE'program_transform_name='s,x,x,'psdir='${docdir}'sane_devel=''sbindir='${exec_prefix}/sbin'sharedstatedir='${prefix}/com'sysconfdir='${prefix}/etc'target_alias=''
## ------------------- #### File substitutions. #### ------------------- ##
MAKE_DLL_RULES=''MAKE_IMPLIB_RULES=''MAKE_PROG_RULES=''MAKE_RULES=''MAKE_TEST_RULES=''
## ----------- #### confdefs.h. #### ----------- ##
#define PACKAGE_NAME "Wine"#define PACKAGE_TARNAME "wine"#define PACKAGE_VERSION "0.9.54"#define PACKAGE_STRING "Wine 0.9.54"#define PACKAGE_BUGREPORT "wine-devel at winehq.org"
configure: exit 77
_________________________________________________________________
Get Hotmail on your mobile. Text MSN to 63463 now!
http://mobile.uk.msn.com/pc/mail.aspx
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080417/a9ee95b8/attachment.htm 

From a_villacis at palosanto.com  Thu Apr 17 11:38:23 2008
From: a_villacis at palosanto.com (=?ISO-8859-2?Q?Alex_Villac=ED=ADs_Lasso?=)
Date: Thu, 17 Apr 2008 11:38:23 -0500
Subject: installing wine into linux ubuntu
In-Reply-To: <BAY114-W5346A2814598953C9CA3EDB5E50@phx.gbl>
References: <BAY114-W5346A2814598953C9CA3EDB5E50@phx.gbl>
Message-ID: <48077CFF.4040906@palosanto.com>

stephen cooper escribi?:
>  ref. Linux Format DVD 104 April 2008From: stephen cooper (stephencooper96 at hotmail.com) 
> I am new to Linux.I have just installed Linux UBUNTU 7.1 (gutsy) onto my computer with no problems. I want to install wine.I have written the source code onto my hard disc. (using tar ) When I run ./configure (.tools/wineinstall) I get an error -  C compiler cannot create executables. I am including the output from the config.log for wine installation below.  PLEASE ADVISE ME. Stephen Cooper.
> This file contains any messages produced by compilers whilerunning configure, to aid debugging if configure makes a mistake.
> It was created by Wine configure 0.9.54, which wasgenerated by GNU Autoconf 2.61.  Invocation command line was
>   
It's good you are trying to build Wine. However, you need to install the 
appropriate development packages for Ubuntu first. Plain Ubuntu as 
installed from disks does not ship with enough tools to build any 
program in C. Also, most recent wine version as of this writing is 
0.9.59, so you are already a few versions behind.

You might want to try suscribing to the wine-users mailing list first. 
That mailing list is more appropriate for people who are starting with 
Wine and Linux than wine-devel.

-- 
perl -e '$x=2.4;print sprintf("%.0f + %.0f = %.0f\n",$x,$x,$x+$x);'



From m.b.lankhorst at gmail.com  Thu Apr 17 11:56:44 2008
From: m.b.lankhorst at gmail.com (Maarten Lankhorst)
Date: Thu, 17 Apr 2008 09:56:44 -0700
Subject: msxml3: Implement transformNode (try 3)
In-Reply-To: <fu5nn3$3vc$1@ger.gmane.org>
References: <ftvcka$qrg$1@ger.gmane.org> <fu5nn3$3vc$1@ger.gmane.org>
Message-ID: <b130c85e0804170956r8338396u43887738b48bef81@mail.gmail.com>

Hello Alistair,

2008/4/16, Alistair Leslie-Hughes <leslie_alistair at hotmail.com>:
> "Alistair Leslie-Hughes" <leslie_alistair at hotmail.com> wrote in message
>  news:ftvcka$qrg$1 at ger.gmane.org...
>  > Hi,
>  > Corrected issue with tests
>  >
>  > Changelog:
>  > msxml3: Implement transformNode
>  >
>  > Best Regards
>  >  Alistair Leslie-Hughes
>  >
>  Anything wrong with this patch?
Yes, it breaks building on dapper. I get an undefined reference to
xsltInit in main.c

Cheers,
Maarten.


From thestig at google.com  Thu Apr 17 12:24:10 2008
From: thestig at google.com (Lei Zhang)
Date: Thu, 17 Apr 2008 10:24:10 -0700
Subject: installing wine into linux ubuntu
In-Reply-To: <BAY114-W5346A2814598953C9CA3EDB5E50@phx.gbl>
References: <BAY114-W5346A2814598953C9CA3EDB5E50@phx.gbl>
Message-ID: <558b2f5c0804171024g7c7b2d44o2bd66d79a688f1d6@mail.gmail.com>

On Thu, Apr 17, 2008 at 6:46 AM, stephen cooper
<stephencooper96 at hotmail.com> wrote:
>
>   ref. Linux Format DVD 104 April 2008
> From: stephen cooper (stephencooper96 at hotmail.com)
>  I am new to Linux.
> I have just installed Linux UBUNTU 7.1 (gutsy) onto my computer with no
> problems.
>
> I want to install wine.
> I have written the source code onto my hard disc. (using tar )
> When I run ./configure (.tools/wineinstall) I get an error -  C compiler
> cannot create executables.
> I am including the output from the config.log for wine installation below.
>
> PLEASE ADVISE ME.

Take a look at http://wiki.winehq.org/Recommended_Packages for the
list of packages needed to build Wine. If you just want to use Wine,
there's packages available for Ubuntu:
http://www.winehq.org/site/download


From dank at kegel.com  Thu Apr 17 12:28:03 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 17 Apr 2008 10:28:03 -0700
Subject: New winetricks 20080417: new verb wmp9
Message-ID: <a71bd89a0804171028w239249b5p61026d38bf60f9b2@mail.gmail.com>

Another day, another Winetricks.  Changes:

r34  	Add Windows Media Player 9 (not really usable yet; this is for
the guys implementing Quartz etc.)

r33 	Fixed typo that disabled curl.

As always, get it at
http://kegel.com/wine/winetricks
or
http://code.google.com/p/winezeug

- Dan


From julliard at winehq.org  Thu Apr 17 12:39:36 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 17 Apr 2008 19:39:36 +0200
Subject: Trouble in compiling Wine 0.9.57 and 0.9.58 on Solaris 10 08/07
In-Reply-To: <48061E27.3070509@sun.com> (Petr Sumbera's message of "Wed, 16
	Apr 2008 17:41:27 +0200")
References: <47FF74FD.4060307@sun.com> <00a101c89da4$e7f77210$4001a8c0@NATERS>
	<200804132308.19873.stefan@codeweavers.com>
	<48061E27.3070509@sun.com>
Message-ID: <871w54l6sn.fsf@wine.dyndns.org>

Petr Sumbera <Petr.Sumbera at Sun.COM> writes:

> Well, we have only one isinf call in Wine so I think it isn't worst of
> creating Wine special isinf implementation. Instead I propose emulate
> isinf via finite() and isnand() (both coming from ieeefp.h).

You should still put that in libwine_port, it keeps the #ifdef ugliness
out of the code.

-- 
Alexandre Julliard
julliard at winehq.org


From susancragin at earthlink.net  Thu Apr 17 12:41:04 2008
From: susancragin at earthlink.net (Susan Cragin)
Date: Thu, 17 Apr 2008 13:41:04 -0400 (GMT-04:00)
Subject: installing wine into linux ubuntu
Message-ID: <4908366.1208454064493.JavaMail.root@elwamui-norfolk.atl.sa.earthlink.net>

Another way to do it, is run the following commands in a terminal before beginning:

sudo apt-get build-dep wine wine-dev
sudo apt-get install msttcorefonts fontforge


You need a lot of things, ideally. This gets you all of them. Some places say you can get by with bison and flex and the C compiler. I don't think that's really true. 


-----Original Message-----
>From: Lei Zhang <thestig at google.com>
>Sent: Apr 17, 2008 1:24 PM
>To: stephen cooper <stephencooper96 at hotmail.com>
>Cc: wine-devel at winehq.org
>Subject: Re: installing wine into linux ubuntu
>
>On Thu, Apr 17, 2008 at 6:46 AM, stephen cooper
><stephencooper96 at hotmail.com> wrote:
>>
>>   ref. Linux Format DVD 104 April 2008
>> From: stephen cooper (stephencooper96 at hotmail.com)
>>  I am new to Linux.
>> I have just installed Linux UBUNTU 7.1 (gutsy) onto my computer with no
>> problems.
>>
>> I want to install wine.
>> I have written the source code onto my hard disc. (using tar )
>> When I run ./configure (.tools/wineinstall) I get an error -  C compiler
>> cannot create executables.
>> I am including the output from the config.log for wine installation below.
>>
>> PLEASE ADVISE ME.
>
>Take a look at http://wiki.winehq.org/Recommended_Packages for the
>list of packages needed to build Wine. If you just want to use Wine,
>there's packages available for Ubuntu:
>http://www.winehq.org/site/download
>
>





From julliard at winehq.org  Thu Apr 17 13:21:04 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 17 Apr 2008 20:21:04 +0200
Subject: shell32: Allow ShellExecute to accept file extensions for lpClass.
In-Reply-To: <20080417173926.8139B3DB0E3@localhost> (Michael Moss's message of
	"Thu, 17 Apr 2008 10:33:37 -0700")
References: <20080417173926.8139B3DB0E3@localhost>
Message-ID: <87wsmwjqb3.fsf@wine.dyndns.org>

Michael Moss <mmoss at google.com> writes:

> [originally a Picasa patch by Aric Stewart]

In general if these patches have not been merged there was a good
reason. The first step would be to write test cases for them.

-- 
Alexandre Julliard
julliard at winehq.org


From hans at it.vu.nl  Thu Apr 17 14:26:30 2008
From: hans at it.vu.nl (Hans Leidekker)
Date: Thu, 17 Apr 2008 21:26:30 +0200
Subject: wininet: correct the case where Content-Length is set as well as
	Transer-Encoding = chunked
In-Reply-To: <48079175.3010107@codeweavers.com>
References: <48079175.3010107@codeweavers.com>
Message-ID: <200804172126.30625.hans@it.vu.nl>

On Thursday 17 April 2008 20:05:41 Aric Stewart wrote:

> +            /* Correct the case where both a Content-Length and Transfer-encoding = chuncked are set */
> +
> +            dwBufferSize = sizeof(encoding);
> +            if (HTTP_HttpQueryInfoW(lpwhr, HTTP_QUERY_TRANSFER_ENCODING, encoding, &dwBufferSize, NULL) &&
> +                !strcmpiW(encoding, szChunked))
> +            {
> +                lpwhr->dwContentLength = -1;
> +            }

I think the right thing to do is to strip the Transfer-Encoding
header from the request because we don't support chunked transfers
in the sending direction. Would that work for you?

 -Hans


From aric at codeweavers.com  Thu Apr 17 14:28:57 2008
From: aric at codeweavers.com (Aric Stewart)
Date: Thu, 17 Apr 2008 14:28:57 -0500
Subject: wininet: correct the case where Content-Length is set as well
	as Transer-Encoding = chunked
In-Reply-To: <200804172126.30625.hans@it.vu.nl>
References: <48079175.3010107@codeweavers.com>
	<200804172126.30625.hans@it.vu.nl>
Message-ID: <4807A4F9.2020208@codeweavers.com>

This patch is for the receiving direction, unless I misread the code.

The issue is that after a sent request the response is coming back with 
both Transfer-Encoding=chunked and a Content-Length.

-aric

Hans Leidekker wrote:
> On Thursday 17 April 2008 20:05:41 Aric Stewart wrote:
> 
>> +            /* Correct the case where both a Content-Length and Transfer-encoding = chuncked are set */
>> +
>> +            dwBufferSize = sizeof(encoding);
>> +            if (HTTP_HttpQueryInfoW(lpwhr, HTTP_QUERY_TRANSFER_ENCODING, encoding, &dwBufferSize, NULL) &&
>> +                !strcmpiW(encoding, szChunked))
>> +            {
>> +                lpwhr->dwContentLength = -1;
>> +            }
> 
> I think the right thing to do is to strip the Transfer-Encoding
> header from the request because we don't support chunked transfers
> in the sending direction. Would that work for you?
> 
>  -Hans
> 


From thestig at google.com  Thu Apr 17 15:05:25 2008
From: thestig at google.com (Lei Zhang)
Date: Thu, 17 Apr 2008 13:05:25 -0700
Subject: msxml3: Implement transformNode (try 3)
In-Reply-To: <b130c85e0804170956r8338396u43887738b48bef81@mail.gmail.com>
References: <ftvcka$qrg$1@ger.gmane.org> <fu5nn3$3vc$1@ger.gmane.org>
	<b130c85e0804170956r8338396u43887738b48bef81@mail.gmail.com>
Message-ID: <558b2f5c0804171305k6bd8241bnb34901e46b8b7e20@mail.gmail.com>

On Thu, Apr 17, 2008 at 9:56 AM, Maarten Lankhorst
<m.b.lankhorst at gmail.com> wrote:
> Hello Alistair,
>
>  2008/4/16, Alistair Leslie-Hughes <leslie_alistair at hotmail.com>:
>
> > "Alistair Leslie-Hughes" <leslie_alistair at hotmail.com> wrote in message
>  >  news:ftvcka$qrg$1 at ger.gmane.org...
>  >  > Hi,
>  >  > Corrected issue with tests
>  >  >
>  >  > Changelog:
>  >  > msxml3: Implement transformNode
>  >  >
>  >  > Best Regards
>  >  >  Alistair Leslie-Hughes
>  >  >
>  >  Anything wrong with this patch?
>  Yes, it breaks building on dapper. I get an undefined reference to
>  xsltInit in main.c
>
>  Cheers,
>  Maarten.
>
>
>

Patch sent:

http://www.winehq.org/pipermail/wine-patches/2008-April/053513.html


From hans at it.vu.nl  Thu Apr 17 15:13:49 2008
From: hans at it.vu.nl (Hans Leidekker)
Date: Thu, 17 Apr 2008 22:13:49 +0200
Subject: wininet: correct the case where Content-Length is set as well as
	Transer-Encoding = chunked
In-Reply-To: <4807A4F9.2020208@codeweavers.com>
References: <48079175.3010107@codeweavers.com>
	<200804172126.30625.hans@it.vu.nl>
	<4807A4F9.2020208@codeweavers.com>
Message-ID: <200804172213.49344.hans@it.vu.nl>

On Thursday 17 April 2008 21:28:57 Aric Stewart wrote:

> This patch is for the receiving direction, unless I misread the code.

Well, we're in a loop here, possibly sending and receiving multiple times
because of redirects.

> The issue is that after a sent request the response is coming back with
> both Transfer-Encoding=chunked and a Content-Length.

Which webserver is that?

RFC2616, section 4.4 states that "Messages MUST NOT include both a
 Content-Length header field and a non-identity transfer-coding. If the
 message does include a non-identity transfer-coding, the Content-Length
 MUST be ignored." 

So it looks like your patch does the right thing when we receive a
non-compliant response. I think we have a problem in the sending direction
too but we can address that later.

 -Hans


From joel at airwebreathe.org.uk  Thu Apr 17 18:07:58 2008
From: joel at airwebreathe.org.uk (Joel Holdsworth)
Date: Fri, 18 Apr 2008 00:07:58 +0100
Subject: Wine Status Page
Message-ID: <1208473678.6673.5.camel@joel-desktop>

Hi All,

Are there any plans to update the percentages on the Wine status page
any time soon? I'm curious to know how much progress has been made in
the past 10 months.

Regards
Joel Holdsworth




From hintak_leung at yahoo.co.uk  Thu Apr 17 14:21:25 2008
From: hintak_leung at yahoo.co.uk (Hin-Tak Leung)
Date: Thu, 17 Apr 2008 19:21:25 +0000 (GMT)
Subject: installing wine into linux ubuntu
In-Reply-To: <BAY114-W5346A2814598953C9CA3EDB5E50@phx.gbl>
Message-ID: <776761.16774.qm@web23109.mail.ird.yahoo.com>

--- On Thu, 17/4/08, stephen cooper <stephencooper96 at hotmail.com> wrote:
<snipped>
> /usr/bin/ld: crt1.o: No such file: No such file or directory
> collect2: ld returned 1 exit
<snipped>

Your specific problem is that you are missing crt1.o - that's part of
the glibc-dev package, I think. Install that the usual way under ubuntu.

As others has suggested - 
(1) your question is more appropriate to wine-users,
(2) considering using one of the pre-packaged deb packages available from either ubuntu or on winehq, instead of rolling your own, 
(3) since you don't even have glibc-dev (and your system does not seem
to have any developer tools at all, since almost every dev tool depends 
on this), you need to install a lot of required tools before you attempt
doing this again.




      ___________________________________________________________ 
Yahoo! For Good helps you make a difference  

http://uk.promotions.yahoo.com/forgood/


From scott at open-vote.org  Thu Apr 17 19:03:47 2008
From: scott at open-vote.org (Scott Ritchie)
Date: Thu, 17 Apr 2008 17:03:47 -0700
Subject: Towards pure wine: a step by step approach
In-Reply-To: <a71bd89a0804170820j22f4a449h5ad00373b8b5e269@mail.gmail.com>
References: <a71bd89a0804170820j22f4a449h5ad00373b8b5e269@mail.gmail.com>
Message-ID: <4807E563.1060400@open-vote.org>

Dan Kegel wrote:
> Errors reported by valgrind, coverity, and our conformance test suite
> are all worth fixing... but fixing them *all* is like shovelling out
> the dung from an infinitely large barn.  Various people have tried
> fixing one kind of error or the other, but maybe a combined attack,
> where we went module by module and fixed *all* of the valgrind,
> coverity, and conformance test errors might be more fruitful
> (or at least more satisfying).   Such an attempt should probably
> start at the bottom, cleaning up modules in the order
>   wineserver, ntdll, kernel32, gdi32, user32, ...
> 

Is this also the order of the most mature modules?  It seems to make
sense doing this kind of cleanup on the more stable parts first, since
the fixes are more likely to be permanent.

Thanks,
Scott Ritchie


From dank at kegel.com  Thu Apr 17 19:09:56 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 17 Apr 2008 17:09:56 -0700
Subject: Towards pure wine: a step by step approach
In-Reply-To: <4807E563.1060400@open-vote.org>
References: <a71bd89a0804170820j22f4a449h5ad00373b8b5e269@mail.gmail.com>
	<4807E563.1060400@open-vote.org>
Message-ID: <a71bd89a0804171709u7cc40c90o4c69bd11ea35b3ca@mail.gmail.com>

On Thu, Apr 17, 2008 at 5:03 PM, Scott Ritchie <scott at open-vote.org> wrote:
>  > Such an attempt should probably
>  > start at the bottom, cleaning up modules in the order
>  >   wineserver, ntdll, kernel32, gdi32, user32, ...
>
>  Is this also the order of the most mature modules?  It seems to make
>  sense doing this kind of cleanup on the more stable parts first, since
>  the fixes are more likely to be permanent.

Yes, I think so (though user32 can't quite be called fully stable).

Doing it bottom-up is also natural because otherwise
we'd see lots of lower-level module errors while valgrinding
or running conformance tests on upper-level modules.


From dank at kegel.com  Thu Apr 17 20:14:40 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 17 Apr 2008 18:14:40 -0700
Subject: new Valgrind errors in oleaut32
Message-ID: <a71bd89a0804171814n602daba7rc28e57ba8a8d82f8@mail.gmail.com>

James just barely touched the oleaut32 tests, and
as a side effect, we now have several more warnings of the sort

+ Conditional jump or move depends on uninitialised value(s)
+    at  VARIANT_DI_tostringW (vartype.c:4852)
+    by  VarBstrFromCy (vartype.c:6519)
+    by  VariantChangeTypeEx (variant.c:433)
+    by  VarCat (variant.c:2555)
+    by  test_VarCat (vartest.c:5246)
+    by  func_vartest (vartest.c:8436)
+    by  run_test (test.h:406)
+    by  main (test.h:455)

and

+ Conditional jump or move depends on uninitialised value(s)
+    at  __printf_fp (in /lib/tls/i686/cmov/libc-2.6.1.so)
+    by  vfprintf (in /lib/tls/i686/cmov/libc-2.6.1.so)
+    by  vsprintf (in /lib/tls/i686/cmov/libc-2.6.1.so)
+    by  sprintf (in /lib/tls/i686/cmov/libc-2.6.1.so)
+    by  vsnprintfW (string.c:408)
+    by  sprintfW (string.c:455)
+    by  VARIANT_BstrFromReal (vartype.c:6406)
+    by  VarBstrFromR4 (vartype.c:6457)
+    by  VariantChangeTypeEx (variant.c:430)
+    by  VarCat (variant.c:2555)
+    by  test_VarCat (vartest.c:5246)
+    by  func_vartest (vartest.c:8454)
+    by  run_test (test.h:406)
+    by  main (test.h:455)

See http://kegel.com/wine/valgrind/logs-2008-04-17/vg-oleaut32_vartest-diff.txt


From zgs at seas.upenn.edu  Thu Apr 17 22:17:24 2008
From: zgs at seas.upenn.edu (Zachary Goldberg)
Date: Thu, 17 Apr 2008 23:17:24 -0400
Subject: Wine Status Page
In-Reply-To: <1208473678.6673.5.camel@joel-desktop>
References: <1208473678.6673.5.camel@joel-desktop>
Message-ID: <b050a5e70804172017m41685299ub0f44e079f7ed428@mail.gmail.com>

On Thu, Apr 17, 2008 at 7:07 PM, Joel Holdsworth
<joel at airwebreathe.org.uk> wrote:
> Hi All,
>
>  Are there any plans to update the percentages on the Wine status page
>  any time soon? I'm curious to know how much progress has been made in
>  the past 10 months.
>
>  Regards
>  Joel Holdsworth
>
>
>
>
>

I've spoken with the guy who used to maintain these pages (Tom
Wickline) who mentioned that he may be able to update them during the
code freeze this coming May.


-- 
Zachary Goldberg
Computer Science & Engineering
Electrical Captain of Penn Electric Race Team
School of Engineering at the University of Pennsylvania


From dmitry at codeweavers.com  Fri Apr 18 03:55:10 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 18 Apr 2008 17:55:10 +0900
Subject: wininet: improve stub for FindNextUrlCacheEntryW a tiny bit
References: <759214.73335.qm@web23212.mail.ird.yahoo.com>
Message-ID: <022501c8a131$ec699130$a600fea9@DMITRY>

"Louis. Lenders" <xerox_xerox2000 at yahoo.co.uk> wrote:

> @@ -3113,6 +3113,7 @@ BOOL WINAPI FindNextUrlCacheEntryW(
>    LPDWORD lpdwNextCacheEntryInfoBufferSize
>  )
>  {
> +    SetLastError(ERROR_CALL_NOT_IMPLEMENTED);
>      FIXME("(%p, %p, %p) stub\n", hEnumHandle, lpNextCacheEntryInfo, lpdwNextCacheEntryInfoBufferSize);
>      return FALSE;
>  }

You should put SetLastError() immediately before return, any calls after
it may potentially change last error value.

-- 
Dmitry.


From astrand at cendio.se  Fri Apr 18 04:01:57 2008
From: astrand at cendio.se (=?UTF-8?Q?Peter_=C3=85strand?=)
Date: Fri, 18 Apr 2008 11:01:57 +0200 (CEST)
Subject: Strange waveOutGetDevCaps calls in winmm/tests/wave.c
In-Reply-To: <3a768c550804160744r285ab6a0j1a02b7892841e661@mail.gmail.com>
References: <Pine.LNX.4.64.0804161351210.19758@maggie.lkpg.cendio.se>
	<3a768c550804160744r285ab6a0j1a02b7892841e661@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0804171247560.7871@maggie.lkpg.cendio.se>

On Wed, 16 Apr 2008, Juan Lang wrote:

> >  The CapsA test doesn't fail, probably since winmm wraps CapsA calls with
> >  CapsW calls and then does memcpy. In either case, calling
> >  waveOutGetDevCaps sith size=4 is not valid, as far as I can tell.
> >  Theoretically, it might be in the future, though, if some small caps
> >  structure is invented. I suggest that these tests are removed altogether:
> 
> Sounds reasonable to me; please send to wine-patches.

Actually, the patch was wrong: The capsA structure is used later below, so 
the call needs to be fixed rather than removed. 

I'll fix a new patch. 

Rgds, 
---
Peter ?strand		ThinLinc Chief Developer
Cendio AB		http://www.cendio.se
Wallenbergs gata 4
583 30 Link?ping	Phone: +46-13-21 46 00

From julliard at winehq.org  Fri Apr 18 06:44:42 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 18 Apr 2008 13:44:42 +0200
Subject: shell32: implement SHGetFolderPathAndSubDirA/W [try2][resend]
In-Reply-To: <200804172331.05268.Stefan.Leichter@camline.com> (Stefan
	Leichter's message of "Thu, 17 Apr 2008 23:31:05 +0200")
References: <200804172331.05268.Stefan.Leichter@camline.com>
Message-ID: <87mynrjsk5.fsf@wine.dyndns.org>

Stefan Leichter <Stefan.Leichter at camline.com> writes:

> @@ -1758,7 +1836,7 @@
>       */
>      if (!(nFolder & CSIDL_FLAG_CREATE))
>      {
> -        hr = HRESULT_FROM_WIN32(ERROR_FILE_NOT_FOUND);
> +        hr = HRESULT_FROM_WIN32(ERROR_PATH_NOT_FOUND);
>          goto end;

Why is it using a different error code here?  Do you have a test case
for this?

-- 
Alexandre Julliard
julliard at winehq.org


From aric at codeweavers.com  Fri Apr 18 06:53:01 2008
From: aric at codeweavers.com (Aric Stewart)
Date: Fri, 18 Apr 2008 06:53:01 -0500
Subject: wininet: correct the case where Content-Length is set as well
	as Transer-Encoding = chunked
In-Reply-To: <200804172213.49344.hans@it.vu.nl>
References: <48079175.3010107@codeweavers.com>
	<200804172126.30625.hans@it.vu.nl>
	<4807A4F9.2020208@codeweavers.com>
	<200804172213.49344.hans@it.vu.nl>
Message-ID: <48088B9D.6090908@codeweavers.com>

Here is the download where i see the behavior is where I see the behavior.

http://site.ebrary.com/lib/stanford/support/plugins/ebraryReader.exe

thanks,
-aric

Hans Leidekker wrote:
> On Thursday 17 April 2008 21:28:57 Aric Stewart wrote:
> 
>> This patch is for the receiving direction, unless I misread the code.
> 
> Well, we're in a loop here, possibly sending and receiving multiple times
> because of redirects.
> 
>> The issue is that after a sent request the response is coming back with
>> both Transfer-Encoding=chunked and a Content-Length.
> 
> Which webserver is that?
> 
> RFC2616, section 4.4 states that "Messages MUST NOT include both a
>  Content-Length header field and a non-identity transfer-coding. If the
>  message does include a non-identity transfer-coding, the Content-Length
>  MUST be ignored." 
> 
> So it looks like your patch does the right thing when we receive a
> non-compliant response. I think we have a problem in the sending direction
> too but we can address that later.
> 
>  -Hans
> 


From Stefan.Leichter at camLine.com  Fri Apr 18 07:56:38 2008
From: Stefan.Leichter at camLine.com (Stefan Leichter)
Date: Fri, 18 Apr 2008 14:56:38 +0200
Subject: shell32: implement SHGetFolderPathAndSubDirA/W [try2][resend]
In-Reply-To: <87mynrjsk5.fsf@wine.dyndns.org>
References: <200804172331.05268.Stefan.Leichter@camline.com>
	<87mynrjsk5.fsf@wine.dyndns.org>
Message-ID: <48089A86.6080706@camLine.com>

Alexandre Julliard schrieb:
> Stefan Leichter <Stefan.Leichter at camline.com> writes:
> 
>> @@ -1758,7 +1836,7 @@
>>       */
>>      if (!(nFolder & CSIDL_FLAG_CREATE))
>>      {
>> -        hr = HRESULT_FROM_WIN32(ERROR_FILE_NOT_FOUND);
>> +        hr = HRESULT_FROM_WIN32(ERROR_PATH_NOT_FOUND);
>>          goto end;
> 
> Why is it using a different error code here?  Do you have a test case
> for this?
> 
Of course

dlls/shell32/tests/shlfolder.c around line 1457


From Petr.Sumbera at Sun.COM  Fri Apr 18 08:21:00 2008
From: Petr.Sumbera at Sun.COM (Petr Sumbera)
Date: Fri, 18 Apr 2008 15:21:00 +0200
Subject: Trouble in compiling Wine 0.9.57 and 0.9.58 on Solaris 10 08/07
In-Reply-To: <871w54l6sn.fsf@wine.dyndns.org>
References: <47FF74FD.4060307@sun.com> <00a101c89da4$e7f77210$4001a8c0@NATERS>
	<200804132308.19873.stefan@codeweavers.com>
	<48061E27.3070509@sun.com> <871w54l6sn.fsf@wine.dyndns.org>
Message-ID: <4808A03C.5050207@sun.com>

Alexandre Julliard wrote:
> Petr Sumbera <Petr.Sumbera at Sun.COM> writes:
> 
>> Well, we have only one isinf call in Wine so I think it isn't worst of
>> creating Wine special isinf implementation. Instead I propose emulate
>> isinf via finite() and isnand() (both coming from ieeefp.h).
> 
> You should still put that in libwine_port, it keeps the #ifdef ugliness
> out of the code.
> 

What about defining isinf as macro?

diff --git a/include/wine/port.h b/include/wine/port.h
index 6727891..59c12aa 100644
--- a/include/wine/port.h
+++ b/include/wine/port.h
@@ -146,6 +146,11 @@ struct statvfs
  #define strtoull _strtoui64
  #endif

+#if !defined(HAVE_ISINF) && defined(HAVE_IEEEFP_H)
+#include <ieeefp.h>
+#define isinf(x) (!(finite(x) || isnand(x)))
+#endif
+
  #ifndef S_ISLNK
  # define S_ISLNK(mod) (0)
  #endif


---

BTW, I would maybe question also existence of float_32_to_16() in header 
  file too.

Petr


From dmitry at codeweavers.com  Fri Apr 18 08:52:18 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 18 Apr 2008 22:52:18 +0900
Subject: user32:mdi.c  Fix creating MDI child window according with test.
References: <480894BF.9020009@etersoft.ru>
Message-ID: <001b01c8a15b$6d07c220$a600fea9@DMITRY>

"Anatoly Lyutin" <vostok at etersoft.ru> wrote:

> --- dlls/user32/mdi.c 5 Mar 2008 19:42:23 -0000 1.24
> +++ dlls/user32/mdi.c 18 Apr 2008 12:07:50 -0000
> @@ -649,6 +728,9 @@ static LONG MDI_ChildActivate( HWND clie
>     }
> 
>     SendMessageW( child, WM_MDIACTIVATE, (WPARAM)prevActiveWnd, (LPARAM)child );
> +
> +    SetWindowPos( frame, HWND_TOP, 0, 0, 0, 0, SWP_NOMOVE|SWP_NOSIZE|SWP_NOACTIVATE|SWP_FRAMECHANGED );

SWP_NOZORDER should be there for sure, and in that case HWND_TOP doesn't make
sense, so  just use 0 (although HWND_TOP == 0) instead.

-- 
Dmitry.


From vostok at etersoft.ru  Fri Apr 18 09:29:51 2008
From: vostok at etersoft.ru (Anatoly Lyutin)
Date: Fri, 18 Apr 2008 18:29:51 +0400
Subject: user32:mdi.c  Fix creating MDI child window according with test.
In-Reply-To: <001b01c8a15b$6d07c220$a600fea9@DMITRY>
References: <480894BF.9020009@etersoft.ru>
	<001b01c8a15b$6d07c220$a600fea9@DMITRY>
Message-ID: <4808B05F.2010207@etersoft.ru>

Dmitry Timoshkov wrote:
>
> SWP_NOZORDER should be there for sure, and in that case HWND_TOP 
> doesn't make
> sense, so  just use 0 (although HWND_TOP == 0) instead.
>
Yes, You are right. I have sent a new version.

-- 
Best regards
	Anatoly Lyutin.



From reif at earthlink.net  Fri Apr 18 09:33:41 2008
From: reif at earthlink.net (Robert Reif)
Date: Fri, 18 Apr 2008 10:33:41 -0400
Subject: winmm/tests: waveOutGetDevCaps called with invalid size
In-Reply-To: <Pine.LNX.4.64.0804181102080.23847@maggie.lkpg.cendio.se>
References: <Pine.LNX.4.64.0804181102080.23847@maggie.lkpg.cendio.se>
Message-ID: <4808B145.2010609@earthlink.net>

Peter ?strand wrote:
> Changelog:
>
> Calling waveOutGetDevCapsA/waveOutGetDevCapsW with size 4 is wrong, the 
> size should be the sizeof the structure used. waveOutGetDevCapsA needs to 
> succeed since the capsA structure is used later. 
>
> Index: wave.c
> ===================================================================
> RCS file: /home/wine/wine/dlls/winmm/tests/wave.c,v
> retrieving revision 1.67
> diff -u -r1.67 wave.c
> --- wave.c	29 Feb 2008 12:18:36 -0000	1.67
> +++ wave.c	18 Apr 2008 08:43:54 -0000
> @@ -853,15 +853,13 @@
>         "expected, got %s\n",dev_name(device),wave_out_error(rc));
>      }
>  
> -    rc=waveOutGetDevCapsA(device,&capsA,4);
> +    /* Final call must succeed, capsA will be used below */
> +    rc=waveOutGetDevCapsA(device,&capsA,sizeof(capsA));
>      ok(rc==MMSYSERR_NOERROR,
>         "waveOutGetDevCapsA(%s): MMSYSERR_NOERROR expected, got %s\n",
>         dev_name(device),wave_out_error(rc));
> -
> -    rc=waveOutGetDevCapsW(device,&capsW,4);
> -    ok(rc==MMSYSERR_NOERROR || rc==MMSYSERR_NOTSUPPORTED,
> -       "waveOutGetDevCapsW(%s): MMSYSERR_NOERROR or MMSYSERR_NOTSUPPORTED "
> -       "expected, got %s\n",dev_name(device),wave_out_error(rc));
> +    if (rc!=MMSYSERR_NOERROR)
> +	return;
>  
>      nameA=NULL;
>      rc=waveOutMessage((HWAVEOUT)device, DRV_QUERYDEVICEINTERFACESIZE,
>
>
> ---
> Peter ?strand		ThinLinc Chief Developer
> Cendio AB		http://www.cendio.se
> Wallenbergs gata 4
> 583 30 Link?ping	Phone: +46-13-21 46 00
> ------------------------------------------------------------------------
>
>
>   
That's the whole point of the test, to check what happens with an 
invalid argument.


From dank at kegel.com  Fri Apr 18 09:45:15 2008
From: dank at kegel.com (Dan Kegel)
Date: Fri, 18 Apr 2008 07:45:15 -0700
Subject: New winetricks 20080418: add wmp10, windows codecs,
	accept new flash version
Message-ID: <a71bd89a0804180745v73d505a5m288c55d0c72059ff@mail.gmail.com>

Another day, another Winetricks.

Changes since yesterday's annoucement:
 Switch to listing simpler synonyms for changing windows version (long
ones still valid)
 Correct description of volnum verb (it's still needed)
 Fix typo in sha1sum check that caused it to be ignored!
 Update sha1sum for flash player (see comment for URL about the update)
 Much better error reporting for gui users.
 Add wmp10
 Installing wmp9 or wmp10 also gets codecs now

Online as always at
  http://kegel.com/wine/winetricks
or
  http://winezeug.googlecode.com


From tony.wasserka at freenet.de  Fri Apr 18 10:49:15 2008
From: tony.wasserka at freenet.de (tony.wasserka at freenet.de)
Date: Fri, 18 Apr 2008 17:49:15 +0200
Subject: d3dx9_36: Add stubs and implementations for D3DXCreateTexturexx
Message-ID: <E1Jmspv-0007s6-Ql@www19.emo.freenet-rz.de>

>   I have a hacky implementation of D3DXLoadSurfaceFromMemory and
> D3DXLoadSurfaceFromSurface, as well as a pretty good implementation of
> D3DXCreateTexture and D3DXCheckTextureRequirements.
> 
>   I'll send in the patch for the last two when I have time, and have
> looked it over a final time.  I pretty much abandoned the first two,
> because there's got to be a whole lot of code somewhere in the tree
> already.  It does work in some cases, however.  Attached in case it
> might be helpful.

Nice, I hope I can do something with the D3DXLoadSurfaceFromMemory/Surface
implementations when my D3DXLoadXXFromFile functions are ready, thank you!
However, I don't wanna push you, but can you send me your current code for 
D3DXCreateTexture+D3DXCheckTextureRequirements so that I can
work on D3DXLoadXXFromFile and the other functions until it's in the main tree?

    Tony



Unbegrenzter Speicher, Top-Spamschutz, 120 SMS und eigene E-MailDomain inkl.
http://office.freenet.de/dienste/emailoffice/produktuebersicht/power/mail/index.html



From bunk at stusta.de  Fri Apr 18 11:52:19 2008
From: bunk at stusta.de (Adrian Bunk)
Date: Fri, 18 Apr 2008 19:52:19 +0300
Subject: Wine release 0.9.60
In-Reply-To: <20080418155916.7F4431E715A@wine.dyndns.org>
References: <20080418155916.7F4431E715A@wine.dyndns.org>
Message-ID: <20080418165219.GB9770@cs181133002.pp.htv.fi>

On Fri, Apr 18, 2008 at 05:59:16PM +0200, Alexandre Julliard wrote:
>...
> Bugs fixed since 0.9.59:
>...
>    7174  Master of Orion 2 does not switch screen resolution correctly
>...

That this bug is listed as "fixed since 0.9.59" is wrong, and it sounds 
as if you wrongly count all bugs closed since 0.9.59 as having been 
present in 0.9.59?

Looking through some of the other bugs (especially older ones) the 
information in Bugzilla indicates for several other bugs listed in your 
announcement that they were not "fixed since 0.9.59".

You Wine developers are doing a great job, but especially since you are 
currently actively triaging older bugs "fixed since 0.9.59" is quite 
different from "closed since 0.9.59".

> Alexandre Julliard

cu
Adrian

-- 

       "Is there not promise of rain?" Ling Tan asked suddenly out
        of the darkness. There had been need of rain for many days.
       "Only a promise," Lao Er said.
                                       Pearl S. Buck - Dragon Seed



From julliard at winehq.org  Fri Apr 18 12:46:51 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 18 Apr 2008 19:46:51 +0200
Subject: Wine release 0.9.60
In-Reply-To: <20080418165219.GB9770@cs181133002.pp.htv.fi> (Adrian Bunk's
	message of "Fri, 18 Apr 2008 19:52:19 +0300")
References: <20080418155916.7F4431E715A@wine.dyndns.org>
	<20080418165219.GB9770@cs181133002.pp.htv.fi>
Message-ID: <87hcdzjbsk.fsf@wine.dyndns.org>

Adrian Bunk <bunk at stusta.de> writes:

> That this bug is listed as "fixed since 0.9.59" is wrong, and it sounds 
> as if you wrongly count all bugs closed since 0.9.59 as having been 
> present in 0.9.59?
>
> Looking through some of the other bugs (especially older ones) the 
> information in Bugzilla indicates for several other bugs listed in your 
> announcement that they were not "fixed since 0.9.59".
>
> You Wine developers are doing a great job, but especially since you are 
> currently actively triaging older bugs "fixed since 0.9.59" is quite 
> different from "closed since 0.9.59".

Not really; the important point is that the bug is not present in
0.9.60. I don't think it matters all that much to know whether it was
really still present in 0.9.59, or already fixed there but not reported
as such.

Doing this right would require adding support in bugzilla for storing
the sha1 of the commit that fixed the bug, then we could query exactly
which release fixed which bug. Patches are welcome...

-- 
Alexandre Julliard
julliard at winehq.org


From r.kalbermatter at hccnet.nl  Fri Apr 18 15:15:56 2008
From: r.kalbermatter at hccnet.nl (Rolf Kalbermatter)
Date: Fri, 18 Apr 2008 22:15:56 +0200
Subject: Trouble in compiling Wine 0.9.57 and 0.9.58 on Solaris 10 08/07
In-Reply-To: <4808A03C.5050207@sun.com>
References: <47FF74FD.4060307@sun.com> <00a101c89da4$e7f77210$4001a8c0@NATERS>
	<200804132308.19873.stefan@codeweavers.com>
	<48061E27.3070509@sun.com> <871w54l6sn.fsf@wine.dyndns.org>
	<4808A03C.5050207@sun.com>
Message-ID: <001601c8a191$0360bb20$4001a8c0@NATERS>

Petr.Sumbera at Sun.COM [mailto:Petr.Sumbera at Sun.COM] wrote:

> What about defining isinf as macro?
> 
> diff --git a/include/wine/port.h b/include/wine/port.h index 
> 6727891..59c12aa 100644
> --- a/include/wine/port.h
> +++ b/include/wine/port.h
> @@ -146,6 +146,11 @@ struct statvfs
>   #define strtoull _strtoui64
>   #endif
> 
> +#if !defined(HAVE_ISINF) && defined(HAVE_IEEEFP_H) #include <ieeefp.h> 
> +#define isinf(x) (!(finite(x) || isnand(x))) #endif
> +
>   #ifndef S_ISLNK
>   # define S_ISLNK(mod) (0)
>   #endif

With the exception of the somewhat weird line wrapping (or better lack
thereof)
this looks like what I had in mind. I don't see the benefit of adding
something
simple like this into libwine_port.

But of course it's Alexandre's call.

Rolf Kalbermatter



From julliard at winehq.org  Fri Apr 18 16:33:26 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 18 Apr 2008 23:33:26 +0200
Subject: Wine release 0.9.60
In-Reply-To: <20080418201417.GA1595@cs181133002.pp.htv.fi> (Adrian Bunk's
	message of "Fri, 18 Apr 2008 23:14:17 +0300")
References: <20080418155916.7F4431E715A@wine.dyndns.org>
	<20080418165219.GB9770@cs181133002.pp.htv.fi>
	<87hcdzjbsk.fsf@wine.dyndns.org>
	<20080418201417.GA1595@cs181133002.pp.htv.fi>
Message-ID: <87d4omkfvd.fsf@wine.dyndns.org>

Adrian Bunk <bunk at stusta.de> writes:

> I might be a bit nitpicking, but "Bugs fixed since 0.9.59" implies for  
> me that these bugs have been fixed after 0.9.59.

I can certainly change it to "Bugs fixed in 0.9.60" if you prefer that.

> And when I'm reading the 0.9.60 announcement I'm mostly interested in 
> whether upgrading from 0.9.59 to 0.9.60 is worth it, not whether your 
> Bugzilla triage has found that a bug has been fixed a year ago. [1]

But maybe other people are interested to know that their bug has been
fixed, and don't care whether it was fixed before or after 0.9.59. Since
there is at the moment no good way to find out which bugs were fixed in
0.9.59 but marked resolved after that, listing them in the next
announcement is IMO better than not listing them at all.

-- 
Alexandre Julliard
julliard at winehq.org


From m.b.lankhorst at gmail.com  Fri Apr 18 16:37:28 2008
From: m.b.lankhorst at gmail.com (Maarten Lankhorst)
Date: Fri, 18 Apr 2008 14:37:28 -0700
Subject: Hack: Debug a specific critical section WINE_DEBUG_SPINLOCK
Message-ID: <b130c85e0804181437h3237e223sd98d8a6cae69a4ea@mail.gmail.com>

Hi all,

I created a hack to debug a specific critical section with
WINE_DEBUG_SPINLOCK environment. It was useful for me because it found
a very weird deadlock, a thread would terminate before releasing its
critical section. It will also change the timeout to 1 second so you
will get a faster response on potential latency issues.

How to use it?

First you need the exact spinlock name.

for example in parser.c:

    pParser->csFilter.DebugInfo->Spare[0] = (DWORD_PTR)(__FILE__ ":
ParserImpl.csFilter");

Of course you still need to know what __FILE__ is, this is usually
parser.c but I'm not 100% sure that is the same for out of tree
builds.

So just to be sure:
$ strings parser.o |grep csFilter
parser.c: ParserImpl.csFilter

export WINE_DEBUG_SPINLOCK="parser.c: ParserImpl.csFilter"

It will then print a ++ for every time a lock is entered, and -- for
every time lock is left., I would recommend mixing this with
WINEDEBUG=+tid so you can also see the threads they are in.

Comments?

Cheers,
Maarten.
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: 0013-ntdll-Add-reading-WINE_DEBUG_SPINLOCK-variable.txt
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20080418/56e157b8/attachment.txt 

From bunk at stusta.de  Fri Apr 18 15:14:17 2008
From: bunk at stusta.de (Adrian Bunk)
Date: Fri, 18 Apr 2008 23:14:17 +0300
Subject: Wine release 0.9.60
In-Reply-To: <87hcdzjbsk.fsf@wine.dyndns.org>
References: <20080418155916.7F4431E715A@wine.dyndns.org>
	<20080418165219.GB9770@cs181133002.pp.htv.fi>
	<87hcdzjbsk.fsf@wine.dyndns.org>
Message-ID: <20080418201417.GA1595@cs181133002.pp.htv.fi>

On Fri, Apr 18, 2008 at 07:46:51PM +0200, Alexandre Julliard wrote:
> Adrian Bunk <bunk at stusta.de> writes:
> 
> > That this bug is listed as "fixed since 0.9.59" is wrong, and it sounds 
> > as if you wrongly count all bugs closed since 0.9.59 as having been 
> > present in 0.9.59?
> >
> > Looking through some of the other bugs (especially older ones) the 
> > information in Bugzilla indicates for several other bugs listed in your 
> > announcement that they were not "fixed since 0.9.59".
> >
> > You Wine developers are doing a great job, but especially since you are 
> > currently actively triaging older bugs "fixed since 0.9.59" is quite 
> > different from "closed since 0.9.59".
> 
> Not really; the important point is that the bug is not present in
> 0.9.60. I don't think it matters all that much to know whether it was
> really still present in 0.9.59, or already fixed there but not reported
> as such.

I might be a bit nitpicking, but "Bugs fixed since 0.9.59" implies for  
me that these bugs have been fixed after 0.9.59.

And when I'm reading the 0.9.60 announcement I'm mostly interested in 
whether upgrading from 0.9.59 to 0.9.60 is worth it, not whether your 
Bugzilla triage has found that a bug has been fixed a year ago. [1]

> Doing this right would require adding support in bugzilla for storing
> the sha1 of the commit that fixed the bug, then we could query exactly
> which release fixed which bug. Patches are welcome...

Without any patches you could add fields "Known to work:" and
"Known to fail:" as in the gcc Bugzilla (see e.g. [2]), when resolving a 
bug updating them, and then query for which bugs 0.9.59 was known to 
fail and 0.9.60 is known to work.

> Alexandre Julliard

cu
Adrian

[1] triaging bugs is an important task, but the information about
    closing bugs fixed long ago doesn't belong here
[2] http://gcc.gnu.org/bugzilla/show_bug.cgi?id=20623

-- 

       "Is there not promise of rain?" Ling Tan asked suddenly out
        of the darkness. There had been need of rain for many days.
       "Only a promise," Lao Er said.
                                       Pearl S. Buck - Dragon Seed



From hverbeet at gmail.com  Fri Apr 18 19:36:39 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Sat, 19 Apr 2008 02:36:39 +0200
Subject: [PATCH 2/2] wined3d: Prevent console spamming in drawPrimitive.
In-Reply-To: <480915AB.7060104@inbox.lv>
References: <480915AB.7060104@inbox.lv>
Message-ID: <d658b69e0804181736u32f4eafbw1b9ea9a5d0561180@mail.gmail.com>

On 18/04/2008, Alexander Dorofeyev <alexd4 at inbox.lv> wrote:
> Fixes massive slowdown in games like Aliens vs Predator 2.
>
If you care about performance you should always run with
WINEDEBUG="-all" anyway.


From dmitry at codeweavers.com  Fri Apr 18 20:52:38 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sat, 19 Apr 2008 10:52:38 +0900
Subject: [PATCH] user32: Handle VK_RETURN KeyDown events more properly in
	EDITcontrols.
References: <3c72a4290804181550x5b550459o4a0a6c5b95c16962@mail.gmail.com>
Message-ID: <01e801c8a1c0$0d4a8740$a600fea9@DMITRY>

"El." <elptr at users.sourceforge.net> wrote:

> @@ -4606,6 +4606,10 @@ static LRESULT EDIT_WM_KeyDown(EDITSTATE *es, INT key)
>       {
>    HWND hwndParent = GetParent(es->hwndSelf);
>    DWORD dw = SendMessageW( hwndParent, DM_GETDEFID, 0, 0 );
> +
> +  if (GetClassLongW(hwndParent, GCW_ATOM) != WC_DIALOG)
> +      break;

You need to add a test case first to confirm that the fix is correct, and
use EDIT_IsInsideDialog to detect if the parent is dialog.

-- 
Dmitry.


From stefan at codeweavers.com  Fri Apr 18 23:37:50 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sat, 19 Apr 2008 06:37:50 +0200
Subject: [PATCH 2/2] wined3d: Prevent console spamming in drawPrimitive.
In-Reply-To: <d658b69e0804181736u32f4eafbw1b9ea9a5d0561180@mail.gmail.com>
References: <480915AB.7060104@inbox.lv>
	<d658b69e0804181736u32f4eafbw1b9ea9a5d0561180@mail.gmail.com>
Message-ID: <200804190637.51151.stefan@codeweavers.com>

Am Samstag, 19. April 2008 02:36:39 schrieb H. Verbeet:
> On 18/04/2008, Alexander Dorofeyev <alexd4 at inbox.lv> wrote:
> > Fixes massive slowdown in games like Aliens vs Predator 2.
>
> If you care about performance you should always run with
> WINEDEBUG="-all" anyway.
I think it is valid to prevent such flooding though, because with 
WINEDEBUG=-all you might miss helpful errors as well. Even if -all is not set 
it is usually quite hard to see a single legitimate fixme in such a flood


From hverbeet at gmail.com  Sat Apr 19 00:19:17 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Sat, 19 Apr 2008 07:19:17 +0200
Subject: [PATCH 2/2] wined3d: Prevent console spamming in drawPrimitive.
In-Reply-To: <200804190637.51151.stefan@codeweavers.com>
References: <480915AB.7060104@inbox.lv>
	<d658b69e0804181736u32f4eafbw1b9ea9a5d0561180@mail.gmail.com>
	<200804190637.51151.stefan@codeweavers.com>
Message-ID: <d658b69e0804182219p140cc1d9jfffd1ba442a797bc@mail.gmail.com>

On 19/04/2008, Stefan D?singer <stefan at codeweavers.com> wrote:
> Am Samstag, 19. April 2008 02:36:39 schrieb H. Verbeet:
>
> > On 18/04/2008, Alexander Dorofeyev <alexd4 at inbox.lv> wrote:
>  > > Fixes massive slowdown in games like Aliens vs Predator 2.
>  >
>  > If you care about performance you should always run with
>  > WINEDEBUG="-all" anyway.
>
> I think it is valid to prevent such flooding though, because with
>  WINEDEBUG=-all you might miss helpful errors as well. Even if -all is not set
>  it is usually quite hard to see a single legitimate fixme in such a flood
>
Oh, I'm not opposed to the patch itself, preventing the log from
getting spammed is a good thing. Just saying performance is the wrong
reason.


From tony.wasserka at freenet.de  Sat Apr 19 03:11:06 2008
From: tony.wasserka at freenet.de (tony.wasserka at freenet.de)
Date: Sat, 19 Apr 2008 10:11:06 +0200
Subject: d3dx9: Texturing functions
Message-ID: <E1Jn8A6-00041M-77@www15.emo.freenet-rz.de>

Hi all,
as it's a larger chunk of functions, I felt like proposing my design idea for the
D3DXCreateTexture/Volume/CubeTextureFromFile/Resource/FileInMemory/etc...
functions. I'm CC'ing it to any wine d3dx coder I have in my addressbook yet,
so sorry if I forgot one :)

So, the first thing I want to make sure is that we redirect the function calls correctly in order
to reduce double coding.
This means on the one hand that we should call the Extended versions of each function
from inside of the simpler ones (most default parameters for the Ex functions are
on MSDN) and on the other hand that we unify all D3DXCreateTextureFromXXEx
functions somehow. I don't know how Resources are stored internally, but I guess
the simplest would be to redirect all of them to D3DXCreateTextureFromFileInMemory, i.e.
when D3DXCreateTextureFromFile is called we read the file into memory and call the
InMemory function. I hope this shouldn't be too hard to be applied to the resource function
either. Of course, this should also be done at the corresponding Surface, Volume and
cube texture functions.
Also, I haven't looked too much into it yet, but I guess we could go even a step further
and define the CreateTextuteFromXX calls like this:
1. Redirect to the corresponding D3DXCreateXFromFileInMemoryEx call
2. Call D3DXCheckXRequirements
3. Call IDirect3DDevice9::CreateTexture
4. Lock its surface
5. Call LoadSurfaceFromFileEx with it

This would reduce most of our coding work on LoadSurfaceFromFileEx.
However, there are still plenty of formats supported by the texturing functions
and thus, plenty of work for us to do. IIRC we once came to the decision to
use libraries like libpng or so to reduce that work, too, so we'd just need
to implement formats like .dds.


And the last thing I'd like to ask goes to Louis Lenders: I've just found out
that you have been working on a D3DXCreateTextureFromFile implementation.
Are you still working on that? I'm really looking forward to do some coding
work again, so I could continue your implementation from the 24th March if
you've stopped to work on it ;-)

However, feel free to comment on my proposals for the texturing functions
and tell me if you see any concerns with it :)

Best regards,
   Tony



Unbegrenzter Speicher, Top-Spamschutz, 120 SMS und eigene E-MailDomain inkl.
http://office.freenet.de/dienste/emailoffice/produktuebersicht/power/mail/index.html



From jan.wine at zerebecki.de  Sat Apr 19 03:47:02 2008
From: jan.wine at zerebecki.de (Jan Zerebecki)
Date: Sat, 19 Apr 2008 10:47:02 +0200
Subject: Trying to get a grip on how to handle bug reports.
In-Reply-To: <22821af30804131228j7cd7d16cva450906cb2f0b54@mail.gmail.com>
References: <200804130014.58380.kai.blin@gmail.com>
	<22821af30804121557t2e560a85ub1d5a9ecc55dbadb@mail.gmail.com>
	<48025892.3090502@inbox.lv>
	<22821af30804131228j7cd7d16cva450906cb2f0b54@mail.gmail.com>
Message-ID: <20080419084702.GW3557@crissy.swd.zerebecki.de>

On Sun, Apr 13, 2008 at 02:28:15PM -0500, James Hawkins wrote:
> On behalf of the regular bugzilla moderators (of which there are very
> few), I'll go over the policy we have in place to keep, or strive to
> attain, a manageable bugzilla database.  There are only a few
> conditions that warrant abandoning a bug:
> 
> a) the bug must not be freely reproducible
> b) the reporter has not responded to a request for more information in
> at least 3 months, or
> c) the reporter will not or can not provide the information requested,
> usually not doing the regression testing

We should probably have such information on the wiki.
please :)


Jan



From eth.bell at gmail.com  Sat Apr 19 00:46:22 2008
From: eth.bell at gmail.com (El.)
Date: Sat, 19 Apr 2008 01:46:22 -0400
Subject: [PATCH] user32: Handle VK_RETURN KeyDown events more properly in
	EDITcontrols.
Message-ID: <3c72a4290804182246q5fbcc0dcxa8fe0cf28af5f783@mail.gmail.com>

> "El." <elptr at users.sourceforge.net> wrote:
>
> > @@ -4606,6 +4606,10 @@ static LRESULT EDIT_WM_KeyDown(EDITSTATE *es, INT key)
> >      {
> >    HWND hwndParent = GetParent(es->hwndSelf);
> >    DWORD dw = SendMessageW( hwndParent, DM_GETDEFID, 0, 0 );
> > +
> > +  if (GetClassLongW(hwndParent, GCW_ATOM) != WC_DIALOG)
> > +      break;
>
> You need to add a test case first to confirm that the fix is correct, and
> use EDIT_IsInsideDialog to detect if the parent is dialog.

Well I'm not sure what to test in the first place, I didn't assume that
modifying some aspect of the code to be in compliance with official
"standards" required writing any test case.

I might be missing what you mean by the "correctness" of the fix,
since I'm not really familiar with Wine's patching practices.

http://msdn2.microsoft.com/en-us/library/bb775464(VS.85).aspx

As for using EDIT_IsInsideDialog, that I can manage.


From hverbeet at gmail.com  Sat Apr 19 05:05:31 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Sat, 19 Apr 2008 12:05:31 +0200
Subject: WINED3D: Fix a possible null dereference.
In-Reply-To: <5f9140a20804181841o66aec35fr7bdb1252f1522333@mail.gmail.com>
References: <5f9140a20804181841o66aec35fr7bdb1252f1522333@mail.gmail.com>
Message-ID: <d658b69e0804190305l1de5644eib6ef4e4fa2943755@mail.gmail.com>

On 19/04/2008, David Adam <david.adam.cnrs at gmail.com> wrote:
> The Sting Demo calls the function
> IDirect3DDeviceImpl_7_SetMaterial (in ddraw/device.c) with
> Mat=NULL.
> Then, this makes the function IWineD3DDeviceImpl_SetMaterial (in
> wined3d/device.c) crashes in the line
> This->updateStateBlock->material = *pMaterial;
>  So, the patch checks is the material is not null before  assignating it.
>
> This fixes a crash in The Sting demo.
>
> David Adam
>
I would like to see a few tests that prove this is the correct
behaviour (instead of eg. simply returning WINED3DERR_INVALIDCALL),
for ddraw, d3d8 and d3d9.


From stefan at codeweavers.com  Sat Apr 19 07:55:32 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sat, 19 Apr 2008 14:55:32 +0200
Subject: [PATCH 2/2] wined3d: Prevent console spamming in drawPrimitive.
In-Reply-To: <d658b69e0804182219p140cc1d9jfffd1ba442a797bc@mail.gmail.com>
References: <480915AB.7060104@inbox.lv>
	<200804190637.51151.stefan@codeweavers.com>
	<d658b69e0804182219p140cc1d9jfffd1ba442a797bc@mail.gmail.com>
Message-ID: <200804191455.32766.stefan@codeweavers.com>

Am Samstag, 19. April 2008 07:19:17 schrieb H. Verbeet:
> Oh, I'm not opposed to the patch itself, preventing the log from
> getting spammed is a good thing. Just saying performance is the wrong
> reason.
Agreed



From dank at kegel.com  Sat Apr 19 10:58:10 2008
From: dank at kegel.com (Dan Kegel)
Date: Sat, 19 Apr 2008 08:58:10 -0700
Subject: [lostwages] update LGPL url, specify version
Message-ID: <a71bd89a0804190858x5d92bbc9i108d568e5bf03f6f@mail.gmail.com>

Somebody on wine-users asked us to clarify this, so:
-------------- next part --------------
A non-text attachment was scrubbed...
Name: license.patch
Type: text/x-patch
Size: 637 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080419/928f7507/attachment.bin 

From msclrhd at googlemail.com  Sat Apr 19 05:44:10 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Sat, 19 Apr 2008 11:44:10 +0100
Subject: [PATCH] user32: Handle VK_RETURN KeyDown events more properly in
	EDITcontrols.
In-Reply-To: <3c72a4290804182246q5fbcc0dcxa8fe0cf28af5f783@mail.gmail.com>
References: <3c72a4290804182246q5fbcc0dcxa8fe0cf28af5f783@mail.gmail.com>
Message-ID: <3f4fd2640804190344p7ef15efcgf25f3e4c0dc5129d@mail.gmail.com>

On 19/04/2008, El. <eth.bell at gmail.com> wrote:
> > "El." <elptr at users.sourceforge.net> wrote:
> >
> > > @@ -4606,6 +4606,10 @@ static LRESULT EDIT_WM_KeyDown(EDITSTATE *es, INT key)
> > >      {
> > >    HWND hwndParent = GetParent(es->hwndSelf);
> > >    DWORD dw = SendMessageW( hwndParent, DM_GETDEFID, 0, 0 );
> > > +
> > > +  if (GetClassLongW(hwndParent, GCW_ATOM) != WC_DIALOG)
> > > +      break;
> >
> > You need to add a test case first to confirm that the fix is correct, and
> > use EDIT_IsInsideDialog to detect if the parent is dialog.
>
> Well I'm not sure what to test in the first place, I didn't assume that
> modifying some aspect of the code to be in compliance with official
> "standards" required writing any test case.
>
> I might be missing what you mean by the "correctness" of the fix,
> since I'm not really familiar with Wine's patching practices.
>
> http://msdn2.microsoft.com/en-us/library/bb775464(VS.85).aspx

The MSDN documentation is a good source of information for how various
controls and APIs behave. However, this is only a starting point.

The aim of Wine is to match the behaviour of Windows, not the
documented behaviour. While the patch is likely to be correct, this is
not always the case.

The test case will be run on (and verified against) the different
versions of Windows. This will also test other things not explicitly
documented: what is the return value; is GetLastError set; what is the
sequence of messages sent in each case? All of these will add weight
to your fix.

The tests also serve another purpose. They allow the developers to
refactor, rewrite or address other issues in the code and have a
greater confidence that they haven't broken anything. If a bug is
reported and then fixed, if there isn't a valid test case for that
bug, there is a chance that the bug will reappear later on.

When you have documentation (such as MSDN) that describes behaviour
that is not supported in Wine, or differs in some way, the approach
should be to write tests to validate the documentation and then
implement it. That way, you have the verification that what you have
written is correct.

Thank you for improving Wine,
- Reece


From msclrhd at googlemail.com  Sat Apr 19 06:05:45 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Sat, 19 Apr 2008 12:05:45 +0100
Subject: [PATCH] user32: Handle VK_RETURN KeyDown events more properly in
	EDITcontrols.
In-Reply-To: <3c72a4290804182246q5fbcc0dcxa8fe0cf28af5f783@mail.gmail.com>
References: <3c72a4290804182246q5fbcc0dcxa8fe0cf28af5f783@mail.gmail.com>
Message-ID: <3f4fd2640804190405h5bedc77esf42fbdf4bb509a47@mail.gmail.com>

On 19/04/2008, El. <eth.bell at gmail.com> wrote:
> >
> > You need to add a test case first to confirm that the fix is correct, and
> > use EDIT_IsInsideDialog to detect if the parent is dialog.
>
> Well I'm not sure what to test in the first place, I didn't assume that
> modifying some aspect of the code to be in compliance with official
> "standards" required writing any test case.
>
> I might be missing what you mean by the "correctness" of the fix,
> since I'm not really familiar with Wine's patching practices.
>
> http://msdn2.microsoft.com/en-us/library/bb775464(VS.85).aspx

Reading the MSDN documentation for the behaviour of ES_MULTILINE, it
says "When the multiline edit control is in a dialog box, the default
response to pressing the ENTER key is to activate the default button.
To use the ENTER key as a carriage return, use the ES_WANTRETURN
style."

Therefore, I think your patch is incomplete, especially the part about
the ES_WANTRETURN style. As such, you will need tests to verify this.

In response to the enter key there are three behaviours:
1.  the default push button is not activated; the edit contents is unchanged.
2.  the default push button is activated; the edit contents is unchanged.
3.  the default push button is not activated; the edit contents has a
new line inserted at the current cursor position.

You have the following configurations with their associated behaviours:
  *  an edit control in a dialog without ES_MULTILINE and without
ES_WANTRETURN: behaviour (2).
  *  an edit control in a dialog with ES_MULTILINE and without
ES_WANTRETURN: behaviour (2).
  *  an edit control in a dialog with ES_MULTILINE and with
ES_WANTRETURN: behaviour (3).
  *  an edit control not in a dialog without ES_MULTILINE and without
ES_WANTRETURN: behaviour (1).
  *  an edit control not in a dialog with ES_MULTILINE and without
ES_WANTRETURN: behaviour (3).
  *  an edit control not in a dialog with ES_MULTILINE and with
ES_WANTRETURN: behaviour (3).

This is how I interpret that part of the MSDN documentation. This
gives you the test cases needed to verify that your fix works in all
these possibilities. It also ensures that someone wanting to improve
the edit control does not regress this functionality, or breaks
something else in the process.

Thank you for improving Wine,
- Reece


From hverbeet at gmail.com  Sat Apr 19 12:06:07 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Sat, 19 Apr 2008 19:06:07 +0200
Subject: WINED3D: Fix a possible null dereference (try 2)
In-Reply-To: <5f9140a20804190544s785b6d3cw8d8794ba51936c70@mail.gmail.com>
References: <5f9140a20804190544s785b6d3cw8d8794ba51936c70@mail.gmail.com>
Message-ID: <d658b69e0804191006j52909fb2h5b7ee3e3b173a676@mail.gmail.com>

On 19/04/2008, David Adam <david.adam.cnrs at gmail.com> wrote:
> This time, with tests for d3d8 and d3d9.
>
> David Adam
>

Looks mostly ok, but you do need a \n at the end of these ok messages:
> +    ok(hr == D3DERR_INVALIDCALL, "Expected D3DERR_INVALIDCALL, got %s",  DXGetErrorString8(hr));
> +    ok(hr == D3DERR_INVALIDCALL, "Expected D3DERR_INVALIDCALL, got %s",  DXGetErrorString9(hr));

> - * Copyright (C) 2006-2007 Stefan D?singer(For CodeWeavers)
> + * Copyright (C) 2006-2007 Stefan D???singer(For CodeWeavers)
Try not to change the encoding of the file.
I'm not sure if we ever considered simply using UTF-8 for source
files, but it would probably prevent some issues like this.


From thestig at google.com  Sat Apr 19 12:25:32 2008
From: thestig at google.com (Lei Zhang)
Date: Sat, 19 Apr 2008 10:25:32 -0700
Subject: [PATCH] user32: Handle VK_RETURN KeyDown events more properly in
	EDITcontrols.
In-Reply-To: <3f4fd2640804190405h5bedc77esf42fbdf4bb509a47@mail.gmail.com>
References: <3c72a4290804182246q5fbcc0dcxa8fe0cf28af5f783@mail.gmail.com>
	<3f4fd2640804190405h5bedc77esf42fbdf4bb509a47@mail.gmail.com>
Message-ID: <558b2f5c0804191025w52130288sbbffed094bc1d11a@mail.gmail.com>

On Sat, Apr 19, 2008 at 4:05 AM, Reece Dunn <msclrhd at googlemail.com> wrote:
>  Reading the MSDN documentation for the behaviour of ES_MULTILINE, it
>  says "When the multiline edit control is in a dialog box, the default
>  response to pressing the ENTER key is to activate the default button.
>  To use the ENTER key as a carriage return, use the ES_WANTRETURN
>  style."
>
>  Therefore, I think your patch is incomplete, especially the part about
>  the ES_WANTRETURN style. As such, you will need tests to verify this.
>
>  In response to the enter key there are three behaviours:
>  1.  the default push button is not activated; the edit contents is unchanged.
>  2.  the default push button is activated; the edit contents is unchanged.
>  3.  the default push button is not activated; the edit contents has a
>  new line inserted at the current cursor position.
>
>  You have the following configurations with their associated behaviours:
>   *  an edit control in a dialog without ES_MULTILINE and without
>  ES_WANTRETURN: behaviour (2).
>   *  an edit control in a dialog with ES_MULTILINE and without
>  ES_WANTRETURN: behaviour (2).
>   *  an edit control in a dialog with ES_MULTILINE and with
>  ES_WANTRETURN: behaviour (3).
>   *  an edit control not in a dialog without ES_MULTILINE and without
>  ES_WANTRETURN: behaviour (1).
>   *  an edit control not in a dialog with ES_MULTILINE and without
>  ES_WANTRETURN: behaviour (3).
>   *  an edit control not in a dialog with ES_MULTILINE and with
>  ES_WANTRETURN: behaviour (3).
>
>  This is how I interpret that part of the MSDN documentation. This
>  gives you the test cases needed to verify that your fix works in all
>  these possibilities. It also ensures that someone wanting to improve
>  the edit control does not regress this functionality, or breaks
>  something else in the process.

Edit controls get used in tons of applications, and its behavior can
be tricky to get right. Especially in the case of ES_MULTILINE without
ES_WANTRETURN. In the last two releases, I have managed to break the
edit control several times, and the thing that really helped me figure
out the proper fix is to write lots of test cases to cover as many
usage scenarios as possible.

Of course, writing tests is time consuming, and it's not always
possible to cover all the usage cases. With the native notepad bug,
it's because I didn't test the behavior when not inside a dialog box
well enough. I don't know if Reece's interpretation of MSDN is 100%
correct either, so the best thing to do is to write tests.

With regards to the patch, if EDIT_IsInsideDialog returns false, then
you don't want to send DM_GETDEFID either.


From thestig at google.com  Sat Apr 19 12:38:28 2008
From: thestig at google.com (Lei Zhang)
Date: Sat, 19 Apr 2008 10:38:28 -0700
Subject: [PATCH] user32: Handle VK_RETURN KeyDown events more properly in
	EDIT controls.
In-Reply-To: <3c72a4290804181550x5b550459o4a0a6c5b95c16962@mail.gmail.com>
References: <3c72a4290804181550x5b550459o4a0a6c5b95c16962@mail.gmail.com>
Message-ID: <558b2f5c0804191038y3db3314ew90f724ee04ccfd11@mail.gmail.com>

On Fri, Apr 18, 2008 at 3:50 PM, El. <elptr at users.sourceforge.net> wrote:
> When a ES_MULTILINE-styled EDIT responds to a VK_RETURN Key press, it should
> send a WM_COMMAND to the default control of the parent window if and only if
> that parent is a Dialog box. At least Microsoft's version of notepad.exe
> (WinXP) is fixed.
>

BTW,  bug 12478 [1] appears to be related to this.

[1] http://bugs.winehq.org/show_bug.cgi?id=12478


From dank at kegel.com  Sat Apr 19 18:48:51 2008
From: dank at kegel.com (Dan Kegel)
Date: Sat, 19 Apr 2008 16:48:51 -0700
Subject: Wine countdown?
Message-ID: <a71bd89a0804191648y4a6c2c27h4edf8129fda402b7@mail.gmail.com>

Anybody seen the nifty countdown logo that Ubuntu is using?
http://www.ubuntu.com/getubuntu/countdown
Maybe we should do something similar for Wine.

FWIW, here's a snippet that does something similar, but with text:

<h1>Wine Release Countdown</h1>
<script type='text/javascript'>
function days_between(date1, date2) {
    // The number of milliseconds in one day
    var ONE_DAY = 1000 * 60 * 60 * 24;
    // Convert both dates to milliseconds
    var date1_ms = date1.getTime();
    var date2_ms = date2.getTime();
    // Calculate the difference in milliseconds
    var difference_ms = date2_ms - date1_ms;
    // Convert back to days and return
    return Math.round(difference_ms/ONE_DAY);
}
var d = new Date();
var release = new Date();
// see http://wiki.winehq.org/WineReleasePlan
release.setTime(Date.parse("Jun 13, 2008"));

document.write('<a href="http://www.winehq.org/">Wine 1.0 countdown: '
+days_between(d, release)+' days to release!</a>');
</script>


From stefan at codeweavers.com  Sat Apr 19 22:23:03 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sun, 20 Apr 2008 05:23:03 +0200
Subject: WINED3D: Fix a possible null dereference (try 2)
In-Reply-To: <d658b69e0804191006j52909fb2h5b7ee3e3b173a676@mail.gmail.com>
References: <5f9140a20804190544s785b6d3cw8d8794ba51936c70@mail.gmail.com>
	<d658b69e0804191006j52909fb2h5b7ee3e3b173a676@mail.gmail.com>
Message-ID: <200804200523.04086.stefan@codeweavers.com>

Am Samstag, 19. April 2008 19:06:07 schrieb H. Verbeet:
> Try not to change the encoding of the file.
> I'm not sure if we ever considered simply using UTF-8 for source
> files, but it would probably prevent some issues like this.
I could change my name :-)

There was some consideration of UTF 8, but AJ says some other changes are 
needed; not sure what that was, maybe the archives know more


From dmitry at codeweavers.com  Sun Apr 20 01:10:06 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sun, 20 Apr 2008 15:10:06 +0900
Subject: kernel32: Skip the screen buffer tests if codepage 866 is
	notavailable
References: <22821af30804192159q671043aegf78d9fbcfd5cc5c8@mail.gmail.com>
Message-ID: <01b501c8a2ad$2ff9a170$a600fea9@DMITRY>

"James Hawkins" <jhawkins at codeweavers.com> wrote:

> +    res = RegOpenKeyA(HKEY_LOCAL_MACHINE,
> +                      "System\\CurrentControlSet\\Control\\Nls\\CodePage", &hkey);
> +    if (res == ERROR_SUCCESS)
> +    {
> +        len = 20;
> +        res = RegQueryValueExA(HKEY_LOCAL_MACHINE, "866", NULL,
> +                               NULL, (LPBYTE)str_buf, &len);
> +    }

Could IsValidCodePage() be used instead?

-- 
Dmitry.


From truiken at gmail.com  Sun Apr 20 01:15:37 2008
From: truiken at gmail.com (James Hawkins)
Date: Sun, 20 Apr 2008 01:15:37 -0500
Subject: kernel32: Skip the screen buffer tests if codepage 866 is
	notavailable
In-Reply-To: <01b501c8a2ad$2ff9a170$a600fea9@DMITRY>
References: <22821af30804192159q671043aegf78d9fbcfd5cc5c8@mail.gmail.com>
	<01b501c8a2ad$2ff9a170$a600fea9@DMITRY>
Message-ID: <22821af30804192315o300e39f2n899ca0efd675f95f@mail.gmail.com>

On Sun, Apr 20, 2008 at 1:10 AM, Dmitry Timoshkov
<dmitry at codeweavers.com> wrote:
> "James Hawkins" <jhawkins at codeweavers.com> wrote:
>
>
> > +    res = RegOpenKeyA(HKEY_LOCAL_MACHINE,
> > +
> "System\\CurrentControlSet\\Control\\Nls\\CodePage", &hkey);
> > +    if (res == ERROR_SUCCESS)
> > +    {
> > +        len = 20;
> > +        res = RegQueryValueExA(HKEY_LOCAL_MACHINE, "866", NULL,
> > +                               NULL, (LPBYTE)str_buf, &len);
> > +    }
> >
>
>  Could IsValidCodePage() be used instead?
>

Indeed it could.  Thanks for the tip.

-- 
James Hawkins


From dank at kegel.com  Sun Apr 20 02:45:55 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 20 Apr 2008 00:45:55 -0700
Subject: Strange struct alignment errors?
Message-ID: <a71bd89a0804200045n57eeb6d1k2abc149f0869731d@mail.gmail.com>

http://test.winehq.org/data/94883af56d7348228963d7e70a5af578310c2228/wine_xp_icc-3/ntdll:generated.txt
looks kinda funny.  Is somebody compiling the tests
wrong somehow?


From truiken at gmail.com  Sun Apr 20 02:52:32 2008
From: truiken at gmail.com (James Hawkins)
Date: Sun, 20 Apr 2008 02:52:32 -0500
Subject: Strange struct alignment errors?
In-Reply-To: <a71bd89a0804200045n57eeb6d1k2abc149f0869731d@mail.gmail.com>
References: <a71bd89a0804200045n57eeb6d1k2abc149f0869731d@mail.gmail.com>
Message-ID: <22821af30804200052y6c03c8efh8c56d22282bd0848@mail.gmail.com>

On Sun, Apr 20, 2008 at 2:45 AM, Dan Kegel <dank at kegel.com> wrote:
> http://test.winehq.org/data/94883af56d7348228963d7e70a5af578310c2228/wine_xp_icc-3/ntdll:generated.txt
>  looks kinda funny.  Is somebody compiling the tests
>  wrong somehow?
>

If the tag (wine_xp_icc-3) is any hint, the tests were compiled with
icc, which might not handle the alignment headers (#include
<pshpack2.h>) correctly.

-- 
James Hawkins


From dank at kegel.com  Sun Apr 20 02:57:24 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 20 Apr 2008 00:57:24 -0700
Subject: Strange struct alignment errors?
In-Reply-To: <22821af30804200052y6c03c8efh8c56d22282bd0848@mail.gmail.com>
References: <a71bd89a0804200045n57eeb6d1k2abc149f0869731d@mail.gmail.com>
	<22821af30804200052y6c03c8efh8c56d22282bd0848@mail.gmail.com>
Message-ID: <a71bd89a0804200057l4a91f644x45f99a17f53bcf47@mail.gmail.com>

On Sun, Apr 20, 2008 at 12:52 AM, James Hawkins <truiken at gmail.com> wrote:
>  > http://test.winehq.org/data/94883af56d7348228963d7e70a5af578310c2228/wine_xp_icc-3/ntdll:generated.txt
>
>  If the tag (wine_xp_icc-3) is any hint, the tests were compiled with
>  icc, which might not handle the alignment headers (#include
>  <pshpack2.h>) correctly.

Shoot, icc ought to be able to handle those, but
you're right, we should ignore any icc results.
Thanks for noticing that.


From dank at kegel.com  Sun Apr 20 05:13:22 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 20 Apr 2008 03:13:22 -0700
Subject: Wine 1.0 status: T minus 54 days,
	63 bugs to go. Code freeze in 12 days.
Message-ID: <a71bd89a0804200313r5f12f67dv4b3418cf45a01b3a@mail.gmail.com>

See
   http://kegel.com/wine/countdown.html
for a current (and clickable) status report.  Here's what it says now:

Wine Release Countdown
Wine 1.0 countdown: 54 days to release, 12 days to freeze!

See WineReleasePlan for details.

wine-0.9.60 was released on Friday, April 20th, 2008.

According to http://wiki.winehq.org/WineReleasePlan wine-0.9.61, due
out Friday, May 2, 2008, will be the first release candidate for 1.0,
and mark the start of the code freeze.

During the code freeze, patches that
    * are simple
    * come with a conformance test
    * fix a regression
    * are low risk
are more likely to get in than other patches. (Heck, that's always
true, but it's even truer during a freeze.) We will actively
discourage patches that might endanger the 1.0 release date (June
13th).

Bug Status

There are 63 open 1.0 bugs as of 20 April. Most of these will simply
be rolled over to be fixed for a later release; we only have time to
fix a few, and much as we'd like to fix the rest, most are not
showstoppers.

Changes since last week (with category and votes):

New (!):
12666  -unknown        0       Wine should refuse to run if pointed at
a real Windows

Fixed:
7477   -unknown        1       Uplink demo crashes
9809   shell32         4       Autodesk Revit Architecture 2008 install fails
12561   -unknown       0       Photoshop CS alt key for clone/healing
- possible regression

Duplicate:
2539   ole             3       XDND (Drag and drop for X Windows)
doesn't copy text
6607   ole             10      Drag and Drop not working

Deferred:
5541   kernel32        0       WriteConsole can't write to stdout;
affects e.g. wsh's cscript's usage message
9484   kernel32        19      Program refuses to run because of
ProtectCD/ProtectDISC copy-protection

Here's the full list of current bugs:

5055    -unknown        5       Deleting files from a window in wine
doesn't send them to the Trash
5061    -unknown        6       Copying from Windows Firefox in Wine
and pasting to Linux OpenOffice pastes metadata as data
5402    -unknown        0       Trying to run PhotoStitch 3.1
5844    -unknown        12      tray minimize
5948    -unknown        1       Star Trek: Armada does not install
7404    -unknown        3       ShowWindow(SW_MINIMIZE) should not
generate a WM_PAINT message
8125    -unknown        0       Marratech 6.1 crashes on start
9178    -unknown        8       "hello world" dos program hangs
9916    -unknown        6       "make test" usually fails
9959    -unknown        9       Make wine updates work even if the
registry changed
10815   -unknown        5       Cannot drag images into Adobe
Photoshop 7 from the web / desktop
11281   -unknown        4       CJK input many issues
12097   -unknown        3       Wine 1.0 should not ship out-of-sync
resource translations
12246   -unknown        2       "make test" gives different results
with and without warn+heap
12666   -unknown        0       Wine should refuse to run if pointed
at a real Windows
11420   advapi32        0       service control manager API problem:
name of named objects might differ (client vs. service process)
556     build-en        1       Reconcile the Windows and Wine spec files
1114    comctl32        3       Winrar2.90/3.00: Comboex doesn't
trigger a event when you mouse-click in some value of it
2493    comctl32        2       Multi-select listview: Shift-arrow up
only selects top two items
4372    comctl32        1       listview: cannot drag several items
11509   crypt32         0       Wordviewer 2003 is unable to open
documents encrypted with AES
5535    directx-        17      Planescape:Torment doesn't work
9030    directx-        0       army men hangs on black screen
11681   directx-        17      Add support for video overlay
3270    gdi32           15      Problem with minimized top-level windows
6519    gdi32           7       Wine blacks out rotated font bitmap
7571    gdi32           1       Accented character glyphs are mixed up
with TrueType fonts (affects e.g. Lotus Notes R5)
9771    gdi32           45      Steam Friends doesn't work (fails to
render correctly or refresh)
5024    kernel32        4       Thief: Deadly Shadows crashes:page
fault on read access to 0x0000040c
5351    kernel32        11      Windows Installer 3.1 cannot install
because of non-standard drive labeling
9039    kernel32        0       GS-Auftrag Professional SQL aborts on startup
7098    mscoree         1       RufzXP crashes on startup, needs
mscoree.dll.CorBindToRuntimeEx
10147   msi             1       Word Viewer 2003 - Tab behavior
differs from Windows
8783    ntdll           13      USB serial ports do not work
9356    ntdll           8       Serial communication not working since
wine-0.9.33
8095    ole             0       PQ Teaching toy crashes
9942    ole             2       Powerpoint Viewer 2007 crashes opening
.pptx files
5926    programs        1       Wine does not provide an
implementation of winhlp32.exe
5163    setupapi        13      Office XP 2002 crashes on installation
3546    shdocvw         2       CLSID_InternetShortcut not available...
6095    shdocvw         15      MOTD in counter-strike 1.6 and
counter-strike source does not render
8898    shdocvw         1       Run Time Error "445": Object doesn't
support this action in Europa Knowledgebase
9304    shdocvw         4       Temple of Elemental Evil demo doesn't
start - gui irresponsive
8439    shell32         8       Visual Studio .NET (7) install fails
10905   shell32         0       thinstall firefox demo requires native msvcrt
11742   shlwapi         9       Small .net 1.1 app (FastMD5 1.3) fails
to start up
12074   testcase        2       The conformance tests fail on Windows
6604    tools           3       Ship icons for the wine-tools that can
be used in .desktop files
664     user32          7       The help menu functionality inside
programs is broken (messaging problem)
3023    user32          6       Orcad - "Place Part" never tries to
put down a part
4523    user32          5       Can't copy from Firefox 1.5 and paste
into OpenOffice 2 under Wine
124     wineserv        2       Review of Wine Server Protocol
1990    winex11.        1       modifier keys not released when
switching desktop
2368    winex11.        7       Wine loses its X-Window when switching
to another virt. desktop in Fvwm
3297    winex11.        13      UpdateWindow() doesn't call XFlush()
5623    winex11.        4       GetAsyncKeyState wrong if querying
process doesn't have focus
5828    winex11.        25      Command and Conquer Generals (Zero
Hour) doesn't change the mouse cursor from the default X mouse
7372    winex11.        12      can't copy and paste between gnome
apps eg openoffice or gimp and wine apps such as dreamweaver or adobe
photoshop
10984   winex11.        6       sun jre 5 update 10 installer hangs in 0.9.52
11019   winex11.        4       matlab r14 and r16 (7.0.4 and 7.3.0)
and WriteItNow3.1.0s hang if X in 24bpp mode
5625    wininet         4       Wine does not handle internet proxy
settings conveniently
9787    winsock         50      Warcraft3 Battle.net Doesn't work
(Needs AcceptEx)
12005   wintab32        1       Regression in pressure sensitivity
with wizardpen tablet driver and Photoshop 7


From tehblunderbuss at gmail.com  Sun Apr 20 09:52:52 2008
From: tehblunderbuss at gmail.com (TheBlunderbuss)
Date: Sun, 20 Apr 2008 09:52:52 -0500
Subject: Wine countdown?
In-Reply-To: <a71bd89a0804191648y4a6c2c27h4edf8129fda402b7@mail.gmail.com>
References: <a71bd89a0804191648y4a6c2c27h4edf8129fda402b7@mail.gmail.com>
Message-ID: <480B58C4.5090500@gmail.com>

Dan Kegel wrote:
> Anybody seen the nifty countdown logo that Ubuntu is using?
> http://www.ubuntu.com/getubuntu/countdown
> Maybe we should do something similar for Wine.
Yes we should!


From dank at kegel.com  Sun Apr 20 15:49:23 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 20 Apr 2008 13:49:23 -0700
Subject: MSIME support causing slow setup until explorer.exe paused?
Message-ID: <a71bd89a0804201349v6f827eb7ke6a7717ea3c7fdda@mail.gmail.com>

I tried installing StarUML (after doing winetricks vcrun6 msxml3, as required),
and the setup crept along very slowly... so I got curious and ran top.
Most of the cpu time was being used by Explorer and wineserver,
and interestingly, if I suspended Explorer by doing
  strace -p <pid of explorer>
and then pressing ^S, the install ran awful darn fast.

So, what was explorer doing that was slowing things down so much?

writev(3, [{"l\0\0\0\30\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"...,
64}, {"M\0S\0I\0M\0E\0S\0e\0r\0v\0i\0c\0e\0", 24}], 2) = 88
...
writev(3, [{"l\0\0\0*\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"...,
64}, {"M\0S\0I\0M\0E\0R\0e\0c\0o\0n\0v\0e\0r\0t\0O\0p\0"..., 42}], 2)
= 106
...
writev(3, [{"l\0\0\0&\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"...,
64}, {"M\0S\0I\0M\0E\0M\0o\0u\0s\0e\0O\0p\0e\0r\0a\0t\0"..., 38}], 2)
= 102
...
writev(3, [{"l\0\0\0*\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"...,
64}, {"M\0S\0I\0M\0E\0R\0e\0c\0o\0n\0v\0e\0r\0t\0R\0e\0"..., 42}], 2)
= 106
...

This persisted in the app, too, not just in the installer.

So it kind of sounds like our msime support is hurting us performance-wise?
- Dan


From dank at kegel.com  Sun Apr 20 18:04:51 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 20 Apr 2008 16:04:51 -0700
Subject: Regressions: the enemy of 1.0
Message-ID: <a71bd89a0804201604h20314163mc0b84437a45b269c@mail.gmail.com>

There's been lots of progress in Wine lately; many
important applications work better than ever.
But the inevitable cost of such progress is that
some applications are now broken and/or
wine has odd problems.

For instance, as of the last two versions of Wine,
StarUML can't be unminimized
( http://bugs.winehq.org/show_bug.cgi?id=12697 ),
and as of 0.9.60, the IME support seems to be
making wine apps run dog slow on at least one
of my machines
( http://www.winehq.org/pipermail/wine-devel/2008-April/064999.html ).
These seem like regressions that ought to be fixed
before 1.0.

So... I guess my point is: the code freeze is starting soon,
which is good; that will help coax developers into looking
for and fixing recently introduced bugs rather than old ones.
i.e. fight to hang on to what we've got (or had recently)
rather than pushing to conquer new ground.

Those who absolutely have to work on risky new stuff
in the meantime will increasingly have to keep their
work outside the main tree for now.
Once 1.0 is out, those patches can land, and
the fight for new ground can resume.


From wine-devel at kievinfo.com  Sun Apr 20 19:02:08 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sun, 20 Apr 2008 18:02:08 -0600
Subject: [1/4] dinput: Return error for unknown property.
In-Reply-To: <480BC94D.2080006@gmail.com>
References: <480BC94D.2080006@gmail.com>
Message-ID: <480BD980.1000605@kievinfo.com>

Sergey Khodych wrote:
> 
> 
> -            WARN("Unknown property %s\n", debugstr_guid(rguid));
> -            break;
> +            FIXME("Unknown property %s\n", debugstr_guid(rguid));
> +            return DIERR_UNSUPPORTED;
I'd like to see tests for this. Also lots of programs will break because 
they won't get some not significant property. No short - don't do this.

Vitaliy


From wine-devel at kievinfo.com  Sun Apr 20 20:16:13 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sun, 20 Apr 2008 19:16:13 -0600
Subject: [4/4] Add test for IDirectInputDevice_GetProperty of keyboard
	device   for unicode and ascii case.
In-Reply-To: <480BC96F.3040900@gmail.com>
References: <480BC96F.3040900@gmail.com>
Message-ID: <480BEADD.3040904@kievinfo.com>

Sergey Khodych wrote:
> 
> 
> ------------------------------------------------------------------------
> 
> 

> +    result =  wcsncmp( dipsw.wsz, dipsa.wsz, sizeof( dipsw.wsz )/sizeof( dipsw.wsz[0] ) );
UNIX unicode and windows unicode are two separate things. Don't use 
functions that work with wchar_t - they are not compatible with Wine. Use 
Wine's own unicode functions instead. For example here you can use lstrcmpW().

Vitaliy.


From winehacker at gmail.com  Sun Apr 20 23:00:24 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Mon, 21 Apr 2008 00:00:24 -0400
Subject: Regressions: the enemy of 1.0
In-Reply-To: <a71bd89a0804201604h20314163mc0b84437a45b269c@mail.gmail.com>
References: <a71bd89a0804201604h20314163mc0b84437a45b269c@mail.gmail.com>
Message-ID: <19e31a080804202100t27d440e6w732c296bbae0074a@mail.gmail.com>

On Sun, Apr 20, 2008 at 7:04 PM, Dan Kegel <dank at kegel.com> wrote:
> There's been lots of progress in Wine lately; many
>  important applications work better than ever.
>  But the inevitable cost of such progress is that
>  some applications are now broken and/or
>  wine has odd problems.

Yes Office 2000/XP installs have totally regressed recently. While
great improvements have been made for Photoshop and newer Office
versions, it is frustrating that we are so close to Wine 1.0 and it
might not even be able to install Office 2000.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From m.b.lankhorst at gmail.com  Sun Apr 20 23:41:05 2008
From: m.b.lankhorst at gmail.com (Maarten Lankhorst)
Date: Sun, 20 Apr 2008 21:41:05 -0700
Subject: Regressions: the enemy of 1.0
In-Reply-To: <a71bd89a0804201604h20314163mc0b84437a45b269c@mail.gmail.com>
References: <a71bd89a0804201604h20314163mc0b84437a45b269c@mail.gmail.com>
Message-ID: <b130c85e0804202141v18ce9335geba9f7186fa3e4a2@mail.gmail.com>

Hi Dan,

2008/4/20, Dan Kegel <dank at kegel.com>:
> There's been lots of progress in Wine lately; many
>  important applications work better than ever.
>  But the inevitable cost of such progress is that
>  some applications are now broken and/or
>  wine has odd problems.
>
>  For instance, as of the last two versions of Wine,
>  StarUML can't be unminimized
>  ( http://bugs.winehq.org/show_bug.cgi?id=12697 ),
>  and as of 0.9.60, the IME support seems to be
>  making wine apps run dog slow on at least one
>  of my machines
>  ( http://www.winehq.org/pipermail/wine-devel/2008-April/064999.html ).
>  These seem like regressions that ought to be fixed
>  before 1.0.
Worse still, after all of the work I've done on getting most tests
running there have been 3 new failures in make test:

setupapi/devinst.ok
devinst.c:831: Test failed: SetupDiEnumDeviceInterfaces failed: 00000103
devinst.c:850: Test failed: Unexpected path ?
devinst.c:920: Test failed: Expected ERROR_INVALID_DATA, got deadbeef
devinst.c:925: Test failed: Expected ERROR_INSUFFICIENT_BUFFER, got deadbeef
devinst.c:1013: Test failed: Expected ERROR_INVALID_DATA, got deadbeef
devinst.c:1018: Test failed: Expected ERROR_INSUFFICIENT_BUFFER, got deadbeef
msxml3/domdoc.ok
domdoc.c:2323: Test failed: ret 80004005
domdoc.c:2327: Test failed: incorrect get_text string
mshtml/dom.ok
dom.c:1048: Test failed: Could not get
{3050F4AE-98B5-11CF-BB82-00AA00BDCE0B} interface: 80004002

Is anyone working in these areas willing to look into the test failures?

Cheers,

Maarten.

From dmitry at codeweavers.com  Mon Apr 21 01:06:55 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Mon, 21 Apr 2008 15:06:55 +0900
Subject: user32: Use the PostMessage() for WM_IME_KEY{DOWN|UP} message
References: <1208754207.10521.4.camel@localhost>
Message-ID: <038001c8a375$e8b4e710$a600fea9@DMITRY>

"ByeongSik Jeon" <bsjeon at hanmail.net> wrote:

> * MS Spi++ test result, PostMessage is right.
> * Message generation sequence:
>   WM_IME_KEYDOWN -> WM_KEYDOWN -> WM_CHAR
>   WM_CHAR is genetated in the TranslateMessage() when we use
>   PostMessage() function.
> * Real case: MS IME 2002, MS IME 2003, Saenaru
>   In the preedit mode, when we press the "ENTER" key, Korean
>   Native IME generate the WM_IME_KEYDOWN(wParam==VK_RETURN) message.
>   This message is translated to the WM_CHAR(wParam==VK_RETURN)
>   message finally.

You should add the tests to dlls/user32/tests/msg.c for the above changes.

-- 
Dmitry.


From mle+win at mega-nerd.com  Mon Apr 21 02:16:03 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Mon, 21 Apr 2008 17:16:03 +1000
Subject: Wine64?
Message-ID: <20080421171603.8ea1aa71.mle+win@mega-nerd.com>

Hi all,

I'm interested in the current state of work towards Wine64, ie
running Win64 binaries on x86_64 Linux machines.

My needs are actually really simple and hence may be a good base
functionality to work towards. I just need to run Win64 binaries
that read stdin, write stdout/stderr and do file I/O using the
standard windows CreateFile/ReadFile/WriteFile/CloseHandle/
SetFilePointer etc functions.

I have found and read this:

    http://wiki.winehq.org/Wine64

but some of that stuff seems rather out-of-date.

When I configure with --enable-win64 it configures fine but then
errors out in widl generated code because of things like this:

    #if !defined(__RPC_WIN32__)
    #error Currently only Wine and WIN32 are supported.
    #endif

So, is anybody working on Wine64 stuff? Is there a Wine64 TODO list?
Any way for me to get involved?

Cheers,
Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
"If you have one apple and I have one apple, if we exchange, each will
have one apple. If you have one idea and i have one idea, if we exchange
them, each will have two ideas!" -- Attributed to George Bernard Shaw


From ivan at etersoft.ru  Mon Apr 21 03:29:35 2008
From: ivan at etersoft.ru (Ivan Sinitsin)
Date: Mon, 21 Apr 2008 12:29:35 +0400
Subject: Question about openning html document in new window
Message-ID: <200804211229.35940.ivan@etersoft.ru>

Hello, I have a question.

I make a patch, that fix problem with open html document in new window. I 
tested it on "MyIE 2" and it works. But I am not assured, whether it is 
possible to solve a problem in this way.

What do you think about it?

-- 
Sinitsin Ivan
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dlls-shdoxvw-navigate.c
Type: text/x-csrc
Size: 830 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080421/e3ef9af3/attachment.c 

From astrand at cendio.se  Mon Apr 21 03:54:07 2008
From: astrand at cendio.se (=?UTF-8?Q?Peter_=C3=85strand?=)
Date: Mon, 21 Apr 2008 10:54:07 +0200 (CEST)
Subject: winmm/tests: waveOutGetDevCaps called with invalid size
In-Reply-To: <4808B145.2010609@earthlink.net>
References: <Pine.LNX.4.64.0804181102080.23847@maggie.lkpg.cendio.se>
	<4808B145.2010609@earthlink.net>
Message-ID: <Pine.LNX.4.64.0804211050260.12791@maggie.lkpg.cendio.se>

On Fri, 18 Apr 2008, Robert Reif wrote:

> > -    rc=waveOutGetDevCapsA(device,&capsA,4);
> > +    /* Final call must succeed, capsA will be used below */
> > +    rc=waveOutGetDevCapsA(device,&capsA,sizeof(capsA));
> >      ok(rc==MMSYSERR_NOERROR,
> >         "waveOutGetDevCapsA(%s): MMSYSERR_NOERROR expected, got %s\n",
> >         dev_name(device),wave_out_error(rc));
> > -
> > -    rc=waveOutGetDevCapsW(device,&capsW,4);
> > -    ok(rc==MMSYSERR_NOERROR || rc==MMSYSERR_NOTSUPPORTED,
> > -       "waveOutGetDevCapsW(%s): MMSYSERR_NOERROR or MMSYSERR_NOTSUPPORTED "
> > -       "expected, got %s\n",dev_name(device),wave_out_error(rc));
> > +    if (rc!=MMSYSERR_NOERROR)
> > +	return;


> That's the whole point of the test, to check what happens with an invalid
> argument.

So what do you think *should* happen with an invalid argument? The result 
is different on different Windows platforms. The behaviour is not 
specified by MSDN. 

In any case, continuing and executing code that uses "capsA" even though 
the waveOutGetDevCapsA call failed is definitely wrong. 

 
Rgds, 
---
Peter ?strand		ThinLinc Chief Developer
Cendio AB		http://www.cendio.se
Wallenbergs gata 4
583 30 Link?ping	Phone: +46-13-21 46 00

From julliard at winehq.org  Mon Apr 21 05:36:33 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 21 Apr 2008 12:36:33 +0200
Subject: [PATCH 09/17] widl: Split the expr rule up into multiple rules to
	fix operator precedence.
In-Reply-To: <480BB2A5.6050609@codeweavers.com> (Robert Shearman's message of
	"Sun, 20 Apr 2008 22:16:21 +0100")
References: <480BB2A5.6050609@codeweavers.com>
Message-ID: <87prsj4hqm.fsf@wine.dyndns.org>

Robert Shearman <rob at codeweavers.com> writes:

> @@ -263,8 +263,14 @@ static void add_explicit_handle_if_necessary(func_t *func);
>  %type <attr> attribute
>  %type <attr_list> m_attributes attributes attrib_list
>  %type <str_list> str_list
> -%type <expr> m_expr expr expr_const
> -%type <expr_list> m_exprs /* exprs expr_list */ expr_list_const
> +%type <expr> m_expr expr_const expression conditional_expression
> +%type <expr> conditional_expression logical_OR_expression logical_AND_expression
> +%type <expr> inclusive_OR_expression exclusive_OR_expression AND_expression
> +%type <expr> equality_expression relational_expression shift_expression
> +%type <expr> additive_expression additive_expression multiplicative_expression
> +%type <expr> cast_expression unary_expression postfix_expression
> +%type <expr> primary_expression
> +%type <expr_list> m_exprs expr_list_const
>  %type <array_dims> array array_list
>  %type <ifinfo> interfacehdr
>  %type <type> inherit interface interfacedef interfacedec

You shouldn't need that, the %left/%right declarations should define the
correct precedence already. Why doesn't this work for you?

-- 
Alexandre Julliard
julliard at winehq.org


From aric at codeweavers.com  Mon Apr 21 07:12:49 2008
From: aric at codeweavers.com (Aric Stewart)
Date: Mon, 21 Apr 2008 07:12:49 -0500
Subject: MSIME support causing slow setup until explorer.exe paused?
In-Reply-To: <a71bd89a0804201349v6f827eb7ke6a7717ea3c7fdda@mail.gmail.com>
References: <a71bd89a0804201349v6f827eb7ke6a7717ea3c7fdda@mail.gmail.com>
Message-ID: <480C84C1.80003@codeweavers.com>

Humm,

   MSIMEService, MSIMEReconvertOptions, MSIMEMouseOperator, etc... those 
are all Messages that Microsoft Office looks for and sends to the IME 
during operations.  For the most part all those messages are just stubbed.

   The messages are Registered in Imm32/imm.c once per process, and also 
registered in winex11.drv/ime.c also once per process. I am pretty sure 
we do not send those messages somewhere. So I am not sure why they would 
be taking up so much cpu time.

Do you know what is happening with the messages during the slow-down?
thanks,
-aric


Dan Kegel wrote:
> I tried installing StarUML (after doing winetricks vcrun6 msxml3, as required),
> and the setup crept along very slowly... so I got curious and ran top.
> Most of the cpu time was being used by Explorer and wineserver,
> and interestingly, if I suspended Explorer by doing
>   strace -p <pid of explorer>
> and then pressing ^S, the install ran awful darn fast.
> 
> So, what was explorer doing that was slowing things down so much?
> 
> writev(3, [{"l\0\0\0\30\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"...,
> 64}, {"M\0S\0I\0M\0E\0S\0e\0r\0v\0i\0c\0e\0", 24}], 2) = 88
> ...
> writev(3, [{"l\0\0\0*\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"...,
> 64}, {"M\0S\0I\0M\0E\0R\0e\0c\0o\0n\0v\0e\0r\0t\0O\0p\0"..., 42}], 2)
> = 106
> ...
> writev(3, [{"l\0\0\0&\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"...,
> 64}, {"M\0S\0I\0M\0E\0M\0o\0u\0s\0e\0O\0p\0e\0r\0a\0t\0"..., 38}], 2)
> = 102
> ...
> writev(3, [{"l\0\0\0*\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"...,
> 64}, {"M\0S\0I\0M\0E\0R\0e\0c\0o\0n\0v\0e\0r\0t\0R\0e\0"..., 42}], 2)
> = 106
> ...
> 
> This persisted in the app, too, not just in the installer.
> 
> So it kind of sounds like our msime support is hurting us performance-wise?
> - Dan
> 
> 


From aric at codeweavers.com  Mon Apr 21 07:17:19 2008
From: aric at codeweavers.com (Aric Stewart)
Date: Mon, 21 Apr 2008 07:17:19 -0500
Subject: imm32: Fix a test that fails on all systems
In-Reply-To: <22821af30804201849h426d63ffu7a13b02bb0a4e265@mail.gmail.com>
References: <22821af30804201849h426d63ffu7a13b02bb0a4e265@mail.gmail.com>
Message-ID: <480C85CF.9040703@codeweavers.com>

Are this tests failing on windows?

When I did my recent IME work I was working to make sure that these 
tests succeeded at that time.

have they started failing on wine as well?

thanks,
-aric


James Hawkins wrote:
> Hi,
> 
> Changelog:
> * Fix a test that fails on all systems.
> 
>  dlls/imm32/tests/imm32.c |   30 +++++++++++++++++++++---------
>  1 files changed, 21 insertions(+), 9 deletions(-)
> 
> 
> 
> ------------------------------------------------------------------------
> 
> 


From rob at codeweavers.com  Mon Apr 21 08:33:20 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Mon, 21 Apr 2008 14:33:20 +0100
Subject: [PATCH 09/17] widl: Split the expr rule up into multiple rules
	to fix operator precedence.
In-Reply-To: <87prsj4hqm.fsf@wine.dyndns.org>
References: <480BB2A5.6050609@codeweavers.com> <87prsj4hqm.fsf@wine.dyndns.org>
Message-ID: <480C97A0.7020706@codeweavers.com>

Alexandre Julliard wrote:
> You shouldn't need that, the %left/%right declarations should define the
> correct precedence already. Why doesn't this work for you?

I was attempting to fix the attached case. The result of the expression 
evaluation can be seen in the generated _c.c file by searching for "/* 
Corr desc:  constant, val=".

I see that the issue is that the %left and %right declarations aren't in 
the correct order (and some aren't grouped properly either).

So this bug can indeed be fixed without splitting up expr into multiple 
rules.

-- 
Rob Shearman

-------------- next part --------------
A non-text attachment was scrubbed...
Name: expr_test.idl
Type: text/x-idl
Size: 192 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080421/c7cc0d4e/attachment.bin 

From truiken at gmail.com  Mon Apr 21 09:11:01 2008
From: truiken at gmail.com (James Hawkins)
Date: Mon, 21 Apr 2008 09:11:01 -0500
Subject: imm32: Fix a test that fails on all systems
In-Reply-To: <480C85CF.9040703@codeweavers.com>
References: <22821af30804201849h426d63ffu7a13b02bb0a4e265@mail.gmail.com>
	<480C85CF.9040703@codeweavers.com>
Message-ID: <22821af30804210711i3fa4e5bevaff564b2e14db86a@mail.gmail.com>

On Mon, Apr 21, 2008 at 7:17 AM, Aric Stewart <aric at codeweavers.com> wrote:
> Are this tests failing on windows?
>
>  When I did my recent IME work I was working to make sure that these tests
> succeeded at that time.
>
>  have they started failing on wine as well?
>

Yes, they fail on all versions:

http://test.winehq.org/data/200804191000/

Well, they 'pass' on wine, but that doesn't match the behavior of
native windows.

-- 
James Hawkins


From julliard at winehq.org  Mon Apr 21 09:53:18 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 21 Apr 2008 16:53:18 +0200
Subject: msxml3: Correct transformNode from failing on windows
In-Reply-To: <fueho1$j8r$1@ger.gmane.org> (Alistair Leslie-Hughes's message of
	"Sun, 20 Apr 2008 14:43:33 +1000")
References: <fueho1$j8r$1@ger.gmane.org>
Message-ID: <87fxtf45up.fsf@wine.dyndns.org>

Alistair Leslie-Hughes <leslie_alistair at hotmail.com> writes:

> diff --git a/dlls/msxml3/tests/domdoc.c b/dlls/msxml3/tests/domdoc.c
> index 6f790fe..b06e57e 100644
> --- a/dlls/msxml3/tests/domdoc.c
> +++ b/dlls/msxml3/tests/domdoc.c
> @@ -143,7 +143,11 @@ static  const CHAR szTransformSSXML[] =
>  "</xsl:stylesheet>";
>  
>  static  const CHAR szTransformOutput[] =
> -"<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n"
> +"<html>\r\n<body>\r\n<h1>\r\n"
> +"Hello World\r\n"
> +"</h1>\r\n</body>\r\n</html>\r\n";
> +
> +static  const CHAR szTransformOutputWine[] =
>  "<html><body><h1>\n"
>  "Hello World\n"
>  "</h1></body></html>\n";
> @@ -3193,7 +3197,8 @@ static void test_testTransforms(void)
>  
>          hr = IXMLDOMDocument_transformNode(doc, pNode, &bOut);
>          ok(hr == S_OK, "ret %08x\n", hr );
> -        ok( !lstrcmpW( bOut, _bstr_(szTransformOutput) ), "Stylesheet output not correct\n");
> +        ok( !lstrcmpW( bOut, _bstr_(szTransformOutput)) ||  /* Windows */
> +            !lstrcmpW( bOut, _bstr_(szTransformOutputWine)) /* Wine */, "Stylesheet output not correct\n");

You shouldn't need a special case for Wine. What you need is a smarter
comparison function that ignores EOL characters.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Mon Apr 21 09:58:33 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 21 Apr 2008 16:58:33 +0200
Subject: gdi32: Make the bitmap test pass under Windows 2000
In-Reply-To: <E1JnqOS-0007lR-Gp@mail.codeweavers.com> (Dmitry Timoshkov's
	message of "Mon, 21 Apr 2008 16:24:58 +0900")
References: <E1JnqOS-0007lR-Gp@mail.codeweavers.com>
Message-ID: <87bq4345ly.fsf@wine.dyndns.org>

Dmitry Timoshkov <dmitry at codeweavers.com> writes:

> @@ -967,15 +970,19 @@ static void test_bitmap(void)
>      hdc = CreateCompatibleDC(0);
>      assert(hdc != 0);
>  
> +if (0)
> +{   /* this test fails under Win2k */
>      SetLastError(0xdeadbeef);
>      hbmp = CreateBitmap(0x7ffffff, 1, 1, 1, NULL);
>      ok(hbmp != 0, "CreateBitmap should not fail\n");
>      DeleteObject(hbmp);
> +}

It would be better to find values that work on all platforms, instead of
disabling the test completely.

-- 
Alexandre Julliard
julliard at winehq.org


From stefandoesinger at gmx.at  Mon Apr 21 10:00:04 2008
From: stefandoesinger at gmx.at (Stefan =?utf-8?q?D=C3=B6singer?=)
Date: Mon, 21 Apr 2008 17:00:04 +0200
Subject: Some XDC update
Message-ID: <200804211700.04680.stefandoesinger@gmx.at>

Hi,

Here's a short summary of the wine-related things that were going on on XDC:

-> Mouse input: Daniel Stone will take care of that. He says DGA would give us 
what we want, but recommends not to use it. He is working on extending 
XInput(or making a new XI2) which can report relative mouse movements. The X 
people want to phase out DGA. Some games use it for relative input, so 
they'll make a DGA emulation layered on the new XInput stuff. He will need 
debugging / testing help from us since Wine will most likely be the only App 
making use of that directly. Also we should not hold our breath, he has some 
other items on his TODO list, but the end of 2008 is a plausible ETA.

-> Tablets: Config issue is known and being worked on

-> Graphics, general: The Mesa and ATI people are willing to help out with our 
issues. I talked to Aaron Plattner and Pierre ? from Nvidia, and 
they know the issues and worked on some extensions for that internally some 
time ago, but then decided that they're not going to implement that for some 
reason they didn't tell me(I hope they re-consider that now that someone is 
asking for it though). The ATI guys warned me that it might take a while 
until any new extensions are available in production drivers, but that's  
something we have to put up with I guess. Also both the ATI and Mesa people  
like the idea of using our conformance tests for their driver testing and  
debugging. The Nvidia guys offered help with the multithreading crashes and  
the 32 vs 40 varying issue.
(I also talked to Ben Byer from Apple, but he's not in charge of the graphics 
drivers)

-> Graphics: Flat shading: Picking that as a first case for working on an 
extension. Should be fairly easy to implement in Mesa since all cards have a 
specific register for exactly that issue.

-> Graphics, multithreading: general agreement that what we are doing is 
correct, and driver bugs need fixing. It looks like the crash in fglrx will be 
fixed soon(my test app worked in Matthew's development driver). For the 
Nvidia issues I'll file a bugreport as soon as I know if the glxSwapBuffers 
crash is a driver or Gentoo bug)

-> Graphics, sRGB blending: Everyone believes me that our emulation is 
slow("pow() - uh oh, don't use that, that's not parallelizeable"[Keith 
Packard]). The nvidia people are aware of the issue, but a fix is also 
unlikely. The ATI people aren't sure if their dx9 hardware supports sRGB 
writing, maybe the windows driver is emulating things as well - have to check

-> Graphics, GLSL issues: MOVA and LIT, possibly extensions for that.

-> Graphics, Hacks: Both the ATI and Nvidia developers warned me that their 
Windows drivers have a huge per-application bug workaround database. Aaron 
was pretty impressed that Wine doesn't have any app-specific hacks. I am 
afraid we will need them, as some apps seem to expect different behavior that 
our d3d9 tests get. I think the best way is to fetch some information about 
the Windows driver hacks and write tests which trigger them to show 
that "hl2.exe" gets different driver behavior than "d3d9_test.exe"(or in 
whatever way things work)


From dmitry at codeweavers.com  Mon Apr 21 10:06:42 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Tue, 22 Apr 2008 00:06:42 +0900
Subject: gdi32: Make the bitmap test pass under Windows 2000
References: <E1JnqOS-0007lR-Gp@mail.codeweavers.com>
	<87bq4345ly.fsf@wine.dyndns.org>
Message-ID: <018001c8a3c1$50d410f0$a600fea9@DMITRY>

"Alexandre Julliard" <julliard at winehq.org> wrote:

>> @@ -967,15 +970,19 @@ static void test_bitmap(void)
>>      hdc = CreateCompatibleDC(0);
>>      assert(hdc != 0);
>>  
>> +if (0)
>> +{   /* this test fails under Win2k */
>>      SetLastError(0xdeadbeef);
>>      hbmp = CreateBitmap(0x7ffffff, 1, 1, 1, NULL);
>>      ok(hbmp != 0, "CreateBitmap should not fail\n");
>>      DeleteObject(hbmp);
>> +}
> 
> It would be better to find values that work on all platforms, instead of
> disabling the test completely.

Yes, it would be better, but unfortunately I don't have windows 2000
installed around.

-- 
Dmitry.


From dmitry at codeweavers.com  Mon Apr 21 10:20:38 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Tue, 22 Apr 2008 00:20:38 +0900
Subject: gdi32: Make the bitmap test pass under Windows 2000
References: <E1JnqOS-0007lR-Gp@mail.codeweavers.com>	<87bq4345ly.fsf@wine.dyndns.org>
	<018001c8a3c1$50d410f0$a600fea9@DMITRY>
	<480CAF6D.7000007@gmail.com>
Message-ID: <01b101c8a3c3$43e1f090$a600fea9@DMITRY>

"Paul Vriens" <paul.vriens.wine at gmail.com> wrote:

>>>> +if (0)
>>>> +{   /* this test fails under Win2k */
>>>>      SetLastError(0xdeadbeef);
>>>>      hbmp = CreateBitmap(0x7ffffff, 1, 1, 1, NULL);
>>>>      ok(hbmp != 0, "CreateBitmap should not fail\n");
>>>>      DeleteObject(hbmp);
>>>> +}
>>> It would be better to find values that work on all platforms, instead of
>>> disabling the test completely.
>> 
>> Yes, it would be better, but unfortunately I don't have windows 2000
>> installed around.
>> 
> If you need me to test something on a Win2K box (Vmware) just shout.

We need to know what bitmap size is acceptable for CreateBitmap, so
basically experimenting with first 2 parameters in the above test
should answer that.

-- 
Dmitry.


From paul.vriens.wine at gmail.com  Mon Apr 21 10:27:25 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Mon, 21 Apr 2008 17:27:25 +0200
Subject: gdi32: Make the bitmap test pass under Windows 2000
In-Reply-To: <01b101c8a3c3$43e1f090$a600fea9@DMITRY>
References: <E1JnqOS-0007lR-Gp@mail.codeweavers.com>	<87bq4345ly.fsf@wine.dyndns.org>
	<018001c8a3c1$50d410f0$a600fea9@DMITRY>
	<480CAF6D.7000007@gmail.com>
	<01b101c8a3c3$43e1f090$a600fea9@DMITRY>
Message-ID: <480CB25D.1090509@gmail.com>

Dmitry Timoshkov wrote:
> "Paul Vriens" <paul.vriens.wine at gmail.com> wrote:
> 
>>>>> +if (0)
>>>>> +{   /* this test fails under Win2k */
>>>>>      SetLastError(0xdeadbeef);
>>>>>      hbmp = CreateBitmap(0x7ffffff, 1, 1, 1, NULL);
>>>>>      ok(hbmp != 0, "CreateBitmap should not fail\n");
>>>>>      DeleteObject(hbmp);
>>>>> +}
>>>> It would be better to find values that work on all platforms, 
>>>> instead of
>>>> disabling the test completely.
>>>
>>> Yes, it would be better, but unfortunately I don't have windows 2000
>>> installed around.
>>>
>> If you need me to test something on a Win2K box (Vmware) just shout.
> 
> We need to know what bitmap size is acceptable for CreateBitmap, so
> basically experimenting with first 2 parameters in the above test
> should answer that.
> 
OK, no problem but I can't do that right now. Will have to wait a few hours.

Is there a specific combination you are looking for? Huge width, small height? 
Or the maximum size possible?

-- 
Cheers,

Paul.


From paul.vriens.wine at gmail.com  Mon Apr 21 10:14:53 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Mon, 21 Apr 2008 17:14:53 +0200
Subject: gdi32: Make the bitmap test pass under Windows 2000
In-Reply-To: <018001c8a3c1$50d410f0$a600fea9@DMITRY>
References: <E1JnqOS-0007lR-Gp@mail.codeweavers.com>	<87bq4345ly.fsf@wine.dyndns.org>
	<018001c8a3c1$50d410f0$a600fea9@DMITRY>
Message-ID: <480CAF6D.7000007@gmail.com>

Dmitry Timoshkov wrote:
> "Alexandre Julliard" <julliard at winehq.org> wrote:
> 
>>> @@ -967,15 +970,19 @@ static void test_bitmap(void)
>>>      hdc = CreateCompatibleDC(0);
>>>      assert(hdc != 0);
>>>  
>>> +if (0)
>>> +{   /* this test fails under Win2k */
>>>      SetLastError(0xdeadbeef);
>>>      hbmp = CreateBitmap(0x7ffffff, 1, 1, 1, NULL);
>>>      ok(hbmp != 0, "CreateBitmap should not fail\n");
>>>      DeleteObject(hbmp);
>>> +}
>> It would be better to find values that work on all platforms, instead of
>> disabling the test completely.
> 
> Yes, it would be better, but unfortunately I don't have windows 2000
> installed around.
> 
If you need me to test something on a Win2K box (Vmware) just shout.

-- 
Cheers,

Paul.


From dmitry at codeweavers.com  Mon Apr 21 10:40:25 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Tue, 22 Apr 2008 00:40:25 +0900
Subject: gdi32: Make the bitmap test pass under Windows 2000
References: <E1JnqOS-0007lR-Gp@mail.codeweavers.com>	<87bq4345ly.fsf@wine.dyndns.org><018001c8a3c1$50d410f0$a600fea9@DMITRY><480CAF6D.7000007@gmail.com><01b101c8a3c3$43e1f090$a600fea9@DMITRY>
	<480CB25D.1090509@gmail.com>
Message-ID: <020101c8a3c6$05f16f60$a600fea9@DMITRY>

"Paul Vriens" <paul.vriens.wine at gmail.com> wrote:

> Is there a specific combination you are looking for? Huge width, small height?

Anything you could test that will lead to a reasonable conclusion.

> Or the maximum size possible?

At least we need to know this one.

-- 
Dmitry.


From stefan at codeweavers.com  Mon Apr 21 11:25:46 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Mon, 21 Apr 2008 18:25:46 +0200
Subject: Some XDC update
In-Reply-To: <200804211700.04680.stefandoesinger@gmx.at>
References: <200804211700.04680.stefandoesinger@gmx.at>
Message-ID: <200804211825.46857.stefan@codeweavers.com>

Am Montag, 21. April 2008 17:00:04 schrieb Stefan D?singer:
> I talked to Aaron Plattner and Pierre ?
I forgot to look up the name: Pierre-Loup Griffais was it, if I am not 
mistaken


From austinenglish at gmail.com  Mon Apr 21 11:47:44 2008
From: austinenglish at gmail.com (Austin English)
Date: Mon, 21 Apr 2008 11:47:44 -0500
Subject: gdi32: Make the bitmap test pass under Windows 2000
In-Reply-To: <018001c8a3c1$50d410f0$a600fea9@DMITRY>
References: <E1JnqOS-0007lR-Gp@mail.codeweavers.com>
	<87bq4345ly.fsf@wine.dyndns.org>
	<018001c8a3c1$50d410f0$a600fea9@DMITRY>
Message-ID: <b6bb06270804210947k753c7129iec9655105cb64e3a@mail.gmail.com>

On Mon, Apr 21, 2008 at 10:06 AM, Dmitry Timoshkov <dmitry at codeweavers.com>
wrote:

> "Alexandre Julliard" <julliard at winehq.org> wrote:
>
> >> @@ -967,15 +970,19 @@ static void test_bitmap(void)
> >>      hdc = CreateCompatibleDC(0);
> >>      assert(hdc != 0);
> >>
> >> +if (0)
> >> +{   /* this test fails under Win2k */
> >>      SetLastError(0xdeadbeef);
> >>      hbmp = CreateBitmap(0x7ffffff, 1, 1, 1, NULL);
> >>      ok(hbmp != 0, "CreateBitmap should not fail\n");
> >>      DeleteObject(hbmp);
> >> +}
> >
> > It would be better to find values that work on all platforms, instead of
> > disabling the test completely.
>
> Yes, it would be better, but unfortunately I don't have windows 2000
> installed around.
>
> --
> Dmitry.
>
>
> I've got about 6 2k boxes lying around at work I can test on...
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080421/d9038bf3/attachment.htm 

From pnilsson at nullref.se  Mon Apr 21 12:00:05 2008
From: pnilsson at nullref.se (Philip Nilsson)
Date: Mon, 21 Apr 2008 19:00:05 +0200
Subject: d3dx9: Texturing functions
In-Reply-To: <E1Jn8A6-00041M-77@www15.emo.freenet-rz.de>
References: <E1Jn8A6-00041M-77@www15.emo.freenet-rz.de>
Message-ID: <20080421170005.GA4326@zorkmid.localnetwork>

On Sat, Apr 19, 2008 at 10:11:06AM +0200, tony.wasserka at freenet.de wrote:
> So, the first thing I want to make sure is that we redirect the function calls correctly in order
> to reduce double coding.
> This means on the one hand that we should call the Extended versions of each function
> from inside of the simpler ones (most default parameters for the Ex functions are
> on MSDN) and on the other hand that we unify all D3DXCreateTextureFromXXEx
> functions somehow. I don't know how Resources are stored internally, but I guess
> the simplest would be to redirect all of them to D3DXCreateTextureFromFileInMemory, i.e.
> when D3DXCreateTextureFromFile is called we read the file into memory and call the
> InMemory function. I hope this shouldn't be too hard to be applied to the resource function
> either. Of course, this should also be done at the corresponding Surface, Volume and
> cube texture functions.
> Also, I haven't looked too much into it yet, but I guess we could go even a step further
> and define the CreateTextuteFromXX calls like this:
> 1. Redirect to the corresponding D3DXCreateXFromFileInMemoryEx call
> 2. Call D3DXCheckXRequirements
> 3. Call IDirect3DDevice9::CreateTexture
> 4. Lock its surface
> 5. Call LoadSurfaceFromFileEx with it
> 
> This would reduce most of our coding work on LoadSurfaceFromFileEx.
> However, there are still plenty of formats supported by the texturing functions
> and thus, plenty of work for us to do. IIRC we once came to the decision to
> use libraries like libpng or so to reduce that work, too, so we'd just need
> to implement formats like .dds.

I can't remember what the differences are between the CreateTexture and
LoadSurface functions, but this is what I'd do for the LoadSurface functions:

LoadSurfaceFromMemory (read data with the specified pixel format)
  LoadSurfaceFromFileInMemory (parse image format, read actual data into memory)
    LoadSurfaceFromFile (open file, read contents into memory)
	LoadSurfaceFromResource (open resource, read contents into memory)
  LoadSurfaceFromSurface (read image data from a surface)

This would mean two huge chunks of code: One which parses image formats
(LoadSurfaceFromFileInMemory), and one which handles all the resizing,
conversion, filtering and stuff (LoadSurfaceFromMemory).

-- 
Philip Nilsson


From fgouget at free.fr  Mon Apr 21 12:03:28 2008
From: fgouget at free.fr (Francois Gouget)
Date: Mon, 21 Apr 2008 19:03:28 +0200 (CEST)
Subject: Alternative for isinf (fix for bug 12008) (version 2)
In-Reply-To: <480CBB14.3000707@sun.com>
References: <480CBB14.3000707@sun.com>
Message-ID: <alpine.DEB.1.10.0804211902090.24974@amboise.dolphin>



+#if !defined(HAVE_ISINF) && defined(HAVE_IEEEFP_H)
+#include <ieeefp.h>
+#define isinf(x) (!(finite(x) || isnand(x)))
+#endif

The problem with macros is that something like isinf(*x++) won't do what 
you intend. That's why even for such a simple case a function would be 
better imho.



-- 
Francois Gouget <fgouget at free.fr>              http://fgouget.free.fr/
                         Stolen from an Internet user:
              "f u cn rd ths, u cn gt a gd jb n cmptr prgrmmng !"


From truiken at gmail.com  Mon Apr 21 12:36:33 2008
From: truiken at gmail.com (James Hawkins)
Date: Mon, 21 Apr 2008 12:36:33 -0500
Subject: gdi32: Make the bitmap test pass under Windows 2000
In-Reply-To: <020101c8a3c6$05f16f60$a600fea9@DMITRY>
References: <E1JnqOS-0007lR-Gp@mail.codeweavers.com>
	<87bq4345ly.fsf@wine.dyndns.org>
	<018001c8a3c1$50d410f0$a600fea9@DMITRY> <480CAF6D.7000007@gmail.com>
	<01b101c8a3c3$43e1f090$a600fea9@DMITRY> <480CB25D.1090509@gmail.com>
	<020101c8a3c6$05f16f60$a600fea9@DMITRY>
Message-ID: <22821af30804211036t32bb688ah54c780c64ed8235d@mail.gmail.com>

On Mon, Apr 21, 2008 at 10:40 AM, Dmitry Timoshkov
<dmitry at codeweavers.com> wrote:
> "Paul Vriens" <paul.vriens.wine at gmail.com> wrote:
>
>
> > Is there a specific combination you are looking for? Huge width, small height?
>
>  Anything you could test that will lead to a reasonable conclusion.
>
>
>  > Or the maximum size possible?
>
>  At least we need to know this one.
>

The maximum values for both width and height on win2k is 32767.
Anything above that on either parameter returns
ERROR_INVALID_PARAMETER.  Both params can be 32767 at the same time
and the call will still succeed (assuming there's enough memory left).

-- 
James Hawkins


From paul.vriens.wine at gmail.com  Mon Apr 21 13:16:25 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Mon, 21 Apr 2008 20:16:25 +0200
Subject: gdi32: Make the bitmap test pass under Windows 2000
In-Reply-To: <22821af30804211036t32bb688ah54c780c64ed8235d@mail.gmail.com>
References: <E1JnqOS-0007lR-Gp@mail.codeweavers.com>	
	<87bq4345ly.fsf@wine.dyndns.org>	
	<018001c8a3c1$50d410f0$a600fea9@DMITRY>
	<480CAF6D.7000007@gmail.com>	
	<01b101c8a3c3$43e1f090$a600fea9@DMITRY>
	<480CB25D.1090509@gmail.com>	
	<020101c8a3c6$05f16f60$a600fea9@DMITRY>
	<22821af30804211036t32bb688ah54c780c64ed8235d@mail.gmail.com>
Message-ID: <480CD9F9.7060501@gmail.com>

James Hawkins wrote:
> On Mon, Apr 21, 2008 at 10:40 AM, Dmitry Timoshkov
> <dmitry at codeweavers.com> wrote:
>> "Paul Vriens" <paul.vriens.wine at gmail.com> wrote:
>>
>>
>>> Is there a specific combination you are looking for? Huge width, small height?
>>  Anything you could test that will lead to a reasonable conclusion.
>>
>>
>>  > Or the maximum size possible?
>>
>>  At least we need to know this one.
>>
> 
> The maximum values for both width and height on win2k is 32767.
> Anything above that on either parameter returns
> ERROR_INVALID_PARAMETER.  Both params can be 32767 at the same time
> and the call will still succeed (assuming there's enough memory left).
> 

Yep, exactly what I just found.

-- 
Cheers,

Paul.


From dank at kegel.com  Mon Apr 21 15:59:58 2008
From: dank at kegel.com (Dan Kegel)
Date: Mon, 21 Apr 2008 13:59:58 -0700
Subject: MSIME support causing slow setup until explorer.exe paused?
In-Reply-To: <480C84C1.80003@codeweavers.com>
References: <a71bd89a0804201349v6f827eb7ke6a7717ea3c7fdda@mail.gmail.com>
	<480C84C1.80003@codeweavers.com>
Message-ID: <a71bd89a0804211359m678d4310sd22910e2816221b9@mail.gmail.com>

On Mon, Apr 21, 2008 at 5:12 AM, Aric Stewart <aric at codeweavers.com> wrote:
>   MSIMEService, MSIMEReconvertOptions, MSIMEMouseOperator, etc... those are
> all Messages that Microsoft Office looks for and sends to the IME during
> operations.  For the most part all those messages are just stubbed.
>
>   The messages are Registered in Imm32/imm.c once per process, and also
> registered in winex11.drv/ime.c also once per process. I am pretty sure we
> do not send those messages somewhere. So I am not sure why they would be
> taking up so much cpu time.
>
>  Do you know what is happening with the messages during the slow-down?

Oddly, they don't seem to be happening on Dapper.  I'll try again on
Gutsy tonight.  (Chris Smith says he saw something like this with
iTunes on gentoo today, too.)


From khodych at gmail.com  Mon Apr 21 16:25:21 2008
From: khodych at gmail.com (Sergey Khodych)
Date: Tue, 22 Apr 2008 00:25:21 +0300
Subject: [1/4] dinput: Return error for unknown property.
In-Reply-To: <480BD980.1000605@kievinfo.com>
References: <480BC94D.2080006@gmail.com> <480BD980.1000605@kievinfo.com>
Message-ID: <480D0641.9020401@gmail.com>


> I'd like to see tests for this. Also lots of programs will break because 
> they won't get some not significant property. No short - don't do this.
But wine return a garbage value also for significant property. This 
value may cause undefined behavior of application. The patch will make 
errors more explicit.



From m.b.lankhorst at gmail.com  Mon Apr 21 16:57:01 2008
From: m.b.lankhorst at gmail.com (Maarten Lankhorst)
Date: Mon, 21 Apr 2008 14:57:01 -0700
Subject: Wine64?
In-Reply-To: <20080421171603.8ea1aa71.mle+win@mega-nerd.com>
References: <20080421171603.8ea1aa71.mle+win@mega-nerd.com>
Message-ID: <b130c85e0804211457w78c0c5a5n92538f1ac9cda630@mail.gmail.com>

Hello Erik,

2008/4/21, Erik de Castro Lopo <mle+win at mega-nerd.com>:
> Hi all,
>
>  I'm interested in the current state of work towards Wine64, ie
>  running Win64 binaries on x86_64 Linux machines.
>
>  My needs are actually really simple and hence may be a good base
>  functionality to work towards. I just need to run Win64 binaries
>  that read stdin, write stdout/stderr and do file I/O using the
>  standard windows CreateFile/ReadFile/WriteFile/CloseHandle/
>  SetFilePointer etc functions.
>
>  I have found and read this:
>
>     http://wiki.winehq.org/Wine64
>
>  but some of that stuff seems rather out-of-date.
>
>  When I configure with --enable-win64 it configures fine but then
>  errors out in widl generated code because of things like this:
>
>     #if !defined(__RPC_WIN32__)
>     #error Currently only Wine and WIN32 are supported.
>     #endif
>
>  So, is anybody working on Wine64 stuff? Is there a Wine64 TODO list?
>  Any way for me to get involved?
A lot of the lowest level stuff is currently missing. If you don't
mind x64 assembly it's not impossible to do. We would need support
from gcc for the windows calling convention, and making it possible to
mix linux calling convention with windows calling convention. If you
are up to it just make it ignore the error for now, even if it causes
errors. A proof of concept "Hello, world!" would be a great
accomplishment at this point.

Cheers,
Maarten.


From reif at earthlink.net  Mon Apr 21 17:18:25 2008
From: reif at earthlink.net (Robert Reif)
Date: Mon, 21 Apr 2008 18:18:25 -0400
Subject: winmm/tests: waveOutGetDevCaps called with invalid size
In-Reply-To: <Pine.LNX.4.64.0804211050260.12791@maggie.lkpg.cendio.se>
References: <Pine.LNX.4.64.0804181102080.23847@maggie.lkpg.cendio.se>
	<4808B145.2010609@earthlink.net>
	<Pine.LNX.4.64.0804211050260.12791@maggie.lkpg.cendio.se>
Message-ID: <480D12B1.3070309@earthlink.net>

Peter ?strand wrote:
> On Fri, 18 Apr 2008, Robert Reif wrote:
>
>   
>>> -    rc=waveOutGetDevCapsA(device,&capsA,4);
>>> +    /* Final call must succeed, capsA will be used below */
>>> +    rc=waveOutGetDevCapsA(device,&capsA,sizeof(capsA));
>>>      ok(rc==MMSYSERR_NOERROR,
>>>         "waveOutGetDevCapsA(%s): MMSYSERR_NOERROR expected, got %s\n",
>>>         dev_name(device),wave_out_error(rc));
>>> -
>>> -    rc=waveOutGetDevCapsW(device,&capsW,4);
>>> -    ok(rc==MMSYSERR_NOERROR || rc==MMSYSERR_NOTSUPPORTED,
>>> -       "waveOutGetDevCapsW(%s): MMSYSERR_NOERROR or MMSYSERR_NOTSUPPORTED "
>>> -       "expected, got %s\n",dev_name(device),wave_out_error(rc));
>>> +    if (rc!=MMSYSERR_NOERROR)
>>> +	return;
>>>       
>
>
>   
>> That's the whole point of the test, to check what happens with an invalid
>> argument.
>>     
>
> So what do you think *should* happen with an invalid argument? The result 
> is different on different Windows platforms. The behaviour is not 
> specified by MSDN. 
>
> In any case, continuing and executing code that uses "capsA" even though 
> the waveOutGetDevCapsA call failed is definitely wrong. 
>
>  
> Rgds, 
> ---
> Peter ?strand		ThinLinc Chief Developer
> Cendio AB		http://www.cendio.se
> Wallenbergs gata 4
> 583 30 Link?ping	Phone: +46-13-21 46 00
This is the proper fix:

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: wave.diff.txt
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20080421/37cbf957/attachment.txt 

From wine-devel at kievinfo.com  Mon Apr 21 19:20:07 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Mon, 21 Apr 2008 18:20:07 -0600
Subject: [1/4] dinput: Return error for unknown property.
In-Reply-To: <480D0641.9020401@gmail.com>
References: <480BC94D.2080006@gmail.com> <480BD980.1000605@kievinfo.com>
	<480D0641.9020401@gmail.com>
Message-ID: <480D2F37.20801@kievinfo.com>

Sergey Khodych wrote:
>> I'd like to see tests for this. Also lots of programs will break because 
>> they won't get some not significant property. No short - don't do this.
> But wine return a garbage value also for significant property. This 
> value may cause undefined behavior of application. The patch will make 
> errors more explicit.
> 
> 
On another hand - that's the way Wine been headed - break everything that's 
not implemented. So go ahead and put that error in.

Vitaliy.


From leslie_alistair at hotmail.com  Mon Apr 21 20:22:59 2008
From: leslie_alistair at hotmail.com (Alistair Leslie-Hughes)
Date: Tue, 22 Apr 2008 11:22:59 +1000
Subject: version: Fix tests that fail in win9x and win2k
In-Reply-To: <22821af30804211707o4fecb300g8db61a0689ce2ab6@mail.gmail.com>
References: <22821af30804211707o4fecb300g8db61a0689ce2ab6@mail.gmail.com>
Message-ID: <480D3DF3.9000803@hotmail.com>

James Hawkins wrote:
> Hi,
> 
> Changelog:
> * Fix tests that fail in win9x and win2k.
> 
>  dlls/version/tests/info.c |   29 +++++++++++++++++++----------
>  1 files changed, 19 insertions(+), 10 deletions(-)
> 
Hi James,
   No patch attached.

Best Regards
  Alistair Leslie-Hughes


From winehacker at gmail.com  Mon Apr 21 20:30:29 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Mon, 21 Apr 2008 21:30:29 -0400
Subject: Strange struct alignment errors?
In-Reply-To: <a71bd89a0804200057l4a91f644x45f99a17f53bcf47@mail.gmail.com>
References: <a71bd89a0804200045n57eeb6d1k2abc149f0869731d@mail.gmail.com>
	<22821af30804200052y6c03c8efh8c56d22282bd0848@mail.gmail.com>
	<a71bd89a0804200057l4a91f644x45f99a17f53bcf47@mail.gmail.com>
Message-ID: <19e31a080804211830g1b2eed4r92336d3d99f760c6@mail.gmail.com>

On Sun, Apr 20, 2008 at 3:57 AM, Dan Kegel <dank at kegel.com> wrote:
>  Shoot, icc ought to be able to handle those, but
>  you're right, we should ignore any icc results.

At least until I am done... =)

But yeah icc's alignment handling seems to be totally broken...I've
tried every alignment switch known to man and still get problems.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From dmitry at codeweavers.com  Mon Apr 21 21:39:18 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Tue, 22 Apr 2008 11:39:18 +0900
Subject: Secure filename copy to fixed size variable wfileName
References: <1208786326.23524.19.camel@tefdemo>
Message-ID: <01a701c8a422$11f1ed10$a600fea9@DMITRY>

"Tomasz Jezierski - Tefnet" <developers at tefnet.pl> wrote:

> -     strcpyW(wfileName, sei_tmp.lpFile);
> +           StrCpyNW(wfileName, sei_tmp.lpFile,sizeof(wfileName));
>   }
>      } else
> - strcpyW(wfileName, sei_tmp.lpFile);
> +       StrCpyNW(wfileName, sei_tmp.lpFile,sizeof(wfileName));

Your patch doesn't make the code more secure than it is now. StrCpyNW takes
number of characters, not bytes. And since it's just a wrapper around lstrcpynW
it's better to use the latter one instead.

-- 
Dmitry.


From austinenglish at gmail.com  Mon Apr 21 22:02:50 2008
From: austinenglish at gmail.com (Austin English)
Date: Mon, 21 Apr 2008 22:02:50 -0500
Subject: Documentation updating / XML?
Message-ID: <b6bb06270804212002h73a55f23i1ce083af2dbd3150@mail.gmail.com>

I've been working on some of the documentation, then remembered that Scott
requested a move to XML:
http://bugs.winehq.org/show_bug.cgi?id=12217

There are quite a few programs to convert SGML to XML, and I've got a bit of
time to kill. Alexandre, would you accept a move to XML, or would this be a
waste of time?

-Austin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080421/5c7d191c/attachment.htm 

From dank at kegel.com  Mon Apr 21 22:58:21 2008
From: dank at kegel.com (Dan Kegel)
Date: Mon, 21 Apr 2008 20:58:21 -0700
Subject: What to do about filenames legal in Linux but illegal in Windows?
Message-ID: <a71bd89a0804212058k7209bc9cl7ce04fb30cc87e58@mail.gmail.com>

Linux users create files with names that are legal in Linux but not
in Windows, simply because they can.
Eventually they'll try to read those files in a Windows app,
either by carrying them on a flash drive over to a real windows
system, by dual booting, or by running the app in Wine.

Now, normally, Wine should do exactly what Windows does.
(I believe that in both Windows and Wine, directory listings
will show these illegal chars, but attempts to open the files will fail.)

But let's say we're in that happy time in the near future
when lots of companies are willing to ship their apps
with Wine as a halfway house to native support, and
lots of their users start running into this issue.
Can/should such apps tell Windows or Wine "Oh, go ahead
and let me open those funny files?"

On Wine, of course, we could open up a hole if we had to,
but it'd be nice to know if there were a method that
also worked on Windows.

I looked around a bit today for a way to open such files in
Windows, and failed miserably (though I did find a nice
example of how to use NtCreateFile without the DDK).
Anyone know of a way on real Windows to do this?


From saulius2 at ar.fi.lt  Tue Apr 22 00:57:39 2008
From: saulius2 at ar.fi.lt (Saulius Krasuckas)
Date: Tue, 22 Apr 2008 08:57:39 +0300 (EEST)
Subject: What to do about filenames legal in Linux but illegal in Windows?
In-Reply-To: <a71bd89a0804212058k7209bc9cl7ce04fb30cc87e58@mail.gmail.com>
References: <a71bd89a0804212058k7209bc9cl7ce04fb30cc87e58@mail.gmail.com>
Message-ID: <Pine.LNX.4.62.0804220839250.16602@tvarka.ar.fi.lt>

* On Mon, 21 Apr 2008, Dan Kegel wrote:
> 
> (I believe that in both Windows and Wine, directory listings
> will show these illegal chars, but attempts to open the files will 
> fail.)
  ...
> I looked around a bit today for a way to open such files in
> Windows, and failed miserably 
  ...
> Anyone know of a way on real Windows to do this?

For a files that were at least "undeletable" I remember I have been using 
a feature of Total Commander to switch format of files displayed to a 
Short/Long form.  Not all files give up for me this way, but half of them 
did, though.


From thunderbird2k at gmx.net  Tue Apr 22 01:04:46 2008
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Tue, 22 Apr 2008 08:04:46 +0200
Subject: Wine64?
In-Reply-To: <b130c85e0804211457w78c0c5a5n92538f1ac9cda630@mail.gmail.com>
References: <20080421171603.8ea1aa71.mle+win@mega-nerd.com>
	<b130c85e0804211457w78c0c5a5n92538f1ac9cda630@mail.gmail.com>
Message-ID: <20080422060446.42360@gmx.net>

> Hello Erik,
> 
> 2008/4/21, Erik de Castro Lopo <mle+win at mega-nerd.com>:
> > Hi all,
> >
> >  I'm interested in the current state of work towards Wine64, ie
> >  running Win64 binaries on x86_64 Linux machines.
> >
> >  My needs are actually really simple and hence may be a good base
> >  functionality to work towards. I just need to run Win64 binaries
> >  that read stdin, write stdout/stderr and do file I/O using the
> >  standard windows CreateFile/ReadFile/WriteFile/CloseHandle/
> >  SetFilePointer etc functions.
> >
> >  I have found and read this:
> >
> >     http://wiki.winehq.org/Wine64
> >
> >  but some of that stuff seems rather out-of-date.
> >
> >  When I configure with --enable-win64 it configures fine but then
> >  errors out in widl generated code because of things like this:
> >
> >     #if !defined(__RPC_WIN32__)
> >     #error Currently only Wine and WIN32 are supported.
> >     #endif
> >
> >  So, is anybody working on Wine64 stuff? Is there a Wine64 TODO list?
> >  Any way for me to get involved?
> A lot of the lowest level stuff is currently missing. If you don't
> mind x64 assembly it's not impossible to do. We would need support
> from gcc for the windows calling convention, and making it possible to
> mix linux calling convention with windows calling convention. If you
> are up to it just make it ignore the error for now, even if it causes
> errors. A proof of concept "Hello, world!" would be a great
> accomplishment at this point.
> 
> Cheers,
> Maarten.
> 

These days there is a 64bit version of mingw (mingw64 or so it is called). They must have patches to add the calling convention to gcc now. I'm not sure what the status is on merging the changes back but I think nothing forbids you from building gcc from their sources. I have no idea whether having the calling convention is enough for Wine.

Roderick
-- 
Psssst! Schon vom neuen GMX MultiMessenger geh?rt?
Der kann`s mit allen: http://www.gmx.net/de/go/multimessenger


From paul.vriens.wine at gmail.com  Tue Apr 22 01:33:25 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Tue, 22 Apr 2008 08:33:25 +0200
Subject: kernel32: Fix a test that fails on all NT platforms
In-Reply-To: <22821af30804212203q7ff76745ge14ec12b3b8eec79@mail.gmail.com>
References: <22821af30804212203q7ff76745ge14ec12b3b8eec79@mail.gmail.com>
Message-ID: <480D86B5.8010707@gmail.com>

James Hawkins wrote:
> Hi,
> 
> Changelog:
> * Fix a test that fails on all NT platforms.
> 
>  dlls/kernel32/tests/toolhelp.c |   12 +++++++++---
>  1 files changed, 9 insertions(+), 3 deletions(-)
> 
> 
> 
> ------------------------------------------------------------------------
> 
> 
Hi James,

I've been looking at some of the patches to fix the tests but I'm a bit unsure 
if some of them are the correct way to go. Things like:

+    /* win9x does not return a thread, NT does */
      te.dwSize = sizeof(te);
-    ok(!pThread32First( hSnapshot, &te ), "shouldn't return a thread\n");
+    ret = pThread32First( hSnapshot, &te );
+    ok(ret || !ret, "You'll never see this\n");

renders the whole test useless. It turns out that win9x in this case leaves 
te.dwSize and XP-and-up set te.dwSize to 0. Shouldn't we make use of that fact?
So something like (or another combination):

if (te.dwSize == 0)
{
    XP-and-up, expect failure
}
else if (te.dwSize == sizeof(te))
{
    win9x, expect success
}
else
{
   something is wrong/unexpected
}

On a sidenote (and this has been the case for a long time):

I've seen patches where

ok(function(a,b),"Failed");

is turned into

c = function(a,b);
if (c)
{
   .....
}

but done without a skip or such. So if Wine has a regression for 'function' we 
won't notice.

We have loads of patches where we expect 3 or more different last errors. This 
will make sure the tests always succeed of course but makes it difficult to tell 
if we (Wine) are doing the correct/best thing.

-- 
Cheers,

Paul.


From mrmessiah at gmail.com  Tue Apr 22 01:35:07 2008
From: mrmessiah at gmail.com (Chris Howe)
Date: Tue, 22 Apr 2008 07:35:07 +0100
Subject: What to do about filenames legal in Linux but illegal in Windows?
In-Reply-To: <Pine.LNX.4.62.0804220839250.16602@tvarka.ar.fi.lt>
References: <a71bd89a0804212058k7209bc9cl7ce04fb30cc87e58@mail.gmail.com>
	<Pine.LNX.4.62.0804220839250.16602@tvarka.ar.fi.lt>
Message-ID: <39c14e440804212335t4530d58bl82ffa1719f022c7b@mail.gmail.com>

Would the right way to handle such files be to use the
FUSE filesystem (when it's done) to hide them from
apps?

On the one hand it sidesteps the problem, but as
a recent blog post by Microsoft's Raymond Chen
http://blogs.msdn.com/oldnewthing/archive/2008/04/14/8389268.aspx
shows, it IS possible to get into this kind of problem
in Windows too.

---
Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080422/9b471f33/attachment.htm 

From truiken at gmail.com  Tue Apr 22 01:57:09 2008
From: truiken at gmail.com (James Hawkins)
Date: Tue, 22 Apr 2008 01:57:09 -0500
Subject: kernel32: Fix a test that fails on all NT platforms
In-Reply-To: <480D86B5.8010707@gmail.com>
References: <22821af30804212203q7ff76745ge14ec12b3b8eec79@mail.gmail.com>
	<480D86B5.8010707@gmail.com>
Message-ID: <22821af30804212357p69f6fe7dtf9090eb95ad9ebb3@mail.gmail.com>

On Tue, Apr 22, 2008 at 1:33 AM, Paul Vriens <paul.vriens.wine at gmail.com> wrote:
> James Hawkins wrote:
>
> >
> > Hi,
> >
> > Changelog:
> > * Fix a test that fails on all NT platforms.
> >
> >  dlls/kernel32/tests/toolhelp.c |   12 +++++++++---
> >  1 files changed, 9 insertions(+), 3 deletions(-)
> >
> >
> >
> > ------------------------------------------------------------------------
> >
> >
> >
>  Hi James,
>
>  I've been looking at some of the patches to fix the tests but I'm a bit
> unsure if some of them are the correct way to go. Things like:
>
>  +    /* win9x does not return a thread, NT does */
>      te.dwSize = sizeof(te);
>  -    ok(!pThread32First( hSnapshot, &te ), "shouldn't return a thread\n");
>  +    ret = pThread32First( hSnapshot, &te );
>  +    ok(ret || !ret, "You'll never see this\n");
>
>  renders the whole test useless.
>

That's the point; the test is useless.  If a test fails on one
platform but succeeds in another, then we're testing a behavior that
can't be relied on, or the test is not specific enough.  We leave it
around for documentation of that fact.

> It turns out that win9x in this case leaves
> te.dwSize and XP-and-up set te.dwSize to 0. Shouldn't we make use of that
> fact?
>

You could, but it doesn't change the fact that the behavior is not
reliable across different platforms.  If we knew an app that makes
this exact check and depends on the results, then sure we should add a
pickier test.  As it stands, it's just a bit too nit-picky.

>
>  On a sidenote (and this has been the case for a long time):
>
>  I've seen patches where
>
>  ok(function(a,b),"Failed");
>
>  is turned into
>
>  c = function(a,b);
>  if (c)
>  {
>   .....
>  }
>
>  but done without a skip or such. So if Wine has a regression for 'function'
> we won't notice.
>

Tell that to the platforms that fail too.  Thus, this is a behavior
that can't be relied on.  Wine strives to have compatibility with all
the platforms we test on.  We don't stick to one specific version, and
if we did, we could arbitrarily pick the version that fails this
function, then failing would be the right behavior.

>  We have loads of patches where we expect 3 or more different last errors.
> This will make sure the tests always succeed of course but makes it
> difficult to tell if we (Wine) are doing the correct/best thing.
>

You're missing the broader picture.  If a function returns three or
more different last errors, how can any app depend on that either?
What is the definition of the "correct/best thing"?

-- 
James Hawkins


From astrand at cendio.se  Tue Apr 22 02:30:09 2008
From: astrand at cendio.se (=?UTF-8?Q?Peter_=C3=85strand?=)
Date: Tue, 22 Apr 2008 09:30:09 +0200 (CEST)
Subject: winmm/tests: waveOutGetDevCaps called with invalid size
In-Reply-To: <480D12B1.3070309@earthlink.net>
References: <Pine.LNX.4.64.0804181102080.23847@maggie.lkpg.cendio.se>
	<4808B145.2010609@earthlink.net>
	<Pine.LNX.4.64.0804211050260.12791@maggie.lkpg.cendio.se>
	<480D12B1.3070309@earthlink.net>
Message-ID: <Pine.LNX.4.64.0804220842440.29058@maggie.lkpg.cendio.se>

On Mon, 21 Apr 2008, Robert Reif wrote:

> > > That's the whole point of the test, to check what happens with an invalid
> > > argument.
> > >     
> >
> > So what do you think *should* happen with an invalid argument? The result is
> > different on different Windows platforms. The behaviour is not specified by
> > MSDN. 
> >
> > In any case, continuing and executing code that uses "capsA" even though the
> > waveOutGetDevCapsA call failed is definitely wrong. 

> This is the proper fix:

The fix for this part of the problem is fine. Please apply. 

However, I still think it's VERY strange to expect success from an invalid 
call. You are describing it as an "invalid argument" yourself. Why should 
we expect a call with an "invalid argument" to succeed? And again, the 
test does NOT pass on all Microsoft versions; it fails on Terminal 
Servers. 

If the point is to verify that waveOutGetDevCaps doesn't write more than 
the size supplied, this should be verified. I'd also like to point out 
that the Wine implementation also doesn't handle this correctly: Only 
waveOutGetDevCapsA does a memcpy() using the size argument; 
waveOutGetDevCapsW does not.


Rgds, 
---
Peter ?strand		ThinLinc Chief Developer
Cendio AB		http://www.cendio.se
Wallenbergs gata 4
583 30 Link?ping	Phone: +46-13-21 46 00
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: wave.diff.txt
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20080422/6248e257/attachment.txt 

From paul.vriens.wine at gmail.com  Tue Apr 22 02:48:02 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Tue, 22 Apr 2008 09:48:02 +0200
Subject: kernel32: Fix a test that fails on all NT platforms
In-Reply-To: <22821af30804212357p69f6fe7dtf9090eb95ad9ebb3@mail.gmail.com>
References: <22821af30804212203q7ff76745ge14ec12b3b8eec79@mail.gmail.com>	
	<480D86B5.8010707@gmail.com>
	<22821af30804212357p69f6fe7dtf9090eb95ad9ebb3@mail.gmail.com>
Message-ID: <480D9832.8070701@gmail.com>

James Hawkins wrote:
> On Tue, Apr 22, 2008 at 1:33 AM, Paul Vriens <paul.vriens.wine at gmail.com> wrote:
>> James Hawkins wrote:
>>
>>> Hi,
>>>
>>> Changelog:
>>> * Fix a test that fails on all NT platforms.
>>>
>>>  dlls/kernel32/tests/toolhelp.c |   12 +++++++++---
>>>  1 files changed, 9 insertions(+), 3 deletions(-)
>>>
>>>
>>>
>>> ------------------------------------------------------------------------
>>>
>>>
>>>
>>  Hi James,
>>
>>  I've been looking at some of the patches to fix the tests but I'm a bit
>> unsure if some of them are the correct way to go. Things like:
>>
>>  +    /* win9x does not return a thread, NT does */
>>      te.dwSize = sizeof(te);
>>  -    ok(!pThread32First( hSnapshot, &te ), "shouldn't return a thread\n");
>>  +    ret = pThread32First( hSnapshot, &te );
>>  +    ok(ret || !ret, "You'll never see this\n");
>>
>>  renders the whole test useless.
>>
> 
> That's the point; the test is useless.  If a test fails on one
> platform but succeeds in another, then we're testing a behavior that
> can't be relied on, or the test is not specific enough.  We leave it
> around for documentation of that fact.
> 
>> It turns out that win9x in this case leaves
>> te.dwSize and XP-and-up set te.dwSize to 0. Shouldn't we make use of that
>> fact?
>>
> 
> You could, but it doesn't change the fact that the behavior is not
> reliable across different platforms.  If we knew an app that makes
> this exact check and depends on the results, then sure we should add a
> pickier test.  As it stands, it's just a bit too nit-picky.

But if it's just for documentation purposes (as for now we don't know an app 
that depends on it) isn't my example a bit better? (I agree about the nit-picky 
though).

> 
>>  On a sidenote (and this has been the case for a long time):
>>
>>  I've seen patches where
>>
>>  ok(function(a,b),"Failed");
>>
>>  is turned into
>>
>>  c = function(a,b);
>>  if (c)
>>  {
>>   .....
>>  }
>>
>>  but done without a skip or such. So if Wine has a regression for 'function'
>> we won't notice.
>>
> 
> Tell that to the platforms that fail too.  Thus, this is a behavior
> that can't be relied on.  Wine strives to have compatibility with all
> the platforms we test on.  We don't stick to one specific version, and
> if we did, we could arbitrarily pick the version that fails this
> function, then failing would be the right behavior.

If a function consistently fails that's true but there are all kinds of 
circumstances that a function could fail. I agree we shouldn't care about the 
specific version but just ignoring failure because one of the versions fails is 
not correct in my opinion. We already had this 'discussion' with failures that 
only happen on win9x and the fact whether we should cater for that are just let 
it be. 'Let it be' was AJ's opinion back than, unless we have a nice way of 
catching it.

> 
>>  We have loads of patches where we expect 3 or more different last errors.
>> This will make sure the tests always succeed of course but makes it
>> difficult to tell if we (Wine) are doing the correct/best thing.
>>
> 
> You're missing the broader picture.  If a function returns three or
> more different last errors, how can any app depend on that either?
> What is the definition of the "correct/best thing"?
> 

Agreed, if versions pass different last errors an app could hardly be depending 
on it.

I agree on most of your points as we merely showing that versions return 
different errors or even succeed or fail depending on the OS. But I also think 
that the more we know about the circumstances the more we should document them.

Having a 1.0 soon will most likely broaden the numbers of users and hence apps 
that people are going to (try to) run with Wine. The chances will become bigger 
that there is an app out there that will make use of version differences by 
whatever means. I've seen several apps that do a whole lot of things just to to 
find out on what version/OS they are running on (and I'm not talking about copy 
protection apps).

-- 
Cheers,

Paul.


From truiken at gmail.com  Tue Apr 22 03:01:34 2008
From: truiken at gmail.com (James Hawkins)
Date: Tue, 22 Apr 2008 03:01:34 -0500
Subject: kernel32: Fix a test that fails on all NT platforms
In-Reply-To: <480D9832.8070701@gmail.com>
References: <22821af30804212203q7ff76745ge14ec12b3b8eec79@mail.gmail.com>
	<480D86B5.8010707@gmail.com>
	<22821af30804212357p69f6fe7dtf9090eb95ad9ebb3@mail.gmail.com>
	<480D9832.8070701@gmail.com>
Message-ID: <22821af30804220101q660cc4b9ob07683e257728267@mail.gmail.com>

On Tue, Apr 22, 2008 at 2:48 AM, Paul Vriens <paul.vriens.wine at gmail.com> wrote:
>
> James Hawkins wrote:
>
> > On Tue, Apr 22, 2008 at 1:33 AM, Paul Vriens <paul.vriens.wine at gmail.com>
> wrote:
> >
> > > James Hawkins wrote:
> > >
> > >
> > > > Hi,
> > > >
> > > > Changelog:
> > > > * Fix a test that fails on all NT platforms.
> > > >
> > > >  dlls/kernel32/tests/toolhelp.c |   12 +++++++++---
> > > >  1 files changed, 9 insertions(+), 3 deletions(-)
> > > >
> > > >
> > > >
> > > >
> ------------------------------------------------------------------------
> > > >
> > > >
> > > >
> > > >
> > >  Hi James,
> > >
> > >  I've been looking at some of the patches to fix the tests but I'm a bit
> > > unsure if some of them are the correct way to go. Things like:
> > >
> > >  +    /* win9x does not return a thread, NT does */
> > >     te.dwSize = sizeof(te);
> > >  -    ok(!pThread32First( hSnapshot, &te ), "shouldn't return a
> thread\n");
> > >  +    ret = pThread32First( hSnapshot, &te );
> > >  +    ok(ret || !ret, "You'll never see this\n");
> > >
> > >  renders the whole test useless.
> > >
> > >
> >
> > That's the point; the test is useless.  If a test fails on one
> > platform but succeeds in another, then we're testing a behavior that
> > can't be relied on, or the test is not specific enough.  We leave it
> > around for documentation of that fact.
> >
> >
> > > It turns out that win9x in this case leaves
> > > te.dwSize and XP-and-up set te.dwSize to 0. Shouldn't we make use of
> that
> > > fact?
> > >
> > >
> >
> > You could, but it doesn't change the fact that the behavior is not
> > reliable across different platforms.  If we knew an app that makes
> > this exact check and depends on the results, then sure we should add a
> > pickier test.  As it stands, it's just a bit too nit-picky.
> >
>
>  But if it's just for documentation purposes (as for now we don't know an
> app that depends on it) isn't my example a bit better? (I agree about the
> nit-picky though).
>
>
>
> >
> >
> > >  On a sidenote (and this has been the case for a long time):
> > >
> > >  I've seen patches where
> > >
> > >  ok(function(a,b),"Failed");
> > >
> > >  is turned into
> > >
> > >  c = function(a,b);
> > >  if (c)
> > >  {
> > >  .....
> > >  }
> > >
> > >  but done without a skip or such. So if Wine has a regression for
> 'function'
> > > we won't notice.
> > >
> > >
> >
> > Tell that to the platforms that fail too.  Thus, this is a behavior
> > that can't be relied on.  Wine strives to have compatibility with all
> > the platforms we test on.  We don't stick to one specific version, and
> > if we did, we could arbitrarily pick the version that fails this
> > function, then failing would be the right behavior.
> >
>
>  If a function consistently fails that's true but there are all kinds of
> circumstances that a function could fail. I agree we shouldn't care about
> the specific version but just ignoring failure because one of the versions
> fails is not correct in my opinion. We already had this 'discussion' with
> failures that only happen on win9x and the fact whether we should cater for
> that are just let it be. 'Let it be' was AJ's opinion back than, unless we
> have a nice way of catching it.
>
>
>
> >
> >
> > >  We have loads of patches where we expect 3 or more different last
> errors.
> > > This will make sure the tests always succeed of course but makes it
> > > difficult to tell if we (Wine) are doing the correct/best thing.
> > >
> > >
> >
> > You're missing the broader picture.  If a function returns three or
> > more different last errors, how can any app depend on that either?
> > What is the definition of the "correct/best thing"?
> >
> >
>
>  Agreed, if versions pass different last errors an app could hardly be
> depending on it.
>
>  I agree on most of your points as we merely showing that versions return
> different errors or even succeed or fail depending on the OS. But I also
> think that the more we know about the circumstances the more we should
> document them.
>
>  Having a 1.0 soon will most likely broaden the numbers of users and hence
> apps that people are going to (try to) run with Wine. The chances will
> become bigger that there is an app out there that will make use of version
> differences by whatever means. I've seen several apps that do a whole lot of
> things just to to find out on what version/OS they are running on (and I'm
> not talking about copy protection apps).
>

Sure, but like I said before, we'll deal with that when we find those
apps.  In the meantime, I'm going to keep sending in these patches
fixing up the tests.  Hopefully people will take notice and help me
out :-)

-- 
James Hawkins


From buzzilo at gmail.com  Mon Apr 21 17:34:15 2008
From: buzzilo at gmail.com (Evgeny Burzak)
Date: Tue, 22 Apr 2008 02:34:15 +0400
Subject: winehq.org redesign
Message-ID: <20080422023415.48a311e3.buzzilo@gmail.com>

Hello all,
some times ago I make design for AppDB  (http://buzz.ulx.ru/pf/appdb.png). Folks was  delighted with this one, but managers rejected my idea due to needs redesign everything then. 
But now it may be more actual then ever owing to Wine 1.0 release? I think it may gain attention from professionals who wants to use wine in production environment and improve Wine.
I can make design for main pages, xml/xslt template and probably base php5 clasess if you decide to change site engine.

-- 
Evgeny


From dwayne at translate.org.za  Tue Apr 22 05:13:09 2008
From: dwayne at translate.org.za (Dwayne Bailey)
Date: Tue, 22 Apr 2008 12:13:09 +0200
Subject: Translating Wine with PO files
Message-ID: <1208859189.20951.48.camel@dhcppc32>

Hi,

I've just completed a tool for converting resource files (.rc) to
Gettext PO.  
http://translate.sourceforge.net/wiki/toolkit/rc2po
This should allow many more FOSS translators to add translations to
Wine, hopefully before the 1.0 release.

In some ways this is a response to some issues raised in the
'Translations and Wine 1.0' thread:
http://thread.gmane.org/gmane.comp.emulators.wine.devel/58000
further into this email I offer some comments on the issues raised in
that thread.  My suggestion is to deploy a Pootle server:
http://translate.sourceforge.net/wiki/pootle/index

The new RC tool, rc2po, is part of the Translate Toolkit, a general
translation conversion toolkit and localisation library.
http://translate.sourceforge.net/wiki/toolkit/index

I've cut 1.2-alpha1 for those who want to give it a spin.  We've just
started work on v1.2 so the toolkit is mature, started in 2002, and the
alpha status is simply an indication that we've got quite a while before
1.2 official.  Download it from here:
http://translate.sourceforge.net/snapshots/

Status of rc2po:
----------------
* Its very new - I've done roundtrip testing and some translating in
ummm pig latin :) but will begin more serious Afrikaans translation
soon.  So I expect to see some bugs.
* It can handle: DIALOG*, MENU, LANGUAGE, STRINGTABLE
* You can't change the dialog sizes - I have some ideas of how we could
do this in PO but its not implemented at all

How it works:
-------------
Make POT files: rc2po -P some.rc some.pot
Recover old translations: rc2po -t some.rc translated.rc translated.po
Make rc files: 
  po2rc --lang=LANG_XXX -t some.rc translated.po translated.rc
The wiki page provides clearer usage examples:
http://translate.sourceforge.net/wiki/toolkit/rc2po

Things to be aware of
---------------------
* You cannot tweak the translations in .rc and hope to keep things in
sync with PO, you'll need to only work in PO files or make sure any
tweaks you make in your .rc you copy to the .po.
* You cannot change the sizes of the dialogues in your translation for
the above reason.  This should change in the future to allow you to
'translate' the sizes.
* Recovered translations need to be fully reviewed as we can't determine
if your translation is based on the same English text.
* We cannot create multi-language .rc files, you'll need one languages
in each file.
* We can read multilingual files but will only take the first language
and drop anything after that, since PO files can only contain one
language this makes sense.
* We don't do any changes to the Makefiles, you'll have to do those by
hand.  But it would probably be easy to create a simple bash script or
change the build system to automagically include all xxx_yy.rc files.
* We handle encoding issues but prefer UTF-8 throughout.

How you can help
----------------
* By testing rc2po and po2rc
* Help implement a solution to allow size changes
* Report bugs on http://bugs.locamotion.org

Getting help
------------
* On IRC: irc://irc.freenode.net/#pootle
* Mailing list:
http://lists.sourceforge.net/lists/listinfo/translate-devel
* Wiki: http://translate.sourceforge.net/wiki/toolkit/rc2po

Suggested localization infrastructure for Wine
----------------------------------------------
In the thread 'Translation and Wine 1.0':
http://thread.gmane.org/gmane.comp.emulators.wine.devel/58000
there was some discussion about localization infrastructure for wine.

I'd like to suggest that Wine looks at using Pootle:
http://translate.sourceforge.net/wiki/pootle/index
this is already in use by projects such as OLPC, OpenOffice.org and
others.  It can manage PO files, commit to various VC systems (including
Git), allows suggestions, does various QA checks and allows download and
submission of PO files, has translation memory and glossary suggestions,
statistics, etc, etc.

A hosting option is to put the files on http://pootle.locamotion.org but
I would request someone from the Wine community to take charge of
keeping the PO files up-to-date and authorising users, etc.  I would
however encourage the Wine community to run its own server.  This would
make it easier to commit files directly into Git.  I would suggest some
work to ensure that POT files, updating of PO files and conversion back
to .rc are automatic.  Being within the control of the Wine community
makes this easier.

Launchpad is not an options unless you convert to PO using the above
rc2po.  Pootle has the advantage that you can run your own server, you
don't have that with Launchpad.

-- 
Dwayne Bailey
Translate.org.za

+27-12-460-1095 (w)
+27-83-443-7114 (cell)



From julliard at winehq.org  Tue Apr 22 05:17:49 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Tue, 22 Apr 2008 12:17:49 +0200
Subject: [PATCH 01/21] [WinHelp]: get rid of the reuse concept for Windows
	and refactor the code a bit for window creation / deletion
In-Reply-To: <20080421190646.12982.96067.stgit@localhost> (Eric Pouech's
	message of "Mon, 21 Apr 2008 21:06:46 +0200")
References: <20080421190145.12982.57452.stgit@localhost>
	<20080421190646.12982.96067.stgit@localhost>
Message-ID: <87mynm2nxu.fsf@wine.dyndns.org>

Eric Pouech <eric.pouech at orange.fr> writes:

>  programs/winhelp/winhelp.c |  257 ++++++++++++++++++++------------------------
>  1 files changed, 116 insertions(+), 141 deletions(-)

This breaks window repaints for me, when switching pages the window is
not repainted and still shows the old page.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Tue Apr 22 05:25:53 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Tue, 22 Apr 2008 12:25:53 +0200
Subject: Documentation updating / XML?
In-Reply-To: <b6bb06270804212002h73a55f23i1ce083af2dbd3150@mail.gmail.com>
	(Austin English's message of "Mon, 21 Apr 2008 22:02:50 -0500")
References: <b6bb06270804212002h73a55f23i1ce083af2dbd3150@mail.gmail.com>
Message-ID: <87iqya2nke.fsf@wine.dyndns.org>

"Austin English" <austinenglish at gmail.com> writes:

> I've been working on some of the documentation, then remembered that Scott
> requested a move to XML:
> http://bugs.winehq.org/show_bug.cgi?id=12217
>
> There are quite a few programs to convert SGML to XML, and I've got a bit of
> time to kill. Alexandre, would you accept a move to XML, or would this be a
> waste of time?

I don't really care about the format as long as there are decent tools
to generate all the outputs we want. Considering the state of SGML tools
it's probably not hard to do better...

-- 
Alexandre Julliard
julliard at winehq.org


From 4winter at informatik.uni-hamburg.de  Tue Apr 22 05:56:35 2008
From: 4winter at informatik.uni-hamburg.de (Justus Winter)
Date: Tue, 22 Apr 2008 12:56:35 +0200
Subject: Wine countdown?
In-Reply-To: <a71bd89a0804191648y4a6c2c27h4edf8129fda402b7@mail.gmail.com>
References: <a71bd89a0804191648y4a6c2c27h4edf8129fda402b7@mail.gmail.com>
Message-ID: <480DC463.4010507@informatik.uni-hamburg.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Dan Kegel wrote:
> Anybody seen the nifty countdown logo that Ubuntu is using?
> http://www.ubuntu.com/getubuntu/countdown
> Maybe we should do something similar for Wine.
Agreed.

> FWIW, here's a snippet that does something similar, but with text:
[...]

I don't like this approach for several reasons:

* It doesn't work for browsers without javascript interpreter or for
users who disabled javascript for various reasons
* You ask people to include a script in their pages (well, you didn't,
the Ubuntu people did). Including executable script code that you don't
control is a very bad idea since it is executed in the execution context
of your page (think about stealing session ids that are stored in
cookies or in the URL).
* You rely on the users clock to calculate the number of days left

Instead I propose the use of a small cgi script that calculates the
number of days left and creates a 307 redirect to the appropriate image.
I prepared some images and you can try it out:

<img src="http://teythoon.cryptobitch.de/cgi-bin/wine-countdown.py"
     alt="Wine 1.0 countdown" />

The images could use some fine tuning, feedback is always welcome :). I
couldn't find much about "official" wine artwork, I searched the wiki
for "artwork" and "logo" and googling for "wine artwork" didn't yield
any useful information either ;). The images I found were in the
website.git module...

Cheers,
Justus
- --
gpg key fingerprint: C82D 382A AB38 1A54 5290  19D6 A0F9 B035 686C 6996
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFIDcRjoPmwNWhsaZYRAhlbAJ9xksvA0TS4H9Q8ZEEmx469yeyfIgCfbZzO
LQGrNLOKHT27aNf+/eJAlEg=
=1cnU
-----END PGP SIGNATURE-----


From reif at earthlink.net  Tue Apr 22 05:55:52 2008
From: reif at earthlink.net (Robert Reif)
Date: Tue, 22 Apr 2008 06:55:52 -0400
Subject: winmm/tests: waveOutGetDevCaps called with invalid size
In-Reply-To: <Pine.LNX.4.64.0804220842440.29058@maggie.lkpg.cendio.se>
References: <Pine.LNX.4.64.0804181102080.23847@maggie.lkpg.cendio.se>	<4808B145.2010609@earthlink.net>	<Pine.LNX.4.64.0804211050260.12791@maggie.lkpg.cendio.se>	<480D12B1.3070309@earthlink.net>
	<Pine.LNX.4.64.0804220842440.29058@maggie.lkpg.cendio.se>
Message-ID: <480DC438.7010107@earthlink.net>

Peter ?strand wrote:
> However, I still think it's VERY strange to expect success from an 
> invalid call. You are describing it as an "invalid argument" yourself. 
> Why should we expect a call with an "invalid argument" to succeed? And 
> again, the test does NOT pass on all Microsoft versions; it fails on 
> Terminal Servers.
If size wasn't relevant, it wouldn't be passed.  There are only two 
options: only pass the number of bytes requested or return an error for 
unreasonable sizes.  What is Terminal Server doing?  You can check for 
the error return code if that's what it's doing and add it to the return 
values checked.  If it's doing something silly like ignoring the size 
and overrunning the buffer, then it's broken and needs to be black 
listed.  A page for the buffer can be allocated with a guard page after 
it to catch buffer overruns if necessary.
> If the point is to verify that waveOutGetDevCaps doesn't write more 
> than the size supplied, this should be verified. I'd also like to 
> point out that the Wine implementation also doesn't handle this 
> correctly: Only waveOutGetDevCapsA does a memcpy() using the size 
> argument; waveOutGetDevCapsW does not.
>
waveOutGetDevCapsW lets the driver do the copy (just like old versions 
of windows).  The driver should be checking the size and only copying 
that much.  If it doesn't, then it broken.


From hverbeet at gmail.com  Tue Apr 22 06:06:48 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Tue, 22 Apr 2008 13:06:48 +0200
Subject: Spelling fixes
In-Reply-To: <b6bb06270804212319g4875f1dev395d5651a7dba55d@mail.gmail.com>
References: <b6bb06270804212319g4875f1dev395d5651a7dba55d@mail.gmail.com>
Message-ID: <d658b69e0804220406h60d0c7ecj3a60bd84da0fecd9@mail.gmail.com>

On 22/04/2008, Austin English <austinenglish at gmail.com> wrote:
> -    /* Declare loop registers aLx */
> +    /* Declare loop registers alx */
>      for (i = 0; i < reg_maps->loop_depth; i++) {
>          shader_addline(buffer, "int aL%u;\n", i);
>          shader_addline(buffer, "int tmpInt%u;\n", i);
As can be seen a few lines down, the registers are declared as "aL%u".


From mle+win at mega-nerd.com  Tue Apr 22 06:11:25 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Tue, 22 Apr 2008 21:11:25 +1000
Subject: Wine64 : initializer element is not computable at load time?
Message-ID: <20080422211125.7c056bc1.mle+win@mega-nerd.com>

Hi all,

I'm compiling wine on x86-64 after configuring with --enable-win64
and I get the error:

    irotp.c:54: error: initializer element is not computable at load time
    irotp.c:54: error: (near initialization for 'critsect_debug.Spare[0]')

on this this code:

    51: static CRITICAL_SECTION_DEBUG critsect_debug =
    52: {
    53:    0, 0, &csRunningObjectTable,
    53:    { &critsect_debug.ProcessLocksList, &critsect_debug.ProcessLocksList },
    54:      0, 0, { (DWORD_PTR)(__FILE__ ": csRunningObjectTable") }
    55: };

Anybody understand why?

Cheers,
Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
"I'm not even an atheist so much as I am an antitheist; I not
only maintain that all religions are versions of the same
untruth, but I hold that the influence of churches, and the
effect of religious belief, is positively harmful."
-- Christopher Hitchens in "Letters to a Young Contrarian" 2001


From paul.vriens.wine at gmail.com  Tue Apr 22 06:38:13 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Tue, 22 Apr 2008 13:38:13 +0200
Subject: gdi32: Make the bitmap test pass under Windows 2000. Take 2
In-Reply-To: <E1JoGj7-0002zO-IP@mail.codeweavers.com>
References: <E1JoGj7-0002zO-IP@mail.codeweavers.com>
Message-ID: <480DCE25.8010107@gmail.com>

Dmitry Timoshkov wrote:
> Hello,
> 
> here is another version of the patch.
> --
> 
> According to test.winehq.ord data Windows 2000 behaves weird in some tests,
> this looks like a bug to me. This patch addresses these failures.
> 
> Changelog:
>     gdi32: Make the bitmap test pass under Windows 2000.
> ---
>  dlls/gdi32/tests/bitmap.c |   28 ++++++++++++++++------------
>  1 files changed, 16 insertions(+), 12 deletions(-)
> 
> diff --git a/dlls/gdi32/tests/bitmap.c b/dlls/gdi32/tests/bitmap.c
> index f7bfdfd..ba4f8bd 100644
> --- a/dlls/gdi32/tests/bitmap.c
> +++ b/dlls/gdi32/tests/bitmap.c
> @@ -276,7 +276,7 @@ static void test_dib_info(HBITMAP hbm, const void *bits, const BITMAPINFOHEADER
>  {
>      BITMAP bm;
>      DIBSECTION ds;
> -    INT ret, width_bytes;
> +    INT ret, bm_width_bytes, dib_width_bytes;
>      BYTE *buf;
>  
>      ret = GetObject(hbm, sizeof(bm), &bm);
> @@ -285,23 +285,25 @@ static void test_dib_info(HBITMAP hbm, const void *bits, const BITMAPINFOHEADER
>      ok(bm.bmType == 0, "wrong bm.bmType %d\n", bm.bmType);
>      ok(bm.bmWidth == bmih->biWidth, "wrong bm.bmWidth %d\n", bm.bmWidth);
>      ok(bm.bmHeight == bmih->biHeight, "wrong bm.bmHeight %d\n", bm.bmHeight);
> -    width_bytes = DIB_GetWidthBytes(bm.bmWidth, bm.bmBitsPixel);
> -    ok(bm.bmWidthBytes == width_bytes, "wrong bm.bmWidthBytes %d != %d\n", bm.bmWidthBytes, width_bytes);
> +    dib_width_bytes = DIB_GetWidthBytes(bm.bmWidth, bm.bmBitsPixel);
> +    bm_width_bytes = BITMAP_GetWidthBytes(bm.bmWidth, bm.bmBitsPixel);
> +    if (bm.bmWidthBytes != dib_width_bytes) /* Win2k bug */
> +        ok(bm.bmWidthBytes == bm_width_bytes, "wrong bm.bmWidthBytes %d != %d\n", bm.bmWidthBytes, bm_width_bytes);
> +    else
> +        ok(bm.bmWidthBytes == dib_width_bytes, "wrong bm.bmWidthBytes %d != %d\n", bm.bmWidthBytes, dib_width_bytes);
>      ok(bm.bmPlanes == bmih->biPlanes, "wrong bm.bmPlanes %d\n", bm.bmPlanes);
>      ok(bm.bmBitsPixel == bmih->biBitCount, "bm.bmBitsPixel %d != %d\n", bm.bmBitsPixel, bmih->biBitCount);
>      ok(bm.bmBits == bits, "wrong bm.bmBits %p != %p\n", bm.bmBits, bits);
>  
>      buf = HeapAlloc(GetProcessHeap(), 0, bm.bmWidthBytes * bm.bmHeight + 4096);
>  
> -    width_bytes = BITMAP_GetWidthBytes(bm.bmWidth, bm.bmBitsPixel);
> -
>      /* GetBitmapBits returns not 32-bit aligned data */
>      ret = GetBitmapBits(hbm, 0, NULL);
> -    ok(ret == width_bytes * bm.bmHeight, "%d != %d\n", ret, width_bytes * bm.bmHeight);
> +    ok(ret == bm_width_bytes * bm.bmHeight, "%d != %d\n", ret, bm_width_bytes * bm.bmHeight);
>  
>      memset(buf, 0xAA, bm.bmWidthBytes * bm.bmHeight + 4096);
>      ret = GetBitmapBits(hbm, bm.bmWidthBytes * bm.bmHeight + 4096, buf);
> -    ok(ret == width_bytes * bm.bmHeight, "%d != %d\n", ret, width_bytes * bm.bmHeight);
> +    ok(ret == bm_width_bytes * bm.bmHeight, "%d != %d\n", ret, bm_width_bytes * bm.bmHeight);
>  
>      HeapFree(GetProcessHeap(), 0, buf);
>  
> @@ -331,8 +333,9 @@ static void test_dib_info(HBITMAP hbm, const void *bits, const BITMAPINFOHEADER
>      ok(ret == sizeof(ds), "wrong size %d\n", ret);
>  
>      ok(ds.dsBm.bmBits == bits, "wrong bm.bmBits %p != %p\n", ds.dsBm.bmBits, bits);
> -    ok(ds.dsBmih.biSizeImage == ds.dsBm.bmWidthBytes * ds.dsBm.bmHeight, "%u != %u\n",
> -       ds.dsBmih.biSizeImage, ds.dsBm.bmWidthBytes * ds.dsBm.bmHeight);
> +    if (ds.dsBm.bmWidthBytes != bm_width_bytes) /* Win2k bug */
> +        ok(ds.dsBmih.biSizeImage == ds.dsBm.bmWidthBytes * ds.dsBm.bmHeight, "%u != %u\n",
> +           ds.dsBmih.biSizeImage, ds.dsBm.bmWidthBytes * ds.dsBm.bmHeight);
>      ok(bmih->biSizeImage == 0, "%u != 0\n", bmih->biSizeImage);
>      ds.dsBmih.biSizeImage = 0;
>  
> @@ -968,14 +971,15 @@ static void test_bitmap(void)
>      assert(hdc != 0);
>  
>      SetLastError(0xdeadbeef);
> -    hbmp = CreateBitmap(0x7ffffff, 1, 1, 1, NULL);
> -    ok(hbmp != 0, "CreateBitmap should not fail\n");
> +    hbmp = CreateBitmap(0x7fff, 0x7fff, 1, 1, NULL);
> +    ok(hbmp != 0, "CreateBitmap error %u\n", GetLastError());
>      DeleteObject(hbmp);
>  

Hi Dmitry,

This one will fail at least on my VMware box. Shouldn't the test (and it's 
confirmed by James and me) include something like:

ok(hbmp!=0 || (hbmp == 0 && GetLastError() == ERROR_NOT_ENOUGH_MEMORY), ....)

-- 
Cheers,

Paul.


From wine-devel at kievinfo.com  Tue Apr 22 09:33:20 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Tue, 22 Apr 2008 08:33:20 -0600
Subject: Removinig CVS/GIT version from bugzilla
Message-ID: <480DF730.6030006@kievinfo.com>

I'm copying my response here to continue the conversation.

Please don't remove cvs/git version.

What should be done is:
1. Leave old bugs alone or modify them case-by-case
2. All bugs with "cvs/git" version from now on can be filed on the 
development branch between releases only.
3. After the next release, if the bug is still present, modify version to 
that release. Of course no modifying of old bugs.


Vitaliy.


From ovek at arcticnet.no  Tue Apr 22 09:33:43 2008
From: ovek at arcticnet.no (Ove Kaaven)
Date: Tue, 22 Apr 2008 16:33:43 +0200
Subject: Wine64 : initializer element is not computable at load time?
In-Reply-To: <20080422211125.7c056bc1.mle+win@mega-nerd.com>
References: <20080422211125.7c056bc1.mle+win@mega-nerd.com>
Message-ID: <480DF747.3080209@arcticnet.no>

Erik de Castro Lopo skrev:
> Anybody understand why?

You could look up the definition of RTL_CRITICAL_SECTION_DEBUG in 
include/winnt.h. Then realize that __WINESRC__ is only defined for stuff 
in dlls/, not for stuff in programs/, which should make the type 
mismatch clear.




From dmitry at codeweavers.com  Tue Apr 22 09:43:52 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Tue, 22 Apr 2008 23:43:52 +0900
Subject: gdi32: Make the bitmap test pass under Windows 2000. Take 2
References: <E1JoGj7-0002zO-IP@mail.codeweavers.com>
	<480DCE25.8010107@gmail.com>
Message-ID: <008a01c8a487$4ade9320$a600fea9@DMITRY>

"Paul Vriens" <paul.vriens.wine at gmail.com> wrote:

>>      SetLastError(0xdeadbeef);
>> -    hbmp = CreateBitmap(0x7ffffff, 1, 1, 1, NULL);
>> -    ok(hbmp != 0, "CreateBitmap should not fail\n");
>> +    hbmp = CreateBitmap(0x7fff, 0x7fff, 1, 1, NULL);
>> +    ok(hbmp != 0, "CreateBitmap error %u\n", GetLastError());
>>      DeleteObject(hbmp);
>>  
> 
> Hi Dmitry,
> 
> This one will fail at least on my VMware box. Shouldn't the test (and it's 
> confirmed by James and me) include something like:
> 
> ok(hbmp!=0 || (hbmp == 0 && GetLastError() == ERROR_NOT_ENOUGH_MEMORY), ....)

Why will it fail? According to James (and you confirmed it):

> The maximum values for both width and height on win2k is 32767.
> Anything above that on either parameter returns
> ERROR_INVALID_PARAMETER.  Both params can be 32767 at the same time
> and the call will still succeed (assuming there's enough memory left).

-- 
Dmitry.


From dmitry at codeweavers.com  Tue Apr 22 09:50:05 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Tue, 22 Apr 2008 23:50:05 +0900
Subject: Fix "warning: cast from pointer to integer of different size"
References: <20080422222441.b042f27b.mle+win@mega-nerd.com>
Message-ID: <00b501c8a488$296854f0$a600fea9@DMITRY>

"Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:

> /* get pointer to object containing list element */
> #define LIST_ENTRY(elem, type, field) \
> -    ((type *)((char *)(elem) - (unsigned int)(&((type *)0)->field)))
> +    ((type *)((char *)(elem) - (unsigned long)(&((type *)0)->field)))

It should be replaced with FIELD_OFFSET instead.

-- 
Dmitry.


From paul.vriens.wine at gmail.com  Tue Apr 22 10:03:29 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Tue, 22 Apr 2008 17:03:29 +0200
Subject: gdi32: Make the bitmap test pass under Windows 2000. Take 2
In-Reply-To: <008a01c8a487$4ade9320$a600fea9@DMITRY>
References: <E1JoGj7-0002zO-IP@mail.codeweavers.com>
	<480DCE25.8010107@gmail.com>
	<008a01c8a487$4ade9320$a600fea9@DMITRY>
Message-ID: <480DFE41.50906@gmail.com>

Dmitry Timoshkov wrote:
> "Paul Vriens" <paul.vriens.wine at gmail.com> wrote:
> 
>>>      SetLastError(0xdeadbeef);
>>> -    hbmp = CreateBitmap(0x7ffffff, 1, 1, 1, NULL);
>>> -    ok(hbmp != 0, "CreateBitmap should not fail\n");
>>> +    hbmp = CreateBitmap(0x7fff, 0x7fff, 1, 1, NULL);
>>> +    ok(hbmp != 0, "CreateBitmap error %u\n", GetLastError());
>>>      DeleteObject(hbmp);
>>>  
>>
>> Hi Dmitry,
>>
>> This one will fail at least on my VMware box. Shouldn't the test (and 
>> it's confirmed by James and me) include something like:
>>
>> ok(hbmp!=0 || (hbmp == 0 && GetLastError() == 
>> ERROR_NOT_ENOUGH_MEMORY), ....)
> 
> Why will it fail? According to James (and you confirmed it):
> 
>> The maximum values for both width and height on win2k is 32767.
>> Anything above that on either parameter returns
>> ERROR_INVALID_PARAMETER.  Both params can be 32767 at the same time
>> and the call will still succeed (assuming there's enough memory left).
> 
It's that last piece: "assuming there's enough memory left".

-- 
Cheers,

Paul.


From dmitry at codeweavers.com  Tue Apr 22 10:11:39 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Wed, 23 Apr 2008 00:11:39 +0900
Subject: gdi32: Make the bitmap test pass under Windows 2000. Take 2
References: <E1JoGj7-0002zO-IP@mail.codeweavers.com>
	<480DCE25.8010107@gmail.com>
	<008a01c8a487$4ade9320$a600fea9@DMITRY> <480DFE41.50906@gmail.com>
Message-ID: <018301c8a48b$2c4ad410$a600fea9@DMITRY>

"Paul Vriens" <paul.vriens.wine at gmail.com> wrote:

>>> This one will fail at least on my VMware box. Shouldn't the test (and 
>>> it's confirmed by James and me) include something like:
>>>
>>> ok(hbmp!=0 || (hbmp == 0 && GetLastError() == 
>>> ERROR_NOT_ENOUGH_MEMORY), ....)
>> 
>> Why will it fail? According to James (and you confirmed it):
>> 
>>> The maximum values for both width and height on win2k is 32767.
>>> Anything above that on either parameter returns
>>> ERROR_INVALID_PARAMETER.  Both params can be 32767 at the same time
>>> and the call will still succeed (assuming there's enough memory left).
>> 
> It's that last piece: "assuming there's enough memory left".

That's a valid assumption I'd guess, and a lot of tests already rely
on this: every thing which indirectly or directly allocates memory,
creates windows, objects, processes, etc.

-- 
Dmitry.


From paul.vriens.wine at gmail.com  Tue Apr 22 10:47:47 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Tue, 22 Apr 2008 17:47:47 +0200
Subject: gdi32: Make the bitmap test pass under Windows 2000. Take 2
In-Reply-To: <018301c8a48b$2c4ad410$a600fea9@DMITRY>
References: <E1JoGj7-0002zO-IP@mail.codeweavers.com>
	<480DCE25.8010107@gmail.com>
	<008a01c8a487$4ade9320$a600fea9@DMITRY> <480DFE41.50906@gmail.com>
	<018301c8a48b$2c4ad410$a600fea9@DMITRY>
Message-ID: <480E08A3.3010207@gmail.com>

Dmitry Timoshkov wrote:
> "Paul Vriens" <paul.vriens.wine at gmail.com> wrote:
> 
>>>> This one will fail at least on my VMware box. Shouldn't the test 
>>>> (and it's confirmed by James and me) include something like:
>>>>
>>>> ok(hbmp!=0 || (hbmp == 0 && GetLastError() == 
>>>> ERROR_NOT_ENOUGH_MEMORY), ....)
>>>
>>> Why will it fail? According to James (and you confirmed it):
>>>
>>>> The maximum values for both width and height on win2k is 32767.
>>>> Anything above that on either parameter returns
>>>> ERROR_INVALID_PARAMETER.  Both params can be 32767 at the same time
>>>> and the call will still succeed (assuming there's enough memory left).
>>>
>> It's that last piece: "assuming there's enough memory left".
> 
> That's a valid assumption I'd guess, and a lot of tests already rely
> on this: every thing which indirectly or directly allocates memory,
> creates windows, objects, processes, etc.
> 
But the test doesn't cater for that.

If I run the test with several heights on my win2k box the maximum I can have is:

CreateBitmap(0x7fff,0x2e63, ...

before it fails with ERROR_NOT_ENOUGH_MEMORY.

This of course differs on every run. My point is that ERROR_NOT_ENOUGH_MEMORY is 
totally valid and should be catered for in the test otherwise we would still 
have failures for this test.

-- 
Cheers,

Paul.


From msclrhd at googlemail.com  Tue Apr 22 04:07:10 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Tue, 22 Apr 2008 10:07:10 +0100
Subject: winehq.org redesign
In-Reply-To: <20080422023415.48a311e3.buzzilo@gmail.com>
References: <20080422023415.48a311e3.buzzilo@gmail.com>
Message-ID: <3f4fd2640804220207w31c3d08aj40f5c7d394008de6@mail.gmail.com>

2008/4/21 Evgeny Burzak <buzzilo at gmail.com>:
> Hello all,
>  some times ago I make design for AppDB  (http://buzz.ulx.ru/pf/appdb.png). Folks was  delighted with this one, but managers rejected my idea due to needs redesign everything then.
>  But now it may be more actual then ever owing to Wine 1.0 release? I think it may gain attention from professionals who wants to use wine in production environment and improve Wine.
>  I can make design for main pages, xml/xslt template and probably base php5 clasess if you decide to change site engine.

I personally like it overall and agree that this makes sense for a
Wine 1.0 release.

Comments:

*  There is no default screenshot of applications shown in your
mockup, as they are in the current appdb.

*  It would also be nice if the website could retain its red colour theme.

*  I don't really like the coloured boxes on the Wine image, but I do
like the 3D wine bottle. It would look better if you did away with the
squares and shifted the logo to the left.

*  The CodeWeavers logo should remain as is. Also, since CodeWeavers
are hosting WineHQ I don't see why it should have the 'advertisement'
label.

- Reece


From msclrhd at googlemail.com  Tue Apr 22 07:06:45 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Tue, 22 Apr 2008 13:06:45 +0100
Subject: gdi32: Make the bitmap test pass under Windows 2000. Take 2
In-Reply-To: <480DCE25.8010107@gmail.com>
References: <E1JoGj7-0002zO-IP@mail.codeweavers.com>
	<480DCE25.8010107@gmail.com>
Message-ID: <3f4fd2640804220506t5db12a78g463e2e3fd650598d@mail.gmail.com>

2008/4/22 Paul Vriens <paul.vriens.wine at gmail.com>:
>  Hi Dmitry,
>
>  This one will fail at least on my VMware box. Shouldn't the test (and it's
>  confirmed by James and me) include something like:
>
>  ok(hbmp!=0 || (hbmp == 0 && GetLastError() == ERROR_NOT_ENOUGH_MEMORY), ....)

I would say something more like this:

    ok( (hbmp != 0 && GetLastError() == ERROR_INVALID_PARAMETER) /* Win2K */
       || (hbmp == 0 && GetLastError() == ERROR_NOT_ENOUGH_MEMORY) /* XP */,
       ... )

Since the hbmp value and the GetLastError code are related together.

- Reece


From austinenglish at gmail.com  Tue Apr 22 11:29:16 2008
From: austinenglish at gmail.com (Austin English)
Date: Tue, 22 Apr 2008 11:29:16 -0500
Subject: Documentation updating / XML?
In-Reply-To: <87iqya2nke.fsf@wine.dyndns.org>
References: <b6bb06270804212002h73a55f23i1ce083af2dbd3150@mail.gmail.com>
	<87iqya2nke.fsf@wine.dyndns.org>
Message-ID: <b6bb06270804220929x30dbaf6ftc9f056ac372a0b85@mail.gmail.com>

On Tue, Apr 22, 2008 at 5:25 AM, Alexandre Julliard <julliard at winehq.org>
wrote:

> "Austin English" <austinenglish at gmail.com> writes:
>
> > I've been working on some of the documentation, then remembered that
> Scott
> > requested a move to XML:
> > http://bugs.winehq.org/show_bug.cgi?id=12217
> >
> > There are quite a few programs to convert SGML to XML, and I've got a
> bit of
> > time to kill. Alexandre, would you accept a move to XML, or would this
> be a
> > waste of time?
>
> I don't really care about the format as long as there are decent tools
> to generate all the outputs we want. Considering the state of SGML tools
> it's probably not hard to do better...
>
> --
> Alexandre Julliard
> julliard at winehq.org
>

Web/html/PDF/XML?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080422/4bac207b/attachment-0001.htm 

From austinenglish at gmail.com  Tue Apr 22 11:29:16 2008
From: austinenglish at gmail.com (Austin English)
Date: Tue, 22 Apr 2008 11:29:16 -0500
Subject: Documentation updating / XML?
In-Reply-To: <87iqya2nke.fsf@wine.dyndns.org>
References: <b6bb06270804212002h73a55f23i1ce083af2dbd3150@mail.gmail.com>
	<87iqya2nke.fsf@wine.dyndns.org>
Message-ID: <b6bb06270804220929x30dbaf6ftc9f056ac372a0b85@mail.gmail.com>

On Tue, Apr 22, 2008 at 5:25 AM, Alexandre Julliard <julliard at winehq.org>
wrote:

> "Austin English" <austinenglish at gmail.com> writes:
>
> > I've been working on some of the documentation, then remembered that
> Scott
> > requested a move to XML:
> > http://bugs.winehq.org/show_bug.cgi?id=12217
> >
> > There are quite a few programs to convert SGML to XML, and I've got a
> bit of
> > time to kill. Alexandre, would you accept a move to XML, or would this
> be a
> > waste of time?
>
> I don't really care about the format as long as there are decent tools
> to generate all the outputs we want. Considering the state of SGML tools
> it's probably not hard to do better...
>
> --
> Alexandre Julliard
> julliard at winehq.org
>

Web/html/PDF/XML?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080422/4bac207b/attachment-0002.htm 

From l_bratch at yahoo.co.uk  Tue Apr 22 11:15:53 2008
From: l_bratch at yahoo.co.uk (Luke Bratch)
Date: Tue, 22 Apr 2008 16:15:53 +0000 (GMT)
Subject: wine-announce and wine-users getting hammered
Message-ID: <138291.26516.qm@web26004.mail.ukl.yahoo.com>

Hi

I do the moderation for these lists, and wine-accounce and wine-users are getting absolutely hammered with notification error messages today (in the order of around 15 per minute all day long).

I've been clearing these out, but perhaps this is an indication of someone targeting these lists?

Luke


      __________________________________________________________
Sent from Yahoo! Mail.
A Smarter Email http://uk.docs.yahoo.com/nowyoucan.html


From juan.lang at gmail.com  Tue Apr 22 13:00:22 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Tue, 22 Apr 2008 11:00:22 -0700
Subject: [PATCH 05/21] [WinHelp]: properly handle the back button (in
	multiple windows, in empty stack...)
Message-ID: <3a768c550804221100m69cd23cfu2cd907fbd3bfcdd8@mail.gmail.com>

+ *		WINHELP_DeleteButtons
+ *
+ */
+void WINHELP_DeleteBackSet(WINHELP_WINDOW* win)

Nit:  the comment should match the function.
--Juan


From juan.lang at gmail.com  Tue Apr 22 13:00:22 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Tue, 22 Apr 2008 11:00:22 -0700
Subject: [PATCH 05/21] [WinHelp]: properly handle the back button (in
	multiple windows, in empty stack...)
Message-ID: <3a768c550804221100m69cd23cfu2cd907fbd3bfcdd8@mail.gmail.com>

+ *		WINHELP_DeleteButtons
+ *
+ */
+void WINHELP_DeleteBackSet(WINHELP_WINDOW* win)

Nit:  the comment should match the function.
--Juan


From frank.richter at gmail.com  Tue Apr 22 13:32:51 2008
From: frank.richter at gmail.com (Frank Richter)
Date: Tue, 22 Apr 2008 20:32:51 +0200
Subject: Alex =?UTF-8?B?VmlsbGFjw61zIExhc3NvIDogdXh0aGVtZTogICBTcGVlZA==?=
	=?UTF-8?B?IHVwIFVYVEhFTUVfU2l6ZWRCbHQgaW4gdGhlIFNUX1RJTEUgYnkgYnVpbGRpbmc=?=
	=?UTF-8?B?IGFuICAgYXBwcm9wcmlhdGVseS1zaXplZCBtZW1vcnkgYml0bWFwIG91dCBvZiA=?=
	=?UTF-8?B?dGhlIHRpbGUgaW5zdGVhZCBvZiAgIGl0ZXJhdGluZyB3aXRoIFVYVEhFTUVfQmw=?=
	=?UTF-8?B?dCAoKSBkaXJlY3RseS4=?=
In-Reply-To: <E1JoGyB-0001fK-TB@wine.codeweavers.com>
References: <E1JoGyB-0001fK-TB@wine.codeweavers.com>
Message-ID: <480E2F53.9070401@gmail.com>

On 22.04.2008 13:47, Alexandre Julliard wrote:
> uxtheme: Speed up UXTHEME_SizedBlt in the ST_TILE by building an appropriately-sized memory bitmap out of the tile instead of iterating with UXTHEME_Blt() directly.

But does that keep the alpha channel intact?

-f.r.


From eric.pouech at orange.fr  Tue Apr 22 14:58:12 2008
From: eric.pouech at orange.fr (Eric Pouech)
Date: Tue, 22 Apr 2008 21:58:12 +0200
Subject: [PATCH 01/21] [WinHelp]: get rid of the reuse concept for Windows
	and refactor the code a bit for window creation / deletion
In-Reply-To: <87mynm2nxu.fsf@wine.dyndns.org>
References: <20080421190145.12982.57452.stgit@localhost>	<20080421190646.12982.96067.stgit@localhost>
	<87mynm2nxu.fsf@wine.dyndns.org>
Message-ID: <480E4354.3050209@orange.fr>

Alexandre Julliard a ?crit :
> Eric Pouech <eric.pouech at orange.fr> writes:
>
>   
>>  programs/winhelp/winhelp.c |  257 ++++++++++++++++++++------------------------
>>  1 files changed, 116 insertions(+), 141 deletions(-)
>>     
>
> This breaks window repaints for me, when switching pages the window is
> not repainted and still shows the old page.
>
>   
actually, not really... it works when you click a second time on the 
same hyperlink
that should be considered as a semi-conscious user-interface enhancement 
in order to help users switch to the new interface <g>
I'll resend the lot with a fix
A+

-- 
Eric Pouech
"The problem with designing something completely foolproof is to underestimate the ingenuity of a complete idiot." (Douglas Adams)




From mle+win at mega-nerd.com  Tue Apr 22 15:53:22 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Wed, 23 Apr 2008 06:53:22 +1000
Subject: Fix "warning: cast from pointer to integer of different size"
In-Reply-To: <00b501c8a488$296854f0$a600fea9@DMITRY>
References: <20080422222441.b042f27b.mle+win@mega-nerd.com>
	<00b501c8a488$296854f0$a600fea9@DMITRY>
Message-ID: <20080423065322.3938d77c.mle+win@mega-nerd.com>

Dmitry Timoshkov wrote:

> "Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:
> 
> > /* get pointer to object containing list element */
> > #define LIST_ENTRY(elem, type, field) \
> > -    ((type *)((char *)(elem) - (unsigned int)(&((type *)0)->field)))
> > +    ((type *)((char *)(elem) - (unsigned long)(&((type *)0)->field)))
> 
> It should be replaced with FIELD_OFFSET instead.

FIELD_OFFSET is defined in include/winnt.h. 

Now I could include winnt.h into include/wine/list.h but that doesn't
seem right. I could also copy it,but having two difinitions of the
same macro is also not right. I'm also sure that moving the definition
from include/winnt.h to include/wine/list.h will break existing code.

Any suggestions for dealing with this?

Cheers,
Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
"The Internet interprets censorship as damage, and routes around it."
  -- John Gilmore


From mle+win at mega-nerd.com  Tue Apr 22 16:26:17 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Wed, 23 Apr 2008 07:26:17 +1000
Subject: Wine64 : initializer element is not computable at load time?
In-Reply-To: <480DF747.3080209@arcticnet.no>
References: <20080422211125.7c056bc1.mle+win@mega-nerd.com>
	<480DF747.3080209@arcticnet.no>
Message-ID: <20080423072617.76332e3d.mle+win@mega-nerd.com>

Ove Kaaven wrote:

> Erik de Castro Lopo skrev:
> > Anybody understand why?
> 
> You could look up the definition of RTL_CRITICAL_SECTION_DEBUG in 
> include/winnt.h. Then realize that __WINESRC__ is only defined for stuff 
> in dlls/, not for stuff in programs/, which should make the type 
> mismatch clear.

The error message says nothing about a type mismatch its complaining
about something not being compulatble a load time.

In include/winnt.h we have:

    #ifdef __WINESRC__  /* in Wine we store the name here */
      DWORD_PTR Spare[8/sizeof(DWORD_PTR)];
    #else
      DWORD Spare[ 2 ];
    #endif

and the code tries to initialize Spare with this:

    { (DWORD_PTR)(__FILE__ ": csRunningObjectTable") }

That makes me suspect that the non  __WINESRC__ definition
is wrong and that the whole #ifdef above could be replaced
with 

      DWORD_PTR Spare[8/sizeof(DWORD_PTR)];

Is that right?

Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
"Copyrighting allows people to benefit from their labours,
but software patents allow the companies with the largest
legal departments to benefit from everyone else's work."
-- Andrew Brown
(http://www.guardian.co.uk/online/comment/story/0,12449,1387575,00.html)


From scott at open-vote.org  Tue Apr 22 16:28:30 2008
From: scott at open-vote.org (Scott Ritchie)
Date: Tue, 22 Apr 2008 14:28:30 -0700
Subject: Removinig CVS/GIT version from bugzilla
In-Reply-To: <480DF730.6030006@kievinfo.com>
References: <480DF730.6030006@kievinfo.com>
Message-ID: <480E587E.3070209@open-vote.org>

Vitaliy Margolen wrote:
> 3. After the next release, if the bug is still present, modify version to 
> that release. Of course no modifying of old bugs.
> 

Sounds like a simple addition to Alexandre's (scripted?) closing of all
fixed bugs on release day.

Thanks,
Scott Ritchie


From austinenglish at gmail.com  Tue Apr 22 16:36:27 2008
From: austinenglish at gmail.com (Austin English)
Date: Tue, 22 Apr 2008 16:36:27 -0500
Subject: SOC 2008 Projects Announced
Message-ID: <b6bb06270804221436s5dfab6fctbe89047e55b4a8e9@mail.gmail.com>

For those of you who haven't heard yet, the Google SOC Projects were
announced today:
http://google-opensource.blogspot.com/2008/04/announcing-accepted-student-proposals.html

5 Wine projects have been accepted:
http://code.google.com/soc/2008/wine/about.html

  <http://code.google.com/soc/2008/wine/about.html#>Improving Wine MSXML
implementation
<http://code.google.com/soc/2008/wine/appinfo.html?csaid=A546A592C8ACDDD5>
 by Piotr Caban, mentored by James Hawkins
  Print Dialog
<http://code.google.com/soc/2008/wine/appinfo.html?csaid=7CC6A70D0D7A1FDE>
 by Gal Topper, mentored by Detlef Riekenberg
   <http://code.google.com/soc/2008/wine/about.html#> Implementing proper
Control Panel support for Wine
<http://code.google.com/soc/2008/wine/appinfo.html?csaid=8B4254855F2BD854>
 by Owen Rudge, mentored by Juan Lang
   <http://code.google.com/soc/2008/wine/about.html#> DirectPlay
implementation
<http://code.google.com/soc/2008/wine/appinfo.html?csaid=984D708DA20ACA94>
 by Ismael Barros Barros, mentored by Kai Blin
  Wine - Richedit with Tables
<http://code.google.com/soc/2008/wine/appinfo.html?csaid=7D1930729985958C>
 by Dylan Andrew Harper Smith, mentored by Huw D M Davies
   <http://code.google.com/soc/2008/wine/about.html#> Improve Gdi+
Implemenation
<http://code.google.com/soc/2008/wine/appinfo.html?csaid=7BE88570BACC2046>
 by Adam Joel Petaccia, mentored by Lei Zhang

Thanks to all those who applied and congrats to those who were accepted!

Now get hacking ;-).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080422/7e30514a/attachment.htm 

From scott at open-vote.org  Tue Apr 22 16:59:00 2008
From: scott at open-vote.org (Scott Ritchie)
Date: Tue, 22 Apr 2008 14:59:00 -0700
Subject: winehq.org redesign
In-Reply-To: <20080422023415.48a311e3.buzzilo@gmail.com>
References: <20080422023415.48a311e3.buzzilo@gmail.com>
Message-ID: <480E5FA4.7080404@open-vote.org>

Evgeny Burzak wrote:
> Hello all,
> some times ago I make design for AppDB  (http://buzz.ulx.ru/pf/appdb.png). Folks was  delighted with this one, but managers rejected my idea due to needs redesign everything then. 
> But now it may be more actual then ever owing to Wine 1.0 release? I think it may gain attention from professionals who wants to use wine in production environment and improve Wine.
> I can make design for main pages, xml/xslt template and probably base php5 clasess if you decide to change site engine.
> 

Why do we even have a top 10 gold and top 10 silver list anyway?  Why
not just a top 30 platinum list based on popularity?

Also, it's not made clear how an application gets into the top 10.
Intuitively, a top 10 list for the front page would be a list of the top
10 most popular applications to run with Wine (perhaps judged by AppDB
hits).

If it's based on votes, then how are any platinum applications there?
Votes are supposed to indicate "I want more work done on this
application" rather than "I like this application" -- that's why votes
for platinum applications were supposed to disintegrate.  We already
have a separate list for the top voted applications.


Regarding the design itself, the colored boxes remind me more of a
children's party than a useful piece of software.  If you want to add
color to the page, it seems like there are other ways to do it without
calling garish attention to the Wine logo.

That said, winehq and appdb definitely need a new redesign, and I'm very
happy you've offered to help.

Thanks,
Scott Ritchie


From alex at thehandofagony.com  Tue Apr 22 17:06:16 2008
From: alex at thehandofagony.com (Alexander Nicolaysen =?iso-8859-1?q?S=F8rnes?=)
Date: Wed, 23 Apr 2008 00:06:16 +0200
Subject: winehq.org redesign
In-Reply-To: <20080422023415.48a311e3.buzzilo@gmail.com>
References: <20080422023415.48a311e3.buzzilo@gmail.com>
Message-ID: <200804230006.17192.alex@thehandofagony.com>

> Hello all,
> some times ago I make design for AppDB  (http://buzz.ulx.ru/pf/appdb.png).
> Folks was  delighted with this one, but managers rejected my idea due to
> needs redesign everything then. But now it may be more actual then ever
> owing to Wine 1.0 release? I think it may gain attention from professionals
> who wants to use wine in production environment and improve Wine. I can
> make design for main pages, xml/xslt template and probably base php5
> clasess if you decide to change site engine.
>
> --
> Evgeny


Thanks for the design and for bringing it up again!  It certainly contains a 
lot of good ideas about how the site can be improved.



Alexander N. S?rnes


From research at science.su  Tue Apr 22 17:18:21 2008
From: research at science.su (L. Rahyen)
Date: Tue, 22 Apr 2008 22:18:21 +0000
Subject: winehq.org redesign
In-Reply-To: <3f4fd2640804220207w31c3d08aj40f5c7d394008de6@mail.gmail.com>
References: <20080422023415.48a311e3.buzzilo@gmail.com>
	<3f4fd2640804220207w31c3d08aj40f5c7d394008de6@mail.gmail.com>
Message-ID: <200804222218.21375.research@science.su>

On Tuesday April 22 2008 09:07:10 Reece Dunn wrote:
> 2008/4/21 Evgeny Burzak <buzzilo at gmail.com>:
> > Hello all,
> >  some times ago I make design for AppDB 
> > (http://buzz.ulx.ru/pf/appdb.png). Folks was  delighted with this one,
> > but managers rejected my idea due to needs redesign everything then. But
> > now it may be more actual then ever owing to Wine 1.0 release? I think it
> > may gain attention from professionals who wants to use wine in production
> > environment and improve Wine. I can make design for main pages, xml/xslt
> > template and probably base php5 clasess if you decide to change site
> > engine.

	Yeah, great design!

> I personally like it overall and agree that this makes sense for a
> Wine 1.0 release.
>
> Comments:
>
> *  There is no default screenshot of applications shown in your
> mockup, as they are in the current appdb.
>
> *  It would also be nice if the website could retain its red colour theme.
>
> *  I don't really like the coloured boxes on the Wine image, but I do
> like the 3D wine bottle. It would look better if you did away with the
> squares and shifted the logo to the left.

	I don't like colored boxes too. But 3D logo is good so I think getting rid of 
colored boxes is good idea. It might be better to add some kind of "neutral" 
background for 3D logo.


From a_villacis at palosanto.com  Tue Apr 22 18:00:46 2008
From: a_villacis at palosanto.com (=?ISO-8859-1?Q?Alex_Villac=ED=ADs_Lasso?=)
Date: Tue, 22 Apr 2008 18:00:46 -0500
Subject: Alex =?ISO-8859-1?Q?Villac=EDs_Lasso_=3A_uxtheme=3A_?=
	=?ISO-8859-1?Q?__Speed_up_UXTHEME=5FSizedBlt_in_the_ST=5FT?=
	=?ISO-8859-1?Q?ILE_by_building_an___appropriately-sized_me?=
	=?ISO-8859-1?Q?mory_bitmap_out_of_the_tile_instead_of__?=
	=?ISO-8859-1?Q?_iterating_with_UXTHEME=5FBlt_=28=29_directly=2E?=
In-Reply-To: <480E2F53.9070401@gmail.com>
References: <E1JoGyB-0001fK-TB@wine.codeweavers.com>
	<480E2F53.9070401@gmail.com>
Message-ID: <480E6E1E.6090809@palosanto.com>

Frank Richter escribio':
> On 22.04.2008 13:47, Alexandre Julliard wrote:
>   
>> uxtheme: Speed up UXTHEME_SizedBlt in the ST_TILE by building an appropriately-sized memory bitmap out of the tile instead of iterating with UXTHEME_Blt() directly.
>>     
>
> But does that keep the alpha channel intact?
>
> -f.r.
>
>   
I directed my themes to the ones on the WinXP partition, and saw no 
difference after the patch, other than the increase in speed. However, 
this might not be a proper test case. I used CreateCompatibleDC out of 
the source HDC, and CreateCompatibleBitmap in the same way. If these 
operations preserve the alpha channel, and BitBlt(SRCCOPY) does too, the 
patch as a whole should be correct. Have you seen a theme that uses 
alpha and breaks with my patch?

-- 
perl -e '$x=2.4;print sprintf("%.0f + %.0f = %.0f\n",$x,$x,$x+$x);'



From ovek at arcticnet.no  Tue Apr 22 18:19:20 2008
From: ovek at arcticnet.no (Ove Kaaven)
Date: Wed, 23 Apr 2008 01:19:20 +0200
Subject: Wine64 : initializer element is not computable at load time?
In-Reply-To: <20080423072617.76332e3d.mle+win@mega-nerd.com>
References: <20080422211125.7c056bc1.mle+win@mega-nerd.com>	<480DF747.3080209@arcticnet.no>
	<20080423072617.76332e3d.mle+win@mega-nerd.com>
Message-ID: <480E7278.8070307@arcticnet.no>

Erik de Castro Lopo skrev:
> Ove Kaaven wrote:
> 
>> Erik de Castro Lopo skrev:
>>> Anybody understand why?
>> You could look up the definition of RTL_CRITICAL_SECTION_DEBUG in 
>> include/winnt.h. Then realize that __WINESRC__ is only defined for stuff 
>> in dlls/, not for stuff in programs/, which should make the type 
>> mismatch clear.
> 
> The error message says nothing about a type mismatch its complaining
> about something not being compulatble a load time.

Yes, I said "type mismatch" to clarify the error. It's not possible to 
fit a 64-bit pointer value into a static 32-bit DWORD at "load time" 
(probably means relocation time). The types aren't compatible.

> That makes me suspect that the non  __WINESRC__ definition
> is wrong and that the whole #ifdef above could be replaced
> with 
> 
>       DWORD_PTR Spare[8/sizeof(DWORD_PTR)];
> 
> Is that right?

No, in the case of Winelib apps, every Wine definition should match the 
Windows definition exactly. And here, DWORD_PTR would be 64-bit and 
DWORD would be 32-bit, so it's not exactly a perfect match.

But I'm not proposing any particular solution, I just said what's wrong.




From m.b.lankhorst at gmail.com  Tue Apr 22 18:53:33 2008
From: m.b.lankhorst at gmail.com (Maarten Lankhorst)
Date: Tue, 22 Apr 2008 16:53:33 -0700
Subject: Removinig CVS/GIT version from bugzilla
In-Reply-To: <480E587E.3070209@open-vote.org>
References: <480DF730.6030006@kievinfo.com> <480E587E.3070209@open-vote.org>
Message-ID: <b130c85e0804221653i1749fbd5i1633279dc015a805@mail.gmail.com>

Hello Scott,

2008/4/22 Scott Ritchie <scott at open-vote.org>:
> Vitaliy Margolen wrote:
>  > 3. After the next release, if the bug is still present, modify version to
>  > that release. Of course no modifying of old bugs.
>  >
>
>  Sounds like a simple addition to Alexandre's (scripted?) closing of all
>  fixed bugs on release day.
I don't think that is needed, all that is needed is to rename git to
wine-0.9.XX and and then create a new git tag.

Cheers,
Maarten.


From chmorgan at gmail.com  Tue Apr 22 19:23:27 2008
From: chmorgan at gmail.com (Chris Morgan)
Date: Tue, 22 Apr 2008 20:23:27 -0400
Subject: winehq.org redesign
In-Reply-To: <480E5FA4.7080404@open-vote.org>
References: <20080422023415.48a311e3.buzzilo@gmail.com>
	<480E5FA4.7080404@open-vote.org>
Message-ID: <f3f1b91a0804221723v411255a2pda668cd191458e5b@mail.gmail.com>

>  Regarding the design itself, the colored boxes remind me more of a
>  children's party than a useful piece of software.  If you want to add
>  color to the page, it seems like there are other ways to do it without
>  calling garish attention to the Wine logo.
>

Garish? ;-) I thought the top X entries looked great.

>  That said, winehq and appdb definitely need a new redesign, and I'm very
>  happy you've offered to help.
>
>  Thanks,
>  Scott Ritchie
>
>
>

We've been throwing around the idea of switching the site to using
drupal for a while now so we can more easily manage it remotely and
take advantage of things like polls and news stories.

I'll suggest the same thing I mentioned the last time the redesign
came up, we should make the changes individually, picking the most
important ones first.

- Program icons (I really like these)
- Stats block on the main page is great (This is something Drupal is
suited to, enabling us to add a box like this and make it user
configurable)
- Collapsing the many 'browse' options, maybe into a menu that expands
when clicked or hovered, or simply removing the options and improving
the UI to have the same capabilities without special links.

I'm sure more can be found but these are the ones that stuck out as
some of the biggest improvements. We also need to find people
interested in working on some of these features.

Chris


From wine-devel at kievinfo.com  Tue Apr 22 19:38:19 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Tue, 22 Apr 2008 18:38:19 -0600
Subject: Removinig CVS/GIT version from bugzilla
In-Reply-To: <b130c85e0804221653i1749fbd5i1633279dc015a805@mail.gmail.com>
References: <480DF730.6030006@kievinfo.com> <480E587E.3070209@open-vote.org>
	<b130c85e0804221653i1749fbd5i1633279dc015a805@mail.gmail.com>
Message-ID: <480E84FB.4080700@kievinfo.com>

Maarten Lankhorst wrote:
> Hello Scott,
> 
> 2008/4/22 Scott Ritchie <scott at open-vote.org>:
>> Vitaliy Margolen wrote:
>>  > 3. After the next release, if the bug is still present, modify version to
>>  > that release. Of course no modifying of old bugs.
>>  >
>>
>>  Sounds like a simple addition to Alexandre's (scripted?) closing of all
>>  fixed bugs on release day.
> I don't think that is needed, all that is needed is to rename git to
> wine-0.9.XX and and then create a new git tag.
> 
Well that will affect closed bugs - which is not good. However I don't have 
a strong objection here - whatever works. It would be even better if we can 
add the version automatically with release scripts.

Vitaliy.


From dmitry at codeweavers.com  Tue Apr 22 22:12:16 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Wed, 23 Apr 2008 12:12:16 +0900
Subject: gdi32: Make the bitmap test pass under Windows 2000. Take 2
References: <E1JoGj7-0002zO-IP@mail.codeweavers.com><480DCE25.8010107@gmail.com><008a01c8a487$4ade9320$a600fea9@DMITRY>
	<480DFE41.50906@gmail.com><018301c8a48b$2c4ad410$a600fea9@DMITRY>
	<480E08A3.3010207@gmail.com>
Message-ID: <00cf01c8a4ef$d6fa0e30$a600fea9@DMITRY>

"Paul Vriens" <paul.vriens.wine at gmail.com> wrote:

>>> It's that last piece: "assuming there's enough memory left".
>> 
>> That's a valid assumption I'd guess, and a lot of tests already rely
>> on this: every thing which indirectly or directly allocates memory,
>> creates windows, objects, processes, etc.
>> 
> But the test doesn't cater for that.
> 
> If I run the test with several heights on my win2k box the maximum I can have is:
> 
> CreateBitmap(0x7fff,0x2e63, ...
> 
> before it fails with ERROR_NOT_ENOUGH_MEMORY.
> 
> This of course differs on every run. My point is that ERROR_NOT_ENOUGH_MEMORY is 
> totally valid and should be catered for in the test otherwise we would still 
> have failures for this test.

I don't think it's a good idea to pollute every test that could fail
due to insufficient memory with fake error handling.

-- 
Dmitry.


From m.b.lankhorst at gmail.com  Tue Apr 22 23:14:43 2008
From: m.b.lankhorst at gmail.com (Maarten Lankhorst)
Date: Tue, 22 Apr 2008 21:14:43 -0700
Subject: SOC 2008 Projects Announced
In-Reply-To: <b6bb06270804221436s5dfab6fctbe89047e55b4a8e9@mail.gmail.com>
References: <b6bb06270804221436s5dfab6fctbe89047e55b4a8e9@mail.gmail.com>
Message-ID: <b130c85e0804222114v3b8abc00v965c598d780e5a44@mail.gmail.com>

Hi Austin,

2008/4/22 Austin English <austinenglish at gmail.com>:
> For those of you who haven't heard yet, the Google SOC Projects were
> announced today:
> http://google-opensource.blogspot.com/2008/04/announcing-accepted-student-proposals.html
>
> 5 Wine projects have been accepted:
> http://code.google.com/soc/2008/wine/about.html
I count six?

>  Improving Wine MSXML implementation
>  by Piotr Caban, mentored by James Hawkins
>
>  Print Dialog
>  by Gal Topper, mentored by Detlef Riekenberg
>
>  Implementing proper Control Panel support for Wine
>  by Owen Rudge, mentored by Juan Lang
>
>  DirectPlay implementation
>  by Ismael Barros Barros, mentored by Kai Blin
>
>  Wine - Richedit with Tables
>  by Dylan Andrew Harper Smith, mentored by Huw D M Davies
>
>  Improve Gdi+ Implemenation
>  by Adam Joel Petaccia, mentored by Lei Zhang
> Thanks to all those who applied and congrats to those who were accepted!
Could the students come forward and say something about themself?

Cheers,
Maarten.


PS: Please no html formatted emails.


From dmitry at codeweavers.com  Tue Apr 22 23:14:40 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Wed, 23 Apr 2008 13:14:40 +0900
Subject: Fix "warning: cast from pointer to integer of different size"
References: <20080422222441.b042f27b.mle+win@mega-nerd.com><00b501c8a488$296854f0$a600fea9@DMITRY>
	<20080423065322.3938d77c.mle+win@mega-nerd.com>
Message-ID: <00c301c8a4f8$8ea65810$a600fea9@DMITRY>

"Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:

>> > /* get pointer to object containing list element */
>> > #define LIST_ENTRY(elem, type, field) \
>> > -    ((type *)((char *)(elem) - (unsigned int)(&((type *)0)->field)))
>> > +    ((type *)((char *)(elem) - (unsigned long)(&((type *)0)->field)))
>> 
>> It should be replaced with FIELD_OFFSET instead.
> 
> FIELD_OFFSET is defined in include/winnt.h. 
> 
> Now I could include winnt.h into include/wine/list.h but that doesn't
> seem right. I could also copy it,but having two difinitions of the
> same macro is also not right. I'm also sure that moving the definition
> from include/winnt.h to include/wine/list.h will break existing code.
> 
> Any suggestions for dealing with this?

Replacing (unsigned int) cast by (unsigned long) doesn't guarantee
anything, long can be a 32-bit entity on a 64-bit platform.

-- 
Dmitry.


From mle+win at mega-nerd.com  Tue Apr 22 23:34:56 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Wed, 23 Apr 2008 14:34:56 +1000
Subject: Fix "warning: cast from pointer to integer of different size"
In-Reply-To: <00c301c8a4f8$8ea65810$a600fea9@DMITRY>
References: <20080422222441.b042f27b.mle+win@mega-nerd.com>
	<00b501c8a488$296854f0$a600fea9@DMITRY>
	<20080423065322.3938d77c.mle+win@mega-nerd.com>
	<00c301c8a4f8$8ea65810$a600fea9@DMITRY>
Message-ID: <20080423143456.9f1fd022.mle+win@mega-nerd.com>

Dmitry Timoshkov wrote:

> "Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:
> 
> > FIELD_OFFSET is defined in include/winnt.h. 
> > 
> > Now I could include winnt.h into include/wine/list.h but that doesn't
> > seem right. I could also copy it,but having two definitions of the
> > same macro is also not right. I'm also sure that moving the definition
> > from include/winnt.h to include/wine/list.h will break existing code.
> > 
> > Any suggestions for dealing with this?
> 
> Replacing (unsigned int) cast by (unsigned long) doesn't guarantee
> anything, long can be a 32-bit entity on a 64-bit platform.

I'm perfectly happy to accept that, but the real question was,
"what is the best way to get FIELD_OFFSET in include/wine/list.h?".

I see four options:

 0) Include include/winnt.h into include/wine/list.h. Ugly!

 1) Copy definition of FIELD_OFFSET macro from include/winnt.h to
    include/wine/list.h. Ugly!

 2) Move the definition of FIELD_OFFSET macro from include/winnt.h to
    include/wine/list.h. This will probably break existing code. Ugly!

 3) Add a definition if FIELD_OFFSET wrapped in #ifndef. This is the
    least ugly option but would cause surprising results if one or
    the other was changed.

So, to rephrase the question, which of the above would actually be
accepted as a patch? If none of them are good enough (highly 
likely) can someone please suggest an alternative that would be
acceptable?

Cheers,
Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
Journalist: Microsoft CEO Steve Ballmer has finally said Linux
            is the No. 1 threat to Windows. What's your response to that?
Linus     : "Tag, you're it." I don't care. They've had a lot of
            enemies in their time. Let them fight one enemy that
            doesn't care for a change.


From m.b.lankhorst at gmail.com  Tue Apr 22 23:52:02 2008
From: m.b.lankhorst at gmail.com (Maarten Lankhorst)
Date: Tue, 22 Apr 2008 21:52:02 -0700
Subject: Wine t-shirts?
Message-ID: <b130c85e0804222152k5447661bo496c267ce6f8a311@mail.gmail.com>

Hi all,

Why don't we have wine t-shirts any more?

Cheers,
Maarten.


From paul.vriens.wine at gmail.com  Wed Apr 23 01:08:55 2008
From: paul.vriens.wine at gmail.com (Paul Vriens)
Date: Wed, 23 Apr 2008 08:08:55 +0200
Subject: gdi32: Make the bitmap test pass under Windows 2000. Take 2
In-Reply-To: <00cf01c8a4ef$d6fa0e30$a600fea9@DMITRY>
References: <E1JoGj7-0002zO-IP@mail.codeweavers.com><480DCE25.8010107@gmail.com><008a01c8a487$4ade9320$a600fea9@DMITRY>
	<480DFE41.50906@gmail.com><018301c8a48b$2c4ad410$a600fea9@DMITRY>
	<480E08A3.3010207@gmail.com>
	<00cf01c8a4ef$d6fa0e30$a600fea9@DMITRY>
Message-ID: <480ED277.7080500@gmail.com>

Dmitry Timoshkov wrote:
> "Paul Vriens" <paul.vriens.wine at gmail.com> wrote:
> 
>>>> It's that last piece: "assuming there's enough memory left".
>>>
>>> That's a valid assumption I'd guess, and a lot of tests already rely
>>> on this: every thing which indirectly or directly allocates memory,
>>> creates windows, objects, processes, etc.
>>>
>> But the test doesn't cater for that.
>>
>> If I run the test with several heights on my win2k box the maximum I 
>> can have is:
>>
>> CreateBitmap(0x7fff,0x2e63, ...
>>
>> before it fails with ERROR_NOT_ENOUGH_MEMORY.
>>
>> This of course differs on every run. My point is that 
>> ERROR_NOT_ENOUGH_MEMORY is totally valid and should be catered for in 
>> the test otherwise we would still have failures for this test.
> 
> I don't think it's a good idea to pollute every test that could fail
> due to insufficient memory with fake error handling.
> 
The title of the patch says "Make the bitmap test pass under Windows 2000". 
Introducing the test as you did doesn't do that as in some cases it will fail.

But we can spent hours on this. Let's go on and see if AJ will accept the patch.

-- 
Cheers,

Paul.


From marcus at jet.franken.de  Wed Apr 23 01:29:20 2008
From: marcus at jet.franken.de (Marcus Meissner)
Date: Wed, 23 Apr 2008 08:29:20 +0200
Subject: wine-announce and wine-users getting hammered
In-Reply-To: <138291.26516.qm@web26004.mail.ukl.yahoo.com>
References: <138291.26516.qm@web26004.mail.ukl.yahoo.com>
Message-ID: <20080423062920.GA2474@galeere>

On Tue, Apr 22, 2008 at 04:15:53PM +0000, Luke Bratch wrote:
> Hi
> 
> I do the moderation for these lists, and wine-accounce and wine-users are getting absolutely hammered with notification error messages today (in the order of around 15 per minute all day long).
> 
> I've been clearing these out, but perhaps this is an indication of someone targeting these lists?

No it is going around, but also stopping...

I had hundreds of such mails on my private and company accounts (and
lists), but they stopped again.

Ciao, Marcus


From astrand at cendio.se  Wed Apr 23 01:44:55 2008
From: astrand at cendio.se (=?UTF-8?Q?Peter_=C3=85strand?=)
Date: Wed, 23 Apr 2008 08:44:55 +0200 (CEST)
Subject: winmm/tests: waveOutGetDevCaps called with invalid size
In-Reply-To: <480DC438.7010107@earthlink.net>
References: <Pine.LNX.4.64.0804181102080.23847@maggie.lkpg.cendio.se>
	<4808B145.2010609@earthlink.net>
	<Pine.LNX.4.64.0804211050260.12791@maggie.lkpg.cendio.se>
	<480D12B1.3070309@earthlink.net>
	<Pine.LNX.4.64.0804220842440.29058@maggie.lkpg.cendio.se>
	<480DC438.7010107@earthlink.net>
Message-ID: <Pine.LNX.4.64.0804230822450.15637@maggie.lkpg.cendio.se>


> > However, I still think it's VERY strange to expect success from an invalid
> > call. You are describing it as an "invalid argument" yourself. Why should we
> > expect a call with an "invalid argument" to succeed? And again, the test
> > does NOT pass on all Microsoft versions; it fails on Terminal Servers.
> If size wasn't relevant, it wouldn't be passed.  

The size is used for determining which kind of WAVEOUTCAPS structure you 
pass. 


> There are only two options:
> only pass the number of bytes requested or return an error for unreasonable
> sizes.  What is Terminal Server doing?  

It's returning an error. 


> > If the point is to verify that waveOutGetDevCaps doesn't write more than the
> > size supplied, this should be verified. I'd also like to point out that the
> > Wine implementation also doesn't handle this correctly: Only
> > waveOutGetDevCapsA does a memcpy() using the size argument;
> > waveOutGetDevCapsW does not.
> >
> waveOutGetDevCapsW lets the driver do the copy (just like old versions of
> windows).  The driver should be checking the size and only copying that much.
> If it doesn't, then it broken.

Any references for this claim?

You are saying that the driver "should only copy that much", but *what* 
should it copy? In other words: If the size doesn't match the size of any 
known structure (WAVEOUTCAPSA/WAVEOUTCAPSW/WAVEOUTCAPS2A/WAVEOUTCAPS2W), 
should the driver then just *assume* some structure? Which one? As far as 
I know, there's no guarantee that, for example, the first 
sizeof(WAVEOUTCAPSW) bytes of WAVEOUTCAPSW are the same as WAVEOUTCAPS2W. 


Rgds, 
---
Peter ?strand		ThinLinc Chief Developer
Cendio AB		http://www.cendio.se
Wallenbergs gata 4
583 30 Link?ping	Phone: +46-13-21 46 00

From frank.richter at gmail.com  Wed Apr 23 02:31:12 2008
From: frank.richter at gmail.com (Frank Richter)
Date: Wed, 23 Apr 2008 09:31:12 +0200
Subject: Alex =?ISO-8859-1?Q?Villac=EDs_Lasso_=3A_uxtheme=3A_?=
	=?ISO-8859-1?Q?__Speed_up_UXTHEME=5FSizedBlt_in_the_ST=5FT?=
	=?ISO-8859-1?Q?ILE_by_building_an___appropriately-sized_me?=
	=?ISO-8859-1?Q?mory_bitmap_out_of_the_tile_instead_of__?=
	=?ISO-8859-1?Q?_iterating_with_UXTHEME=5FBlt_=28=29_directly=2E?=
In-Reply-To: <480E6E1E.6090809@palosanto.com>
References: <E1JoGyB-0001fK-TB@wine.codeweavers.com>	<480E2F53.9070401@gmail.com>
	<480E6E1E.6090809@palosanto.com>
Message-ID: <480EE5C0.3030109@gmail.com>

On 23.04.2008 01:00, Alex Villac??s Lasso wrote:
> Have you seen a theme that uses  alpha and breaks with my patch?

It's more of a dim recollection from the time I worked on the theming 
stuff. Mind you, it's a while back now, so assuming I remember right the 
underlying issue might have been fixed already.

-f.r.




From m.b.lankhorst at gmail.com  Wed Apr 23 02:58:44 2008
From: m.b.lankhorst at gmail.com (Maarten Lankhorst)
Date: Wed, 23 Apr 2008 00:58:44 -0700
Subject: Removinig CVS/GIT version from bugzilla
In-Reply-To: <480E84FB.4080700@kievinfo.com>
References: <480DF730.6030006@kievinfo.com> <480E587E.3070209@open-vote.org>
	<b130c85e0804221653i1749fbd5i1633279dc015a805@mail.gmail.com>
	<480E84FB.4080700@kievinfo.com>
Message-ID: <b130c85e0804230058h5b2fb5dcy74b6181fc52b24f8@mail.gmail.com>

Hello Vitaily,

2008/4/22 Vitaliy Margolen <wine-devel at kievinfo.com>:
>
> Maarten Lankhorst wrote:
>  > Hello Scott,
>  >
>  > 2008/4/22 Scott Ritchie <scott at open-vote.org>:
>  >> Vitaliy Margolen wrote:
>  >>  > 3. After the next release, if the bug is still present, modify version to
>  >>  > that release. Of course no modifying of old bugs.
>  >>  >
>  >>
>  >>  Sounds like a simple addition to Alexandre's (scripted?) closing of all
>  >>  fixed bugs on release day.
>  > I don't think that is needed, all that is needed is to rename git to
>  > wine-0.9.XX and and then create a new git tag.
>  >
>  Well that will affect closed bugs - which is not good. However I don't have
>  a strong objection here - whatever works. It would be even better if we can
>  add the version automatically with release scripts.
If it is a true rename operation it will. However this will only occur
once so I think we can live with that. Any bugzilla admins ok with
this way of doing bug reports? It would make the version a whole lot
more accurate in the longer run.

Cheers,
Maarten.


From julliard at winehq.org  Wed Apr 23 03:06:49 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 23 Apr 2008 10:06:49 +0200
Subject: Alex =?utf-8?Q?Villac=C3=ADs?= Lasso : uxtheme:   Speed up
	UXTHEME_SizedBlt in the ST_TILE by building an   appropriately-sized
	memory bitmap out of the tile instead of iterating with UXTHEME_Blt ()
	directly.
In-Reply-To: <480E6E1E.6090809@palosanto.com> ("Alex =?utf-8?B?VmlsbGFj?=
	=?utf-8?B?w63CrXM=?= Lasso"'s message
	of "Tue, 22 Apr 2008 18:00:46 -0500")
References: <E1JoGyB-0001fK-TB@wine.codeweavers.com>
	<480E2F53.9070401@gmail.com> <480E6E1E.6090809@palosanto.com>
Message-ID: <871w4x2dwm.fsf@wine.dyndns.org>

Alex Villac??s Lasso <a_villacis at palosanto.com> writes:

> I directed my themes to the ones on the WinXP partition, and saw no 
> difference after the patch, other than the increase in speed. However, 
> this might not be a proper test case. I used CreateCompatibleDC out of 
> the source HDC, and CreateCompatibleBitmap in the same way. If these 
> operations preserve the alpha channel, and BitBlt(SRCCOPY) does too, the 
> patch as a whole should be correct.

No, BitBlt and friends won't preserve the alpha channel. But that should
be fixed in gdi, not worked around in uxtheme.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Wed Apr 23 03:11:33 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 23 Apr 2008 10:11:33 +0200
Subject: gdi32: Make the bitmap test pass under Windows 2000. Take 2
In-Reply-To: <00cf01c8a4ef$d6fa0e30$a600fea9@DMITRY> (Dmitry Timoshkov's
	message of "Wed, 23 Apr 2008 12:12:16 +0900")
References: <E1JoGj7-0002zO-IP@mail.codeweavers.com>
	<480DCE25.8010107@gmail.com> <008a01c8a487$4ade9320$a600fea9@DMITRY>
	<480DFE41.50906@gmail.com> <018301c8a48b$2c4ad410$a600fea9@DMITRY>
	<480E08A3.3010207@gmail.com> <00cf01c8a4ef$d6fa0e30$a600fea9@DMITRY>
Message-ID: <87wsmp0z4a.fsf@wine.dyndns.org>

"Dmitry Timoshkov" <dmitry at codeweavers.com> writes:

> "Paul Vriens" <paul.vriens.wine at gmail.com> wrote:
>
>> This of course differs on every run. My point is that ERROR_NOT_ENOUGH_MEMORY is 
>> totally valid and should be catered for in the test otherwise we would still 
>> have failures for this test.
>
> I don't think it's a good idea to pollute every test that could fail
> due to insufficient memory with fake error handling.

Obviously you don't want to do that for every test, but if you write a
test that requires 1Gb of memory then you definitely need to check, you
can't assume that this will always work.

-- 
Alexandre Julliard
julliard at winehq.org


From buzzilo at gmail.com  Wed Apr 23 02:44:12 2008
From: buzzilo at gmail.com (Evgeny Burzak)
Date: Wed, 23 Apr 2008 11:44:12 +0400
Subject: winehq.org redesign
In-Reply-To: <200804230006.17192.alex@thehandofagony.com>
References: <20080422023415.48a311e3.buzzilo@gmail.com>
	<200804230006.17192.alex@thehandofagony.com>
Message-ID: <20080423114412.ebd554da.buzzilo@gmail.com>

ok. 
If you have another ideas or comments please write it out on wiki page: http://wiki.winehq.org/WinehqDesign
There i will mirror my work too.

On Wed, 23 Apr 2008 00:06:16 +0200
Alexander Nicolaysen S?rnes <alex at thehandofagony.com> wrote:

> > Hello all,
> > some times ago I make design for AppDB  (http://buzz.ulx.ru/pf/appdb.png).
> > Folks was  delighted with this one, but managers rejected my idea due to
> > needs redesign everything then. But now it may be more actual then ever
> > owing to Wine 1.0 release? I think it may gain attention from professionals
> > who wants to use wine in production environment and improve Wine. I can
> > make design for main pages, xml/xslt template and probably base php5
> > clasess if you decide to change site engine.
> >
> > --
> > Evgeny
> 
> 
> Thanks for the design and for bringing it up again!  It certainly contains a 
> lot of good ideas about how the site can be improved.
> 
> 
> 
> Alexander N. S?rnes


-- 
???????
mailto:buzzilo at gmail.com
http://buzz.ulx.ru
:?


From l_bratch at yahoo.co.uk  Wed Apr 23 03:21:39 2008
From: l_bratch at yahoo.co.uk (Luke Bratch)
Date: Wed, 23 Apr 2008 08:21:39 +0000 (GMT)
Subject: wine-announce and wine-users getting hammered
In-Reply-To: <20080423062920.GA2474@galeere>
Message-ID: <103713.63827.qm@web26003.mail.ukl.yahoo.com>

--- On Wed, 23/4/08, Marcus Meissner <marcus at jet.franken.de> wrote:

> No it is going around, but also stopping...
> 
> I had hundreds of such mails on my private and company
> accounts (and
> lists), but they stopped again.

Indeed, it's completely stopped today.  Sorry for the noise.

Luke


      __________________________________________________________
Sent from Yahoo! Mail.
A Smarter Email http://uk.docs.yahoo.com/nowyoucan.html


From julliard at winehq.org  Wed Apr 23 04:20:25 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 23 Apr 2008 11:20:25 +0200
Subject: WGL: WGL_WINE_pixel_format_passthrough [attempt 2]
In-Reply-To: <20080422211225.182040@gmx.net> (Roderick Colenbrander's message
	of "Tue, 22 Apr 2008 23:12:25 +0200")
References: <20080422211225.182040@gmx.net>
Message-ID: <87prsh0vxi.fsf@wine.dyndns.org>

"Roderick Colenbrander" <thunderbird2k at gmx.net> writes:

> +BOOL X11DRV_wglSetPixelFormatWINE(X11DRV_PDEVICE *physDev, int iPixelFormat, const PIXELFORMATDESCRIPTOR *ppfd)
> +{
> +    TRACE("(%p,%d,%p)\n", physDev, iPixelFormat, ppfd);
> +
> +    /* When the requested pixel format differs from the physDev its pixel format AND
> +     * the physDev has a pixel format set, clear current_pf, so that SetPixelFormat
> +     * will set the pixel format again. */
> +    if((physDev->current_pf != 0) && (physDev->current_pf != iPixelFormat)) {
> +        TRACE("Changing iPixelFormat from %d to %d\n", physDev->current_pf, iPixelFormat);
> +        physDev->current_pf = 0;
> +    }

You shouldn't set the format to 0 first, this will break if changing to
the new format fails for some reason.

-- 
Alexandre Julliard
julliard at winehq.org


From owen at owenrudge.net  Wed Apr 23 05:38:22 2008
From: owen at owenrudge.net (Owen Rudge)
Date: Wed, 23 Apr 2008 11:38:22 +0100
Subject: SOC 2008 Projects Announced
References: <b6bb06270804221436s5dfab6fctbe89047e55b4a8e9@mail.gmail.com>
	<b130c85e0804222114v3b8abc00v965c598d780e5a44@mail.gmail.com>
Message-ID: <091501c8a52e$28cdbe30$842a204e@lan.owenrudge.net>

> Could the students come forward and say something about themself?

Hello all. :-) I already introduced myself a while ago when I was writing my 
proposal, and I'm very pleased to see that it was accepted! I'm a 3rd year 
comp sci student at the University of St Andrews in sunny(!) Scotland. 
Looking forward to getting to work on Wine, although I've got exams and a 
junior honours project to get finished first, alas! I've got various ideas 
floating around my head and have figured out how I think I'm going to start 
tackling the project, so hopefully I'll be all ready to go when exams are 
out of the way.

Cheers,

-- 
Owen Rudge
http://www.owenrudge.net/ 



From reif at earthlink.net  Wed Apr 23 05:38:21 2008
From: reif at earthlink.net (Robert Reif)
Date: Wed, 23 Apr 2008 06:38:21 -0400
Subject: winmm/tests: waveOutGetDevCaps called with invalid size
In-Reply-To: <Pine.LNX.4.64.0804230822450.15637@maggie.lkpg.cendio.se>
References: <Pine.LNX.4.64.0804181102080.23847@maggie.lkpg.cendio.se>
	<4808B145.2010609@earthlink.net>
	<Pine.LNX.4.64.0804211050260.12791@maggie.lkpg.cendio.se>
	<480D12B1.3070309@earthlink.net>
	<Pine.LNX.4.64.0804220842440.29058@maggie.lkpg.cendio.se>
	<480DC438.7010107@earthlink.net>
	<Pine.LNX.4.64.0804230822450.15637@maggie.lkpg.cendio.se>
Message-ID: <480F119D.5050107@earthlink.net>


>> There are only two options:
>> only pass the number of bytes requested or return an error for unreasonable
>> sizes.  What is Terminal Server doing?  
>>     
>
> It's returning an error. 
>
>   
And what is the error?  If you know the error code returned, Ill add it 
to the code so
we can end this discussion.
>> waveOutGetDevCapsW lets the driver do the copy (just like old versions of
>> windows).  The driver should be checking the size and only copying that much.
>> If it doesn't, then it broken.
>>     
>
> Any references for this claim?
>
>   
Read the code.
> You are saying that the driver "should only copy that much", but *what* 
> should it copy? In other words: If the size doesn't match the size of any 
> known structure (WAVEOUTCAPSA/WAVEOUTCAPSW/WAVEOUTCAPS2A/WAVEOUTCAPS2W), 
> should the driver then just *assume* some structure? Which one? As far as 
> I know, there's no guarantee that, for example, the first 
> sizeof(WAVEOUTCAPSW) bytes of WAVEOUTCAPSW are the same as WAVEOUTCAPS2W. 
>
>   
Again, read the code. WAVEOUTCAPS2 is a superset of WAVEOUTCAPS
so it doesn't matter when the length is shorter than WAVEOUTCAPS.  The
drivers only support W so mixing A and W is not an issue.



From dank at kegel.com  Wed Apr 23 05:48:39 2008
From: dank at kegel.com (Dan Kegel)
Date: Wed, 23 Apr 2008 03:48:39 -0700
Subject: What to do about filenames legal in Linux but illegal in Windows?
In-Reply-To: <Pine.LNX.4.62.0804220839250.16602@tvarka.ar.fi.lt>
References: <a71bd89a0804212058k7209bc9cl7ce04fb30cc87e58@mail.gmail.com>
	<Pine.LNX.4.62.0804220839250.16602@tvarka.ar.fi.lt>
Message-ID: <a71bd89a0804230348p1eabbbaahc50cc500fa5dff2b@mail.gmail.com>

On Mon, Apr 21, 2008 at 10:57 PM, Saulius Krasuckas <saulius2 at ar.fi.lt> wrote:
> * On Mon, 21 Apr 2008, Dan Kegel wrote:
>  > (I believe that in both Windows and Wine, directory listings
>  > will show these illegal chars, but attempts to open the files will
>  > fail.)
>
>  For a files that were at least "undeletable" I remember I have been using
>  a feature of Total Commander to switch format of files displayed to a
>  Short/Long form.  Not all files give up for me this way, but half of them
>  did, though.

Yes, I had forgotten about short names because I had been working
on *creating* illegal files, not reading them.
Picasa does in fact work on Windows when presented with *directories*
that have illegal names, and I suspect this is because it uses the
short names and the expands them before display.
(It doesn't seem to work with them on Wine yet; that's on my to-do list to
find out why.)
- Dan


From julliard at winehq.org  Wed Apr 23 06:10:29 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 23 Apr 2008 13:10:29 +0200
Subject: server: return active window if foreground window is set
In-Reply-To: <480F17C1.8030508@yless4u.com.au> (Jeff Latimer's message of
	"Wed, 23 Apr 2008 21:04:33 +1000")
References: <480F17C1.8030508@yless4u.com.au>
Message-ID: <87iqy825ei.fsf@wine.dyndns.org>

Jeff Latimer <lats at yless4u.com.au> writes:

> The comment in the code indicates that the foreground window is active
> window of the active thread.  Seems logical the active window handle
> should be returned at the same time.

No, the active window is per-thread, you can't return the active window
of some other thread.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Wed Apr 23 06:23:52 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 23 Apr 2008 13:23:52 +0200
Subject: [2/2] [try2] user32:mdi.c Fix creating MDI child window according
	with test. [resend]
In-Reply-To: <480DE437.3050709@etersoft.ru> (Anatoly Lyutin's message of "Tue, 
	22 Apr 2008 17:12:23 +0400")
References: <480DE437.3050709@etersoft.ru>
Message-ID: <877ieo24s7.fsf@wine.dyndns.org>

Anatoly Lyutin <vostok at etersoft.ru> writes:

> Uses SWP_NOZORDER according with Dmitry's comment.
>
> Changelog:
>  Fix creating MDI child window according with test.

It doesn't work:

msg.c:3065: Test failed: Create visible MDI child window: the msg sequence is not complete: expected 0000 - actual 0046
msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg 0x0047 was expected, but got msg 0x0046 instead
msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg 0x0005 was expected, but got msg 0x0083 instead
msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg 0x0046 was expected, but got msg 0x0047 instead
msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg 0x0083 was expected, but got msg 0x0047 instead
msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg 0x0047 was expected, but got msg 0x0005 instead
msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg sequence is not complete: expected 0000 - actual 0046
msg.c:3345: Test failed: ShowWindow(SW_MAXIMIZE):invisible maximized MDI child: the msg 0x0047 was expected, but got msg 0x0046 instead
msg.c:3345: Test failed: ShowWindow(SW_MAXIMIZE):invisible maximized MDI child: the msg sequence is not complete: expected 0000 - actual 0083
msg.c:3484: Test failed: Create MDI child window with invisible parent: the msg sequence is not complete: expected 0000 - actual 0046

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Wed Apr 23 06:25:40 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 23 Apr 2008 13:25:40 +0200
Subject: [3/3] user32:mdi.c Fix processing of SW_SHOWMINNOACTIVE according
	with test. [resend]
In-Reply-To: <480DE43A.8060108@etersoft.ru> (Anatoly Lyutin's message of "Tue, 
	22 Apr 2008 17:12:26 +0400")
References: <480DE43A.8060108@etersoft.ru>
Message-ID: <873apc24p7.fsf@wine.dyndns.org>

Anatoly Lyutin <vostok at etersoft.ru> writes:

> Changelog:
>   Fix  processing of SW_SHOWMINNOACTIVE according with test.

No luck here either:

msg.c:4587: Test failed: ShowWindow(SW_SHOWMINNOACTIVE) child with invisible parent: in msg 0x0046 expecting wParam 0x8170 got 0x8150
msg.c:4587: Test failed: ShowWindow(SW_SHOWMINNOACTIVE) child with invisible parent: in msg 0x0047 expecting wParam 0x8178 got 0x8158

-- 
Alexandre Julliard
julliard at winehq.org


From dank at kegel.com  Wed Apr 23 06:43:13 2008
From: dank at kegel.com (Dan Kegel)
Date: Wed, 23 Apr 2008 04:43:13 -0700
Subject: Wine t-shirts?
Message-ID: <a71bd89a0804230443w3240caf7v46108219330713af@mail.gmail.com>

Maarten wrote:
> Why don't we have wine t-shirts any more?

I dunno, where were they before?

I just looked, couldn't find any on cafepress.com.

I'd like to bring back the Codeweavers drunken penguin
t-shirts, perhaps with a slightly more generic Wine
design.
Coincidentally, I found some site on the net had taken
the logo from that shirt and erased the Crossover
logo from the wine bottle; here's a cleaned-up copy:
http://kegel.com/wine/wine-penguin-corkscrew.png


From julliard at winehq.org  Wed Apr 23 06:20:43 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 23 Apr 2008 13:20:43 +0200
Subject: [1/3] user32:msg.c Make two tests clear pass in Win XP SP 2
	[resend]
In-Reply-To: <480DE42D.4090301@etersoft.ru> (Anatoly Lyutin's message of "Tue, 
	22 Apr 2008 17:12:13 +0400")
References: <480DE42D.4090301@etersoft.ru>
Message-ID: <87bq4024xg.fsf@wine.dyndns.org>

Anatoly Lyutin <vostok at etersoft.ru> writes:

> Changelog:
>  Make two tests clear pass.

This breaks the test on Vista and on Wine.

-- 
Alexandre Julliard
julliard at winehq.org


From marcus at jet.franken.de  Wed Apr 23 07:29:16 2008
From: marcus at jet.franken.de (Marcus Meissner)
Date: Wed, 23 Apr 2008 14:29:16 +0200
Subject: Wine t-shirts?
In-Reply-To: <a71bd89a0804230443w3240caf7v46108219330713af@mail.gmail.com>
References: <a71bd89a0804230443w3240caf7v46108219330713af@mail.gmail.com>
Message-ID: <20080423122915.GB5121@galeere>

On Wed, Apr 23, 2008 at 04:43:13AM -0700, Dan Kegel wrote:
> Maarten wrote:
> > Why don't we have wine t-shirts any more?
> 
> I dunno, where were they before?
> 
> I just looked, couldn't find any on cafepress.com.
> 
> I'd like to bring back the Codeweavers drunken penguin
> t-shirts, perhaps with a slightly more generic Wine
> design.
> Coincidentally, I found some site on the net had taken
> the logo from that shirt and erased the Crossover
> logo from the wine bottle; here's a cleaned-up copy:
> http://kegel.com/wine/wine-penguin-corkscrew.png

Only CodeWeavers had tshirts previously as far as I remember...

Ciao, Marcus


From jwhite at winehq.org  Wed Apr 23 07:40:24 2008
From: jwhite at winehq.org (Jeremy White)
Date: Wed, 23 Apr 2008 07:40:24 -0500
Subject: Wine t-shirts?
In-Reply-To: <a71bd89a0804230443w3240caf7v46108219330713af@mail.gmail.com>
References: <a71bd89a0804230443w3240caf7v46108219330713af@mail.gmail.com>
Message-ID: <480F2E38.7010506@winehq.org>

> http://kegel.com/wine/wine-penguin-corkscrew.png

Jon Parshall is proud of his ability to draw those penguins,
and we'd gladly send that artwork to anyone that wanted to make a T-shirt.

Note, though, that we felt we had to (very sadly) drop the penguin; it doesn't
really work for Mac users.

Cheers,

Jeremy


From dank at kegel.com  Wed Apr 23 08:06:34 2008
From: dank at kegel.com (Dan Kegel)
Date: Wed, 23 Apr 2008 06:06:34 -0700
Subject: New winetricks 20080423: added mono19, removed mono1[12], updated xvid
Message-ID: <a71bd89a0804230606g6844a90blebaa7b0713b4f578@mail.gmail.com>

Another day, another Winetricks.  Changes:

r40
Update to latest mono
Remove mono11 and mono12 verbs, replace with mono19
Abort properly on network errors

r39
Updated xvid

As always, get it at
http://kegel.com/wine/winetricks
or
http://code.google.com/p/winezeug


From juan.lang at gmail.com  Wed Apr 23 08:54:53 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Wed, 23 Apr 2008 06:54:53 -0700
Subject: Fix "warning: cast from pointer to integer of different size"
In-Reply-To: <20080423143456.9f1fd022.mle+win@mega-nerd.com>
References: <20080422222441.b042f27b.mle+win@mega-nerd.com>
	<00b501c8a488$296854f0$a600fea9@DMITRY>
	<20080423065322.3938d77c.mle+win@mega-nerd.com>
	<00c301c8a4f8$8ea65810$a600fea9@DMITRY>
	<20080423143456.9f1fd022.mle+win@mega-nerd.com>
Message-ID: <3a768c550804230654j5d320ecaqa7ce642e7d701fb1@mail.gmail.com>

>   3) Add a definition if FIELD_OFFSET wrapped in #ifndef. This is the
>     least ugly option but would cause surprising results if one or
>     the other was changed.

Personally, I think this looks the best.  As far as which is likely to
get accepted.. often you have to try first to find that out ;-)
--Juan


From jnewman at codeweavers.com  Wed Apr 23 10:23:06 2008
From: jnewman at codeweavers.com (Jeremy Newman)
Date: Wed, 23 Apr 2008 10:23:06 -0500
Subject: winehq.org redesign
In-Reply-To: <20080422023415.48a311e3.buzzilo@gmail.com>
References: <20080422023415.48a311e3.buzzilo@gmail.com>
Message-ID: <480F545A.1090904@codeweavers.com>

It looks alright. It's simple, and does not really have much punch to 
it. It looks like a Wikipedia clone.

The logo is the big problem. You have unilaterally decided to replace 
our current official Wine logo with one of your own. If you want to do 
that, you need to submit your logo for review to become the new official 
Wine logo.

IMO, In order to be a good project logo, it needs look good when reduced 
down to 2 colors. I.e., on a black and white letterhead. Your logo, 
being 3D will not fit that simple guideline.

Evgeny Burzak wrote:
> Hello all,
> some times ago I make design for AppDB  (http://buzz.ulx.ru/pf/appdb.png). Folks was  delighted with this one, but managers rejected my idea due to needs redesign everything then. 
> But now it may be more actual then ever owing to Wine 1.0 release? I think it may gain attention from professionals who wants to use wine in production environment and improve Wine.
> I can make design for main pages, xml/xslt template and probably base php5 clasess if you decide to change site engine.
> 


From kwixbit at gmail.com  Wed Apr 23 10:39:19 2008
From: kwixbit at gmail.com (Warren Dumortier)
Date: Wed, 23 Apr 2008 17:39:19 +0200
Subject: Text bug in winecfg!
Message-ID: <f3a003030804230839o67ffde37j79de6a540e9b8174@mail.gmail.com>

Hello everybody!

When i use winecfg in english, text in winecfg looks good but in french and
some other languages it isn't the case, i made a screenshot to show the
(little, little, very little) bug, but i find it annoying!

Here is the little window screenshot:
http://www.host-img.com/files/fkn8csdlmgvd316z22uq.png

Is this a wine bug or not?

Thanks, kind regards
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080423/fbb9ed58/attachment.htm 

From mikolaj at zalewski.pl  Wed Apr 23 10:55:44 2008
From: mikolaj at zalewski.pl (=?UTF-8?B?TWlrb8WCYWogWmFsZXdza2k=?=)
Date: Wed, 23 Apr 2008 17:55:44 +0200
Subject: Text bug in winecfg!
In-Reply-To: <f3a003030804230839o67ffde37j79de6a540e9b8174@mail.gmail.com>
References: <f3a003030804230839o67ffde37j79de6a540e9b8174@mail.gmail.com>
Message-ID: <480F5C00.5020202@zalewski.pl>


> Is this a wine bug or not?
  It is a wine bug - the controls for such languages should be bigger.

Mikolaj Zalewski


From buzzilo at gmail.com  Wed Apr 23 07:28:50 2008
From: buzzilo at gmail.com (Evgeny Burzak)
Date: Wed, 23 Apr 2008 16:28:50 +0400
Subject: winehq.org redesign
In-Reply-To: <f3f1b91a0804221723v411255a2pda668cd191458e5b@mail.gmail.com>
References: <20080422023415.48a311e3.buzzilo@gmail.com>
	<480E5FA4.7080404@open-vote.org>
	<f3f1b91a0804221723v411255a2pda668cd191458e5b@mail.gmail.com>
Message-ID: <20080423162850.db564b7f.buzzilo@gmail.com>

On Tue, 22 Apr 2008 20:23:27 -0400
"Chris Morgan" <chmorgan at gmail.com> wrote:

> We've been throwing around the idea of switching the site to using
> drupal for a while now so we can more easily manage it remotely and
> take advantage of things like polls and news stories.
> 
> I'm sure more can be found but these are the ones that stuck out as
> some of the biggest improvements. We also need to find people
> interested in working on some of these features.
> 
> Chris

Switching to drupal is a great idea i think, but i have no deal with drupal at all.. 
I wonder how to move all content to new site? May be the simplest way is begin from scratch? :)


--
???????


From dank at kegel.com  Wed Apr 23 12:16:38 2008
From: dank at kegel.com (Dan Kegel)
Date: Wed, 23 Apr 2008 10:16:38 -0700
Subject: MSIME support causing slow setup until explorer.exe paused?
In-Reply-To: <a71bd89a0804211359m678d4310sd22910e2816221b9@mail.gmail.com>
References: <a71bd89a0804201349v6f827eb7ke6a7717ea3c7fdda@mail.gmail.com>
	<480C84C1.80003@codeweavers.com>
	<a71bd89a0804211359m678d4310sd22910e2816221b9@mail.gmail.com>
Message-ID: <a71bd89a0804231016k4249c9bbyc0cf27a86cb08392@mail.gmail.com>

On Mon, Apr 21, 2008 at 1:59 PM, Dan Kegel <dank at kegel.com> wrote:
>  >   MSIMEService, MSIMEReconvertOptions, MSIMEMouseOperator, etc... those are
>  > all Messages that Microsoft Office looks for and sends to the IME during
>  > operations.  For the most part all those messages are just stubbed.
>  >
>  >   The messages are Registered in Imm32/imm.c once per process, and also
>  > registered in winex11.drv/ime.c also once per process. I am pretty sure we
>  > do not send those messages somewhere. So I am not sure why they would be
>  > taking up so much cpu time.
>  >
>  >  Do you know what is happening with the messages during the slow-down?
>
>  Oddly, they don't seem to be happening on Dapper.  I'll try again on
>  Gutsy tonight.  (Chris Smith says he saw something like this with
>  iTunes on gentoo today, too.)

Not happening on the original machine anymore, either.  If I catch it acting
up again, I'll get a better log.


From alexd4 at inbox.lv  Wed Apr 23 15:53:21 2008
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Wed, 23 Apr 2008 23:53:21 +0300
Subject: MSIME support causing slow setup until explorer.exe paused?
In-Reply-To: <a71bd89a0804231016k4249c9bbyc0cf27a86cb08392@mail.gmail.com>
References: <a71bd89a0804201349v6f827eb7ke6a7717ea3c7fdda@mail.gmail.com>	<480C84C1.80003@codeweavers.com>	<a71bd89a0804211359m678d4310sd22910e2816221b9@mail.gmail.com>
	<a71bd89a0804231016k4249c9bbyc0cf27a86cb08392@mail.gmail.com>
Message-ID: <480FA1C1.9090505@inbox.lv>

I've just had something similar. Tried running a game (I think it was the first 
time I ran wine in this session), and suddenly system became sluggish. 
wineserver and explorer were sitting at 50+% and 40+% cpu respectively. Even 
after I killed the game. strace -p on explorer was also showing lots of these 
writes.

writev(3, [{"l\0\0\0*\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 
64}, {"M\0S\0I\0M\0E\0R\0e\0c\0o\0n\0v\0e\0r\0t\0R\0e\0"..., 42}], 2) = 106
read(4, "\0\0\0\0\0\0\0\0\3\300\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 64)

and other stuff like that (registry keys). Any specific steps that can be taken 
to narrow it down? This is unfortunately kind of random and not readily 
reproducible, after killing wineserver I don't see this any more.

Dan Kegel wrote:
> On Mon, Apr 21, 2008 at 1:59 PM, Dan Kegel <dank at kegel.com> wrote:
>>  >   MSIMEService, MSIMEReconvertOptions, MSIMEMouseOperator, etc... those are
>>  > all Messages that Microsoft Office looks for and sends to the IME during
>>  > operations.  For the most part all those messages are just stubbed.
>>  >
>>  >   The messages are Registered in Imm32/imm.c once per process, and also
>>  > registered in winex11.drv/ime.c also once per process. I am pretty sure we
>>  > do not send those messages somewhere. So I am not sure why they would be
>>  > taking up so much cpu time.
>>  >
>>  >  Do you know what is happening with the messages during the slow-down?
>>
>>  Oddly, they don't seem to be happening on Dapper.  I'll try again on
>>  Gutsy tonight.  (Chris Smith says he saw something like this with
>>  iTunes on gentoo today, too.)
> 
> Not happening on the original machine anymore, either.  If I catch it acting
> up again, I'll get a better log.


From galt280 at gmail.com  Wed Apr 23 16:07:37 2008
From: galt280 at gmail.com (Gal Topper)
Date: Wed, 23 Apr 2008 17:07:37 -0400
Subject: Fwd: SOC 2008 Projects Announced
In-Reply-To: <163937790804231405l28021041of223aa140a89ff64@mail.gmail.com>
References: <b6bb06270804221436s5dfab6fctbe89047e55b4a8e9@mail.gmail.com>
	<b130c85e0804222114v3b8abc00v965c598d780e5a44@mail.gmail.com>
	<163937790804231405l28021041of223aa140a89ff64@mail.gmail.com>
Message-ID: <163937790804231407s2fa1b2f7sfb82728bf25794e8@mail.gmail.com>

> Could the students come forward and say something about themself?

Hello everyone. My name is Gal Topper and my goal this summer will be
to implement PrintDlgEx* in Wine, so that we'll have support for the
newer and more flexible print dialog that was introduced in Windows
NT. I am a third year computer science student in York University in
Toronto, Canada, and lucky for me, my exams are over! So for now, I
can enjoy both the project and the spring. :)

I'm excited about this project and plan to keep you all up-to-date
when things start moving. :)

Cheers,
Gal


From david at l8s.co.uk  Wed Apr 23 16:09:32 2008
From: david at l8s.co.uk (David Laight)
Date: Wed, 23 Apr 2008 22:09:32 +0100
Subject: Fix "warning: cast from pointer to integer of different size"
In-Reply-To: <00b501c8a488$296854f0$a600fea9@DMITRY>
References: <20080422222441.b042f27b.mle+win@mega-nerd.com>
	<00b501c8a488$296854f0$a600fea9@DMITRY>
Message-ID: <20080423210932.GI29242@snowdrop.l8s.co.uk>

On Tue, Apr 22, 2008 at 11:50:05PM +0900, Dmitry Timoshkov wrote:
> "Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:
> 
> > /* get pointer to object containing list element */
> > #define LIST_ENTRY(elem, type, field) \
> > -    ((type *)((char *)(elem) - (unsigned int)(&((type *)0)->field)))
> > +    ((type *)((char *)(elem) - (unsigned long)(&((type *)0)->field)))

How about:
    ((type *)((char *)(elem) - ((char *)(&((type *)0)->field) - (char *)0)))

	David

-- 
David Laight: david at l8s.co.uk


From felix at compsoc.nuigalway.ie  Wed Apr 23 16:47:03 2008
From: felix at compsoc.nuigalway.ie (Darragh Bailey)
Date: Wed, 23 Apr 2008 22:47:03 +0100
Subject: no test structure in place for wine programs
Message-ID: <20080423214703.GB2678@compsoc.nuigalway.ie>

I'm been looking at bug 9628 (and duplicate 12222) whenever I get the
time to work on wine these days. I've gone through various tests, enough
to determine that msiexec on Windows must use some custom command line
parsing in order for it to work for the cases listed in those bugs given
that the behaviour is replicated by the standard command line API's in
windows.


So I've got to the stage where I believe the correct fix is to put in
some custom handling to make wine's msiexec match the behaviour of
windows version. So far so good. At this point I expect that there
should be some test cases added since this functionality wouldn't appear
frequently enough in most install cases for any future breaks to be
picked up if future changes are made.

So I expect to try and add some test cases, when I notice there is no 
test structure to test any of the exe's built by wine. Bit of a problem
there...

I'm assuming that the original assumption was that the programs just act
as entry points to the dll functionality, so there shouldn't be any need
to add unit tests for the programs. They will either work correctly once
the dll's function, or break really, really noticably.


Next step is the question?

Should I try to take the dll test structure (mainly just the
dlls/Maketest.rules.in file) and port this into the programs area?

or is that overboard for that area?

-- 
Darragh

"Nothing is foolproof to a sufficiently talented fool."


From jacek at codeweavers.com  Wed Apr 23 16:51:03 2008
From: jacek at codeweavers.com (Jacek Caban)
Date: Wed, 23 Apr 2008 23:51:03 +0200
Subject: Add implemantation of property "Name" (IHTMLWindow2)
In-Reply-To: <200804231544.40541.ivan@etersoft.ru>
References: <200804231544.40541.ivan@etersoft.ru>
Message-ID: <480FAF47.2010009@codeweavers.com>

Ivan Sinitsin wrote:
> This patch add implementation of HTMLWindow2_put_name, HTMLWindow2_get_name in 
> module htmlwindow.c (mshtml.dll)
>
> Changelog:
> Add implementation of HTMLWindow2_put_name, HTMLWindow2_get_name
>
>   
 > 

> @@ -289,15 +289,43 @@ static HRESULT WINAPI HTMLWindow2_get_na
>  static HRESULT WINAPI HTMLWindow2_put_name(IHTMLWindow2 *iface, BSTR v)
>  {
>      HTMLWindow *This = HTMLWINDOW2_THIS(iface);
> -    FIXME("(%p)->(%s)\n", This, debugstr_w(v));
> -    return E_NOTIMPL;
> +    nsAString aName;
> +    nsresult nsres;
> +
> +    TRACE("(%p)->(%s)\n", This, debugstr_w(v));
> +
> +    nsAString_Init(&aName, v);
> +    nsres = nsIDOMWindow_SetName(This->nswindow, &aName);
> +    if (NS_FAILED(nsres)) {
> +        TRACE("Failed nsIDOMWindow_SetName %08x \n",nsres);
> +        return nsres;

You shouldn't mix nsresult with HRESULT. Also you leak aName here. SetName should never return failure, so printinf ERR and returning S_OK is fine here.

> +    }
> +    nsAString_Finish(&aName);
> +    return S_OK;
>  }
>  
>  static HRESULT WINAPI HTMLWindow2_get_name(IHTMLWindow2 *iface, BSTR *p)
>  {
>      HTMLWindow *This = HTMLWINDOW2_THIS(iface);
> -    FIXME("(%p)->(%p)\n", This, p);
> -    return E_NOTIMPL;
> +    nsAString aName;
> +    nsresult nsres;
> +    TRACE("(%p)->(%p)\n", This, p);
> +
> +    nsAString_Init(&aName, NULL);
> +    nsres = nsIDOMWindow_GetName(This->nswindow, &aName);
> +    if (NS_FAILED(nsres)) {
> +        TRACE("Failed nsIDOMWindow_GetName %08x \n",nsres);
> +        return nsres;

Same as above.

> +    }
> +
> +    nsres = nsAString_GetData(&aName, p);

You can't do this, p is BSTR and must be allocated with SysAllocString. Look at other functions how to implement it.

> +    if (NS_FAILED(nsres)) {
> +        TRACE("Failed nsAString_GetData %08x \n",nsres);
> +        return nsres;
> +    }
> +    nsAString_Finish(&aName);
> +
> +    return S_OK;
>  }



Jacek



From dank at kegel.com  Wed Apr 23 17:11:00 2008
From: dank at kegel.com (Dan Kegel)
Date: Wed, 23 Apr 2008 15:11:00 -0700
Subject: no test structure in place for wine programs
Message-ID: <a71bd89a0804231511o5942e7aep3824a3f76dfa2b86@mail.gmail.com>

Darren wrote:
> Should I try to take the dll test structure (mainly just the
> dlls/Maketest.rules.in file) and port this into the programs area?
>
> or is that overboard for that area?

It's something we need eventually, but for now it would
probably be enough to just attach a standalone test
that invoked msiexec.exe and printed out PASS or FAIL
to http://bugs.winehq.org/show_bug.cgi?id=9628

It's not worth the effort to create the generic app
test framework inside the wine tree at the moment.


From mle+win at mega-nerd.com  Wed Apr 23 17:34:43 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Thu, 24 Apr 2008 08:34:43 +1000
Subject: Fix "warning: cast from pointer to integer of different size"
In-Reply-To: <20080423210932.GI29242@snowdrop.l8s.co.uk>
References: <20080422222441.b042f27b.mle+win@mega-nerd.com>
	<00b501c8a488$296854f0$a600fea9@DMITRY>
	<20080423210932.GI29242@snowdrop.l8s.co.uk>
Message-ID: <20080424083443.8d6536be.mle+win@mega-nerd.com>

David Laight wrote:

> On Tue, Apr 22, 2008 at 11:50:05PM +0900, Dmitry Timoshkov wrote:
> > "Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:
> > 
> > > /* get pointer to object containing list element */
> > > #define LIST_ENTRY(elem, type, field) \
> > > -    ((type *)((char *)(elem) - (unsigned int)(&((type *)0)->field)))
> > > +    ((type *)((char *)(elem) - (unsigned long)(&((type *)0)->field)))
> 
> How about:
>     ((type *)((char *)(elem) - ((char *)(&((type *)0)->field) - (char *)0)))

Much, much better, thank you. I don't know why I didn't see it myself.

Cheers,
Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
"I saw `cout' being shifted "Hello world" times to the left
and stopped right there." -- Steve Gonedes


From tkho at ucla.edu  Wed Apr 23 18:18:41 2008
From: tkho at ucla.edu (Thomas Kho)
Date: Wed, 23 Apr 2008 16:18:41 -0700
Subject: no test structure in place for wine programs
In-Reply-To: <a71bd89a0804231511o5942e7aep3824a3f76dfa2b86@mail.gmail.com>
References: <a71bd89a0804231511o5942e7aep3824a3f76dfa2b86@mail.gmail.com>
Message-ID: <ad4ecd9f0804231618l10a7055em2024aef8a839096f@mail.gmail.com>

On Wed, Apr 23, 2008 at 3:11 PM, Dan Kegel <dank at kegel.com> wrote:
> Darren wrote:
>  > Should I try to take the dll test structure (mainly just the
>  > dlls/Maketest.rules.in file) and port this into the programs area?
>  >
>  > or is that overboard for that area?
>
>  It's something we need eventually, but for now it would
>  probably be enough to just attach a standalone test
>  that invoked msiexec.exe and printed out PASS or FAIL
>  to http://bugs.winehq.org/show_bug.cgi?id=9628
>
>  It's not worth the effort to create the generic app
>  test framework inside the wine tree at the moment.

For what it's worth, I filed a feature request for something like this
some time ago. At the time, the suggestion was to use cxtest.

See http://bugs.winehq.org/show_bug.cgi?id=5616

-Tom


From winehacker at gmail.com  Wed Apr 23 21:35:39 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Wed, 23 Apr 2008 22:35:39 -0400
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
Message-ID: <19e31a080804231935y36ebc670q34a5d88939afb569@mail.gmail.com>

Hi,
My hope that was for Wine 1.0 we could add error handling for missing
dlls and functions that made sense to the user rather than just silent
failed or spewed messages to the console. If you have an application
that depends on a dll such as OUTLOOK.EXE depending on OUTLIB.DLL you
will get a message like this:

err:module:import_dll Library OUTLLIB.dll (which is needed by
L"Z:\\home\\sedwards\\.wine\\drive_c\\Program Files\\Microsoft
Office\\OFFICE11\\OUTLOOK.EXE") not found
err:module:LdrInitializeThunk Main exe initialization for
L"Z:\\home\\sedwards\\.wine\\drive_c\\Program Files\\Microsoft
Office\\OFFICE11\\OUTLOOK.EXE" failed, status c0000135

So instead how about throwing a nice message box? I started working on
this but don't quite know how to properly pass the information to the
MessageBoxW or maybe fill in the MessageBoxIndirect structure to
display the error in a human readable format. I just don't really
know. Of course once its done this would need to be broken out in to a
helper function, its just a proof of concept....

Anyone want to help?

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-Started-hacking-on-adding-a-MessageBox-error-for-mis.patch
Type: text/x-patch
Size: 1860 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080423/e72ca885/attachment.bin 

From dank at kegel.com  Wed Apr 23 21:51:13 2008
From: dank at kegel.com (Dan Kegel)
Date: Wed, 23 Apr 2008 19:51:13 -0700
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
Message-ID: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>

Hmm, maybe make explorer responsible for putting up the
messagebox, and set up some IPC method (good lord,
not COM, just some mailbox or something) for
the loader to notify it...


From winehacker at gmail.com  Wed Apr 23 22:00:14 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Wed, 23 Apr 2008 23:00:14 -0400
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
Message-ID: <19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>

On Wed, Apr 23, 2008 at 10:51 PM, Dan Kegel <dank at kegel.com> wrote:
> Hmm, maybe make explorer responsible for putting up the
>  messagebox, and set up some IPC method (good lord,
>  not COM, just some mailbox or something) for
>  the loader to notify it...

I thought of that, but your going to end up invoking more crap I
really think you don't need. This is a failure case after all.
Explorer is not running at this point so that means you have to start
it, then you could to send the messages which would be the simplest
form of IPC to it which is going to delay load user32 anyway so it can
display the message box...Its better just to do the equivalent of
LoadLibrary/GetProcAddress in the loader from a helper function and be
done with it.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From dank at kegel.com  Wed Apr 23 22:14:52 2008
From: dank at kegel.com (Dan Kegel)
Date: Wed, 23 Apr 2008 20:14:52 -0700
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
Message-ID: <a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>

On Wed, Apr 23, 2008 at 8:00 PM, Steven Edwards <winehacker at gmail.com> wrote:
>  > Hmm, maybe make explorer responsible for putting up the
>  > messagebox, and set up some IPC method for
>  > the loader to notify it...
>
>  I thought of that, but your going to end up invoking more crap I
>  really think you don't need. This is a failure case after all.
>  Explorer is not running at this point

Why not?   I thought Explorer was the first thing to start up...
- Dan


From dank at kegel.com  Wed Apr 23 22:39:40 2008
From: dank at kegel.com (Dan Kegel)
Date: Wed, 23 Apr 2008 20:39:40 -0700
Subject: xfs getting case-insensitive filesystem support...
Message-ID: <a71bd89a0804232039v49b3e0efmd38a045a0594d346@mail.gmail.com>

Hrm.  This is interesting:
  http://lwn.net/Articles/278961/
I wonder if Wine could run faster if it could delegate
the case-insensitvity to the filesystem...


From winehacker at gmail.com  Wed Apr 23 23:33:35 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Thu, 24 Apr 2008 00:33:35 -0400
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
Message-ID: <19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>

On Wed, Apr 23, 2008 at 11:14 PM, Dan Kegel <dank at kegel.com> wrote:
>  Why not?   I thought Explorer was the first thing to start up...

Your right, I thought it was loaded yet but I guess it does anytime
user32 is initalized. Looking at the process list after the messagebox
exits only wineserver, services and winedevice stay resident for a
while so I thought it had not loaded yet. I'll see if I can rework it
to send a message to explorer to display the dialog.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From winehacker at gmail.com  Wed Apr 23 23:45:56 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Thu, 24 Apr 2008 00:45:56 -0400
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
Message-ID: <19e31a080804232145p796e594t74e6d89dcaf49084@mail.gmail.com>

On Thu, Apr 24, 2008 at 12:33 AM, Steven Edwards <winehacker at gmail.com> wrote:
>  Your right, I thought it was loaded yet but I guess it does anytime
>  user32 is initalized. Looking at the process list after the messagebox
>  exits only wineserver, services and winedevice stay resident for a
>  while so I thought it had not loaded yet. I'll see if I can rework it
>  to send a message to explorer to display the dialog.

You were right. Looking at it a bit more maybe the best route is to
add a set of custom messages to user32 and explorer maybe something
like WM_WINE_DLLNOTFOUND/WM_WINE_MISSINGFUCTION or something and
manually do the server call using send_message. I am not exactly sure
how to do it as the actual wineserver call yet. I'll look at it a bit
more tomorrow and see if I can figure the plumbing out.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From jmayer at loplof.de  Thu Apr 24 00:47:02 2008
From: jmayer at loplof.de (Joerg Mayer)
Date: Thu, 24 Apr 2008 07:47:02 +0200
Subject: xfs getting case-insensitive filesystem support...
In-Reply-To: <a71bd89a0804232039v49b3e0efmd38a045a0594d346@mail.gmail.com>
References: <a71bd89a0804232039v49b3e0efmd38a045a0594d346@mail.gmail.com>
Message-ID: <20080424054702.GK21499@thot.informatik.uni-kl.de>

On Wed, Apr 23, 2008 at 08:39:40PM -0700, Dan Kegel wrote:
> Hrm.  This is interesting:
>   http://lwn.net/Articles/278961/
> I wonder if Wine could run faster if it could delegate
> the case-insensitvity to the filesystem...

Would be nice indeed, but I don't think it will come: Linus shot down
similar patches in the past because to_lower may be easy to implement
for ascii, but once you want to implement it for all charsets supported
by the files system it gets very messy.

 Ciao
     Joerg
-- 
Joerg Mayer                                           <jmayer at loplof.de>
We are stuck with technology when what we really want is just stuff that
works. Some say that should read Microsoft instead of technology.


From dmitry at codeweavers.com  Thu Apr 24 01:05:51 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Thu, 24 Apr 2008 15:05:51 +0900
Subject: xfs getting case-insensitive filesystem support...
References: <a71bd89a0804232039v49b3e0efmd38a045a0594d346@mail.gmail.com>
	<20080424054702.GK21499@thot.informatik.uni-kl.de>
Message-ID: <023801c8a5d1$43ea0fe0$a600fea9@DMITRY>

"Joerg Mayer" <jmayer at loplof.de> wrote:

> On Wed, Apr 23, 2008 at 08:39:40PM -0700, Dan Kegel wrote:
>> Hrm.  This is interesting:
>>   http://lwn.net/Articles/278961/
>> I wonder if Wine could run faster if it could delegate
>> the case-insensitvity to the filesystem...
> 
> Would be nice indeed, but I don't think it will come: Linus shot down
> similar patches in the past because to_lower may be easy to implement
> for ascii, but once you want to implement it for all charsets supported
> by the files system it gets very messy.

Sure, it's messy until the filesystem is unicode internally, and uses
something more reasonable instead of a multibyte UTF-8.

-- 
Dmitry.


From david at l8s.co.uk  Thu Apr 24 01:10:58 2008
From: david at l8s.co.uk (David Laight)
Date: Thu, 24 Apr 2008 07:10:58 +0100
Subject: xfs getting case-insensitive filesystem support...
In-Reply-To: <023801c8a5d1$43ea0fe0$a600fea9@DMITRY>
References: <a71bd89a0804232039v49b3e0efmd38a045a0594d346@mail.gmail.com>
	<20080424054702.GK21499@thot.informatik.uni-kl.de>
	<023801c8a5d1$43ea0fe0$a600fea9@DMITRY>
Message-ID: <20080424061058.GJ29242@snowdrop.l8s.co.uk>

On Thu, Apr 24, 2008 at 03:05:51PM +0900, Dmitry Timoshkov wrote:
> "Joerg Mayer" <jmayer at loplof.de> wrote:
> 
> > On Wed, Apr 23, 2008 at 08:39:40PM -0700, Dan Kegel wrote:
> >> Hrm.  This is interesting:
> >>   http://lwn.net/Articles/278961/
> >> I wonder if Wine could run faster if it could delegate
> >> the case-insensitvity to the filesystem...
> > 
> > Would be nice indeed, but I don't think it will come: Linus shot down
> > similar patches in the past because to_lower may be easy to implement
> > for ascii, but once you want to implement it for all charsets supported
> > by the files system it gets very messy.
> 
> Sure, it's messy until the filesystem is unicode internally, and uses
> something more reasonable instead of a multibyte UTF-8.

Unix filesystems treat filenames as byte-strings, this is 100% reasonable :-)
Any conversion to glygps isn't a filesyatem operation.

	David

-- 
David Laight: david at l8s.co.uk


From bsjeon at hanmail.net  Thu Apr 24 02:13:52 2008
From: bsjeon at hanmail.net (ByeongSik Jeon)
Date: Thu, 24 Apr 2008 16:13:52 +0900
Subject: imm32: If ImmNotifyIME fails, ImmSetOpenStatus should also fail.
In-Reply-To: <200804240356459857070006MAA5@nm06mta.auone-net.jp>
References: <200804240356459857070006MAA5@nm06mta.auone-net.jp>
Message-ID: <1209021232.3705.30.camel@localhost>

Kusanagi Kouichi wrote:
>      if (!fOpen != !data->IMC.fOpen)
>      {
> +        if (!ImmNotifyIME( hIMC, NI_CONTEXTUPDATED, 0, IMC_SETOPENSTATUS))
> +            return FALSE;
>          data->IMC.fOpen = fOpen;
> -        ImmNotifyIME( hIMC, NI_CONTEXTUPDATED, 0, IMC_SETOPENSTATUS);
>          ImmInternalSendIMENotify(data, IMN_SETSENTENCEMODE, 0);
Hi,

MS Windows's native imm32.dll return TRUE although NotifyIME return
FALSE. I have tested it with the DDK's Japanese FakeIME.



From dank at kegel.com  Thu Apr 24 04:18:21 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 24 Apr 2008 02:18:21 -0700
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <19e31a080804232145p796e594t74e6d89dcaf49084@mail.gmail.com>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	<19e31a080804232145p796e594t74e6d89dcaf49084@mail.gmail.com>
Message-ID: <a71bd89a0804240218i41f29607ob37b3c09cb7a7926@mail.gmail.com>

On Wed, Apr 23, 2008 at 9:45 PM, Steven Edwards <winehacker at gmail.com> wrote:
> On Thu, Apr 24, 2008 at 12:33 AM, Steven Edwards <winehacker at gmail.com> wrote:
>  >  Your right, I thought it was loaded yet but I guess it does anytime
>  >  user32 is initalized. Looking at the process list after the messagebox
>  >  exits only wineserver, services and winedevice stay resident for a
>  >  while so I thought it had not loaded yet. I'll see if I can rework it
>  >  to send a message to explorer to display the dialog.
>
>  You were right. Looking at it a bit more maybe the best route is to
>  add a set of custom messages to user32 and explorer maybe something
>  like WM_WINE_DLLNOTFOUND/WM_WINE_MISSINGFUCTION or something and
>  manually do the server call using send_message. I am not exactly sure
>  how to do it as the actual wineserver call yet. I'll look at it a bit
>  more tomorrow and see if I can figure the plumbing out.

Alternately we could cheeze it and exec xmessage :-)


From julliard at winehq.org  Thu Apr 24 04:36:56 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 24 Apr 2008 11:36:56 +0200
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	(Steven Edwards's message of "Thu, 24 Apr 2008 00:33:35 -0400")
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
Message-ID: <87r6cv8uh3.fsf@wine.dyndns.org>

"Steven Edwards" <winehacker at gmail.com> writes:

> On Wed, Apr 23, 2008 at 11:14 PM, Dan Kegel <dank at kegel.com> wrote:
>>  Why not?   I thought Explorer was the first thing to start up...
>
> Your right, I thought it was loaded yet but I guess it does anytime
> user32 is initalized. Looking at the process list after the messagebox
> exits only wineserver, services and winedevice stay resident for a
> while so I thought it had not loaded yet. I'll see if I can rework it
> to send a message to explorer to display the dialog.

You certainly don't want to call through explorer for that, showing a
message box directly is fine. You have to be careful to only do it when
loading the main exe, not for any random dll load; also you have to
properly handle the case of a missing X display.

-- 
Alexandre Julliard
julliard at winehq.org


From dank at kegel.com  Thu Apr 24 04:50:04 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 24 Apr 2008 02:50:04 -0700
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <87r6cv8uh3.fsf@wine.dyndns.org>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	<87r6cv8uh3.fsf@wine.dyndns.org>
Message-ID: <a71bd89a0804240250n285933ebl831c82a30412b66b@mail.gmail.com>

On Thu, Apr 24, 2008 at 2:36 AM, Alexandre Julliard <julliard at winehq.org> wrote:
>  You certainly don't want to call through explorer for that, showing a
>  message box directly is fine.

Well, that's easier :-)

> You have to be careful to only do it when
>  loading the main exe, not for any random dll load

Yeah, I guess some apps tolerate missing DLLs by loading them manually.
We'll miss a few problems (e.g. apps that delay-load but can't handle
the missing dll) but that's ok.

> also you have to properly handle the case of a missing X display

right, and just not call MessageBox.

Hmm, ideally we would send them to a web page that gave
information tailored to the dll in question, but a MessageBox is
good enough for 1.0.


From austinenglish at gmail.com  Thu Apr 24 05:01:30 2008
From: austinenglish at gmail.com (Austin English)
Date: Thu, 24 Apr 2008 05:01:30 -0500
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <a71bd89a0804240250n285933ebl831c82a30412b66b@mail.gmail.com>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	<87r6cv8uh3.fsf@wine.dyndns.org>
	<a71bd89a0804240250n285933ebl831c82a30412b66b@mail.gmail.com>
Message-ID: <b6bb06270804240301te516ee8xebb035f363bd19f7@mail.gmail.com>

On Thu, Apr 24, 2008 at 4:50 AM, Dan Kegel <dank at kegel.com> wrote:

> On Thu, Apr 24, 2008 at 2:36 AM, Alexandre Julliard <julliard at winehq.org>
> wrote:
> >  You certainly don't want to call through explorer for that, showing a
> >  message box directly is fine.
>
> Well, that's easier :-)
>
> > You have to be careful to only do it when
> >  loading the main exe, not for any random dll load
>
> Yeah, I guess some apps tolerate missing DLLs by loading them manually.
> We'll miss a few problems (e.g. apps that delay-load but can't handle
> the missing dll) but that's ok.
>
> > also you have to properly handle the case of a missing X display
>
> right, and just not call MessageBox.
>
> Hmm, ideally we would send them to a web page that gave
> information tailored to the dll in question, but a MessageBox is
> good enough for 1.0.
>
>
> A link to a wiki page (http://wiki.winehq/MissingDLL ?) with list of
common dlls/where they come from/what they do/how to use winetricks/etc.)
would be a bit easier/quicker to implement.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080424/7d9a7453/attachment.htm 

From julliard at winehq.org  Thu Apr 24 05:17:20 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 24 Apr 2008 12:17:20 +0200
Subject: mshtml #5: Added more IDispatchEx tests.
In-Reply-To: <480F4BB9.5040003@codeweavers.com> (Jacek Caban's message of
	"Wed, 23 Apr 2008 16:46:17 +0200")
References: <480F4BB9.5040003@codeweavers.com>
Message-ID: <87iqy78slr.fsf@wine.dyndns.org>

Jacek Caban <jacek at codeweavers.com> writes:

>  dlls/mshtml/tests/dom.c |   56
> +++++++++++++++++++++++++++++++----------------
>  1 files changed, 37 insertions(+), 19 deletions(-)

It doesn't work here:

../../../tools/runtest -q -P wine -M mshtml.dll -T ../../.. -p mshtml_test.exe.so dom.c && touch dom.ok
dom.c:1381: Test failed: GetTypeInfo failed: 8002802b
dom.c:1394: Test failed: GetTypeInfo failed: 8002802b
make[2]: *** [dom.ok] Error 2

-- 
Alexandre Julliard
julliard at winehq.org


From aric at codeweavers.com  Thu Apr 24 08:28:36 2008
From: aric at codeweavers.com (Aric Stewart)
Date: Thu, 24 Apr 2008 08:28:36 -0500
Subject: [3/4] user32: Set the vkey value to VK_PROCESSKEY when IME process
	key.
In-Reply-To: <1209026394.3705.91.camel@localhost>
References: <1209026394.3705.91.camel@localhost>
Message-ID: <48108B04.4080305@codeweavers.com>

Thank you for these investigations This is really nice. I support those 
patches.

I just wanted to also communicate a bit of additional information from 
my investigations just in case someone asks.  I placed hooks on both 
WH_KEYBOARD_LL and WH_KEYBOARD.  Even when the IME is active both of 
those hooks showed the VKEY of the actual keystroke.

This showed me that all of this processing happened after 
process_keyboard_message.

great work and thanks,
-aric


ByeongSik Jeon wrote:
> When the MS Windows set the vkey value(MSG.wParam) to VK_PROCESSKEY?
> 
> I have tested following code:
> ----------------------------
> while ( GetMessage(&msg, 0, 0, 0) ) {
>     if ( msg.message == WM_KEYDOWN )
>         printf("OLD: %x %x %x\n", msg.message, msg.wParam, msg.lParam);
>     TranslateMessage( &msg );
> ?    if ( msg.message == WM_KEYDOWN )
>         printf("NEW: %x %x %x\n", msg.message, msg.wParam, msg.lParam);
>     DispatchMessage( &msg );
> }
> -----------------------------
> The result is:
> -----------------------------
> OLD: 100 e5 130001
> NEW: 100 e5 130001
> OLD: 100 e5 250001
> NEW: 100 e5 250001
> OLD: 100 e5 130001
> NEW: 100 e5 130001
> ?-----------------------------
> e5 is VK_PROCESSKEY.
> Before GetMessage, PeekMessage return, msg.wPram ahs seted to VK_PROCESSKEY.
> 
> ---
>  dlls/user32/message.c |    9 +++++++--
>  1 files changed, 7 insertions(+), 2 deletions(-)
> 
> 
> ------------------------------------------------------------------------
> 
> 


From hverbeet at gmail.com  Thu Apr 24 09:06:01 2008
From: hverbeet at gmail.com (H. Verbeet)
Date: Thu, 24 Apr 2008 16:06:01 +0200
Subject: [1/7] D3D9: Make the offscreen format test a bit more tolerant
In-Reply-To: <200804241451.31685.stefan@codeweavers.com>
References: <200804241451.31685.stefan@codeweavers.com>
Message-ID: <d658b69e0804240706t664706f2s4e6d6febb0ba6d45@mail.gmail.com>

2008/4/24 Stefan D?singer <stefan at codeweavers.com>:
>
FWIW, for my texop test I wrote a function to do this in a generic
way. I'll probably submit that in the next few days.


From frick at sc-networks.de  Thu Apr 24 09:20:38 2008
From: frick at sc-networks.de (Christoph Frick)
Date: Thu, 24 Apr 2008 16:20:38 +0200
Subject: dinput: Limit number of supported axis and buttons
In-Reply-To: <481093CF.20805@kievinfo.com>
References: <481093CF.20805@kievinfo.com>
Message-ID: <20080424142033.GV5348@byleth.sc-networks.de>

On Thu, Apr 24, 2008 at 08:06:07AM -0600, Vitaliy Margolen wrote:

> +        FIXME("Can't support %d axis. Clamping down to 16\n", newDevice->axes);
           FIXME("Can't support %d axes. Clamping down to 16\n", newDevice->axes);

-- 
cu
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 163 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080424/c290199a/attachment.pgp 

From jacek at codeweavers.com  Thu Apr 24 09:25:20 2008
From: jacek at codeweavers.com (Jacek Caban)
Date: Thu, 24 Apr 2008 16:25:20 +0200
Subject: mshtml #5: Added more IDispatchEx tests.
In-Reply-To: <87iqy78slr.fsf@wine.dyndns.org>
References: <480F4BB9.5040003@codeweavers.com> <87iqy78slr.fsf@wine.dyndns.org>
Message-ID: <48109850.1090803@codeweavers.com>

Alexandre Julliard wrote:
> Jacek Caban <jacek at codeweavers.com> writes:
>
>   
>>  dlls/mshtml/tests/dom.c |   56
>> +++++++++++++++++++++++++++++++----------------
>>  1 files changed, 37 insertions(+), 19 deletions(-)
>>     
>
> It doesn't work here:
>
> ../../../tools/runtest -q -P wine -M mshtml.dll -T ../../.. -p mshtml_test.exe.so dom.c && touch dom.ok
> dom.c:1381: Test failed: GetTypeInfo failed: 8002802b
> dom.c:1394: Test failed: GetTypeInfo failed: 8002802b
> make[2]: *** [dom.ok] Error 2
>
>   

mshtml.tlb needs to be rebuilt after "mshtml.idl: Added 
DispHTMLUnknownElement declaration." patch. make depend is not enough.

Thanks,
    Jacek


From astrand at cendio.se  Thu Apr 24 09:41:37 2008
From: astrand at cendio.se (=?UTF-8?Q?Peter_=C3=85strand?=)
Date: Thu, 24 Apr 2008 16:41:37 +0200 (CEST)
Subject: winmm/tests: waveOutGetDevCaps called with invalid size
In-Reply-To: <480F119D.5050107@earthlink.net>
References: <Pine.LNX.4.64.0804181102080.23847@maggie.lkpg.cendio.se>
	<4808B145.2010609@earthlink.net>
	<Pine.LNX.4.64.0804211050260.12791@maggie.lkpg.cendio.se>
	<480D12B1.3070309@earthlink.net>
	<Pine.LNX.4.64.0804220842440.29058@maggie.lkpg.cendio.se>
	<480DC438.7010107@earthlink.net>
	<Pine.LNX.4.64.0804230822450.15637@maggie.lkpg.cendio.se>
	<480F119D.5050107@earthlink.net>
Message-ID: <Pine.LNX.4.64.0804232120070.26015@maggie.lkpg.cendio.se>


> > > There are only two options: only pass the number of bytes requested 
> > > or return an error for unreasonable sizes.  What is Terminal Server 
> > > doing?
> >
> > It's returning an error. 
> >   
> And what is the error?  If you know the error code returned, Ill add it 
> to the code so we can end this discussion.

The error is MMSYSERR_INVALPARAM. 

Sure, you can add the error code to the list of accepted return code, but 
I still don't understand the meaning of this test. You are basically 
testing the sound card driver, rather than the winmm subsystem. 


> > > waveOutGetDevCapsW lets the driver do the copy (just like old versions of
> > > windows).  The driver should be checking the size and only copying that
> > > much.
> > > If it doesn't, then it broken.
> >
> > Any references for this claim?
> >   
> Read the code.

Since we are trying to follow MS, reading the Wine code doesn't really 
give us a hint of what MS considers valid or invalid. 


> > You are saying that the driver "should only copy that much", but *what*
> > should it copy? In other words: If the size doesn't match the size of any
> > known structure (WAVEOUTCAPSA/WAVEOUTCAPSW/WAVEOUTCAPS2A/WAVEOUTCAPS2W),
> > should the driver then just *assume* some structure? Which one? As far as I
> > know, there's no guarantee that, for example, the first sizeof(WAVEOUTCAPSW)
> > bytes of WAVEOUTCAPSW are the same as WAVEOUTCAPS2W. 
> >
> >   
> Again, read the code. WAVEOUTCAPS2 is a superset of WAVEOUTCAPS
> so it doesn't matter when the length is shorter than WAVEOUTCAPS.  The
> drivers only support W so mixing A and W is not an issue.

Are you saying that WODM_GETDEVCAPS messages are always limited to the "W" 
versions? So, drivers don't need to handle WODM_GETDEVCAPS messages with 
"A" type structs? I had no idea of that. Any reference for this? 
 

Rgds, 
---
Peter ?strand		ThinLinc Chief Developer
Cendio AB		http://www.cendio.se
Wallenbergs gata 4
583 30 Link?ping	Phone: +46-13-21 46 00

From julliard at winehq.org  Thu Apr 24 09:42:03 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 24 Apr 2008 16:42:03 +0200
Subject: mshtml #5: Added more IDispatchEx tests.
In-Reply-To: <48109850.1090803@codeweavers.com> (Jacek Caban's message of
	"Thu, 24 Apr 2008 16:25:20 +0200")
References: <480F4BB9.5040003@codeweavers.com>
	<87iqy78slr.fsf@wine.dyndns.org> <48109850.1090803@codeweavers.com>
Message-ID: <8763u78gck.fsf@wine.dyndns.org>

Jacek Caban <jacek at codeweavers.com> writes:

> mshtml.tlb needs to be rebuilt after "mshtml.idl: Added
> DispHTMLUnknownElement declaration." patch. make depend is not enough.

I see, make depend needs to be fixed. I'll have a look.

-- 
Alexandre Julliard
julliard at winehq.org


From winehacker at gmail.com  Thu Apr 24 09:55:53 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Thu, 24 Apr 2008 10:55:53 -0400
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <87r6cv8uh3.fsf@wine.dyndns.org>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	<87r6cv8uh3.fsf@wine.dyndns.org>
Message-ID: <19e31a080804240755o51963e61xebe17b174382fb88@mail.gmail.com>

On Thu, Apr 24, 2008 at 5:36 AM, Alexandre Julliard <julliard at winehq.org> wrote:
>  You certainly don't want to call through explorer for that, showing a
>  message box directly is fine. You have to be careful to only do it when
>  loading the main exe, not for any random dll load; also you have to
>  properly handle the case of a missing X display.

OK so is doing this in ntdll even the right case? I don't really see
where to do it only from the main exe. I understand we don't want to
report the error if the application is manually doing a
GetProcAddress/LoadLibrary but again don't really know how to limit
it. Here is my stab #2, it actually returns something sane to the
user.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-Took-a-stab-at-graphically-reporting-an-error-when-a.patch
Type: text/x-patch
Size: 2212 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080424/ce0f53f2/attachment.bin 

From wine-devel at kievinfo.com  Thu Apr 24 10:04:56 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Thu, 24 Apr 2008 09:04:56 -0600
Subject: dinput: Limit number of supported axis and buttons
In-Reply-To: <20080424142033.GV5348@byleth.sc-networks.de>
References: <481093CF.20805@kievinfo.com>
	<20080424142033.GV5348@byleth.sc-networks.de>
Message-ID: <4810A198.1010807@kievinfo.com>

Christoph Frick wrote:
> On Thu, Apr 24, 2008 at 08:06:07AM -0600, Vitaliy Margolen wrote:
> 
>> +        FIXME("Can't support %d axis. Clamping down to 16\n", newDevice->axes);
>            FIXME("Can't support %d axes. Clamping down to 16\n", newDevice->axes);
> 

Thanks for catching it. Fixed patch resent.

Vitaliy


From julliard at winehq.org  Thu Apr 24 10:12:46 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 24 Apr 2008 17:12:46 +0200
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <19e31a080804240755o51963e61xebe17b174382fb88@mail.gmail.com>
	(Steven Edwards's message of "Thu, 24 Apr 2008 10:55:53 -0400")
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	<87r6cv8uh3.fsf@wine.dyndns.org>
	<19e31a080804240755o51963e61xebe17b174382fb88@mail.gmail.com>
Message-ID: <871w4v8exd.fsf@wine.dyndns.org>

"Steven Edwards" <winehacker at gmail.com> writes:

> On Thu, Apr 24, 2008 at 5:36 AM, Alexandre Julliard <julliard at winehq.org> wrote:
>>  You certainly don't want to call through explorer for that, showing a
>>  message box directly is fine. You have to be careful to only do it when
>>  loading the main exe, not for any random dll load; also you have to
>>  properly handle the case of a missing X display.
>
> OK so is doing this in ntdll even the right case? I don't really see
> where to do it only from the main exe.

It depends which cases you are trying to catch, but for the case of
users starting an app from their desktop, you could probably do it in
start.exe.

-- 
Alexandre Julliard
julliard at winehq.org


From razielmine at gmail.com  Thu Apr 24 11:57:29 2008
From: razielmine at gmail.com (RazZziel)
Date: Thu, 24 Apr 2008 19:57:29 +0300
Subject: SOC 2008 Projects Announced
In-Reply-To: <b130c85e0804222114v3b8abc00v965c598d780e5a44@mail.gmail.com>
References: <b6bb06270804221436s5dfab6fctbe89047e55b4a8e9@mail.gmail.com>
	<b130c85e0804222114v3b8abc00v965c598d780e5a44@mail.gmail.com>
Message-ID: <82e274890804240957n351820b7g89613cc784a75fc0@mail.gmail.com>

>  Could the students come forward and say something about themself?

Hi there

I'm from Spain and I'm supposed to hack DirectPlay support up until
wine can fully run at least GTA2 multiplayer out of the box, but I
hope to have time enough to give some love to other dplay games. I'll
try not to have too much fun in the testing phases, I promise :)

I still have to get some exams done before embracing the sleepless
nights of passionate coding (and/or swearing against msdn), but things
are going faster than expected and I hopefully will be free of urgent
duties in two or three weeks.

Hope not to break anything
Over and out
   Ismael


From frick at sc-networks.de  Thu Apr 24 13:31:21 2008
From: frick at sc-networks.de (Christoph Frick)
Date: Thu, 24 Apr 2008 20:31:21 +0200
Subject: dinput: Limit number of supported axis and buttons [try 2]
In-Reply-To: <4810A16B.3000003@kievinfo.com>
References: <4810A16B.3000003@kievinfo.com>
Message-ID: <20080424183121.GY5348@byleth.sc-networks.de>

On Thu, Apr 24, 2008 at 09:04:11AM -0600, Vitaliy Margolen wrote:

ok, don't beat me on this one (i guess i could have asked this also for
try one):

> +        FIXME("Can't support %d axes. Clamping down to 16\n", newDevice->axes);
> ...
> +        WARN("Can't support %d buttons. Clamping down to 128\n", newDevice->buttons);

why is axes a FIXME and buttons a WARN?

-- 
cu
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 163 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080424/c4b8df0e/attachment.pgp 

From eric.pouech at orange.fr  Thu Apr 24 15:10:36 2008
From: eric.pouech at orange.fr (Eric Pouech)
Date: Thu, 24 Apr 2008 22:10:36 +0200
Subject: Call for testers
Message-ID: <4810E93C.1010702@orange.fr>

Has you may have seen, a new rendering interface is now available for 
Winhelp
It should be better (with the last row of patches) than the old one, but 
still not perfect
And likely not bug free, hence the call for testers

I'm waiting for some real feedback from real users about reading your 
old .hlp files
The new rendering is turned on by setting the env variable 
WINHELP_RICHEDIT to 1

A+

-- 
Eric Pouech
"The problem with designing something completely foolproof is to underestimate the ingenuity of a complete idiot." (Douglas Adams)




From julliard at winehq.org  Thu Apr 24 15:43:40 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 24 Apr 2008 22:43:40 +0200
Subject: [PATCH 06/12] widl: Create a statement object for import
	statements.
In-Reply-To: <4810CC40.5000101@codeweavers.com> (Robert Shearman's message of
	"Thu, 24 Apr 2008 19:06:56 +0100")
References: <4810CC40.5000101@codeweavers.com>
Message-ID: <87wsmn6l1f.fsf@wine.dyndns.org>

Robert Shearman <rob at codeweavers.com> writes:

> Move the writing of include directives into the generated header into
> header.c.

This one doesn't work right, it doesn't output the #include statements
so the resulting .h files don't compile.

-- 
Alexandre Julliard
julliard at winehq.org


From mle+win at mega-nerd.com  Thu Apr 24 19:47:30 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Fri, 25 Apr 2008 10:47:30 +1000
Subject: dnghelp : Fix pointer cast.
In-Reply-To: <20080425103603.830aff9a.mle+win@mega-nerd.com>
References: <20080425103603.830aff9a.mle+win@mega-nerd.com>
Message-ID: <20080425104730.0ada0bfd.mle+win@mega-nerd.com>

Erik de Castro Lopo wrote:

> 
> Make the pointer cast safe for Wine64.

Please disregard this one as there is a better patch on the
way.

Cheers,
Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
"Within C++, there is a much smaller and cleaner language struggling
to get out." -- Bjarne Stroustrup


From wine-devel at kievinfo.com  Thu Apr 24 20:52:27 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Thu, 24 Apr 2008 19:52:27 -0600
Subject: dinput: Limit number of supported axis and buttons [try 2]
In-Reply-To: <20080424183121.GY5348@byleth.sc-networks.de>
References: <4810A16B.3000003@kievinfo.com>
	<20080424183121.GY5348@byleth.sc-networks.de>
Message-ID: <4811395B.9030905@kievinfo.com>

Christoph Frick wrote:
> On Thu, Apr 24, 2008 at 09:04:11AM -0600, Vitaliy Margolen wrote:
> 
> ok, don't beat me on this one (i guess i could have asked this also for
> try one):
> 
>> +        FIXME("Can't support %d axes. Clamping down to 16\n", newDevice->axes);
>> ...
>> +        WARN("Can't support %d buttons. Clamping down to 128\n", newDevice->buttons);
> 
> why is axes a FIXME and buttons a WARN?
> 
Because default joystick data format supports up to 128 buttons. So even if 
Wine would be using custom data format most programs probably won't be able 
to use all of the buttons.

At the same time there are number of extra axes left in the data format that 
Wine is not using.

So in short - there is something that can be done to support more axes but 
not much about buttons.

PS. I'd like to see a "joystick" with more then 128 buttons...

Vitaliy.


From tehblunderbuss at gmail.com  Thu Apr 24 22:01:41 2008
From: tehblunderbuss at gmail.com (TheBlunderbuss)
Date: Thu, 24 Apr 2008 22:01:41 -0500
Subject: Safedisc for 1.0+ ?
Message-ID: <48114995.3010703@gmail.com>

An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080424/3e854a30/attachment.htm 

From jjmckenzie51 at sprintpcs.com  Thu Apr 24 22:17:19 2008
From: jjmckenzie51 at sprintpcs.com (James McKenzie)
Date: Thu, 24 Apr 2008 20:17:19 -0700
Subject: Wine t-shirts?
In-Reply-To: <480F2E38.7010506@winehq.org>
References: <a71bd89a0804230443w3240caf7v46108219330713af@mail.gmail.com>
	<480F2E38.7010506@winehq.org>
Message-ID: <48114D3F.2080408@sprintpcs.com>

Jeremy White wrote:
>> http://kegel.com/wine/wine-penguin-corkscrew.png
>>     
>
> Jon Parshall is proud of his ability to draw those penguins,
> and we'd gladly send that artwork to anyone that wanted to make a T-shirt.
>
> Note, though, that we felt we had to (very sadly) drop the penguin; it doesn't
> really work for Mac users.
>
>   
Why not?  There is always Yellow Dog and several Linux variants for the 
Mac.....

And I'm always for support the 'quin and have been before Slack 1.0 
(yes, I'm older than dirt and proud of it!)

(And I remember Wine, a long, long time ago in a galaxy far, far away 
(think Far East))

At one time I was a supporter and tester for Project Odin and its 
predecessors.

James McKenzie



From wine-devel at kievinfo.com  Thu Apr 24 22:57:39 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Thu, 24 Apr 2008 21:57:39 -0600
Subject: Safedisc for 1.0+ ?
In-Reply-To: <48114995.3010703@gmail.com>
References: <48114995.3010703@gmail.com>
Message-ID: <481156B3.5060802@kievinfo.com>

TheBlunderbuss wrote:
>     It has just occurred to me that safedisc copy protection (bug 219!) 
> wasn't put on the Wine 1.0 task list. It's a pretty major bug and covers 
> a wide range of programs, with a wide range of safedisc versions.
> Considering this, how should we plan for this implementation?
> 
Some versions should work. Newer versions mos likely won't. But as usual in 
these cases your mileage may vary. Since there are so many variables.

Setting target for such bugs to 1.0 won't magically fix them. Nor will it 
keep them from breaking.

Vitaliy.


From dmitry at codeweavers.com  Thu Apr 24 22:38:10 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 25 Apr 2008 12:38:10 +0900
Subject: user32 : Temporarily disable test for _WIN64.
References: <20080425102920.05581ba3.mle+win@mega-nerd.com>
Message-ID: <01ae01c8a68a$b60cf7e0$a600fea9@DMITRY>

"Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:

> The file dlls/user32/tests/edit.c currently doesn't compile when
> configured with --enable-win64 because GWL_WNDPROC (in include/winuser.h)
> is not defined when _WIN64 is defined.

Then you need to fix the test instead of disabling it.

-- 
Dmitry.


From dmitry at codeweavers.com  Thu Apr 24 22:44:14 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 25 Apr 2008 12:44:14 +0900
Subject: shel32/tests : Use LOWORD to extract rc from pointer.
References: <20080425124410.cf2f58ef.mle+win@mega-nerd.com>
Message-ID: <01af01c8a68a$bb245fc0$a600fea9@DMITRY>

"Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:

> -    rc=(int)ShellExecute(NULL, operation, file, parameters, directory,
> -                         SW_SHOWNORMAL);
> +    rc=LOWORD(ShellExecute(NULL, operation, file, parameters, directory,
> +                         SW_SHOWNORMAL));
>  
>      if (rc > 32)
>      {
> @@ -167,7 +167,7 @@ static int shell_execute_ex(DWORD mask, LPCSTR operation, LPCSTR file,
>      DeleteFile(child_file);
>      SetLastError(0xcafebabe);
>      success=ShellExecuteEx(&sei);
> -    rc=(int)sei.hInstApp;
> +    rc=LOWORD(sei.hInstApp);
>      ok((success && rc > 32) || (!success && rc <= 32),
>         "%s rc=%d and hInstApp=%d is not allowed\n", shell_call, success, rc);
>  
> @@ -836,24 +836,24 @@ static void test_find_executable(void)
>      /* Don't test FindExecutable(..., NULL), it always crashes */
>  
>      strcpy(command, "your word");
> -    rc=(int)FindExecutableA(NULL, NULL, command);
> +    rc=LOWORD(FindExecutableA(NULL, NULL, command));
>      ok(rc == SE_ERR_FNF || rc > 32 /* nt4 */, "FindExecutable(NULL) returned %d\n", rc);

You need to change the type of rc to HINSTANCE and fix the comparisons instead.
What happens if the returned HINSTANCE has a value <= 32 in its low word?

-- 
Dmitry.


From mle+win at mega-nerd.com  Thu Apr 24 23:26:37 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Fri, 25 Apr 2008 14:26:37 +1000
Subject: user32 : Temporarily disable test for _WIN64.
In-Reply-To: <01ae01c8a68a$b60cf7e0$a600fea9@DMITRY>
References: <20080425102920.05581ba3.mle+win@mega-nerd.com>
	<01ae01c8a68a$b60cf7e0$a600fea9@DMITRY>
Message-ID: <20080425142637.2476970f.mle+win@mega-nerd.com>

Dmitry Timoshkov wrote:

> "Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:
> 
> > The file dlls/user32/tests/edit.c currently doesn't compile when
> > configured with --enable-win64 because GWL_WNDPROC (in include/winuser.h)
> > is not defined when _WIN64 is defined.
> 
> Then you need to fix the test instead of disabling it.

In include/winuser.h we have:

    #if !defined _WIN64 && !defined __WINESRC__
    # define GWL_USERDATA        (-21)
    # define GWL_ID              (-12)
    # define GWL_HWNDPARENT      (-8)
    # define GWL_HINSTANCE       (-6)
    # define GWL_WNDPROC         (-4)
    # define DWL_MSGRESULT       0
    # define DWL_DLGPROC         4
    # define DWL_USER            8
    #endif /* _WIN64 && __WINESRC__ */

which means fixing the test requires first finding out the correct
values of these defines under _WIN64. That seems a waste of effort
when I'm aiming to get the simplest of WIN64 apps running, like
a "Hello world" program that prints to stdout.

Secondly, being unable to compile wine configured with --enable-win64
because of a test for code that has zero percent chance of being
correct anyway seems counter productive.

Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
Seen on comp.lang.python:
Q : If someone has the code in python for a buffer overflow,
    please post it.
A : Python does not support buffer overflows, sorry.


From dmitry at codeweavers.com  Thu Apr 24 23:34:10 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 25 Apr 2008 13:34:10 +0900
Subject: Add an include/config.h variable WINE_IS_WIN64 which is 1
	whenconfigured with --enable-win64 and 0 otherwise.
References: <20080425135107.46b65abd.mle+win@mega-nerd.com>
Message-ID: <01fb01c8a68e$1f6f8bf0$a600fea9@DMITRY>

"Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:

> Add an include/config.h variable WINE_IS_WIN64 which is 1 whenconfigured with --enable-win64 and 0 otherwise.

It would be helpful to at least provide an explanation why yo need
this, and why _WIN64 macro is not enough.

-- 
Dmitry.


From dmitry at codeweavers.com  Thu Apr 24 23:36:47 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 25 Apr 2008 13:36:47 +0900
Subject: ntdll : Do not error out on AMD-64 architecture when compiling
	win64.
References: <20080425135611.bc5ecc82.mle+win@mega-nerd.com>
Message-ID: <01fe01c8a68e$2491a230$a600fea9@DMITRY>

"Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:

> +#if WINE_IS_WIN64
> +    if (nt->FileHeader.Machine == IMAGE_FILE_MACHINE_AMD64)
> +        MESSAGE("Support for AMD-64 architecture in progress but not yet working\n");
> +    else
> +#endif

What's the point of this?

-- 
Dmitry.


From dank at kegel.com  Thu Apr 24 23:39:36 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 24 Apr 2008 21:39:36 -0700
Subject: Wine t-shirts?
In-Reply-To: <48114D3F.2080408@sprintpcs.com>
References: <a71bd89a0804230443w3240caf7v46108219330713af@mail.gmail.com>
	<480F2E38.7010506@winehq.org> <48114D3F.2080408@sprintpcs.com>
Message-ID: <a71bd89a0804242139seb68edfxd9620e995acf18c8@mail.gmail.com>

James McKenzie <jjmckenzie51 at sprintpcs.com> wrote:
>  At one time I was a supporter and tester for Project Odin and its
> predecessors.

Wow.

I gave up on OS/2 Warp right from the git-go,
when they shipped me 30 floppies instead of a cd-rom.
I really wanted Microsoft to have competition, but
I just couldn't bear the thought of going through a
30 floppy install!
- Dan


From mle+win at mega-nerd.com  Thu Apr 24 23:43:37 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Fri, 25 Apr 2008 14:43:37 +1000
Subject: ntdll : Do not error out on AMD-64 architecture when compiling
	win64.
In-Reply-To: <01fe01c8a68e$2491a230$a600fea9@DMITRY>
References: <20080425135611.bc5ecc82.mle+win@mega-nerd.com>
	<01fe01c8a68e$2491a230$a600fea9@DMITRY>
Message-ID: <20080425144337.ace28a4e.mle+win@mega-nerd.com>

Dmitry Timoshkov wrote:

> "Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:
> 
> > +#if WINE_IS_WIN64
> > +    if (nt->FileHeader.Machine == IMAGE_FILE_MACHINE_AMD64)
> > +        MESSAGE("Support for AMD-64 architecture in progress but not yet working\n");
> > +    else
> > +#endif
> 
> What's the point of this?

At the moment trying to get wine to execute a win64 binary fails
if

    nt->FileHeader.Machine != IMAGE_FILE_MACHINE_I386

This patch along with the last one which added WINE_IS_WIN64 allows
an attempt to be made to execute a WIN64 binary.

Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
C++: The power, elegance and simplicity of a hand grenade.


From dmitry at codeweavers.com  Thu Apr 24 23:44:19 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 25 Apr 2008 13:44:19 +0900
Subject: user32 : Temporarily disable test for _WIN64.
References: <20080425102920.05581ba3.mle+win@mega-nerd.com><01ae01c8a68a$b60cf7e0$a600fea9@DMITRY>
	<20080425142637.2476970f.mle+win@mega-nerd.com>
Message-ID: <022301c8a68f$37ffbc20$a600fea9@DMITRY>

"Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:

> In include/winuser.h we have:
> 
>    #if !defined _WIN64 && !defined __WINESRC__
>    # define GWL_USERDATA        (-21)
>    # define GWL_ID              (-12)
>    # define GWL_HWNDPARENT      (-8)
>    # define GWL_HINSTANCE       (-6)
>    # define GWL_WNDPROC         (-4)
>    # define DWL_MSGRESULT       0
>    # define DWL_DLGPROC         4
>    # define DWL_USER            8
>    #endif /* _WIN64 && __WINESRC__ */
> 
> which means fixing the test requires first finding out the correct
> values of these defines under _WIN64.

winuser.h already has the correct values for _WIN64.

> That seems a waste of effort
> when I'm aiming to get the simplest of WIN64 apps running, like
> a "Hello world" program that prints to stdout.

I assume that you have all other problems sorted out? (compiler support,
TLS layout, calling conventions, other ABI incompatibilities).

> Secondly, being unable to compile wine configured with --enable-win64
> because of a test for code that has zero percent chance of being
> correct anyway seems counter productive.

It's counter productive to start fighting without investigating the subject
first.

-- 
Dmitry.


From mle+win at mega-nerd.com  Thu Apr 24 23:48:09 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Fri, 25 Apr 2008 14:48:09 +1000
Subject: Add an include/config.h variable WINE_IS_WIN64 which is 1
	whenconfigured with --enable-win64 and 0 otherwise.
In-Reply-To: <01fb01c8a68e$1f6f8bf0$a600fea9@DMITRY>
References: <20080425135107.46b65abd.mle+win@mega-nerd.com>
	<01fb01c8a68e$1f6f8bf0$a600fea9@DMITRY>
Message-ID: <20080425144809.b8406129.mle+win@mega-nerd.com>

Dmitry Timoshkov wrote:

> "Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:
> 
> > Add an include/config.h variable WINE_IS_WIN64 which is 1 when
> > configured with --enable-win64 and 0 otherwise.
> 
> It would be helpful to at least provide an explanation why yo need
> this, and why _WIN64 macro is not enough.

You are right, _WIN64 is sufficient.

Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
A good debugger is no substitute for a good test suite.


From dank at kegel.com  Thu Apr 24 23:50:10 2008
From: dank at kegel.com (Dan Kegel)
Date: Thu, 24 Apr 2008 21:50:10 -0700
Subject: "make test" - only four tests failing!
Message-ID: <a71bd89a0804242150y47d17e49k5d967db356400042@mail.gmail.com>

"make test" is pretty darn close to passing;
only four tests left to fix.  (Oddly, different
sets fail depending on display mode.)
Details at the end of
http://bugs.winehq.org/show_bug.cgi?id=9916

Let's get these fixed before code freeze!


From truiken at gmail.com  Thu Apr 24 23:55:21 2008
From: truiken at gmail.com (James Hawkins)
Date: Thu, 24 Apr 2008 23:55:21 -0500
Subject: "make test" - only four tests failing!
In-Reply-To: <a71bd89a0804242150y47d17e49k5d967db356400042@mail.gmail.com>
References: <a71bd89a0804242150y47d17e49k5d967db356400042@mail.gmail.com>
Message-ID: <22821af30804242155x6e87762biee7dfd599dec6dc@mail.gmail.com>

On Thu, Apr 24, 2008 at 11:50 PM, Dan Kegel <dank at kegel.com> wrote:
> "make test" is pretty darn close to passing;
>  only four tests left to fix.  (Oddly, different
>  sets fail depending on display mode.)
>  Details at the end of
>  http://bugs.winehq.org/show_bug.cgi?id=9916
>
>  Let's get these fixed before code freeze!
>

Yours is one of the lucky machines.  According to test.winehq.org, the
average number of wine module failures is 11.

-- 
James Hawkins


From mle+win at mega-nerd.com  Thu Apr 24 23:58:55 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Fri, 25 Apr 2008 14:58:55 +1000
Subject: user32 : Temporarily disable test for _WIN64.
In-Reply-To: <022301c8a68f$37ffbc20$a600fea9@DMITRY>
References: <20080425102920.05581ba3.mle+win@mega-nerd.com>
	<01ae01c8a68a$b60cf7e0$a600fea9@DMITRY>
	<20080425142637.2476970f.mle+win@mega-nerd.com>
	<022301c8a68f$37ffbc20$a600fea9@DMITRY>
Message-ID: <20080425145855.f415059d.mle+win@mega-nerd.com>

Dmitry Timoshkov wrote:

> "Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:
> 
> > In include/winuser.h we have:
> > 
> >    #if !defined _WIN64 && !defined __WINESRC__
> >    # define GWL_USERDATA        (-21)
> >    # define GWL_ID              (-12)
> >    # define GWL_HWNDPARENT      (-8)
> >    # define GWL_HINSTANCE       (-6)
> >    # define GWL_WNDPROC         (-4)
> >    # define DWL_MSGRESULT       0
> >    # define DWL_DLGPROC         4
> >    # define DWL_USER            8
> >    #endif /* _WIN64 && __WINESRC__ */
> > 
> > which means fixing the test requires first finding out the correct
> > values of these defines under _WIN64.
> 
> winuser.h already has the correct values for _WIN64.

I has _WIN64, but if _WIN64 is defined then GWL_WNDPROC is undefined
and the test in dlls/user32/tests/edit.c fails to compile.

> I assume that you have all other problems sorted out? (compiler support,
> TLS layout, calling conventions, other ABI incompatibilities).

I'm sure I haven't, but if the wine code doesn't compile I can't
debug any problems in these areas.

Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
"In civilian equipment, such as computers, the number
of components alone makes miniaturization essential if
the computer is to be housed in a reasonable-sized
building." Electronics Oct. 1, 1957, p. 178


From dmitry at codeweavers.com  Fri Apr 25 00:37:44 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 25 Apr 2008 14:37:44 +0900
Subject: user32 : Temporarily disable test for _WIN64.
References: <20080425102920.05581ba3.mle+win@mega-nerd.com><01ae01c8a68a$b60cf7e0$a600fea9@DMITRY><20080425142637.2476970f.mle+win@mega-nerd.com><022301c8a68f$37ffbc20$a600fea9@DMITRY>
	<20080425145855.f415059d.mle+win@mega-nerd.com>
Message-ID: <02f701c8a696$8c0433d0$a600fea9@DMITRY>

"Erik de Castro Lopo" <mle+win at mega-nerd.com> wrote:

> I has _WIN64, but if _WIN64 is defined then GWL_WNDPROC is undefined
> and the test in dlls/user32/tests/edit.c fails to compile.

I'll let you figure this out on your own, that's a helpful thing to learn.

>> I assume that you have all other problems sorted out? (compiler support,
>> TLS layout, calling conventions, other ABI incompatibilities).
> 
> I'm sure I haven't, but if the wine code doesn't compile I can't
> debug any problems in these areas.

user32 is not required for a simple "Hello World" app, isn't it?

-- 
Dmitry.


From dmitry at codeweavers.com  Fri Apr 25 00:42:37 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 25 Apr 2008 14:42:37 +0900
Subject: [PATCH] advapi32: add more checks in CRYPT_CreateMachineGuid.
References: <558b2f5c0804242155r7cb5a2d5jabf484e841ee6594@mail.gmail.com>
Message-ID: <032901c8a697$2d2b3ce0$a600fea9@DMITRY>

"Lei Zhang" <thestig at google.com> wrote:

> I'm getting a crash in CRYPT_CreateMachineGuid() with native
> rpcrt4.dll. This adds some checks to work around it.

I assume that "native" == "win9x" in this case.

>      pRpcStringFree = GetProcAddress(lib, "RpcStringFreeW");
> +    if (!pUuidCreate || !pUuidToString || !pRpcStringFree) goto CreateMachineGuidCleaup;

It would be better to use A versions of APIs then instead of failing,

-- 
Dmitry.


From thestig at google.com  Fri Apr 25 00:53:39 2008
From: thestig at google.com (Lei Zhang)
Date: Thu, 24 Apr 2008 22:53:39 -0700
Subject: [PATCH] advapi32: add more checks in CRYPT_CreateMachineGuid.
In-Reply-To: <032901c8a697$2d2b3ce0$a600fea9@DMITRY>
References: <558b2f5c0804242155r7cb5a2d5jabf484e841ee6594@mail.gmail.com>
	<032901c8a697$2d2b3ce0$a600fea9@DMITRY>
Message-ID: <558b2f5c0804242253yc2cc86eg9b7c7eac5df8bf6f@mail.gmail.com>

On Thu, Apr 24, 2008 at 10:42 PM, Dmitry Timoshkov
<dmitry at codeweavers.com> wrote:
> "Lei Zhang" <thestig at google.com> wrote:
>
>
> > I'm getting a crash in CRYPT_CreateMachineGuid() with native
> > rpcrt4.dll. This adds some checks to work around it.
> >
>
>  I assume that "native" == "win9x" in this case.
>
>
> >     pRpcStringFree = GetProcAddress(lib, "RpcStringFreeW");
> > +    if (!pUuidCreate || !pUuidToString || !pRpcStringFree) goto
> CreateMachineGuidCleaup;
> >
>
>  It would be better to use A versions of APIs then instead of failing,
>
>  --
>  Dmitry.
>

Right, native == win9x here. The GetProcAddress call actually
succeeds, but then pUuidToString returns RPC_S_CANNOT_SUPPORT.

I'll send a better patch out tomorrow.


From mle+win at mega-nerd.com  Fri Apr 25 01:08:39 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Fri, 25 Apr 2008 16:08:39 +1000
Subject: user32 : Temporarily disable test for _WIN64.
In-Reply-To: <02f701c8a696$8c0433d0$a600fea9@DMITRY>
References: <20080425102920.05581ba3.mle+win@mega-nerd.com>
	<01ae01c8a68a$b60cf7e0$a600fea9@DMITRY>
	<20080425142637.2476970f.mle+win@mega-nerd.com>
	<022301c8a68f$37ffbc20$a600fea9@DMITRY>
	<20080425145855.f415059d.mle+win@mega-nerd.com>
	<02f701c8a696$8c0433d0$a600fea9@DMITRY>
Message-ID: <20080425160839.8772173a.mle+win@mega-nerd.com>

Dmitry Timoshkov wrote:

> I'll let you figure this out on your own, that's a helpful thing to learn.

????

> user32 is not required for a simple "Hello World" app, isn't it?

I didn't disable test for user32, I disabled a single test. That
test was testing edit controls and I am 100% sure that edit controls
are not needed for a simple hello world program that prints to
stdout.

Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
"The music business is a cruel and shallow money trench, a long
 plastic hallway where thieves and pimps run free, and good men
 die like dogs. There's also a negative side."
   -- Hunter S. Thompson


From fgouget at free.fr  Fri Apr 25 03:12:50 2008
From: fgouget at free.fr (Francois Gouget)
Date: Fri, 25 Apr 2008 10:12:50 +0200 (CEST)
Subject: user32 : Temporarily disable test for _WIN64.
In-Reply-To: <20080425160839.8772173a.mle+win@mega-nerd.com>
References: <20080425102920.05581ba3.mle+win@mega-nerd.com>
	<01ae01c8a68a$b60cf7e0$a600fea9@DMITRY>
	<20080425142637.2476970f.mle+win@mega-nerd.com>
	<022301c8a68f$37ffbc20$a600fea9@DMITRY>
	<20080425145855.f415059d.mle+win@mega-nerd.com>
	<02f701c8a696$8c0433d0$a600fea9@DMITRY>
	<20080425160839.8772173a.mle+win@mega-nerd.com>
Message-ID: <alpine.DEB.1.10.0804251005470.3555@amboise.dolphin>

On Fri, 25 Apr 2008, Erik de Castro Lopo wrote:
[...]
> > user32 is not required for a simple "Hello World" app, isn't it?
> 
> I didn't disable test for user32, I disabled a single test. That
> test was testing edit controls and I am 100% sure that edit controls
> are not needed for a simple hello world program that prints to
> stdout.

That's ok to do in your local Git repository.

However you have to understand that we cannot very well commit patch 
that disables a test which is very useful in garanteeing there won't be 
regressions in the very much used and about to go stable 32bit version 
for hypothetical progress in the 64bit version.

But by all means hack and slash your local tree so you can get to the 
crux of the matter quickly.

-- 
Francois Gouget <fgouget at free.fr>              http://fgouget.free.fr/
            "Lotto: A tax on people who are bad at math." -- unknown
          "Windows: Microsoft's tax on computer illiterates." -- WE7U


From mle+win at mega-nerd.com  Fri Apr 25 03:33:25 2008
From: mle+win at mega-nerd.com (Erik de Castro Lopo)
Date: Fri, 25 Apr 2008 18:33:25 +1000
Subject: user32 : Temporarily disable test for _WIN64.
In-Reply-To: <alpine.DEB.1.10.0804251005470.3555@amboise.dolphin>
References: <20080425102920.05581ba3.mle+win@mega-nerd.com>
	<01ae01c8a68a$b60cf7e0$a600fea9@DMITRY>
	<20080425142637.2476970f.mle+win@mega-nerd.com>
	<022301c8a68f$37ffbc20$a600fea9@DMITRY>
	<20080425145855.f415059d.mle+win@mega-nerd.com>
	<02f701c8a696$8c0433d0$a600fea9@DMITRY>
	<20080425160839.8772173a.mle+win@mega-nerd.com>
	<alpine.DEB.1.10.0804251005470.3555@amboise.dolphin>
Message-ID: <20080425183325.734ef069.mle+win@mega-nerd.com>

Francois Gouget wrote:

> That's ok to do in your local Git repository.
> 
> However you have to understand that we cannot very well commit patch 
> that disables a test which is very useful in garanteeing there won't be 
> regressions in the very much used and about to go stable 32bit version 
> for hypothetical progress in the 64bit version.

My patch only disabled this one test for Win64. It remained enabled
and active for Win32.
 
However, after some rather subtle prompting from Dmitry Timoshkov
and Reece Dunn, I have fixed the test so that it compiles correctly
for Win32 and Win64.

Cheers,
Erik
-- 
-----------------------------------------------------------------
Erik de Castro Lopo
-----------------------------------------------------------------
"What is freedom of expression? Without the freedom to offend,
it ceases to exist." - Salman Rushdie


From david.adam.cnrs at gmail.com  Thu Apr 24 21:20:11 2008
From: david.adam.cnrs at gmail.com (David Adam)
Date: Fri, 25 Apr 2008 04:20:11 +0200
Subject: ddraw: ComputeSphereVisibility
Message-ID: <5f9140a20804241920i1473bf12gd13fb5a8e5ae3183@mail.gmail.com>

Hello,

I am trying to debug the demo of The Sting. Now, the main is that the screen
is almost black. It is surely related to the following FIXME:
fixme:d3d7:IDirect3DDeviceImpl_7_ComputeSphereVisibility

Unfortunately, I did not find any informations about this function. Does
anyone know what this function does, ( and better knows a possible
implementation)?

Thanks,

David Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080425/10658a8d/attachment.htm 

From msclrhd at googlemail.com  Fri Apr 25 01:19:00 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Fri, 25 Apr 2008 07:19:00 +0100
Subject: user32 : Temporarily disable test for _WIN64.
In-Reply-To: <20080425160839.8772173a.mle+win@mega-nerd.com>
References: <20080425102920.05581ba3.mle+win@mega-nerd.com>
	<01ae01c8a68a$b60cf7e0$a600fea9@DMITRY>
	<20080425142637.2476970f.mle+win@mega-nerd.com>
	<022301c8a68f$37ffbc20$a600fea9@DMITRY>
	<20080425145855.f415059d.mle+win@mega-nerd.com>
	<02f701c8a696$8c0433d0$a600fea9@DMITRY>
	<20080425160839.8772173a.mle+win@mega-nerd.com>
Message-ID: <3f4fd2640804242319i2761d499r9385bbf13cdbaf4c@mail.gmail.com>

2008/4/25 Erik de Castro Lopo <mle+win at mega-nerd.com>:
> Dmitry Timoshkov wrote:
>
>  > I'll let you figure this out on your own, that's a helpful thing to learn.
>
>  ????

Try looking up GetWindowLongPtr in MSDN. That should be enough of a
hint to help you to get the edit.c tests building properly with _WIN64
defined (as well as supporting WIN32).

- Reece


From julliard at winehq.org  Fri Apr 25 07:35:42 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 25 Apr 2008 14:35:42 +0200
Subject: [Resend 2/5] imm32: Add the header for private imm32 function.
In-Reply-To: <1209091034.2601.14.camel@localhost> (ByeongSik Jeon's message of
	"Fri, 25 Apr 2008 11:37:14 +0900")
References: <62a23f5c679edef0d94693f1a48eca307adeaae4.1209090301.git.bsjeon@hanmail.net>
	<1209091034.2601.14.camel@localhost>
Message-ID: <874p9qjen5.fsf@wine.dyndns.org>

ByeongSik Jeon <bsjeon at hanmail.net> writes:

> Unknown function in the SDK/DDK's header.
> ---
>  include/wine/imm_private.h |   35 +++++++++++++++++++++++++++++++++++

You don't want to add a new header for that, especially not a global
one. The function is exported on Windows too, so it's OK to declare it
in the DDK header.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Fri Apr 25 07:52:24 2008
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 25 Apr 2008 14:52:24 +0200
Subject: ntoskrnl.exe: Change calling conventions [try 2]
In-Reply-To: <200804251408.25035.amorozov@etersoft.ru> (Alexander Morozov's
	message of "Fri, 25 Apr 2008 14:08:24 +0400")
References: <200804251408.25035.amorozov@etersoft.ru>
Message-ID: <87zlrihzav.fsf@wine.dyndns.org>

Alexander Morozov <amorozov at etersoft.ru> writes:

> Changelog:
> ntoskrnl.exe: Change calling conventions for InterlockedExchange, 
> InterlockedCompareExchange, InterlockedDecrement and InterlockedIncrement
>
> --- a/dlls/ntoskrnl.exe/ntoskrnl.exe.spec
> +++ b/dlls/ntoskrnl.exe/ntoskrnl.exe.spec
> @@ -28,11 +28,11 @@
>  @ stub Exfi386InterlockedExchangeUlong
>  @ stub Exfi386InterlockedIncrementLong
>  @ stub HalExamineMBR
> -@ stdcall InterlockedCompareExchange(ptr long long) kernel32.InterlockedCompareExchange
> -@ stdcall InterlockedDecrement(ptr) kernel32.InterlockedDecrement
> -@ stdcall InterlockedExchange(ptr long) kernel32.InterlockedExchange
> +@ stdcall -norelay InterlockedCompareExchange(ptr long long) NTOSKRNL_InterlockedCompareExchange
> +@ stdcall -norelay InterlockedDecrement(ptr) NTOSKRNL_InterlockedDecrement
> +@ stdcall -norelay InterlockedExchange(ptr long) NTOSKRNL_InterlockedExchange
>  @ stdcall InterlockedExchangeAdd(ptr long ) kernel32.InterlockedExchangeAdd
> -@ stdcall InterlockedIncrement(ptr) kernel32.InterlockedIncrement
> +@ stdcall -norelay InterlockedIncrement(ptr) NTOSKRNL_InterlockedIncrement

Why didn't you fix InterlockedExchangeAdd too?

-- 
Alexandre Julliard
julliard at winehq.org


From wine-devel at kievinfo.com  Fri Apr 25 08:07:08 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Fri, 25 Apr 2008 07:07:08 -0600
Subject: [PATCH] user32: edit controls should ignore WM_KEYDOWN on control
	+ enter.
In-Reply-To: <558b2f5c0804242223j6918b02enccb1ba5c59924552@mail.gmail.com>
References: <558b2f5c0804242222h2bfa942j7f3cecaaebc0ab81@mail.gmail.com>
	<558b2f5c0804242223j6918b02enccb1ba5c59924552@mail.gmail.com>
Message-ID: <4811D77C.4000203@kievinfo.com>

Lei Zhang wrote:
> On Thu, Apr 24, 2008 at 10:22 PM, Lei Zhang <thestig at google.com> wrote:
>> Hi,
>>
>>  This should be the last bit in getting control + enter working in
>>  multiline edit controls. I attempted to write a test for this using
>>  SendInput() or SetKeyState() + SendMessage(), but I couldn't get seem
>>  to simulate holding down the control key.
>>
> 
Should work. You can also look at keybd_event() how it does it. It's pretty 
much a wrapper around SendInput().
All you'll need is keybd_event(VK_CONTROL, 0, 0, 0); to press it. And 
keybd_event(VK_CONTROL, 0, KEYEVENTF_KEYUP, 0); to release it.

Vitaliy.



From felix at compsoc.nuigalway.ie  Fri Apr 25 09:00:47 2008
From: felix at compsoc.nuigalway.ie (Darragh Bailey)
Date: Fri, 25 Apr 2008 15:00:47 +0100
Subject: Safedisc for 1.0+ ?
In-Reply-To: <481156B3.5060802@kievinfo.com>
References: <48114995.3010703@gmail.com> <481156B3.5060802@kievinfo.com>
Message-ID: <20080425140047.GB7597@compsoc.nuigalway.ie>

On Thu, Apr 24, 2008 at 09:57:39PM -0600, Vitaliy Margolen wrote:
> TheBlunderbuss wrote:
> >     It has just occurred to me that safedisc copy protection (bug 219!) 
> > wasn't put on the Wine 1.0 task list. It's a pretty major bug and covers 
> > a wide range of programs, with a wide range of safedisc versions.
> > Considering this, how should we plan for this implementation?
> > 
> Some versions should work. Newer versions mos likely won't. But as usual in 
> these cases your mileage may vary. Since there are so many variables.
> 
> Setting target for such bugs to 1.0 won't magically fix them. Nor will it 
> keep them from breaking.

There has been some movement in the past to split up the Safedisc bug
and deal with the individual versions separately. Would it be useful to
advance this? I'm certain that I have a number of games that listed as
apps affected by this bug that no longer have a problem. So I'm not sure
that it works well to maintain the same bug for all versions of
safedisc.


-- 
Darragh

"Nothing is foolproof to a sufficiently talented fool."


From amorozov at etersoft.ru  Fri Apr 25 09:22:08 2008
From: amorozov at etersoft.ru (Alexander Morozov)
Date: Fri, 25 Apr 2008 18:22:08 +0400
Subject: ntoskrnl.exe: Change calling conventions [try 2]
In-Reply-To: <87zlrihzav.fsf@wine.dyndns.org>
References: <200804251408.25035.amorozov@etersoft.ru>
	<87zlrihzav.fsf@wine.dyndns.org>
Message-ID: <200804251822.08764.amorozov@etersoft.ru>

> Why didn't you fix InterlockedExchangeAdd too?

Yes, this function also should be fixed. I will send new patch. Sorry. I got 
confused because this function worked:

#include "wdm.h"

#pragma code_seg("INIT")
NTSTATUS DriverEntry(IN PDRIVER_OBJECT DriverObject,
        IN PUNICODE_STRING RegistryPath)
{
    LONG a = 0xaa, b = 0xbb, *ptr = &b, ret = 0xcc;

    ret = InterlockedExchangeAdd(ptr, a);
    DbgPrint("*ptr %x, ret %x\n", *ptr, ret);

    return STATUS_SUCCESS;
}
#pragma code_seg()

...........
   10628:       c7 45 fc aa 00 00 00    movl   $0xaa,0xfffffffc(%ebp)
   1062f:       c7 45 f4 bb 00 00 00    movl   $0xbb,0xfffffff4(%ebp)
   10636:       8d 45 f4                lea    0xfffffff4(%ebp),%eax
   10639:       89 45 f8                mov    %eax,0xfffffff8(%ebp)
   1063c:       c7 45 f0 cc 00 00 00    movl   $0xcc,0xfffffff0(%ebp)
   10643:       8b 55 fc                mov    0xfffffffc(%ebp),%edx
   10646:       8b 4d f8                mov    0xfffffff8(%ebp),%ecx
   10649:       e8 42 fe ff ff          call   0x10490
...........


From aric at codeweavers.com  Fri Apr 25 09:36:36 2008
From: aric at codeweavers.com (Aric Stewart)
Date: Fri, 25 Apr 2008 09:36:36 -0500
Subject: Kusanagi Kouichi : winex11:	Destroy the handle to the composition
	string after it is cancelled.
In-Reply-To: <E1JpNhv-0008GY-P4@wine.codeweavers.com>
References: <E1JpNhv-0008GY-P4@wine.codeweavers.com>
Message-ID: <4811EC74.8010006@codeweavers.com>

Comming in a bit late on this one, (missed the patch submission)

I do not think this is correct as far as i know hCompStr should never be 
NULL. Much of our code depends on that not being NULL.

I would recommend using ImeCreateBlankCompStr instead. (something like 
below)

diff --git a/dlls/winex11.drv/ime.c b/dlls/winex11.drv/ime.c
index f50549f..8fa6f6f 100644
--- a/dlls/winex11.drv/ime.c
+++ b/dlls/winex11.drv/ime.c
@@ -778,7 +778,7 @@ BOOL WINAPI NotifyIME(HIMC hIMC, DWORD dwAction, 
DWORD dwInd
                      if (lpIMC->hCompStr)
                      {
                          ImmDestroyIMCC(lpIMC->hCompStr);
-                        lpIMC->hCompStr = NULL;
+                        lpIMC->hCompStr = ImeCreateBlankCompStr();
                      }

                      myPrivate = 
(LPIMEPRIVATE)ImmLockIMCC(lpIMC->hPrivate);

-aric

Alexandre Julliard wrote:
> Module: wine
> Branch: master
> Commit: 4f2330ac0c951ec5fb05e2fb152c59723c3af336
> URL:    http://source.winehq.org/git/wine.git/?a=commit;h=4f2330ac0c951ec5fb05e2fb152c59723c3af336
> 
> Author: Kusanagi Kouichi <slash at ma.neweb.ne.jp>
> Date:   Fri Apr 25 12:08:24 2008 +0900
> 
> winex11: Destroy the handle to the composition string after it is cancelled.
> 
> ---
> 
>  dlls/winex11.drv/ime.c |    6 ++++++
>  1 files changed, 6 insertions(+), 0 deletions(-)
> 
> diff --git a/dlls/winex11.drv/ime.c b/dlls/winex11.drv/ime.c
> index 6614213..f50549f 100644
> --- a/dlls/winex11.drv/ime.c
> +++ b/dlls/winex11.drv/ime.c
> @@ -775,6 +775,12 @@ BOOL WINAPI NotifyIME(HIMC hIMC, DWORD dwAction, DWORD dwIndex, DWORD dwValue)
>  
>                      X11DRV_ForceXIMReset(lpIMC->hWnd);
>  
> +                    if (lpIMC->hCompStr)
> +                    {
> +                        ImmDestroyIMCC(lpIMC->hCompStr);
> +                        lpIMC->hCompStr = NULL;
> +                    }
> +
>                      myPrivate = (LPIMEPRIVATE)ImmLockIMCC(lpIMC->hPrivate);
>                      if (myPrivate->bInComposition)
>                      {
> 
> 
> 


From mstefani at redhat.com  Fri Apr 25 09:40:31 2008
From: mstefani at redhat.com (Michael Stefaniuc)
Date: Fri, 25 Apr 2008 16:40:31 +0200
Subject: John Klehm : winex11: Add support for IsXExtensionPointer tablet
	devices.
In-Reply-To: <E1JpNhf-0008AF-Q6@wine.codeweavers.com>
References: <E1JpNhf-0008AF-Q6@wine.codeweavers.com>
Message-ID: <4811ED5F.6080108@redhat.com>

This patch break compilation on my RHEL5 box with 
xorg-x11-proto-devel-7.1-9.fc6 which misses the IsXExtensionPointer define.

bye
	michael

Alexandre Julliard wrote:
> Module: wine
> Branch: master
> Commit: 2c26ea609d6b2b8a25be20984c0014ceb202466a
> URL:    http://source.winehq.org/git/wine.git/?a=commit;h=2c26ea609d6b2b8a25be20984c0014ceb202466a
> 
> Author: John Klehm <xixsimplicityxix at gmail.com>
> Date:   Tue Apr 22 20:11:28 2008 -0500
> 
> winex11: Add support for IsXExtensionPointer tablet devices.
> 
> ---
> 
>  dlls/winex11.drv/wintab.c |    5 +++--
>  1 files changed, 3 insertions(+), 2 deletions(-)
> 
> diff --git a/dlls/winex11.drv/wintab.c b/dlls/winex11.drv/wintab.c
> index 37596ba..b086e44 100644
> --- a/dlls/winex11.drv/wintab.c
> +++ b/dlls/winex11.drv/wintab.c
> @@ -530,14 +530,15 @@ void X11DRV_LoadTabletInfo(HWND hwnddefault)
>                  devices[loop].use == IsXKeyboard ? "IsXKeyboard" :
>                      devices[loop].use == IsXPointer ? "IsXPointer" :
>                      devices[loop].use == IsXExtensionDevice ? "IsXExtensionDevice" :
> +                    devices[loop].use == IsXExtensionPointer ? "IsXExtensionPointer" :
>                      "Unknown"
>                  );
>  
> -        if (devices[loop].use == IsXExtensionDevice)
> +        if ((devices[loop].use == IsXExtensionDevice) || (devices[loop].use == IsXExtensionPointer))
>          {
>              LPWTI_CURSORS_INFO cursor;
>  
> -            TRACE("Is Extension Device\n");
> +            TRACE("Is XExtension%s\n", (devices[loop].use == IsXExtensionDevice)? "Device":"Pointer");
>              cursor_target++;
>              target = &devices[loop];
>              cursor = &gSysCursor[cursor_target];
> 
> 
> 


-- 
Michael Stefaniuc                           Tel.: +49-711-96437-199
Consulting Communications Engineer          Fax.: +49-711-96437-111
--------------------------------------------------------------------
Reg. Adresse: Red Hat GmbH, Otto-Hahn-Strasse 20, 85609 Dornach bei Muenchen
Handelsregister: Amtsgericht Muenchen HRB 153243
Gesch?ftsf?hrer: Brendan Lane, Charlie Peters, Michael Cunningham,
                  Werner Knoblich


From winehacker at gmail.com  Fri Apr 25 10:50:22 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Fri, 25 Apr 2008 11:50:22 -0400
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <871w4v8exd.fsf@wine.dyndns.org>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	<87r6cv8uh3.fsf@wine.dyndns.org>
	<19e31a080804240755o51963e61xebe17b174382fb88@mail.gmail.com>
	<871w4v8exd.fsf@wine.dyndns.org>
Message-ID: <19e31a080804250850l360f0e13jc7cf7c28c2f1a961@mail.gmail.com>

On Thu, Apr 24, 2008 at 11:12 AM, Alexandre Julliard
<julliard at winehq.org> wrote:
>  It depends which cases you are trying to catch, but for the case of
>  users starting an app from their desktop, you could probably do it in
>  start.exe.

As per our discussion on IRC, start uses CreateProcess which according
to Raymond and my own testing does not wait around and return anything
of any meaning, see

http://blogs.msdn.com/oldnewthing/archive/2005/01/19/356048.aspx

So checking the return value and doing something like

WINE_ERR("start failed, error %d\n", GetLastError());

does not even work, let alone because if it finds the EXE there is no
error as far as CreateProcess cares. On the other had, The child
process returns an exit code such as STATUS_ENTRYPOINT_NOT_FOUND but I
don't see how to get this information from the parent process, return
it to start.exe.so and have start do something like print an error or
display a message box. Can anyone lurking point me to an example of
how to get the child's return value and pass that back to the parent?

Thanks
-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From vostok at etersoft.ru  Fri Apr 25 11:00:23 2008
From: vostok at etersoft.ru (Anatoly Lyutin)
Date: Fri, 25 Apr 2008 20:00:23 +0400
Subject: [2/2] [try2] user32:mdi.c Fix creating MDI child window according
	with test. [resend]
In-Reply-To: <877ieo24s7.fsf@wine.dyndns.org>
References: <480DE437.3050709@etersoft.ru> <877ieo24s7.fsf@wine.dyndns.org>
Message-ID: <48120017.20206@etersoft.ru>

Alexandre Julliard wrote:
> It doesn't work:
>
> msg.c:3065: Test failed: Create visible MDI child window: the msg sequence is not complete: expected 0000 - actual 0046
> msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg 0x0047 was expected, but got msg 0x0046 instead
> msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg 0x0005 was expected, but got msg 0x0083 instead
> msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg 0x0046 was expected, but got msg 0x0047 instead
> msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg 0x0083 was expected, but got msg 0x0047 instead
> msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg 0x0047 was expected, but got msg 0x0005 instead
> msg.c:3120: Test failed: ShowWindow(SW_MAXIMIZE):invisible MDI child: the msg sequence is not complete: expected 0000 - actual 0046
> msg.c:3345: Test failed: ShowWindow(SW_MAXIMIZE):invisible maximized MDI child: the msg 0x0047 was expected, but got msg 0x0046 instead
> msg.c:3345: Test failed: ShowWindow(SW_MAXIMIZE):invisible maximized MDI child: the msg sequence is not complete: expected 0000 - actual 0083
> msg.c:3484: Test failed: Create MDI child window with invisible parent: the msg sequence is not complete: expected 0000 - actual 0046
>
>   
I muff this regression, thank you. I sent a new version of this patch.

-- 
Best regards
	Anatoly Lyutin.



From thestig at google.com  Fri Apr 25 11:11:42 2008
From: thestig at google.com (Lei Zhang)
Date: Fri, 25 Apr 2008 09:11:42 -0700
Subject: [PATCH] user32: edit controls should ignore WM_KEYDOWN on control
	+ enter.
In-Reply-To: <4811D77C.4000203@kievinfo.com>
References: <558b2f5c0804242222h2bfa942j7f3cecaaebc0ab81@mail.gmail.com>
	<558b2f5c0804242223j6918b02enccb1ba5c59924552@mail.gmail.com>
	<4811D77C.4000203@kievinfo.com>
Message-ID: <558b2f5c0804250911r4d677befma3f9a69de41bb3c0@mail.gmail.com>

On Fri, Apr 25, 2008 at 6:07 AM, Vitaliy Margolen
<wine-devel at kievinfo.com> wrote:
>
> Lei Zhang wrote:
>  > On Thu, Apr 24, 2008 at 10:22 PM, Lei Zhang <thestig at google.com> wrote:
>  >> Hi,
>  >>
>  >>  This should be the last bit in getting control + enter working in
>  >>  multiline edit controls. I attempted to write a test for this using
>  >>  SendInput() or SetKeyState() + SendMessage(), but I couldn't get seem
>  >>  to simulate holding down the control key.
>  >>
>  >
>  Should work. You can also look at keybd_event() how it does it. It's pretty
>  much a wrapper around SendInput().
>  All you'll need is keybd_event(VK_CONTROL, 0, 0, 0); to press it. And
>  keybd_event(VK_CONTROL, 0, KEYEVENTF_KEYUP, 0); to release it.
>

I tried that too. Also tried SetFocus(hedit) first. No luck.


From slash at ma.neweb.ne.jp  Fri Apr 25 12:13:45 2008
From: slash at ma.neweb.ne.jp (Kusanagi Kouichi)
Date: Sat, 26 Apr 2008 02:13:45 +0900
Subject: Kusanagi Kouichi : winex11: Destroy the handle to the
	composition string after it is cancelled.
In-Reply-To: <4811EC74.8010006@codeweavers.com>
References: <E1JpNhv-0008GY-P4@wine.codeweavers.com>
	<4811EC74.8010006@codeweavers.com>
Message-ID: <200804251713458971660006MAE3@nm06mta.auone-net.jp>

On Fri, Apr 25, 2008 at 09:36:36AM -0500, Aric Stewart wrote:
> Comming in a bit late on this one, (missed the patch submission)
> 
> I do not think this is correct as far as i know hCompStr should never be 
> NULL. Much of our code depends on that not being NULL.
> 
> I would recommend using ImeCreateBlankCompStr instead. (something like 
> below)
> 
> diff --git a/dlls/winex11.drv/ime.c b/dlls/winex11.drv/ime.c
> index f50549f..8fa6f6f 100644
> --- a/dlls/winex11.drv/ime.c
> +++ b/dlls/winex11.drv/ime.c
> @@ -778,7 +778,7 @@ BOOL WINAPI NotifyIME(HIMC hIMC, DWORD dwAction, 
> DWORD dwInd
>                       if (lpIMC->hCompStr)
>                       {
>                           ImmDestroyIMCC(lpIMC->hCompStr);
> -                        lpIMC->hCompStr = NULL;
> +                        lpIMC->hCompStr = ImeCreateBlankCompStr();
>                       }
> 
>                       myPrivate = 
> (LPIMEPRIVATE)ImmLockIMCC(lpIMC->hPrivate);
> 
> -aric

Then, are these also wrong? updateCompStr returns NULL if NULL or 0 is given.
   748	                        newCompStr = updateCompStr(lpIMC->hCompStr, NULL, 0);
   749	                        ImmDestroyIMCC(lpIMC->hCompStr);
   750	                        lpIMC->hCompStr = newCompStr;

   897	            newCompStr = updateCompStr(lpIMC->hCompStr, NULL, 0);
   898	            ImmDestroyIMCC(lpIMC->hCompStr);
   899	            lpIMC->hCompStr = newCompStr;


From stefan at codeweavers.com  Fri Apr 25 12:23:23 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Fri, 25 Apr 2008 19:23:23 +0200
Subject: ddraw: ComputeSphereVisibility
In-Reply-To: <5f9140a20804241920i1473bf12gd13fb5a8e5ae3183@mail.gmail.com>
References: <5f9140a20804241920i1473bf12gd13fb5a8e5ae3183@mail.gmail.com>
Message-ID: <200804251923.24140.stefan@codeweavers.com>

Am Freitag, 25. April 2008 04:20:11 schrieb David Adam:
> Hello,
>
> I am trying to debug the demo of The Sting. Now, the main is that the
> screen is almost black. It is surely related to the following FIXME:
> fixme:d3d7:IDirect3DDeviceImpl_7_ComputeSphereVisibility
>
> Unfortunately, I did not find any informations about this function. Does
> anyone know what this function does, ( and better knows a possible
> implementation)?
There's something in the DirectX SDK, and I added some implementation ideas to 
the comments in the ddraw code. I think it comes down to a bit of vector 
math, but I think you'll have to write some test cases to check if it really 
does what that the MSDN says


From tehblunderbuss at gmail.com  Fri Apr 25 12:25:44 2008
From: tehblunderbuss at gmail.com (TheBlunderbuss)
Date: Fri, 25 Apr 2008 12:25:44 -0500
Subject: Safedisc for 1.0+ ?
In-Reply-To: <20080425140047.GB7597@compsoc.nuigalway.ie>
References: <48114995.3010703@gmail.com> <481156B3.5060802@kievinfo.com>
	<20080425140047.GB7597@compsoc.nuigalway.ie>
Message-ID: <48121418.6000307@gmail.com>

Darragh Bailey wrote:
> There has been some movement in the past to split up the Safedisc bug
> and deal with the individual versions separately. Would it be useful to
> advance this? I'm certain that I have a number of games that listed as
> apps affected by this bug that no longer have a problem. So I'm not sure
> that it works well to maintain the same bug for all versions of
> safedisc.
I think that's a good idea


From stefan at codeweavers.com  Fri Apr 25 12:36:17 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Fri, 25 Apr 2008 19:36:17 +0200
Subject: ddraw: Fix tests that fail with the reference rasterizer
In-Reply-To: <22821af30804242038v3a581bbcsf7f5493633f07968@mail.gmail.com>
References: <22821af30804242038v3a581bbcsf7f5493633f07968@mail.gmail.com>
Message-ID: <200804251936.18031.stefan@codeweavers.com>

Am Freitag, 25. April 2008 05:38:40 schrieb James Hawkins:
> Hi,
>
> Changelog:
> * Fix tests that fail with the reference rasterizer.

>    if (SUCCEEDED(IDirectDrawSurface7_AddAttachedSurface(surface1, 
surface4)))
>        refrast = TRUE;
Do you take care of detaching the surface again?

Did you try checking the DirectDraw description or GUID? Maybe there's a 
better way to detet the refrast, if you want the teest to succeeed in a VM


From stefan at codeweavers.com  Fri Apr 25 12:37:45 2008
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Fri, 25 Apr 2008 19:37:45 +0200
Subject: d3d8: Fix a few test failures in win2k3
In-Reply-To: <22821af30804241836p571a1e99j98a30694a58be097@mail.gmail.com>
References: <22821af30804241836p571a1e99j98a30694a58be097@mail.gmail.com>
Message-ID: <200804251937.46045.stefan@codeweavers.com>

Am Freitag, 25. April 2008 03:36:04 schrieb James Hawkins:
> Hi,
>
> Changelog:
> * Fix a few test failures in win2k3.
>
>  dlls/d3d8/tests/device.c |    9 ++++++---
>  1 files changed, 6 insertions(+), 3 deletions(-)
Looks ok to me

Somewhen we may want to move all this multiple times copypasted device init 
code into a shared function :-/


From truiken at gmail.com  Fri Apr 25 12:51:31 2008
From: truiken at gmail.com (James Hawkins)
Date: Fri, 25 Apr 2008 12:51:31 -0500
Subject: ddraw: Fix tests that fail with the reference rasterizer
In-Reply-To: <200804251936.18031.stefan@codeweavers.com>
References: <22821af30804242038v3a581bbcsf7f5493633f07968@mail.gmail.com>
	<200804251936.18031.stefan@codeweavers.com>
Message-ID: <22821af30804251051k556c0e0end93bc6d3dee428aa@mail.gmail.com>

On Fri, Apr 25, 2008 at 12:36 PM, Stefan D?singer
<stefan at codeweavers.com> wrote:
> Am Freitag, 25. April 2008 05:38:40 schrieb James Hawkins:
>
> > Hi,
>  >
>  > Changelog:
>  > * Fix tests that fail with the reference rasterizer.
>
>  >    if (SUCCEEDED(IDirectDrawSurface7_AddAttachedSurface(surface1,
>  surface4)))
>  >        refrast = TRUE;
>  Do you take care of detaching the surface again?
>

I'll send in a patch to fix that.

>  Did you try checking the DirectDraw description or GUID? Maybe there's a
>  better way to detet the refrast, if you want the teest to succeeed in a VM
>

I'm sorry, I'm not that familiar with ddraw.

-- 
James Hawkins


From dank at kegel.com  Fri Apr 25 13:07:41 2008
From: dank at kegel.com (Dan Kegel)
Date: Fri, 25 Apr 2008 11:07:41 -0700
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <19e31a080804250850l360f0e13jc7cf7c28c2f1a961@mail.gmail.com>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	<87r6cv8uh3.fsf@wine.dyndns.org>
	<19e31a080804240755o51963e61xebe17b174382fb88@mail.gmail.com>
	<871w4v8exd.fsf@wine.dyndns.org>
	<19e31a080804250850l360f0e13jc7cf7c28c2f1a961@mail.gmail.com>
Message-ID: <a71bd89a0804251107j7cc4b33eya30f562af32ee0a@mail.gmail.com>

On Fri, Apr 25, 2008 at 8:50 AM, Steven Edwards <winehacker at gmail.com> wrote:
>  does not even work, let alone because if it finds the EXE there is no
>  error as far as CreateProcess cares. On the other had, The child
>  process returns an exit code such as STATUS_ENTRYPOINT_NOT_FOUND but I
>  don't see how to get this information from the parent process, return
>  it to start.exe.so and have start do something like print an error or
>  display a message box. Can anyone lurking point me to an example of
>  how to get the child's return value and pass that back to the parent?

A few ideas:

* have start.exe examine the import table of the exe and do an explicit check
(hard)

* have start.exe set an environment variable saying "show graphical error box
on dll load failure", and clear that before calling executed apps' WinMain()
(easy)


From aric at codeweavers.com  Fri Apr 25 14:44:00 2008
From: aric at codeweavers.com (Aric Stewart)
Date: Fri, 25 Apr 2008 14:44:00 -0500
Subject: Kusanagi Kouichi : winex11: Destroy the handle to the	composition
	string after it is cancelled.
In-Reply-To: <200804251713458971660006MAE3@nm06mta.auone-net.jp>
References: <E1JpNhv-0008GY-P4@wine.codeweavers.com>	<4811EC74.8010006@codeweavers.com>
	<200804251713458971660006MAE3@nm06mta.auone-net.jp>
Message-ID: <48123480.80700@codeweavers.com>

No, from updateCompStr

     if (old == NULL && compstr == NULL && len == 0)
         return NULL;

Otherwise it returns a compstr. So it only should return NULL if all the 
incoming parameters are NULL, which i do not believe should ever happen 
after i went through and made sure that the hCompStr was never NULL.

-aric

Kusanagi Kouichi wrote:
> On Fri, Apr 25, 2008 at 09:36:36AM -0500, Aric Stewart wrote:
>> Comming in a bit late on this one, (missed the patch submission)
>>
>> I do not think this is correct as far as i know hCompStr should never be 
>> NULL. Much of our code depends on that not being NULL.
>>
>> I would recommend using ImeCreateBlankCompStr instead. (something like 
>> below)
>>
>> diff --git a/dlls/winex11.drv/ime.c b/dlls/winex11.drv/ime.c
>> index f50549f..8fa6f6f 100644
>> --- a/dlls/winex11.drv/ime.c
>> +++ b/dlls/winex11.drv/ime.c
>> @@ -778,7 +778,7 @@ BOOL WINAPI NotifyIME(HIMC hIMC, DWORD dwAction, 
>> DWORD dwInd
>>                       if (lpIMC->hCompStr)
>>                       {
>>                           ImmDestroyIMCC(lpIMC->hCompStr);
>> -                        lpIMC->hCompStr = NULL;
>> +                        lpIMC->hCompStr = ImeCreateBlankCompStr();
>>                       }
>>
>>                       myPrivate = 
>> (LPIMEPRIVATE)ImmLockIMCC(lpIMC->hPrivate);
>>
>> -aric
> 
> Then, are these also wrong? updateCompStr returns NULL if NULL or 0 is given.
>    748	                        newCompStr = updateCompStr(lpIMC->hCompStr, NULL, 0);
>    749	                        ImmDestroyIMCC(lpIMC->hCompStr);
>    750	                        lpIMC->hCompStr = newCompStr;
> 
>    897	            newCompStr = updateCompStr(lpIMC->hCompStr, NULL, 0);
>    898	            ImmDestroyIMCC(lpIMC->hCompStr);
>    899	            lpIMC->hCompStr = newCompStr;
> 
> 


From adam at tpetaccia.com  Fri Apr 25 15:17:40 2008
From: adam at tpetaccia.com (Adam Petaccia)
Date: Fri, 25 Apr 2008 16:17:40 -0400
Subject: SOC 2008 Projects Announced
In-Reply-To: <b130c85e0804222114v3b8abc00v965c598d780e5a44@mail.gmail.com>
References: <b6bb06270804221436s5dfab6fctbe89047e55b4a8e9@mail.gmail.com>
	<b130c85e0804222114v3b8abc00v965c598d780e5a44@mail.gmail.com>
Message-ID: <1209154660.5743.7.camel@pimpmobile>

> Could the students come forward and say something about themself?

Hello Wine world, my name is Adam Petaccia, and this summer I will be
working on Wine's GDI+ implementation, so more applications can work
"out of the box". I am currently a student at the University of North
Carolina, Greensboro (US), and look forward to getting to coding, once
I'm done with those pesky exams.

Its exciting to see how far Wine has come (I remember running Starcraft
as root with nice -20 just so that the game could be somwhat playable --
thank [deity] we don't have to do that now) and I look forward to making
Wine even greater.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080425/08d5cfc7/attachment.pgp 

From dank at kegel.com  Fri Apr 25 16:24:37 2008
From: dank at kegel.com (Dan Kegel)
Date: Fri, 25 Apr 2008 14:24:37 -0700
Subject: Wine 1.0 release plan update
Message-ID: <a71bd89a0804251424u9f3942eq7e674bc2fcea0593@mail.gmail.com>

Alexandre's taking a vacation in May, and the schedule
is bending slightly to fit.  We're also not promising a
particular release date, though the previously predicted
date is still as likely as it was before.

http://wiki.winehq.org/WineReleasePlan
now says:

--- snip ---
    * 0.9.61 - 2 May 2008 - start of code freeze for 1.0
    * 1.0.0-rc1 - 9 May 2008 (early because of Alexandre's vacation)
    * No release 16 May (Alexandre on vacation)
    * 1.0.0-rc2 - 23 May (early because of Alexandre's vacation)

The exact date of the 1.0.0 release can't be predicted; we'll keep on
doing release candidates until we're comfortable with it. We expect it
will be in June.
--- snip ---


From slash at ma.neweb.ne.jp  Fri Apr 25 16:45:46 2008
From: slash at ma.neweb.ne.jp (Kusanagi Kouichi)
Date: Sat, 26 Apr 2008 06:45:46 +0900
Subject: Kusanagi Kouichi : winex11: Destroy the handle to the
	composition string after it is cancelled.
In-Reply-To: <48123480.80700@codeweavers.com>
References: <E1JpNhv-0008GY-P4@wine.codeweavers.com>
	<4811EC74.8010006@codeweavers.com>
	<200804251713458971660006MAE3@nm06mta.auone-net.jp>
	<48123480.80700@codeweavers.com>
Message-ID: <200804252145471336410006MA34@nm06mta.auone-net.jp>

On Fri, Apr 25, 2008 at 02:44:00PM -0500, Aric Stewart wrote:
> No, from updateCompStr
> 
>      if (old == NULL && compstr == NULL && len == 0)
>          return NULL;
> 
> Otherwise it returns a compstr. So it only should return NULL if all the 
> incoming parameters are NULL, which i do not believe should ever happen 
> after i went through and made sure that the hCompStr was never NULL.
> 
> -aric

Oh, I mistook && for ||. All right, I'll send a patch.


From austinenglish at gmail.com  Fri Apr 25 19:59:12 2008
From: austinenglish at gmail.com (Austin English)
Date: Fri, 25 Apr 2008 19:59:12 -0500
Subject: download.template: Update Mandriva download info (try 2)
Message-ID: <b6bb06270804251759y669f04aby57e5c12318b14b97@mail.gmail.com>

Any reason this patch wasn't applied?

http://www.winehq.org/pipermail/wine-patches/2008-April/053911.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080425/be14600c/attachment.htm 

From dmitry at codeweavers.com  Fri Apr 25 22:07:10 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sat, 26 Apr 2008 12:07:10 +0900
Subject: [PATCH] advapi32: attempt to use UuidToStringA if UuidToStringW
	isnot available.
References: <558b2f5c0804251409o5fe4d7f9m6cb2bc49421b94a5@mail.gmail.com>
Message-ID: <010201c8a74a$a18dc360$a600fea9@DMITRY>

"Lei Zhang" <thestig at google.com> wrote:

> This adds more checks in CRYPT_CreateMachineGuid(), and attempt to use
> UuidToStringA if UuidToStringW is not available.

Instead of duplicating and complicating the code, IMO it would be more
straightforward to use ansi APIs without trying unicode first.

-- 
Dmitry.


From truiken at gmail.com  Sat Apr 26 01:09:21 2008
From: truiken at gmail.com (James Hawkins)
Date: Sat, 26 Apr 2008 01:09:21 -0500
Subject: cabinet: Revert "cabinet: Fix for FDICopy with an empty cabinet
	file."
In-Reply-To: <3f4fd2640804252303g7d59b41ey2e541727edef0f36@mail.gmail.com>
References: <22821af30804252049s6e83d571m3895d3e4f26d2dd4@mail.gmail.com>
	<3f4fd2640804252303g7d59b41ey2e541727edef0f36@mail.gmail.com>
Message-ID: <22821af30804252309i28deb570u3fbf3b0e8daec8d6@mail.gmail.com>

On Sat, Apr 26, 2008 at 1:03 AM, Reece Dunn <msclrhd at googlemail.com> wrote:
> 2008/4/26 James Hawkins <jhawkins at codeweavers.com>:
>
> > Hi,
>  >
>  >  The test was incorrect and failed on all platforms.  Vitaly, please
>  >  ask someone to test your patches on a real windows system in the
>  >  future if you don't have access to one.
>
>  Wouldn't it be better to actually fix the test case than revert it all together?
>
>  Just simply change line 630:
>
>  -    ok(ret, "Expected FDICopy to succeed\n");
>  +    ok(!ret, "Expected FDICopy to fail\n");
>
>  and remove the todo_wine. Adding a GetLastError check would be good as well.
>

Have you actually read the patch or the changelog for that matter?

-- 
James Hawkins


From truiken at gmail.com  Sat Apr 26 01:15:41 2008
From: truiken at gmail.com (James Hawkins)
Date: Sat, 26 Apr 2008 01:15:41 -0500
Subject: ddraw: Remove a test that fails in VMs
In-Reply-To: <3f4fd2640804252311o54006a64geca1ad6d53d0e074@mail.gmail.com>
References: <22821af30804252127h995d19eg1907d741235a45ee@mail.gmail.com>
	<3f4fd2640804252311o54006a64geca1ad6d53d0e074@mail.gmail.com>
Message-ID: <22821af30804252315m5a51ebb6raed8bafea9eb8c47@mail.gmail.com>

On Sat, Apr 26, 2008 at 1:11 AM, Reece Dunn <msclrhd at googlemail.com> wrote:
> 2008/4/26 James Hawkins <jhawkins at codeweavers.com>:
>
> > Hi,
>  >
>  >  The tests aren't run anyway in this case.
>  >
>  >  Changelog:
>  >  * Remove a test that fails in VMs.
>  ...
>  >              hr = IDirect3D7_CreateDevice(Direct3D, &IID_IDirect3DRefDevice, Surface, &Direct3DDevice);
>  >          }
>  >      }
>  > -    ok(hr == D3D_OK, "IDirect3D7_CreateDevice failed with %08x\n", hr);
>
>  Wouldn't it be better to move the ok line to directly after the
>  IDirect3D7_CreateDevice call? That way, on VM machines the test will
>  not get run and on non-VM machines it will, as it is a valid test in
>  that case.
>

No, the test will still be run in all cases, VM or not, and will fail
in VMs.  The function just sets up the direct3d device object for
other tests; there's no point in an ok test in this function,
especially when it doesn't pass for all systems.

-- 
James Hawkins


From msclrhd at googlemail.com  Sat Apr 26 01:03:53 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Sat, 26 Apr 2008 07:03:53 +0100
Subject: cabinet: Revert "cabinet: Fix for FDICopy with an empty cabinet
	file."
In-Reply-To: <22821af30804252049s6e83d571m3895d3e4f26d2dd4@mail.gmail.com>
References: <22821af30804252049s6e83d571m3895d3e4f26d2dd4@mail.gmail.com>
Message-ID: <3f4fd2640804252303g7d59b41ey2e541727edef0f36@mail.gmail.com>

2008/4/26 James Hawkins <jhawkins at codeweavers.com>:
> Hi,
>
>  The test was incorrect and failed on all platforms.  Vitaly, please
>  ask someone to test your patches on a real windows system in the
>  future if you don't have access to one.

Wouldn't it be better to actually fix the test case than revert it all together?

Just simply change line 630:

-    ok(ret, "Expected FDICopy to succeed\n");
+    ok(!ret, "Expected FDICopy to fail\n");

and remove the todo_wine. Adding a GetLastError check would be good as well.

- Reece


From msclrhd at googlemail.com  Sat Apr 26 01:11:44 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Sat, 26 Apr 2008 07:11:44 +0100
Subject: ddraw: Remove a test that fails in VMs
In-Reply-To: <22821af30804252127h995d19eg1907d741235a45ee@mail.gmail.com>
References: <22821af30804252127h995d19eg1907d741235a45ee@mail.gmail.com>
Message-ID: <3f4fd2640804252311o54006a64geca1ad6d53d0e074@mail.gmail.com>

2008/4/26 James Hawkins <jhawkins at codeweavers.com>:
> Hi,
>
>  The tests aren't run anyway in this case.
>
>  Changelog:
>  * Remove a test that fails in VMs.
...
>              hr = IDirect3D7_CreateDevice(Direct3D, &IID_IDirect3DRefDevice, Surface, &Direct3DDevice);
>          }
>      }
> -    ok(hr == D3D_OK, "IDirect3D7_CreateDevice failed with %08x\n", hr);

Wouldn't it be better to move the ok line to directly after the
IDirect3D7_CreateDevice call? That way, on VM machines the test will
not get run and on non-VM machines it will, as it is a valid test in
that case.

- Reece


From msclrhd at googlemail.com  Sat Apr 26 01:17:50 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Sat, 26 Apr 2008 07:17:50 +0100
Subject: cabinet: Revert "cabinet: Fix for FDICopy with an empty cabinet
	file."
In-Reply-To: <22821af30804252309i28deb570u3fbf3b0e8daec8d6@mail.gmail.com>
References: <22821af30804252049s6e83d571m3895d3e4f26d2dd4@mail.gmail.com>
	<3f4fd2640804252303g7d59b41ey2e541727edef0f36@mail.gmail.com>
	<22821af30804252309i28deb570u3fbf3b0e8daec8d6@mail.gmail.com>
Message-ID: <3f4fd2640804252317w3343ed2bra834a5de287c6c3@mail.gmail.com>

2008/4/26 James Hawkins <truiken at gmail.com>:
>
> On Sat, Apr 26, 2008 at 1:03 AM, Reece Dunn <msclrhd at googlemail.com> wrote:
>  > 2008/4/26 James Hawkins <jhawkins at codeweavers.com>:
>  >
>  > > Hi,
>  >  >
>  >  >  The test was incorrect and failed on all platforms.  Vitaly, please
>  >  >  ask someone to test your patches on a real windows system in the
>  >  >  future if you don't have access to one.
>  >
>  >  Wouldn't it be better to actually fix the test case than revert it all together?
>  >
>
>  Have you actually read the patch or the changelog for that matter?

I misread the "Revert ..." part to mean a full revert of the original patch.

Sorry for the noise.
- Reece


From msclrhd at googlemail.com  Sat Apr 26 01:20:03 2008
From: msclrhd at googlemail.com (Reece Dunn)
Date: Sat, 26 Apr 2008 07:20:03 +0100
Subject: ddraw: Remove a test that fails in VMs
In-Reply-To: <22821af30804252315m5a51ebb6raed8bafea9eb8c47@mail.gmail.com>
References: <22821af30804252127h995d19eg1907d741235a45ee@mail.gmail.com>
	<3f4fd2640804252311o54006a64geca1ad6d53d0e074@mail.gmail.com>
	<22821af30804252315m5a51ebb6raed8bafea9eb8c47@mail.gmail.com>
Message-ID: <3f4fd2640804252320t5e8e42c6sba9d3a2b5672704a@mail.gmail.com>

2008/4/26 James Hawkins <truiken at gmail.com>:
>
> On Sat, Apr 26, 2008 at 1:11 AM, Reece Dunn <msclrhd at googlemail.com> wrote:
>  >  Wouldn't it be better to move the ok line to directly after the
>  >  IDirect3D7_CreateDevice call? That way, on VM machines the test will
>  >  not get run and on non-VM machines it will, as it is a valid test in
>  >  that case.
>
>  No, the test will still be run in all cases, VM or not, and will fail
>  in VMs.  The function just sets up the direct3d device object for
>  other tests; there's no point in an ok test in this function,
>  especially when it doesn't pass for all systems.

Ok.

- Reece


From mat at brain-dump.org  Sat Apr 26 04:45:45 2008
From: mat at brain-dump.org (Marc Andre Tanner)
Date: Sat, 26 Apr 2008 11:45:45 +0200
Subject: [GSoC][RFC] Case Insensitive Filesystem
In-Reply-To: <20080325213351.GA3237@debbook.brain-dump.org>
References: <20080325213351.GA3237@debbook.brain-dump.org>
Message-ID: <20080426094545.GA2036@debbook.brain-dump.org>

Hi,

Just wanted to let you know that i have finally found the time to set 
up a little page for ciopfs:

  http://www.brain-dump.org/projects/ciopfs/

There are certainly a few things which could be improved but it in my
tests it worked quite well in it's current form. As it seems that the 
idea of a fuse mounted .wine directory isn't that popular i will probably
leave the code as it is and move on to other things. Anyway it was fun
to do some work with fuse and in case someone is interested in it you 
now know where you can find it. 

Regards,
Marc

-- 
 Marc Andre Tanner >< http://www.brain-dump.org/ >< GPG key: CF7D56C0


From vitperov at etersoft.ru  Sat Apr 26 08:13:55 2008
From: vitperov at etersoft.ru (Vitaly Perov)
Date: Sat, 26 Apr 2008 17:13:55 +0400
Subject: [Try 3] [1/2] cabinet.dll -> FDICopy: Test added
In-Reply-To: <22821af30804050928s48a26486k311c3d6d6d5a4ce0@mail.gmail.com>
References: <200804051937.33251.vitperov@etersoft.ru>
	<22821af30804050928s48a26486k311c3d6d6d5a4ce0@mail.gmail.com>
Message-ID: <200804261713.55402.vitperov@etersoft.ru>

Hi,

> Hi,
>
>  The test was incorrect and failed on all platforms.  Vitaly, please
>  ask someone to test your patches on a real windows system in the
>  future if you don't have access to one.

I have never received this message. I found it by chance in the comment of 
Reece Dunn.

Does the problem still persist?


-- 
Best wishes,
Vitaly Perov
Russia, Saint-Petersburg. www.etersoft.ru


From wine-devel at kievinfo.com  Sat Apr 26 09:39:19 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sat, 26 Apr 2008 08:39:19 -0600
Subject: [dinput] move the common joystick_map_.* methods from
	joystick_linuxinput.c into device.c
In-Reply-To: <20080426001043.GF5348@byleth.sc-networks.de>
References: <20080426001043.GF5348@byleth.sc-networks.de>
Message-ID: <48133E97.6030003@kievinfo.com>

Christoph Frick wrote:
> diff --git a/dlls/dinput/device.c b/dlls/dinput/device.c
> index 5f927d0..baca0b3 100644
> --- a/dlls/dinput/device.c
> +++ b/dlls/dinput/device.c
> @@ -1400,3 +1400,54 @@ HRESULT WINAPI IDirectInputDevice8WImpl_GetImageInfo(LPDIRECTINPUTDEVICE8W iface
>      
Please don't. Device is common for everything (keyboard, mouse, joysticks). 
Joystick specific code should not be there.


Vitaliy.


From wine-devel at kievinfo.com  Sat Apr 26 09:57:28 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sat, 26 Apr 2008 08:57:28 -0600
Subject: [dinput] initial support for BSD's usbhid joysticks
In-Reply-To: <20080426005247.GH5348@byleth.sc-networks.de>
References: <20080426005247.GH5348@byleth.sc-networks.de>
Message-ID: <481342D8.4070206@kievinfo.com>

Christoph Frick wrote:
> From 7618ceb6941c0dffac9c48c1fa1aeb7e821673a2 Mon Sep 17 00:00:00 2001
> From: Christoph Frick <frick at sc-networks.com>
> Date: Sat, 26 Apr 2008 02:50:01 +0200
> Subject: [PATCH] Initial support for BSD's usbhid joysticks
> 
> Please consider this a tracer bullet. I had only time to test it with a
> 4-axis/4-button wheel in LFS in FreeBSD 7.0. I will take further tests using a
> flight stick and other games soon. But for now i just want to see, what others
> have to say about it.
> ---

Please use 4 spaces indentation, no tabs.

> +		snprintf(buf, MAX_PATH, FMT_UHIDDEVS, i);
> +		buf[MAX_PATH - 1] = 0;

snprintf always writes terminating '\0' character at the end of the string. 
You don't need to explicitly do that yourself.

> +		if ((fd = open(buf, O_RDWR | O_NDELAY, 0)) == -1) {
> +			TRACE("Unable to open %s read/write: %s\n", buf, strerror(errno));
> +			continue;
> +		}
Do you really have to open it read/write? Shouldn't read only be enough for 
not FF joystick?

The only way I can think of to remove code duplication is to create base 
joystick class. There were no reason for that with only 2 joystick drivers. 
With third one should really do it.

Vitaliy.


From juan.lang at gmail.com  Sat Apr 26 10:00:57 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Sat, 26 Apr 2008 08:00:57 -0700
Subject: [dinput] initial support for BSD's usbhid joysticks
In-Reply-To: <481342D8.4070206@kievinfo.com>
References: <20080426005247.GH5348@byleth.sc-networks.de>
	<481342D8.4070206@kievinfo.com>
Message-ID: <3a768c550804260800n54246b5ep23bfe7c86a38d30e@mail.gmail.com>

>  snprintf always writes terminating '\0' character at the end of the string.

Only if the buffer contains enough space for the terminating null.

>  You don't need to explicitly do that yourself.

That's probably true in this case.
--Juan


From wine-devel at kievinfo.com  Sat Apr 26 10:13:43 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sat, 26 Apr 2008 09:13:43 -0600
Subject: [dinput] initial support for BSD's usbhid joysticks
In-Reply-To: <3a768c550804260800n54246b5ep23bfe7c86a38d30e@mail.gmail.com>
References: <20080426005247.GH5348@byleth.sc-networks.de>	
	<481342D8.4070206@kievinfo.com>
	<3a768c550804260800n54246b5ep23bfe7c86a38d30e@mail.gmail.com>
Message-ID: <481346A7.9090707@kievinfo.com>

Juan Lang wrote:
>>  snprintf always writes terminating '\0' character at the end of the string.
> 
> Only if the buffer contains enough space for the terminating null.
> 
No (in case buffer at least 1 byte long). From man page:

The functions snprintf() and vsnprintf() write at most size bytes (including 
the trailing null byte ('\0')) to str.

This means that terminating zero is always written to the buffer (if it's at 
least 1 char long). I agree that above part of the man page is not exactly 
clear. But you can find a better explanation on the web, which spell out 
what is actually written.

This is not the infamous strncpy that does what you said.

Vitaliy.


From juan.lang at gmail.com  Sat Apr 26 10:14:40 2008
From: juan.lang at gmail.com (Juan Lang)
Date: Sat, 26 Apr 2008 08:14:40 -0700
Subject: [dinput] initial support for BSD's usbhid joysticks
In-Reply-To: <481346A7.9090707@kievinfo.com>
References: <20080426005247.GH5348@byleth.sc-networks.de>
	<481342D8.4070206@kievinfo.com>
	<3a768c550804260800n54246b5ep23bfe7c86a38d30e@mail.gmail.com>
	<481346A7.9090707@kievinfo.com>
Message-ID: <3a768c550804260814q33d511aoec06b3a3b92739d3@mail.gmail.com>

>  No (in case buffer at least 1 byte long).

Oh, right you are!  Thanks, I did confuse that the strncpy.
--Juan


From thestig at google.com  Sat Apr 26 12:37:47 2008
From: thestig at google.com (Lei Zhang)
Date: Sat, 26 Apr 2008 10:37:47 -0700
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
Message-ID: <558b2f5c0804261037k69bfa3ddp2262f927d6ca51ed@mail.gmail.com>

On Wed, Apr 23, 2008 at 5:59 AM, Alexandre Julliard <julliard at winehq.org> wrote:
> Module: wine
>  Branch: master
>  Commit: faaccca59be08be547ec4e1948b6306eff3808a2
>  URL:    http://source.winehq.org/git/wine.git/?a=commit;h=faaccca59be08be547ec4e1948b6306eff3808a2
>
>  Author: Dan Kegel <dank at kegel.com>
>  Date:   Tue Apr 22 17:56:36 2008 -0700
>
>  winecfg: Restrict dpi slider to sane values.
>
>  ---
>
>   programs/winecfg/x11drvdlg.c |    4 ++--
>   1 files changed, 2 insertions(+), 2 deletions(-)
>
>  diff --git a/programs/winecfg/x11drvdlg.c b/programs/winecfg/x11drvdlg.c
>  index bfa6ec5..c0ec058 100644
>  --- a/programs/winecfg/x11drvdlg.c
>  +++ b/programs/winecfg/x11drvdlg.c
>  @@ -35,9 +35,9 @@
>
>   WINE_DEFAULT_DEBUG_CHANNEL(winecfg);
>
>  -#define RES_MAXLEN 5 /* the maximum number of characters in a screen dimension. 5 digits should be plenty, what kind of crazy person runs their screen >10,000 pixels across? */
>  +#define RES_MAXLEN 5 /* max number of digits in a screen dimension. 5 digits should be plenty */
>   #define MINDPI 96
>  -#define MAXDPI 480
>  +#define MAXDPI 144     /* making this too high surprises and hurts users */
>   #define DEFDPI 96
>
>   #define IDT_DPIEDIT 0x1234
>
>
>
>

Dan, this basically reverted commit
0110512904d9c646abef416819a057c06d3f2c97, which bumped MAXDPI from 160
to 480 because some users specifically requested the ability for
higher DPI settings.

I think we need to decide what we want and stop the tug-o-war.


From thestig at google.com  Sat Apr 26 12:40:30 2008
From: thestig at google.com (Lei Zhang)
Date: Sat, 26 Apr 2008 10:40:30 -0700
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <558b2f5c0804261037k69bfa3ddp2262f927d6ca51ed@mail.gmail.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<558b2f5c0804261037k69bfa3ddp2262f927d6ca51ed@mail.gmail.com>
Message-ID: <558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>

On Sat, Apr 26, 2008 at 10:37 AM, Lei Zhang <thestig at google.com> wrote:
>
> On Wed, Apr 23, 2008 at 5:59 AM, Alexandre Julliard <julliard at winehq.org> wrote:
>  > Module: wine
>  >  Branch: master
>  >  Commit: faaccca59be08be547ec4e1948b6306eff3808a2
>  >  URL:    http://source.winehq.org/git/wine.git/?a=commit;h=faaccca59be08be547ec4e1948b6306eff3808a2
>  >
>  >  Author: Dan Kegel <dank at kegel.com>
>  >  Date:   Tue Apr 22 17:56:36 2008 -0700
>  >
>  >  winecfg: Restrict dpi slider to sane values.
>  >
>  >  ---
>  >
>  >   programs/winecfg/x11drvdlg.c |    4 ++--
>  >   1 files changed, 2 insertions(+), 2 deletions(-)
>  >
>  >  diff --git a/programs/winecfg/x11drvdlg.c b/programs/winecfg/x11drvdlg.c
>  >  index bfa6ec5..c0ec058 100644
>  >  --- a/programs/winecfg/x11drvdlg.c
>  >  +++ b/programs/winecfg/x11drvdlg.c
>  >  @@ -35,9 +35,9 @@
>  >
>  >   WINE_DEFAULT_DEBUG_CHANNEL(winecfg);
>  >
>  >  -#define RES_MAXLEN 5 /* the maximum number of characters in a screen dimension. 5 digits should be plenty, what kind of crazy person runs their screen >10,000 pixels across? */
>  >  +#define RES_MAXLEN 5 /* max number of digits in a screen dimension. 5 digits should be plenty */
>  >   #define MINDPI 96
>  >  -#define MAXDPI 480
>  >  +#define MAXDPI 144     /* making this too high surprises and hurts users */
>  >   #define DEFDPI 96
>  >
>  >   #define IDT_DPIEDIT 0x1234
>  >
>  >
>  >
>  >
>
>  Dan, this basically reverted commit
>  0110512904d9c646abef416819a057c06d3f2c97, which bumped MAXDPI from 160
>  to 480 because some users specifically requested the ability for
>  higher DPI settings.
>
>  I think we need to decide what we want and stop the tug-o-war.
>

Please see bug 9715.


From winehacker at gmail.com  Sat Apr 26 12:53:28 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Sat, 26 Apr 2008 13:53:28 -0400
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <a71bd89a0804251107j7cc4b33eya30f562af32ee0a@mail.gmail.com>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	<87r6cv8uh3.fsf@wine.dyndns.org>
	<19e31a080804240755o51963e61xebe17b174382fb88@mail.gmail.com>
	<871w4v8exd.fsf@wine.dyndns.org>
	<19e31a080804250850l360f0e13jc7cf7c28c2f1a961@mail.gmail.com>
	<a71bd89a0804251107j7cc4b33eya30f562af32ee0a@mail.gmail.com>
Message-ID: <19e31a080804261053p4ba91432ifa929c13663e4f@mail.gmail.com>

On Fri, Apr 25, 2008 at 2:07 PM, Dan Kegel <dank at kegel.com> wrote:
>  * have start.exe examine the import table of the exe and do an explicit check
>  (hard)

Seems like too much to go in to start anyway. And I am lazy

>  * have start.exe set an environment variable saying "show graphical error box
>  on dll load failure", and clear that before calling executed apps' WinMain()
>  (easy)

So something like start.exe.so in Unix mode would set a variable like
VERSBOSE_USERDEBUG or which then we could query in the loader using
RtlQueryEnvironmentVariable_U or something that would trigger the
MessageBox from the example code I already wrote in ntdll?

Thanks
Steven

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From dsh at linux.ucla.edu  Sat Apr 26 13:00:56 2008
From: dsh at linux.ucla.edu (Dan Hipschman)
Date: Sat, 26 Apr 2008 11:00:56 -0700
Subject: [PATCH 6/7] widl: Accept integer constant suffixes in the lexer.
In-Reply-To: <4812ED2E.7040602@codeweavers.com>
References: <4812ED2E.7040602@codeweavers.com>
Message-ID: <20080426180055.GR11580@linux.ucla.edu>

On Sat, Apr 26, 2008 at 09:51:58AM +0100, Robert Shearman wrote:
> +u_suffix	(l|L)
> +l_suffix	(u|U)

I'm guessing you meant for these to be the other way around.


From austinenglish at gmail.com  Sat Apr 26 13:27:21 2008
From: austinenglish at gmail.com (Austin English)
Date: Sat, 26 Apr 2008 13:27:21 -0500
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<558b2f5c0804261037k69bfa3ddp2262f927d6ca51ed@mail.gmail.com>
	<558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>
Message-ID: <b6bb06270804261127q7341530bq8b5de5274e4ece61@mail.gmail.com>

On 4/26/08, Lei Zhang <thestig at google.com> wrote:
>
> On Sat, Apr 26, 2008 at 10:37 AM, Lei Zhang <thestig at google.com> wrote:
> >
> > On Wed, Apr 23, 2008 at 5:59 AM, Alexandre Julliard <julliard at winehq.org>
> wrote:
> >  > Module: wine
> >  >  Branch: master
> >  >  Commit: faaccca59be08be547ec4e1948b6306eff3808a2
> >  >  URL:
> http://source.winehq.org/git/wine.git/?a=commit;h=faaccca59be08be547ec4e1948b6306eff3808a2
> >  >
> >  >  Author: Dan Kegel <dank at kegel.com>
> >  >  Date:   Tue Apr 22 17:56:36 2008 -0700
> >  >
> >  >  winecfg: Restrict dpi slider to sane values.
> >  >
> >  >  ---
> >  >
> >  >   programs/winecfg/x11drvdlg.c |    4 ++--
> >  >   1 files changed, 2 insertions(+), 2 deletions(-)
> >  >
> >  >  diff --git a/programs/winecfg/x11drvdlg.c
> b/programs/winecfg/x11drvdlg.c
> >  >  index bfa6ec5..c0ec058 100644
> >  >  --- a/programs/winecfg/x11drvdlg.c
> >  >  +++ b/programs/winecfg/x11drvdlg.c
> >  >  @@ -35,9 +35,9 @@
> >  >
> >  >   WINE_DEFAULT_DEBUG_CHANNEL(winecfg);
> >  >
> >  >  -#define RES_MAXLEN 5 /* the maximum number of characters in a
> screen dimension. 5 digits should be plenty, what kind of crazy person runs
> their screen >10,000 pixels across? */
> >  >  +#define RES_MAXLEN 5 /* max number of digits in a screen dimension.
> 5 digits should be plenty */
> >  >   #define MINDPI 96
> >  >  -#define MAXDPI 480
> >  >  +#define MAXDPI 144     /* making this too high surprises and hurts
> users */
> >  >   #define DEFDPI 96
> >  >
> >  >   #define IDT_DPIEDIT 0x1234
> >  >
> >  >
> >  >
> >  >
> >
> >  Dan, this basically reverted commit
> >  0110512904d9c646abef416819a057c06d3f2c97, which bumped MAXDPI from 160
> >  to 480 because some users specifically requested the ability for
> >  higher DPI settings.
> >
> >  I think we need to decide what we want and stop the tug-o-war.
> >
>
>
> Please see bug 9715.
>
>
> The change was specifically requested. A warning if someone sets it over
150, or a small explanation in winecfg would be better IMHO.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20080426/d0e2b60b/attachment.htm 

From wine-devel at kievinfo.com  Sat Apr 26 13:54:14 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sat, 26 Apr 2008 12:54:14 -0600
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <b6bb06270804261127q7341530bq8b5de5274e4ece61@mail.gmail.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>	<558b2f5c0804261037k69bfa3ddp2262f927d6ca51ed@mail.gmail.com>	<558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>
	<b6bb06270804261127q7341530bq8b5de5274e4ece61@mail.gmail.com>
Message-ID: <48137A56.9070505@kievinfo.com>

Austin English wrote:
> On 4/26/08, *Lei Zhang* <thestig at google.com <mailto:thestig at google.com>> 
> wrote:
> 
>     On Sat, Apr 26, 2008 at 10:37 AM, Lei Zhang <thestig at google.com
>     <mailto:thestig at google.com>> wrote:
>      >
>      > On Wed, Apr 23, 2008 at 5:59 AM, Alexandre Julliard
>     <julliard at winehq.org <mailto:julliard at winehq.org>> wrote:
>      >  > Module: wine
>      >  >  Branch: master
>      >  >  Commit: faaccca59be08be547ec4e1948b6306eff3808a2
>      >  >  URL:    http://source.winehq.org/git/wine.git/?a=commit;h=faaccca59be08be547ec4e1948b6306eff3808a2
>      >  >
>      >  >  Author: Dan Kegel <dank at kegel.com <mailto:dank at kegel.com>>
>      >  >  Date:   Tue Apr 22 17:56:36 2008 -0700
>      >  >
>      >  >  winecfg: Restrict dpi slider to sane values.
>      >  >
>      >  >  ---
>      >  >
>      >  >   programs/winecfg/x11drvdlg.c |    4 ++--
>      >  >   1 files changed, 2 insertions(+), 2 deletions(-)
>      >  >
>      >  >  diff --git a/programs/winecfg/x11drvdlg.c
>     b/programs/winecfg/x11drvdlg.c
>      >  >  index bfa6ec5..c0ec058 100644
>      >  >  --- a/programs/winecfg/x11drvdlg.c
>      >  >  +++ b/programs/winecfg/x11drvdlg.c
>      >  >  @@ -35,9 +35,9 @@
>      >  >
>      >  >   WINE_DEFAULT_DEBUG_CHANNEL(winecfg);
>      >  >
>      >  >  -#define RES_MAXLEN 5 /* the maximum number of characters in
>     a screen dimension. 5 digits should be plenty, what kind of crazy
>     person runs their screen >10,000 pixels across? */
>      >  >  +#define RES_MAXLEN 5 /* max number of digits in a screen
>     dimension. 5 digits should be plenty */
>      >  >   #define MINDPI 96
>      >  >  -#define MAXDPI 480
>      >  >  +#define MAXDPI 144     /* making this too high surprises and
>     hurts users */
>      >  >   #define DEFDPI 96
>      >  >
>      >  >   #define IDT_DPIEDIT 0x1234
>      >  >
>      >  >
>      >  >
>      >  >
>      >
>      >  Dan, this basically reverted commit
>      >  0110512904d9c646abef416819a057c06d3f2c97, which bumped MAXDPI
>     from 160
>      >  to 480 because some users specifically requested the ability for
>      >  higher DPI settings.
>      >
>      >  I think we need to decide what we want and stop the tug-o-war.
>      >
> 
> 
>     Please see bug 9715.
> 
> 
> The change was specifically requested. A warning if someone sets it over 
> 150, or a small explanation in winecfg would be better IMHO.
> 
> 
> ------------------------------------------------------------------------
> 
> 
For anyone who wants more then 150 they can change that in the registry. 
Honestly I've yet to see a single device with such a high DPI!

And since by definition users will do everything to screw themselves up we 
have to make it hard enough so majority will just give up.

Vitaliy.


From austinenglish at gmail.com  Sat Apr 26 15:43:09 2008
From: austinenglish at gmail.com (Austin English)
Date: Sat, 26 Apr 2008 15:43:09 -0500
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <48137A56.9070505@kievinfo.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<558b2f5c0804261037k69bfa3ddp2262f927d6ca51ed@mail.gmail.com>
	<558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>
	<b6bb06270804261127q7341530bq8b5de5274e4ece61@mail.gmail.com>
	<48137A56.9070505@kievinfo.com>
Message-ID: <b6bb06270804261343t1a2d97e0maf17439ae1c6e85e@mail.gmail.com>

On Sat, Apr 26, 2008 at 1:54 PM, Vitaliy Margolen
<wine-devel at kievinfo.com> wrote:
> Austin English wrote:
>  > On 4/26/08, *Lei Zhang* <thestig at google.com <mailto:thestig at google.com>>
>
> > wrote:
>  >
>  >     On Sat, Apr 26, 2008 at 10:37 AM, Lei Zhang <thestig at google.com
>
> >     <mailto:thestig at google.com>> wrote:
>  >      >
>  >      > On Wed, Apr 23, 2008 at 5:59 AM, Alexandre Julliard
>
> >     <julliard at winehq.org <mailto:julliard at winehq.org>> wrote:
>  >      >  > Module: wine
>  >      >  >  Branch: master
>  >      >  >  Commit: faaccca59be08be547ec4e1948b6306eff3808a2
>  >      >  >  URL:    http://source.winehq.org/git/wine.git/?a=commit;h=faaccca59be08be547ec4e1948b6306eff3808a2
>  >      >  >
>  >      >  >  Author: Dan Kegel <dank at kegel.com <mailto:dank at kegel.com>>
>
>
> >      >  >  Date:   Tue Apr 22 17:56:36 2008 -0700
>  >      >  >
>  >      >  >  winecfg: Restrict dpi slider to sane values.
>  >      >  >
>  >      >  >  ---
>  >      >  >
>  >      >  >   programs/winecfg/x11drvdlg.c |    4 ++--
>  >      >  >   1 files changed, 2 insertions(+), 2 deletions(-)
>  >      >  >
>  >      >  >  diff --git a/programs/winecfg/x11drvdlg.c
>  >     b/programs/winecfg/x11drvdlg.c
>  >      >  >  index bfa6ec5..c0ec058 100644
>  >      >  >  --- a/programs/winecfg/x11drvdlg.c
>  >      >  >  +++ b/programs/winecfg/x11drvdlg.c
>  >      >  >  @@ -35,9 +35,9 @@
>  >      >  >
>  >      >  >   WINE_DEFAULT_DEBUG_CHANNEL(winecfg);
>  >      >  >
>  >      >  >  -#define RES_MAXLEN 5 /* the maximum number of characters in
>  >     a screen dimension. 5 digits should be plenty, what kind of crazy
>  >     person runs their screen >10,000 pixels across? */
>  >      >  >  +#define RES_MAXLEN 5 /* max number of digits in a screen
>  >     dimension. 5 digits should be plenty */
>  >      >  >   #define MINDPI 96
>  >      >  >  -#define MAXDPI 480
>  >      >  >  +#define MAXDPI 144     /* making this too high surprises and
>  >     hurts users */
>  >      >  >   #define DEFDPI 96
>  >      >  >
>  >      >  >   #define IDT_DPIEDIT 0x1234
>  >      >  >
>  >      >  >
>  >      >  >
>  >      >  >
>  >      >
>  >      >  Dan, this basically reverted commit
>  >      >  0110512904d9c646abef416819a057c06d3f2c97, which bumped MAXDPI
>  >     from 160
>  >      >  to 480 because some users specifically requested the ability for
>  >      >  higher DPI settings.
>  >      >
>  >      >  I think we need to decide what we want and stop the tug-o-war.
>  >      >
>  >
>  >
>  >     Please see bug 9715.
>  >
>  >
>  > The change was specifically requested. A warning if someone sets it over
>  > 150, or a small explanation in winecfg would be better IMHO.
>  >
>  >
>  > ------------------------------------------------------------------------
>  >
>  >
>  For anyone who wants more then 150 they can change that in the registry.
>  Honestly I've yet to see a single device with such a high DPI!
>
>  And since by definition users will do everything to screw themselves up we
>  have to make it hard enough so majority will just give up.
>
>  Vitaliy.
>
>
>

How about something like the following, along with restoring back to 480 max?

diff --git a/programs/winecfg/En.rc b/programs/winecfg/En.rc
index 65b6fd1..97550c0 100644
--- a/programs/winecfg/En.rc
+++ b/programs/winecfg/En.rc
@@ -87,7 +87,7 @@ BEGIN
     COMBOBOX
IDC_D3D_VSHADER_MODE,100,201,145,70,CBS_DROPDOWNLIST | WS_VSCROLL |
WS_TABSTOP

     CONTROL         "Allow &Pixel Shader (if supported by
hardware)",IDC_D3D_PSHADER_MODE,"Button",BS_AUTOCHECKBOX |
WS_TABSTOP,15,219,230,10
-    GROUPBOX        " Screen &Resolution ",IDC_STATIC,8,242,244,25
+    GROUPBOX        " Screen &Resolution - Don't change this if you
don't know what it is! ",IDC_STATIC,8,242,244,25
     CONTROL         "", IDC_RES_TRACKBAR,
"msctls_trackbar32",WS_TABSTOP,12,250,187,15
     EDITTEXT        IDC_RES_DPIEDIT,204,250,23,13,ES_NUMBER|WS_TABSTOP
     LTEXT           "dpi",IDC_STATIC,235,252,10,8


From bmschwar at fas.harvard.edu  Sat Apr 26 15:51:11 2008
From: bmschwar at fas.harvard.edu (Benjamin M. Schwartz)
Date: Sat, 26 Apr 2008 16:51:11 -0400
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <48137A56.9070505@kievinfo.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>	<558b2f5c0804261037k69bfa3ddp2262f927d6ca51ed@mail.gmail.com>	<558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>	<b6bb06270804261127q7341530bq8b5de5274e4ece61@mail.gmail.com>
	<48137A56.9070505@kievinfo.com>
Message-ID: <481395BF.4000500@fas.harvard.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Vitaliy Margolen wrote:
| For anyone who wants more then 150 they can change that in the registry.
| Honestly I've yet to see a single device with such a high DPI!

I have ported Wine to run on the OLPC XO, which has a 200 DPI screen.  I
am currently running Wine at 160 DPI, which makes the fonts somewhat small
but improves the ability of Windows apps to fit on the 7.5" screen.

Also, some Windows software runs badly at high DPI.  Some of Wine's own
utilities, such as wordpad.exe, seem to malfunction even at 160 dpi.

- --Ben

P.S.  If you have an XO, you may try out Wine for XO from
http://dev.laptop.org/~bemasc/DOSConsole-3.xo
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.7 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFIE5W/UJT6e6HFtqQRAs1tAKChfwNIHwozyCd6UGAYFXRla0QIxQCgkUqk
EvCic33qC8VRgzZjScvLSk4=
=dn3X
-----END PGP SIGNATURE-----


From frick at sc-networks.de  Sat Apr 26 17:00:38 2008
From: frick at sc-networks.de (Christoph Frick)
Date: Sun, 27 Apr 2008 00:00:38 +0200
Subject: [dinput] move the common joystick_map_.* methods from
	joystick_linuxinput.c into device.c
In-Reply-To: <48133E97.6030003@kievinfo.com>
References: <20080426001043.GF5348@byleth.sc-networks.de>
	<48133E97.6030003@kievinfo.com>
Message-ID: <20080426220038.GI5348@byleth.sc-networks.de>

On Sat, Apr 26, 2008 at 08:39:19AM -0600, Vitaliy Margolen wrote:

> Christoph Frick wrote:
> > diff --git a/dlls/dinput/device.c b/dlls/dinput/device.c
> > index 5f927d0..baca0b3 100644
> > --- a/dlls/dinput/device.c
> > +++ b/dlls/dinput/device.c
> > @@ -1400,3 +1400,54 @@ HRESULT WINAPI IDirectInputDevice8WImpl_GetImageInfo(LPDIRECTINPUTDEVICE8W iface
> >      
> Please don't. Device is common for everything (keyboard, mouse,
> joysticks).  Joystick specific code should not be there.

i dont like it in joysticks_linuxinput. it stands there right before the
bigbig ifdef and the only reason it is there, is because it was written
for that file in the first place. any suggestions where to move it? on
the other hand my other patch does not depend on the move - just on the
functions - so we just keep in the linux file until we get the common
joystick class.

-- 
cu
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 163 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080427/3514110d/attachment.pgp 

From frick at sc-networks.de  Sat Apr 26 17:24:29 2008
From: frick at sc-networks.de (Christoph Frick)
Date: Sun, 27 Apr 2008 00:24:29 +0200
Subject: [dinput] initial support for BSD's usbhid joysticks
In-Reply-To: <481342D8.4070206@kievinfo.com>
References: <20080426005247.GH5348@byleth.sc-networks.de>
	<481342D8.4070206@kievinfo.com>
Message-ID: <20080426222429.GJ5348@byleth.sc-networks.de>

On Sat, Apr 26, 2008 at 08:57:28AM -0600, Vitaliy Margolen wrote:

> Please use 4 spaces indentation, no tabs.

what happened to original author decides? ;)
i will run the uncopied parts through indent once i find the -unreadable
flag for it...

> > +		snprintf(buf, MAX_PATH, FMT_UHIDDEVS, i);
> > +		buf[MAX_PATH - 1] = 0;
> snprintf always writes terminating '\0' character at the end of the
> string.  You don't need to explicitly do that yourself.

ack

> > +		if ((fd = open(buf, O_RDWR | O_NDELAY, 0)) == -1) {
> > +			TRACE("Unable to open %s read/write: %s\n", buf, strerror(errno));
> > +			continue;
> > +		}
> Do you really have to open it read/write? Shouldn't read only be
> enough for not FF joystick?

i tested beforehand with usbhidctl - and it needed r/w for just getting
the state there. so i assumed it is needed. i will just try it out.

> The only way I can think of to remove code duplication is to create
> base joystick class. There were no reason for that with only 2
> joystick drivers.  With third one should really do it.

Four with an potential xinput implementation.

Some of the functions had subtle changes; but i guess they could be
unified. if there where no FF the interface would be quite small:

- find them
- (un)acquire
- poll

I can not think of stuff, that get/setProperty would really need a
special implementation for. A common JoyDev struct could hold all vital
data; we could keep a private area for the "driver" around.

But i guess I can go with the "release" before this changes. We can cope
with the dups later on.

so my next steps are:

- fix above mentioned problems
- test with a TM cougar (6 axes, 28 buttons)
- test more games (GPL, NR2003 - especially ones, that needed patches in
  the linux parts some time ago: IL2 and RBR)

i head for a "release" on monday - if there are no show stoppers ahead,
of course.

BTW: no complains about the autoconf additions?

-- 
cu
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 163 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080427/3189aed4/attachment.pgp 

From frick at sc-networks.de  Sat Apr 26 17:36:22 2008
From: frick at sc-networks.de (Christoph Frick)
Date: Sun, 27 Apr 2008 00:36:22 +0200
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <48137A56.9070505@kievinfo.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<558b2f5c0804261037k69bfa3ddp2262f927d6ca51ed@mail.gmail.com>
	<558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>
	<b6bb06270804261127q7341530bq8b5de5274e4ece61@mail.gmail.com>
	<48137A56.9070505@kievinfo.com>
Message-ID: <20080426223622.GK5348@byleth.sc-networks.de>

On Sat, Apr 26, 2008 at 12:54:14PM -0600, Vitaliy Margolen wrote:

> For anyone who wants more then 150 they can change that in the registry. 
> Honestly I've yet to see a single device with such a high DPI!

for the fun of it - i run wine at 144 it is one less than i need:

0:32 !1 ridcully at ofnir:~% grep DPI /var/log/Xorg.0.log
(--) NVIDIA(0): DPI set to (147, 145); computed from "UseEdidDpi" X
config

(15" notebook with 1920x1200)

-- 
cu
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 163 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080427/74011c00/attachment.pgp 

From dank at kegel.com  Sat Apr 26 18:22:37 2008
From: dank at kegel.com (Dan Kegel)
Date: Sat, 26 Apr 2008 16:22:37 -0700
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<558b2f5c0804261037k69bfa3ddp2262f927d6ca51ed@mail.gmail.com>
	<558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>
Message-ID: <a71bd89a0804261622t1eda6132l8d174e924e5c5ee4@mail.gmail.com>

On Sat, Apr 26, 2008 at 10:40 AM, Lei Zhang <thestig at google.com> wrote:
>  >  >  URL:    http://source.winehq.org/git/wine.git/?a=commit;h=faaccca59be08be547ec4e1948b6306eff3808a2
>  >  >
>  >  >  Author: Dan Kegel <dank at kegel.com>
>  >  >  Date:   Tue Apr 22 17:56:36 2008 -0700
>  >  >
>  >  >  winecfg: Restrict dpi slider to sane values.
>  >
>  >  Dan, this basically reverted commit
>  >  0110512904d9c646abef416819a057c06d3f2c97, which bumped MAXDPI from 160
>  >  to 480 because some users specifically requested the ability for
>  >  higher DPI settings.
>  >
>  >  I think we need to decide what we want and stop the tug-o-war.
>
>  Please see bug 9715.

480 was completely unusable; average Joes were setting it
at random and were unable to use winecfg to reset it to
something sane.

I found a few monitors out there at 200 dpi, so perhaps that would
be a reasonable upper limit, but we'd have to check to make sure that
the average person with a crap monitor could set that to 200dpi,
realize it was wrong, and set it back without having to edit
the registry by hand.
- Dan


From xixsimplicityxix at gmail.com  Sat Apr 26 18:58:53 2008
From: xixsimplicityxix at gmail.com (John Klehm)
Date: Sat, 26 Apr 2008 18:58:53 -0500
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <a71bd89a0804261622t1eda6132l8d174e924e5c5ee4@mail.gmail.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<558b2f5c0804261037k69bfa3ddp2262f927d6ca51ed@mail.gmail.com>
	<558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>
	<a71bd89a0804261622t1eda6132l8d174e924e5c5ee4@mail.gmail.com>
Message-ID: <78a7dad00804261658j30f097abt3cbc36995256788f@mail.gmail.com>

On Sat, Apr 26, 2008 at 6:22 PM, Dan Kegel <dank at kegel.com> wrote:
> On Sat, Apr 26, 2008 at 10:40 AM, Lei Zhang <thestig at google.com> wrote:
>  >  >  >  URL:    http://source.winehq.org/git/wine.git/?a=commit;h=faaccca59be08be547ec4e1948b6306eff3808a2
>  >  >  >
>  >  >  >  Author: Dan Kegel <dank at kegel.com>
>  >  >  >  Date:   Tue Apr 22 17:56:36 2008 -0700
>  >  >  >
>  >  >  >  winecfg: Restrict dpi slider to sane values.
>  >  >
>
> >  >  Dan, this basically reverted commit
>  >  >  0110512904d9c646abef416819a057c06d3f2c97, which bumped MAXDPI from 160
>  >  >  to 480 because some users specifically requested the ability for
>  >  >  higher DPI settings.
>  >  >
>  >  >  I think we need to decide what we want and stop the tug-o-war.
>  >
>  >  Please see bug 9715.
>
>  480 was completely unusable; average Joes were setting it
>  at random and were unable to use winecfg to reset it to
>  something sane.
>
>  I found a few monitors out there at 200 dpi, so perhaps that would
>  be a reasonable upper limit, but we'd have to check to make sure that
>  the average person with a crap monitor could set that to 200dpi,
>  realize it was wrong, and set it back without having to edit
>  the registry by hand.
>  - Dan
>
>
>

Why not wizardify it?  "Enter the physical size of your screen: x
in/cm y in/cm"  Then use appropriate dpi based on current resolution?
Does it not work like that?

--John


From wine-devel at kievinfo.com  Sat Apr 26 19:48:35 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sat, 26 Apr 2008 18:48:35 -0600
Subject: Side affects from running wineprefixcreate
Message-ID: <4813CD63.9020402@kievinfo.com>

So for one notable problems is some file types being reset by Wine. Looks 
like it comes from dlls/mshtml/mshtml.inf. At a minimum all the created 
registry entries should not overwrite already existing ones.


Vitaliy.


From chris.kcat at gmail.com  Sat Apr 26 19:55:04 2008
From: chris.kcat at gmail.com (Chris Robinson)
Date: Sat, 26 Apr 2008 17:55:04 -0700
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <78a7dad00804261658j30f097abt3cbc36995256788f@mail.gmail.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<a71bd89a0804261622t1eda6132l8d174e924e5c5ee4@mail.gmail.com>
	<78a7dad00804261658j30f097abt3cbc36995256788f@mail.gmail.com>
Message-ID: <200804261755.04596.chris.kcat@gmail.com>

On Saturday 26 April 2008 04:58:53 pm John Klehm wrote:
> On Sat, Apr 26, 2008 at 6:22 PM, Dan Kegel <dank at kegel.com> wrote:
> >  I found a few monitors out there at 200 dpi, so perhaps that would
> >  be a reasonable upper limit, but we'd have to check to make sure that
> >  the average person with a crap monitor could set that to 200dpi,
> >  realize it was wrong, and set it back without having to edit
> >  the registry by hand.
> >  - Dan
>
> Why not wizardify it?  "Enter the physical size of your screen: x
> in/cm y in/cm"  Then use appropriate dpi based on current resolution?
> Does it not work like that?

What about getting the value from X? Since Windows only expects one DPI for 
both vertical and horizontal, while X provides two, Wine could just take the 
mean and autoset that on startup.


From chris.kcat at gmail.com  Sat Apr 26 20:05:29 2008
From: chris.kcat at gmail.com (Chris Robinson)
Date: Sat, 26 Apr 2008 18:05:29 -0700
Subject: Side affects from running wineprefixcreate
In-Reply-To: <4813CD63.9020402@kievinfo.com>
References: <4813CD63.9020402@kievinfo.com>
Message-ID: <200804261805.29538.chris.kcat@gmail.com>

On Saturday 26 April 2008 05:48:35 pm Vitaliy Margolen wrote:
> At a minimum all the created
> registry entries should not overwrite already existing ones.

Doesn't that kind of defeat the purpose of having wineprefixcreate executed, 
which is to update the registry?

Not that I don't agree there could be a problem with just blindly overwriting. 
But blindly ignoring can be just as much of a problem.


From wine-devel at kievinfo.com  Sat Apr 26 20:14:06 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sat, 26 Apr 2008 19:14:06 -0600
Subject: Side affects from running wineprefixcreate
In-Reply-To: <200804261805.29538.chris.kcat@gmail.com>
References: <4813CD63.9020402@kievinfo.com>
	<200804261805.29538.chris.kcat@gmail.com>
Message-ID: <4813D35E.2010700@kievinfo.com>

Chris Robinson wrote:
> On Saturday 26 April 2008 05:48:35 pm Vitaliy Margolen wrote:
>> At a minimum all the created
>> registry entries should not overwrite already existing ones.
> 
> Doesn't that kind of defeat the purpose of having wineprefixcreate executed, 
> which is to update the registry?
> 
> Not that I don't agree there could be a problem with just blindly overwriting. 
> But blindly ignoring can be just as much of a problem.
> 

That's the problem of forcefully refreshing registry. If you don't do it - 
some old cruft will get in a way of new stiff. If you do - you removing 
perfectly good entries that user had there.

However things like file associations should not be overwritten. Especially 
that they don't work after that:

$ wine start image.jpg
wine: configuration in '/home/vitaliy/.wine' has been updated.
fixme:exec:SHELL_execute flags ignored: 0x00000500
Application could not be started, or no application associated with the 
specified file.
ShellExecuteEx failed: Success

Vitaliy.


From research at science.su  Sat Apr 26 21:54:41 2008
From: research at science.su (L. Rahyen)
Date: Sun, 27 Apr 2008 02:54:41 +0000
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <a71bd89a0804261622t1eda6132l8d174e924e5c5ee4@mail.gmail.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>
	<a71bd89a0804261622t1eda6132l8d174e924e5c5ee4@mail.gmail.com>
Message-ID: <200804270254.42050.research@science.su>

On Saturday April 26 2008 23:22:37 Dan Kegel wrote:
> On Sat, Apr 26, 2008 at 10:40 AM, Lei Zhang <thestig at google.com> wrote:
> >  >  >  URL:   
> >  >  > http://source.winehq.org/git/wine.git/?a=commit;h=faaccca59be08be54
> >  >  >7ec4e1948b6306eff3808a2
> >  >  >
> >  >  >  Author: Dan Kegel <dank at kegel.com>
> >  >  >  Date:   Tue Apr 22 17:56:36 2008 -0700
> >  >  >
> >  >  >  winecfg: Restrict dpi slider to sane values.
> >  >
> >  >  Dan, this basically reverted commit
> >  >  0110512904d9c646abef416819a057c06d3f2c97, which bumped MAXDPI from
> >  > 160 to 480 because some users specifically requested the ability for
> >  > higher DPI settings.
> >  >
> >  >  I think we need to decide what we want and stop the tug-o-war.
> >
> >  Please see bug 9715.
>
> 480 was completely unusable; average Joes were setting it
> at random and were unable to use winecfg to reset it to
> something sane.
>
> I found a few monitors out there at 200 dpi, so perhaps that would
> be a reasonable upper limit, but we'd have to check to make sure that
> the average person with a crap monitor could set that to 200dpi,
> realize it was wrong,
> - Dan

	200 DPI limit is acceptable for most users. However, what this patch done by 
setting maximum to this small value (144) doesn't seems to be acceptable. 
There is enough users who want higher values and BTW I'm one of them (I need 
150 and 160; I need two values because I have more than one monitor/computer).
	So if we want to set the maximum limit lower than on Windows we need to 
choose reasonable value for most of us. I propose that we agree on at least 
200 DPI limit in winecfg otherwise this puts too much inconvenience 
(especially for everyone who create new WINE prefix for new set of Windows 
programs, and this is what I do regularly).

> and set it back without having to edit the registry by hand.

	Just a note: in all WMs I have tried winecfg remains usable even on 480 DPI 
because you can move the window as usually with Alt+Mouse_move or 
Meta+Mouse_move, and you need to move the window only once to reset the 
setting to any other value.


From dank at kegel.com  Sat Apr 26 22:23:40 2008
From: dank at kegel.com (Dan Kegel)
Date: Sat, 26 Apr 2008 20:23:40 -0700
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <200804270254.42050.research@science.su>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>
	<a71bd89a0804261622t1eda6132l8d174e924e5c5ee4@mail.gmail.com>
	<200804270254.42050.research@science.su>
Message-ID: <a71bd89a0804262023t10db3f16xb336a1a5f8e6c80b@mail.gmail.com>

On Sat, Apr 26, 2008 at 7:54 PM, L. Rahyen <research at science.su> wrote:
>         200 DPI limit is acceptable for most users. However, what this patch done by
>  setting maximum to this small value (144) doesn't seems to be acceptable.

Users really are lost if they set a too-high value.
They don't know how to do alt+mouse_move.
Thus simply setting the limit higher again would
be a support nightmare; we got a preview of that
on wine-users recently, with user after user panicking.

But as I wrote in http://bugs.winehq.org/show_bug.cgi?id=9715
we can probably do something that will make everybody
happy: arrange for winecfg to never let the user set
dpi so high that winecfg is bigger than the screen.
That's probably pretty easy to do.

And we can probably make high-res users happier still
by defaulting to Xft.dpi (used by Gnome and maybe KDE;
it's set by default to 96, but is increased by some users
of high-res displays).

Anyone willing to try implementing that?  I'd do it, but I'm kind of
limited by sore hands and time these days...
- Dan


From research at science.su  Sun Apr 27 00:13:14 2008
From: research at science.su (L. Rahyen)
Date: Sun, 27 Apr 2008 05:13:14 +0000
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <a71bd89a0804262023t10db3f16xb336a1a5f8e6c80b@mail.gmail.com>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<200804270254.42050.research@science.su>
	<a71bd89a0804262023t10db3f16xb336a1a5f8e6c80b@mail.gmail.com>
Message-ID: <200804270513.15279.research@science.su>

On Sunday April 27 2008 03:23:40 Dan Kegel wrote:
> But as I wrote in http://bugs.winehq.org/show_bug.cgi?id=9715
> we can probably do something that will make everybody
> happy: arrange for winecfg to never let the user set
> dpi so high that winecfg is bigger than the screen.

	Yes, I think this would be better solution. This will probably will work well 
for everyone and will be much better than hard-coded limit.


From winehacker at gmail.com  Sun Apr 27 01:37:34 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Sun, 27 Apr 2008 02:37:34 -0400
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <19e31a080804261053p4ba91432ifa929c13663e4f@mail.gmail.com>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232000i545ed41ds1daa72134115f35c@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	<87r6cv8uh3.fsf@wine.dyndns.org>
	<19e31a080804240755o51963e61xebe17b174382fb88@mail.gmail.com>
	<871w4v8exd.fsf@wine.dyndns.org>
	<19e31a080804250850l360f0e13jc7cf7c28c2f1a961@mail.gmail.com>
	<a71bd89a0804251107j7cc4b33eya30f562af32ee0a@mail.gmail.com>
	<19e31a080804261053p4ba91432ifa929c13663e4f@mail.gmail.com>
Message-ID: <19e31a080804262337u75d0112dlb54ed540e52b3db8@mail.gmail.com>

On Sat, Apr 26, 2008 at 1:53 PM, Steven Edwards <winehacker at gmail.com> wrote:
>  >  * have start.exe set an environment variable saying "show graphical error box
>  >  on dll load failure", and clear that before calling executed apps' WinMain()
>  >  (easy)
>
>  So something like start.exe.so in Unix mode would set a variable like
>  VERSBOSE_USERDEBUG or which then we could query in the loader using
>  RtlQueryEnvironmentVariable_U or something that would trigger the
>  MessageBox from the example code I already wrote in ntdll?

So that worked. Comments are welcome!

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-Took-a-better-stab-at-reporting-when-a-dll-is-missin.patch
Type: text/x-patch
Size: 4025 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20080427/22d069d3/attachment.bin 

From eric.pouech at orange.fr  Sun Apr 27 05:04:34 2008
From: eric.pouech at orange.fr (Eric Pouech)
Date: Sun, 27 Apr 2008 12:04:34 +0200
Subject: msvcrt: Remove two tests that fail on all platforms
In-Reply-To: <22821af30804231600w727fd37r27c60141eca27aaa@mail.gmail.com>
References: <22821af30804231600w727fd37r27c60141eca27aaa@mail.gmail.com>
Message-ID: <48144FB2.7000401@orange.fr>

James Hawkins a ?crit :
> Hi,
>
> Changelog
> * Remove two tests that fail on all platforms.
>
>  dlls/msvcrt/tests/cpp.c |    2 --
>  1 files changed, 0 insertions(+), 2 deletions(-)
>
>   
> ------------------------------------------------------------------------
>
>
the first one is actually bogus, I'll send a corrected test
however, the second seems ok (except some space difference)
can you post the failing test information ?
A+

-- 
Eric Pouech
"The problem with designing something completely foolproof is to underestimate the ingenuity of a complete idiot." (Douglas Adams)




From dmitry at codeweavers.com  Sun Apr 27 05:09:38 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sun, 27 Apr 2008 19:09:38 +0900
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com><558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com><a71bd89a0804261622t1eda6132l8d174e924e5c5ee4@mail.gmail.com><200804270254.42050.research@science.su>
	<a71bd89a0804262023t10db3f16xb336a1a5f8e6c80b@mail.gmail.com>
Message-ID: <00c001c8a84e$d1d6f460$a600fea9@DMITRY>

"Dan Kegel" <dank at kegel.com> wrote:

> On Sat, Apr 26, 2008 at 7:54 PM, L. Rahyen <research at science.su> wrote:
>>         200 DPI limit is acceptable for most users. However, what this patch done by
>>  setting maximum to this small value (144) doesn't seems to be acceptable.
> 
> Users really are lost if they set a too-high value.
> They don't know how to do alt+mouse_move.
> Thus simply setting the limit higher again would
> be a support nightmare; we got a preview of that
> on wine-users recently, with user after user panicking.
> 
> But as I wrote in http://bugs.winehq.org/show_bug.cgi?id=9715
> we can probably do something that will make everybody
> happy: arrange for winecfg to never let the user set
> dpi so high that winecfg is bigger than the screen.
> That's probably pretty easy to do.
> 
> And we can probably make high-res users happier still
> by defaulting to Xft.dpi (used by Gnome and maybe KDE;
> it's set by default to 96, but is increased by some users
> of high-res displays).
> 
> Anyone willing to try implementing that?  I'd do it, but I'm kind of
> limited by sore hands and time these days...

How about doing what Windows does - add a font preview to allow the user
to see an actual size of the font he/she will get after the change?

-- 
Dmitry.


From tijl at ulyssis.org  Sun Apr 27 07:31:00 2008
From: tijl at ulyssis.org (Tijl Coosemans)
Date: Sun, 27 Apr 2008 14:31:00 +0200
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <00c001c8a84e$d1d6f460$a600fea9@DMITRY>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<a71bd89a0804262023t10db3f16xb336a1a5f8e6c80b@mail.gmail.com>
	<00c001c8a84e$d1d6f460$a600fea9@DMITRY>
Message-ID: <200804271431.01718.tijl@ulyssis.org>

> "Dan Kegel" <dank at kegel.com> wrote:
>> On Sat, Apr 26, 2008 at 7:54 PM, L. Rahyen <research at science.su> wrote:
>>> 200 DPI limit is acceptable for most users. However, what this patch
>>> done by setting maximum to this small value (144) doesn't seems to
>>> be acceptable.
>> 
>> Users really are lost if they set a too-high value.
>> They don't know how to do alt+mouse_move.
>> Thus simply setting the limit higher again would
>> be a support nightmare; we got a preview of that
>> on wine-users recently, with user after user panicking.
>> 
>> But as I wrote in http://bugs.winehq.org/show_bug.cgi?id=9715
>> we can probably do something that will make everybody
>> happy: arrange for winecfg to never let the user set
>> dpi so high that winecfg is bigger than the screen.
>> That's probably pretty easy to do.
>> 
>> And we can probably make high-res users happier still
>> by defaulting to Xft.dpi (used by Gnome and maybe KDE;
>> it's set by default to 96, but is increased by some users
>> of high-res displays).

IMO the Mozilla page you linked to in the bug is the correct approach.
Users should set the DisplaySize setting in their X server
configuration (if it isn't detected automatically). And applications
should (by default) use the X server DPI calculated from that.
Applications overriding the X server DPI are bad when you start to
run them remotely.

If users want a graphical way of setting physical display size, then
that's a job for the desktop environments to provide some tools to
configure the local X server.

The only time Wine should have to worry about DPI is when running
apps that haven't been designed with high DPI in mind and therefore
don't scale well (for instance when font sizes are set in points and
other GUI elements are sized or positioned using pixels). But for those
apps it might be good enough to provide a simple checkbox that says
"override DPI to 96" or some other sensible default value. I don't know
if there actually are such apps.


From dmitry at codeweavers.com  Sun Apr 27 07:22:57 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sun, 27 Apr 2008 21:22:57 +0900
Subject: wine.inf.in: use lowercase for Microsoft Video 1
References: <f5d9424f0804270454r6bd2ee39w95ebf5ea7b36aaab@mail.gmail.com>
Message-ID: <007001c8a861$6f5a92c0$a600fea9@DMITRY>

"Jeff Zaroyko" <jeffzaroyko at gmail.com> wrote:

>  system.ini, drivers32,,"vidc.MRLE=msrle32.dll" 
> -system.ini, drivers32,,"vidc.MSVC=msvidc32.dll" 
> +system.ini, drivers32,,"vidc.msvc=msvidc32.dll" 
>  system.ini, drivers32,,"vidc.CVID=iccvid.dll" 
>  system.ini, drivers32,,"; vidc.IV50=ir50_32.dll" 
>  system.ini, drivers32,,"; vidc.IV31=ir32_32.dll"

MRLE and CVID are also in lower case in XP, so they should be fixed too
(as well as removed trailing spaces in many entries in [SystemIni] section).

-- 
Dmitry.


From jeffzaroyko at gmail.com  Sun Apr 27 07:52:13 2008
From: jeffzaroyko at gmail.com (Jeff Zaroyko)
Date: Sun, 27 Apr 2008 22:52:13 +1000
Subject: wine.inf.in: use lowercase for Microsoft Video 1
In-Reply-To: <007001c8a861$6f5a92c0$a600fea9@DMITRY>
References: <f5d9424f0804270454r6bd2ee39w95ebf5ea7b36aaab@mail.gmail.com>
	<007001c8a861$6f5a92c0$a600fea9@DMITRY>
Message-ID: <f5d9424f0804270552v581eb8b4w859cce38b9cc55c7@mail.gmail.com>

On Sun, Apr 27, 2008 at 10:22 PM, Dmitry Timoshkov
<dmitry at codeweavers.com> wrote:
> "Jeff Zaroyko" <jeffzaroyko at gmail.com> wrote:
>
>
> >  system.ini, drivers32,,"vidc.MRLE=msrle32.dll" -system.ini,
> drivers32,,"vidc.MSVC=msvidc32.dll" +system.ini,
> drivers32,,"vidc.msvc=msvidc32.dll"  system.ini,
> drivers32,,"vidc.CVID=iccvid.dll"  system.ini, drivers32,,";
> vidc.IV50=ir50_32.dll"  system.ini, drivers32,,"; vidc.IV31=ir32_32.dll"
> >
>
>  MRLE and CVID are also in lower case in XP, so they should be fixed too
>  (as well as removed trailing spaces in many entries in [SystemIni]
> section).
>
>  --
>  Dmitry.
>

If I should make these changes and resubmit, what about MSACM entries?
  I see that they are also lower case on XP.


From dank at kegel.com  Sun Apr 27 08:19:34 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 27 Apr 2008 06:19:34 -0700
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <19e31a080804262337u75d0112dlb54ed540e52b3db8@mail.gmail.com>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<a71bd89a0804232014o224ae9e2k4ac65a4eb0f778df@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	<87r6cv8uh3.fsf@wine.dyndns.org>
	<19e31a080804240755o51963e61xebe17b174382fb88@mail.gmail.com>
	<871w4v8exd.fsf@wine.dyndns.org>
	<19e31a080804250850l360f0e13jc7cf7c28c2f1a961@mail.gmail.com>
	<a71bd89a0804251107j7cc4b33eya30f562af32ee0a@mail.gmail.com>
	<19e31a080804261053p4ba91432ifa929c13663e4f@mail.gmail.com>
	<19e31a080804262337u75d0112dlb54ed540e52b3db8@mail.gmail.com>
Message-ID: <a71bd89a0804270619r703bb40djf7d5767f1fccadb3@mail.gmail.com>

On Sat, Apr 26, 2008 at 11:37 PM, Steven Edwards <winehacker at gmail.com> wrote:
>>  * have start.exe set an environment variable saying "show
graphical error box
>>  on dll load failure", and clear that before calling executed apps' WinMain()
>
>  So that worked. Comments are welcome!

1. I'd output the console message before the gui one.

2. You never clear that environment variable... what happens
when an app just tests for the existence of a DLL by
trying to load it?  We don't want to print an error then.
(That's why I originally suggested clearing the env var
after the app finished loading.  That's still broken -- it
won't catch errors in helper exes -- but it's better than nothing.)


From dmitry at codeweavers.com  Sun Apr 27 07:43:32 2008
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sun, 27 Apr 2008 21:43:32 +0900
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com><a71bd89a0804262023t10db3f16xb336a1a5f8e6c80b@mail.gmail.com><00c001c8a84e$d1d6f460$a600fea9@DMITRY>
	<200804271431.01718.tijl@ulyssis.org>
Message-ID: <008f01c8a864$4ecfdb20$a600fea9@DMITRY>

"Tijl Coosemans" <tijl at ulyssis.org> wrote:

> If users want a graphical way of setting physical display size, then
> that's a job for the desktop environments to provide some tools to
> configure the local X server.

Same applies to many other settings like fonts and colors. Wine uses
the DPI setting only as a way to scale fonts, not as a general size
scaler.

> The only time Wine should have to worry about DPI is when running
> apps that haven't been designed with high DPI in mind and therefore
> don't scale well (for instance when font sizes are set in points and
> other GUI elements are sized or positioned using pixels). But for those
> apps it might be good enough to provide a simple checkbox that says
> "override DPI to 96" or some other sensible default value. I don't know
> if there actually are such apps.

Such apps would break in Windows as well, Win32 uses logical units for its
GUI elements, not pixels.

Besides, even Windows does go that far as forbidding large DPI values, but
Windows makes it clear what a user will get using a font preview window.

-- 
Dmitry.


From dank at kegel.com  Sun Apr 27 08:35:06 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 27 Apr 2008 06:35:06 -0700
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <00c001c8a84e$d1d6f460$a600fea9@DMITRY>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<558b2f5c0804261040ka005018pcfb126d984a6f5e4@mail.gmail.com>
	<a71bd89a0804261622t1eda6132l8d174e924e5c5ee4@mail.gmail.com>
	<200804270254.42050.research@science.su>
	<a71bd89a0804262023t10db3f16xb336a1a5f8e6c80b@mail.gmail.com>
	<00c001c8a84e$d1d6f460$a600fea9@DMITRY>
Message-ID: <a71bd89a0804270635j6e28470cm27a5a18d1d0256de@mail.gmail.com>

Dmitry Timoshkov <dmitry at codeweavers.com> wrote:
>  How about doing what Windows does - add a font preview to allow the user
>  to see an actual size of the font he/she will get after the change?

Yeah, that would be great.  We did something like that
in the Picasa for Linux font settings tool.  Nigel said
it was a real pain, though.  I think it's much harder
than it looks, not something we can do for 1.0.

The cheezy hack I suggested should be easily doable
by Friday, though.  Hint, hint.


From tijl at ulyssis.org  Sun Apr 27 09:58:28 2008
From: tijl at ulyssis.org (Tijl Coosemans)
Date: Sun, 27 Apr 2008 16:58:28 +0200
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <008f01c8a864$4ecfdb20$a600fea9@DMITRY>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<200804271431.01718.tijl@ulyssis.org>
	<008f01c8a864$4ecfdb20$a600fea9@DMITRY>
Message-ID: <200804271658.30462.tijl@ulyssis.org>

On Sunday 27 April 2008 14:43:32 Dmitry Timoshkov wrote:
> "Tijl Coosemans" <tijl at ulyssis.org> wrote:
>> If users want a graphical way of setting physical display size, then
>> that's a job for the desktop environments to provide some tools to
>> configure the local X server.
> 
> Same applies to many other settings like fonts and colors. Wine uses
> the DPI setting only as a way to scale fonts, not as a general size
> scaler.

No, fonts and colors aren't server side settings. DPI is.

>> The only time Wine should have to worry about DPI is when running
>> apps that haven't been designed with high DPI in mind and therefore
>> don't scale well (for instance when font sizes are set in points and
>> other GUI elements are sized or positioned using pixels). But for
>> those apps it might be good enough to provide a simple checkbox that
>> says "override DPI to 96" or some other sensible default value. I
>> don't know if there actually are such apps.
> 
> Such apps would break in Windows as well, Win32 uses logical units
> for its GUI elements, not pixels.

Ah, that's good to know. Then why not get rid of that slider all
together? DPI settings are not a Wine issue and should not be solved
by Wine.


From dank at kegel.com  Sun Apr 27 10:52:10 2008
From: dank at kegel.com (Dan Kegel)
Date: Sun, 27 Apr 2008 08:52:10 -0700
Subject: Dan Kegel : winecfg: Restrict dpi slider to sane values.
In-Reply-To: <200804271658.30462.tijl@ulyssis.org>
References: <E1JoeZK-0004sh-4u@wine.codeweavers.com>
	<200804271431.01718.tijl@ulyssis.org>
	<008f01c8a864$4ecfdb20$a600fea9@DMITRY>
	<200804271658.30462.tijl@ulyssis.org>
Message-ID: <a71bd89a0804270852n50ad789cv95cb96f05cc9a431@mail.gmail.com>

On Sun, Apr 27, 2008 at 7:58 AM, Tijl Coosemans <tijl at ulyssis.org> wrote:
>  >> The only time Wine should have to worry about DPI is when running
>  >> apps that haven't been designed with high DPI in mind and therefore
>  >> don't scale well (for instance when font sizes are set in points and
>  >> other GUI elements are sized or positioned using pixels). But for
>  >> those apps it might be good enough to provide a simple checkbox that
>  >> says "override DPI to 96" or some other sensible default value. I
>  >> don't know if there actually are such apps.
>  >
>  > Such apps would break in Windows as well, Win32 uses logical units
>  > for its GUI elements, not pixels.
>
>  Ah, that's good to know. Then why not get rid of that slider all
>  together? DPI settings are not a Wine issue and should not be solved
>  by Wine.

Because DPI settings are kind of broken all over.
We need a way to override things for Wine for the moment until
e.g. X can autodetect monitor DPI reliably.

But we should see if paying attention to Xft.dpi (itself a similar
override that should go away) improves user experience.
- Dan


From wine-devel at kievinfo.com  Sun Apr 27 14:14:43 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sun, 27 Apr 2008 13:14:43 -0600
Subject: [dinput] initial support for BSD's usbhid joysticks
In-Reply-To: <20080427175824.GL5348@byleth.sc-networks.de>
References: <20080427175824.GL5348@byleth.sc-networks.de>
Message-ID: <4814D0A3.8030106@kievinfo.com>

Christoph Frick wrote:
> Add dinput support for BSD's usbhid joysticks
> 
> +	if (have_joy_devs == 0) {
> +	    joy_devs = HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, sizeof(struct JoyDev));
> +	} else {
> +	    HeapReAlloc(GetProcessHeap(), 0, joy_devs, (1 + have_joy_devs) * sizeof(struct JoyDev));
> +	}
> +	joy_devs[have_joy_devs++] = joydev;
> +
> +	hid_dispose_report_desc(rdesc);
> +	close(fd);
> +    }
> +}

This is ugly! Curly brackets should go on the separate line. And I asked no 
tabs please!

And again you copied all the code - I'm against this. All the duplicate code 
should go into the new joystick base class. No reason to rewrite code if it 
can be written right the first time around.


Vitaliy.


From wine-devel at kievinfo.com  Sun Apr 27 14:21:22 2008
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sun, 27 Apr 2008 13:21:22 -0600
Subject: wined3d: Fix dead-loop condition with default setup.
In-Reply-To: <4814ACA3.4050001@kievinfo.com>
References: <4814ACA3.4050001@kievinfo.com>
Message-ID: <4814D232.3090802@kievinfo.com>

Vitaliy Margolen wrote:
> As discussed in bug 11584 this Preload is wrong and should be removed.
> ---
>  dlls/wined3d/context.c |    7 -------
>  1 files changed, 0 insertions(+), 7 deletions(-)
> 
> 
BTW this is still not enough to fix all the problems. There are few more 
preloads that make Psychonauts crash. So I think that whole idea of using 
preload in the context switch is not right. Or activating context in texture 
pre-loading is wrong.

Can some one familiar with this code take a closer look? This is basic 
functionality that should be working in 1.0

Vitaliy.


From thunderbird2k at gmx.net  Sun Apr 27 15:16:38 2008
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Sun, 27 Apr 2008 22:16:38 +0200
Subject: wined3d: Fix dead-loop condition with default setup.
In-Reply-To: <4814D232.3090802@kievinfo.com>
References: <4814ACA3.4050001@kievinfo.com> <4814D232.3090802@kievinfo.com>
Message-ID: <20080427201638.62340@gmx.net>

> Vitaliy Margolen wrote:
> > As discussed in bug 11584 this Preload is wrong and should be removed.
> > ---
> >  dlls/wined3d/context.c |    7 -------
> >  1 files changed, 0 insertions(+), 7 deletions(-)
> > 
> > 
> BTW this is still not enough to fix all the problems. There are few more 
> preloads that make Psychonauts crash. So I think that whole idea of using 
> preload in the context switch is not right. Or activating context in
> texture 
> pre-loading is wrong.
> 
> Can some one familiar with this code take a closer look? This is basic 
> functionality that should be working in 1.0
> 
> Vitaliy.
> 

The whole surface / texture code is quite tricky because of various reasons. First of I have the feeling various parts are still NIH and old (and perhaps not doing what it was originally intended for0. Another big source of troubles is that a bunch of different GL extensions are used (FBO, PBO, texture rectangle ..) in order to achieve certain effects or to improve performance. This causes various games to behave differently on different cards and because drivers aren't bug free, you can have different bugs while the same GL extensions are offered. All in all a hell.

I haven't dealt with much of the code recently but I tried to move common functionality in small functions to make the code more readable and easier to maintain.

Just removing preloads and so isn't an option I think. I think the best thing would be to carefully review the code and to see what a function should be doing and make the code easier and better. Right now what is a fix for game 1 is a regression for game 2. I have seen this a couple of times right now where I fixed some large bugs but which exposed other issues.

The main issue right now is that the code freeze is near and this really isn't anything trivial and you can't write test cases for it. Perhaps native wined3d test apps could be employed but as I said there are dozens of different codepaths which can be entered due to differences in GL features.

Regards,
Roderick



-- 
Psst! Geheimtipp: Online Games kostenlos spielen bei den GMX Free Games! 
http://games.entertainment.gmx.net/de/entertainment/games/free


From anssi.hannula at gmail.com  Sun Apr 27 15:02:41 2008
From: anssi.hannula at gmail.com (Anssi Hannula)
Date: Sun, 27 Apr 2008 23:02:41 +0300
Subject: Wine64?
In-Reply-To: <20080422060446.42360@gmx.net>
References: <20080421171603.8ea1aa71.mle+win@mega-nerd.com>	<b130c85e0804211457w78c0c5a5n92538f1ac9cda630@mail.gmail.com>
	<20080422060446.42360@gmx.net>
Message-ID: <4814DBE1.3030807@gmail.com>

Roderick Colenbrander wrote:
> Maarten wrote:
>> A lot of the lowest level stuff is currently missing. If you don't
>> mind x64 assembly it's not impossible to do. We would need support
>> from gcc for the windows calling convention, and making it possible to
>> mix linux calling convention with windows calling convention. If you
>> are up to it just make it ignore the error for now, even if it causes
>> errors. A proof of concept "Hello, world!" would be a great
>> accomplishment at this point.
>>
> These days there is a 64bit version of mingw (mingw64 or so it is called).
> They must have patches to add the calling convention to gcc now. I'm not
> sure what the status is on merging the changes back but I think nothing
> forbids you from building gcc from their sources. I have no idea whether
> having the calling convention is enough for Wine.

The changes have been applied to gcc trunk, about a year ago IIRC.

Regarding mixing conventions, I had the following discussion with the
developer who implemented the convention in gcc (I didn't pursue the
matter further, though):

Kai Tietz wrote:
> Anssi Hannula <anssi.hannula at gmail.com> wrote on 26.05.2007 13:03:38:
> 
>> However, as the Wine project needs to support running win64 binaries on 
>> x86_64 Linux platforms, we need to able to specify MS ABI in 
>> per-function basis as we call linux functions as well.
>> 
>> I.e. we'd need something like __attribute__(__msvccall__) to specify the 
>> functions that need to have MS ABI calling convention, even when the gcc 
>> target is not x86_64 mingw.
>>
>> Do you think this is possible and/or if it would hard to implement?
> 
> This shouldn't be very hard to do. In i386.c, where the ABI specific 
> calling conventions are done, it can be introduced easily by using an 
> attribute modifier to choose between the different calling conventions 
> AFAICS.



-- 
Anssi Hannula


From stefandoesinger at gmx.at  Sun Apr 27 16:39:29 2008
From: stefandoesinger at gmx.at (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sun, 27 Apr 2008 23:39:29 +0200
Subject: wined3d: Fix dead-loop condition with default setup.
In-Reply-To: <4814D232.3090802@kievinfo.com>
References: <4814ACA3.4050001@kievinfo.com> <4814D232.3090802@kievinfo.com>
Message-ID: <200804272339.29984.stefandoesinger@gmx.at>

Am Sonntag, 27. April 2008 21:21:22 schrieb Vitaliy Margolen:
> Vitaliy Margolen wrote:
> > As discussed in bug 11584 this Preload is wrong and should be removed.
> > ---
> >  dlls/wined3d/context.c |    7 -------
> >  1 files changed, 0 insertions(+), 7 deletions(-)
This patch almost certainly correct, but I think it shouldn't be applied 
without further investigation. There was a reason I added this PreLoad 
call(prior to multithreading support, and this issue occurs with 
multithreading), and I am not sure if we can remove it yet. Unfortunately my 
time is a bit limited currently.

Essentially, we have to call PreLoad(or well: GL calls to read the GL drawable 
into the surface's GL texture) because the old rendertarget surface looses 
control over the drawable and a new surface may change the GL drawable's 
contents.

We have to call ActivateContext in PreLoad because the readback code needs a 
GL context to work. The GL state should be correctly set up in a single 
threaded environment, but in case of multithreading there might be no 
context.

Both those issues are comparably easy to solve on their own. Issues now occur 
when the render target and thread are switched at the same time. In this 
case, we have to activate a context with the *old* drawable in the *new* 
thread, read back, and then activate the new drawable in the new thread.

The PreLoad call you're removing here is obviously flawed. It results in a 
readback attempt needlessly on a thread switch while offscreen rendering. We 
don't have to read back on a thread change, only on a render target change. 
Since lastActiveThread is set after the FindContext call(this is OK), it will 
infinitly recurse. This PreLoad call also shouldn't be needed, but there may 
be other bugs which require this call(It's aim is to create the texture).

The other PreLoad call is OK. I think it should be protected with a check if 
the render target is changed to prevent readback on a pure thread change. In 
this case, the above target-and-thread change will automagically solve itself

1) ActivateContext is called for a new render target and thread
2) FindContext sees the RT change. It calls PreLoad
3) PreLoad calls activatecontext on the new thread and old target
4) The recursed activateContext detects a thread only change. No PreLoad 
called this time. The old target is activated for readback in the new thread
5) LoadLocation performs the GL readback
6) PreLoad returns
7) ActivateContext continues to activate the new RT in the new thread

An issue is that this will be a rather implicit solution which is hard to see 
and tricky to verify. We still recurse, but the recursion limits itself and 
solves the problem.

A few test case suggestions:
*) Render onscreen, switch thread, switch thread back
*) Create an offscreen target, PreLoad it, render to it
*) Same as above, without the PreLoad
*) Create an offscreen target, render to it, switch thread(render there again)
*) Create an offscreen target, PreLoad, switch thread while switching RT
*) Same as above, without the PreLoad

The "render to it" could be just a Clear() call. However, the texture's 
contents should be checked, so that testing would be part of the visual test. 
Another trouble is that multithreading causes major pain with fglrx(fix seems 
to be on the way) and Mesa. So adding this to our testsuite at this point 
might upset many people who run make test by hard crashing their systems.


From rob at codeweavers.com  Sun Apr 27 17:02:29 2008
From: rob at codeweavers.com (Robert Shearman)
Date: Sun, 27 Apr 2008 23:02:29 +0100
Subject: [PATCH 6/7] widl: Accept integer constant suffixes in the lexer.
In-Reply-To: <20080426180055.GR11580@linux.ucla.edu>
References: <4812ED2E.7040602@codeweavers.com>
	<20080426180055.GR11580@linux.ucla.edu>
Message-ID: <4814F7F5.2010206@codeweavers.com>

Dan Hipschman wrote:
> On Sat, Apr 26, 2008 at 09:51:58AM +0100, Robert Shearman wrote:
>   
>> +u_suffix	(l|L)
>> +l_suffix	(u|U)
>>     
>
> I'm guessing you meant for these to be the other way around.
>   

Good spot, thanks!

-- 
Rob Shearman



From truiken at gmail.com  Sun Apr 27 17:25:28 2008
From: truiken at gmail.com (James Hawkins)
Date: Sun, 27 Apr 2008 17:25:28 -0500
Subject: msvcrt: Remove two tests that fail on all platforms
In-Reply-To: <48144FB2.7000401@orange.fr>
References: <22821af30804231600w727fd37r27c60141eca27aaa@mail.gmail.com>
	<48144FB2.7000401@orange.fr>
Message-ID: <22821af30804271525i25c8de1cga8d9a8db8bfee3d4@mail.gmail.com>

On Sun, Apr 27, 2008 at 5:04 AM, Eric Pouech <eric.pouech at orange.fr> wrote:
> James Hawkins a ?crit :
>
>
> > Hi,
>  >
>  > Changelog
>  > * Remove two tests that fail on all platforms.
>  >
>  >  dlls/msvcrt/tests/cpp.c |    2 --
>  >  1 files changed, 0 insertions(+), 2 deletions(-)
>  >
>  >
>  > ------------------------------------------------------------------------
>  >
>  >
>  the first one is actually bogus, I'll send a corrected test
>  however, the second seems ok (except some space difference)
>  can you post the failing test information ?
>  A+
>

cpp.c:995: Test failed: Got name "?$AAA@$D?4@" for 108
cpp.c:997: Test failed: Expected "AAA<`template-parameter-5'>"
cpp.c:995: Test failed: Got name "private: static class bar *
__stdcall foo::bb::bar::ccccc<class aaa *>(class bar *,class ee
*,unsigned int,class aaa * *,class ee *)" for 110
cpp.c:997: Test failed: Expected "private: static class bar *
__stdcall foo::bb::bar::ccccc<class aaa *>(class bar *,class ee
*,unsigned int,class aaa **,class ee *)"
cpp: 377 tests executed (0 marked as todo, 4 failures), 0 skipped.

Do you need more than this?

http://test.winehq.org/data/200804252248/2003_hl-win2k3-vm/msvcrt:cpp.txt

-- 
James Hawkins


From astrand at cendio.se  Mon Apr 28 01:59:14 2008
From: astrand at cendio.se (=?UTF-8?Q?Peter_=C3=85strand?=)
Date: Mon, 28 Apr 2008 08:59:14 +0200 (CEST)
Subject: winmm/tests: waveOutGetDevCaps called with invalid size
In-Reply-To: <Pine.LNX.4.64.0804232120070.26015@maggie.lkpg.cendio.se>
References: <Pine.LNX.4.64.0804181102080.23847@maggie.lkpg.cendio.se>
	<4808B145.2010609@earthlink.net>
	<Pine.LNX.4.64.0804211050260.12791@maggie.lkpg.cendio.se>
	<480D12B1.3070309@earthlink.net>
	<Pine.LNX.4.64.0804220842440.29058@maggie.lkpg.cendio.se>
	<480DC438.7010107@earthlink.net>
	<Pine.LNX.4.64.0804230822450.15637@maggie.lkpg.cendio.se>
	<480F119D.5050107@earthlink.net>
	<Pine.LNX.4.64.0804232120070.26015@maggie.lkpg.cendio.se>
Message-ID: <Pine.LNX.4.64.0804280852530.9581@maggie.lkpg.cendio.se>

> > And what is the error?  If you know the error code returned, Ill add it 
> > to the code so we can end this discussion.
> 
> The error is MMSYSERR_INVALPARAM. 

I can see that this patch has now been committed:

--- wine/dlls/winmm/tests/wave.c:1.67   Fri Feb 29 06:18:36 2008
+++ wine/dlls/winmm/tests/wave.c        Fri Apr 25 08:12:48 2008
@@ -854,9 +854,9 @@
     }

     rc=waveOutGetDevCapsA(device,&capsA,4);
-    ok(rc==MMSYSERR_NOERROR,
-       "waveOutGetDevCapsA(%s): MMSYSERR_NOERROR expected, got %s\n",
-       dev_name(device),wave_out_error(rc));
+    ok(rc==MMSYSERR_NOERROR || rc==MMSYSERR_INVALPARAM,
+       "waveOutGetDevCapsA(%s): MMSYSERR_NOERROR or MMSYSERR_INVALPARAM "
+       "expected, got %s\n", dev_name(device),wave_out_error(rc));


However, the waveOutGetDevCapsW fails as well on WTS, also returning 
MMSYSERR_INVALPARAM. 

We could add MMSYSERR_INVALPARAM as a valid return code, but again, if we 
accept both success and a bunch of failures, the test makes very little 
sense. 

Here's a patch that completely removes the odd tests:

--- wave.c      25 Apr 2008 13:12:48 -0000      1.68
+++ wave.c      28 Apr 2008 06:57:07 -0000
@@ -853,16 +853,6 @@
        "expected, got %s\n",dev_name(device),wave_out_error(rc));
     }

-    rc=waveOutGetDevCapsA(device,&capsA,4);
-    ok(rc==MMSYSERR_NOERROR || rc==MMSYSERR_INVALPARAM,
-       "waveOutGetDevCapsA(%s): MMSYSERR_NOERROR or MMSYSERR_INVALPARAM "
-       "expected, got %s\n", dev_name(device),wave_out_error(rc));
-
-    rc=waveOutGetDevCapsW(device,&capsW,4);
-    ok(rc==MMSYSERR_NOERROR || rc==MMSYSERR_NOTSUPPORTED,
-       "waveOutGetDevCapsW(%s): MMSYSERR_NOERROR or MMSYSERR_NOTSUPPORTED 
"
-       "expected, got %s\n",dev_name(device),wave_out_error(rc));
-
     nameA=NULL;
     rc=waveOutMessage((HWAVEOUT)device, DRV_QUERYDEVICEINTERFACESIZE,
                       (DWORD_PTR)&size, 0);


Here's a patch that adds MMSYSERR_INVALPARAM as accepted return code:

--- wave.c      25 Apr 2008 13:12:48 -0000      1.68
+++ wave.c      28 Apr 2008 06:58:14 -0000
@@ -859,8 +859,8 @@
        "expected, got %s\n", dev_name(device),wave_out_error(rc));

     rc=waveOutGetDevCapsW(device,&capsW,4);
-    ok(rc==MMSYSERR_NOERROR || rc==MMSYSERR_NOTSUPPORTED,
-       "waveOutGetDevCapsW(%s): MMSYSERR_NOERROR or MMSYSERR_NOTSUPPORTED 
"
+    ok(rc==MMSYSERR_NOERROR || rc==MMSYSERR_NOTSUPPORTED || rc==MMSYSERR_INVALPARAM,
+       "waveOutGetDevCapsW(%s): MMSYSERR_NOERROR or MMSYSERR_NOTSUPPORTED or MMSYSERR_INVALPARAM "
        "expected, got %s\n",dev_name(device),wave_out_error(rc));

     nameA=NULL;

Rgds, 
---
Peter ?strand		ThinLinc Chief Developer
Cendio AB		http://www.cendio.se
Wallenbergs gata 4
583 30 Link?ping	Phone: +46-13-21 46 00

From winehacker at gmail.com  Mon Apr 28 02:51:43 2008
From: winehacker at gmail.com (Steven Edwards)
Date: Mon, 28 Apr 2008 03:51:43 -0400
Subject: 1.0 idea - ntdll - add a messagebox for missing dlls
In-Reply-To: <a71bd89a0804270619r703bb40djf7d5767f1fccadb3@mail.gmail.com>
References: <a71bd89a0804231951q34e81ae4p6f0b2332684fe07e@mail.gmail.com>
	<19e31a080804232133s7774ef35i9c4394f6b79e0ef2@mail.gmail.com>
	<87r6cv8uh3.fsf@wine.dyndns.org>
	<19e31a080804240755o51963e61xebe17b174382fb88@mail.gmail.com>
	<871w4v8exd.fsf@wine.dyndns.org>
	<19e31a080804250850l360f0e13jc7cf7c28c2f1a961@mail.gmail.com>
	<a71bd89a0804251107j7cc4b33eya30f562af32ee0a@mail.gmail.com>
	<19e31a080804261053p4ba91432ifa929c13663e4f@mail.gmail.com>
	<19e31a080804262337u75d0112dlb54ed540e52b3db8@mail.gmail.com>
	<a71bd89a0804270619r703bb40djf7d5767f1fccadb3@mail.gmail.com>
Message-ID: <19e31a080804280051q308775dek7e999fc1fa645f@mail.gmail.com>

On Sun, Apr 27, 2008 at 9:19 AM, Dan Kegel <dank at kegel.com> wrote:
>  2. You never clear that environment variable... what happens
>  when an app just tests for the existence of a DLL by
>  trying to load it?  We don't want to print an error then.
>  (That's why I originally suggested clearing the env var
>  after the app finished loading.  That's still broken -- it
>  won't catch errors in helper exes -- but it's better than nothing.)

I assume you mean if the application is just checking manually for the
dll via GetModuleHandle or LoadLibrary? I'll write a test case for
this to see if it causes a problem. My assumption was that the failure
case for that was at a higher level but I'll check with a test case. I
don't think we need to clear the variable....what I mean is I wonder
if there is a way to set the variable to be inherited by all child
processes launched by start.exe.so in unix mode. I'll look in to this
as well.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


