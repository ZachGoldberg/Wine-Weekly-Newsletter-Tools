From stefan at codeweavers.com  Mon Dec 17 05:18:41 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Mon, 17 Dec 2007 12:18:41 +0100
Subject: wined3d: Bind device framebuffer in ActivateContext
In-Reply-To: <d75158870712151019u2597d85fh19869de5ae11b339@mail.gmail.com>
References: <d75158870711241507s3c43ae9dvcb20e7b1ec822299@mail.gmail.com>
	<d75158870711252200r4684de95x1e7a109446707e5b@mail.gmail.com>
	<d75158870712151019u2597d85fh19869de5ae11b339@mail.gmail.com>
Message-ID: <200712171218.41676.stefan@codeweavers.com>

Am Samstag, 15. Dezember 2007 19:19:25 schrieb Allan Tong:

Sorry for the late reply, your mail got stuck in my messy inbox :-(

> The second patch moves FBO draw buffer selection to ActivateContext.
> For onscreen rendering, not much changes except binding framebuffer 0.
>  For offscreen rendering, the behavior depends on the specified
> context usage.  For BLIT and RESOURCE_LOAD, the target surface is
> attached to dst_fbo and used as the draw buffer.  For DRAWPRIM and
> CLEAR, I simply call apply_fbo_state.  This assumes that DRAWPRIM and
> CLEAR will always be used with device->render_targets[0].
There is a problem with GL_COLOR_ATTACHMENT1_EXT and higher, and the depth 
attachment. You're only applying the first color attachment, but that can 
lead to incomplete fbos, if for example the render target and depth stencil 
are changed. If you're only reapplying the first color attachment, you can 
get a size mismatch, which makes the driver pretty angry and can slow 
everything down.

You don't have to apply the fbo state in CTXUSAGE_RESOURCELOAD in theory. 
Resourceload never draws anything, nor does it read from the framebuffer, so 
it should be fine with any drawable / framebuffer.


From stefan at codeweavers.com  Mon Dec 17 05:25:07 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Mon, 17 Dec 2007 12:25:07 +0100
Subject: [3/5] wined3d: create IWineD3DDeviceImpl_ClearSurface routine
In-Reply-To: <4765F35E.5010309@inbox.lv>
References: <4765F35E.5010309@inbox.lv>
Message-ID: <200712171225.08020.stefan@codeweavers.com>

Am Montag, 17. Dezember 2007 04:56:14 schrieb Alexander Dorofeyev:
> ---
>    dlls/wined3d/device.c          |  162
> ++++++++++++++++++++++++++++++++++++++++ dlls/wined3d/wined3d_private.h |  
>  3 +
>    2 files changed, 165 insertions(+), 0 deletions(-)
This patch, and 4 and 5 look good to me content wise, but patch 3 doesn't make 
much sense without either 4 or 5. It's up to AJ to decide, but you could 
propably combine patches 3 and 4(and keep 5 separate).



From alexd4 at inbox.lv  Mon Dec 17 04:46:36 2007
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Mon, 17 Dec 2007 02:46:36 -0800
Subject: [3/5] wined3d: create IWineD3DDeviceImpl_ClearSurface routine
In-Reply-To: <200712171225.08020.stefan@codeweavers.com>
References: <4765F35E.5010309@inbox.lv>
	<200712171225.08020.stefan@codeweavers.com>
Message-ID: <4766538C.6060604@inbox.lv>

Hi.

There was a bit of a problem with combining 3 & 4, because diff mixes 
parts of two functions together and the patch is a total mess that would 
be difficult to review. 2 separate patches looked like an easiest way 
around that. If that's not ok I can try other workarounds, may be 
experiment with some diff options or combine 3 & 5.

Stefan D?singer wrote:
> Am Montag, 17. Dezember 2007 04:56:14 schrieb Alexander Dorofeyev:
>> ---
>>    dlls/wined3d/device.c          |  162
>> ++++++++++++++++++++++++++++++++++++++++ dlls/wined3d/wined3d_private.h |  
>>  3 +
>>    2 files changed, 165 insertions(+), 0 deletions(-)
> This patch, and 4 and 5 look good to me content wise, but patch 3 doesn't make 
> much sense without either 4 or 5. It's up to AJ to decide, but you could 
> propably combine patches 3 and 4(and keep 5 separate).



From julliard at winehq.org  Mon Dec 17 05:53:46 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 17 Dec 2007 12:53:46 +0100
Subject: WineX11.drv: create X11 window for client area 1/3
In-Reply-To: <20071216160829.295120@gmx.net> (Roderick Colenbrander's message
	of "Sun, 16 Dec 2007 17:08:29 +0100")
References: <20071216160829.295120@gmx.net>
Message-ID: <873au11qr9.fsf@wine.dyndns.org>

"Roderick Colenbrander" <thunderbird2k at gmx.net> writes:

> +    {
> +        escape.drawable = X11DRV_get_client_window( top );
> +        if(!escape.drawable)
> +            escape.drawable = X11DRV_get_whole_window( top );

You shouldn't need that test, all windows should have a client window;
otherwise you have to tell the server about it too.

> +static Window create_client_window( Display *display, struct x11drv_win_data *data)
> +{
> +    RECT rect = data->whole_rect;
> +    XSetWindowAttributes attr;
> +
> +    OffsetRect( &rect, -data->whole_rect.left, -data->whole_rect.top );
> +    data->client_rect = rect;
> +
> +    attr.event_mask = ExposureMask;
> +    attr.bit_gravity = ForgetGravity;

ForgetGravity is wasteful, you should use NorthWestGravity and compute
the proper valid rects in SetWindowPos. ForgetGravity may be appropriate
for the non-client area though.

> @@ -1582,6 +1646,7 @@ void X11DRV_SetParent( HWND hwnd, HWND parent, HWND old_parent )
>      {
>          /* FIXME: we ignore errors since we can't really recover anyway */
>          create_whole_window( display, data, GetWindowLongW( hwnd, GWL_STYLE ) );
> +        create_client_window( display, data );

You need to destroy the client window in SetParent too.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Mon Dec 17 05:56:50 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 17 Dec 2007 12:56:50 +0100
Subject: [PATCH 2/2] qmgr: Stub functions for queue manager interface.
In-Reply-To: <20071213182727.GA1278@knuth.cs.hmc.edu> (Roy Shea's message of
	"Thu, 13 Dec 2007 10:27:27 -0800")
References: <20071213182727.GA1278@knuth.cs.hmc.edu>
Message-ID: <87y7btzg8t.fsf@wine.dyndns.org>

Roy Shea <roy at cs.hmc.edu> writes:

> ---
>  dlls/qmgr/Makefile.in |    1 +
>  dlls/qmgr/qmgr.c      |  103 +++++++++++++++++++++++++++++++++++++++++++++++++
>  dlls/qmgr/qmgr.h      |   38 ++++++++++++++++++
>  3 files changed, 142 insertions(+), 0 deletions(-)

Sending small patches is good, but they still need to do something
useful. So for a stub interface you should at least implement AddRef and
Release, and a way to create an instance.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Mon Dec 17 05:58:41 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 17 Dec 2007 12:58:41 +0100
Subject: RESUBMIT [PATCH] enumerate processes in reverse
In-Reply-To: <877ijd1zmr.fsf@totally-fudged-out-message-id> (Marcus Meissner's
	message of "Thu, 18 Oct 2007 08:44:16 +0200")
References: <877ijd1zmr.fsf@totally-fudged-out-message-id>
Message-ID: <87tzmhzg5q.fsf@wine.dyndns.org>

Marcus Meissner <marcus at jet.franken.de> writes:

> A game does:
> 	Process32First();
> 	while (Process32First()) {
> 		/* look for stuff */
> 	}
> completely missing the first process. Unfortunately it
> is looking for its own child, which gets missed.
>
> -> reverse enumerate processes
>
> Also with testcase.
>
> (I mailed this 4 weeks ago already, any comments?)

Are you sure the order is supposed to be reversed between kernel32 and
ntdll?  That feels a bit strange.

-- 
Alexandre Julliard
julliard at winehq.org


From chris.kcat at gmail.com  Mon Dec 17 08:04:39 2007
From: chris.kcat at gmail.com (Chris Robinson)
Date: Mon, 17 Dec 2007 06:04:39 -0800
Subject: WineX11.drv: create X11 window for client area 1/3
In-Reply-To: <873au11qr9.fsf@wine.dyndns.org>
References: <20071216160829.295120@gmx.net> <873au11qr9.fsf@wine.dyndns.org>
Message-ID: <200712170604.39695.chris.kcat@gmail.com>

On Monday 17 December 2007 03:53:46 am Alexandre Julliard wrote:
> "Roderick Colenbrander" <thunderbird2k at gmx.net> writes:
> > +    {
> > +        escape.drawable = X11DRV_get_client_window( top );
> > +        if(!escape.drawable)
> > +            escape.drawable = X11DRV_get_whole_window( top );
>
> You shouldn't need that test, all windows should have a client window;
> otherwise you have to tell the server about it too.

The desktop/root_window doesn't have a client window. All attempts to give it 
one were met with limitted success.

> > @@ -1582,6 +1646,7 @@ void X11DRV_SetParent( HWND hwnd, HWND parent, HWND
> > old_parent ) {
> >          /* FIXME: we ignore errors since we can't really recover anyway
> > */ create_whole_window( display, data, GetWindowLongW( hwnd, GWL_STYLE )
> > ); +        create_client_window( display, data );
>
> You need to destroy the client window in SetParent too.

The client window, being a child of the whole window, should be destroyed 
automagically with the whole window. Though the client_window ID does at 
least need to be set to 0, I suppose.


From julliard at winehq.org  Mon Dec 17 09:26:42 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 17 Dec 2007 16:26:42 +0100
Subject: WineX11.drv: create X11 window for client area 1/3
In-Reply-To: <200712170604.39695.chris.kcat@gmail.com> (Chris Robinson's
	message of "Mon, 17 Dec 2007 06:04:39 -0800")
References: <20071216160829.295120@gmx.net> <873au11qr9.fsf@wine.dyndns.org>
	<200712170604.39695.chris.kcat@gmail.com>
Message-ID: <87prx5z6j1.fsf@wine.dyndns.org>

Chris Robinson <chris.kcat at gmail.com> writes:

> The desktop/root_window doesn't have a client window. All attempts to give it 
> one were met with limitted success.

You don't have to create a separate client window for the desktop, you
can use the same window id for both.

> The client window, being a child of the whole window, should be destroyed 
> automagically with the whole window. Though the client_window ID does at 
> least need to be set to 0, I suppose.

Yes, the X window is destroyed automatically, but the data structures
need to reflect that fact.

-- 
Alexandre Julliard
julliard at winehq.org


From kuba at mareimbrium.org  Mon Dec 17 10:01:19 2007
From: kuba at mareimbrium.org (Kuba Ober)
Date: Mon, 17 Dec 2007 11:01:19 -0500
Subject: Unimplemented function KERNEL32.dll.FindFirstVolumeW
In-Reply-To: <2095224754@web.de>
References: <2095224754@web.de>
Message-ID: <200712171101.19417.kuba@mareimbrium.org>

On Monday 19 November 2007, devzero at web.de wrote:
> > Yes, Wine shouldn't be able to do that. You're not running Wine
> > as root are you?
>
> whoops - i did. shame on me :)
>
> i retried with ordinary account and the crash didn`t happen there.
> anyway - should i expect such problems with root ?

If selinux is not in use, root can write to /proc/kcore for example.
Do not run anything as root unless you are doing system administration. It's
as easy as that.

Cheers, Kuba


From kuba at mareimbrium.org  Mon Dec 17 10:03:37 2007
From: kuba at mareimbrium.org (Kuba Ober)
Date: Mon, 17 Dec 2007 11:03:37 -0500
Subject: Unimplemented function KERNEL32.dll.FindFirstVolumeW
In-Reply-To: <2096050935@web.de>
References: <2096050935@web.de>
Message-ID: <200712171103.37870.kuba@mareimbrium.org>

On Tuesday 20 November 2007, devzero at web.de wrote:
> mhhh - since it cost me more then one hour to find out why my machine
> reboots and triggering a reboot by just _reading_ a file on my system,
> device node or not is at least very weird behaviour from a user`s
> perspective.

Root's perspective != user's perspective. Normal users don't have access
to /dev/watchdog (if they do, your system is misconfigured).

> it`s looks a little bit too simple for me. triggering a reboot just by some
> simple open() and read() and close() ? let`s wait what the maintainer has
> to tell.

If you do it as root - yes. /dev/watchdog won't be the only culprit.

Cheers, Kuba


From dank at kegel.com  Mon Dec 17 11:54:32 2007
From: dank at kegel.com (Dan Kegel)
Date: Mon, 17 Dec 2007 09:54:32 -0800
Subject: New valgrind regressions in riched20, rpcrt4
Message-ID: <a71bd89a0712170954h3d8cf43fyc4b61e6544f60a37@mail.gmail.com>

http://kegel.com/wine/valgrind/logs-2007-12-17-summary.txt
shows interesting things happened since Friday in riched20.
See
http://kegel.com/wine/valgrind/logs-2007-12-17/vg-riched20_editor-diff.txt
for a whole heap of new errors.  The only change since Friday
was Maarten's, http://www.winehq.org/pipermail/wine-cvs/2007-December/038829.html,
which seems somewhat unrelated, maybe he's getting slagged
unfairly here.  (But it would still be nice if he could have a look.)

There's also the somewhat questionable new warning
+ Source and destination overlap in memcpy(0x7F00F844, 0x7F00F844, 22)
in
http://kegel.com/wine/valgrind/logs-2007-12-17/vg-rpcrt4_ndr_marshall-diff.txt
which would be Rob's if it turns out to be a real problem.
- Dan


From truiken at gmail.com  Mon Dec 17 12:05:01 2007
From: truiken at gmail.com (James Hawkins)
Date: Mon, 17 Dec 2007 12:05:01 -0600
Subject: [Fwd: Re: New bugzilla components.]
In-Reply-To: <b6bb06270712162251x6e196153i9a3305c0a51720ec@mail.gmail.com>
References: <4765D687.6080506@sprintpcs.com>
	<22821af30712161800y4b94f876wa12fb49296ad16cd@mail.gmail.com>
	<b6bb06270712162251x6e196153i9a3305c0a51720ec@mail.gmail.com>
Message-ID: <22821af30712171005k19d6f515m6ea7c9b09006c484@mail.gmail.com>

On Dec 17, 2007 12:51 AM, Austin English <austinenglish at gmail.com> wrote:
> > > Dmitry Timoshkov wrote:
> > > >
> > > > Users are not supposed to set a category the bug belongs to, this requires
> > > > an investigation and knowledge of a developer. Personally I'd prefer to have
> > > > "default" in the list instead of "wine-misc".
> > > >
> > > >
> > > Better choice:  Unknown or intial report.  This will allow a user to
> > > file a bug without having to get technical.
> > > This also allows bug triage and for the appropriate developer or
> > > development team to be notified of a new
> > > bug.
> > >
> >
> > What?  I assume you're talking about adding a new landing page like a
> > simplified initial bug report.  That has nothing to do with the
> > current discussion, so please bring that up out of this thread if you
> > really want that.  Also, we already are notified of new bug reports
> > through wine-bugs.
>
> While wine-bugs can notify us of new bugs, there's not really anyway
> to search for 'untriaged' bugs. A keyword or a default component would
> allow for this. Since I spend most of my time attempting to
> verify/triage new bugs as well as trimming out old bugs, this would be
> a big help.
>

Bad idea.  This would promote inactivity on older bugs.  Just pay
attention to wine-bugs.

> On a side note, what is the general consensus on an 'unimplemented
> function' keyword?
>

I'm pretty sure the consensus is against.

-- 
James Hawkins


From maarten at codeweavers.com  Mon Dec 17 12:09:29 2007
From: maarten at codeweavers.com (Maarten Lankhorst)
Date: Mon, 17 Dec 2007 19:09:29 +0100
Subject: New valgrind regressions in riched20, rpcrt4
In-Reply-To: <a71bd89a0712170954h3d8cf43fyc4b61e6544f60a37@mail.gmail.com>
References: <a71bd89a0712170954h3d8cf43fyc4b61e6544f60a37@mail.gmail.com>
Message-ID: <4766BB59.505@codeweavers.com>

Hi Dan,

Dan Kegel schreef:
> http://kegel.com/wine/valgrind/logs-2007-12-17-summary.txt
> shows interesting things happened since Friday in riched20.
> See
> http://kegel.com/wine/valgrind/logs-2007-12-17/vg-riched20_editor-diff.txt
> for a whole heap of new errors.  The only change since Friday
> was Maarten's, http://www.winehq.org/pipermail/wine-cvs/2007-December/038829.html,
> which seems somewhat unrelated, maybe he's getting slagged
> unfairly here.  (But it would still be nice if he could have a look.)
>   
There are 2 changes I did on friday, the first one was making some
functions static, the second one was the selectionbar. I don't see how
the selectionbar could cause this, so could you check if
f0c4fdbad92c4e553a442078464c8abfe5a23522 already has those errors?

Cheers & Thanks,
Maarten.


From actong88 at gmail.com  Mon Dec 17 15:56:58 2007
From: actong88 at gmail.com (Allan Tong)
Date: Mon, 17 Dec 2007 16:56:58 -0500
Subject: wined3d: Bind device framebuffer in ActivateContext
In-Reply-To: <200712171218.41676.stefan@codeweavers.com>
References: <d75158870711241507s3c43ae9dvcb20e7b1ec822299@mail.gmail.com>
	<d75158870711252200r4684de95x1e7a109446707e5b@mail.gmail.com>
	<d75158870712151019u2597d85fh19869de5ae11b339@mail.gmail.com>
	<200712171218.41676.stefan@codeweavers.com>
Message-ID: <d75158870712171356sa8a8e1bw3dee27d67dcc65c@mail.gmail.com>

On Dec 17, 2007 6:18 AM, Stefan D?singer <stefan at codeweavers.com> wrote:
> Am Samstag, 15. Dezember 2007 19:19:25 schrieb Allan Tong:
>
> Sorry for the late reply, your mail got stuck in my messy inbox :-(

No problem.

> > The second patch moves FBO draw buffer selection to ActivateContext.
> > For onscreen rendering, not much changes except binding framebuffer 0.
> >  For offscreen rendering, the behavior depends on the specified
> > context usage.  For BLIT and RESOURCE_LOAD, the target surface is
> > attached to dst_fbo and used as the draw buffer.  For DRAWPRIM and
> > CLEAR, I simply call apply_fbo_state.  This assumes that DRAWPRIM and
> > CLEAR will always be used with device->render_targets[0].
> There is a problem with GL_COLOR_ATTACHMENT1_EXT and higher, and the depth
> attachment. You're only applying the first color attachment, but that can
> lead to incomplete fbos, if for example the render target and depth stencil
> are changed. If you're only reapplying the first color attachment, you can
> get a size mismatch, which makes the driver pretty angry and can slow
> everything down.

As far as I can tell, the only thing that's ever attached to
device->dst_fbo is the first color attachment, so I wouldn't think
there's any chance for a size mismatch.  Do I still need to unset the
depth attachment or the higher color attachments?  I'm assuming
there's no reason to have a depth attachment for a blit operation.

> You don't have to apply the fbo state in CTXUSAGE_RESOURCELOAD in theory.
> Resourceload never draws anything, nor does it read from the framebuffer, so
> it should be fine with any drawable / framebuffer.

I left it in since some places call ActivateContext using
CTXUSAGE_RESOURCELOAD but with something other than
device->lastActiveRenderTarget, e.g. SetRenderTarget.  I wasn't sure
if there is any code that's relying on the draw buffer being set by
these calls.

 - Allan

From truiken at gmail.com  Mon Dec 17 19:54:16 2007
From: truiken at gmail.com (James Hawkins)
Date: Mon, 17 Dec 2007 19:54:16 -0600
Subject: msi [2/2]: Sort each table of the join separately
In-Reply-To: <22821af30712171735r1b156275w78f057878b2ed592@mail.gmail.com>
References: <22821af30712171735r1b156275w78f057878b2ed592@mail.gmail.com>
Message-ID: <22821af30712171754u7a470e78n95907e6a194405de@mail.gmail.com>

On Dec 17, 2007 7:35 PM, James Hawkins <truiken at gmail.com> wrote:
> Hi,
>
> This is another fix for the National Instruments LabView mega-installer.
>
> Changelog:
> * Sort each table of the join separately.
>

Oops, ignore this patch (first one can go in).  I forgot to add the
freeing code for the order.  I'll have to resend it tomorrow.

-- 
James Hawkins


From mk144210 at bcm.edu  Mon Dec 17 20:23:01 2007
From: mk144210 at bcm.edu (Misha Koshelev)
Date: Mon, 17 Dec 2007 20:23:01 -0600
Subject: Vector NTI on Mac, WinHelp improvements
Message-ID: <1197944582.7703.9.camel@misha-laptop>

Hi guys,

It's been a bit since I wrote to the list (or contributed anything...
been somewhat busy I guess with lab/school/life). Anyhow I just wanted
to acknowledge the new WinHelp fixes (Kirill thanks in particular).
Although there is still no Contents or Search, which would make the
Vector NTI help more usable, the bug where it would complain about not
being able to open help when it was requested even though help would
open just fine has now been fixed. Thanks!

Also, I've been starting to play some with Wine on Mac and may in time
end up contributing some patches for this goal, provided I will have to
acquaint myself with some more Mac specific coding ideas first.
Specifically though, I'd like to point out that I think the Mac is a
hugely important platform for Wine I believe in terms of end-user
adoption, and although I understand the rationale for not having binary
packages available because Apple's X11 is buggy (which it clearly is), I
think it would still be nice to have the Mac at least be an important
focus.

And yes my thought initially was "well there's usually a Mac version of
the Windows program." But alas unfortunately this seems to not quite be
the case a lot of times. For example, even Vector NTI, which has both
"mac and windows" versions, actually has a Mac version that does not
work on MacOS 10.4 and higher (the company reports they are working on a
code rewrite for Mac versions, but meanwhile there are tons of people
out there on Google looking for ways around this/alternatives as Vector
NTI is very common in molecular biology and Macs are traditionally the
platform of choice in the field)... Wine would find a very nice niche
here with a bunch of people that otherwise prob would not end up using
it.

Another program we use a lot, Kodak Molecular Imaging, also actually has
problems with MacOS 10.4+ on Intel (not PowerPC) Macs, although this has
to do with the dongle drivers (USB dongle = Sentinel SuperPro), so
likely Wine would need a little more improvement to be of use here.

Anyway, just wanted to point out my observations about the Mac and that
although others might be thinking along the same lines I was... "well
most programs available for Windows are available for Mac", in two
examples I've discovered that upon careful examination this actually
turns out to be quite opposite of the actual case.

Thanks for you time
Misha


From hverbeet at gmail.com  Tue Dec 18 02:49:37 2007
From: hverbeet at gmail.com (H. Verbeet)
Date: Tue, 18 Dec 2007 09:49:37 +0100
Subject: wined3d: Bind device framebuffer in ActivateContext
In-Reply-To: <d75158870712171356sa8a8e1bw3dee27d67dcc65c@mail.gmail.com>
References: <d75158870711241507s3c43ae9dvcb20e7b1ec822299@mail.gmail.com>
	<d75158870711252200r4684de95x1e7a109446707e5b@mail.gmail.com>
	<d75158870712151019u2597d85fh19869de5ae11b339@mail.gmail.com>
	<200712171218.41676.stefan@codeweavers.com>
	<d75158870712171356sa8a8e1bw3dee27d67dcc65c@mail.gmail.com>
Message-ID: <d658b69e0712180049s6bec059vb6678fe4be048ab0@mail.gmail.com>

On 17/12/2007, Allan Tong <actong88 at gmail.com> wrote:
> > > The second patch moves FBO draw buffer selection to ActivateContext.
> > > For onscreen rendering, not much changes except binding framebuffer 0.
> > >  For offscreen rendering, the behavior depends on the specified
> > > context usage.  For BLIT and RESOURCE_LOAD, the target surface is
> > > attached to dst_fbo and used as the draw buffer.  For DRAWPRIM and
> > > CLEAR, I simply call apply_fbo_state.  This assumes that DRAWPRIM and
> > > CLEAR will always be used with device->render_targets[0].
> > There is a problem with GL_COLOR_ATTACHMENT1_EXT and higher, and the depth
> > attachment. You're only applying the first color attachment, but that can
> > lead to incomplete fbos, if for example the render target and depth stencil
> > are changed. If you're only reapplying the first color attachment, you can
> > get a size mismatch, which makes the driver pretty angry and can slow
> > everything down.
>
> As far as I can tell, the only thing that's ever attached to
> device->dst_fbo is the first color attachment, so I wouldn't think
> there's any chance for a size mismatch.  Do I still need to unset the
> depth attachment or the higher color attachments?  I'm assuming
> there's no reason to have a depth attachment for a blit operation.
>
Currently src_fbo and dst_fbo are only used for doing blits between
surfaces in stretch_rect_fbo() and a colorfill in color_fill_fbo(), so
there will only ever be something attached to
GL_COLOR_ATTACHMENT0_EXT.


From damian at wojslaw.pl  Tue Dec 18 03:15:40 2007
From: damian at wojslaw.pl (=?ISO-8859-2?Q?Damian_Wojs=B3aw?=)
Date: Tue, 18 Dec 2007 10:15:40 +0100
Subject: DTrace instrumentation
Message-ID: <47678FBC.9030707@wojslaw.pl>

Hi

I have an idea that I can put some time into. Since Leopard, FreeBSD 
and, of course, Solaris, now all have DTrace, I thought of implementing 
some simple probes. Function entry/return for starters. However, I'd 
firstly need to know two things:
- would anyone be interested in it?
- would it be legal (it wold link with dtrace library, which on Solaris 
is CDDL).

Regards


-- 
Damian Wojs?aw
OpenSolaris Core Contributor
SCA No. OS00073


From thunderbird2k at gmx.net  Tue Dec 18 04:15:45 2007
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Tue, 18 Dec 2007 11:15:45 +0100
Subject: WineX11.drv: Add an X11 window for the client area [attempt2]
In-Reply-To: <20071218095211.227660@gmx.net>
References: <20071218093857.133970@gmx.net> <20071218095211.227660@gmx.net>
Message-ID: <20071218101545.16540@gmx.net>

By accident I discovered that with this patch the wine desktop window doesn't work properly if there are multiple windows around (you notice redrawing issues). I haven't seen those before, so there is something wrong in this patch but I don't know where to look (I guess it is the client_window = whole_window code).

Roderick

> The previous patch accidently undid one of Stefan's changes and prevented
> it from compiling. This patch should be fine.
> 
> Roderick
> 
> 
> > Hi,
> > 
> > This is an updated version of the previous patch. It contains the
> > following changes:
> > - the client window is set to the whole window in case of the desktop
> > - NortWestGravity is used when creating the client window
> > - the client window is destroyed in SetParent together with the other
> X11
> > windows
> > 
> > The patch was tested using the user32 tests and various opengl / d3d
> test
> > apps. All worked correctly.
> > 
> > Regards,
> > Roderick Colenbrander
> > 
> > -- 
> > GMX FreeMail: 1 GB Postfach, 5 E-Mail-Adressen, 10 Free SMS.
> > Alle Infos und kostenlose Anmeldung: http://www.gmx.net/de/go/freemail
> 
> -- 
> GMX FreeMail: 1 GB Postfach, 5 E-Mail-Adressen, 10 Free SMS.
> Alle Infos und kostenlose Anmeldung: http://www.gmx.net/de/go/freemail

-- 
Ist Ihr Browser Vista-kompatibel? Jetzt die neuesten 
Browser-Versionen downloaden: http://www.gmx.net/de/go/browser


From stefan at codeweavers.com  Tue Dec 18 05:52:27 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Tue, 18 Dec 2007 12:52:27 +0100
Subject: [10/10] WineD3D: Implement blits from the active render target to
	swapchains
In-Reply-To: <200712172104.46841.stefan@codeweavers.com>
References: <200712172104.46841.stefan@codeweavers.com>
Message-ID: <200712181252.28049.stefan@codeweavers.com>

Am Montag, 17. Dezember 2007 21:04:46 schrieb Stefan D?singer:
Do not apply this patch yet, it has some problems


From thunder.m at email.cz  Tue Dec 18 06:08:33 2007
From: thunder.m at email.cz (=?windows-1252?Q?Mirek_Slugen=28?=)
Date: Tue, 18 Dec 2007 13:08:33 +0100
Subject: [10/10] WineD3D: Implement blits from the active render target
	to swapchains
In-Reply-To: <200712181252.28049.stefan@codeweavers.com>
References: <200712172104.46841.stefan@codeweavers.com>
	<200712181252.28049.stefan@codeweavers.com>
Message-ID: <4767B841.5010406@email.cz>

Hi, this patch caused some rendering issues to NFS PRO STREET too.

Mirek Slugen

Stefan D?singer napsal(a):
> Am Montag, 17. Dezember 2007 21:04:46 schrieb Stefan D?singer:
> Do not apply this patch yet, it has some problems
> 
> 
> 


From rob at codeweavers.com  Tue Dec 18 09:08:32 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Tue, 18 Dec 2007 15:08:32 +0000
Subject: gdi32: Add a GdiConvertToDevmodeW test, make it pass under Wine
In-Reply-To: <E1J4bS1-0005uR-Nw@mail.codeweavers.com>
References: <E1J4bS1-0005uR-Nw@mail.codeweavers.com>
Message-ID: <4767E270.8040707@codeweavers.com>

Dmitry Timoshkov wrote:
>      DEVMODEW *dmW;
>      WORD dmW_size;
>  
> -    dmW_size = dmA->dmSize + CCHDEVICENAME;
> -    if (dmA->dmSize >= (const char *)dmA->dmFormName - (const char *)dmA + CCHFORMNAME)
> +    dmW_size = dmA->dmSize;
> +    if (dmW_size > sizeof(DEVMODEA))
> +        dmW_size = sizeof(DEVMODEA);
>   

Shouldn't this be sizeof(DEVMODEW)?

> +
> +    dmW_size += CCHDEVICENAME;
>   

Shouldn't this be CCDEVICENAME * sizeof(WCHAR)?

> +    if (dmA->dmSize >= FIELD_OFFSET(DEVMODEA, dmFormName) + CCHFORMNAME)
>          dmW_size += CCHFORMNAME; 
>   

Shouldn't this be CCHFORMNAME * sizeof(WCHAR)?

-- 
Rob Shearman



From dmitry at codeweavers.com  Tue Dec 18 09:19:02 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Tue, 18 Dec 2007 23:19:02 +0800
Subject: gdi32: Add a GdiConvertToDevmodeW test, make it pass under Wine
References: <E1J4bS1-0005uR-Nw@mail.codeweavers.com>
	<4767E270.8040707@codeweavers.com>
Message-ID: <014d01c84189$53fcf1b0$a600fea9@DMITRY>

"Robert Shearman" <rob at codeweavers.com> wrote:

>> -    dmW_size = dmA->dmSize + CCHDEVICENAME;
>> -    if (dmA->dmSize >= (const char *)dmA->dmFormName - (const char *)dmA + CCHFORMNAME)
>> +    dmW_size = dmA->dmSize;
>> +    if (dmW_size > sizeof(DEVMODEA))
>> +        dmW_size = sizeof(DEVMODEA);
>>   
> 
> Shouldn't this be sizeof(DEVMODEW)?

No, because of below reasons.

>> +
>> +    dmW_size += CCHDEVICENAME;
>>   
> 
> Shouldn't this be CCDEVICENAME * sizeof(WCHAR)?
> 
>> +    if (dmA->dmSize >= FIELD_OFFSET(DEVMODEA, dmFormName) + CCHFORMNAME)
>>          dmW_size += CCHFORMNAME; 
>>   
> 
> Shouldn't this be CCHFORMNAME * sizeof(WCHAR)?

DEVMODEA already allocates space for 1-byte buffers, by adding the size of
each buffer I effectively multiply the size of buffers in A structure by 2.

-- 
Dmitry.


From p.beutner at gmx.net  Tue Dec 18 09:43:27 2007
From: p.beutner at gmx.net (Peter Beutner)
Date: Tue, 18 Dec 2007 16:43:27 +0100
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>
Message-ID: <4767EA9F.2030109@gmx.net>

Andrew Riedi schrieb:
> Sometimes Wine has optional features that users want to enable, but that
> require specific headers to compile.  For bug reports, and the user IRC
> channel, it seemed a good idea to add an option to Wine to figure out
> what optional features have been compiled into Wine.  Also, specific
> versions of GCC may cause problems for specific programs that involve
> copy protection software.  To help out users, testers, people who tend
> to our bugzilla, and other people involved with Wine, I decided to add
> an option to Wine to output this valuable information.
> 

+        /* Compiler */
+        printf( "\nCompiler:\n" );
+#ifdef __GNUC__
+        printf( "\tGCC %d.%d.%d\n", __GNUC__, __GNUC_MINOR__, __GNUC_PATCHLEVEL__ );
+# if (__GNUC__ == 4 && (__GNUC_MINOR__ == 0 || __GNUC_MINOR__ == 1))
+        printf( "\t**This GCC may cause problems with copy protection.**\n" );
+# endif
+#endif

As I recall this is not the only version that causes problems. Plus certain compiler 
flags have an influence as well. And as most distros ship gcc with a bunch
of patches you probably can't even rely on the gcc version alone.

Imo it would be better to collect the info on a wiki page.


From winehacker at gmail.com  Tue Dec 18 10:10:19 2007
From: winehacker at gmail.com (Steven Edwards)
Date: Tue, 18 Dec 2007 11:10:19 -0500
Subject: DTrace instrumentation
In-Reply-To: <47678FBC.9030707@wojslaw.pl>
References: <47678FBC.9030707@wojslaw.pl>
Message-ID: <19e31a080712180810p25de4246v6d1f0512e7cfb349@mail.gmail.com>

On Dec 18, 2007 4:15 AM, Damian Wojs?aw <damian at wojslaw.pl> wrote:
> - would it be legal (it wold link with dtrace library, which on Solaris
> is CDDL).

As long as you are not distributing code licensed under the CDDL and
your code is licensed under a LGPL compatible license then there is no
reason why you can't link to it.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo

From xixsimplicityxix at gmail.com  Tue Dec 18 11:49:10 2007
From: xixsimplicityxix at gmail.com (John Klehm)
Date: Tue, 18 Dec 2007 11:49:10 -0600
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <4767EA9F.2030109@gmx.net>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>
	<4767EA9F.2030109@gmx.net>
Message-ID: <78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com>

On Dec 18, 2007 9:43 AM, Peter Beutner <p.beutner at gmx.net> wrote:

> As I recall this is not the only version that causes problems. Plus certain compiler
> flags have an influence as well. And as most distros ship gcc with a bunch
> of patches you probably can't even rely on the gcc version alone.
>
> Imo it would be better to collect the info on a wiki page.
>

Like this one?  http://wiki.winehq.org/GccVersions

Nothing wrong with having the info output reflect the knowledge
gathered on the wiki page.

--John


From chris.kcat at gmail.com  Tue Dec 18 11:51:04 2007
From: chris.kcat at gmail.com (Chris Robinson)
Date: Tue, 18 Dec 2007 09:51:04 -0800
Subject: WineX11.drv: Add an X11 window for the client area [attempt2]
In-Reply-To: <20071218095211.227660@gmx.net>
References: <20071218093857.133970@gmx.net> <20071218095211.227660@gmx.net>
Message-ID: <200712180951.04869.chris.kcat@gmail.com>

On Tuesday 18 December 2007 01:52:11 am Roderick Colenbrander wrote:
> > This is an updated version of the previous patch. It contains the
> > following changes:
> > - the client window is set to the whole window in case of the desktop

I think you also need to set the desktop hwnd's client_window_prop too, so 
GetDC and friends will get the right window when not using the DCX_WINDOW 
flag.

> > - the client window is destroyed in SetParent together with the other X11
> > windows

In the case of data->whole_window == data->client_window, you should probably 
make sure the client_window (and it's prop) are both set back to 0, too.


From dank at kegel.com  Tue Dec 18 12:38:26 2007
From: dank at kegel.com (Dan Kegel)
Date: Tue, 18 Dec 2007 10:38:26 -0800
Subject: Today's git won't hunt. Server crash, lots of other problems?
Message-ID: <a71bd89a0712181038l5cfbd7bdk7c6e238093876db7@mail.gmail.com>

On Dec 18, 2007 10:29 AM, Susan Cragin <susancragin at earthlink.net> wrote:
> My git won't install DNS9P any more, as of today's git.
> Any suggestions?
>
> susan at ubuntu:~/DNS9$ wine setup
> fixme:advapi:LookupAccountNameW (null) L"susan" (nil) 0x34b944 (nil) 0x34b948 0x34b93c - stub
> fixme:advapi:LookupAccountNameW (null) L"susan" 0x1463f0 0x34b944 0x146998 0x34b948 0x34b93c - stub
> fixme:msi:ITERATE_DuplicateFiles We should track these duplicate files as well
> fixme:msi:msi_unimplemented_action_stub RemoveFolders -> 2 ignored L"CreateFolder" table values
> fixme:advapi:LookupAccountNameW (null) L"susan" (nil) 0x34f7fc (nil) 0x34f800 0x34f7f4 - stub
> fixme:advapi:LookupAccountNameW (null) L"susan" 0x1423a0 0x34f7fc 0x13ce80 0x34f800 0x34f7f4 - stub
> fixme:atl:AtlModuleInit SEMI-STUB (0x40eb40 0x40c040 0x400000)
> wineserver crashed, please enable coredumps (ulimit -c unlimited) and restart.

I just ran into that myself.    ALVIN!!!!!!!!!

But it doesn't seem easy to repeat; I keep getting other errors now.

Roy next to me says he ran into another regression, he's doing a bisect,
maybe it's the same thing.  He should be done shortly.
- Dan


From rob at codeweavers.com  Tue Dec 18 12:56:22 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Tue, 18 Dec 2007 18:56:22 +0000
Subject: Today's git won't hunt. Server crash, lots of other problems?
In-Reply-To: <a71bd89a0712181038l5cfbd7bdk7c6e238093876db7@mail.gmail.com>
References: <a71bd89a0712181038l5cfbd7bdk7c6e238093876db7@mail.gmail.com>
Message-ID: <476817D6.7040909@codeweavers.com>

Dan Kegel wrote:
> On Dec 18, 2007 10:29 AM, Susan Cragin <susancragin at earthlink.net> wrote:
>   
>> My git won't install DNS9P any more, as of today's git.
>> Any suggestions?
>>
>> susan at ubuntu:~/DNS9$ wine setup
>> fixme:advapi:LookupAccountNameW (null) L"susan" (nil) 0x34b944 (nil) 0x34b948 0x34b93c - stub
>> fixme:advapi:LookupAccountNameW (null) L"susan" 0x1463f0 0x34b944 0x146998 0x34b948 0x34b93c - stub
>> fixme:msi:ITERATE_DuplicateFiles We should track these duplicate files as well
>> fixme:msi:msi_unimplemented_action_stub RemoveFolders -> 2 ignored L"CreateFolder" table values
>> fixme:advapi:LookupAccountNameW (null) L"susan" (nil) 0x34f7fc (nil) 0x34f800 0x34f7f4 - stub
>> fixme:advapi:LookupAccountNameW (null) L"susan" 0x1423a0 0x34f7fc 0x13ce80 0x34f800 0x34f7f4 - stub
>> fixme:atl:AtlModuleInit SEMI-STUB (0x40eb40 0x40c040 0x400000)
>> wineserver crashed, please enable coredumps (ulimit -c unlimited) and restart.
>>     
>
> I just ran into that myself.    ALVIN!!!!!!!!!
>
> But it doesn't seem easy to repeat; I keep getting other errors now.
>
> Roy next to me says he ran into another regression, he's doing a bisect,
> maybe it's the same thing.  He should be done shortly.

I don't think DNS9 uses the console API, and the only other recent 
changes in the server are to do with I/O completion ports. If you can't 
reproduce it very easily, then it might be worth just trying to confirm 
that it does use I/O completion ports.

-- 
Rob Shearman



From julliard at winehq.org  Tue Dec 18 13:08:16 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Tue, 18 Dec 2007 20:08:16 +0100
Subject: Today's git won't hunt. Server crash, lots of other problems?
In-Reply-To: <476817D6.7040909@codeweavers.com> (Robert Shearman's message of
	"Tue, 18 Dec 2007 18:56:22 +0000")
References: <a71bd89a0712181038l5cfbd7bdk7c6e238093876db7@mail.gmail.com>
	<476817D6.7040909@codeweavers.com>
Message-ID: <878x3rzuqn.fsf@wine.dyndns.org>

Robert Shearman <rob at codeweavers.com> writes:

> I don't think DNS9 uses the console API, and the only other recent 
> changes in the server are to do with I/O completion ports. If you can't 
> reproduce it very easily, then it might be worth just trying to confirm 
> that it does use I/O completion ports.

Yes, the crash is with completion ports. I just pushed out a fix.

-- 
Alexandre Julliard
julliard at winehq.org


From p.beutner at gmx.net  Tue Dec 18 13:20:23 2007
From: p.beutner at gmx.net (Peter Beutner)
Date: Tue, 18 Dec 2007 20:20:23 +0100
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>	
	<4767EA9F.2030109@gmx.net>
	<78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com>
Message-ID: <47681D77.8080007@gmx.net>

John Klehm schrieb:
> On Dec 18, 2007 9:43 AM, Peter Beutner <p.beutner at gmx.net> wrote:
> 
>> As I recall this is not the only version that causes problems. Plus certain compiler
>> flags have an influence as well. And as most distros ship gcc with a bunch
>> of patches you probably can't even rely on the gcc version alone.
>>
>> Imo it would be better to collect the info on a wiki page.
>>
> 
> Like this one?  http://wiki.winehq.org/GccVersions

ah, nice. didn't know about that one.

> Nothing wrong with having the info output reflect the knowledge
> gathered on the wiki page.

So let's add to that info that gcc 4.2.2 (on gentoo) doesn't work.
As well as recent 4.3-snapshots. (At least that was the status a few
releases back, haven't tested in a while.)
But they did work if you compile with -fstack-protector. And some
distros(I think Ubuntu for example) patch gcc to use that flag by default.
And at least with gcc-4.2.2 it was always very close at the line
between working and non-working. Just a few changes in gdi/kernel/user
could make a difference. So it might even vary between single wine releases.

You want to put and more importantly maintain all those details in the
src code?

I don't think that this is such a great idea. But hey, that's just my
opinion.



From the3dfxdude at gmail.com  Tue Dec 18 13:53:38 2007
From: the3dfxdude at gmail.com (Jesse Allen)
Date: Tue, 18 Dec 2007 12:53:38 -0700
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <47681D77.8080007@gmx.net>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>
	<4767EA9F.2030109@gmx.net>
	<78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com>
	<47681D77.8080007@gmx.net>
Message-ID: <530468570712181153x55cc68f8uc5898dd07895952a@mail.gmail.com>

On Dec 18, 2007 12:20 PM, Peter Beutner <p.beutner at gmx.net> wrote:
> John Klehm schrieb:
> > On Dec 18, 2007 9:43 AM, Peter Beutner <p.beutner at gmx.net> wrote:
> >
> >> As I recall this is not the only version that causes problems. Plus certain compiler
> >> flags have an influence as well. And as most distros ship gcc with a bunch
> >> of patches you probably can't even rely on the gcc version alone.
> >>
> >> Imo it would be better to collect the info on a wiki page.
> >>
> >
> > Like this one?  http://wiki.winehq.org/GccVersions
>
> ah, nice. didn't know about that one.
>
> > Nothing wrong with having the info output reflect the knowledge
> > gathered on the wiki page.
>
> So let's add to that info that gcc 4.2.2 (on gentoo) doesn't work.
> As well as recent 4.3-snapshots. (At least that was the status a few
> releases back, haven't tested in a while.)
> But they did work if you compile with -fstack-protector. And some
> distros(I think Ubuntu for example) patch gcc to use that flag by default.
> And at least with gcc-4.2.2 it was always very close at the line
> between working and non-working. Just a few changes in gdi/kernel/user
> could make a difference. So it might even vary between single wine releases.
>
> You want to put and more importantly maintain all those details in the
> src code?
>
> I don't think that this is such a great idea. But hey, that's just my
> opinion.
>
>


Hmmm.  It's good that we have a wiki for this now. While that page
seems to be focused on SafeDisc, I have long known that gcc 4.0.x
breaks SecuRom. Should we differentiate the two? Maybe not. Since we
have a wiki up, I will probably link to it from my appdb pages now. If
there is anything we can do to identify which distros have broken
gcc's for copy protection we need to do it. These days I still get
people complaining their disc doesn't work and I have no clue what's
wrong as I have not seen a regression in years (this is older
SecuRom), and they do have what I consider to be a working version of
gcc. Sounds like a we're getting into packaging/flags stuff. I don't
even want to go there.


From rob at codeweavers.com  Tue Dec 18 14:38:26 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Tue, 18 Dec 2007 20:38:26 +0000
Subject: [PATCH] Implement BindIoCompletionCallback
In-Reply-To: <476827B3.1060006@gmail.com>
References: <476827B3.1060006@gmail.com>
Message-ID: <47682FC2.5020403@codeweavers.com>

Andrey Turkin wrote:
>  /******************************************************************************
>   *		BindIoCompletionCallback (KERNEL32.@)
>   */
> +extern NTSTATUS WINAPI RtlSetIoCompletionCallback(HANDLE,LPOVERLAPPED_COMPLETION_ROUTINE,ULONG);
>   

This should go in winternl.h.

>  BOOL WINAPI BindIoCompletionCallback( HANDLE FileHandle, LPOVERLAPPED_COMPLETION_ROUTINE Function, ULONG Flags)
>  {
> -    FIXME("%p, %p, %d, stub!\n", FileHandle, Function, Flags);
> -    SetLastError(ERROR_CALL_NOT_IMPLEMENTED);
> +    NTSTATUS status;
> +
> +    TRACE("(%p, %p, %d)\n", FileHandle, Function, Flags);
> +
> +    status = RtlSetIoCompletionCallback( FileHandle, Function, Flags );
> +    if (status == STATUS_SUCCESS) return TRUE;
> +    SetLastError( RtlNtStatusToDosError(status) );
>      return FALSE;
>  } 
>   


-- 
Rob Shearman



From andrey.turkin at gmail.com  Tue Dec 18 14:49:17 2007
From: andrey.turkin at gmail.com (Andrey Turkin)
Date: Tue, 18 Dec 2007 23:49:17 +0300
Subject: [PATCH] Implement BindIoCompletionCallback
In-Reply-To: <47682FC2.5020403@codeweavers.com>
References: <476827B3.1060006@gmail.com> <47682FC2.5020403@codeweavers.com>
Message-ID: <4768324D.9000207@gmail.com>

Robert Shearman wrote:
> Andrey Turkin wrote:
>>  /******************************************************************************
>>
>>   *        BindIoCompletionCallback (KERNEL32.@)
>>   */
>> +extern NTSTATUS WINAPI
>> RtlSetIoCompletionCallback(HANDLE,LPOVERLAPPED_COMPLETION_ROUTINE,ULONG);
>>
>>   
>
> This should go in winternl.h.
winternl.h may not depend on winbase.h for some reason, so this would
mean either changing prototype to "(HANDLE,LPVOID,ULONG)", which seems
wrong, or redefining LPOVERLAPPED_COMPLETION_ROUTINE and
OVERLAPPED/LPOVERLAPPED, which seems to be too much duplication.
>
>>  BOOL WINAPI BindIoCompletionCallback( HANDLE FileHandle,
>> LPOVERLAPPED_COMPLETION_ROUTINE Function, ULONG Flags)
>>  {
>> -    FIXME("%p, %p, %d, stub!\n", FileHandle, Function, Flags);
>> -    SetLastError(ERROR_CALL_NOT_IMPLEMENTED);
>> +    NTSTATUS status;
>> +
>> +    TRACE("(%p, %p, %d)\n", FileHandle, Function, Flags);
>> +
>> +    status = RtlSetIoCompletionCallback( FileHandle, Function, Flags );
>> +    if (status == STATUS_SUCCESS) return TRUE;
>> +    SetLastError( RtlNtStatusToDosError(status) );
>>      return FALSE;
>>  }   
>
>



From winehacker at gmail.com  Tue Dec 18 17:17:53 2007
From: winehacker at gmail.com (Steven Edwards)
Date: Tue, 18 Dec 2007 18:17:53 -0500
Subject: [PATCH] Implement BindIoCompletionCallback
In-Reply-To: <4768324D.9000207@gmail.com>
References: <476827B3.1060006@gmail.com> <47682FC2.5020403@codeweavers.com>
	<4768324D.9000207@gmail.com>
Message-ID: <19e31a080712181517k63c6ee1cte18c5e1d48ca182a@mail.gmail.com>

On Dec 18, 2007 3:49 PM, Andrey Turkin <andrey.turkin at gmail.com> wrote:
> winternl.h may not depend on winbase.h for some reason, so this would
> mean either changing prototype to "(HANDLE,LPVOID,ULONG)", which seems
> wrong, or redefining LPOVERLAPPED_COMPLETION_ROUTINE and
> OVERLAPPED/LPOVERLAPPED, which seems to be too much duplication.

Has anyone looked at the latest WDK to see where this goes? Is it
really winternl.h? That header seems to be a bit of a bastard hack
Microsoft threw together to shut-up the anti-trust case. These
functions and others we have had to add to winternl.h have got to be
documented in some other DDK header which we can implement.

Thanks

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From scott at open-vote.org  Tue Dec 18 19:20:00 2007
From: scott at open-vote.org (Scott Ritchie)
Date: Tue, 18 Dec 2007 17:20:00 -0800
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <530468570712181153x55cc68f8uc5898dd07895952a@mail.gmail.com>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>	<4767EA9F.2030109@gmx.net>	<78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com>	<47681D77.8080007@gmx.net>
	<530468570712181153x55cc68f8uc5898dd07895952a@mail.gmail.com>
Message-ID: <476871C0.9050102@open-vote.org>

Jesse Allen wrote:
> On Dec 18, 2007 12:20 PM, Peter Beutner <p.beutner at gmx.net> wrote:
>> John Klehm schrieb:
>>> On Dec 18, 2007 9:43 AM, Peter Beutner <p.beutner at gmx.net> wrote:
>>>
>>>> As I recall this is not the only version that causes problems. Plus certain compiler
>>>> flags have an influence as well. And as most distros ship gcc with a bunch
>>>> of patches you probably can't even rely on the gcc version alone.
>>>>
>>>> Imo it would be better to collect the info on a wiki page.
>>>>
>>> Like this one?  http://wiki.winehq.org/GccVersions
>> ah, nice. didn't know about that one.
>>
>>> Nothing wrong with having the info output reflect the knowledge
>>> gathered on the wiki page.
>> So let's add to that info that gcc 4.2.2 (on gentoo) doesn't work.
>> As well as recent 4.3-snapshots. (At least that was the status a few
>> releases back, haven't tested in a while.)
>> But they did work if you compile with -fstack-protector. And some
>> distros(I think Ubuntu for example) patch gcc to use that flag by default.
>> And at least with gcc-4.2.2 it was always very close at the line
>> between working and non-working. Just a few changes in gdi/kernel/user
>> could make a difference. So it might even vary between single wine releases.
>>
>> You want to put and more importantly maintain all those details in the
>> src code?
>>
>> I don't think that this is such a great idea. But hey, that's just my
>> opinion.
>>
>>
> 
> 
> Hmmm.  It's good that we have a wiki for this now. While that page
> seems to be focused on SafeDisc, I have long known that gcc 4.0.x
> breaks SecuRom. Should we differentiate the two? Maybe not. Since we
> have a wiki up, I will probably link to it from my appdb pages now. If
> there is anything we can do to identify which distros have broken
> gcc's for copy protection we need to do it. These days I still get
> people complaining their disc doesn't work and I have no clue what's
> wrong as I have not seen a regression in years (this is older
> SecuRom), and they do have what I consider to be a working version of
> gcc. Sounds like a we're getting into packaging/flags stuff. I don't
> even want to go there.
> 
> 

Ugh....this means that 4.2 for Ubuntu might NOT actually work, and that
this is why System Shock 2 has been crashing at startup for me.

I'm gonna try building with 3.4 and see if that fixes anything

Thanks,
Scott Ritchie


From p.beutner at gmx.net  Tue Dec 18 19:49:01 2007
From: p.beutner at gmx.net (Peter Beutner)
Date: Wed, 19 Dec 2007 02:49:01 +0100
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <476871C0.9050102@open-vote.org>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>	<4767EA9F.2030109@gmx.net>	<78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com>	<47681D77.8080007@gmx.net>	<530468570712181153x55cc68f8uc5898dd07895952a@mail.gmail.com>
	<476871C0.9050102@open-vote.org>
Message-ID: <4768788D.7070205@gmx.net>

Scott Ritchie schrieb:
> 
> Ugh....this means that 4.2 for Ubuntu might NOT actually work, and that
> this is why System Shock 2 has been crashing at startup for me.

It usually didn't crash, just exits silently if the check fails, so this is 
probably another issue. Anyway all this affects only safedisc 2.x and google
says System Shock2 is safedisc 1.x. Which has it's own problems and doesn't
work currently at all (afaik).


From dmitry at codeweavers.com  Tue Dec 18 22:11:14 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Wed, 19 Dec 2007 12:11:14 +0800
Subject: ntoskrnl: Implement or add stubs for several functions.
References: <1198036585.11726.23.camel@cybertron>
Message-ID: <017601c841f5$3433c4a0$a600fea9@DMITRY>

"Chris Wulff" <crwulff at rochester.rr.com> wrote:

> NOTE: This is required for the  "hal: Stubs for ExAcquireFastMutex and
> ExReleaseFastMutex" patch to build. (it contains the fast mutex
> typedefs.) I apologize for submitting them out of order.

You need to send every API implementation as a separate self contained
patch, and avoid not necessary white space changes.

-- 
Dmitry.


From dank at kegel.com  Tue Dec 18 23:26:27 2007
From: dank at kegel.com (Dan Kegel)
Date: Tue, 18 Dec 2007 21:26:27 -0800
Subject: Interview with Alexandre on Lug Radio
Message-ID: <a71bd89a0712182126q7bd28c5ep7239f29a205ed30f@mail.gmail.com>

http://www.lugradio.org/episodes/90
"Alexandre Juillard from the Wine Project talks about
where Wine is, why it isn't finished, and what's coming next (2.02)"

In which we learn that Wine now has a release manager,
and that the plan is to release 1.0 for the 15th anniversary
of the project.

- Dan


From dank at kegel.com  Wed Dec 19 00:26:15 2007
From: dank at kegel.com (Dan Kegel)
Date: Tue, 18 Dec 2007 22:26:15 -0800
Subject: Early wine history
Message-ID: <a71bd89a0712182226t1bc13a15i8912327263911be0@mail.gmail.com>

winehq.org doesn't seem to have a link to the message
that launched the wine project, so I went looking.

The first message I found contemplating it was dated 1 Jun 1993,
http://groups.google.com/group/comp.os.linux/msg/0a7c3867abdb4a76
Is that about the right estimate for Wine's birthday?

A roughly 1995 writeup about Wine is at
http://www.softlookup.com/tutorial/redhat/rhl58.asp
It has a screen shot of a game Pipe Dream running under
Wine.  I just checked; the game is still online at
http://members.chello.at/theodor.lauppert/games/pipe1.htm
and runs well on today's wine :-)


From andrewriedi at gmail.com  Wed Dec 19 01:18:38 2007
From: andrewriedi at gmail.com (Andrew Riedi)
Date: Tue, 18 Dec 2007 23:18:38 -0800
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <4768788D.7070205@gmx.net>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>
	<4767EA9F.2030109@gmx.net>
	<78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com>
	<47681D77.8080007@gmx.net>
	<530468570712181153x55cc68f8uc5898dd07895952a@mail.gmail.com>
	<476871C0.9050102@open-vote.org> <4768788D.7070205@gmx.net>
Message-ID: <689de9370712182318s1c2b6a70ob9b32f244dec3821@mail.gmail.com>

I have sent in a new patch with the same title to address the problems
discussed in this thread.  Thanks to all of the people who looked over my
patch and discussed its possible problems.  It should surely help debugging
Wine in the future, especially if we decide to take advantage of the
http://wiki.winehq.org/GccVersions page.

-- 
Andrew Riedi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20071218/6face9df/attachment.htm 

From kubrick at fgv6.net  Wed Dec 19 03:10:43 2007
From: kubrick at fgv6.net (kubrick at fgv6.net)
Date: Wed, 19 Dec 2007 10:10:43 +0100 (CET)
Subject: [Fwd: Re: About the WWN]
Message-ID: <19543.195.6.79.173.1198055443.squirrel@www.fgv6.net>

Hello.

As indicated by Zachary, I post the suggestion I made him on the wine-devel list.
The suggestion was : "what do you think about writing in the WWN an article about what did the last changes of the last release
brought? I mean, knowing that there is "a ton of rpcrt4 fixes" or "New Bidi text implementation that doesn't depend on libicu"
is really great, but from a user point of view it doesn't mean anything. It would be great if you'd explain us the problems it
solves and which opportunities it gives."
What he replies is that he need your help !

Thanks.

Fran?ois.

------------------------------------------------------- Original Message -------------------------------------------------------
Subject: Re: About the WWN
From:    "Zachary Goldberg" <zgold at bluesata.com>
Date:    Tue, December 18, 2007 19:50
To:      Fran?ois Guerraz <kubrick at fgv6.net>
--------------------------------------------------------------------------------------------------------------------------------

Francois,

If you could do me a favor of suggesting your second point on the
wine-devel mailing list then we could start a discussion for it.  I
think it would be a good idea; however It would require perhaps a bit
more detail being made in the commit comments to WINE so that I can go
through them and put together the real changes.

--Zach

On Dec 18, 2007 1:47 PM, Fran?ois Guerraz <kubrick at fgv6.net> wrote:
>  Hello.
>
> First of all : thank you so much for being the new author of the WWN. I am a
> fervent reader and I was really upset that it was almost never written. I
> hope you'll find this task interesting and that you won't be fed up with it
> too quick :)
> Second I have a suggestion to make : what do you think about writing in the
> WWN an article about what did the last changes of the last release brought?
> I mean, knowing that there is "a ton of rpcrt4 fixes" or "New Bidi text
> implementation that doesn't depend on libicu" is really great, but from a
> user point of view it doesn't mean anything. It would be great if you'd
> explain us the problems it solves and which opportunities it gives.
>
> Thank you for your time and implication.
>
> Regards,
>
>
> Fran?ois Guerraz
> kubrick at fgv6.net
>
>
>
>



-- 
Zachary Goldberg
Computer Science & Engineering
Electrical Captain of Penn Electric Race Team
School of Engineering at the University of Pennsylvania




From r.kalbermatter at hccnet.nl  Wed Dec 19 05:42:02 2007
From: r.kalbermatter at hccnet.nl (Rolf Kalbermatter)
Date: Wed, 19 Dec 2007 12:42:02 +0100
Subject: [PATCH] Implement BindIoCompletionCallback
Message-ID: <006901c84234$2c4178c0$4001a8c0@NATERS>

Andrey Turkin wrote:

>diff --git a/dlls/kernel32/tests/sync.c b/dlls/kernel32/tests/sync.c
>index e402fed..7bbb3e2 100644
>--- a/dlls/kernel32/tests/sync.c
>+++ b/dlls/kernel32/tests/sync.c
>@@ -327,7 +327,7 @@ static void test_iocp_callback(void)
>     retb = p_BindIoCompletionCallback(hFile, iocp_callback, 0);
>     ok(retb == FALSE, "BindIoCompletionCallback succeeded on a file that
wasn't created with FILE_FLAG_OVERLAPPED\n");
>     if(retb == FALSE && GetLastError() == ERROR_CALL_NOT_IMPLEMENTED) {
>-        todo_wine ok (0, "BindIoCompletionCallback returned
ERROR_CALL_NOT_IMPLEMENTED\n");
>+        ok (0, "BindIoCompletionCallback returned
ERROR_CALL_NOT_IMPLEMENTED\n");
>         return;
>     }

I don't think this check makes much sense after the change anymore. It's at
best a skip() for older Windows versions.

Rolf Kalbermatter



From julliard at winehq.org  Wed Dec 19 06:04:37 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 19 Dec 2007 13:04:37 +0100
Subject: [msiexec] A nicer icon
In-Reply-To: <379381.95708.qm@web25806.mail.ukl.yahoo.com> (=?utf-8?Q?=22H?=
	=?utf-8?Q?erv=C3=BFffffe=22's?=
	message of "Wed, 19 Dec 2007 08:36:08 +0000 (GMT)")
References: <379381.95708.qm@web25806.mail.ukl.yahoo.com>
Message-ID: <873atyzy96.fsf@wine.dyndns.org>

Herv?ffffe9 Chanal <chanal_herve at yahoo.fr> writes:

> Hello,
>
> It's a larger nicer icon for msiexec with the svg source.

Having icons in .svg format is a nice improvement, but we'll need a tool
to build the .ico from the .svg. We also need to include multiple sizes
in the .ico, most places want a 32x32 icon, and scaling down the 48x48
looks bad. Of course we should also look into taking advantage of the
larger size where that's possible without breaking compatibility.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Wed Dec 19 06:20:16 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 19 Dec 2007 13:20:16 +0100
Subject: [PATCH 2/3] qmgr: AddRef, QueryInterface,
	and stub functions for queue manager interface.
In-Reply-To: <20071217224026.GA31617@knuth.cs.hmc.edu> (Roy Shea's message of
	"Mon, 17 Dec 2007 14:40:27 -0800")
References: <20071217224026.GA31617@knuth.cs.hmc.edu>
Message-ID: <87y7bqyiyn.fsf@wine.dyndns.org>

Roy Shea <roy at cs.hmc.edu> writes:

> +static ULONG WINAPI BITS_IBackgroundCopyManager_AddRef(
> +        IBackgroundCopyManager* iface)
> +{
> +    ICOM_THIS_MULTI(BackgroundCopyManagerImpl, lpVtbl, iface);

There's no reason to use ICOM_THIS_MULTI with a single vtbl.

> +    if (This == NULL)
> +    {
> +        return E_POINTER;
> +    }

Checking This for NULL is a waste of time.

-- 
Alexandre Julliard
julliard at winehq.org


From rob at codeweavers.com  Wed Dec 19 09:00:26 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Wed, 19 Dec 2007 15:00:26 +0000
Subject: [PATCH] Implement BindIoCompletionCallback
In-Reply-To: <4768324D.9000207@gmail.com>
References: <476827B3.1060006@gmail.com> <47682FC2.5020403@codeweavers.com>
	<4768324D.9000207@gmail.com>
Message-ID: <4769320A.2000609@codeweavers.com>

Andrey Turkin wrote:
> Robert Shearman wrote:
>   
>> Andrey Turkin wrote:
>>     
>>>  /******************************************************************************
>>>
>>>   *        BindIoCompletionCallback (KERNEL32.@)
>>>   */
>>> +extern NTSTATUS WINAPI
>>> RtlSetIoCompletionCallback(HANDLE,LPOVERLAPPED_COMPLETION_ROUTINE,ULONG);
>>>
>>>   
>>>       
>> This should go in winternl.h.
>>     
> winternl.h may not depend on winbase.h for some reason, so this would
> mean either changing prototype to "(HANDLE,LPVOID,ULONG)", which seems
> wrong, or redefining LPOVERLAPPED_COMPLETION_ROUTINE and
> OVERLAPPED/LPOVERLAPPED, which seems to be too much duplication.
>   

I think you should guard the function with an #ifdef __WINE_WINBASE_H 
statement, but I would wait for some other developers to chime in to get 
a consensus before accepting this though.

-- 
Rob Shearman



From julliard at winehq.org  Wed Dec 19 09:56:30 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 19 Dec 2007 16:56:30 +0100
Subject: [PATCH] Implement BindIoCompletionCallback
In-Reply-To: <4769320A.2000609@codeweavers.com> (Robert Shearman's message of
	"Wed, 19 Dec 2007 15:00:26 +0000")
References: <476827B3.1060006@gmail.com> <47682FC2.5020403@codeweavers.com>
	<4768324D.9000207@gmail.com> <4769320A.2000609@codeweavers.com>
Message-ID: <87tzmey8y9.fsf@wine.dyndns.org>

Robert Shearman <rob at codeweavers.com> writes:

> Andrey Turkin wrote:
>> Robert Shearman wrote:
>>   
>>> Andrey Turkin wrote:
>>>     
>>>>  /******************************************************************************
>>>>
>>>>   *        BindIoCompletionCallback (KERNEL32.@)
>>>>   */
>>>> +extern NTSTATUS WINAPI
>>>> RtlSetIoCompletionCallback(HANDLE,LPOVERLAPPED_COMPLETION_ROUTINE,ULONG);
>>>>
>>>>   
>>>>       
>>> This should go in winternl.h.
>>>     
>> winternl.h may not depend on winbase.h for some reason, so this would
>> mean either changing prototype to "(HANDLE,LPVOID,ULONG)", which seems
>> wrong, or redefining LPOVERLAPPED_COMPLETION_ROUTINE and
>> OVERLAPPED/LPOVERLAPPED, which seems to be too much duplication.
>>   
>
> I think you should guard the function with an #ifdef __WINE_WINBASE_H 
> statement, but I would wait for some other developers to chime in to get 
> a consensus before accepting this though.

It doesn't seem right for an ntdll function to use an OVERLAPPED
pointer. Shouldn't it take an IO_STATUS_BLOCK instead?

-- 
Alexandre Julliard
julliard at winehq.org


From kris at pcbsd.com  Tue Dec 18 14:05:57 2007
From: kris at pcbsd.com (Kris Moore)
Date: Tue, 18 Dec 2007 15:05:57 -0500
Subject: Patch for process title on FreeBSD
In-Reply-To: <873au6sw5y.fsf@wine.dyndns.org>
References: <47601F6F.1010504@pcbsd.com> <873au6sw5y.fsf@wine.dyndns.org>
Message-ID: <47682825.8010105@pcbsd.com>



How exactly would you like that done? I'm not much of a C programmer, I 
live more in the C++ / Shell world :)



-- 

Kris Moore
PC-BSD Software
http://www.pcbsd.com


Alexandre Julliard wrote:
> Kris Moore <kris at pcbsd.com> writes:
> 
>> --- dlls/kernel32/process.c.orig	2007-12-12 12:34:45.000000000 -0500
>> +++ dlls/kernel32/process.c	2007-12-12 12:35:17.000000000 -0500
>> @@ -853,6 +853,11 @@
>>   */
>>  static void set_process_name( int argc, char *argv[] )
>>  {
>> +
>> +#if defined(__FreeBSD__)
>> +    setproctitle("-%s", argv[1]);
>> +#endif
> 
> You should add a configure check for this function, instead of checking
> for __FreeBSD__.
> 


From maarten at codeweavers.com  Wed Dec 19 10:56:53 2007
From: maarten at codeweavers.com (Maarten Lankhorst)
Date: Wed, 19 Dec 2007 17:56:53 +0100
Subject: Patch for process title on FreeBSD
In-Reply-To: <47682825.8010105@pcbsd.com>
References: <47601F6F.1010504@pcbsd.com> <873au6sw5y.fsf@wine.dyndns.org>
	<47682825.8010105@pcbsd.com>
Message-ID: <47694D55.5040808@codeweavers.com>

Hi Kris,

Kris Moore schreef:
> How exactly would you like that done? I'm not much of a C programmer, I 
> live more in the C++ / Shell world :)
>   
With autoconf of course (configure.ac).

Cheers,
Maarten.



From austinenglish at gmail.com  Wed Dec 19 11:02:06 2007
From: austinenglish at gmail.com (Austin English)
Date: Wed, 19 Dec 2007 11:02:06 -0600
Subject: Early wine history
In-Reply-To: <a71bd89a0712182226t1bc13a15i8912327263911be0@mail.gmail.com>
References: <a71bd89a0712182226t1bc13a15i8912327263911be0@mail.gmail.com>
Message-ID: <b6bb06270712190902j3ec30d75pe4f03b124347984d@mail.gmail.com>

I found this announcement from Bob Amstadt announcing the mailing
list, this was dated September 16, 1993:
http://groups.google.com/group/comp.windows.x.i386unix/browse_thread/thread/ee272fa922314342/a08260429f730cdf

But according to this status report, it was started in early June 1993:
http://groups.google.com/group/comp.windows.x.i386unix/browse_thread/thread/88fbd87c0ae2e48f/5003eb8ed33ae522

Which makes your June 1, 1993 date sound about right :-). Looking a
bit further in that discussion, you can see Eric making a call for
volunteers the next day:
http://groups.google.com/group/comp.os.linux/msg/106b5f2702b1c53d

-Austin


On Dec 19, 2007 12:26 AM, Dan Kegel <dank at kegel.com> wrote:
> winehq.org doesn't seem to have a link to the message
> that launched the wine project, so I went looking.
>
> The first message I found contemplating it was dated 1 Jun 1993,
> http://groups.google.com/group/comp.os.linux/msg/0a7c3867abdb4a76
> Is that about the right estimate for Wine's birthday?
>
> A roughly 1995 writeup about Wine is at
> http://www.softlookup.com/tutorial/redhat/rhl58.asp
> It has a screen shot of a game Pipe Dream running under
> Wine.  I just checked; the game is still online at
> http://members.chello.at/theodor.lauppert/games/pipe1.htm
> and runs well on today's wine :-)
>
>
>


From andrey.turkin at gmail.com  Wed Dec 19 11:36:52 2007
From: andrey.turkin at gmail.com (Andrey Turkin)
Date: Wed, 19 Dec 2007 20:36:52 +0300
Subject: [PATCH] Implement BindIoCompletionCallback
In-Reply-To: <87tzmey8y9.fsf@wine.dyndns.org>
References: <476827B3.1060006@gmail.com>
	<47682FC2.5020403@codeweavers.com>	<4768324D.9000207@gmail.com>
	<4769320A.2000609@codeweavers.com> <87tzmey8y9.fsf@wine.dyndns.org>
Message-ID: <476956B4.4010303@gmail.com>

Alexandre Julliard wrote:
> Robert Shearman <rob at codeweavers.com> writes:
>
>   
>> Andrey Turkin wrote:
>>     
>>> Robert Shearman wrote:
>>>   
>>>       
>>>> Andrey Turkin wrote:
>>>>     
>>>>         
>>>>>  /******************************************************************************
>>>>>
>>>>>   *        BindIoCompletionCallback (KERNEL32.@)
>>>>>   */
>>>>> +extern NTSTATUS WINAPI
>>>>> RtlSetIoCompletionCallback(HANDLE,LPOVERLAPPED_COMPLETION_ROUTINE,ULONG);
>>>>>
>>>>>   
>>>>>       
>>>>>           
>>>> This should go in winternl.h.
>>>>     
>>>>         
>>> winternl.h may not depend on winbase.h for some reason, so this would
>>> mean either changing prototype to "(HANDLE,LPVOID,ULONG)", which seems
>>> wrong, or redefining LPOVERLAPPED_COMPLETION_ROUTINE and
>>> OVERLAPPED/LPOVERLAPPED, which seems to be too much duplication.
>>>   
>>>       
>> I think you should guard the function with an #ifdef __WINE_WINBASE_H 
>> statement, but I would wait for some other developers to chime in to get 
>> a consensus before accepting this though.
>>     
>
> It doesn't seem right for an ntdll function to use an OVERLAPPED
> pointer. Shouldn't it take an IO_STATUS_BLOCK instead?
>
>   

It is not used in the function itself, it is only passed to
user-provided callback. So, I see several possibilities:
1) change RtlSetIoCompletionCallback to use another callback prototype,
with LPVOID or ULONG_PTR or something instead of LPOVERLAPPED
2) leave callback prototype as in BindIoCompletionCallback, and protect
RtlSetIoCompletionCallback with #ifdefs as Robert suggested
3) do not implement RtlSetIoCompletionCallback at all and move all code
in kernel32

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20071219/873fcc6e/attachment.htm 

From dank at kegel.com  Wed Dec 19 12:08:51 2007
From: dank at kegel.com (Dan Kegel)
Date: Wed, 19 Dec 2007 10:08:51 -0800
Subject: Piddly little erratic valgrind warning in ole32_moniker
Message-ID: <a71bd89a0712191008s2479f81bhc773ca2de4f0b99c@mail.gmail.com>

Nothing really new yesterday or today.

This one's annoying:

http://kegel.com/wine/valgrind/logs-2007-12-19/vg-ole32_moniker-diff.txt
+ Syscall param write(buf) points to uninitialised byte(s)
+    at  (within /lib/ld-2.5.so)
+    by  WriteFile (file.c:512)
+    by  RPCSS_BecomePipeServer (np_server.c:379)
+    by  main (rpcss_main.c:101)

because it keeps looking like it's new every other day

$ grep RPCSS_BecomePipeServer logs-*/vg-ole32_mon*diff.txt
logs-2007-12-06/vg-ole32_moniker-diff.txt:+    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-06/vg-ole32_moniker-diff.txt:+   fun:RPCSS_BecomePipeServer
logs-2007-12-06/vg-ole32_moniker-diff.txt:-    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-06/vg-ole32_moniker-diff.txt:-   fun:RPCSS_BecomePipeServer
logs-2007-12-07/vg-ole32_moniker-diff.txt:    fun:RPCSS_BecomePipeServer
logs-2007-12-08/vg-ole32_moniker-diff.txt:+    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-08/vg-ole32_moniker-diff.txt:+   fun:RPCSS_BecomePipeServer
logs-2007-12-08/vg-ole32_moniker-diff.txt:-    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-08/vg-ole32_moniker-diff.txt:-   fun:RPCSS_BecomePipeServer
logs-2007-12-10/vg-ole32_moniker-diff.txt:-    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-10/vg-ole32_moniker-diff.txt:-   fun:RPCSS_BecomePipeServer
logs-2007-12-10/vg-ole32_moniker-diff.txt:+    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-10/vg-ole32_moniker-diff.txt:+   fun:RPCSS_BecomePipeServer
logs-2007-12-12/vg-ole32_moniker-diff.txt:+    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-12/vg-ole32_moniker-diff.txt:+   fun:RPCSS_BecomePipeServer
logs-2007-12-12/vg-ole32_moniker-diff.txt:-    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-12/vg-ole32_moniker-diff.txt:-   fun:RPCSS_BecomePipeServer
logs-2007-12-13/vg-ole32_moniker-diff.txt:-    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-13/vg-ole32_moniker-diff.txt:-   fun:RPCSS_BecomePipeServer
logs-2007-12-14/vg-ole32_moniker-diff.txt:+    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-14/vg-ole32_moniker-diff.txt:+   fun:RPCSS_BecomePipeServer
logs-2007-12-17/vg-ole32_moniker-diff.txt:-    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-17/vg-ole32_moniker-diff.txt:-   fun:RPCSS_BecomePipeServer
logs-2007-12-17/vg-ole32_moniker-diff.txt:+    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-17/vg-ole32_moniker-diff.txt:+   fun:RPCSS_BecomePipeServer
logs-2007-12-18/vg-ole32_moniker-diff.txt:-    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-18/vg-ole32_moniker-diff.txt:-   fun:RPCSS_BecomePipeServer
logs-2007-12-19/vg-ole32_moniker-diff.txt:+    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-19/vg-ole32_moniker-diff.txt:+   fun:RPCSS_BecomePipeServer


From julliard at winehq.org  Wed Dec 19 12:58:01 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 19 Dec 2007 19:58:01 +0100
Subject: Early wine history
In-Reply-To: <a71bd89a0712182226t1bc13a15i8912327263911be0@mail.gmail.com>
	(Dan Kegel's message of "Tue, 18 Dec 2007 22:26:15 -0800")
References: <a71bd89a0712182226t1bc13a15i8912327263911be0@mail.gmail.com>
Message-ID: <87mys6y0jq.fsf@wine.dyndns.org>

"Dan Kegel" <dank at kegel.com> writes:

> The first message I found contemplating it was dated 1 Jun 1993,
> http://groups.google.com/group/comp.os.linux/msg/0a7c3867abdb4a76
> Is that about the right estimate for Wine's birthday?

The 0.0.2 release was on June 29, and 0.0.1 was about a week before
that IIRC. I don't have the exact date unfortunately.

> A roughly 1995 writeup about Wine is at
> http://www.softlookup.com/tutorial/redhat/rhl58.asp
> It has a screen shot of a game Pipe Dream running under
> Wine.  I just checked; the game is still online at
> http://members.chello.at/theodor.lauppert/games/pipe1.htm
> and runs well on today's wine :-)

Hehe, I remember spending lots of time playing, I mean testing that
game...

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Wed Dec 19 13:01:34 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 19 Dec 2007 20:01:34 +0100
Subject: [PATCH] Implement BindIoCompletionCallback
In-Reply-To: <476956B4.4010303@gmail.com> (Andrey Turkin's message of "Wed, 19
	Dec 2007 20:36:52 +0300")
References: <476827B3.1060006@gmail.com> <47682FC2.5020403@codeweavers.com>
	<4768324D.9000207@gmail.com> <4769320A.2000609@codeweavers.com>
	<87tzmey8y9.fsf@wine.dyndns.org> <476956B4.4010303@gmail.com>
Message-ID: <87ir2uy0dt.fsf@wine.dyndns.org>

Andrey Turkin <andrey.turkin at gmail.com> writes:

> It is not used in the function itself, it is only passed to
> user-provided callback. So, I see several possibilities:

I know it's in the callback, what I meant is that the ntdll function
should not be taking a LPOVERLAPPED_COMPLETION_ROUTINE, which is a
kernel32 thing, it should be taking some sort of IO_COMPLETION_CALLBACK
routine, that uses an IO_STATUS_BLOCK (or probably better a void*, since
it's opaque) instead of an OVERLAPPED pointer.

-- 
Alexandre Julliard
julliard at winehq.org


From bridd at bridd.com  Wed Dec 19 13:12:53 2007
From: bridd at bridd.com (bridd)
Date: Wed, 19 Dec 2007 19:12:53 +0000
Subject: dll to .so wrapper
In-Reply-To: <87ir2uy0dt.fsf@wine.dyndns.org>
References: <476827B3.1060006@gmail.com> <47682FC2.5020403@codeweavers.com>
	<4768324D.9000207@gmail.com> <4769320A.2000609@codeweavers.com>
	<87tzmey8y9.fsf@wine.dyndns.org> <476956B4.4010303@gmail.com>
	<87ir2uy0dt.fsf@wine.dyndns.org>
Message-ID: <1198091573.6283.1.camel@nebba.config>

Hi there,

I've got a bit of a specific task, that I don't know if it's achievable
via wine in some way or not.  I'd like to make a windows dll available
to linux programs as a .so file.

The dll itself is a video plugin (freeframe.sourceforge.net).  These are
available commercially to buy, and I'd like to be able to use them in a
linux application that supports the plugin format for native linux
compiled plugins, without having to request linux native versions from
the commercial developers.

I've been doing some searching, and have found a few mails on this list
about this sort of thing in the past, but haven't been able to find a
conclusive method.

I guess that this might be possible via some sort of wrapper that maps
the inputs/outputs to the dll .  Does anyone know if there is anything
that runs like this already out there that I could take a look at as an
example piece of code to hack about with?

Cheers

Dave



From frank.richter at gmail.com  Wed Dec 19 13:14:24 2007
From: frank.richter at gmail.com (Frank Richter)
Date: Wed, 19 Dec 2007 20:14:24 +0100
Subject: [msiexec] A nicer icon
In-Reply-To: <873atyzy96.fsf@wine.dyndns.org>
References: <379381.95708.qm@web25806.mail.ukl.yahoo.com>
	<873atyzy96.fsf@wine.dyndns.org>
Message-ID: <47696D90.8090606@gmail.com>

On 19.12.2007 13:04, Alexandre Julliard wrote:
> Having icons in .svg format is a nice improvement, but we'll need a tool
> to build the .ico from the .svg. We also need to include multiple sizes
> in the .ico, most places want a 32x32 icon, and scaling down the 48x48
> looks bad. Of course we should also look into taking advantage of the
> larger size where that's possible without breaking compatibility.

I've created a system to produce Win32 .icos from SVGs for another
project[1]. I used rsvg to convert svg->png, imagemagick's convert to
reduce color depths and finally icotool[2] to assemble the Win32 icon.

-f.r.

[1]
http://trac.crystalspace3d.org/trac/CS/browser/CS/trunk/mk/jam/icons.jam
- it's for the Jam build system, but at least you can see the commands
used (the stuff in 'actions').
[2] Part of icoutils: http://www.nongnu.org/icoutils/



From twickline at gmail.com  Wed Dec 19 14:08:41 2007
From: twickline at gmail.com (Tom Wickline)
Date: Wed, 19 Dec 2007 15:08:41 -0500
Subject: Early wine history
In-Reply-To: <87mys6y0jq.fsf@wine.dyndns.org>
References: <a71bd89a0712182226t1bc13a15i8912327263911be0@mail.gmail.com>
	<87mys6y0jq.fsf@wine.dyndns.org>
Message-ID: <53e3a9930712191208y18ff8cf5pf5c83d43c7714fec@mail.gmail.com>

I have a copy of iX Magazine (  http://www.heise.de/ix/ ) from
July 1994 that has a four page write up about Wine. There is also
a full page interview, Q&A with Bob Amstadt.

Pages 122 to 127

Tom


From maarten at codeweavers.com  Wed Dec 19 15:26:38 2007
From: maarten at codeweavers.com (Maarten Lankhorst)
Date: Wed, 19 Dec 2007 22:26:38 +0100
Subject: dll to .so wrapper
In-Reply-To: <1198091573.6283.1.camel@nebba.config>
References: <476827B3.1060006@gmail.com>
	<47682FC2.5020403@codeweavers.com>	<4768324D.9000207@gmail.com>
	<4769320A.2000609@codeweavers.com>	<87tzmey8y9.fsf@wine.dyndns.org>
	<476956B4.4010303@gmail.com>	<87ir2uy0dt.fsf@wine.dyndns.org>
	<1198091573.6283.1.camel@nebba.config>
Message-ID: <47698C8E.8050605@codeweavers.com>

Hi bridd,

bridd schreef:
> Hi there,
>
> I've got a bit of a specific task, that I don't know if it's achievable
> via wine in some way or not.  I'd like to make a windows dll available
> to linux programs as a .so file.
>
> The dll itself is a video plugin (freeframe.sourceforge.net).  These are
> available commercially to buy, and I'd like to be able to use them in a
> linux application that supports the plugin format for native linux
> compiled plugins, without having to request linux native versions from
> the commercial developers.
>
> I've been doing some searching, and have found a few mails on this list
> about this sort of thing in the past, but haven't been able to find a
> conclusive method.
>
> I guess that this might be possible via some sort of wrapper that maps
> the inputs/outputs to the dll .  Does anyone know if there is anything
> that runs like this already out there that I could take a look at as an
> example piece of code to hack about with?
>   
This topic comes up from time to time, usually with mild variations. The
problem is that wine sets up its own environment and memory layout. In
the end you will need a .exe (or winelib binary) that uses wine, and a
socket/pipe/shm function to communicate with the .so, there is no easy
way to just  dynamically load a dll in an existing program.

Cheers,
Maarten.



From marcus at jet.franken.de  Wed Dec 19 16:06:37 2007
From: marcus at jet.franken.de (Marcus Meissner)
Date: Wed, 19 Dec 2007 23:06:37 +0100
Subject: dll to .so wrapper
In-Reply-To: <47698C8E.8050605@codeweavers.com>
References: <476827B3.1060006@gmail.com> <47682FC2.5020403@codeweavers.com>
	<4768324D.9000207@gmail.com> <4769320A.2000609@codeweavers.com>
	<87tzmey8y9.fsf@wine.dyndns.org> <476956B4.4010303@gmail.com>
	<87ir2uy0dt.fsf@wine.dyndns.org>
	<1198091573.6283.1.camel@nebba.config>
	<47698C8E.8050605@codeweavers.com>
Message-ID: <20071219220637.GA4133@jet.franken.de>

On Wed, Dec 19, 2007 at 10:26:38PM +0100, Maarten Lankhorst wrote:
> Hi bridd,
> 
> bridd schreef:
> > Hi there,
> >
> > I've got a bit of a specific task, that I don't know if it's achievable
> > via wine in some way or not.  I'd like to make a windows dll available
> > to linux programs as a .so file.
> >
> > The dll itself is a video plugin (freeframe.sourceforge.net).  These are
> > available commercially to buy, and I'd like to be able to use them in a
> > linux application that supports the plugin format for native linux
> > compiled plugins, without having to request linux native versions from
> > the commercial developers.
> >
> > I've been doing some searching, and have found a few mails on this list
> > about this sort of thing in the past, but haven't been able to find a
> > conclusive method.

Yes, it is called "MPlayer", which has a rudimentary WIne derived
Codec loading and executing framework.

You are perhaps easier off using it ;)

Ciao, Marcus


From bridd at bridd.com  Wed Dec 19 16:54:18 2007
From: bridd at bridd.com (bridd)
Date: Wed, 19 Dec 2007 22:54:18 +0000
Subject: dll to .so wrapper
In-Reply-To: <20071219220637.GA4133@jet.franken.de>
References: <476827B3.1060006@gmail.com> <47682FC2.5020403@codeweavers.com>
	<4768324D.9000207@gmail.com> <4769320A.2000609@codeweavers.com>
	<87tzmey8y9.fsf@wine.dyndns.org> <476956B4.4010303@gmail.com>
	<87ir2uy0dt.fsf@wine.dyndns.org> <1198091573.6283.1.camel@nebba.config>
	<47698C8E.8050605@codeweavers.com>
	<20071219220637.GA4133@jet.franken.de>
Message-ID: <1198104858.6283.9.camel@nebba.config>

On Wed, 2007-12-19 at 23:06 +0100, Marcus Meissner wrote:

> > > The dll itself is a video plugin (freeframe.sourceforge.net).  These are
> > > available commercially to buy, and I'd like to be able to use them in a
> > > linux application that supports the plugin format for native linux
> > > compiled plugins, without having to request linux native versions from
> > > the commercial developers.
> > >
> > > I've been doing some searching, and have found a few mails on this list
> > > about this sort of thing in the past, but haven't been able to find a
> > > conclusive method.
> 
> Yes, it is called "MPlayer", which has a rudimentary WIne derived
> Codec loading and executing framework.
> 
> You are perhaps easier off using it ;)

That kind-of misses my point though; freeframe is a plug-in format for
adding effects to a video input (usually used in live VJ applications).
As far as I know, MPlayer doesn't support it, nor would that enable
support in any linux VJ'ing software! :)

I was simply looking at the possibility of running freeframe plugins
compiled under windows, in linux using wine as the middle-layer.

Cheers

Dave



From bridd at bridd.com  Wed Dec 19 16:57:24 2007
From: bridd at bridd.com (bridd)
Date: Wed, 19 Dec 2007 22:57:24 +0000
Subject: dll to .so wrapper
In-Reply-To: <47698C8E.8050605@codeweavers.com>
References: <476827B3.1060006@gmail.com> <47682FC2.5020403@codeweavers.com>
	<4768324D.9000207@gmail.com> <4769320A.2000609@codeweavers.com>
	<87tzmey8y9.fsf@wine.dyndns.org> <476956B4.4010303@gmail.com>
	<87ir2uy0dt.fsf@wine.dyndns.org> <1198091573.6283.1.camel@nebba.config>
	<47698C8E.8050605@codeweavers.com>
Message-ID: <1198105044.6283.13.camel@nebba.config>


On Wed, 2007-12-19 at 22:26 +0100, Maarten Lankhorst wrote:

> This topic comes up from time to time, usually with mild variations. The
> problem is that wine sets up its own environment and memory layout. In
> the end you will need a .exe (or winelib binary) that uses wine, and a
> socket/pipe/shm function to communicate with the .so, there is no easy
> way to just  dynamically load a dll in an existing program.

I see, so it's sounding like to do this I'd need to have something more
akin to a VST host, that acts as an intermediatory and pumps the video
data from the linux application via a native plugin (.so), into a
winelib compiled program that executes the windows compiled plugin
(.dll) and the sends it back out again.

Probably beyond my skills right now, but thought it was worth seeing if
anyone had trodden a similar route already!

Thanks,

Dave



From p.beutner at gmx.net  Wed Dec 19 18:59:39 2007
From: p.beutner at gmx.net (Peter Beutner)
Date: Thu, 20 Dec 2007 01:59:39 +0100
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <47681D77.8080007@gmx.net>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>		<4767EA9F.2030109@gmx.net>	<78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com>
	<47681D77.8080007@gmx.net>
Message-ID: <4769BE7B.7010204@gmx.net>

Peter Beutner schrieb:
> John Klehm schrieb:
>> On Dec 18, 2007 9:43 AM, Peter Beutner <p.beutner at gmx.net> wrote:
>>
>>> As I recall this is not the only version that causes problems. Plus certain compiler
>>> flags have an influence as well. And as most distros ship gcc with a bunch
>>> of patches you probably can't even rely on the gcc version alone.
>>>
>>> Imo it would be better to collect the info on a wiki page.
>>>
>> Like this one?  http://wiki.winehq.org/GccVersions
> 
> ah, nice. didn't know about that one.
> 
>> Nothing wrong with having the info output reflect the knowledge
>> gathered on the wiki page.
> 
> So let's add to that info that gcc 4.2.2 (on gentoo) doesn't work.
> As well as recent 4.3-snapshots. (At least that was the status a few
> releases back, haven't tested in a while.)

just tested again with current git and it worked with every gcc version
I had at hand here: 4.2.2, 4.1.2, 4.0.4 and 3.4.6.


From stefandoesinger at gmx.at  Wed Dec 19 19:48:41 2007
From: stefandoesinger at gmx.at (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Thu, 20 Dec 2007 02:48:41 +0100
Subject: [patch 1/2,
	try 2] wined3d: rewrite IWineD3DSurfaceImpl_BltOverride colorfill
	codepath
Message-ID: <200712200248.41938.stefandoesinger@gmx.at>

Hi Alexander,

I had a look at your patches again, and another issue came to my mind: I am 
not sure how the scissor rectangle and viewport affects ColorFill blits. 
IDirect3DDevice::Clear is limited by the viewport, the scissor test and the 
rectangles passed in, but I think that this doesn't apply to ColorFills. If 
that is true, I think there isn't much point in having a common codepath, and 
we should just put the glClear() call into COLORFILL itself - Dealing with 
the differences of those two calls will be more effort than the code shared.

But I think we need a test for this. There is a clear() test in 
dlls/ddraw/tests/visual.c, but the d3d9 test tests a few more things. It 
should be possible to add a COLORFILL test to the visual.c clear test in 
ddraw as well, this will show if Windows honors the scissor and viewport in 
COLORFILL or not.

Yes, I know... Start fixing one bug, and you'll run into a lot more. Happens 
to me all the time as well :-)

Stefan


From dank at kegel.com  Wed Dec 19 20:47:43 2007
From: dank at kegel.com (Dan Kegel)
Date: Wed, 19 Dec 2007 18:47:43 -0800
Subject: Today's git won't hunt. Server crash, lots of other problems?
In-Reply-To: <a71bd89a0712181038l5cfbd7bdk7c6e238093876db7@mail.gmail.com>
References: <a71bd89a0712181038l5cfbd7bdk7c6e238093876db7@mail.gmail.com>
Message-ID: <a71bd89a0712191847h37c3e0ds44be9feb145d8189@mail.gmail.com>

On Dec 18, 2007 10:38 AM, Dan Kegel <dank at kegel.com> wrote:
> > My git won't install DNS9P any more, as of today's git.
> But it doesn't seem easy to repeat; I keep getting other errors now.
>
> Roy next to me says he ran into another regression, he's doing a bisect,

There were bunches of regressions, it seems, but
today's git plus the patches sent to wine-patches
by Rob and Maarten fix the DNS 9 problem.
Thanks, guys!
- Dan


From dmitry at codeweavers.com  Thu Dec 20 02:31:53 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Thu, 20 Dec 2007 16:31:53 +0800
Subject: The BS_GROUPBOX style should only be used if the
	HasBorderattribute is set
References: <22821af30712191301n704f8a77k7250d81b9e575463@mail.gmail.com>
Message-ID: <016601c842e2$c8b5f830$a600fea9@DMITRY>

"James Hawkins" <truiken at gmail.com> wrote:

> Changelog:
> * The BS_GROUPBOX style should only be used if the HasBorder attribute is set.

Alexandre, please don't apply this patch. I sent another patch that reverts
commit 96e4320feb22b3a2c9564de100c09990622edb59 which is the real source
of the problem.

Perhaps James' patch is going in the right direction when a group box should
really be displayed by a WM_DRAWITEM handler, or BS_GROUPBOX should be used
instead in that case. But that needs a test case.

-- 
Dmitry.


From hverbeet at gmail.com  Thu Dec 20 02:46:29 2007
From: hverbeet at gmail.com (H. Verbeet)
Date: Thu, 20 Dec 2007 09:46:29 +0100
Subject: [5/6] WineD3D: Move the GL info structure into the adapter
In-Reply-To: <200712200206.06524.stefan@codeweavers.com>
References: <200712200206.06524.stefan@codeweavers.com>
Message-ID: <d658b69e0712200046t6669c8dfpdef75b892b3d0aeb@mail.gmail.com>

On 20/12/2007, Stefan D?singer <stefan at codeweavers.com> wrote:
> +#define WINED3D_ATR_TYPE(type)          GLINFO_LOCATION.glTypeLookup[type].d3dType
> +#define WINED3D_ATR_SIZE(type)          GLINFO_LOCATION.glTypeLookup[type].size
> +#define WINED3D_ATR_GLTYPE(type)        GLINFO_LOCATION.glTypeLookup[type].glType
> +#define WINED3D_ATR_NORMALIZED(type)    GLINFO_LOCATION.glTypeLookup[type].normalized
> +#define WINED3D_ATR_TYPESIZE(type)      GLINFO_LOCATION.glTypeLookup[type].typesize

Unrelated to the actual patch, but I think it wouldn't hurt to get rid
of these macros. They're pretty much unnecessary.


From hverbeet at gmail.com  Thu Dec 20 03:02:27 2007
From: hverbeet at gmail.com (H. Verbeet)
Date: Thu, 20 Dec 2007 10:02:27 +0100
Subject: [patch 1/2,
	try 2] wined3d: rewrite IWineD3DSurfaceImpl_BltOverride colorfill
	codepath
In-Reply-To: <200712200248.41938.stefandoesinger@gmx.at>
References: <200712200248.41938.stefandoesinger@gmx.at>
Message-ID: <d658b69e0712200102o375f0d12u1e08fa151e77be7d@mail.gmail.com>

On 20/12/2007, Stefan D?singer <stefandoesinger at gmx.at> wrote:
> Hi Alexander,
>
> I had a look at your patches again, and another issue came to my mind: I am
> not sure how the scissor rectangle and viewport affects ColorFill blits.
> IDirect3DDevice::Clear is limited by the viewport, the scissor test and the
> rectangles passed in, but I think that this doesn't apply to ColorFills. If
> that is true, I think there isn't much point in having a common codepath, and
> we should just put the glClear() call into COLORFILL itself - Dealing with
> the differences of those two calls will be more effort than the code shared.
>
> But I think we need a test for this. There is a clear() test in
> dlls/ddraw/tests/visual.c, but the d3d9 test tests a few more things. It
> should be possible to add a COLORFILL test to the visual.c clear test in
> ddraw as well, this will show if Windows honors the scissor and viewport in
> COLORFILL or not.
>
> Yes, I know... Start fixing one bug, and you'll run into a lot more. Happens
> to me all the time as well :-)
>
> Stefan
>
Note that while IDirect3DDevice9 also has a ColorFill() method, it
uses either the ddraw implementation or the color_fill_fbo()
implementation. It's probably worth it to make sure that works as
well.


From rob at codeweavers.com  Thu Dec 20 03:39:53 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Thu, 20 Dec 2007 09:39:53 +0000
Subject: rpcrt4: Fix regression in NdrConformantStringUnmarshall by doing
	the memcpy check in safe_copy_from_buffer
In-Reply-To: <47699AA2.7070207@codeweavers.com>
References: <47699AA2.7070207@codeweavers.com>
Message-ID: <476A3869.1010505@codeweavers.com>

Maarten Lankhorst wrote:
> @@ -665,7 +665,8 @@ static inline void safe_copy_from_buffer(MIDL_STUB_MESSAGE *pStubMsg, void *p, U
>      if ((pStubMsg->Buffer + size < pStubMsg->Buffer) || /* integer overflow of pStubMsg->Buffer */
>          (pStubMsg->Buffer + size > pStubMsg->BufferEnd))
>          RpcRaiseException(RPC_X_BAD_STUB_DATA);
> -    memcpy(p, pStubMsg->Buffer, size);
> +    if (p != pStubMsg->Buffer)
> +        memcpy(p, pStubMsg->Buffer, size);
>      pStubMsg->Buffer += size;
>  }
>  
> @@ -890,8 +891,7 @@ unsigned char *WINAPI NdrConformantStringUnmarshall( PMIDL_STUB_MESSAGE pStubMsg
>        *ppMemory = NdrAllocate(pStubMsg, memsize);
>    }
>  
> -  if (*ppMemory != pStubMsg->Buffer)
> -    safe_copy_from_buffer(pStubMsg, *ppMemory, bufsize);
> +  safe_copy_from_buffer(pStubMsg, *ppMemory, bufsize);
>  
>    if (*pFormat == RPC_FC_C_CSTRING) {
>      TRACE("string=%s\n", debugstr_a((char*)*ppMemory));
>   

Good work in spotting and fixing the mistake I made, but I think I'd 
prefer to fix it by making the caller of safe_copy_from_buffer do the 
incrementing of the buffer. This is to avoid confusion with the name of 
the function and to avoid the possibility that the buffer is incremented 
twice.

-- 
Rob Shearman



From maarten at codeweavers.com  Thu Dec 20 04:42:50 2007
From: maarten at codeweavers.com (Maarten Lankhorst)
Date: Thu, 20 Dec 2007 11:42:50 +0100
Subject: rpcrt4: Fix regression in NdrConformantStringUnmarshall by doing
	the memcpy check in safe_copy_from_buffer
In-Reply-To: <476A3869.1010505@codeweavers.com>
References: <47699AA2.7070207@codeweavers.com>
	<476A3869.1010505@codeweavers.com>
Message-ID: <476A472A.10205@codeweavers.com>

Hi Rob,

Robert Shearman schreef:
> Maarten Lankhorst wrote:
>> @@ -665,7 +665,8 @@ static inline void
>> safe_copy_from_buffer(MIDL_STUB_MESSAGE *pStubMsg, void *p, U
>>      if ((pStubMsg->Buffer + size < pStubMsg->Buffer) || /* integer
>> overflow of pStubMsg->Buffer */
>>          (pStubMsg->Buffer + size > pStubMsg->BufferEnd))
>>          RpcRaiseException(RPC_X_BAD_STUB_DATA);
>> -    memcpy(p, pStubMsg->Buffer, size);
>> +    if (p != pStubMsg->Buffer)
>> +        memcpy(p, pStubMsg->Buffer, size);
>>      pStubMsg->Buffer += size;
>>  }
>>  
>> @@ -890,8 +891,7 @@ unsigned char *WINAPI
>> NdrConformantStringUnmarshall( PMIDL_STUB_MESSAGE pStubMsg
>>        *ppMemory = NdrAllocate(pStubMsg, memsize);
>>    }
>>  
>> -  if (*ppMemory != pStubMsg->Buffer)
>> -    safe_copy_from_buffer(pStubMsg, *ppMemory, bufsize);
>> +  safe_copy_from_buffer(pStubMsg, *ppMemory, bufsize);
>>  
>>    if (*pFormat == RPC_FC_C_CSTRING) {
>>      TRACE("string=%s\n", debugstr_a((char*)*ppMemory));
>>   
> Good work in spotting and fixing the mistake I made, but I think I'd
> prefer to fix it by making the caller of safe_copy_from_buffer do the
> incrementing of the buffer. This is to avoid confusion with the name
> of the function and to avoid the possibility that the buffer is
> incremented twice.
If you want to remove that, you might as well remove that whole inline,
since even when the two areas are equal the check that needs to be
performed at overflowing still needs to be done even if the areas are
the same.
Maybe just call it safely_append_from_buffer instead?

Cheers,
Maarten.


From dmitry at codeweavers.com  Thu Dec 20 05:00:35 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Thu, 20 Dec 2007 19:00:35 +0800
Subject: msi: Revert commit 96e4320feb22b3a2c9564de100c09990622edb59
References: <E1J5Ggg-0001fg-8c@mail.codeweavers.com>
	<e5b662840712200239i6033b24cl858f31b91fad468a@mail.gmail.com>
Message-ID: <004101c842f7$8dd63440$a600fea9@DMITRY>

Hi Miko?aj,

"Miko?aj Zalewski" <mikolaj.zalewski at gmail.com> wrote:

>  As I wrote in
> http://www.winehq.org/pipermail/wine-patches/2007-October/045479.html the
> problem was in the Photoshop CS2 installer where the groupbox consumed mouse
> events. They didn't arrive to the edit box (which was created earlier) what
> caused it to appear to be disabled. I checked that in that installer the
> groupbox had the BS_GROUPBOX style. Maybe that depends on some flags?

James already sent a more correct patch.

-- 
Dmitry. 



From julliard at winehq.org  Thu Dec 20 05:32:03 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 20 Dec 2007 12:32:03 +0100
Subject: kernel32: invalidate local copy of console input event handle
	while reallocating console.
In-Reply-To: <200712200003.52927.lich@math.spbu.ru> (Kirill K. Smirnov's
	message of "Thu, 20 Dec 2007 00:03:52 +0300")
References: <200712200003.52927.lich@math.spbu.ru>
Message-ID: <878x3py53g.fsf@wine.dyndns.org>

"Kirill K. Smirnov" <lich at math.spbu.ru> writes:

> @@ -378,10 +381,7 @@ BOOL WINAPI CloseConsoleHandle(HANDLE handle)
>   */
>  HANDLE WINAPI GetConsoleInputWaitHandle(void)
>  {
> -    static HANDLE console_wait_event;
> - 
> -    /* FIXME: this is not thread safe */
> -    if (!console_wait_event)
> +    if (console_wait_event == INVALID_HANDLE_VALUE)

0 and INVALID_HANDLE_VALUE are not the same thing. The correct value to
use for invalid events is 0.

-- 
Alexandre Julliard
julliard at winehq.org


From rob at codeweavers.com  Thu Dec 20 05:35:50 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Thu, 20 Dec 2007 11:35:50 +0000
Subject: rpcrt4: Fix regression in NdrConformantStringUnmarshall by doing
	the memcpy check in safe_copy_from_buffer
In-Reply-To: <476A472A.10205@codeweavers.com>
References: <47699AA2.7070207@codeweavers.com>
	<476A3869.1010505@codeweavers.com> <476A472A.10205@codeweavers.com>
Message-ID: <476A5396.2080409@codeweavers.com>

Maarten Lankhorst wrote:
> Hi Rob,
>
> Robert Shearman schreef:
>   
>> Maarten Lankhorst wrote:
>>     
>>> @@ -665,7 +665,8 @@ static inline void
>>> safe_copy_from_buffer(MIDL_STUB_MESSAGE *pStubMsg, void *p, U
>>>      if ((pStubMsg->Buffer + size < pStubMsg->Buffer) || /* integer
>>> overflow of pStubMsg->Buffer */
>>>          (pStubMsg->Buffer + size > pStubMsg->BufferEnd))
>>>          RpcRaiseException(RPC_X_BAD_STUB_DATA);
>>> -    memcpy(p, pStubMsg->Buffer, size);
>>> +    if (p != pStubMsg->Buffer)
>>> +        memcpy(p, pStubMsg->Buffer, size);
>>>      pStubMsg->Buffer += size;
>>>  }
>>>  
>>>       
>> Good work in spotting and fixing the mistake I made, but I think I'd
>> prefer to fix it by making the caller of safe_copy_from_buffer do the
>> incrementing of the buffer. This is to avoid confusion with the name
>> of the function and to avoid the possibility that the buffer is
>> incremented twice.
>>     
> If you want to remove that, you might as well remove that whole inline,
> since even when the two areas are equal the check that needs to be
> performed at overflowing still needs to be done even if the areas are
> the same.
>   

That's what safe_buffer_increment does.

-- 
Rob Shearman



From dmitry at codeweavers.com  Thu Dec 20 06:28:32 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Thu, 20 Dec 2007 20:28:32 +0800
Subject: try2:winefile:Save font settings for registry
References: <200712201515.32502.ivan@etersoft.ru>
Message-ID: <00b001c84303$d80ccea0$a600fea9@DMITRY>

"Ivan Sinitsin" <ivan at etersoft.ru> wrote:

> + if( RegQueryValueExW( hKey, reg_logfont, NULL, &type,
> +                              (LPBYTE) &logfont, &size ) != ERROR_SUCCESS ) {
> +  hFont=GetStockObject(DEFAULT_GUI_FONT);
> +  GetObject(hFont,sizeof(logfont),&logfont);
> +        }

There is no need to introduce the hFont variable.

> + GetObject(Globals.hfont, sizeof(logfont), &logfont);

To make the code more readable this call should be moved where logfont
is actually used.
 
> +        RegSetValueExW( hKey, reg_logfont, 0, REG_DWORD,
> +                        (LPBYTE) &logfont, sizeof(LOGFONT) );

The type should be set to REG_BINARY.

-- 
Dmitry.


From ivan at etersoft.ru  Thu Dec 20 06:57:15 2007
From: ivan at etersoft.ru (Ivan Sinitsin)
Date: Thu, 20 Dec 2007 15:57:15 +0300
Subject: try2:winefile:Save font settings for registry
In-Reply-To: <00b001c84303$d80ccea0$a600fea9@DMITRY>
References: <200712201515.32502.ivan@etersoft.ru>
	<00b001c84303$d80ccea0$a600fea9@DMITRY>
Message-ID: <200712201557.15752.ivan@etersoft.ru>

? ????????? ?? Thursday 20 December 2007 15:28:32 ?? ????????:
> "Ivan Sinitsin" <ivan at etersoft.ru> wrote:
> > + if( RegQueryValueExW( hKey, reg_logfont, NULL, &type,
> > +                              (LPBYTE) &logfont, &size ) !=
> > ERROR_SUCCESS ) { +  hFont=GetStockObject(DEFAULT_GUI_FONT);
> > +  GetObject(hFont,sizeof(logfont),&logfont);
> > +        }
>
> There is no need to introduce the hFont variable.
>
> > + GetObject(Globals.hfont, sizeof(logfont), &logfont);
>
> To make the code more readable this call should be moved where logfont
> is actually used.
>
> > +        RegSetValueExW( hKey, reg_logfont, 0, REG_DWORD,
> > +                        (LPBYTE) &logfont, sizeof(LOGFONT) );
>
> The type should be set to REG_BINARY.

I have corrected the mistakes.
Do I understand you right?

----------------------
Sinitsin Ivan
-------------- next part --------------
A non-text attachment was scrubbed...
Name: programs-winefile.c.patch
Type: text/x-diff
Size: 2245 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071220/617e624d/attachment-0001.patch 

From dmitry at codeweavers.com  Thu Dec 20 07:03:26 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Thu, 20 Dec 2007 21:03:26 +0800
Subject: try2:winefile:Save font settings for registry
References: <200712201515.32502.ivan@etersoft.ru>
	<00b001c84303$d80ccea0$a600fea9@DMITRY>
	<200712201557.15752.ivan@etersoft.ru>
Message-ID: <015e01c84308$b72fed70$a600fea9@DMITRY>

"Ivan Sinitsin" <ivan at etersoft.ru> wrote:

> I have corrected the mistakes.
> Do I understand you right?

Yes, attached patch looks good for me.

-- 
Dmitry.


From thunder.m at email.cz  Thu Dec 20 08:33:03 2007
From: thunder.m at email.cz (=?UTF-8?B?TWlyZWsgU2x1Z2XFiA==?=)
Date: Thu, 20 Dec 2007 15:33:03 +0100
Subject: Wine Direct3D progress
In-Reply-To: <469F781B.6000908@codeweavers.com>
References: <200706251540.42192.stefan@codeweavers.com>	<200706252035.49045.stefan@codeweavers.com>	<468CE86D.70307@codeweavers.com>	<200707051538.21830.stefan@codeweavers.com>
	<469F781B.6000908@codeweavers.com>
Message-ID: <476A7D1F.1050103@email.cz>

An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20071220/c500edfd/attachment.htm 

From hverbeet at gmail.com  Thu Dec 20 08:58:05 2007
From: hverbeet at gmail.com (H. Verbeet)
Date: Thu, 20 Dec 2007 15:58:05 +0100
Subject: Wine Direct3D progress
In-Reply-To: <476A7D1F.1050103@email.cz>
References: <200706251540.42192.stefan@codeweavers.com>
	<200706252035.49045.stefan@codeweavers.com>
	<468CE86D.70307@codeweavers.com>
	<200707051538.21830.stefan@codeweavers.com>
	<469F781B.6000908@codeweavers.com> <476A7D1F.1050103@email.cz>
Message-ID: <d658b69e0712200658y630b00ak2b3527ae7e35c631@mail.gmail.com>

On 20/12/2007, Mirek Sluge? <thunder.m at email.cz> wrote:
>  OLD CONFIGURATION:
>  Configuration: Core 2 Duo E6400 at 3200MHz, 2GB RAM, GF 6800 GS
>  Options in wine registry: GLSL, FBO, VideoMemorySize 256, PS, VS,
> SoftwareEmulation
>  Patches: 3DMark hack
>
>  ACTUAL CONFIGURATION (bold results):
>  Configuration: Core 2 Duo E6400 at 3200MHz, 2GB RAM, GF 7900 GT (nvidia
> 169.04)
>  Options in wine registry: GLSL, FBO, VideoMemorySize 256, PS, VS,
> SoftwareEmulation
>  Patches: 3DMark hack, small gothic patch, wined3d: rewrite
> IWineD3DSurfaceImpl_BltOverride colorfill codepath, wined3d: use
> IWineD3DDeviceImpl_ClearSurface in IWineD3DDeviceImpl_Clear
>
Changing the graphics card skews the results a bit :-/
Unfortunately it's pretty hard to say how much of an impact that has per test.

From frick at sc-networks.de  Thu Dec 20 09:45:11 2007
From: frick at sc-networks.de (Christoph Frick)
Date: Thu, 20 Dec 2007 16:45:11 +0100
Subject: Wine Direct3D progress
In-Reply-To: <d658b69e0712200658y630b00ak2b3527ae7e35c631@mail.gmail.com>
References: <200706251540.42192.stefan@codeweavers.com>
	<200706252035.49045.stefan@codeweavers.com>
	<468CE86D.70307@codeweavers.com>
	<200707051538.21830.stefan@codeweavers.com>
	<469F781B.6000908@codeweavers.com> <476A7D1F.1050103@email.cz>
	<d658b69e0712200658y630b00ak2b3527ae7e35c631@mail.gmail.com>
Message-ID: <20071220154511.GA8286@byleth.sc-networks.de>

On Thu, Dec 20, 2007 at 03:58:05PM +0100, H. Verbeet wrote:

> >  OLD CONFIGURATION:
> >  Configuration: Core 2 Duo E6400 at 3200MHz, 2GB RAM, GF 6800 GS
> >  Options in wine registry: GLSL, FBO, VideoMemorySize 256, PS, VS,
> > SoftwareEmulation
> >  Patches: 3DMark hack
> >
> >  ACTUAL CONFIGURATION (bold results):
> >  Configuration: Core 2 Duo E6400 at 3200MHz, 2GB RAM, GF 7900 GT (nvidia
> > 169.04)
> >  Options in wine registry: GLSL, FBO, VideoMemorySize 256, PS, VS,
> > SoftwareEmulation
> >  Patches: 3DMark hack, small gothic patch, wined3d: rewrite
> > IWineD3DSurfaceImpl_BltOverride colorfill codepath, wined3d: use
> > IWineD3DDeviceImpl_ClearSurface in IWineD3DDeviceImpl_Clear
> >
> Changing the graphics card skews the results a bit :-/
> Unfortunately it's pretty hard to say how much of an impact that has per test.

and changing drivers (assumption) and the patches won't help either.

-- 
cu
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 163 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071220/02745ecb/attachment.pgp 

From rob at codeweavers.com  Thu Dec 20 10:57:27 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Thu, 20 Dec 2007 16:57:27 +0000
Subject: kernel32: Remove unneeded casts
In-Reply-To: <200712182247.56265.andrew.talbot@talbotville.com>
References: <200712182247.56265.andrew.talbot@talbotville.com>
Message-ID: <476A9EF7.5060905@codeweavers.com>

Andrew Talbot wrote:
>    /* All local heap allocations are aligned on 4-byte boundaries */
>  #define LALIGN(word)          (((word) + 3) & ~3)
>  
> -#define ARENA_PTR(ptr,arena)       ((LOCALARENA *)((char*)(ptr)+(arena)))
> +#define ARENA_PTR(ptr,arena)       ((LOCALARENA *)((ptr)+(arena)))

Don't remove casts from macros like this as they then won't be safe if 
the type that is passed in is changed to something else (like void *).

-- 
Rob Shearman



From nagarjunabandi at yahoo.co.in  Thu Dec 20 00:42:57 2007
From: nagarjunabandi at yahoo.co.in (Nagarjuna Bandi)
Date: Thu, 20 Dec 2007 06:42:57 +0000 (GMT)
Subject: Problem with winelib
Message-ID: <381477.23548.qm@web94505.mail.in2.yahoo.com>

      Dear Wine Developers Team,
 
     I am using the wine for porting windows applications under linux. This is a very powerful tool for doing this job thank you very much for providing us a such tool.
 
     Here i am getting problem with winelib when i trying to build the notepad application with the given guidelines in winelib user guide i had made the changes to Makefile you are specifying but i got another error msg like
 
 [nagarjunab at ibi212 notepad2]$ vim Makefile
 [nagarjunab at ibi212 notepad2]$ make
 wrc   -I.   -forsrc.res rsrc.rc
 winegcc -mwindows -mno-cygwin -o notepad2.exe.so dialog.o main.o  rsrc.res     -lodbc32 -lole32 -loleaut32 -lwinspool -luuid
 dialog.o(.text+0x1a5): In function `DIALOG_StringMsgBox':
 : undefined reference to `wnsprintfW'
 collect2: ld returned 1 exit status
 winegcc: gcc failed.
 make: *** [notepad2.exe.so] Error 2
 
 
      This is the error i am getting so please let me know what is the problem and what i have to do for avoiding this problem.
 
      I am expecting a fast response from you.
 
 Thanks in advance.
 
 
     
---------------------------------
 
 Regards,
 
 Nagarjuna Bandi ,
Infobrain Technologies Pvt. Ltd. | My Home Sarovar Plaza | Hyderabad |
 India.          
       
---------------------------------
 Explore your hobbies and interests. Click here to begin.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20071220/d807a274/attachment.htm 

From mikolaj.zalewski at gmail.com  Thu Dec 20 04:39:43 2007
From: mikolaj.zalewski at gmail.com (=?ISO-8859-2?Q?Miko=B3aj_Zalewski?=)
Date: Thu, 20 Dec 2007 11:39:43 +0100
Subject: msi: Revert commit 96e4320feb22b3a2c9564de100c09990622edb59
In-Reply-To: <E1J5Ggg-0001fg-8c@mail.codeweavers.com>
References: <E1J5Ggg-0001fg-8c@mail.codeweavers.com>
Message-ID: <e5b662840712200239i6033b24cl858f31b91fad468a@mail.gmail.com>

>
> I have no idea what Mikolaj tried to fix with this patch but


  As I wrote in
http://www.winehq.org/pipermail/wine-patches/2007-October/045479.html the
problem was in the Photoshop CS2 installer where the groupbox consumed mouse
events. They didn't arrive to the edit box (which was created earlier) what
caused it to appear to be disabled. I checked that in that installer the
groupbox had the BS_GROUPBOX style. Maybe that depends on some flags?

Miko?aj Zalewski
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20071220/46a6fbf2/attachment.htm 

From juan.lang at gmail.com  Thu Dec 20 12:16:25 2007
From: juan.lang at gmail.com (Juan Lang)
Date: Thu, 20 Dec 2007 10:16:25 -0800
Subject: Problem with winelib
In-Reply-To: <381477.23548.qm@web94505.mail.in2.yahoo.com>
References: <381477.23548.qm@web94505.mail.in2.yahoo.com>
Message-ID: <3a768c550712201016v65e74847j5cbce309b0a288e@mail.gmail.com>

Hi Nagarjuna,

>  dialog.o(.text+0x1a5): In function `DIALOG_StringMsgBox':
>  : undefined reference to `wnsprintfW'

That looks like a typo to me.  It should just be wnsprintf.
--Juan


From winehacker at gmail.com  Thu Dec 20 12:23:39 2007
From: winehacker at gmail.com (Steven Edwards)
Date: Thu, 20 Dec 2007 13:23:39 -0500
Subject: Problem with winelib
In-Reply-To: <381477.23548.qm@web94505.mail.in2.yahoo.com>
References: <381477.23548.qm@web94505.mail.in2.yahoo.com>
Message-ID: <19e31a080712201023o6dcd537cocf3e3c11742e1c62@mail.gmail.com>

On Dec 20, 2007 1:42 AM, Nagarjuna Bandi <nagarjunabandi at yahoo.co.in> wrote:
>      Here i am getting problem with winelib when i trying to build the
> notepad application with the given guidelines in winelib user guide i had
> made the changes to Makefile you are specifying but i got another error msg
> like
>       This is the error i am getting so please let me know what is the
> problem and what i have to do for avoiding this problem.
>
>       I am expecting a fast response from you.

Also keep in mind that unless you need to directly call a native linux
api, doing a winelib port does not gain you anything over just running
the stock windows binary.

Thanks
-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From rob at codeweavers.com  Thu Dec 20 13:16:27 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Thu, 20 Dec 2007 19:16:27 +0000
Subject: ole32: Fix a failed call to DllGetClassObject while retrieving
	class	object interface pointer.
In-Reply-To: <b4cc5a3d0712200653t738a43c4rcbd00ff8e779e128@mail.gmail.com>
References: <b4cc5a3d0712200653t738a43c4rcbd00ff8e779e128@mail.gmail.com>
Message-ID: <476ABF8B.1080509@codeweavers.com>

Huang, Zhangrong wrote:
> See dlls/ole32/compobj.c,
>
> static HRESULT apartment_getclassobject(struct apartment *apt, LPCWSTR dllpath,
>                                         BOOL apartment_threaded,
>                                         REFCLSID rclsid, REFIID riid,
> void **ppv)
> {
> ...................
>     if (SUCCEEDED(hr))
>     {
> ..................
>         TRACE("calling DllGetClassObject %p\n",
> apartment_loaded_dll->dll->DllGetClassObject);
>         /* OK: get the ClassObject */
>         hr = apartment_loaded_dll->dll->DllGetClassObject(rclsid, riid, ppv);
>                                                                   ^^^^
>         if (hr != S_OK)
>             ERR("DllGetClassObject returned error 0x%08x\n", hr);
>     }
> ..............
> }
>
> Reference to http://msdn2.microsoft.com/en-us/library/ms680760.aspx,
>
> riid
>
>     [in] Reference to the identifier of the interface that the caller
>     is to use to communicate with the class object. Usually, this is
>     IID_IClassFactory (defined in the OLE headers as the interface
>     identifier for IClassFactory).
>   

This doesn't mean anything other than CoCreateInstance is usually used 
instead of CoGetClassObject (and CoCreateInstance always passes in 
IID_IClassFactory for the IID).

> We can't pass riid to DllGetClassObject directly sometimes, causes some dlls'
> DllGetClassObject (like native adsldp.dll) can only return reference-counted
> pointer to class factory via IID_IClassFactory, for retrieving the
> pointer to the
> class object interface requested in riid, we must try another way.
>   

Thank you for your patch, but this behaviour seems a little strange and 
needs a little more investigation before I am happy that it is correct. 
What parameters are being passed in to CoGetClassObject to cause the 
call to fail for you?

-- 
Rob Shearman



From r.kalbermatter at hccnet.nl  Thu Dec 20 13:29:08 2007
From: r.kalbermatter at hccnet.nl (Rolf Kalbermatter)
Date: Thu, 20 Dec 2007 20:29:08 +0100
Subject: kernel32: Remove unneeded casts
In-Reply-To: <476A9EF7.5060905@codeweavers.com>
References: <200712182247.56265.andrew.talbot@talbotville.com>
	<476A9EF7.5060905@codeweavers.com>
Message-ID: <007c01c8433e$97ba2010$4001a8c0@NATERS>

Robert Shearman wrote:

> Andrew Talbot wrote:
> >    /* All local heap allocations are aligned on 4-byte boundaries */
> >  #define LALIGN(word)          (((word) + 3) & ~3)
> >  
> > -#define ARENA_PTR(ptr,arena)       ((LOCALARENA
*)((char*)(ptr)+(arena)))
> > +#define ARENA_PTR(ptr,arena)       ((LOCALARENA *)((ptr)+(arena)))
> 
> Don't remove casts from macros like this as they then won't 
> be safe if the type that is passed in is changed to something 
> else (like void *).

I think this would give a compile error but more fatal could be if someone
happens to pass in a variable that was declared like

long *ptr;

Then the offset calculation would be all wrong.

Rolf Kalbermatter




From stefandoesinger at gmx.at  Thu Dec 20 13:45:05 2007
From: stefandoesinger at gmx.at (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Thu, 20 Dec 2007 20:45:05 +0100
Subject: Wine Direct3D progress
In-Reply-To: <20071220154511.GA8286@byleth.sc-networks.de>
References: <200706251540.42192.stefan@codeweavers.com>
	<d658b69e0712200658y630b00ak2b3527ae7e35c631@mail.gmail.com>
	<20071220154511.GA8286@byleth.sc-networks.de>
Message-ID: <200712202045.05115.stefandoesinger@gmx.at>

Am Donnerstag, 20. Dezember 2007 16:45:11 schrieb Christoph Frick:
> > Changing the graphics card skews the results a bit :-/
> > Unfortunately it's pretty hard to say how much of an impact that has per
> > test.
>
> and changing drivers (assumption) and the patches won't help either.
Yeah, the different hardware setup limits the usefulness of the results. It 
would be really interesting to see this comparison with the same hardware and 
driver :-)

On a related note, it would be really cool if people could help with writing 
cxtest(www.cxtest.org) scripts for the various apps. This will allow 
automated performance testing and automated one-click regression testing if 
problems occur. I have once written such benchmarks for ut2004, half life 2 
and 3dmark2000, but more are definitly welcome. My time is too limited to 
take care of all this, so our D3D QA still relies on user testing for the 
most part.


From kuba at mareimbrium.org  Thu Dec 20 14:31:12 2007
From: kuba at mareimbrium.org (Kuba Ober)
Date: Thu, 20 Dec 2007 15:31:12 -0500
Subject: dll to .so wrapper
In-Reply-To: <1198105044.6283.13.camel@nebba.config>
References: <476827B3.1060006@gmail.com> <47698C8E.8050605@codeweavers.com>
	<1198105044.6283.13.camel@nebba.config>
Message-ID: <200712201531.13157.kuba@mareimbrium.org>

On Wednesday 19 December 2007, bridd wrote:
> On Wed, 2007-12-19 at 22:26 +0100, Maarten Lankhorst wrote:
> > This topic comes up from time to time, usually with mild variations. The
> > problem is that wine sets up its own environment and memory layout. In
> > the end you will need a .exe (or winelib binary) that uses wine, and a
> > socket/pipe/shm function to communicate with the .so, there is no easy
> > way to just  dynamically load a dll in an existing program.
>
> I see, so it's sounding like to do this I'd need to have something more
> akin to a VST host, that acts as an intermediatory and pumps the video
> data from the linux application via a native plugin (.so), into a
> winelib compiled program that executes the windows compiled plugin
> (.dll) and the sends it back out again.
>
> Probably beyond my skills right now, but thought it was worth seeing if
> anyone had trodden a similar route already!

Should be doable via shm, i.e. without overhead - you can share your 
framebuffer (or a few) between applications that way. Remember that you can 
do linux syscalls from a PE (windows) executable that runs under Wine.

Cheers, Kuba


From r.kalbermatter at hccnet.nl  Thu Dec 20 15:58:15 2007
From: r.kalbermatter at hccnet.nl (Rolf Kalbermatter)
Date: Thu, 20 Dec 2007 22:58:15 +0100
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <4769BE7B.7010204@gmx.net>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>		<4767EA9F.2030109@gmx.net>	<78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com><47681D77.8080007@gmx.net>
	<4769BE7B.7010204@gmx.net>
Message-ID: <000001c84353$6c60aa00$4001a8c0@NATERS>

Peter Beutner wrote:

>just tested again with current git and it worked with every gcc version
>I had at hand here: 4.2.2, 4.1.2, 4.0.4 and 3.4.6.

And what did you test there? As far as I understood the issue, it's not that
Wine won't work at all (at least for most of those gcc versions). Those gcc
version will only emit much more code that modern copy protection schemes
(Safe Disc, Secu Rom) with statistical code analysis will see as possible
attempts to counterfeit them and consequently prevent starting applications
protected by them.

As long as you do not want to run copy protected applications under Wine
most of those gcc versions should just work fine.

Rolf Kalbermatter



From andrewriedi at gmail.com  Thu Dec 20 19:09:13 2007
From: andrewriedi at gmail.com (Andrew Riedi)
Date: Thu, 20 Dec 2007 17:09:13 -0800
Subject: The #winehq Wine channel
Message-ID: <689de9370712201709l1ff1693aje0db83ed1937378e@mail.gmail.com>

There are two main issues I would like to address.

1) Normally the current #winehq OPs to a great job, but they are only human
and only have so many waking hours.  I noticed recently that it took a
little longer than normal for #winehq's topic to be updated to the latest
release.  I would like to ask for some basic OP rights to update the topic
when the regular OPs are unable to, due to real life.  Who is in charge of
this sort of thing?

2) Rules.  Should we provide a set of rules for #winehq use?  For general
Wine-based channel use?  (#winehq, #winehq-social, #winehackers,
#crossover)  Perhaps state when people deserve a kick, the purposes of each
channel, etc.  Maybe we should start a wiki page with the information,
rules, etc.?

-- 
Andrew Riedi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20071220/29e449bc/attachment.htm 

From p.beutner at gmx.net  Thu Dec 20 20:11:09 2007
From: p.beutner at gmx.net (Peter Beutner)
Date: Fri, 21 Dec 2007 03:11:09 +0100
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <000001c84353$6c60aa00$4001a8c0@NATERS>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>		<4767EA9F.2030109@gmx.net>	<78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com><47681D77.8080007@gmx.net>	<4769BE7B.7010204@gmx.net>
	<000001c84353$6c60aa00$4001a8c0@NATERS>
Message-ID: <476B20BD.4030600@gmx.net>

Rolf Kalbermatter schrieb:
> Peter Beutner wrote:
> 
>> just tested again with current git and it worked with every gcc version
>> I had at hand here: 4.2.2, 4.1.2, 4.0.4 and 3.4.6.
> 
> And what did you test there? 

That safedisc 2.x works. Wine successfully passes the statistical code analysis.
And that also with gcc versions that reportedly caused problems on earlier wine
versions. So other people might want to recheck as well with whatever compiler
they are using.

> As far as I understood the issue, it's not that
> Wine won't work at all (at least for most of those gcc versions). Those gcc
> version will only emit much more code that modern copy protection schemes
> (Safe Disc, Secu Rom) with statistical code analysis will see as possible
> attempts to counterfeit them and consequently prevent starting applications
> protected by them.

yes, but also changes at the source code level can change the results of that
analysis. There were some specific changes for that between .48 and .49 that
drastically improved the situation. Unless you were using certain "broken"
gcc versions (broken is a bit too harsh, the main problem is after all only
that the function prolog sequence is ordered a bit differently).

Now some changes seems to have improved the situation even further, so that
even with those little differences between different gcc versions it
stays below the threshold where the safedisc analyzer would start complaining.

> As long as you do not want to run copy protected applications under Wine
> most of those gcc versions should just work fine.

sry, for not being more specific. I thought the context was clear as this whole
discussion was only about copy protection vs. different gcc versions.

btw., because you said "most of those gcc versions", is there a gcc version that
is known to not work with wine (beside these copy protection issues)?


From dmitry at codeweavers.com  Thu Dec 20 21:31:29 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 21 Dec 2007 11:31:29 +0800
Subject: Problem with winelib
References: <381477.23548.qm@web94505.mail.in2.yahoo.com>
	<3a768c550712201016v65e74847j5cbce309b0a288e@mail.gmail.com>
Message-ID: <004901c84381$fb4a6ca0$a600fea9@DMITRY>

"Juan Lang" <juan.lang at gmail.com> wrote:

>>  dialog.o(.text+0x1a5): In function `DIALOG_StringMsgBox':
>>  : undefined reference to `wnsprintfW'
> 
> That looks like a typo to me.  It should just be wnsprintf.

That's not a typo, just a missing shlwapi import in the Makefile.

-- 
Dmitry.


From austinenglish at gmail.com  Thu Dec 20 22:03:09 2007
From: austinenglish at gmail.com (Austin English)
Date: Thu, 20 Dec 2007 22:03:09 -0600
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <476B20BD.4030600@gmx.net>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>
	<4767EA9F.2030109@gmx.net>
	<78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com>
	<47681D77.8080007@gmx.net> <4769BE7B.7010204@gmx.net>
	<000001c84353$6c60aa00$4001a8c0@NATERS> <476B20BD.4030600@gmx.net>
Message-ID: <b6bb06270712202003s5a9b231ftf70621cf953720f5@mail.gmail.com>

Another factor to consider is that individual distributions may work
while others do not. Vanilla gcc may work, but after Ubuntu/Suse/etc
apply their patches, this may not be the case.

-Austin

On Dec 20, 2007 8:11 PM, Peter Beutner <p.beutner at gmx.net> wrote:
> Rolf Kalbermatter schrieb:
> > Peter Beutner wrote:
> >
> >> just tested again with current git and it worked with every gcc version
> >> I had at hand here: 4.2.2, 4.1.2, 4.0.4 and 3.4.6.
> >
> > And what did you test there?
>
> That safedisc 2.x works. Wine successfully passes the statistical code analysis.
> And that also with gcc versions that reportedly caused problems on earlier wine
> versions. So other people might want to recheck as well with whatever compiler
> they are using.
>
> > As far as I understood the issue, it's not that
> > Wine won't work at all (at least for most of those gcc versions). Those gcc
> > version will only emit much more code that modern copy protection schemes
> > (Safe Disc, Secu Rom) with statistical code analysis will see as possible
> > attempts to counterfeit them and consequently prevent starting applications
> > protected by them.
>
> yes, but also changes at the source code level can change the results of that
> analysis. There were some specific changes for that between .48 and .49 that
> drastically improved the situation. Unless you were using certain "broken"
> gcc versions (broken is a bit too harsh, the main problem is after all only
> that the function prolog sequence is ordered a bit differently).
>
> Now some changes seems to have improved the situation even further, so that
> even with those little differences between different gcc versions it
> stays below the threshold where the safedisc analyzer would start complaining.
>
> > As long as you do not want to run copy protected applications under Wine
> > most of those gcc versions should just work fine.
>
> sry, for not being more specific. I thought the context was clear as this whole
> discussion was only about copy protection vs. different gcc versions.
>
> btw., because you said "most of those gcc versions", is there a gcc version that
> is known to not work with wine (beside these copy protection issues)?
>
>
>


From zac at zacbrown.org  Thu Dec 20 22:18:10 2007
From: zac at zacbrown.org (Zac Brown)
Date: Thu, 20 Dec 2007 22:18:10 -0600
Subject: advapi32: Fix domain length setting in LookupAccountNameW
In-Reply-To: <476B3828.2000503@zacbrown.org>
References: <476B3828.2000503@zacbrown.org>
Message-ID: <476B3E82.7000909@zacbrown.org>

Zac Brown wrote:
> Hi,
> 
> Changelog:
> * Fix value setting for *cchReferencedDomainName in LookupAccountNameW
> * Fix LookupAccountNameA conversion from WCHAR to CHAR by setting proper '\0'
> 
> Notes:
> * This patch addresses bug 10612
> 
> -Zac Brown
> 
> 
> ------------------------------------------------------------------------
> 
> 

Ignore this patch, it has stupid mistakes in it. Will send a second one thats correct.

-Zac


From dmitry at codeweavers.com  Thu Dec 20 22:34:34 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 21 Dec 2007 12:34:34 +0800
Subject: mapi32: Resolve FIXME regarding attachment lists in
	MAPISendMailfunction
References: <476AF853.2070704@legis.state.ak.us>
Message-ID: <012201c8438a$cb27a520$a600fea9@DMITRY>

"Mark Neyhart" <Mark_Neyhart at legis.state.ak.us> wrote:

> diff --git a/dlls/mapi32/sendmail.c b/dlls/mapi32/sendmail.c
> old mode 100644
> new mode 100755

Please fix file permissions before submitting patches.

-- 
Dmitry.


From dmitry at codeweavers.com  Thu Dec 20 22:40:03 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 21 Dec 2007 12:40:03 +0800
Subject: user32: add stub for GetLayeredWindowAttributes
References: <799143.37491.qm@web23202.mail.ird.yahoo.com>
Message-ID: <015101c8438b$8fd141b0$a600fea9@DMITRY>

"Louis. Lenders" <xerox_xerox2000 at yahoo.co.uk> wrote:

> +BOOL WINAPI GetLayeredWindowAttributes( HWND hWnd,COLORREF* prgbKey,
> +                                        BYTE* pbAlpha, DWORD* pdwFlags )
> +{
> +    FIXME("(%p,0x%.8x,%d,%d): stub!\n", hWnd, *prgbKey, *pbAlpha, *pdwFlags);
> +    return TRUE;
> +}

Probably a better idea would be to return FALSE, otherwise you have to initialize
all the requested data.

-- 
Dmitry.


From actong88 at gmail.com  Thu Dec 20 22:48:35 2007
From: actong88 at gmail.com (Allan Tong)
Date: Thu, 20 Dec 2007 23:48:35 -0500
Subject: [1/4 try 3] wined3d: Activate GL context before making any GL calls
	in stretch_rect_fbo
Message-ID: <d75158870712202048m5f39effet732de468590c90f6@mail.gmail.com>

Third try, this time without the incomplete FBO error in the ddraw
tests.  With this set of patches, all D3D tests should pass with FBO
offscreen rendering.

 - Allan
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-wined3d-Activate-GL-context-before-making-any-GL-ca.patch
Type: text/x-patch
Size: 3322 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071220/5bc25317/attachment.bin 

From twickline at gmail.com  Thu Dec 20 23:52:12 2007
From: twickline at gmail.com (Tom Wickline)
Date: Fri, 21 Dec 2007 00:52:12 -0500
Subject: Wine Direct3D progress
In-Reply-To: <476A7D1F.1050103@email.cz>
References: <200706251540.42192.stefan@codeweavers.com>
	<200706252035.49045.stefan@codeweavers.com>
	<468CE86D.70307@codeweavers.com>
	<200707051538.21830.stefan@codeweavers.com>
	<469F781B.6000908@codeweavers.com> <476A7D1F.1050103@email.cz>
Message-ID: <53e3a9930712202152q5b3ec85fva24f10a9a9b4fde7@mail.gmail.com>

On Dec 20, 2007 9:33 AM, Mirek Sluge? <thunder.m at email.cz> wrote:
>
>
>  3DMark 2006
>  game tests: 768/126/1149 points
>  game 1: 5.2/1.2/9.3 fps
>  game 2: 7.6/0.9/9.7 fps
>  hdr game tests: 298/167/1022 points
>  game 1: 1.976/1.4/8.8 fps
>  game 2: 3.989/1.9/11.6 fps
>  cpu tests: 2412/2426/2665 points
>  game 1: 0.782/0.794/0.855 fps
>  game 2: 1.190/1.186/1.329 fps
>
>
>  Mirek Slugen
>

I ran 3DMark06 just now and got a score of 3464

Some System Specs:
Quad Core 2.4Ghz,  8GB RAM,  1.2TB HD Space,
640MB 8800GTS, Gentoo Linux

SM2.0 = 1662
HDR SM3 = 880
CPU = 2841

http://img409.imageshack.us/img409/7809/screenshotwinedesktop2oy0.png
http://img516.imageshack.us/img516/3826/screenshotwinedesktop3vu1.png
http://img521.imageshack.us/img521/252/screenshotwinedesktop4xo2.png

Tom

From madewokherd+d41d at gmail.com  Fri Dec 21 01:03:19 2007
From: madewokherd+d41d at gmail.com (Vincent Povirk)
Date: Fri, 21 Dec 2007 02:03:19 -0500
Subject: Wine desktop integration: double-clicking files in file managers
Message-ID: <ced95fe0712202303j71cb4d7bw653e340b7d598415@mail.gmail.com>

I have attached a patch that adds a wrapper script to Wine for
starting files from Linux file managers such as nautilus and modifies
wine.desktop to use the script for exe, msi, lnk, chm, and hlp files.

The wrapper sets the working directory to the directory containing the
file and starts it using wine start with the full windows path. If
wine start fails, it displays an error dialog. As I understand it,
this is very close to the behavior when double-clicking a file in
windows explorer.

Please comment.


These issues worry me in particular:

I cannot double-click on exe files to open them myself because of
http://bugs.winehq.org/show_bug.cgi?id=8386 (nautilus is getting
confused about file types). As I understand it, this is a separate
problem (and should be fixed?), but I wonder if I can do anything
about it.

Nautilus is not using Wine to start hlp files. I put in every mime
type I could come up with for hlp, including
application/x-extension-hlp.

Wine does not show in the "Open With" list in nautilus. This makes the
wrapper a little bit harder to use for applications installed in wine
to handle specific filetypes.

Is the list of file extensions I decided to use reasonable?

Is the list of MIME types I decided to use for those extensions
reasonable? Is there some way Wine could help the system recognize
some of these types? I don't know much about this topic,
unfortunately, and I'm not very confident about my list.

I cannot test the kdialog command in the script myself because kdialog
consistently fails to display things here.

-- 
Vincent Povirk
-------------- next part --------------
A non-text attachment was scrubbed...
Name: winestartfile.patch
Type: text/x-patch
Size: 3762 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071221/ad4937bc/attachment.bin 

From twickline at gmail.com  Fri Dec 21 02:50:28 2007
From: twickline at gmail.com (Tom Wickline)
Date: Fri, 21 Dec 2007 03:50:28 -0500
Subject: Wine Direct3D progress
In-Reply-To: <53e3a9930712202152q5b3ec85fva24f10a9a9b4fde7@mail.gmail.com>
References: <200706251540.42192.stefan@codeweavers.com>
	<200706252035.49045.stefan@codeweavers.com>
	<468CE86D.70307@codeweavers.com>
	<200707051538.21830.stefan@codeweavers.com>
	<469F781B.6000908@codeweavers.com> <476A7D1F.1050103@email.cz>
	<53e3a9930712202152q5b3ec85fva24f10a9a9b4fde7@mail.gmail.com>
Message-ID: <53e3a9930712210050x3979613bo1d2759b16cfdcf71@mail.gmail.com>

On Dec 21, 2007 12:52 AM, Tom Wickline <twickline at gmail.com> wrote:

> 640MB 8800GTS, Gentoo Linux
>

That should say 8800GTX

>
> Tom
>


From adamrimon at gmail.com  Fri Dec 21 03:01:28 2007
From: adamrimon at gmail.com (Adam Rimon)
Date: Fri, 21 Dec 2007 11:01:28 +0200
Subject: winex11.drv: driver.c: GET_USER_FUNC
Message-ID: <476B80E8.1060008@gmail.com>

Hi,

Is there any reason for the /do { ...... } while(0);/ in the 
GET_USER_FUNC macro?

-Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20071221/d56f4159/attachment.htm 

From rob at codeweavers.com  Fri Dec 21 03:39:02 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Fri, 21 Dec 2007 09:39:02 +0000
Subject: winex11.drv: driver.c: GET_USER_FUNC
In-Reply-To: <476B80E8.1060008@gmail.com>
References: <476B80E8.1060008@gmail.com>
Message-ID: <476B89B6.1040505@codeweavers.com>

Adam Rimon wrote:
> Is there any reason for the /do { ...... } while(0);/ in the 
> GET_USER_FUNC macro?

It's a standard way of making sure that the macro is safe if you put it 
after an if statement or similar without opening a new block.

-- 
Rob Shearman



From hans at it.vu.nl  Fri Dec 21 04:36:25 2007
From: hans at it.vu.nl (Hans Leidekker)
Date: Fri, 21 Dec 2007 11:36:25 +0100
Subject: mapi32: Resolve FIXME regarding attachment lists in MAPISendMail
	function
In-Reply-To: <476AF853.2070704@legis.state.ak.us>
References: <476AF853.2070704@legis.state.ak.us>
Message-ID: <200712211136.25562.hans@it.vu.nl>

On Friday 21 December 2007 00:18:43 Mark Neyhart wrote:

> Extend the MAILTO: string produced by the MAPISendMail function to include
> an attachment list. Because I was unable to find any standard for MAILTO
> regarding attachments, I constructed the attachment list in the format
> specified for Mozilla command line options.

Breaking other mail clients to gain attachments support for Mozilla is not
acceptable tradeoff IMO.

 -Hans


From rolf.kalbermatter at citeng.com  Fri Dec 21 01:37:53 2007
From: rolf.kalbermatter at citeng.com (Rolf Kalbermatter)
Date: Fri, 21 Dec 2007 08:37:53 +0100
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <476B20BD.4030600@gmx.net>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>		<4767EA9F.2030109@gmx.net>	<78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com><47681D77.8080007@gmx.net>	<4769BE7B.7010204@gmx.net>
	<000001c84353$6c60aa00$4001a8c0@NATERS> <476B20BD.4030600@gmx.net>
Message-ID: <006f01c843a4$652ffb40$4001a8c0@NATERS>

Peter Beutner wrote:

> btw., because you said "most of those gcc versions", is there 
> a gcc version that is known to not work with wine (beside 
> these copy protection issues)?

I couldn't name a specific one but I think when 4.0 versions started to
appear there were a few incidents of clearly bad code sequences generated,
but have to admit that I don't remember if Wine was affected too by this.

Rolf Kalbermatter



From stefandoesinger at gmx.at  Fri Dec 21 07:03:04 2007
From: stefandoesinger at gmx.at (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Fri, 21 Dec 2007 14:03:04 +0100
Subject: [1/4 try 3] wined3d: Activate GL context before making any GL
	calls in stretch_rect_fbo
In-Reply-To: <d75158870712202050x64771d4cuf653a64088051c32@mail.gmail.com>
References: <d75158870712202050x64771d4cuf653a64088051c32@mail.gmail.com>
Message-ID: <200712211403.04327.stefandoesinger@gmx.at>

Hi,

I think your patches are on the right track, but there are a few issues to 
look at. I'll also need Henri's comments, as he wrote the fbo code.

Did you try your patches with the Deferred Shading sample from codesampler? 
http://www.codesampler.com/usersrc/usersrc_7.htm . It uses multiple render 
targets, so it is a quite interesting test.

drawprimitive() in drawprim.c calls apply_fbo_state before calling 
ActivateContext as well. This causes a lot of problems with multithreading, 
so this should be fixed too.

The first patch is OK. Calling ActivateContext before activating the fbo is 
required.

In patch 2, I was a bit confused by moving the "This->activeContext" 
assignment inside Init3D, I first thought you would remove it. But otherwise 
it looks good to me as well.

Patch 3 is ok too, keeping track of the currently bound fbo in the context is 
good. Unrelated to this patch we should look if the glBindFramebufferEXT(..., 
0) calls could be replaced with calling ActivateContext, and if that makes 
sense(it's probably not a good idea everywhere).

In patch 4, you have to be aware that in CTXUSAGE_BLIT the fbo's depth and 
color1+ attachments might be set to bad textures(e.g. different size). So 
you'll have to set them to NULL or make sure that they are set properly.

I once discussed with Henri where we should have all the functions. I think we 
could just move apply_fbo_state to context.c, make it static to make sure the 
code that requires a drawable calls ActivateContext. I am not entirely sure 
if that makes sense everywhere, e.g. the depth_blit code. Henri had some 
arguments in that regard, but I have to check the irc logs and digg out the 
discussion.

Other good testing applications are Half Life 2(demo is ok), it uses color 
buffers and depth buffers with different sizes. Battlefield 2(not 2142, no 
idea if there is a demo) depends on the depth blitting. Bioshock(demo is ok) 
is a case of an application that crashes due to multithreading issues because 
apply_fbo_state is applied before calling ActivateContext.

Thank you for all your excellent work,
Stefan


From hverbeet at gmail.com  Fri Dec 21 08:35:37 2007
From: hverbeet at gmail.com (H. Verbeet)
Date: Fri, 21 Dec 2007 15:35:37 +0100
Subject: [1/4 try 3] wined3d: Activate GL context before making any GL
	calls in stretch_rect_fbo
In-Reply-To: <200712211403.04327.stefandoesinger@gmx.at>
References: <d75158870712202050x64771d4cuf653a64088051c32@mail.gmail.com>
	<200712211403.04327.stefandoesinger@gmx.at>
Message-ID: <d658b69e0712210635n70d388d7g77e95633822388df@mail.gmail.com>

Overall, the patches look pretty reasonable.

On 21/12/2007, Stefan D?singer <stefandoesinger at gmx.at> wrote:
> Did you try your patches with the Deferred Shading sample from codesampler?
> http://www.codesampler.com/usersrc/usersrc_7.htm . It uses multiple render
> targets, so it is a quite interesting test.
>
Keep in mind that that one needs a couple of hacks to the format table
to work properly though.

> drawprimitive() in drawprim.c calls apply_fbo_state before calling
> ActivateContext as well. This causes a lot of problems with multithreading,
> so this should be fixed too.
>
Unless, I misunderstand the issue, that one should be taken care of in
the 4th patch already.

> Patch 3 is ok too, keeping track of the currently bound fbo in the context is
> good. Unrelated to this patch we should look if the glBindFramebufferEXT(...,
> 0) calls could be replaced with calling ActivateContext, and if that makes
> sense(it's probably not a good idea everywhere).
>

Personally, I don't like keeping track of flags like this all over the place:
>          GL_EXTCALL(glBindFramebufferEXT(GL_FRAMEBUFFER_EXT, 0));
> +        This->activeContext->last_fbo = 0;
I'd rather ban naked glBindFramebufferEXT() calls and either allow
bind_fbo() to accept NULL for the fbo parameter, or create an
unbind_fbo() function. Another option could be to handle framebuffer
selection completely in ActivateContext(). Arguably that's the proper
way to do it, but it would be a bit more involved, and would require
extending ActivateContext with a "source_surface" parameter, to handle
stretch_rect_fbo(), and possibly a few more CTXUSAGE types.


> In patch 4, you have to be aware that in CTXUSAGE_BLIT the fbo's depth and
> color1+ attachments might be set to bad textures(e.g. different size). So
> you'll have to set them to NULL or make sure that they are set properly.
>
Currently dst_fbo will only ever have an attachment at
GL_COLOR_ATTACHMENT0_EXT, if any. That could potentially change if we
would start to handle colorfill on depth stencils or
stretch_rect_fbo() between them, but I don't expect that to happen
very soon.

What I do wonder about is why CTXUSAGE_BLIT even binds dst_fbo though.
It's certainly not used in any of the places that currently use
dst_fbo, and I'm not sure it makes sense to bind dst_fbo in any of the
places that does call ActivateContext that way.

> I once discussed with Henri where we should have all the functions. I think we
> could just move apply_fbo_state to context.c, make it static to make sure the
> code that requires a drawable calls ActivateContext. I am not entirely sure
> if that makes sense everywhere, e.g. the depth_blit code. Henri had some
> arguments in that regard, but I have to check the irc logs and digg out the
> discussion.
>
IIRC the issue was with moving the depth blit itself to
ActivateContext(). I think just selecting the proper framebuffer etc.
should be fine.

> Other good testing applications are Half Life 2(demo is ok), it uses color
> buffers and depth buffers with different sizes. Battlefield 2(not 2142, no
> idea if there is a demo) depends on the depth blitting. Bioshock(demo is ok)
> is a case of an application that crashes due to multithreading issues because
> apply_fbo_state is applied before calling ActivateContext.
>
BF2142 does have a demo, but afaik it allows online play only, which
makes testing a bit awkward. It doesn't need depth blitting like BF2,
but does have HDR effects, IIRC. Both BF2 and BF2142 require support
for animated cursors.


From thestig at google.com  Fri Dec 21 10:30:16 2007
From: thestig at google.com (Lei Zhang)
Date: Fri, 21 Dec 2007 08:30:16 -0800
Subject: mapi32: Resolve FIXME regarding attachment lists in MAPISendMail
	function
In-Reply-To: <200712211136.25562.hans@it.vu.nl>
References: <476AF853.2070704@legis.state.ak.us>
	<200712211136.25562.hans@it.vu.nl>
Message-ID: <558b2f5c0712210830j5045bf86t7674c986544247c5@mail.gmail.com>

On Dec 21, 2007 2:36 AM, Hans Leidekker <hans at it.vu.nl> wrote:
> On Friday 21 December 2007 00:18:43 Mark Neyhart wrote:
>
> > Extend the MAILTO: string produced by the MAPISendMail function to include
> > an attachment list. Because I was unable to find any standard for MAILTO
> > regarding attachments, I constructed the attachment list in the format
> > specified for Mozilla command line options.
>
> Breaking other mail clients to gain attachments support for Mozilla is not
> acceptable tradeoff IMO.
>
>  -Hans
>
>
>

Mozilla and Thunderbird do not support attachments via mailtos. At
least not on Linux.

https://bugzilla.mozilla.org/show_bug.cgi?id=99055#c6

- Lei


From Mark_Neyhart at legis.state.ak.us  Fri Dec 21 12:06:03 2007
From: Mark_Neyhart at legis.state.ak.us (Mark Neyhart)
Date: Fri, 21 Dec 2007 09:06:03 -0900
Subject: mapi32: Resolve FIXME regarding attachment lists in MAPISendMail
	function
In-Reply-To: <558b2f5c0712210830j5045bf86t7674c986544247c5@mail.gmail.com>
References: <476AF853.2070704@legis.state.ak.us>	<200712211136.25562.hans@it.vu.nl>
	<558b2f5c0712210830j5045bf86t7674c986544247c5@mail.gmail.com>
Message-ID: <476C008B.904@legis.state.ak.us>

> On Dec 21, 2007 2:36 AM, Hans Leidekker <hans at it.vu.nl> wrote:
>> On Friday 21 December 2007 00:18:43 Mark Neyhart wrote:
>>
>>> Extend the MAILTO: string produced by the MAPISendMail function to include
>>> an attachment list. Because I was unable to find any standard for MAILTO
>>> regarding attachments, I constructed the attachment list in the format
>>> specified for Mozilla command line options.
>> Breaking other mail clients to gain attachments support for Mozilla is not
>> acceptable tradeoff IMO.
>>
>>  -Hans
>>
>>
>>
> 
> Mozilla and Thunderbird do not support attachments via mailtos. At
> least not on Linux.
> 
> https://bugzilla.mozilla.org/show_bug.cgi?id=99055#c6
> 
> - Lei
> 
> 

Hans,
As the code stands right now, attachments are not supported at all.  Using the
MAPISendMail function with a file list will bring up an email client with no
file(s) attached.  This seems to be absolutely useless, since the file(s) will have
to be manually attached before sending the message.  This patch will provide
at least the possibility for email clients to make use of the added parameter.

How about if I use the &attachment= parameter only if a file list is
provided by the caller to MAPISendMail?  That way applications which are
not attempting to provide attachments will work the same way as before.

Lei,
I am aware that Mozilla and Thunderbird do not support attachments via
mailto.  I resolved that with a simple wrapper which changes the mailto
option into the standard command line options which do support attachments.
The wrapper name can be specified the wine registry.




From thestig at google.com  Fri Dec 21 13:05:00 2007
From: thestig at google.com (Lei Zhang)
Date: Fri, 21 Dec 2007 11:05:00 -0800
Subject: mapi32: Resolve FIXME regarding attachment lists in MAPISendMail
	function
In-Reply-To: <476C008B.904@legis.state.ak.us>
References: <476AF853.2070704@legis.state.ak.us>
	<200712211136.25562.hans@it.vu.nl>
	<558b2f5c0712210830j5045bf86t7674c986544247c5@mail.gmail.com>
	<476C008B.904@legis.state.ak.us>
Message-ID: <558b2f5c0712211105w713d0bd2g5b8b139f2bfa98fd@mail.gmail.com>

On Dec 21, 2007 10:06 AM, Mark Neyhart <Mark_Neyhart at legis.state.ak.us> wrote:
>
> Lei,
> I am aware that Mozilla and Thunderbird do not support attachments via
> mailto.  I resolved that with a simple wrapper which changes the mailto
> option into the standard command line options which do support attachments.
> The wrapper name can be specified the wine registry.
>

Your script is probably unnecessary, since there's already a tool for
Linux email integration called xdg-email. It doesn't support
attachments for Thunderbird yet, but I already submitted a patch. [1]

You should specify the attachment file names as /path/to/file, which
is the format supported by xdg-email and every other Linux mail
client, rather than file:///path/to/file, which doesn't work for
anything but your script.

- Lei

[1] https://bugs.freedesktop.org/show_bug.cgi?id=13435


From hans at it.vu.nl  Fri Dec 21 14:02:16 2007
From: hans at it.vu.nl (Hans Leidekker)
Date: Fri, 21 Dec 2007 21:02:16 +0100
Subject: mapi32: Resolve FIXME regarding attachment lists in MAPISendMail
	function
In-Reply-To: <476C008B.904@legis.state.ak.us>
References: <476AF853.2070704@legis.state.ak.us>
	<558b2f5c0712210830j5045bf86t7674c986544247c5@mail.gmail.com>
	<476C008B.904@legis.state.ak.us>
Message-ID: <200712212102.16822.hans@it.vu.nl>

On Friday 21 December 2007 19:06:03 Mark Neyhart wrote:

> How about if I use the &attachment= parameter only if a file list is
> provided by the caller to MAPISendMail?  That way applications which are
> not attempting to provide attachments will work the same way as before.

I don't think that's any better. In this case, when there's an attachment,
mail clients will choke on your non-standard mailto url and fail silently,
which is worse than showing up without attachments.

How about adding an --attach option to winebrowser and replacing the
ShellExecute call with CreateProcess? I.e. make MAPISendMail fetch
the preferred mail client from the registry and start it with the mailto
url on the command line. If it's winebrowser and if there are attachments,
add them through the --attach parameter.

 -Hans


From Mark_Neyhart at legis.state.ak.us  Fri Dec 21 15:37:00 2007
From: Mark_Neyhart at legis.state.ak.us (Mark Neyhart)
Date: Fri, 21 Dec 2007 12:37:00 -0900
Subject: mapi32: Resolve FIXME regarding attachment lists in MAPISendMail
	function
In-Reply-To: <558b2f5c0712211105w713d0bd2g5b8b139f2bfa98fd@mail.gmail.com>
References: <476AF853.2070704@legis.state.ak.us>	
	<200712211136.25562.hans@it.vu.nl>	
	<558b2f5c0712210830j5045bf86t7674c986544247c5@mail.gmail.com>	
	<476C008B.904@legis.state.ak.us>
	<558b2f5c0712211105w713d0bd2g5b8b139f2bfa98fd@mail.gmail.com>
Message-ID: <476C31FC.9000004@legis.state.ak.us>

Lei Zhang wrote:
> On Dec 21, 2007 10:06 AM, Mark Neyhart <Mark_Neyhart at legis.state.ak.us> wrote:
>> Lei,
>> I am aware that Mozilla and Thunderbird do not support attachments via
>> mailto.  I resolved that with a simple wrapper which changes the mailto
>> option into the standard command line options which do support attachments.
>> The wrapper name can be specified the wine registry.
>>
> 
> Your script is probably unnecessary, since there's already a tool for
> Linux email integration called xdg-email. It doesn't support
> attachments for Thunderbird yet, but I already submitted a patch. [1]
> 
> You should specify the attachment file names as /path/to/file, which
> is the format supported by xdg-email and every other Linux mail
> client, rather than file:///path/to/file, which doesn't work for
> anything but your script.
> 
> - Lei
> 
> [1] https://bugs.freedesktop.org/show_bug.cgi?id=13435

I just used the URI style because that is what Mozilla uses on the
command line, but if that is an uncommon usage it makes sense to use
/path/to/file instead.  I also surrounded the attachment file list
with single quotes as per the Mozilla specification.  I should
probable get rid of those as well.  The attachment portion of the
mailto string will change from

&attachment="'file:///path/to/file1,file:///path/to/file2'"
to
&attachment="/path/to/file1,/path/to/file2"


From Mark_Neyhart at legis.state.ak.us  Fri Dec 21 15:54:35 2007
From: Mark_Neyhart at legis.state.ak.us (Mark Neyhart)
Date: Fri, 21 Dec 2007 12:54:35 -0900
Subject: mapi32: Resolve FIXME regarding attachment lists in MAPISendMail
	function
In-Reply-To: <200712212102.16822.hans@it.vu.nl>
References: <476AF853.2070704@legis.state.ak.us>
	<558b2f5c0712210830j5045bf86t7674c986544247c5@mail.gmail.com>
	<476C008B.904@legis.state.ak.us> <200712212102.16822.hans@it.vu.nl>
Message-ID: <476C361B.2040501@legis.state.ak.us>

Hans Leidekker wrote:
> On Friday 21 December 2007 19:06:03 Mark Neyhart wrote:
> 
>> How about if I use the &attachment= parameter only if a file list is
>> provided by the caller to MAPISendMail?  That way applications which are
>> not attempting to provide attachments will work the same way as before.
> 
> I don't think that's any better. In this case, when there's an attachment,
> mail clients will choke on your non-standard mailto url and fail silently,
> which is worse than showing up without attachments.
> 
> How about adding an --attach option to winebrowser and replacing the
> ShellExecute call with CreateProcess? I.e. make MAPISendMail fetch
> the preferred mail client from the registry and start it with the mailto
> url on the command line. If it's winebrowser and if there are attachments,
> add them through the --attach parameter.
> 
>  -Hans

This makes sense to me.  I do have a couple of questions.

Can you refer me to examples of command line parameter parsing which I could
use in winebrowser?

Are you referring to registry key [Software\\Classes\mailto\shell\open\command]
as the preferred mail client?

Should I replace the ShellExecuteA call with CreateProcessA only when I have
attachments or in all cases?



From actong88 at gmail.com  Fri Dec 21 17:53:54 2007
From: actong88 at gmail.com (Allan Tong)
Date: Fri, 21 Dec 2007 18:53:54 -0500
Subject: [1/4 try 3] wined3d: Activate GL context before making any GL
	calls in stretch_rect_fbo
In-Reply-To: <d658b69e0712210635n70d388d7g77e95633822388df@mail.gmail.com>
References: <d75158870712202050x64771d4cuf653a64088051c32@mail.gmail.com>
	<200712211403.04327.stefandoesinger@gmx.at>
	<d658b69e0712210635n70d388d7g77e95633822388df@mail.gmail.com>
Message-ID: <d75158870712211553l16e9aaebj2d7c281483064234@mail.gmail.com>

On Dec 21, 2007 9:35 AM, H. Verbeet <hverbeet at gmail.com> wrote:
> On 21/12/2007, Stefan D?singer <stefandoesinger at gmx.at> wrote:
> > Did you try your patches with the Deferred Shading sample from codesampler?
> > http://www.codesampler.com/usersrc/usersrc_7.htm . It uses multiple render
> > targets, so it is a quite interesting test.
> >
> Keep in mind that that one needs a couple of hacks to the format table
> to work properly though.

I didn't try it.  Do you know what hacks are necessary?

> In patch 2, I was a bit confused by moving the "This->activeContext"
> assignment inside Init3D, I first thought you would remove it. But otherwise
> it looks good to me as well.

I was running into a problem where last_draw_buffer was not set to
anything right after device initialization, but I'm not sure if it's
still a problem with the current patches.  It may be an issue if for
example after the device is initialized, ActivateContext is only
called on lastActiveRenderTarget (front or back buffer).  If some code
then bound a FBO outside of ActivateContext, the next call to
ActivateContext (again with lastActiveRenderTarget) would try
resetting the framebuffer binding to 0 and set the draw buffer to
context->last_draw_buffer since lastActiveRenderTarget still hasn't
changed, but context->last_draw_buffer is still 0 since we never
updated it after initializing the device.

> > Patch 3 is ok too, keeping track of the currently bound fbo in the context is
> > good. Unrelated to this patch we should look if the glBindFramebufferEXT(...,
> > 0) calls could be replaced with calling ActivateContext, and if that makes
> > sense(it's probably not a good idea everywhere).
> >
>
> Personally, I don't like keeping track of flags like this all over the place:
> >          GL_EXTCALL(glBindFramebufferEXT(GL_FRAMEBUFFER_EXT, 0));
> > +        This->activeContext->last_fbo = 0;
> I'd rather ban naked glBindFramebufferEXT() calls and either allow
> bind_fbo() to accept NULL for the fbo parameter, or create an
> unbind_fbo() function. Another option could be to handle framebuffer
> selection completely in ActivateContext(). Arguably that's the proper
> way to do it, but it would be a bit more involved, and would require
> extending ActivateContext with a "source_surface" parameter, to handle
> stretch_rect_fbo(), and possibly a few more CTXUSAGE types.

I guess I could see it getting out of hand, especially since this
patch only tracks fbos, but not the fbo attachments or even any
glDrawBuffer calls made outside of ActivateContext, all of which are
potentially problematic for ActivateContext.  I like the idea of
banning the use of
glBindFramebuffer/glDrawBuffer/glFramebufferTexture/glFramebufferRenderbuffer
outside of ActivateContext, but that may not be possible.  Maybe just
try to merge as many of these calls into ActivateContext as can be
easily done and have a strategy in place for the rest, e.g. code that
changes fbo or draw buffer state has to either update wined3d state to
match the new GL state or it needs to make sure that it restores the
GL state so that it agrees with what wined3d thinks the GL state is.

> What I do wonder about is why CTXUSAGE_BLIT even binds dst_fbo though.
> It's certainly not used in any of the places that currently use
> dst_fbo, and I'm not sure it makes sense to bind dst_fbo in any of the
> places that does call ActivateContext that way.

I was looking at some places that currently don't bind to dst_fbo,
e.g. flush_to_framebuffer_drawpixels.  It looks wrong to me for
offscreen fbo surfaces, but admittedly I'm not too familiar with when
that's used.

> > Other good testing applications are Half Life 2(demo is ok), it uses color
> > buffers and depth buffers with different sizes. Battlefield 2(not 2142, no
> > idea if there is a demo) depends on the depth blitting. Bioshock(demo is ok)
> > is a case of an application that crashes due to multithreading issues because
> > apply_fbo_state is applied before calling ActivateContext.
> >
> BF2142 does have a demo, but afaik it allows online play only, which
> makes testing a bit awkward. It doesn't need depth blitting like BF2,
> but does have HDR effects, IIRC. Both BF2 and BF2142 require support
> for animated cursors.

I tried Half Life 2 and Bioshock.  I'll take a look at BF2.

Thanks for all the comments.

 - Allan

From dank at kegel.com  Fri Dec 21 18:54:29 2007
From: dank at kegel.com (Dan Kegel)
Date: Fri, 21 Dec 2007 16:54:29 -0800
Subject: Alexandre Julliard : kernel32: Store the initial directory as a
	full path in the process parameters
Message-ID: <a71bd89a0712211654n2d291a34p35f402fade347a9a@mail.gmail.com>

That patch seems to have caused a new batch
of valgrind warnings:
http://kegel.com/wine/valgrind/logs-2007-12-21/vg-kernel32_process-diff.txt
e.g.
+ Conditional jump or move depends on uninitialised value(s)
+    at  NtAllocateVirtualMemory (virtual.c:1359)
+    by  RtlCreateProcessParameters (env.c:461)
+    by  create_process (process.c:1209)
+    by  CreateProcessW (process.c:1707)
+    by  CreateProcessA (process.c:1604)
+    by  test_Directory (process.c:839)
+    by  func_process (process.c:1410)
+    by  run_test (test.h:387)
+    by  main (test.h:436)
...
+ Conditional jump or move depends on uninitialised value(s)
+    at  create_process (server.h:76)
+    by  CreateProcessW (process.c:1707)
+    by  CreateProcessA (process.c:1604)
+    by  test_Directory (process.c:839)
+    by  func_process (process.c:1410)
+    by  run_test (test.h:387)
+    by  main (test.h:436)
-- 
Wine for Windows ISVs: http://kegel.com/wine/isv


From dank at kegel.com  Fri Dec 21 21:01:22 2007
From: dank at kegel.com (Dan Kegel)
Date: Fri, 21 Dec 2007 19:01:22 -0800
Subject: ole32: fix wrong timeout check
Message-ID: <a71bd89a0712211901y7de6094euafa478ad6d112b61@mail.gmail.com>

>-        if ((dwTimeout != INFINITE) && (start_time + dwTimeout >= now))
>+        if ((dwTimeout != INFINITE) && (now >= start_time + dwTimeout))


From jjmckenzie51 at sprintpcs.com  Fri Dec 21 21:24:44 2007
From: jjmckenzie51 at sprintpcs.com (James McKenzie)
Date: Fri, 21 Dec 2007 20:24:44 -0700
Subject: mapi32: Resolve FIXME regarding attachment lists in MAPISendMail
	function
In-Reply-To: <558b2f5c0712210830j5045bf86t7674c986544247c5@mail.gmail.com>
References: <476AF853.2070704@legis.state.ak.us>
	<200712211136.25562.hans@it.vu.nl>
	<558b2f5c0712210830j5045bf86t7674c986544247c5@mail.gmail.com>
Message-ID: <476C837C.1050703@sprintpcs.com>

Lei Zhang wrote:
> On Dec 21, 2007 2:36 AM, Hans Leidekker <hans at it.vu.nl> wrote:
>   
>> On Friday 21 December 2007 00:18:43 Mark Neyhart wrote:
>>
>>     
>>> Extend the MAILTO: string produced by the MAPISendMail function to include
>>> an attachment list. Because I was unable to find any standard for MAILTO
>>> regarding attachments, I constructed the attachment list in the format
>>> specified for Mozilla command line options.
>>>       
>> Breaking other mail clients to gain attachments support for Mozilla is not
>> acceptable tradeoff IMO.
>>
>>  -Hans
>>
>>
>>
>>     
>
> Mozilla and Thunderbird do not support attachments via mailtos. At
> least not on Linux.
>
> https://bugzilla.mozilla.org/show_bug.cgi?id=99055#c6
>
> - Lei
>
>
>   
Mozilla Mail and Thunderbird do not support mail attachments through the
methods used by other mail clients
and the Thunderbird team plans on not fixing this (the bug above should
be closed as WONTFIX if I remember
correctly from my work with OpenOffice.org for the Mac.)

Thus creating a patch for this method is worthless for both Thunderbird
as it may/may not work with the next
major release and will not work with any other Linux/Mac mail program
(Mail for the Mac works in the same manner
as does most Linux mailers.) 

Mailto: does work for Outlook and its ilk.

James McKenzie


From hans at it.vu.nl  Sat Dec 22 03:21:38 2007
From: hans at it.vu.nl (Hans Leidekker)
Date: Sat, 22 Dec 2007 10:21:38 +0100
Subject: mapi32: Resolve FIXME regarding attachment lists in MAPISendMail
	function
In-Reply-To: <476C361B.2040501@legis.state.ak.us>
References: <476AF853.2070704@legis.state.ak.us>
	<200712212102.16822.hans@it.vu.nl>
	<476C361B.2040501@legis.state.ak.us>
Message-ID: <200712221021.38933.hans@it.vu.nl>

On Friday 21 December 2007 22:54:35 Mark Neyhart wrote:

> Can you refer me to examples of command line parameter parsing which I could
> use in winebrowser?

Many apps under programs/ do command line parsing. Look at winepath for
example, which handles both long and short options.

> Are you referring to registry key [Software\\Classes\mailto\shell\open\command]
> as the preferred mail client?

Yes.

> Should I replace the ShellExecuteA call with CreateProcessA only when I have
> attachments or in all cases?

ShellExecute does elaborate argument expansion that you don't want to
duplicate so it's probably best to just make an exception when there
are attachments and winebrowser is the preferred client.

 -Hans


From alexd4 at inbox.lv  Sat Dec 22 16:37:32 2007
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Sat, 22 Dec 2007 14:37:32 -0800
Subject: ole32: fix wrong timeout check
In-Reply-To: <a71bd89a0712211901y7de6094euafa478ad6d112b61@mail.gmail.com>
References: <a71bd89a0712211901y7de6094euafa478ad6d112b61@mail.gmail.com>
Message-ID: <476D91AC.9090404@inbox.lv>

Yeah these calculations are a headache. I could probably write

now < start_time || now >= start_time + dwTimeout

to at least avoid a "hang" if GetTickCount counter overflows. This won't solve 
not waiting the required time if, say, start_time + dwTimeout overflows, and 
that can also be a problem (for example, I found this bug by bisecting a 
regression in an installer that happened because the function didn't properly 
wait). To be really purist, we would probably need a macro or a function with 
branching that correctly handles all possible overflow situations and tells if 
the required interval elapsed between "tick" values A and B. I wonder if a patch 
like that would be accepted, though, and also in what file this macro/function 
could be implemented?

This seems to be pretty widespread, too, one of CoWaitForMultipleHandles callers 
- RPC_GetLocalClassObject - now also has a similar timeout check.

Dan Kegel wrote:
>> -        if ((dwTimeout != INFINITE) && (start_time + dwTimeout >= now))
>> +        if ((dwTimeout != INFINITE) && (now >= start_time + dwTimeout))
> 
>>From time immemorial, it has been drummed into me
> that one should always handle wraparound when
> checking timers.  So something like
>     DWORD delta = now - start_time;
>     if (dwTimeout != INFINITE) && (delta < 0x80000000UL) && (delta > dwTimeout))
> might be more correct... I used to always use
> a signed variable for this, but C compilers
> now treat overflow of signed variables as
> a conceptual error, so the subtraction has to be unsigned,
> There's probably a cleaner way to code this,
> but doing the subtraction to get the delta time,
> and then comparing against the maximum desired
> delta time, is the way to avoid trouble at rollover.
> - Dan
> 
> 



From lionel_debroux at yahoo.fr  Sat Dec 22 04:30:05 2007
From: lionel_debroux at yahoo.fr (Lionel_Debroux)
Date: Sat, 22 Dec 2007 11:30:05 +0100
Subject: Calls to realloc-type functions in Wine...
Message-ID: <476CE72D.1090209@yahoo.fr>

Hi everybody,

One of the patches I sent on December 9th contained a fix for two
constructs of the form
ptr = msi_realloc (ptr, newsize);
I spotted these constructs while investigating on unrelated "potential
leak" entries of Michael Stefaniuc's list of potential issues found by
Smatch.

It's very unlikely that *realloc fails, but if it does, this leaks some
memory (or may fault, if the code is not protected against *realloc
returning NULL).

Last week, I spotted another construct of that form.
That prompted me to make a case-insensitive search of "realloc" in the
whole Wine tree. Such a simple search was bound to turn a significant
amount of noise (comments, TRACE/WARN, even correct uses of realloc,
etc.), but it would also reveal other (probably) incorrect uses of
realloc-type functions.


The sorted and hand-filtered results of the search I made December 14th
are attached. I didn't update the file before writing this mail because
it didn't make much sense: this kind of info gets outdated fast.
In short: I'd say that in the list, at least a couple hundred calls to
realloc-type functions are constructs of the form
ptr = [realloc] (..., ptr, ...);
And to be safe, all entries on the list would have to be investigated
(if nothing else, to check for leaks).


Do you think this kind of code be checked and fixed for the Wine 1.0
milestone ? That looks doable, if the usual maintainers of /
contributors to each piece of code participate.


Regards,
Lionel.
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: realloc_in_wine.txt
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20071222/255b3c0b/attachment-0001.txt 

From kai.blin at gmail.com  Sat Dec 22 07:59:17 2007
From: kai.blin at gmail.com (Kai Blin)
Date: Sat, 22 Dec 2007 14:59:17 +0100
Subject: Calls to realloc-type functions in Wine...
In-Reply-To: <476CE72D.1090209@yahoo.fr>
References: <476CE72D.1090209@yahoo.fr>
Message-ID: <200712221459.22187.kai.blin@gmail.com>

On Saturday 22 December 2007 11:30:05 Lionel_Debroux wrote:
> ./dlls/secur32/dispatcher.c:152

This one is safe, as buf is only assigned to helper->com_buf on success of the 
call. helper->com_buf is free()d when the user correctly shuts down the 
security context.

Cheers,
Kai

-- 
Kai Blin
WorldForge developer  http://www.worldforge.org/
Wine developer        http://wiki.winehq.org/KaiBlin
Samba team member     http://www.samba.org/samba/team/
--
Will code for cotton.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071222/4aa8a691/attachment.pgp 

From thunderbird2k at gmx.net  Sat Dec 22 09:15:21 2007
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Sat, 22 Dec 2007 16:15:21 +0100
Subject: wined3d: fix check for P8 render target
In-Reply-To: <476CEC39.9010804@inbox.lv>
References: <476CEC39.9010804@inbox.lv>
Message-ID: <20071222151521.93140@gmx.net>

> Hi.
> 
> I think this part of d3dfmt_p8_init_palette has a bug, because it appears
> to be
> checking that render target is a render target. Incorrectly going into
> index_in_alpha codepath here causes this bug:
> 
> http://bugs.winehq.org/show_bug.cgi?id=10797
> 
> in Aliens vs Predator 1 game - it prefers P8 textures and sets color key
> on some
> textures for transparency and alpha channel is wrong on such textures in
> game.
> 
> ---
>      dlls/wined3d/surface.c |    7 ++-----
>      1 files changed, 2 insertions(+), 5 deletions(-)
> 
> 

Hi,

Unfortunately this patch is not correct and I haven't looked exactly what the real issue is.

In short most hardware (except if it has GL_EXT_paletted_texture) doesn't support 8bit textures and most of the time we do 8bit->32bit conversion in software. On hardware that supports fragment shaders we perform the conversion using a shader and this is a lot faster (it is 'free'). The palette is uploaded in d3dfmt_p8_init_palette. 

So the p8 conversion is done in hardware but in some cases we need to read back the data from the card. The p8 -> 32bit conversion was done behind the back of the game, so the game expects 8bit data back. A palette contains upto 256 entries and each color can appear multiple times in the palette. So the inverse palette lookup doesn't have a 1:1 mapping and this is problematic.

The trick we do is to store the 8bit color index in the alpha component of the palette and use this to read back the correct index during the 32bit->8bit conversion. The problem is that most games need alpha and for that reason we only use this 'hack' when the primary render target is using 8bit. In this case you can't be using 3D and only old apps like StarCraft use this.

Your game is likely using some p8 textures and is likely suffering from the 32 -> 8bit problem. I haven't check AVP but if this is the real issue there it can't be fixed. It would break other games like GTA4 and others.

Regards,
Roderick Colenbrander
-- 
Psssst! Schon vom neuen GMX MultiMessenger geh?rt?
Der kann`s mit allen: http://www.gmx.net/de/go/multimessenger?did=10


From hzhrong at gmail.com  Sat Dec 22 09:46:05 2007
From: hzhrong at gmail.com (Huang, Zhangrong)
Date: Sat, 22 Dec 2007 23:46:05 +0800
Subject: ole32: Fix a failed call to DllGetClassObject while retrieving
	class object interface pointer.
In-Reply-To: <476ABF8B.1080509@codeweavers.com>
References: <b4cc5a3d0712200653t738a43c4rcbd00ff8e779e128@mail.gmail.com>
	<476ABF8B.1080509@codeweavers.com>
Message-ID: <b4cc5a3d0712220746y4a883afau649a5f22aec8a59@mail.gmail.com>

Hi,
Sorry for the delay.
Here is a test, pls import the attached registry files, and copy
native activeds.dll, adsldpc.dll,
adsldp.dll to your windows system32 dir, and patch
wine/dlls/ole32/tests/moniker.c

Then run the test:
$ ../../../wine ole32_test.exe.so moniker
err:ole:apartment_getclassobject DllGetClassObject returned error 0x80004002
err:ole:create_server class {228d9a81-c302-11cf-9aa4-00aa004a5691} not
registered
fixme:ole:CoGetClassObject CLSCTX_REMOTE_SERVER not supported
err:ole:CoGetClassObject no class object
{228d9a81-c302-11cf-9aa4-00aa004a5691} could be created for context
0x15
moniker.c:783: Test failed: ****************LDAP**************
moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.

after my patch:
$ ../../../wine ole32_test.exe.so moniker
moniker.c:783: Test failed: ****************LDAP**************
moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.

Although the test failed, but loading class
{228d9a81-c302-11cf-9aa4-00aa004a5691} success.


2007/12/21, Robert Shearman <rob at codeweavers.com>:
> Huang, Zhangrong wrote:
> > See dlls/ole32/compobj.c,
> >
> > static HRESULT apartment_getclassobject(struct apartment *apt, LPCWSTR dllpath,
> >                                         BOOL apartment_threaded,
> >                                         REFCLSID rclsid, REFIID riid,
> > void **ppv)
> > {
> > ...................
> >     if (SUCCEEDED(hr))
> >     {
> > ..................
> >         TRACE("calling DllGetClassObject %p\n",
> > apartment_loaded_dll->dll->DllGetClassObject);
> >         /* OK: get the ClassObject */
> >         hr = apartment_loaded_dll->dll->DllGetClassObject(rclsid, riid, ppv);
> >                                                                   ^^^^
> >         if (hr != S_OK)
> >             ERR("DllGetClassObject returned error 0x%08x\n", hr);
> >     }
> > ..............
> > }
> >
> > Reference to http://msdn2.microsoft.com/en-us/library/ms680760.aspx,
> >
> > riid
> >
> >     [in] Reference to the identifier of the interface that the caller
> >     is to use to communicate with the class object. Usually, this is
> >     IID_IClassFactory (defined in the OLE headers as the interface
> >     identifier for IClassFactory).
> >
>
> This doesn't mean anything other than CoCreateInstance is usually used
> instead of CoGetClassObject (and CoCreateInstance always passes in
> IID_IClassFactory for the IID).

It's failed when calling MkParseDisplayName.

>
> > We can't pass riid to DllGetClassObject directly sometimes, causes some dlls'
> > DllGetClassObject (like native adsldp.dll) can only return reference-counted
> > pointer to class factory via IID_IClassFactory, for retrieving the
> > pointer to the
> > class object interface requested in riid, we must try another way.
> >
>
> Thank you for your patch, but this behaviour seems a little strange and
> needs a little more investigation before I am happy that it is correct.
> What parameters are being passed in to CoGetClassObject to cause the
> call to fail for you?

That's how MS does, I see this strange behaviour happening through
assembly debugging.
First time calling DllGetClassObject using riid, and it's failed, then
trying IID_IClassFactory.

Anyway, what's DllGetClassObject return depends on its implementation,
it can be a pointer to
ClassFactory or a pointer to class object, we should try both.

>
> --
> Rob Shearman
>
>


-- 
$ apt-get moo
         (__)
         (oo)
   /------\/
  / |    ||
 *  /\---/\
    ~~   ~~
...."Have you mooed today?"...
-------------- next part --------------
A non-text attachment was scrubbed...
Name: LDAP.reg
Type: application/octet-stream
Size: 476 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071222/0441f2da/attachment.obj 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: tests_moniker.diff
Type: text/x-patch
Size: 1854 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071222/0441f2da/attachment.bin 

From alexd4 at inbox.lv  Sat Dec 22 19:52:12 2007
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Sat, 22 Dec 2007 17:52:12 -0800
Subject: wined3d: fix check for P8 render target
In-Reply-To: <20071222151521.93140@gmx.net>
References: <476CEC39.9010804@inbox.lv> <20071222151521.93140@gmx.net>
Message-ID: <476DBF4C.10608@inbox.lv>

Hi.

Yes, exactly, the AVP1 game is using p8 textures and color keys on some of them
for transparency.

The thing is, the "index_in_alpha" hack DOES get enabled on its P8 3D textures,
and that's the problem I'm trying to fix. I don't see the "primary render target
is p8" check in the code, instead it looks like it checks that render_targets[0]
is a render target.

In patch I proposed I check that the passed surface is a render target, and,
since it's passed to d3dfmt_p8_init_palette then I guess it means there's a p8
render target and in such case the index_in_alpha hack is enabled. Although I
don't check anything beyond just that it's a render target, I guess it could be
some offscreen buffer. Is that the problem, essentially?

Regarding GTA - I could try looking for demo for tests, but can you clarify - is
it really GTA4? GTA4 is upcoming game AFAIK, maybe you mean GTA3?

Roderick Colenbrander wrote:
> 
> Hi,
> 
> Unfortunately this patch is not correct and I haven't looked exactly what the real issue is.
> 
> In short most hardware (except if it has GL_EXT_paletted_texture) doesn't support 8bit textures and most of the time we do 8bit->32bit conversion in software. On hardware that supports fragment shaders we perform the conversion using a shader and this is a lot faster (it is 'free'). The palette is uploaded in d3dfmt_p8_init_palette. 
> 
> So the p8 conversion is done in hardware but in some cases we need to read back the data from the card. The p8 -> 32bit conversion was done behind the back of the game, so the game expects 8bit data back. A palette contains upto 256 entries and each color can appear multiple times in the palette. So the inverse palette lookup doesn't have a 1:1 mapping and this is problematic.
> 
> The trick we do is to store the 8bit color index in the alpha component of the palette and use this to read back the correct index during the 32bit->8bit conversion. The problem is that most games need alpha and for that reason we only use this 'hack' when the primary render target is using 8bit. In this case you can't be using 3D and only old apps like StarCraft use this.
> 
> Your game is likely using some p8 textures and is likely suffering from the 32 -> 8bit problem. I haven't check AVP but if this is the real issue there it can't be fixed. It would break other games like GTA4 and others.
> 
> Regards,
> Roderick Colenbrander





From juan.lang at gmail.com  Sat Dec 22 09:59:27 2007
From: juan.lang at gmail.com (Juan Lang)
Date: Sat, 22 Dec 2007 07:59:27 -0800
Subject: Calls to realloc-type functions in Wine...
In-Reply-To: <476CE72D.1090209@yahoo.fr>
References: <476CE72D.1090209@yahoo.fr>
Message-ID: <3a768c550712220759g39a9b6d9r692c08b9b308a25a@mail.gmail.com>

Hi Lionel,

> It's very unlikely that *realloc fails, but if it does, this leaks some
> memory (or may fault, if the code is not protected against *realloc
> returning NULL).

Note that it's debatable what the best course of action here is.  It's
true that in case of failure, the original pointer should be freed.
But a fault might be acceptable too - if we're out of memory, what can
we possibly do to recover?  At least that's one line of reasoning.

> That prompted me to make a case-insensitive search of "realloc" in the
> whole Wine tree. Such a simple search was bound to turn a significant
> amount of noise (comments, TRACE/WARN, even correct uses of realloc,
> etc.), but it would also reveal other (probably) incorrect uses of
> realloc-type functions.

The results you sent aren't very useful without more investigation.
This might be a useful janitorial project, and might be better tracked
on the wiki than on this list.
--Juan


From lionel_debroux at yahoo.fr  Sat Dec 22 10:38:36 2007
From: lionel_debroux at yahoo.fr (Lionel_Debroux)
Date: Sat, 22 Dec 2007 17:38:36 +0100
Subject: Calls to realloc-type functions in Wine...
In-Reply-To: <3a768c550712220759g39a9b6d9r692c08b9b308a25a@mail.gmail.com>
References: <476CE72D.1090209@yahoo.fr>
	<3a768c550712220759g39a9b6d9r692c08b9b308a25a@mail.gmail.com>
Message-ID: <476D3D8C.5030703@yahoo.fr>

Hi Juan,

> The results you sent aren't very useful without more investigation.
Indeed.
I have started doing that on msi (which is the first place where I
spotted such a construct, but as the list shows, it's far from being the
only one), and sent a patch this morning.
However, I have neither the time, nor the knowledge of the Win32 API, to
correctly fix all cases :)

> This might be a useful janitorial project, and might be better
> tracked on the wiki than on this list.
Agreed.
Last week, between other things, I asked Michael Stefaniuc exactly that.
But he didn't reply yet, I know he's busy (or either mail was silently
eaten by a spam filter...).


Lionel.


From truiken at gmail.com  Sat Dec 22 10:55:22 2007
From: truiken at gmail.com (James Hawkins)
Date: Sat, 22 Dec 2007 10:55:22 -0600
Subject: msi: correctly handle return value of msi_realloc. [1/2]
In-Reply-To: <476CE6E5.4060200@yahoo.fr>
References: <476CE6E5.4060200@yahoo.fr>
Message-ID: <22821af30712220855q602ddc0bnda8be622f14258f4@mail.gmail.com>

On Dec 22, 2007 4:28 AM, Lionel_Debroux <lionel_debroux at yahoo.fr> wrote:
> Several functions in dlls/msi/action.c and dlls/msi/database.c use
> constructs of the form
> ptr = msi_realloc (ptr, newsize);
>
> In the (admittedly very unlikely) situation where msi_realloc fails,
> this leaks, or even faults:
> filename = msi_realloc(filename, len * sizeof(WCHAR) + sizeof(szlnk));
> memcpy(filename + len, szlnk, sizeof(szlnk));
>
> 2007-12-14  Lionel Debroux <lionel_debroux at yahoo.fr>
>         * dlls/msi/action.c, dlls/msi/database.c:
>         msi: correctly handle return value of msi_realloc.
>

-        filename = msi_realloc(filename, len * sizeof(WCHAR) + sizeof(szlnk));
+        p = msi_realloc(filename, len * sizeof(WCHAR) + sizeof(szlnk));
+        if (!p)
+        {
+            msi_free(target_folder);
+            msi_free(filename);
+            ERR("Not enough memory to grow filename\n");
+            goto err;
+        }
+        filename = p;

Don't add ERRs for out of memory...and you need to return
ERROR_OUTOFMEMORY in these cases.

-- 
James Hawkins


From truiken at gmail.com  Sat Dec 22 11:03:03 2007
From: truiken at gmail.com (James Hawkins)
Date: Sat, 22 Dec 2007 11:03:03 -0600
Subject: msi: fix memory leaks on error paths (found by Smatch). [2/2]
In-Reply-To: <476CE70D.7030802@yahoo.fr>
References: <476CE70D.7030802@yahoo.fr>
Message-ID: <22821af30712220903u5e82bec0lf0f2f268193b8894@mail.gmail.com>

On Dec 22, 2007 4:29 AM, Lionel_Debroux <lionel_debroux at yahoo.fr> wrote:
> "msi_load_summary_properties" and "MsiSourceListAddSourceExW" in
> dlls/msi/package.c and dlls/msi/source.c get flagged by Michael
> Stefaniuc's unfree-wine.pl script.
>
> 2007-12-21  Lionel Debroux <lionel_debroux at yahoo.fr>
>         * dlls/msi/package.c, dlls/msi/source.c:
>         msi: fix memory leaks on error paths (found by Smatch).
>

     if (rc != ERROR_SUCCESS)
     {
+        msi_free( package_code );
         WARN("Unable to query rev number: %d\n", rc);
         goto done;
     }

Save a line and move the msi_free a couple lines down to the done: block.

+    {
+        msi_free(source); /* This is correct because msi strdupW
calls msi_alloc. */
         return rc;
+    }

Are you serious?  Please take that comment out.  Either way the fix
isn't really right.  All you need is a 'goto done' because you're
still leaking the reg handles.

-- 
James Hawkins


From truiken at gmail.com  Sat Dec 22 11:06:58 2007
From: truiken at gmail.com (James Hawkins)
Date: Sat, 22 Dec 2007 11:06:58 -0600
Subject: ole32: Fix a failed call to DllGetClassObject while retrieving
	class object interface pointer.
In-Reply-To: <b4cc5a3d0712220746y4a883afau649a5f22aec8a59@mail.gmail.com>
References: <b4cc5a3d0712200653t738a43c4rcbd00ff8e779e128@mail.gmail.com>
	<476ABF8B.1080509@codeweavers.com>
	<b4cc5a3d0712220746y4a883afau649a5f22aec8a59@mail.gmail.com>
Message-ID: <22821af30712220906o2b313fe6oc1fbea0657f92f58@mail.gmail.com>

On Dec 22, 2007 9:46 AM, Huang, Zhangrong <hzhrong at gmail.com> wrote:
> Hi,
> Sorry for the delay.
> Here is a test, pls import the attached registry files, and copy
> native activeds.dll, adsldpc.dll,
> adsldp.dll to your windows system32 dir, and patch
> wine/dlls/ole32/tests/moniker.c
>
> Then run the test:
> $ ../../../wine ole32_test.exe.so moniker
> err:ole:apartment_getclassobject DllGetClassObject returned error 0x80004002
> err:ole:create_server class {228d9a81-c302-11cf-9aa4-00aa004a5691} not
> registered
> fixme:ole:CoGetClassObject CLSCTX_REMOTE_SERVER not supported
> err:ole:CoGetClassObject no class object
> {228d9a81-c302-11cf-9aa4-00aa004a5691} could be created for context
> 0x15
> moniker.c:783: Test failed: ****************LDAP**************
> moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.
>
> after my patch:
> $ ../../../wine ole32_test.exe.so moniker
> moniker.c:783: Test failed: ****************LDAP**************
> moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.
>
> Although the test failed, but loading class
> {228d9a81-c302-11cf-9aa4-00aa004a5691} success.
>
>
> 2007/12/21, Robert Shearman <rob at codeweavers.com>:
> > Huang, Zhangrong wrote:
> > > See dlls/ole32/compobj.c,
> > >
> > > static HRESULT apartment_getclassobject(struct apartment *apt, LPCWSTR dllpath,
> > >                                         BOOL apartment_threaded,
> > >                                         REFCLSID rclsid, REFIID riid,
> > > void **ppv)
> > > {
> > > ...................
> > >     if (SUCCEEDED(hr))
> > >     {
> > > ..................
> > >         TRACE("calling DllGetClassObject %p\n",
> > > apartment_loaded_dll->dll->DllGetClassObject);
> > >         /* OK: get the ClassObject */
> > >         hr = apartment_loaded_dll->dll->DllGetClassObject(rclsid, riid, ppv);
> > >                                                                   ^^^^
> > >         if (hr != S_OK)
> > >             ERR("DllGetClassObject returned error 0x%08x\n", hr);
> > >     }
> > > ..............
> > > }
> > >
> > > Reference to http://msdn2.microsoft.com/en-us/library/ms680760.aspx,
> > >
> > > riid
> > >
> > >     [in] Reference to the identifier of the interface that the caller
> > >     is to use to communicate with the class object. Usually, this is
> > >     IID_IClassFactory (defined in the OLE headers as the interface
> > >     identifier for IClassFactory).
> > >
> >
> > This doesn't mean anything other than CoCreateInstance is usually used
> > instead of CoGetClassObject (and CoCreateInstance always passes in
> > IID_IClassFactory for the IID).
>
> It's failed when calling MkParseDisplayName.
>
> >
> > > We can't pass riid to DllGetClassObject directly sometimes, causes some dlls'
> > > DllGetClassObject (like native adsldp.dll) can only return reference-counted
> > > pointer to class factory via IID_IClassFactory, for retrieving the
> > > pointer to the
> > > class object interface requested in riid, we must try another way.
> > >
> >
> > Thank you for your patch, but this behaviour seems a little strange and
> > needs a little more investigation before I am happy that it is correct.
> > What parameters are being passed in to CoGetClassObject to cause the
> > call to fail for you?
>
> That's how MS does, I see this strange behaviour happening through
> assembly debugging.
> First time calling DllGetClassObject using riid, and it's failed, then
> trying IID_IClassFactory.
>

Disassembling what?

-- 
James Hawkins


From thunderbird2k at gmx.net  Sat Dec 22 11:24:15 2007
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Sat, 22 Dec 2007 18:24:15 +0100
Subject: wined3d: fix check for P8 render target
In-Reply-To: <476DBF4C.10608@inbox.lv>
References: <476CEC39.9010804@inbox.lv> <20071222151521.93140@gmx.net>
	<476DBF4C.10608@inbox.lv>
Message-ID: <20071222172415.192440@gmx.net>

> Hi.
> 
> Yes, exactly, the AVP1 game is using p8 textures and color keys on some of
> them
> for transparency.
> 
> The thing is, the "index_in_alpha" hack DOES get enabled on its P8 3D
> textures,
> and that's the problem I'm trying to fix. I don't see the "primary render
> target
> is p8" check in the code, instead it looks like it checks that
> render_targets[0]
> is a render target.

Try to see if the attached patch fixes the problem. It seems that at some point I didn't check whether the target is P8 in this function while I check for it in other places. I have checked it using all my p8 testcases and it seems to work fine but I don't have AVP. If it works I'll submit it.

Roderick


-- 
GMX FreeMail: 1 GB Postfach, 5 E-Mail-Adressen, 10 Free SMS.
Alle Infos und kostenlose Anmeldung: http://www.gmx.net/de/go/freemail
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0002-Make-sure-the-format-of-the-primary-render-target-is.patch
Type: text/x-diff
Size: 0 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071222/d72c3bb2/attachment.patch 

From thunderbird2k at gmx.net  Sat Dec 22 11:25:57 2007
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Sat, 22 Dec 2007 18:25:57 +0100
Subject: [PATCH] Make sure the format of the primary render target is P8 before storing the index in the alpha component.
Message-ID: <mailman.173.1198344274.6275.wine-devel@winehq.org>

---
 dlls/wined3d/surface.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/dlls/wined3d/surface.c b/dlls/wined3d/surface.c
index 30d6507..3e34286 100644
--- a/dlls/wined3d/surface.c
+++ b/dlls/wined3d/surface.c
@@ -1931,7 +1931,7 @@ static void d3dfmt_p8_init_palette(IWineD3DSurfaceImpl *This, BYTE table[256][4]
     if (device->render_targets && device->render_targets[0]) {
         IWineD3DSurfaceImpl* render_target = (IWineD3DSurfaceImpl*)device->render_targets[0];
 
-        if(render_target->resource.usage & WINED3DUSAGE_RENDERTARGET)
+        if((render_target->resource.usage & WINED3DUSAGE_RENDERTARGET) && (render_target->resource.format == WINED3DFMT_P8))
             index_in_alpha = TRUE;
     }
 
-- 
1.5.3.4


--========GMX192441198344255398393--


From hzhrong at gmail.com  Sat Dec 22 12:25:36 2007
From: hzhrong at gmail.com (Huang, Zhangrong)
Date: Sun, 23 Dec 2007 02:25:36 +0800
Subject: ole32: Fix a failed call to DllGetClassObject while retrieving
	class object interface pointer.
In-Reply-To: <22821af30712220906o2b313fe6oc1fbea0657f92f58@mail.gmail.com>
References: <b4cc5a3d0712200653t738a43c4rcbd00ff8e779e128@mail.gmail.com>
	<476ABF8B.1080509@codeweavers.com>
	<b4cc5a3d0712220746y4a883afau649a5f22aec8a59@mail.gmail.com>
	<22821af30712220906o2b313fe6oc1fbea0657f92f58@mail.gmail.com>
Message-ID: <b4cc5a3d0712221025g3ba44bcay14f02396813c62a1@mail.gmail.com>

2007/12/23, James Hawkins <truiken at gmail.com>:
> On Dec 22, 2007 9:46 AM, Huang, Zhangrong <hzhrong at gmail.com> wrote:
> > Hi,
> > Sorry for the delay.
> > Here is a test, pls import the attached registry files, and copy
> > native activeds.dll, adsldpc.dll,
> > adsldp.dll to your windows system32 dir, and patch
> > wine/dlls/ole32/tests/moniker.c
> >
> > Then run the test:
> > $ ../../../wine ole32_test.exe.so moniker
> > err:ole:apartment_getclassobject DllGetClassObject returned error 0x80004002
> > err:ole:create_server class {228d9a81-c302-11cf-9aa4-00aa004a5691} not
> > registered
> > fixme:ole:CoGetClassObject CLSCTX_REMOTE_SERVER not supported
> > err:ole:CoGetClassObject no class object
> > {228d9a81-c302-11cf-9aa4-00aa004a5691} could be created for context
> > 0x15
> > moniker.c:783: Test failed: ****************LDAP**************
> > moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.
> >
> > after my patch:
> > $ ../../../wine ole32_test.exe.so moniker
> > moniker.c:783: Test failed: ****************LDAP**************
> > moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.
> >
> > Although the test failed, but loading class
> > {228d9a81-c302-11cf-9aa4-00aa004a5691} success.
> >
> >
> > 2007/12/21, Robert Shearman <rob at codeweavers.com>:
> > > Huang, Zhangrong wrote:
> > > > See dlls/ole32/compobj.c,
> > > >
> > > > static HRESULT apartment_getclassobject(struct apartment *apt, LPCWSTR dllpath,
> > > >                                         BOOL apartment_threaded,
> > > >                                         REFCLSID rclsid, REFIID riid,
> > > > void **ppv)
> > > > {
> > > > ...................
> > > >     if (SUCCEEDED(hr))
> > > >     {
> > > > ..................
> > > >         TRACE("calling DllGetClassObject %p\n",
> > > > apartment_loaded_dll->dll->DllGetClassObject);
> > > >         /* OK: get the ClassObject */
> > > >         hr = apartment_loaded_dll->dll->DllGetClassObject(rclsid, riid, ppv);
> > > >                                                                   ^^^^
> > > >         if (hr != S_OK)
> > > >             ERR("DllGetClassObject returned error 0x%08x\n", hr);
> > > >     }
> > > > ..............
> > > > }
> > > >
> > > > Reference to http://msdn2.microsoft.com/en-us/library/ms680760.aspx,
> > > >
> > > > riid
> > > >
> > > >     [in] Reference to the identifier of the interface that the caller
> > > >     is to use to communicate with the class object. Usually, this is
> > > >     IID_IClassFactory (defined in the OLE headers as the interface
> > > >     identifier for IClassFactory).
> > > >
> > >
> > > This doesn't mean anything other than CoCreateInstance is usually used
> > > instead of CoGetClassObject (and CoCreateInstance always passes in
> > > IID_IClassFactory for the IID).
> >
> > It's failed when calling MkParseDisplayName.
> >
> > >
> > > > We can't pass riid to DllGetClassObject directly sometimes, causes some dlls'
> > > > DllGetClassObject (like native adsldp.dll) can only return reference-counted
> > > > pointer to class factory via IID_IClassFactory, for retrieving the
> > > > pointer to the
> > > > class object interface requested in riid, we must try another way.
> > > >
> > >
> > > Thank you for your patch, but this behaviour seems a little strange and
> > > needs a little more investigation before I am happy that it is correct.
> > > What parameters are being passed in to CoGetClassObject to cause the
> > > call to fail for you?
> >
> > That's how MS does, I see this strange behaviour happening through
> > assembly debugging.
> > First time calling DllGetClassObject using riid, and it's failed, then
> > trying IID_IClassFactory.
> >
>
> Disassembling what?

Native ole32.dll, MkParseDisplayName calls adsldp.dll's
DllGetClassObject twice,
frist using IID_IParseDisplayName, second using IID_IClassFactory.


>
> --
> James Hawkins
>


-- 
$ apt-get moo
         (__)
         (oo)
   /------\/
  / |    ||
 *  /\---/\
    ~~   ~~
...."Have you mooed today?"...


From alexd4 at inbox.lv  Sat Dec 22 22:31:57 2007
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Sat, 22 Dec 2007 20:31:57 -0800
Subject: wined3d: fix check for P8 render target
In-Reply-To: <20071222172415.192440@gmx.net>
References: <476CEC39.9010804@inbox.lv> <20071222151521.93140@gmx.net>
	<476DBF4C.10608@inbox.lv> <20071222172415.192440@gmx.net>
Message-ID: <476DE4BD.3050608@inbox.lv>

Yes your patch fixes most problems (there are some remaining issues but they 
were not fixed by mine either).

Roderick Colenbrander wrote:
>> Hi.
>>
>> Yes, exactly, the AVP1 game is using p8 textures and color keys on some of
>> them
>> for transparency.
>>
>> The thing is, the "index_in_alpha" hack DOES get enabled on its P8 3D
>> textures,
>> and that's the problem I'm trying to fix. I don't see the "primary render
>> target
>> is p8" check in the code, instead it looks like it checks that
>> render_targets[0]
>> is a render target.
> 
> Try to see if the attached patch fixes the problem. It seems that at some point I didn't check whether the target is P8 in this function while I check for it in other places. I have checked it using all my p8 testcases and it seems to work fine but I don't have AVP. If it works I'll submit it.
> 
> Roderick
> 
> 
> 



From wine-devel at kievinfo.com  Sat Dec 22 12:54:17 2007
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sat, 22 Dec 2007 11:54:17 -0700
Subject: New bugzilla components (round 3)
Message-ID: <476D5D59.8050809@kievinfo.com>

Ok we talked and talked and talked and where did it all go? Where are the 
agreed upon changes?

If we can't agree on everything, then lets do parts that everyone is ok 
with. Then decide on more changes.


So far this what everyone was happy with:

wine-misc -> unknown (default selection)

test -> test (change description to "Conformance tests")
wine-advapi32 -> advapi32
wine-atl -> atl
wine-comctl32 -> comctl32
wine-console -> console
wine-crypt32 -> crypt32
wine-dbghelp -> dbghelp
wine-debug -> winedbg
wine-directx* -> directx*
wine-documentation -> documentation
wine-dos -> dos
wine-gdi-(printing) -> gdi32
wine-gdiplus -> gdiplus
wine-help -> hhctrl - Help viewer implementation
wine-kernel -> kernel32
wine-loader ->loader
wine-msi -> msi
wine-msvcrt -> msvcrt
wine-msxml -> msxml3
wine-ole -> ole
wine-opengl -> opengl
wine-quartz -> quartz
wine-richedit -> richedit
wine-setupapi -> setupapi
wine-shdocvw -> shdocvw
wine-shell32 -> shell32
wine-urlmon -> urlmon
wine-user -> user32
wine-usp10.dll -> usp10
wine-winelib -> winelib
wine-x11driver -> x11driver

Add new components:
-> wininet - Internet connectivity and Layer-7 protocols
-> wintrust - Cryptography and trust verifications
-> advpack - INF file based installation engine
-> imagehlp - PE binary file manipulations, signed file handling
-> shlwapi - Various shell helper functions
-> vdm - Wine 16-bit compatibility layer
-> comdlg32 - Common dialogs such as open/save/print/font

Remove:
Wine-Rebar



------------------------------
This is up for discussion:

New keywords:
ports - OS specific issues and portability
hardware - Issues communicating with HW such as serial/parallel/cdrom/usb
integration - Bugs related to Wine integration into OS (menu, MIME-types, look)
ipc - Communication between Wine processes or app tasks/processes/threads

New components:
-> fonts - Wine fonts
-> ntdll - NT-native API implementation
-> wineserver - The Wine "kernel"
-> build-env - Configure, Makefile and all related scripts


Need to reclassify bugs before removing:
wine-binary ->
wine-ipc ->
wine-gui ->
wine-patches ->
wine-ports ->
wine-multimedia ->
wine-net ->
wine-resources ->


Need ideas
wine-dotnet -> (should probably replace with mscoree and add "dotnet" keyword)
wine-files -> (keyword "filesystem"? Not many bugs but pretty important)


Vitaliy.


From alexd4 at inbox.lv  Sun Dec 23 00:37:05 2007
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Sat, 22 Dec 2007 22:37:05 -0800
Subject: skype regression (kernel32 / winedos)
Message-ID: <476E0211.3050401@inbox.lv>

Hi.

Unfortunately, Skype stopped working in git wine, it crashes shortly after 
start. Commit found via bisect:

http://source.winehq.org/git/wine.git/?a=commit;h=e2a366ce338d5b6b0f3c8962d70134f8d4e87f3b
kernel32: Forward interrupts in 32-bit code to winedos too

last messages with +io,+int:

warn:int:DOSVM_GetBuiltinHandler int1 not implemented, returning dummy handler
warn:int:DOSVM_GetBuiltinHandler int1 not implemented, returning dummy handler
warn:int:DOSVM_GetBuiltinHandler int1 not implemented, returning dummy handler
err:seh:raise_exception Exception frame is not in stack limits => unable to 
dispatch exception.
fixme:ntdll:RtlNtStatusToDosErrorNoTeb no mapping for 8000000a

Skype ver 3.5.0.239, wine mode - WinME


From truiken at gmail.com  Sat Dec 22 14:55:39 2007
From: truiken at gmail.com (James Hawkins)
Date: Sat, 22 Dec 2007 14:55:39 -0600
Subject: ole32: Fix a failed call to DllGetClassObject while retrieving
	class object interface pointer.
In-Reply-To: <b4cc5a3d0712221025g3ba44bcay14f02396813c62a1@mail.gmail.com>
References: <b4cc5a3d0712200653t738a43c4rcbd00ff8e779e128@mail.gmail.com>
	<476ABF8B.1080509@codeweavers.com>
	<b4cc5a3d0712220746y4a883afau649a5f22aec8a59@mail.gmail.com>
	<22821af30712220906o2b313fe6oc1fbea0657f92f58@mail.gmail.com>
	<b4cc5a3d0712221025g3ba44bcay14f02396813c62a1@mail.gmail.com>
Message-ID: <22821af30712221255h4778df15v9d714eae492d8ef5@mail.gmail.com>

On Dec 22, 2007 12:25 PM, Huang, Zhangrong <hzhrong at gmail.com> wrote:
> 2007/12/23, James Hawkins <truiken at gmail.com>:
>
> > On Dec 22, 2007 9:46 AM, Huang, Zhangrong <hzhrong at gmail.com> wrote:
> > > Hi,
> > > Sorry for the delay.
> > > Here is a test, pls import the attached registry files, and copy
> > > native activeds.dll, adsldpc.dll,
> > > adsldp.dll to your windows system32 dir, and patch
> > > wine/dlls/ole32/tests/moniker.c
> > >
> > > Then run the test:
> > > $ ../../../wine ole32_test.exe.so moniker
> > > err:ole:apartment_getclassobject DllGetClassObject returned error 0x80004002
> > > err:ole:create_server class {228d9a81-c302-11cf-9aa4-00aa004a5691} not
> > > registered
> > > fixme:ole:CoGetClassObject CLSCTX_REMOTE_SERVER not supported
> > > err:ole:CoGetClassObject no class object
> > > {228d9a81-c302-11cf-9aa4-00aa004a5691} could be created for context
> > > 0x15
> > > moniker.c:783: Test failed: ****************LDAP**************
> > > moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.
> > >
> > > after my patch:
> > > $ ../../../wine ole32_test.exe.so moniker
> > > moniker.c:783: Test failed: ****************LDAP**************
> > > moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.
> > >
> > > Although the test failed, but loading class
> > > {228d9a81-c302-11cf-9aa4-00aa004a5691} success.
> > >
> > >
> > > 2007/12/21, Robert Shearman <rob at codeweavers.com>:
> > > > Huang, Zhangrong wrote:
> > > > > See dlls/ole32/compobj.c,
> > > > >
> > > > > static HRESULT apartment_getclassobject(struct apartment *apt, LPCWSTR dllpath,
> > > > >                                         BOOL apartment_threaded,
> > > > >                                         REFCLSID rclsid, REFIID riid,
> > > > > void **ppv)
> > > > > {
> > > > > ...................
> > > > >     if (SUCCEEDED(hr))
> > > > >     {
> > > > > ..................
> > > > >         TRACE("calling DllGetClassObject %p\n",
> > > > > apartment_loaded_dll->dll->DllGetClassObject);
> > > > >         /* OK: get the ClassObject */
> > > > >         hr = apartment_loaded_dll->dll->DllGetClassObject(rclsid, riid, ppv);
> > > > >                                                                   ^^^^
> > > > >         if (hr != S_OK)
> > > > >             ERR("DllGetClassObject returned error 0x%08x\n", hr);
> > > > >     }
> > > > > ..............
> > > > > }
> > > > >
> > > > > Reference to http://msdn2.microsoft.com/en-us/library/ms680760.aspx,
> > > > >
> > > > > riid
> > > > >
> > > > >     [in] Reference to the identifier of the interface that the caller
> > > > >     is to use to communicate with the class object. Usually, this is
> > > > >     IID_IClassFactory (defined in the OLE headers as the interface
> > > > >     identifier for IClassFactory).
> > > > >
> > > >
> > > > This doesn't mean anything other than CoCreateInstance is usually used
> > > > instead of CoGetClassObject (and CoCreateInstance always passes in
> > > > IID_IClassFactory for the IID).
> > >
> > > It's failed when calling MkParseDisplayName.
> > >
> > > >
> > > > > We can't pass riid to DllGetClassObject directly sometimes, causes some dlls'
> > > > > DllGetClassObject (like native adsldp.dll) can only return reference-counted
> > > > > pointer to class factory via IID_IClassFactory, for retrieving the
> > > > > pointer to the
> > > > > class object interface requested in riid, we must try another way.
> > > > >
> > > >
> > > > Thank you for your patch, but this behaviour seems a little strange and
> > > > needs a little more investigation before I am happy that it is correct.
> > > > What parameters are being passed in to CoGetClassObject to cause the
> > > > call to fail for you?
> > >
> > > That's how MS does, I see this strange behaviour happening through
> > > assembly debugging.
> > > First time calling DllGetClassObject using riid, and it's failed, then
> > > trying IID_IClassFactory.
> > >
> >
> > Disassembling what?
>
> Native ole32.dll, MkParseDisplayName calls adsldp.dll's
> DllGetClassObject twice,
> frist using IID_IParseDisplayName, second using IID_IClassFactory.
>
>

Disassembling native Windows binaries is not allowed in this project,
so I'm afraid none of your patches can be accepted.

-- 
James Hawkins


From truiken at gmail.com  Sat Dec 22 15:03:16 2007
From: truiken at gmail.com (James Hawkins)
Date: Sat, 22 Dec 2007 15:03:16 -0600
Subject: New bugzilla components (round 3)
In-Reply-To: <476D5D59.8050809@kievinfo.com>
References: <476D5D59.8050809@kievinfo.com>
Message-ID: <22821af30712221303p25e65b38u58be489b8f21d2d8@mail.gmail.com>

On Dec 22, 2007 12:54 PM, Vitaliy Margolen <wine-devel at kievinfo.com> wrote:
> Ok we talked and talked and talked and where did it all go? Where are the
> agreed upon changes?
>
> If we can't agree on everything, then lets do parts that everyone is ok
> with. Then decide on more changes.
>
>
> So far this what everyone was happy with:
>
> wine-misc -> unknown (default selection)
>
> test -> test (change description to "Conformance tests")
> wine-advapi32 -> advapi32
> wine-atl -> atl
> wine-comctl32 -> comctl32
> wine-console -> console
> wine-crypt32 -> crypt32
> wine-dbghelp -> dbghelp
> wine-debug -> winedbg
> wine-directx* -> directx*
> wine-documentation -> documentation
> wine-dos -> dos
> wine-gdi-(printing) -> gdi32
> wine-gdiplus -> gdiplus
> wine-help -> hhctrl - Help viewer implementation
> wine-kernel -> kernel32
> wine-loader ->loader
> wine-msi -> msi
> wine-msvcrt -> msvcrt
> wine-msxml -> msxml3
> wine-ole -> ole
> wine-opengl -> opengl
> wine-quartz -> quartz
> wine-richedit -> richedit
> wine-setupapi -> setupapi
> wine-shdocvw -> shdocvw
> wine-shell32 -> shell32
> wine-urlmon -> urlmon
> wine-user -> user32
> wine-usp10.dll -> usp10
> wine-winelib -> winelib
> wine-x11driver -> x11driver
>
> Add new components:
> -> wininet - Internet connectivity and Layer-7 protocols
> -> wintrust - Cryptography and trust verifications
> -> advpack - INF file based installation engine
> -> imagehlp - PE binary file manipulations, signed file handling
> -> shlwapi - Various shell helper functions
> -> vdm - Wine 16-bit compatibility layer
> -> comdlg32 - Common dialogs such as open/save/print/font
>
> Remove:
> Wine-Rebar
>

Looks good.  Can we get confirmation from a bugzilla admin when work
on these changes has started?

-- 
James Hawkins


From maarten at codeweavers.com  Sat Dec 22 18:57:00 2007
From: maarten at codeweavers.com (Maarten Lankhorst)
Date: Sun, 23 Dec 2007 01:57:00 +0100
Subject: ole32: Fix a failed call to DllGetClassObject while retrieving
	class object interface pointer.
In-Reply-To: <22821af30712221255h4778df15v9d714eae492d8ef5@mail.gmail.com>
References: <b4cc5a3d0712200653t738a43c4rcbd00ff8e779e128@mail.gmail.com>	<476ABF8B.1080509@codeweavers.com>	<b4cc5a3d0712220746y4a883afau649a5f22aec8a59@mail.gmail.com>	<22821af30712220906o2b313fe6oc1fbea0657f92f58@mail.gmail.com>	<b4cc5a3d0712221025g3ba44bcay14f02396813c62a1@mail.gmail.com>
	<22821af30712221255h4778df15v9d714eae492d8ef5@mail.gmail.com>
Message-ID: <476DB25C.8080200@codeweavers.com>

James Hawkins schreef:
> On Dec 22, 2007 12:25 PM, Huang, Zhangrong <hzhrong at gmail.com> wrote:
>   
>> 2007/12/23, James Hawkins <truiken at gmail.com>
>>> On Dec 22, 2007 9:46 AM, Huang, Zhangrong <hzhrong at gmail.com> wrote:
>>>       
>>>> Hi,
>>>> Sorry for the delay.
>>>> Here is a test, pls import the attached registry files, and copy
>>>> native activeds.dll, adsldpc.dll,
>>>> adsldp.dll to your windows system32 dir, and patch
>>>> wine/dlls/ole32/tests/moniker.c
>>>>
>>>> Then run the test:
>>>> $ ../../../wine ole32_test.exe.so moniker
>>>> err:ole:apartment_getclassobject DllGetClassObject returned error 0x80004002
>>>> err:ole:create_server class {228d9a81-c302-11cf-9aa4-00aa004a5691} not
>>>> registered
>>>> fixme:ole:CoGetClassObject CLSCTX_REMOTE_SERVER not supported
>>>> err:ole:CoGetClassObject no class object
>>>> {228d9a81-c302-11cf-9aa4-00aa004a5691} could be created for context
>>>> 0x15
>>>> moniker.c:783: Test failed: ****************LDAP**************
>>>> moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.
>>>>
>>>> after my patch:
>>>> $ ../../../wine ole32_test.exe.so moniker
>>>> moniker.c:783: Test failed: ****************LDAP**************
>>>> moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.
>>>>
>>>> Although the test failed, but loading class
>>>> {228d9a81-c302-11cf-9aa4-00aa004a5691} success.
>>>>
>>>>
>>>> 2007/12/21, Robert Shearman <rob at codeweavers.com>:
>>>>         
>>>>> Huang, Zhangrong wrote:
>>>>>           
>>>>>> See dlls/ole32/compobj.c,
>>>>>>
>>>>>> static HRESULT apartment_getclassobject(struct apartment *apt, LPCWSTR dllpath,
>>>>>>                                         BOOL apartment_threaded,
>>>>>>                                         REFCLSID rclsid, REFIID riid,
>>>>>> void **ppv)
>>>>>> {
>>>>>> ...................
>>>>>>     if (SUCCEEDED(hr))
>>>>>>     {
>>>>>> ..................
>>>>>>         TRACE("calling DllGetClassObject %p\n",
>>>>>> apartment_loaded_dll->dll->DllGetClassObject);
>>>>>>         /* OK: get the ClassObject */
>>>>>>         hr = apartment_loaded_dll->dll->DllGetClassObject(rclsid, riid, ppv);
>>>>>>                                                                   ^^^^
>>>>>>         if (hr != S_OK)
>>>>>>             ERR("DllGetClassObject returned error 0x%08x\n", hr);
>>>>>>     }
>>>>>> ..............
>>>>>> }
>>>>>>
>>>>>> Reference to http://msdn2.microsoft.com/en-us/library/ms680760.aspx,
>>>>>>
>>>>>> riid
>>>>>>
>>>>>>     [in] Reference to the identifier of the interface that the caller
>>>>>>     is to use to communicate with the class object. Usually, this is
>>>>>>     IID_IClassFactory (defined in the OLE headers as the interface
>>>>>>     identifier for IClassFactory).
>>>>>>
>>>>>>             
>>>>> This doesn't mean anything other than CoCreateInstance is usually used
>>>>> instead of CoGetClassObject (and CoCreateInstance always passes in
>>>>> IID_IClassFactory for the IID).
>>>>>           
>>>> It's failed when calling MkParseDisplayName.
>>>>
>>>>         
>>>>>> We can't pass riid to DllGetClassObject directly sometimes, causes some dlls'
>>>>>> DllGetClassObject (like native adsldp.dll) can only return reference-counted
>>>>>> pointer to class factory via IID_IClassFactory, for retrieving the
>>>>>> pointer to the
>>>>>> class object interface requested in riid, we must try another way.
>>>>>>
>>>>>>             
>>>>> Thank you for your patch, but this behaviour seems a little strange and
>>>>> needs a little more investigation before I am happy that it is correct.
>>>>> What parameters are being passed in to CoGetClassObject to cause the
>>>>> call to fail for you?
>>>>>           
>>>> That's how MS does, I see this strange behaviour happening through
>>>> assembly debugging.
>>>> First time calling DllGetClassObject using riid, and it's failed, then
>>>> trying IID_IClassFactory.
>>>>
>>>>         
>>> Disassembling what?
>>>       
>> Native ole32.dll, MkParseDisplayName calls adsldp.dll's
>> DllGetClassObject twice,
>> frist using IID_IParseDisplayName, second using IID_IClassFactory.
>>
>>
>>     
>
> Disassembling native Windows binaries is not allowed in this project,
> so I'm afraid none of your patches can be accepted
This is not the first time such disassemble occurs, I think it should be
made more clear that disassembly is not allowed in the wine project.

After looking at the wine faq, I only see disassembling mentioned once
in "Who can't contribute to Wine?", not even in a full sentence. Perhaps
it should be made prominent in the documentation about 'sending patches'
and debugging parts, and also give it a seperate mentioning in the wiki?

-Maarten


From plr.vincent at gmail.com  Sat Dec 22 14:48:49 2007
From: plr.vincent at gmail.com (Vincent Pelletier)
Date: Sat, 22 Dec 2007 21:48:49 +0100
Subject: Fix build when valgrind header is present but does not define
	VALGRIND_MAKE_WRITABLE
Message-ID: <6453447c0712221248u45f7c287vda7042fb722d505@mail.gmail.com>

Fixes gcc error:

signal_i386.o: In function `setup_exception':
/home/vincent/git/wine/dlls/ntdll/signal_i386.c:940: undefined
reference to `VALGRIND_MAKE_WRITABLE'
collect2: ld returned 1 exit status

Others uses of this constant are already checked this way.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: fix_valgrind_ifdef.diff
Type: text/x-diff
Size: 524 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071222/58a300f3/attachment.diff 

From chris.kcat at gmail.com  Sat Dec 22 19:36:47 2007
From: chris.kcat at gmail.com (Chris Robinson)
Date: Sat, 22 Dec 2007 17:36:47 -0800
Subject: bugfix for bug #6994
In-Reply-To: <op.t3riyfhiqeis3t@alexei-desktop>
References: <op.t3riyfhiqeis3t@alexei-desktop>
Message-ID: <200712221736.47666.chris.kcat@gmail.com>

On Saturday 22 December 2007 04:43:17 pm Alexei Slepov wrote:
> We can't use ordinary backbuffer to render textures, which size is more
> than
> size of the screen. For example, if the screen size is 800x600, we can't
> render background texture, which size is 1024x1024. So, if we are using
> backbuffer, we see only part of texture, which size is exactly 800x600.
> The only way to make the application working properly is to use pbuffer.

This is what the OffscreenRenderMethod option is for. If it's set to 
backbuffer, wined3d needs to use the backbuffer as well as it can. If you 
need to use pbuffers, set it to pbuffer (which I believe is the default?). Or 
if the card supports it, use fbo, which is more flexible (and needed for some 
of D3D9's capabilities, IIRC).


From truiken at gmail.com  Sat Dec 22 21:12:18 2007
From: truiken at gmail.com (James Hawkins)
Date: Sat, 22 Dec 2007 21:12:18 -0600
Subject: ole32: Fix a failed call to DllGetClassObject while retrieving
	class object interface pointer.
In-Reply-To: <476DB25C.8080200@codeweavers.com>
References: <b4cc5a3d0712200653t738a43c4rcbd00ff8e779e128@mail.gmail.com>
	<476ABF8B.1080509@codeweavers.com>
	<b4cc5a3d0712220746y4a883afau649a5f22aec8a59@mail.gmail.com>
	<22821af30712220906o2b313fe6oc1fbea0657f92f58@mail.gmail.com>
	<b4cc5a3d0712221025g3ba44bcay14f02396813c62a1@mail.gmail.com>
	<22821af30712221255h4778df15v9d714eae492d8ef5@mail.gmail.com>
	<476DB25C.8080200@codeweavers.com>
Message-ID: <22821af30712221912y3643fc30y607ae67de6cb0f68@mail.gmail.com>

On Dec 22, 2007 6:57 PM, Maarten Lankhorst <maarten at codeweavers.com> wrote:
> James Hawkins schreef:
>
> > On Dec 22, 2007 12:25 PM, Huang, Zhangrong <hzhrong at gmail.com> wrote:
> >
> >> 2007/12/23, James Hawkins <truiken at gmail.com>
> >>> On Dec 22, 2007 9:46 AM, Huang, Zhangrong <hzhrong at gmail.com> wrote:
> >>>
> >>>> Hi,
> >>>> Sorry for the delay.
> >>>> Here is a test, pls import the attached registry files, and copy
> >>>> native activeds.dll, adsldpc.dll,
> >>>> adsldp.dll to your windows system32 dir, and patch
> >>>> wine/dlls/ole32/tests/moniker.c
> >>>>
> >>>> Then run the test:
> >>>> $ ../../../wine ole32_test.exe.so moniker
> >>>> err:ole:apartment_getclassobject DllGetClassObject returned error 0x80004002
> >>>> err:ole:create_server class {228d9a81-c302-11cf-9aa4-00aa004a5691} not
> >>>> registered
> >>>> fixme:ole:CoGetClassObject CLSCTX_REMOTE_SERVER not supported
> >>>> err:ole:CoGetClassObject no class object
> >>>> {228d9a81-c302-11cf-9aa4-00aa004a5691} could be created for context
> >>>> 0x15
> >>>> moniker.c:783: Test failed: ****************LDAP**************
> >>>> moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.
> >>>>
> >>>> after my patch:
> >>>> $ ../../../wine ole32_test.exe.so moniker
> >>>> moniker.c:783: Test failed: ****************LDAP**************
> >>>> moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.
> >>>>
> >>>> Although the test failed, but loading class
> >>>> {228d9a81-c302-11cf-9aa4-00aa004a5691} success.
> >>>>
> >>>>
> >>>> 2007/12/21, Robert Shearman <rob at codeweavers.com>:
> >>>>
> >>>>> Huang, Zhangrong wrote:
> >>>>>
> >>>>>> See dlls/ole32/compobj.c,
> >>>>>>
> >>>>>> static HRESULT apartment_getclassobject(struct apartment *apt, LPCWSTR dllpath,
> >>>>>>                                         BOOL apartment_threaded,
> >>>>>>                                         REFCLSID rclsid, REFIID riid,
> >>>>>> void **ppv)
> >>>>>> {
> >>>>>> ...................
> >>>>>>     if (SUCCEEDED(hr))
> >>>>>>     {
> >>>>>> ..................
> >>>>>>         TRACE("calling DllGetClassObject %p\n",
> >>>>>> apartment_loaded_dll->dll->DllGetClassObject);
> >>>>>>         /* OK: get the ClassObject */
> >>>>>>         hr = apartment_loaded_dll->dll->DllGetClassObject(rclsid, riid, ppv);
> >>>>>>                                                                   ^^^^
> >>>>>>         if (hr != S_OK)
> >>>>>>             ERR("DllGetClassObject returned error 0x%08x\n", hr);
> >>>>>>     }
> >>>>>> ..............
> >>>>>> }
> >>>>>>
> >>>>>> Reference to http://msdn2.microsoft.com/en-us/library/ms680760.aspx,
> >>>>>>
> >>>>>> riid
> >>>>>>
> >>>>>>     [in] Reference to the identifier of the interface that the caller
> >>>>>>     is to use to communicate with the class object. Usually, this is
> >>>>>>     IID_IClassFactory (defined in the OLE headers as the interface
> >>>>>>     identifier for IClassFactory).
> >>>>>>
> >>>>>>
> >>>>> This doesn't mean anything other than CoCreateInstance is usually used
> >>>>> instead of CoGetClassObject (and CoCreateInstance always passes in
> >>>>> IID_IClassFactory for the IID).
> >>>>>
> >>>> It's failed when calling MkParseDisplayName.
> >>>>
> >>>>
> >>>>>> We can't pass riid to DllGetClassObject directly sometimes, causes some dlls'
> >>>>>> DllGetClassObject (like native adsldp.dll) can only return reference-counted
> >>>>>> pointer to class factory via IID_IClassFactory, for retrieving the
> >>>>>> pointer to the
> >>>>>> class object interface requested in riid, we must try another way.
> >>>>>>
> >>>>>>
> >>>>> Thank you for your patch, but this behaviour seems a little strange and
> >>>>> needs a little more investigation before I am happy that it is correct.
> >>>>> What parameters are being passed in to CoGetClassObject to cause the
> >>>>> call to fail for you?
> >>>>>
> >>>> That's how MS does, I see this strange behaviour happening through
> >>>> assembly debugging.
> >>>> First time calling DllGetClassObject using riid, and it's failed, then
> >>>> trying IID_IClassFactory.
> >>>>
> >>>>
> >>> Disassembling what?
> >>>
> >> Native ole32.dll, MkParseDisplayName calls adsldp.dll's
> >> DllGetClassObject twice,
> >> frist using IID_IParseDisplayName, second using IID_IClassFactory.
> >>
> >>
> >>
> >
> > Disassembling native Windows binaries is not allowed in this project,
> > so I'm afraid none of your patches can be accepted
> This is not the first time such disassemble occurs, I think it should be
> made more clear that disassembly is not allowed in the wine project.
>
> After looking at the wine faq, I only see disassembling mentioned once
> in "Who can't contribute to Wine?", not even in a full sentence. Perhaps
> it should be made prominent in the documentation about 'sending patches'
> and debugging parts, and also give it a seperate mentioning in the wiki?
>
> -Maarten
>

You could paste it all over winehq.org and the docs and it'll still happen.

-- 
James Hawkins


From hzhrong at gmail.com  Sat Dec 22 22:37:05 2007
From: hzhrong at gmail.com (Huang, Zhangrong)
Date: Sun, 23 Dec 2007 12:37:05 +0800
Subject: ole32: Fix a failed call to DllGetClassObject while retrieving
	class object interface pointer.
In-Reply-To: <22821af30712221912y3643fc30y607ae67de6cb0f68@mail.gmail.com>
References: <b4cc5a3d0712200653t738a43c4rcbd00ff8e779e128@mail.gmail.com>
	<476ABF8B.1080509@codeweavers.com>
	<b4cc5a3d0712220746y4a883afau649a5f22aec8a59@mail.gmail.com>
	<22821af30712220906o2b313fe6oc1fbea0657f92f58@mail.gmail.com>
	<b4cc5a3d0712221025g3ba44bcay14f02396813c62a1@mail.gmail.com>
	<22821af30712221255h4778df15v9d714eae492d8ef5@mail.gmail.com>
	<476DB25C.8080200@codeweavers.com>
	<22821af30712221912y3643fc30y607ae67de6cb0f68@mail.gmail.com>
Message-ID: <b4cc5a3d0712222037t35033191wac9ad92717b58dd4@mail.gmail.com>

hi,

2007/12/23, James Hawkins <truiken at gmail.com>:
> On Dec 22, 2007 6:57 PM, Maarten Lankhorst <maarten at codeweavers.com> wrote:
> > James Hawkins schreef:
> >
> > > On Dec 22, 2007 12:25 PM, Huang, Zhangrong <hzhrong at gmail.com> wrote:
> > >
> > >> 2007/12/23, James Hawkins <truiken at gmail.com>
> > >>>>>

> > >>>>
> > >>> Disassembling what?
> > >>>
> > >> Native ole32.dll, MkParseDisplayName calls adsldp.dll's
> > >> DllGetClassObject twice,
> > >> frist using IID_IParseDisplayName, second using IID_IClassFactory.
> > >>
> > >>
> > >>
> > >
> > > Disassembling native Windows binaries is not allowed in this project,
> > > so I'm afraid none of your patches can be accepted
> > This is not the first time such disassemble occurs, I think it should be
> > made more clear that disassembly is not allowed in the wine project.

Thank you for mentioning that. But, I think that's kind of mixing up.
I didn't do anything like disassembly code to source code translation.
I just saw how native binaries work when debugging my app in Windows.

I didn't have much knowledge about COM, so I searched MSDN and found
some useful info about DllGetClassObject, then I wrote the patch, it's
quite clean.

Why I mentioning disassembly is just giving a sample that how to call
DllGetClassObject,
it doesn't mean I have done anything illegal to wine.

Anyway, have you tried my testcase? Then how can we fix the problem?


> >
> > After looking at the wine faq, I only see disassembling mentioned once
> > in "Who can't contribute to Wine?", not even in a full sentence. Perhaps
> > it should be made prominent in the documentation about 'sending patches'
> > and debugging parts, and also give it a seperate mentioning in the wiki?
> >
> > -Maarten
> >
>
> You could paste it all over winehq.org and the docs and it'll still happen.

That could be useful.

>
> --
> James Hawkins
>


-- 
$ apt-get moo
         (__)
         (oo)
   /------\/
  / |    ||
 *  /\---/\
    ~~   ~~
...."Have you mooed today?"...


From zgold550 at gmail.com  Sat Dec 22 23:55:09 2007
From: zgold550 at gmail.com (Zachary Goldberg)
Date: Sun, 23 Dec 2007 00:55:09 -0500
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <689de9370712182318s1c2b6a70ob9b32f244dec3821@mail.gmail.com>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>
	<4767EA9F.2030109@gmx.net>
	<78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com>
	<47681D77.8080007@gmx.net>
	<530468570712181153x55cc68f8uc5898dd07895952a@mail.gmail.com>
	<476871C0.9050102@open-vote.org> <4768788D.7070205@gmx.net>
	<689de9370712182318s1c2b6a70ob9b32f244dec3821@mail.gmail.com>
Message-ID: <b050a5e70712222155h65629ba3j768637c3e51a5219@mail.gmail.com>

On Dec 19, 2007 2:18 AM, Andrew Riedi <andrewriedi at gmail.com> wrote:
> I have sent in a new patch with the same title to address the problems
> discussed in this thread.  Thanks to all of the people who looked over my
> patch and discussed its possible problems.  It should surely help debugging
> Wine in the future, especially if we decide to take advantage of the
> http://wiki.winehq.org/GccVersions page.
>
> --
> Andrew Riedi
>
>
>

Any word on whether or not there are plans to accept this?  I don't
believe i've seen it go through to wine-cvs yet.  I think it might be
useful.

-- 
Zachary Goldberg
Computer Science & Engineering
Electrical Captain of Penn Electric Race Team
School of Engineering at the University of Pennsylvania


From dank at kegel.com  Sun Dec 23 02:31:49 2007
From: dank at kegel.com (Dan Kegel)
Date: Sun, 23 Dec 2007 00:31:49 -0800
Subject: New bugzilla components (round 3)
Message-ID: <a71bd89a0712230031x4cbce75araf7e5a0aff3e521@mail.gmail.com>

vdm is a bit cryptic, could we call it win16 instead?
That's a bit broader, but that's ok.

The other products could use some attention, too.

Wine HQ Apps Database
website-bugs -> appdb-misc

WineHQ Bugzilla
bug list -> delete
comments -> delete
login -> delete
misc-bugs -> bugzilla-misc

WineHQ.com (rename WineHQ.org)
misc-web -> www-misc


