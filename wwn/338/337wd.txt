From dank at kegel.com  Sat Dec  1 00:06:09 2007
From: dank at kegel.com (Dan Kegel)
Date: Fri, 30 Nov 2007 22:06:09 -0800
Subject: ntdll: unload modules based on inter-module dependencies
Message-ID: <a71bd89a0711302206k3d44a9cey5d54a5a4f25457b5@mail.gmail.com>

This patch seems to break wineprefixcreate.


From zac at zacbrown.org  Sat Dec  1 08:41:39 2007
From: zac at zacbrown.org (Zac Brown)
Date: Sat, 01 Dec 2007 09:41:39 -0500
Subject: wininet: Add test for FtpGetCurrentDirectoryA
In-Reply-To: <22821af30711301353s33fd207bm1675aa635e7d2bcb@mail.gmail.com>
References: <475084D4.3090607@zacbrown.org>
	<22821af30711301353s33fd207bm1675aa635e7d2bcb@mail.gmail.com>
Message-ID: <475172A3.5080404@zacbrown.org>

James Hawkins wrote:
> On Nov 30, 2007 3:47 PM, Zac Brown <zac at zacbrown.org> wrote:
>> Hi,
>>
>> Changelog:
>> * Add a test in dlls/wininet/tests/ftp.c for FtpGetCurrentDirectoryA
>>
>> Notes:
>> * This test passes fully without error on Windows XP, with the test compiled by Visual Studio Express C++ 2008.
>> * The functions this test call are currently broken in wine and I am in the process of fixing them myself.
>>
>> Patch is pasted below:
>>
>>
>> ---
>>  dlls/wininet/tests/ftp.c |   84 +++++++++++++++++++++++++++++++++++++++++++++-
>>  1 files changed, 83 insertions(+), 1 deletions(-)
>>
>> diff --git a/dlls/wininet/tests/ftp.c b/dlls/wininet/tests/ftp.c
>> index 6d03fb8..f6517b0 100644
>> --- a/dlls/wininet/tests/ftp.c
>> +++ b/dlls/wininet/tests/ftp.c
>> @@ -691,6 +691,85 @@ static void test_command(HINTERNET hFtp, HINTERNET hConnect)
>>      }
>>  }
>>
>> +static void test_get_current_dir(HINTERNET hFtp, HINTERNET hConnect)
>> +{
>> +    BOOL    bRet;
>> +    DWORD   dwCurrentDirectory = MAX_PATH;
>> +    CHAR    lpszCurrentDirectory[MAX_PATH];
>> +
>> +    /* change directories to get a more interesting pwd */
>> +    bRet = FtpCommandA(hFtp, FALSE, FTP_TRANSFER_TYPE_ASCII, "CWD pub/", 0, NULL);
>> +    if(bRet == FALSE)
>> +    {
>> +        trace("Failed to change directories in test_get_current_dir(HINTERNET hFtp).\n");
>> +        return;
>> +    }
>> +
>> +    /* test with all NULL arguments */
>> +    SetLastError(0xdeadbeef);
>> +    bRet = FtpGetCurrentDirectoryA( NULL, NULL, 0 );
>> +    ok ( bRet == FALSE, "Expected FtpGetCurrentDirectoryA to fail\n" );
>> +    ok ( GetLastError() == ERROR_INVALID_HANDLE, "Expected ERROR_INVALID_HANDLE, got: %d\n", GetLastError());
>> +
>> +    /* test with NULL parameters instead of expected LPSTR/LPDWORD */
>> +    SetLastError(0xdeadbeef);
>> +    bRet = FtpGetCurrentDirectoryA( hFtp, NULL, 0 );
>> +    ok ( bRet == FALSE, "Expected FtpGetCurrentDirectoryA to fail\n" );
>> +    ok ( GetLastError() == ERROR_INVALID_PARAMETER, "Expected ERROR_INVALID_PARAMETER, got: %d\n", GetLastError());
>> +
>> +    /* test with no valid handle and valid parameters */
>> +    SetLastError(0xdeadbeef);
>> +    bRet = FtpGetCurrentDirectoryA( NULL, lpszCurrentDirectory, &dwCurrentDirectory );
>> +    ok ( bRet == FALSE, "Expected FtpGetCurrentDirectoryA to fail\n" );
>> +    ok ( GetLastError() == ERROR_INVALID_HANDLE, "Expected ERROR_INVALID_HANDLE, got: %d\n", GetLastError());
>> +
>> +    /* test with invalid dwCurrentDirectory and all other parameters correct */
>> +    SetLastError(0xdeadbeef);
>> +    bRet = FtpGetCurrentDirectoryA( hFtp, lpszCurrentDirectory, 0 );
>> +    ok ( bRet == FALSE, "Expected FtpGetCurrentDirectoryA to fail\n" );
>> +    ok ( GetLastError() == ERROR_INVALID_PARAMETER, "Expected ERROR_INVALID_PARAMETER, got: %d\n", GetLastError());
>> +
>> +    /* test with invalid lpszCurrentDirectory and all other parameters correct */
>> +    SetLastError(0xdeadbeef);
>> +    bRet = FtpGetCurrentDirectoryA( hFtp, NULL, &dwCurrentDirectory );
>> +    ok ( bRet == FALSE, "Expected FtpGetCurrentDirectoryA to fail\n" );
>> +    ok ( GetLastError() == ERROR_INSUFFICIENT_BUFFER, "Expected ERROR_INSUFFICIENT_BUFFER, got: %d\n", GetLastError());
>> +
>> +    /* test to show it checks the handle type */
>> +    SetLastError(0xdeadbeef);
>> +    bRet = FtpGetCurrentDirectoryA( hConnect, lpszCurrentDirectory, &dwCurrentDirectory );
>> +    ok ( bRet == FALSE, "Expected FtpGetCurrentDirectoryA to fail\n" );
>> +    ok ( GetLastError() == ERROR_INTERNET_INCORRECT_HANDLE_TYPE,
>> +    "Expected ERROR_INTERNET_INCORRECT_HANDLE_TYPE, got: %d\n", GetLastError());
>> +
>> +    /* test for the current directory with legitimate values */
>> +    SetLastError(0xdeadbeef);
>> +    bRet = FtpGetCurrentDirectoryA( hFtp, lpszCurrentDirectory, &dwCurrentDirectory );
>> +    ok ( bRet == TRUE, "Expected FtpGetCurrentDirectoryA to pass\n" );
>> +    ok ( lstrcmp(lpszCurrentDirectory, "/pub") == 0, "Expected returned value \"%s\" to match \"%s\" \n", (char*)lpszCurrentDirectory, "/pub");
>> +    ok ( GetLastError() == ERROR_SUCCESS, "Expected ERROR_SUCCESS, got: %d\n", GetLastError());
>> +
>> +
>> +    /* test for the current directory with a size only large enough to
>> +     * fit the string and not the null terminating character */
>> +    SetLastError(0xdeadbeef);
>> +    dwCurrentDirectory = 4;
>> +    lpszCurrentDirectory[4] = 'a'; /* set position 4 of the array to something else to make sure a leftover \0 isn't fooling the test */
>> +    bRet = FtpGetCurrentDirectoryA( hFtp, lpszCurrentDirectory, &dwCurrentDirectory );
>> +    ok ( bRet == FALSE, "Expected FtpGetCurrentDirectoryA to fail\n");
>> +    ok ( lstrcmp(lpszCurrentDirectory, "/pub") != 0, "Expected returned value \"%s\" to not match \"%s\" \n", (char*)lpszCurrentDirectory, "/pub");
>> +    ok ( GetLastError() == ERROR_INSUFFICIENT_BUFFER, "Expected ERROR_INSUFFICIENT_BUFFER, got: %d\n", GetLastError());
>> +
>> +    /* test for the current directory with a size large enough to store
>> +     * the expected string as well as the null terminating character */
>> +    SetLastError(0xdeadbeef);
>> +    dwCurrentDirectory = 5;
>> +    bRet = FtpGetCurrentDirectoryA( hFtp, lpszCurrentDirectory, &dwCurrentDirectory );
>> +    ok ( bRet == TRUE, "Expected FtpGetCurrentDirectoryA to pass\n");
>> +    ok ( lstrcmp(lpszCurrentDirectory, "/pub") == 0, "Expected returned value \"%s\" to match \"%s\" \n", (char*)lpszCurrentDirectory, "/pub");
>> +    ok ( GetLastError() == ERROR_SUCCESS, "Expected ERROR_SUCCESS, got: %d\n", GetLastError());
>> +}
>> +
>>  START_TEST(ftp)
>>  {
>>      HANDLE hInternet, hFtp, hHttp;
>> @@ -733,7 +812,10 @@ START_TEST(ftp)
>>      test_removedir(hFtp, hHttp);
>>      test_renamefile(hFtp, hHttp);
>>      test_command(hFtp, hHttp);
>> -
>> +todo_wine
>> +{
>> +    test_get_current_dir(hFtp, hHttp);
>> +}
>>      InternetCloseHandle(hHttp);
>>      InternetCloseHandle(hFtp);
>>      InternetCloseHandle(hInternet);
>>
> 
> You put the todo_wine around each block of ok's that fail, not around
> the whole test function.
> 

Ah ok, I'll fix that and resend.

-Zac


From felix at compsoc.nuigalway.ie  Sat Dec  1 10:26:38 2007
From: felix at compsoc.nuigalway.ie (Darragh Bailey)
Date: Sat, 1 Dec 2007 16:26:38 +0000
Subject: No subject
Message-ID: <20071201162638.GA9935@compsoc.nuigalway.ie>

Cc: 
Bcc: 
Subject: Re: xlviewer install cmdline passed from CreateProcessA to msiexec looks wrong
Reply-To: 
In-Reply-To: <20071124025012.GA27234 at compsoc.nuigalway.ie>

After doing further debugging I've come to the conclusion that the
behaviour found when I was looking at bug 9628 is indeed a bug and have
logged a new one accordingly with as much detail as I thought was
necessary.
http://bugs.winehq.org/show_bug.cgi?id=10618

Basically it turns out that if a program is called via CreateProcessW,
the command line used may not result in the same argv being passed to
the target program as it was called directly.

In this case there was a difference in the argv seen by msiexec
depending on whether it was run directly or called by the setup exe.


Traced the bug to a corner case in the function build_argv in
dlls/kernel32/process.c.

Basically it does not detect the end of the argument correctly when
dealing with the following text.

SETUPEXEPATH=\"C:\\windows\\temp\\IXP030.TMP\\\"

Because of the escaped '\', which should be valid since it is part of a 
directory path, at the end followed by the escaped '"', the function 
thinks that it has just encountered an escaped '"' instead of the end of
the argument.

I'm not 100% sure how to solve this, so I will probably have to run some
tests on windows using the CreateProcessW call and study the argv
received by the target.

I have a feeling that the rule is probably something like:

If in quotes && text before slashes != whitespace && text after quote ==
whitespace:
	then found matching quote


Hopefully I should be able to come up with test cases that will show the
truth of this, and then be able to confirm what the function build_argv
should be testing to catch cases like this.


-- 
Darragh

"Nothing is foolproof to a sufficiently talented fool."


From infyquest at gmail.com  Sat Dec  1 10:54:14 2007
From: infyquest at gmail.com (Vijay Kiran Kamuju)
Date: Sat, 1 Dec 2007 22:24:14 +0530
Subject: Error while compiling the wine-0.9.49 in RedHat Linux
In-Reply-To: <306339.20948.qm@web94403.mail.in2.yahoo.com>
References: <306339.20948.qm@web94403.mail.in2.yahoo.com>
Message-ID: <36bf289b0712010854p5ce0f30cq9d1981660799e34a@mail.gmail.com>

If you could raise a bug in bugzilla, we could discuss it there.
And please attach the config.log to the bugzilla entry.

--
VJ

On Dec 1, 2007 10:38 AM, manish jaiswal <manish.iitm at yahoo.co.in> wrote:
>
> While compiling the wine-0.9.49 I am getting these error.
> Please help me to resolve these error's.
>
> winegcc: gcc failed
> make[2]: *** [winex11.drv.so] Error 2
> make[2]: Leaving directory
> `/home/manish/Desktop/Download/wine-0.9.49/dlls/winex11.drv'
> make[1]: *** [winex11.drv] Error 2
> make[1]: Leaving directory `/home/manish/Desktop/Download/wine-0.9.49/dlls'
> make: *** [dlls] Error 2
>
> Thanking in anticipation.
>
>  with regards:
> Manish
>  ________________________________
>  Get the freedom to save as many mails as you wish. Click here to know how.
>
>
>


From thestig at google.com  Sat Dec  1 12:55:22 2007
From: thestig at google.com (Lei Zhang)
Date: Sat, 1 Dec 2007 10:55:22 -0800
Subject: ntdll: unload modules based on inter-module dependencies
In-Reply-To: <a71bd89a0711302206k3d44a9cey5d54a5a4f25457b5@mail.gmail.com>
References: <a71bd89a0711302206k3d44a9cey5d54a5a4f25457b5@mail.gmail.com>
Message-ID: <558b2f5c0712011055t57d7513an9e05294a265fba76@mail.gmail.com>

On Nov 30, 2007 10:06 PM, Dan Kegel <dank at kegel.com> wrote:
> This patch seems to break wineprefixcreate.
>
>
>

I sent an updated version of the patch that fixes the crash with
wineprefixcreate. Now process_detach() would only follow the
dependencies when it is called from LdrShutdownProcess().


From jjmckenzie51 at sprintpcs.com  Sat Dec  1 13:52:38 2007
From: jjmckenzie51 at sprintpcs.com (James McKenzie)
Date: Sat, 01 Dec 2007 12:52:38 -0700
Subject: Error while compiling the wine-0.9.49 in RedHat Linux
In-Reply-To: <306339.20948.qm@web94403.mail.in2.yahoo.com>
References: <306339.20948.qm@web94403.mail.in2.yahoo.com>
Message-ID: <4751BB86.3040505@sprintpcs.com>

manish jaiswal wrote:
> While compiling the wine-0.9.49 I am getting these error.
> Please help me to resolve these error's.
>
> winegcc: gcc failed
> make[2]: *** [winex11.drv.so] Error 2
> make[2]: Leaving directory
> `/home/manish/Desktop/Download/wine-0.9.49/dlls/winex11.drv'
> make[1]: *** [winex11.drv] Error 2
> make[1]: Leaving directory
> `/home/manish/Desktop/Download/wine-0.9.49/dlls'
> make: *** [dlls] Error 2
>
> Thanking in anticipation.
>
>
Please raise this as a bug in the Wine Bugzilla.  Please advise as the
version of gcc, your operating system and as much detail including any
log files you can provide.

Please also be aware that Wine will NOT build properly with any version
of gcc 4.0

James McKenzie




From winehacker at gmail.com  Sat Dec  1 15:05:08 2007
From: winehacker at gmail.com (Steven Edwards)
Date: Sat, 1 Dec 2007 16:05:08 -0500
Subject: xdg_user_dirs patches
In-Reply-To: <47507783.3090301@gmail.com>
References: <36bf289b0711261649j4cc9747bl7b70e42eb8fd4756@mail.gmail.com>
	<558b2f5c0711281149y77878d39p2124f192aa232eae@mail.gmail.com>
	<87wss2j92v.fsf@wine.dyndns.org>
	<Pine.LNX.4.64.0711301231410.30562@amboise.dolphin>
	<3a768c550711300727q6ff8ea86i9eaafb118f716caf@mail.gmail.com>
	<Pine.LNX.4.64.0711301844180.15903@amboise.dolphin>
	<1196445012.3036.48.camel@dimi.lattica.com>
	<47507783.3090301@gmail.com>
Message-ID: <19e31a080712011305g57beb6abo5d92e48d726ba0ca@mail.gmail.com>

On Nov 30, 2007 3:50 PM, Frank Richter <frank.richter at gmail.com> wrote:
> On 30.11.2007 18:50, Dimi Paun wrote:
> > I guess the preferred solution would be to teach GNOME & KDE
> > about .lnk files.
>
> Or write .desktop files to the Desktop dir.

I agree with Juan having multiple "Desktop" directories does not work
and it will confuse users. Wine already has enough places were we do
that and we should not add even more.

I think teaching them about .lnk files is a better solution. It should not be
to hard to have a mime type of *.lnk that invokes Wine and passes the
shortcut to the link processor. Really all GNOME & KDE need to do
with *.lnk files is have the ability to follow a small part of them to the
binary in question and load the Icon data from the resource section.
The rest can be off loaded to Wine when a user actually clicks one.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From Roy.Decoutere at pandora.be  Sat Dec  1 15:29:20 2007
From: Roy.Decoutere at pandora.be (Roy Decoutere)
Date: Sat, 01 Dec 2007 22:29:20 +0100
Subject: 'Make test' fails for cabinet.dll
Message-ID: <4751D230.7090901@pandora.be>

Hello,

I'm relatively new to Wine and would like to start contributing. So
running 'make test' on my systems seemed like a good beginning. I have a
desktop and a laptop, both running Gentoo with X/fluxbox and a very
similar setup.
On the laptop the tests for cabinet.dll succeed, but on the desktop they
fail with the output below.

make[2]: Entering directory `/usr/src/wine/dlls/cabinet/tests'
../../../tools/runtest -q -P wine -M cabinet.dll -T ../../.. -p
cabinet_test.exe.so extract.c && touch extract.ok
extract.c:623: Test failed: Expected dest\a.txt to not exist
extract.c:665: Test failed: Expected dest\testdir\c.txt to not exist
make[2]: *** [extract.ok] Error 2
make[2]: Leaving directory `/usr/src/wine/dlls/cabinet/tests'


I've checked test.winehq.org and I haven't seen reports of cabinet.dll
failing.
I've also reran the tests on the desktop with a new and clean .wine
folder, but this still has the same result.
It at least happens with 0.9.49 and 0.9.50.

Could somebody give me a hint on how to proceed in figuring this out?

Thanks in advance,
Roy


From thunderbird2k at gmx.net  Sat Dec  1 15:30:56 2007
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Sat, 01 Dec 2007 22:30:56 +0100
Subject: WineD3D: Implement detection of ATI cards with Mesa DRI drivers
	[try	4] (resend)
In-Reply-To: <4751B7DA.2010009@rm.pp.ru>
References: <4744C540.70101@rm.pp.ru> <20071122084248.6860@gmx.net>
	<4751B7DA.2010009@rm.pp.ru>
Message-ID: <20071201213056.196740@gmx.net>

> Hello.
> 
> Some time ago I have sent this patch, but it didn't get accepted. I wonder
> what is the final word on it.
> Was it simply lost, or is not yet satisfactory for inclusion in some way.
> 
> 
> Thanks.
> 

I think I gave a reply on it. I can't easily search it back now but it should be on the wine-devel archives. In short my answer was to use D3DX_CAPABLE first and later on the string checks. The reason is that the GL capabilities can change depending on lets say remote GLX. The renderer string can still be the same.

Roderick
-- 
GMX FreeMail: 1 GB Postfach, 5 E-Mail-Adressen, 10 Free SMS.
Alle Infos und kostenlose Anmeldung: http://www.gmx.net/de/go/freemail


From crwulff at rochester.rr.com  Sat Dec  1 16:27:14 2007
From: crwulff at rochester.rr.com (Chris Wulff)
Date: Sat, 01 Dec 2007 17:27:14 -0500
Subject: user32: Add a FIXME for animated cursors. [try 2]
In-Reply-To: <689de9370712011334m47d64c3fk680a92b3d79d7f43@mail.gmail.com>
References: <689de9370712011334m47d64c3fk680a92b3d79d7f43@mail.gmail.com>
Message-ID: <1196548034.17458.4.camel@cybertron>

There was a patch not all that long ago that actually implemented
animated cursors that I have been using. Does anybody know why it wasn't
accepted? It seems to work pretty well anyway. (I attached it for
reference, but it was submitted on 9/4/2007 by Trent Waddington.) 

On Sat, 2007-12-01 at 13:34 -0800, Andrew Riedi wrote:
> changelog: user32: Add a FIXME for animated cursors.
> 
> Sorry for sending twice.
> 
> There is no need to set hIcon, as it was already set to zero.  Here is
> the correct version.
> 
> -- 
> Andrew Riedi 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: animated_cursors_20070904.patch
Type: text/x-patch
Size: 14187 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071201/c86f6fa8/attachment.bin 

From fgouget at free.fr  Sat Dec  1 19:08:45 2007
From: fgouget at free.fr (Francois Gouget)
Date: Sun, 2 Dec 2007 02:08:45 +0100 (CET)
Subject: xdg_user_dirs patches
In-Reply-To: <19e31a080712011305g57beb6abo5d92e48d726ba0ca@mail.gmail.com>
References: <36bf289b0711261649j4cc9747bl7b70e42eb8fd4756@mail.gmail.com>
	<558b2f5c0711281149y77878d39p2124f192aa232eae@mail.gmail.com>
	<87wss2j92v.fsf@wine.dyndns.org>
	<Pine.LNX.4.64.0711301231410.30562@amboise.dolphin>
	<3a768c550711300727q6ff8ea86i9eaafb118f716caf@mail.gmail.com>
	<Pine.LNX.4.64.0711301844180.15903@amboise.dolphin>
	<1196445012.3036.48.camel@dimi.lattica.com>
	<47507783.3090301@gmail.com>
	<19e31a080712011305g57beb6abo5d92e48d726ba0ca@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0712020204060.25012@amboise.dolphin>

On Sat, 1 Dec 2007, Steven Edwards wrote:
[...]
> I think teaching them about .lnk files is a better solution. It should not be
> to hard to have a mime type of *.lnk that invokes Wine and passes the
> shortcut to the link processor. Really all GNOME & KDE need to do
> with *.lnk files is have the ability to follow a small part of them to the
> binary in question and load the Icon data from the resource section.

Great. Now KDE and Gnome will have a PE loader and windows resource 
parser. Plus when the .lnk points to a document they may have to load 
the Windows registry to see what icon Windows associated with that 
document, especially if that document type is not present in the 
Gnome/KDE MIME database.

Plus, how do you know where 'c:\Program Files\Foo\Bar.exe' is?


[...]
> I agree with Juan having multiple "Desktop" directories does not work
> and it will confuse users. Wine already has enough places were we do
> that and we should not add even more.

What Wine could do is try to sync the Unix and Windows desktops with FAM 
magic, all while not replicating the .lnk files to the Unix desktop.

-- 
Francois Gouget <fgouget at free.fr>              http://fgouget.free.fr/
    Indifference will certainly be the downfall of mankind, but who cares?


From winehacker at gmail.com  Sat Dec  1 21:26:13 2007
From: winehacker at gmail.com (Steven Edwards)
Date: Sat, 1 Dec 2007 22:26:13 -0500
Subject: xdg_user_dirs patches
In-Reply-To: <Pine.LNX.4.64.0712020204060.25012@amboise.dolphin>
References: <36bf289b0711261649j4cc9747bl7b70e42eb8fd4756@mail.gmail.com>
	<558b2f5c0711281149y77878d39p2124f192aa232eae@mail.gmail.com>
	<87wss2j92v.fsf@wine.dyndns.org>
	<Pine.LNX.4.64.0711301231410.30562@amboise.dolphin>
	<3a768c550711300727q6ff8ea86i9eaafb118f716caf@mail.gmail.com>
	<Pine.LNX.4.64.0711301844180.15903@amboise.dolphin>
	<1196445012.3036.48.camel@dimi.lattica.com>
	<47507783.3090301@gmail.com>
	<19e31a080712011305g57beb6abo5d92e48d726ba0ca@mail.gmail.com>
	<Pine.LNX.4.64.0712020204060.25012@amboise.dolphin>
Message-ID: <19e31a080712011926n6a808332n20f78fc25a86c986@mail.gmail.com>

On Dec 1, 2007 8:08 PM, Francois Gouget <fgouget at free.fr> wrote:
> Great. Now KDE and Gnome will have a PE loader and windows resource
> parser. Plus when the .lnk points to a document they may have to load
> the Windows registry to see what icon Windows associated with that
> document, especially if that document type is not present in the
> Gnome/KDE MIME database.

As apple has show recently, having a minimal PE loader and resource
parser does not take a lot of code but we really don't even need
that...

See if my logic makes sense for how this would work. I don't
understand why the document type would not be registered in the MIME
database. I assume that the Windows association information would be
synced everytime the user installs an application and winemenubuilder
is called. Say you have sol.lnk on the desktop
GNOME and KDE should be smart enough to parse sol.lnk and actually
display Solitaire or Solitaire (Windows) or something. This "fake"
shortcut would actually just be resident in memory of the WM process.

> Plus, how do you know where 'c:\Program Files\Foo\Bar.exe' is?

What this means is that on logon or logoff the WM would call our
function and generate these fake Shortcuts for the *.lnk files by
running a copy of winepath after calling the Wine shelllink processor.
The results of winepath would translate 'c:\Program Files\Foo\Bar.exe'
in to '~/.wine/dosdevices/c:/Program Files/Foo/Bar.exe
and pass that to the array in memory containing the "fake" shortcuts.

> What Wine could do is try to sync the Unix and Windows desktops with FAM
> magic, all while not replicating the .lnk files to the Unix desktop.

Yes I am talking about using something like FAM but having it look for
*.lnk changes on the users Linux desktop. Evertime a FAM event occors
such as an install
of a Windows application with a desktop shelllink, the array
containing the "fake" shortcuts in the WM is updated. When the user
logs off, this data is lost. The WM gets to keep the Windows and Linux
Desktop's in sync without having to actually mess with generating new
shortcuts and or confusing the user by having multiple directories.

Thanks
Steven


-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From gav at transgaming.com  Sun Dec  2 00:56:29 2007
From: gav at transgaming.com (Gavriel State)
Date: Sun, 02 Dec 2007 01:56:29 -0500
Subject: TransGaming's dpnet (DirectPlay 8)
In-Reply-To: <200711300851.39309.kai.blin@gmail.com>
References: <4743B72A.5010408@transgaming.com>
	<200711271118.59174.kai.blin@gmail.com>
	<474CA3A6.4090209@transgaming.com>
	<200711300851.39309.kai.blin@gmail.com>
Message-ID: <4752571D.4040605@transgaming.com>

An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20071202/827e9db0/attachment.htm 

From tom at dbservice.com  Sun Dec  2 05:38:00 2007
From: tom at dbservice.com (Tomas Carnecky)
Date: Sun, 02 Dec 2007 12:38:00 +0100
Subject: Error while compiling the wine-0.9.49 in RedHat Linux
In-Reply-To: <4751BB86.3040505@sprintpcs.com>
References: <306339.20948.qm@web94403.mail.in2.yahoo.com>
	<4751BB86.3040505@sprintpcs.com>
Message-ID: <47529918.6000103@dbservice.com>

James McKenzie wrote:
> Please also be aware that Wine will NOT build properly with any version
> of gcc 4.0
> 

Can you elaborate? I have been building wine with gcc-4.* since forever
and never had any problems with that. Currently I'm using gcc 4.2.2
(Gentoo 4.2.2 p1.0).

tom


From patrol at sinus.cz  Sun Dec  2 06:01:04 2007
From: patrol at sinus.cz (Pavel Troller)
Date: Sun, 2 Dec 2007 13:01:04 +0100
Subject: Error while compiling the wine-0.9.49 in RedHat Linux
In-Reply-To: <47529918.6000103@dbservice.com>
References: <306339.20948.qm@web94403.mail.in2.yahoo.com>
	<4751BB86.3040505@sprintpcs.com> <47529918.6000103@dbservice.com>
Message-ID: <20071202120104.GA27875@tangens.sinus.cz>

> James McKenzie wrote:
> > Please also be aware that Wine will NOT build properly with any version
> > of gcc 4.0
> > 
> 
> Can you elaborate? I have been building wine with gcc-4.* since forever
> and never had any problems with that. Currently I'm using gcc 4.2.2
> (Gentoo 4.2.2 p1.0).
> 
> tom
> 
Hi!
  Me too. Maybe James references just 4.0.x, not 4.1/4.2...
     With regards, Pavel Troller


From marcus at jet.franken.de  Sun Dec  2 06:15:40 2007
From: marcus at jet.franken.de (Marcus Meissner)
Date: Sun, 2 Dec 2007 13:15:40 +0100
Subject: Error while compiling the wine-0.9.49 in RedHat Linux
In-Reply-To: <20071202120104.GA27875@tangens.sinus.cz>
References: <306339.20948.qm@web94403.mail.in2.yahoo.com>
	<4751BB86.3040505@sprintpcs.com> <47529918.6000103@dbservice.com>
	<20071202120104.GA27875@tangens.sinus.cz>
Message-ID: <20071202121540.GA29302@galeere>

On Sun, Dec 02, 2007 at 01:01:04PM +0100, Pavel Troller wrote:
> > James McKenzie wrote:
> > > Please also be aware that Wine will NOT build properly with any version
> > > of gcc 4.0
> > > 
> > 
> > Can you elaborate? I have been building wine with gcc-4.* since forever
> > and never had any problems with that. Currently I'm using gcc 4.2.2
> > (Gentoo 4.2.2 p1.0).
> > 
> > tom
> > 
> Hi!
>   Me too. Maybe James references just 4.0.x, not 4.1/4.2...
>      With regards, Pavel Troller

The gcc 4.0 thing is a _fully_working_ compilation which however SafeDisc
does not like.

We need more context before the gcc error.

Ciao, Marcus


From gerald at pfeifer.com  Sat Dec  1 20:28:10 2007
From: gerald at pfeifer.com (Gerald Pfeifer)
Date: Sun, 2 Dec 2007 03:28:10 +0100 (CET)
Subject: PATCH: fix out of range array access in dlls/kernel32/relay16.c
	(fwd)
In-Reply-To: <87d4ttjeti.fsf@wine.dyndns.org>
References: <Pine.LNX.4.64.0711282347160.19271@acrux.dbai.tuwien.ac.at>
	<87d4ttjeti.fsf@wine.dyndns.org>
Message-ID: <Pine.LNX.4.64.0712020305480.29138@acrux.dbai.tuwien.ac.at>

On Thu, 29 Nov 2007, Alexandre Julliard wrote:
>> I checked again and if we don't address this we'll get two new warnings
>> issues in a default build with GCC 4.3.  How does the patch below
>> look?
> Not good, it adds noise to the code for no good reason. Why would gcc
> complain about that one?

GCC 4.3 (today's snapshot) complains as follows when building Wine with
default options:

  relay16.c: In function 'relay_call_from_16':
  relay16.c:323: warning: array subscript is above array bounds
  relay16.c:427: warning: array subscript is above array bounds

Looking at the code GCC is right:

    for (j = 0; j < sizeof(call->ret)/sizeof(call->ret[0]); j++)
        if (call->ret[j] == 0xca66 || call->ret[j] == 0xcb66) break;

    if (call->ret[j] == 0xcb66)  /* cdecl */

Unless we break out of the loop, after the loop j will be the number of 
elements in the array, and thus call->rej[j] will be the first element 
_after_ the array, running into the next field of the structure.

The straightforward fix to avoid this out-of-array access was my first
patch at

  http://www.winehq.org/pipermail/wine-patches/2007-September/044612.html

which you didn't like too much ;-), so I cooked up the second one

  http://www.winehq.org/pipermail/wine-patches/2007-November/047288.html

Do you (or does anyone else) have a better idea how to address this?

Gerald


From fgouget at free.fr  Sun Dec  2 08:16:10 2007
From: fgouget at free.fr (Francois Gouget)
Date: Sun, 2 Dec 2007 15:16:10 +0100 (CET)
Subject: xdg_user_dirs patches
In-Reply-To: <19e31a080712011926n6a808332n20f78fc25a86c986@mail.gmail.com>
References: <36bf289b0711261649j4cc9747bl7b70e42eb8fd4756@mail.gmail.com> 
	<558b2f5c0711281149y77878d39p2124f192aa232eae@mail.gmail.com> 
	<87wss2j92v.fsf@wine.dyndns.org>
	<Pine.LNX.4.64.0711301231410.30562@amboise.dolphin>
	<3a768c550711300727q6ff8ea86i9eaafb118f716caf@mail.gmail.com> 
	<Pine.LNX.4.64.0711301844180.15903@amboise.dolphin> 
	<1196445012.3036.48.camel@dimi.lattica.com>
	<47507783.3090301@gmail.com> 
	<19e31a080712011305g57beb6abo5d92e48d726ba0ca@mail.gmail.com> 
	<Pine.LNX.4.64.0712020204060.25012@amboise.dolphin>
	<19e31a080712011926n6a808332n20f78fc25a86c986@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0712021510160.30113@amboise.dolphin>

On Sat, 1 Dec 2007, Steven Edwards wrote:
[...]
> What this means is that on logon or logoff the WM would call our
> function and generate these fake Shortcuts for the *.lnk files by
> running a copy of winepath after calling the Wine shelllink processor.
> The results of winepath would translate 'c:\Program Files\Foo\Bar.exe'
> in to '~/.wine/dosdevices/c:/Program Files/Foo/Bar.exe
> and pass that to the array in memory containing the "fake" shortcuts.

How does Gnome/KDE know which WINEPREFIX to use for foo.lnk? Why should 
it be '~/.wine' rather than '~/.wine-steam', '~/.wine-office' or 
something else?


> > What Wine could do is try to sync the Unix and Windows desktops with FAM
> > magic, all while not replicating the .lnk files to the Unix desktop.
> 
> Yes I am talking about using something like FAM but having it look for 
> *.lnk changes on the users Linux desktop. Evertime a FAM event occors 
> such as an install of a Windows application with a desktop shelllink, 
> the array containing the "fake" shortcuts in the WM is updated. When 
> the user logs off, this data is lost. The WM gets to keep the Windows 
> and Linux Desktop's in sync without having to actually mess with 
> generating new shortcuts and or confusing the user by having multiple 
> directories.

Well, that sounds like just having Gnome/KDE (!=WM) know how to 
interpret .lnk files. No specific FAM here beyond what they already do.


-- 
Francois Gouget <fgouget at free.fr>              http://fgouget.free.fr/
        It really galls me that most of the computer power in the world
                          is wasted on screen savers.
                     Chris Caldwell from the GIMPS project
                       http://www.mersenne.org/prime.htm


From winehacker at gmail.com  Sun Dec  2 10:22:43 2007
From: winehacker at gmail.com (Steven Edwards)
Date: Sun, 2 Dec 2007 11:22:43 -0500
Subject: xdg_user_dirs patches
In-Reply-To: <Pine.LNX.4.64.0712021510160.30113@amboise.dolphin>
References: <36bf289b0711261649j4cc9747bl7b70e42eb8fd4756@mail.gmail.com>
	<Pine.LNX.4.64.0711301231410.30562@amboise.dolphin>
	<3a768c550711300727q6ff8ea86i9eaafb118f716caf@mail.gmail.com>
	<Pine.LNX.4.64.0711301844180.15903@amboise.dolphin>
	<1196445012.3036.48.camel@dimi.lattica.com>
	<47507783.3090301@gmail.com>
	<19e31a080712011305g57beb6abo5d92e48d726ba0ca@mail.gmail.com>
	<Pine.LNX.4.64.0712020204060.25012@amboise.dolphin>
	<19e31a080712011926n6a808332n20f78fc25a86c986@mail.gmail.com>
	<Pine.LNX.4.64.0712021510160.30113@amboise.dolphin>
Message-ID: <19e31a080712020822k78f48d65m58eaae7380710839@mail.gmail.com>

On Dec 2, 2007 9:16 AM, Francois Gouget <fgouget at free.fr> wrote:
> How does Gnome/KDE know which WINEPREFIX to use for foo.lnk? Why should
> it be '~/.wine' rather than '~/.wine-steam', '~/.wine-office' or
> something else?

Maybe rather than storying the information in memory and creating it
at DE startup and destroying it at DE exit like I proposed, we should
store it all in gconf or something and export functionality from Wine
so that GNOME or KDE can know which WINEPREFIX made what changes. Let
me extend my plan a bit and see what you think...

A user installs Wine which registers the MIME type of *.lnk with the
Desktop Environment. A user starts Wine and installs an application
that writes a *.lnk to the Desktop. Our DE Service or exported API
then stores the following information from Winemenubuilder in gconf
for the target *.lnk

Shortcut Name:

Say you have sol.lnk on the desktop GNOME and KDE should be smart
enough to parse sol.lnk and actually display Solitaire or Solitaire
(Windows) or something. This "fake" shortcut would not be the filename
of course, just the name that it pulls from gconf for that shortcut. I
think the *.lnk files contain a longer name describing what they are
actually pointing too right?

Shortcut Target Support:

The results of winepath would translate 'c:\Program Files\Foo\Bar.exe'
in to '~/.wine/dosdevices/c:/Program Files/Foo/Bar.exe
and pass that to the array in memory containing the "fake" shortcuts.

WINEPREFIX:
Lets say a user is running the steam installer from a
WINEPREFIX=~/.wine-steam and it writes *.lnk files to the desktop.
winemenubuilder stores a reference to this in gconf which overrides
the MIME type handler by setting this varible before starting Wine and
processing the *.lnk file. Maybe explorer or winemenubuilder export
this information using dbus? I don't know all the low level details.

Associations: Again I assume this would be winemenubuilders job to
keep in sync everytime it is called by an installer.

I think we can extend such a framework to cover every corner case if
we can make use of gconf, dbus, the mime handler. I don't know what we
would use in the KDE case instead of gconf so I will leave that up to
someone else to make a suggestion. I do think this is an important
issue as multiple Desktop folders confuse me! I can imagine how some
who has never used Wine has felt. Also a final thought....we could
always make another code path so the current support for private Wine
Desktop directories still exist but the framework I've described is
opted IN via a registry key that could be set via winecfg.

Thanks
-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From gabriel.sailer at gmx.net  Sun Dec  2 14:23:02 2007
From: gabriel.sailer at gmx.net (Gabriel Sailer)
Date: Sun, 2 Dec 2007 12:23:02 -0800 (PST)
Subject: Why must the user be the owner of the WINEPREFIX dir?
Message-ID: <14119607.post@talk.nabble.com>


Hello,
after an update of wine on my Debian etch i got the error:

libwine: Refuse to use a WINEPREFIX dir owned by a different user.

I found that there is a patch in Wine release 0.9.49 but i did not found
why this patch is needed. Are the linux access rights not secure enough?
I have the full access of the directory and all subdirectories and files.

I used the same WinXX Application with wine for a few people (not
parallel but serialized) in the same group and gave the WINEPREFIX dir
(and all subdirectories and files) to this group.

Is it really nesseccary to use this protection? Did i get a security hole
without the check?

Many thanks for your help

Gabriel Sailer


-- 
View this message in context: http://www.nabble.com/Why-must-the-user-be-the-owner-of-the-WINEPREFIX-dir--tf4933079.html#a14119607
Sent from the Wine - Devel mailing list archive at Nabble.com.



From gerald at pfeifer.com  Sun Dec  2 15:28:30 2007
From: gerald at pfeifer.com (Gerald Pfeifer)
Date: Sun, 2 Dec 2007 22:28:30 +0100 (CET)
Subject: Remove four useless checks in dlls/gdi32/enhmetafile.c (RESEND)
In-Reply-To: <8763zys4s5.fsf@wine.dyndns.org>
References: <Pine.LNX.4.64.0711170100300.8530@acrux.dbai.tuwien.ac.at>
	<87abpasayf.fsf@wine.dyndns.org>
	<Pine.LNX.4.64.0711191503020.19271@acrux.dbai.tuwien.ac.at>
	<8763zys4s5.fsf@wine.dyndns.org>
Message-ID: <Pine.LNX.4.64.0711290018420.19271@acrux.dbai.tuwien.ac.at>

On Mon, 19 Nov 2007, Alexandre Julliard wrote:
>> I had expected this comment for a different patch of mine.  In 
>> dlls/gdi32/enhmetafile.c we are just reading existing records,
>> so I'm not sure what you have in mind here?
> The records usually come from an external file, so they have to be
> validated (not that this is done correctly everywhere, but we should
> move towards more validation, not less).

I've been looking into this, and I'm afraid I'll need some help to 
proceed.  If you look at the code and my original patch below, you
will see that I removed four conditions which were noops, that is,
the compiler should (and could) simply remove them.

This is what my patch did at the source level.

If we want to add some input checking, I assume you would like to 
check that these values are not too large?  (They cannot be negative,
so the only range checking we can do is on the upper end.)  How should
this look like?  Any specific upper bounds you have in mind?

Or did I simply fail to explain my original patch, that is, convey the
point that this actually will not change program behavior?

Gerald

Index: dlls/gdi32/enhmetafile.c
===================================================================
RCS file: /home/wine/wine/dlls/gdi32/enhmetafile.c,v
retrieving revision 1.6
diff -u -3 -p -r1.6 enhmetafile.c
--- dlls/gdi32/enhmetafile.c	3 Aug 2007 13:06:43 -0000	1.6
+++ dlls/gdi32/enhmetafile.c	28 Nov 2007 23:18:34 -0000
@@ -1670,9 +1670,7 @@ BOOL WINAPI PlayEnhMetaFileRecord(
         LPVOID lpPackedStruct;
 
         /* check that offsets and data are contained within the record */
-        if ( !( (lpCreate->cbBmi>=0) && (lpCreate->cbBits>=0) &&
-                (lpCreate->offBmi>=0) && (lpCreate->offBits>=0) &&
-                ((lpCreate->offBmi +lpCreate->cbBmi ) <= mr->nSize) &&
+        if ( !( ((lpCreate->offBmi +lpCreate->cbBmi ) <= mr->nSize) &&
                 ((lpCreate->offBits+lpCreate->cbBits) <= mr->nSize) ) )
         {
             ERR("Invalid EMR_CREATEDIBPATTERNBRUSHPT record\n");


From julliard at winehq.org  Sun Dec  2 16:22:51 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Sun, 02 Dec 2007 23:22:51 +0100
Subject: Remove four useless checks in dlls/gdi32/enhmetafile.c (RESEND)
In-Reply-To: <Pine.LNX.4.64.0711290018420.19271@acrux.dbai.tuwien.ac.at>
	(Gerald Pfeifer's message of "Sun, 2 Dec 2007 22:28:30 +0100 (CET)")
References: <Pine.LNX.4.64.0711170100300.8530@acrux.dbai.tuwien.ac.at>
	<87abpasayf.fsf@wine.dyndns.org>
	<Pine.LNX.4.64.0711191503020.19271@acrux.dbai.tuwien.ac.at>
	<8763zys4s5.fsf@wine.dyndns.org>
	<Pine.LNX.4.64.0711290018420.19271@acrux.dbai.tuwien.ac.at>
Message-ID: <87ir3g68jo.fsf@wine.dyndns.org>

Gerald Pfeifer <gerald at pfeifer.com> writes:

> If we want to add some input checking, I assume you would like to 
> check that these values are not too large?  (They cannot be negative,
> so the only range checking we can do is on the upper end.)  How should
> this look like?  Any specific upper bounds you have in mind?
>
> Or did I simply fail to explain my original patch, that is, convey the
> point that this actually will not change program behavior?

I'm aware of that, but the purpose of having these warnings is to spot
bugs, and when you find a bug you have to fix it. Yes, the checks
currently don't work, so they should be made to work, not removed. As
the comment says, you have to check that offsets and sizes are contained
within the record.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Sun Dec  2 16:26:53 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Sun, 02 Dec 2007 23:26:53 +0100
Subject: Why must the user be the owner of the WINEPREFIX dir?
In-Reply-To: <14119607.post@talk.nabble.com> (Gabriel Sailer's message of
	"Sun, 2 Dec 2007 12:23:02 -0800 (PST)")
References: <14119607.post@talk.nabble.com>
Message-ID: <87eje468cy.fsf@wine.dyndns.org>

Gabriel Sailer <gabriel.sailer at gmx.net> writes:

> I used the same WinXX Application with wine for a few people (not
> parallel but serialized) in the same group and gave the WINEPREFIX dir
> (and all subdirectories and files) to this group.
>
> Is it really nesseccary to use this protection? Did i get a security hole
> without the check?

It's because when you have several users sharing a prefix directory
you'll most likely run into trouble. In particular it catches people
running as root inside a user's dir, which breaks things. If you are
sure that you have taken care of all the potential trouble, you can work
around the check by creating a prefix dir for each user and symlinking
things inside it to a central place.

-- 
Alexandre Julliard
julliard at winehq.org


From dank at kegel.com  Sun Dec  2 17:22:04 2007
From: dank at kegel.com (Dan Kegel)
Date: Sun, 2 Dec 2007 15:22:04 -0800
Subject: kernel32:add ReadFileScatter
Message-ID: <a71bd89a0712021522ic8f8defr26333d013d2084b9@mail.gmail.com>

Hey Louis,
Focht is using a pseudonym, and I believe it's Wine policy to
not accept patches without real names.
His patches should be used as guides only,
and should not be reposted to wine-patches,
until such time as he decloaks.  If he doesn't
want to decloak, I think we can't use his patches.

I rather wish he would avoid attach patches to
bugs, as it tempts people into submitting them
as you have done, which is a waste of effort given
Wine's policy.  But I greatly value his ability to
describe where and how Wine is wrong.
- Dan


From truiken at gmail.com  Sun Dec  2 17:32:34 2007
From: truiken at gmail.com (James Hawkins)
Date: Sun, 2 Dec 2007 17:32:34 -0600
Subject: kernel32:add ReadFileScatter
In-Reply-To: <a71bd89a0712021522ic8f8defr26333d013d2084b9@mail.gmail.com>
References: <a71bd89a0712021522ic8f8defr26333d013d2084b9@mail.gmail.com>
Message-ID: <22821af30712021532j265c7b44lac28e8cf9d4fa06@mail.gmail.com>

On Dec 2, 2007 5:22 PM, Dan Kegel <dank at kegel.com> wrote:
> Hey Louis,
> Focht is using a pseudonym, and I believe it's Wine policy to
> not accept patches without real names.
> His patches should be used as guides only,
> and should not be reposted to wine-patches,
> until such time as he decloaks.  If he doesn't
> want to decloak, I think we can't use his patches.
>
> I rather wish he would avoid attach patches to
> bugs, as it tempts people into submitting them
> as you have done, which is a waste of effort given
> Wine's policy.  But I greatly value his ability to
> describe where and how Wine is wrong.
> - Dan
>

There's also the issue that Focht disassembles native Windows
binaries, and as such, no patches from him will be accepted.  I agree,
he needs to stop posting patches to wine-bugs, as those patches are
tainted and can be used against us in a legal situation.

-- 
James Hawkins


From gerald at pfeifer.com  Sun Dec  2 17:37:55 2007
From: gerald at pfeifer.com (Gerald Pfeifer)
Date: Mon, 3 Dec 2007 00:37:55 +0100 (CET)
Subject: Remove four useless checks in dlls/gdi32/enhmetafile.c (RESEND)
In-Reply-To: <87ir3g68jo.fsf@wine.dyndns.org>
References: <Pine.LNX.4.64.0711170100300.8530@acrux.dbai.tuwien.ac.at>
	<87abpasayf.fsf@wine.dyndns.org>
	<Pine.LNX.4.64.0711191503020.19271@acrux.dbai.tuwien.ac.at>
	<8763zys4s5.fsf@wine.dyndns.org>
	<Pine.LNX.4.64.0711290018420.19271@acrux.dbai.tuwien.ac.at>
	<87ir3g68jo.fsf@wine.dyndns.org>
Message-ID: <Pine.LNX.4.64.0712030008450.29138@acrux.dbai.tuwien.ac.at>

On Sun, 2 Dec 2007, Alexandre Julliard wrote:
> I'm aware of that, but the purpose of having these warnings is to spot
> bugs, and when you find a bug you have to fix it. Yes, the checks
> currently don't work, so they should be made to work, not removed. As
> the comment says, you have to check that offsets and sizes are contained
> within the record.

Doesn't the following part of the checks work and ensure that already?

        if ( !( ((lpCreate->offBmi +lpCreate->cbBmi ) <= mr->nSize) &&
                ((lpCreate->offBits+lpCreate->cbBits) <= mr->nSize) ) )

My patch only removes the half of the original check which is a noop 
(since the current code  misses the fact that these variables always
will be >= 0 by virtue of their type).

Ahhh!  A lightbulb goes on.  Since this is input from the outside, and
thus completely out of our control, you are worried about overflows, that
is, the sum of the two values (offset and size) being within range, but
not the individual parts.  

Is this what you've been after? :-)

Updated patch below.  (Now I only wonder whether the <= in the original
code shouldn't have been <, and thus the > in my code shouldn't be >=,
but that's a separate issue.)

Gerald

Index: dlls/gdi32/enhmetafile.c
===================================================================
RCS file: /home/wine/wine/dlls/gdi32/enhmetafile.c,v
retrieving revision 1.6
diff -u -3 -p -r1.6 enhmetafile.c
--- dlls/gdi32/enhmetafile.c	3 Aug 2007 13:06:43 -0000	1.6
+++ dlls/gdi32/enhmetafile.c	2 Dec 2007 23:32:50 -0000
@@ -1669,11 +1669,15 @@ BOOL WINAPI PlayEnhMetaFileRecord(
         const EMRCREATEDIBPATTERNBRUSHPT *lpCreate = (const EMRCREATEDIBPATTERNBRUSHPT *)mr;
         LPVOID lpPackedStruct;
 
-        /* check that offsets and data are contained within the record */
-        if ( !( (lpCreate->cbBmi>=0) && (lpCreate->cbBits>=0) &&
-                (lpCreate->offBmi>=0) && (lpCreate->offBits>=0) &&
-                ((lpCreate->offBmi +lpCreate->cbBmi ) <= mr->nSize) &&
-                ((lpCreate->offBits+lpCreate->cbBits) <= mr->nSize) ) )
+        /* Check that offsets and data are contained within the record.
+         * The first four checks are not redundant -- think overflow!
+         */
+        if ( lpCreate->offBmi     > mr->nSize 
+             || lpCreate->cbBmi   > mr->nSize
+             || lpCreate->offBits > mr->nSize
+             || lpCreate->cbBits  > mr->nSize
+             || lpCreate->offBmi +lpCreate->cbBmi  > mr->nSize
+             || lpCreate->offBits+lpCreate->cbBits > mr->nSize )
         {
             ERR("Invalid EMR_CREATEDIBPATTERNBRUSHPT record\n");
             break;


From truiken at gmail.com  Sun Dec  2 21:16:41 2007
From: truiken at gmail.com (James Hawkins)
Date: Sun, 2 Dec 2007 21:16:41 -0600
Subject: uninstaller: iterate keys in HKEY_CURRENT_USER also as some
	programs install their uninstall information there
In-Reply-To: <475372F3.405@codeweavers.com>
References: <475372F3.405@codeweavers.com>
Message-ID: <22821af30712021916s7b52bc0eif7df4b470c4b7898@mail.gmail.com>

On Dec 2, 2007 9:07 PM, Aric Stewart <aric at codeweavers.com> wrote:
> ---
>   programs/uninstaller/main.c |   34 +++++++++++++++++++++++-----------
>   1 files changed, 23 insertions(+), 11 deletions(-)
>

I'm not saying that this patch shouldn't be accepted, but I want to
remark that at some point, all this registry code should be replaced
by MsiEnumProducts, MsiGetProductInfo.

-- 
James Hawkins


From infyquest at gmail.com  Sun Dec  2 21:31:29 2007
From: infyquest at gmail.com (Vijay Kiran Kamuju)
Date: Mon, 3 Dec 2007 09:01:29 +0530
Subject: kernel32:add ReadFileScatter
In-Reply-To: <22821af30712021532j265c7b44lac28e8cf9d4fa06@mail.gmail.com>
References: <a71bd89a0712021522ic8f8defr26333d013d2084b9@mail.gmail.com>
	<22821af30712021532j265c7b44lac28e8cf9d4fa06@mail.gmail.com>
Message-ID: <36bf289b0712021931r76ae434cx740d297ca02e01f4@mail.gmail.com>

On Dec 3, 2007 5:02 AM, James Hawkins <truiken at gmail.com> wrote:
>
> On Dec 2, 2007 5:22 PM, Dan Kegel <dank at kegel.com> wrote:
> > Hey Louis,
> > Focht is using a pseudonym, and I believe it's Wine policy to
> > not accept patches without real names.
> > His patches should be used as guides only,
> > and should not be reposted to wine-patches,
> > until such time as he decloaks.  If he doesn't
> > want to decloak, I think we can't use his patches.
> >
> > I rather wish he would avoid attach patches to
> > bugs, as it tempts people into submitting them
> > as you have done, which is a waste of effort given
> > Wine's policy.  But I greatly value his ability to
> > describe where and how Wine is wrong.
> > - Dan
> >
>
> There's also the issue that Focht disassembles native Windows
> binaries, and as such, no patches from him will be accepted.  I agree,
> he needs to stop posting patches to wine-bugs, as those patches are
> tainted and can be used against us in a legal situation.
I dont think thats a good idea, asking someone not to post
fixes/patches to wine-bugs.
Its upon the users to test his ideas, we may not incorporate his
patches into the main tree.
But his patches help us understand where the problem lies and how to
overcome it.
Its better that He/We post a disclaimer that the patch is for
informative and testing purposes.
And that they may not be included in main tree, but can be used upon
users discretion.
so that wine itself may not be held responsible, in case of any legal threat.

--
VJ
>
> --
> James Hawkins
>
>
>


From truiken at gmail.com  Sun Dec  2 21:41:14 2007
From: truiken at gmail.com (James Hawkins)
Date: Sun, 2 Dec 2007 21:41:14 -0600
Subject: kernel32:add ReadFileScatter
In-Reply-To: <36bf289b0712021931r76ae434cx740d297ca02e01f4@mail.gmail.com>
References: <a71bd89a0712021522ic8f8defr26333d013d2084b9@mail.gmail.com>
	<22821af30712021532j265c7b44lac28e8cf9d4fa06@mail.gmail.com>
	<36bf289b0712021931r76ae434cx740d297ca02e01f4@mail.gmail.com>
Message-ID: <22821af30712021941pbb0064ckde5d60a7d75b36fe@mail.gmail.com>

On Dec 2, 2007 9:31 PM, Vijay Kiran Kamuju <infyquest at gmail.com> wrote:
>
> On Dec 3, 2007 5:02 AM, James Hawkins <truiken at gmail.com> wrote:
> >
> > On Dec 2, 2007 5:22 PM, Dan Kegel <dank at kegel.com> wrote:
> > > Hey Louis,
> > > Focht is using a pseudonym, and I believe it's Wine policy to
> > > not accept patches without real names.
> > > His patches should be used as guides only,
> > > and should not be reposted to wine-patches,
> > > until such time as he decloaks.  If he doesn't
> > > want to decloak, I think we can't use his patches.
> > >
> > > I rather wish he would avoid attach patches to
> > > bugs, as it tempts people into submitting them
> > > as you have done, which is a waste of effort given
> > > Wine's policy.  But I greatly value his ability to
> > > describe where and how Wine is wrong.
> > > - Dan
> > >
> >
> > There's also the issue that Focht disassembles native Windows
> > binaries, and as such, no patches from him will be accepted.  I agree,
> > he needs to stop posting patches to wine-bugs, as those patches are
> > tainted and can be used against us in a legal situation.
> I dont think thats a good idea, asking someone not to post
> fixes/patches to wine-bugs.
> Its upon the users to test his ideas, we may not incorporate his
> patches into the main tree.
> But his patches help us understand where the problem lies and how to
> overcome it.
> Its better that He/We post a disclaimer that the patch is for
> informative and testing purposes.
> And that they may not be included in main tree, but can be used upon
> users discretion.
> so that wine itself may not be held responsible, in case of any legal threat.
>

No that's not how the law works in the US (I can't vouch for other
countries).  Clean room reverse engineering means that one person can
disassemble a certain binary and post notes and/or pseudocode, and
another person can implement the API from those notes, but you can't
look at code written from the first person and write "new" code from
it.  His patches help us understand where the problem lies?  Notes
and/or pseudocode work just fine.  If you want to legally contribute
to the project, you shouldn't be looking at the patches at all.

-- 
James Hawkins


From frank.richter at gmail.com  Sun Dec  2 22:04:15 2007
From: frank.richter at gmail.com (Frank Richter)
Date: Mon, 03 Dec 2007 05:04:15 +0100
Subject: programs/explorer/desktop.c: Add error checking
In-Reply-To: <200712011820.48900.lav@etersoft.ru>
References: <200712011820.48900.lav@etersoft.ru>
Message-ID: <4753803F.9050305@gmail.com>

On 01.12.2007 16:20, Vitaly Lipatov wrote:
> UuidToStringW from legacy (DCOM95) rpcrt4.dll returns RPC_S_CANNOT_SUPPORT, 
> works only ANSI version.
> 
> Changelog:
> Add return codes checking for UuidCreate and UuidToStringW

Do users still commonly install that legacy DCOM? If so, it may be
better to replace UuidToStringW with UuidToStringA so the
initialize_display_settings() function continues working (it looks
somewhat important, but not sure if it really is).

-f.r.


From frank.richter at gmail.com  Mon Dec  3 02:25:07 2007
From: frank.richter at gmail.com (Frank Richter)
Date: Mon, 03 Dec 2007 09:25:07 +0100
Subject: xdg_user_dirs patches
In-Reply-To: <19e31a080712011305g57beb6abo5d92e48d726ba0ca@mail.gmail.com>
References: <36bf289b0711261649j4cc9747bl7b70e42eb8fd4756@mail.gmail.com>	<558b2f5c0711281149y77878d39p2124f192aa232eae@mail.gmail.com>	<87wss2j92v.fsf@wine.dyndns.org>	<Pine.LNX.4.64.0711301231410.30562@amboise.dolphin>	<3a768c550711300727q6ff8ea86i9eaafb118f716caf@mail.gmail.com>	<Pine.LNX.4.64.0711301844180.15903@amboise.dolphin>	<1196445012.3036.48.camel@dimi.lattica.com>	<47507783.3090301@gmail.com>
	<19e31a080712011305g57beb6abo5d92e48d726ba0ca@mail.gmail.com>
Message-ID: <4753BD63.9070406@gmail.com>

On 01.12.2007 22:05, Steven Edwards wrote:
> I think teaching them about .lnk files is a better solution. It should not be
> to hard to have a mime type of *.lnk that invokes Wine and passes the
> shortcut to the link processor. Really all GNOME & KDE need to do
> with *.lnk files is have the ability to follow a small part of them to the
> binary in question and load the Icon data from the resource section.
> The rest can be off loaded to Wine when a user actually clicks one.

One idea I had earlier is to actually store .desktop file data in files
ending in .lnk. At least gnome didn't care about the extension (didn't
try with KDE due not having it installed). So the "shell links" would
show up as proper icons on the desktop. Also, applications would see
files with a suffix of '.lnk' so e.g. uninstallers would work correctly
when directly deleting link files.

Of course it's a bit of a hack. A technical issue is that the "original"
.lnk would have to be preserved somewhere to make sure all attributes
can be restored without loss. When the shell is used to access the
links, this hiding is not a problem. However, when an application would
access the .lnk directly, it'd see a .desktop file. (Don't know how
common that is.) Also, since applications could copy/delete a link file
directly, some process would have to monitor the Desktop dir and ensure
that .lnks are turned to .desktops and that any possibly necessary
cleanup of the shadowed original data is done when the .lnk is removed.

-f.r.


From luis.busquets at ilidium.com  Mon Dec  3 02:33:39 2007
From: luis.busquets at ilidium.com (luis.busquets at ilidium.com)
Date: Mon, 3 Dec 2007 09:33:39 +0100 (CET)
Subject: kernel32:add ReadFileScatter
Message-ID: <57795.158.169.9.14.1196670819.squirrel@www.ilidium.com>

Just to add more clarity to the IPR of computer programs and if it is
legal to decompile and implement a program again.
In Europe, software is protected by Council Directive 91/250/EEC of 14 May
1991 on the legal protection of computer programs
(http://eur-lex.europa.eu/LexUriServ/LexUriServ.do?uri=CELEX:31991L0250:EN:HTML).
There are a number of things that a software vendor cannot forbid. In
particular article 6 speaks about decompilation. It can be done only if
the information necessary to achieve interoperability has not previously
been readily available (a.1.b) to achieve programs interoperable with the
first one  (a.1) but not to be used for the development, production or
marketing of a computer program substantially similar in its expression
(a. 6.2.c).
It could be argued that wine is not replicating Windows as it is just the
top API. Nevertherless, to avoid any legal problems, it is better to
refrain from adding any patches obtained by decompilation.





From julliard at winehq.org  Mon Dec  3 05:04:49 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 03 Dec 2007 12:04:49 +0100
Subject: Remove four useless checks in dlls/gdi32/enhmetafile.c (RESEND)
In-Reply-To: <Pine.LNX.4.64.0712030008450.29138@acrux.dbai.tuwien.ac.at>
	(Gerald Pfeifer's message of "Mon, 3 Dec 2007 00:37:55 +0100 (CET)")
References: <Pine.LNX.4.64.0711170100300.8530@acrux.dbai.tuwien.ac.at>
	<87abpasayf.fsf@wine.dyndns.org>
	<Pine.LNX.4.64.0711191503020.19271@acrux.dbai.tuwien.ac.at>
	<8763zys4s5.fsf@wine.dyndns.org>
	<Pine.LNX.4.64.0711290018420.19271@acrux.dbai.tuwien.ac.at>
	<87ir3g68jo.fsf@wine.dyndns.org>
	<Pine.LNX.4.64.0712030008450.29138@acrux.dbai.tuwien.ac.at>
Message-ID: <87abos599q.fsf@wine.dyndns.org>

Gerald Pfeifer <gerald at pfeifer.com> writes:

> Ahhh!  A lightbulb goes on.  Since this is input from the outside, and
> thus completely out of our control, you are worried about overflows, that
> is, the sum of the two values (offset and size) being within range, but
> not the individual parts.  
>
> Is this what you've been after? :-)

It's closer, but overflow should be treated as an error even if the
result is within range.

> Updated patch below.  (Now I only wonder whether the <= in the original
> code shouldn't have been <, and thus the > in my code shouldn't be >=,
> but that's a separate issue.)

It depends if you are testing a position or a size. Please spend some
more time thinking about it, and send a patch with the correct checks.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Mon Dec  3 05:07:27 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 03 Dec 2007 12:07:27 +0100
Subject: ntdll: detach modules based on inter-module dependencies (try 2)
In-Reply-To: <558b2f5c0712011050r10e3b505y300a30f4beaf9381@mail.gmail.com>
	(Lei Zhang's message of "Sat, 1 Dec 2007 10:50:25 -0800")
References: <558b2f5c0712011050r10e3b505y300a30f4beaf9381@mail.gmail.com>
Message-ID: <8763zg595c.fsf@wine.dyndns.org>

"Lei Zhang" <thestig at google.com> writes:

> This patch changes how process_detach() works when called with
> bForceDetach set to TRUE. A module would get detached when that module
> has no dependencies. After a module gets detached, process_detach()
> scans through all the modules and update their dependencies. I'm
> assuming there's no circular dependencies between modules.

You can't assume that, some modules do have circular dependencies. My
suspicion is that this bug should be fixed in winmm, but either way
you'll need to show some test cases.

-- 
Alexandre Julliard
julliard at winehq.org


From polleke at gmail.com  Mon Dec  3 04:50:25 2007
From: polleke at gmail.com (Paul van Schayck)
Date: Mon, 3 Dec 2007 11:50:25 +0100
Subject: [AppDB] Change licence to AGPL
In-Reply-To: <200711240434.58105.alex@thehandofagony.com>
References: <200711240336.45949.alex@thehandofagony.com>
	<3d57814d0711231901u21fcbef4h16aba8001bdae77@mail.gmail.com>
	<200711240434.58105.alex@thehandofagony.com>
Message-ID: <13151a510712030250w54b9f75bwbcd2010c4195baa7@mail.gmail.com>

Hey,

On Nov 24, 2007 4:34 AM, Alexander Nicolaysen S?rnes
<alex at thehandofagony.com> wrote:
> On Saturday 24 November 2007 04:01:24 Trent Waddington wrote:
> > interesting.  Do you have a list of contributors and their signoff on
> > this license change?
> >
> > Or is it just you two?
> >
>
> Well I didn't think that was necessary; but after some thought I realize that
> the AppDB only seemed to include a LICENSE file containing the GPL v2, while
> a GPL/AGPL v3 change would require previous code to be licenced under 'GPL v2
> or later'.
>
> So I'm including the other authors in this mail to see if they agree, or have
> already licenced their code under GPL v2 or later

Yup, I'm ok with that change.

The image.php class was written by me for another project. And just
reused for the appdb. I've later included it all kind of different
projects (open and closed). And never really gave it a second thought.
Does this cause trouble?

Paul


From nessi at nessi-online.de  Mon Dec  3 06:55:59 2007
From: nessi at nessi-online.de (nessi at nessi-online.de)
Date: Mon, 3 Dec 2007 13:55:59 +0100 (MET)
Subject: handle unimplemented function stubs
Message-ID: <200712031255.lB3CtxPk000552@post.webmailer.de>

Hello all,

I'm a Windows software developer and I'm trying to execute an application under the wine environment.
Now I have a problem introduced with wine 0.9.49.

I use the function RegOverridePredefKey from the advapi32.dll.
To be compatible with older windows versions, I use the following code:

  LONG WINAPI (*RegOverridePredefKey)(HKEY hKey, HKEY hNewHKey);
  HMODULE hMod=GetModuleHandle("Advapi32");
  if (hMod)
    (FARPROC)RegOverridePredefKey=GetProcAddress(hMod,"RegOverridePredefKey");
  if (RegOverridePredefKey)
    RegOverridePredefKey(HKEY_CLASSES_ROOT, hKey);

In wine 0.9.49 a stub entry for this function was created, but the implementation is missing.
The result is, that the GetProcAddress function is successful, but the RegOverridePredefKey call fails.
I can catch the EXCEPTION_WINE_STUB exception (see code below), but the application will nevertheless closed.

  if (RegOverridePredefKey)
    {
    long err  = ERROR_CALL_NOT_IMPLEMENTED;
    try
      {         // test for C-based structured exceptions
      err=RegOverridePredefKey(HKEY_CLASSES_ROOT, hKey);
      }

    #define EXCEPTION_WINE_STUB       0x80000100
    __except(GetExceptionCode()==EXCEPTION_WINE_STUB  ? EXCEPTION_EXECUTE_HANDLER : EXCEPTION_CONTINUE_SEARCH)
      {
      RegOverridePredefKey=NULL;
      }
    }

What can I do ?
I know, that I can find a workaround for this case, but this in not my problem. How can I handle, in principle, such exceptions?
What is the reason for creating a function stub without an implementation ???

Thanks 
Nessi



From julliard at winehq.org  Mon Dec  3 07:02:18 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 03 Dec 2007 14:02:18 +0100
Subject: rpcrt4: Handle all non-continuable exceptions in
	CStdStubBuffer_Invoke.
In-Reply-To: <475051BD.2070303@codeweavers.com> (Robert Shearman's message of
	"Fri, 30 Nov 2007 18:09:01 +0000")
References: <475051BD.2070303@codeweavers.com>
Message-ID: <871wa453tx.fsf@wine.dyndns.org>

Robert Shearman <rob at codeweavers.com> writes:

> ---
>  dlls/rpcrt4/cstub.c |    2 +-
>  1 files changed, 1 insertions(+), 1 deletions(-)
>
> I have a test for this in my tree, which passes on Windows, but
> doesn't pass in Wine yet until we have some more proxy/stub code that
> I can use to call an object's methods (ideally IClassFactory).

This doesn't work:

../../../tools/runtest -q -P wine -M rpcrt4.dll -T ../../.. -p rpcrt4_test.exe.so cstub.c && touch cstub.ok
cstub.c:874: Test failed: ret c0000005
make[2]: *** [cstub.ok] Error 1

-- 
Alexandre Julliard
julliard at winehq.org


From stefan at codeweavers.com  Mon Dec  3 07:53:16 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Mon, 3 Dec 2007 14:53:16 +0100
Subject: handle unimplemented function stubs
In-Reply-To: <200712031255.lB3CtxPk000552@post.webmailer.de>
References: <200712031255.lB3CtxPk000552@post.webmailer.de>
Message-ID: <200712031453.18660.stefan@codeweavers.com>

Am Montag, 3. Dezember 2007 13:55:59 schrieb nessi at nessi-online.de:
> I know, that I can find a workaround for this case, but this in not my
> problem. How can I handle, in principle, such exceptions? What is the
> reason for creating a function stub without an implementation ???
The reason is often that there is an application that tries to load the 
function, but never calls it. It refuses to start without getting a pointer 
to this unused function. Or an application that refuses to run if it doesn't 
like the exports from a DLL. For example, copy protection systems might check 
the exports, and refuse if your DLL has different exports than Windows.

The @stub stubs are pretty rare nowadays, for exactly the reason you give. 
Usual stubs have a real implementation function which just returns an error 
or OK and writes a note to the FIXME channel.

The stub in question was added by patch 
27e8b829a4cc56969836c0dbbb4db4b775d52a9f, which was intended to fix bug 
#9116.

To answer your question what to do, the usual way to fix this is to implement 
the function in Wine. I understand that this is most likely not a suitable 
solution for you, after all you're working on your application, not Wine. I 
do not know advapi32, so I cannot implement this function myself, but if no 
one steps up in the next days I can send a small patch that just adds a nicer 
stub that doesn't crash.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071203/ee9cd798/attachment.pgp 

From xerox_xerox2000 at yahoo.co.uk  Mon Dec  3 10:28:33 2007
From: xerox_xerox2000 at yahoo.co.uk (Louis Lenders)
Date: Mon, 3 Dec 2007 16:28:33 +0000 (UTC)
Subject: kernel32:add ReadFileScatter
References: <a71bd89a0712021522ic8f8defr26333d013d2084b9@mail.gmail.com>
Message-ID: <loom.20071203T161601-8@post.gmane.org>

Dan Kegel <dank <at> kegel.com> writes:

> 
> Hey Louis,
> Focht is using a pseudonym, and I believe it's Wine policy to
> not accept patches without real names.
> His patches should be used as guides only,
> and should not be reposted to wine-patches,
> until such time as he decloaks.  

Well , sorry, i thought it was OK to send the patch to wine-patches, as he's not 
going to send them himself, and also from bugreport he stated clearly (quote):

"you might try attached patch which implements kernel32.ReadFileScatter based
off what I found in MSDN documentation." 

So looks like a perfectly "clean" patch to me, and i have no reason to not
believe him

>If he doesn't
> want to decloak, I think we can't use his patches.
> 
> I rather wish he would avoid attach patches to
> bugs, as it tempts people into submitting them
> as you have done, which is a waste of effort given
> Wine's policy. 

>But I greatly value his ability to describe where and how Wine is wrong.
Me too! So somehow i hope there's a way he keeps being involved in wine.

> - Dan
> 
> 






From marius.slyzius at scimore.com  Mon Dec  3 11:27:45 2007
From: marius.slyzius at scimore.com (Marius Slyzius)
Date: Mon, 3 Dec 2007 18:27:45 +0100
Subject: wine 0.9.5 IO completion port questions
Message-ID: <08b801c835d1$d106f430$7314dc90$@slyzius@scimore.com>

Hello all. 

 

I am trying to run ScimoreDB database which uses fibers, non-blocked IO for
sockets and files,  and completion port. It did started ok under 0.9.5 and
seems it is working!!!:), so I would like to verify few things about async
IO with completion ports before recompiling it with winelib. 

 

1) will write/read file/socket with completion port is true asynchronous
operation. I am asking because every time write/read operation returns true,
and never IO pending error.

 

2) possible bug: the server sends 1500 bytes with WsaSend ( with 2 WSABUFFER
) and the client receive only 1452 bytes and calls WsaRecv again. Also on
the server, the completion port receive event that transferred 1452 bytes.
However, the last 8 bytes are never sends nor completion port event arrives.
Is it perhaps something to do with the VMWare tool where I run Ubuntu 7.10?

Please, send me an info also to my mail: marius at scimore.com , because I
might miss the answer here.

 

Thank you!

Marius Slyzius

Scimore UAB

(+45) 40862122

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20071203/96224ffa/attachment.htm 

From andrey.turkin at gmail.com  Mon Dec  3 16:05:30 2007
From: andrey.turkin at gmail.com (Andrey Turkin)
Date: Tue, 04 Dec 2007 01:05:30 +0300
Subject: wine 0.9.5 IO completion port questions
In-Reply-To: <08b801c835d1$d106f430$7314dc90$@slyzius@scimore.com>
References: <08b801c835d1$d106f430$7314dc90$@slyzius@scimore.com>
Message-ID: <47547DAA.2070206@gmail.com>

Marius Slyzius wrote:
>
> Hello all.
>
>  
>
> I am trying to run ScimoreDB database which uses fibers, non-blocked
> IO for sockets and files,  and completion port. It did started ok
> under 0.9.5 and seems it is working!!!:), so I would like to verify
> few things about async IO with completion ports before recompiling it
> with winelib.
>
You mean 0.9.50, right?
>
>  
>
> 1) will write/read file/socket with completion port is true
> asynchronous operation. I am asking because every time write/read
> operation returns true, and never IO pending error.
>
Not sure it is asynchronous for files, should be asynchronous for sockets.
>
>  
>
> 2) possible bug: the server sends 1500 bytes with WsaSend ( with 2
> WSABUFFER ) and the client receive only 1452 bytes and calls WsaRecv
> again. Also on the server, the completion port receive event that
> transferred 1452 bytes. However, the last 8 bytes are never sends nor
> completion port event arrives. Is it perhaps something to do with the
> VMWare tool where I run Ubuntu 7.10?
>
WsaSend can send partial data when operating on non-blocking socket;
from your description it looks like this is the case. Is this error
reproducible with the same numbers every run?
Your both questions are actually not about IOCP but about asynchronous
I/O support.
>
> Please, send me an info also to my mail: marius at scimore.com , because
> I might miss the answer here.
>
>  
>
> Thank you!
>
> Marius Slyzius
>
> Scimore UAB
>
> (+45) 40862122
>
>  
>
> ------------------------------------------------------------------------
>
>
>   



From scott at open-vote.org  Mon Dec  3 16:14:04 2007
From: scott at open-vote.org (Scott Ritchie)
Date: Mon, 03 Dec 2007 14:14:04 -0800
Subject: [AppDB] Change licence to AGPL
In-Reply-To: <13151a510712030250w54b9f75bwbcd2010c4195baa7@mail.gmail.com>
References: <200711240336.45949.alex@thehandofagony.com>	<3d57814d0711231901u21fcbef4h16aba8001bdae77@mail.gmail.com>	<200711240434.58105.alex@thehandofagony.com>
	<13151a510712030250w54b9f75bwbcd2010c4195baa7@mail.gmail.com>
Message-ID: <47547FAC.50600@open-vote.org>

Paul van Schayck wrote:
> Hey,
> 
> On Nov 24, 2007 4:34 AM, Alexander Nicolaysen S?rnes
> <alex at thehandofagony.com> wrote:
>> On Saturday 24 November 2007 04:01:24 Trent Waddington wrote:
>>> interesting.  Do you have a list of contributors and their signoff on
>>> this license change?
>>>
>>> Or is it just you two?
>>>
>> Well I didn't think that was necessary; but after some thought I realize that
>> the AppDB only seemed to include a LICENSE file containing the GPL v2, while
>> a GPL/AGPL v3 change would require previous code to be licenced under 'GPL v2
>> or later'.
>>
>> So I'm including the other authors in this mail to see if they agree, or have
>> already licenced their code under GPL v2 or later
> 
> Yup, I'm ok with that change.
> 
> The image.php class was written by me for another project. And just
> reused for the appdb. I've later included it all kind of different
> projects (open and closed). And never really gave it a second thought.
> Does this cause trouble?
> 
> Paul
> 
> 

No, your own code can be licensed however you want in as many different
ways as you want.

Thanks,
Scott Ritchie


From skrzynka365 at konto.pl  Mon Dec  3 17:33:43 2007
From: skrzynka365 at konto.pl (Piotr Maceluch)
Date: Tue, 04 Dec 2007 00:33:43 +0100
Subject: dib engine
Message-ID: <47549257.1060508@konto.pl>

Hi,
what's the status of DIB engine (or where can one read about it)? Are 
the up-to-date sources still available? What kind of help would be needed?
Thanks
  Peter Maceluch


--
-----------=== F O R P S I ===-----------
  Profesjonalne uslugi, rewelacyjne ceny 
        Sprawdz nas - nowa oferta !!
     Twoja strona w sieci - od 2 zl
          http://www.forpsi.pl
-----------------------------------------


From aric at codeweavers.com  Mon Dec  3 22:33:23 2007
From: aric at codeweavers.com (Aric Stewart)
Date: Tue, 04 Dec 2007 13:33:23 +0900
Subject: shdocvw #3: Set default home and search page.
In-Reply-To: <473F3AF8.1050201@codeweavers.com>
References: <473F3AF8.1050201@codeweavers.com>
Message-ID: <4754D893.4010406@codeweavers.com>

I see that the native shdocvw sets neither the Start page nor the Search 
page when registered. This patch forces the users home page to initially 
be www.winehq.com which can be confusing to IE users who are expecting 
the normal default of msn.com

While amusing I do not think this is correct.
-aric

Jacek Caban wrote:
> ---
>  dlls/hlink/tests/hlink.c |    4 ----
>  dlls/shdocvw/shdocvw.inf |   12 +++++++++---
>  2 files changed, 9 insertions(+), 7 deletions(-)
> 
> 
> ------------------------------------------------------------------------
> 
> 



From thestig at google.com  Tue Dec  4 00:06:23 2007
From: thestig at google.com (Lei Zhang)
Date: Mon, 3 Dec 2007 22:06:23 -0800
Subject: ntdll: detach modules based on inter-module dependencies (try 2)
In-Reply-To: <8763zg595c.fsf@wine.dyndns.org>
References: <558b2f5c0712011050r10e3b505y300a30f4beaf9381@mail.gmail.com>
	<8763zg595c.fsf@wine.dyndns.org>
Message-ID: <558b2f5c0712032206p36036493rccedac2adbcbdb80@mail.gmail.com>

On Dec 3, 2007 3:07 AM, Alexandre Julliard <julliard at winehq.org> wrote:
> "Lei Zhang" <thestig at google.com> writes:
>
> > This patch changes how process_detach() works when called with
> > bForceDetach set to TRUE. A module would get detached when that module
> > has no dependencies. After a module gets detached, process_detach()
> > scans through all the modules and update their dependencies. I'm
> > assuming there's no circular dependencies between modules.
>
> You can't assume that, some modules do have circular dependencies. My
> suspicion is that this bug should be fixed in winmm, but either way
> you'll need to show some test cases.
>
> --
> Alexandre Julliard
> julliard at winehq.org
>

Ok, if winmm's DllMain gets called with fdwReason ==
DLL_PROCESS_DETACH with fImpLoad being non-NULL, then that means we're
in the middle of ExitProcess(). In that case, we can simply not call
DRIVER_UnloadAll() since the process is about to go away.


From winehacker at gmail.com  Tue Dec  4 04:52:50 2007
From: winehacker at gmail.com (Steven Edwards)
Date: Tue, 4 Dec 2007 05:52:50 -0500
Subject: shdocvw #3: Set default home and search page.
In-Reply-To: <4754D893.4010406@codeweavers.com>
References: <473F3AF8.1050201@codeweavers.com>
	<4754D893.4010406@codeweavers.com>
Message-ID: <19e31a080712040252w4b9d63f3w1d0efd66e41cb25b@mail.gmail.com>

On Dec 3, 2007 11:33 PM, Aric Stewart <aric at codeweavers.com> wrote:
> While amusing I do not think this is correct.

Plenty of OEM's change the default IE home page, and we should make it
easy to do so in Wine. I think a edit box in winecfg is the best route
to go with the default option being about:blank or www.winehq.org

Thanks
-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From aric at codeweavers.com  Tue Dec  4 04:56:24 2007
From: aric at codeweavers.com (Aric Stewart)
Date: Tue, 04 Dec 2007 19:56:24 +0900
Subject: shdocvw #3: Set default home and search page.
In-Reply-To: <19e31a080712040252w4b9d63f3w1d0efd66e41cb25b@mail.gmail.com>
References: <473F3AF8.1050201@codeweavers.com>	
	<4754D893.4010406@codeweavers.com>
	<19e31a080712040252w4b9d63f3w1d0efd66e41cb25b@mail.gmail.com>
Message-ID: <47553258.8060401@codeweavers.com>

Do we consider wine to be an OEM or a reimplementation of the base 
windows? Setting the homepage is easy enough it is just a registry key. 
However it is not something set when registering shdocvw.dll so i dont 
think we should set it there.  As a config option in winecfg sure.

-aric

Steven Edwards wrote:
> On Dec 3, 2007 11:33 PM, Aric Stewart <aric at codeweavers.com> wrote:
>> While amusing I do not think this is correct.
> 
> Plenty of OEM's change the default IE home page, and we should make it
> easy to do so in Wine. I think a edit box in winecfg is the best route
> to go with the default option being about:blank or www.winehq.org
> 
> Thanks



From winehacker at gmail.com  Tue Dec  4 05:01:30 2007
From: winehacker at gmail.com (Steven Edwards)
Date: Tue, 4 Dec 2007 06:01:30 -0500
Subject: shdocvw #3: Set default home and search page.
In-Reply-To: <47553258.8060401@codeweavers.com>
References: <473F3AF8.1050201@codeweavers.com>
	<4754D893.4010406@codeweavers.com>
	<19e31a080712040252w4b9d63f3w1d0efd66e41cb25b@mail.gmail.com>
	<47553258.8060401@codeweavers.com>
Message-ID: <19e31a080712040301o30446a33u7635a2c594e72674@mail.gmail.com>

On Dec 4, 2007 5:56 AM, Aric Stewart <aric at codeweavers.com> wrote:
> Do we consider wine to be an OEM or a reimplementation of the base
> windows? Setting the homepage is easy enough it is just a registry key.
> However it is not something set when registering shdocvw.dll so i dont
> think we should set it there.  As a config option in winecfg sure.

Distributors of Wine can be OEM's so they need the ability to change
it. OEM's of course can tweak the registry before packaging. IE
provides the ablity to change this setting of course for the user  but
the built in iexplore does not so until its further developed, I think
we need the option for users to change it in winecfg. I'll try to
write a patch in the next day or so that adds this functionality to
winecfg.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From aric at codeweavers.com  Tue Dec  4 05:06:19 2007
From: aric at codeweavers.com (Aric Stewart)
Date: Tue, 04 Dec 2007 20:06:19 +0900
Subject: shdocvw #3: Set default home and search page.
In-Reply-To: <19e31a080712040301o30446a33u7635a2c594e72674@mail.gmail.com>
References: <473F3AF8.1050201@codeweavers.com>	
	<4754D893.4010406@codeweavers.com>	
	<19e31a080712040252w4b9d63f3w1d0efd66e41cb25b@mail.gmail.com>	
	<47553258.8060401@codeweavers.com>
	<19e31a080712040301o30446a33u7635a2c594e72674@mail.gmail.com>
Message-ID: <475534AB.4050807@codeweavers.com>

True, making it something for wine.inf or for winecfg, but not 
shdocvw.dll in my opinion.

-aric

Steven Edwards wrote:
> On Dec 4, 2007 5:56 AM, Aric Stewart <aric at codeweavers.com> wrote:
>> Do we consider wine to be an OEM or a reimplementation of the base
>> windows? Setting the homepage is easy enough it is just a registry key.
>> However it is not something set when registering shdocvw.dll so i dont
>> think we should set it there.  As a config option in winecfg sure.
> 
> Distributors of Wine can be OEM's so they need the ability to change
> it. OEM's of course can tweak the registry before packaging. IE
> provides the ablity to change this setting of course for the user  but
> the built in iexplore does not so until its further developed, I think
> we need the option for users to change it in winecfg. I'll try to
> write a patch in the next day or so that adds this functionality to
> winecfg.
> 



From jacek at codeweavers.com  Tue Dec  4 05:26:28 2007
From: jacek at codeweavers.com (Jacek Caban)
Date: Tue, 04 Dec 2007 12:26:28 +0100
Subject: shdocvw #3: Set default home and search page.
In-Reply-To: <475534AB.4050807@codeweavers.com>
References: <473F3AF8.1050201@codeweavers.com>		<4754D893.4010406@codeweavers.com>		<19e31a080712040252w4b9d63f3w1d0efd66e41cb25b@mail.gmail.com>		<47553258.8060401@codeweavers.com>	<19e31a080712040301o30446a33u7635a2c594e72674@mail.gmail.com>
	<475534AB.4050807@codeweavers.com>
Message-ID: <47553964.4010505@codeweavers.com>

Aric Stewart wrote:
> True, making it something for wine.inf or for winecfg, but not 
> shdocvw.dll in my opinion.
>   

Native shdocvw.dll doesn't support self registration at all and its
registration is done by IE installer IMO. If we want to be compatible
with native, we'd have to move everything from shdocvw.inf to wine.inf
(and that's not the way to go IMO). I've added these registries because
an app I've been working on expected default search page to be present.
Also we should use it in our InternetExplorer and WebBrowser
implementation. We may consider to handle these keys like we do with IE
version key. That is, they may be added on iexplore.exe registration. If
one wants to install native IE, he has to unregister iexplore.exe first,
removing the homepage. Then IE installer will probably set its default
homepage.

Jacek


From aric at codeweavers.com  Tue Dec  4 05:30:25 2007
From: aric at codeweavers.com (Aric Stewart)
Date: Tue, 04 Dec 2007 20:30:25 +0900
Subject: shdocvw #3: Set default home and search page.
In-Reply-To: <47553964.4010505@codeweavers.com>
References: <473F3AF8.1050201@codeweavers.com>		<4754D893.4010406@codeweavers.com>		<19e31a080712040252w4b9d63f3w1d0efd66e41cb25b@mail.gmail.com>		<47553258.8060401@codeweavers.com>	<19e31a080712040301o30446a33u7635a2c594e72674@mail.gmail.com>
	<475534AB.4050807@codeweavers.com>
	<47553964.4010505@codeweavers.com>
Message-ID: <47553A51.6090300@codeweavers.com>

Humm, maybe i am confused but (at least the win98 version of ) 
shdocvw.dll implements DllRegisterServer which seems to do a lot of 
stuff.  But Setting the Start Page is not one of them.  In my experience 
installing IE does not actually set a Start Page by default, but instead 
the browser seem to handle not having a Start Page by pulling up a 
default one.

-aric

Jacek Caban wrote:
> Aric Stewart wrote:
>> True, making it something for wine.inf or for winecfg, but not 
>> shdocvw.dll in my opinion.
>>   
> 
> Native shdocvw.dll doesn't support self registration at all and its
> registration is done by IE installer IMO. If we want to be compatible
> with native, we'd have to move everything from shdocvw.inf to wine.inf
> (and that's not the way to go IMO). I've added these registries because
> an app I've been working on expected default search page to be present.
> Also we should use it in our InternetExplorer and WebBrowser
> implementation. We may consider to handle these keys like we do with IE
> version key. That is, they may be added on iexplore.exe registration. If
> one wants to install native IE, he has to unregister iexplore.exe first,
> removing the homepage. Then IE installer will probably set its default
> homepage.
> 
> Jacek
> 



From stefan at codeweavers.com  Tue Dec  4 05:35:16 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Tue, 4 Dec 2007 12:35:16 +0100
Subject: dlls/wined3d/state.c -- fix error handling
In-Reply-To: <Pine.LNX.4.64.0712032258010.29138@acrux.dbai.tuwien.ac.at>
References: <Pine.LNX.4.64.0712032258010.29138@acrux.dbai.tuwien.ac.at>
Message-ID: <200712041235.18391.stefan@codeweavers.com>

Am Dienstag, 4. Dezember 2007 01:34:55 schrieb Gerald Pfeifer:
> This looks like a mistaken consistency check.  The code where mapped_stage
> is set looks as follows:
>
>   DWORD mapped_stage = stateblock->wineD3DDevice->texUnitMap[texUnit];
>
> and at other places we do check for -1, so this looks like another bug
> in error handling.
In fact the texUnitMap entries are never set to any value < 0 other than -1, 
so it doesn't make much difference, but for the sake of consistency we should 
check for -1 here as well
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071204/05118d8e/attachment.pgp 

From jacek at codeweavers.com  Tue Dec  4 05:58:35 2007
From: jacek at codeweavers.com (Jacek Caban)
Date: Tue, 04 Dec 2007 12:58:35 +0100
Subject: shdocvw #3: Set default home and search page.
In-Reply-To: <47553A51.6090300@codeweavers.com>
References: <473F3AF8.1050201@codeweavers.com>		<4754D893.4010406@codeweavers.com>		<19e31a080712040252w4b9d63f3w1d0efd66e41cb25b@mail.gmail.com>		<47553258.8060401@codeweavers.com>	<19e31a080712040301o30446a33u7635a2c594e72674@mail.gmail.com>
	<475534AB.4050807@codeweavers.com>
	<47553964.4010505@codeweavers.com>
	<47553A51.6090300@codeweavers.com>
Message-ID: <475540EB.6080401@codeweavers.com>

Aric Stewart wrote:
> Humm, maybe i am confused but (at least the win98 version of )
> shdocvw.dll implements DllRegisterServer which seems to do a lot of
> stuff.  But Setting the Start Page is not one of them.  In my
> experience installing IE does not actually set a Start Page by
> default, but instead the browser seem to handle not having a Start
> Page by pulling up a default one.
>

I've checked it again and it looks like shdocvw registers only its
typelib, nothing else like coclasses. I will do more testing later today.

Jacek



From the3dfxdude at gmail.com  Tue Dec  4 09:00:17 2007
From: the3dfxdude at gmail.com (Jesse Allen)
Date: Tue, 4 Dec 2007 08:00:17 -0700
Subject: dib engine
In-Reply-To: <47549257.1060508@konto.pl>
References: <47549257.1060508@konto.pl>
Message-ID: <530468570712040700s7df0b25eic48b62f4698879a1@mail.gmail.com>

On Dec 3, 2007 4:33 PM, Piotr Maceluch <skrzynka365 at konto.pl> wrote:
> Hi,
> what's the status of DIB engine (or where can one read about it)? Are
> the up-to-date sources still available? What kind of help would be needed?
> Thanks
>   Peter Maceluch


If you are talking about my project, it is still available, and I
merged up to a recent git snapshot two weeks ago.
http://repo.or.cz/w/wine/dibdrv.git

I can't promise too much until after finals. I'm going to work on it
and finish the image support during my break. Finishing the image
support and proper forwarding of the missing stuff is probably what is
needed to get it merged into wine.

If you need to have it merged up again, I will do that. If you want to
start hacking on it, pretty much any of the stubs you can work on.

Jesse


From kai.blin at gmail.com  Tue Dec  4 17:14:02 2007
From: kai.blin at gmail.com (Kai Blin)
Date: Wed, 5 Dec 2007 00:14:02 +0100
Subject: Wine Weekly News
Message-ID: <200712050014.02742.kai.blin@gmail.com>

Hi Zach,

thanks for getting a new WWN issue out there. Finally there's more than one 
release after the other. I think WWN is a really valuable ressource for our 
users. Also, I hope it'll be a platform to get some GSoC exposure on the 
front page, especially without me having to take care of it. ;)

Thanks,
Kai
-- 
Kai Blin
WorldForge developer  http://www.worldforge.org/
Wine developer        http://wiki.winehq.org/KaiBlin
Samba team member     http://www.samba.org/samba/team/
--
Will code for cotton.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071205/d28bfb69/attachment.pgp 

From zgs at seas.upenn.edu  Tue Dec  4 17:23:10 2007
From: zgs at seas.upenn.edu (Zachary Goldberg)
Date: Tue, 4 Dec 2007 18:23:10 -0500
Subject: Wine Weekly News
In-Reply-To: <200712050014.02742.kai.blin@gmail.com>
References: <200712050014.02742.kai.blin@gmail.com>
Message-ID: <b050a5e70712041523k3e0f4707rfefb19afd4e3f3b5@mail.gmail.com>

Kai,

It was my pleasure :).  Keep the interesting wine discussion/news
coming and I'll keep writing WWNs.  I'll also make note to highlight
in particular GSoC developments as they happen.

--Zach

On Dec 4, 2007 6:14 PM, Kai Blin <kai.blin at gmail.com> wrote:
> Hi Zach,
>
> thanks for getting a new WWN issue out there. Finally there's more than one
> release after the other. I think WWN is a really valuable ressource for our
> users. Also, I hope it'll be a platform to get some GSoC exposure on the
> front page, especially without me having to take care of it. ;)
>
> Thanks,
> Kai
> --
> Kai Blin
> WorldForge developer  http://www.worldforge.org/
> Wine developer        http://wiki.winehq.org/KaiBlin
> Samba team member     http://www.samba.org/samba/team/
> --
> Will code for cotton.
>



-- 
Zachary Goldberg
Computer Science & Engineering
Electrical Captain of Penn Electric Race Team
School of Engineering at the University of Pennsylvania


From ripzonetriton at gmail.com  Tue Dec  4 17:43:43 2007
From: ripzonetriton at gmail.com (Triton)
Date: Tue, 4 Dec 2007 23:43:43 +0000
Subject: Wine Weekly News
In-Reply-To: <b050a5e70712041523k3e0f4707rfefb19afd4e3f3b5@mail.gmail.com>
References: <200712050014.02742.kai.blin@gmail.com>
	<b050a5e70712041523k3e0f4707rfefb19afd4e3f3b5@mail.gmail.com>
Message-ID: <20071204234343.d47401e9.ripzonetriton@gmail.com>

On Tue, 4 Dec 2007 18:23:10 -0500
"Zachary Goldberg" <zgs at seas.upenn.edu> wrote:

> Kai,
> 
> It was my pleasure :).  Keep the interesting wine discussion/news
> coming and I'll keep writing WWNs.  I'll also make note to highlight
> in particular GSoC developments as they happen.
> 
> --Zach

Hi everyone, I've been following the mailing lists for some time now, this is my first post. OK, presentation done...

I also had to thank you bring to life the WWN, it's a great resource for those who don't actively follow the development discussions.

-- 
Triton <ripzonetriton at gmail.com>


From winehacker at gmail.com  Wed Dec  5 00:21:13 2007
From: winehacker at gmail.com (Steven Edwards)
Date: Wed, 5 Dec 2007 01:21:13 -0500
Subject: dlls/icmp/icmp_main.c -- attempt at fixing regression in r1.30
	(RESEND)
In-Reply-To: <Pine.LNX.4.64.0712050133280.29138@acrux.dbai.tuwien.ac.at>
References: <Pine.LNX.4.64.0712050133280.29138@acrux.dbai.tuwien.ac.at>
Message-ID: <19e31a080712042221o43c670b3p7b4776b816c3d56e@mail.gmail.com>

Hello,

On Dec 4, 2007 7:34 PM, Gerald Pfeifer <gerald at pfeifer.com> wrote:
> Since Alexandre has asked me to take care of overflow in some other
> context, I figured I could ping this underflow patch in return. ;-)
>
> Gerald
>
> ---------- Forwarded message ----------
> From: Gerald Pfeifer <gerald at pfeifer.com>
> To:  <wine-patches at winehq.org>, Damjan Jovanovic <damjan.jov at gmail.com>
> Date: Thu, 22 Nov 2007 22:32:08 +0100 (CET)
> Subject: dlls/icmp/icmp_main.c -- attempt at fixing regression in r1.30
>
> I believe revision 1.30 of dlls/icmp/icmp_main.c
>
>   date: 2006-11-06 11:51:07 +0000;  author: julliard;  state: Exp;  lines: +10 -15;
>   Damjan Jovanovic <damjan.jov at gmail.com>
>   icmp: Changed select to poll.

Could we just revert this patch? I think poll is not a valid api on
win32 so this breaks the windows port. I don't really see the need in
this change here in the first place.

Thanks
-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From julliard at winehq.org  Wed Dec  5 05:06:44 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 05 Dec 2007 12:06:44 +0100
Subject: dlls/icmp/icmp_main.c -- attempt at fixing regression in r1.30
	(RESEND)
In-Reply-To: <Pine.LNX.4.64.0712050133280.29138@acrux.dbai.tuwien.ac.at>
	(Gerald Pfeifer's message of "Wed, 5 Dec 2007 01:34:23 +0100 (CET)")
References: <Pine.LNX.4.64.0712050133280.29138@acrux.dbai.tuwien.ac.at>
Message-ID: <87lk89e6yj.fsf@wine.dyndns.org>

Gerald Pfeifer <gerald at pfeifer.com> writes:

> Since Alexandre has asked me to take care of overflow in some other
> context, I figured I could ping this underflow patch in return. ;-)

Looks ok, please submit the patch with a proper Changelog entry.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Wed Dec  5 06:35:32 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 05 Dec 2007 13:35:32 +0100
Subject: [3/5] shell32: fix buffer sizes
In-Reply-To: <200712011939.37552.lav@etersoft.ru> (Vitaly Lipatov's message of
	"Sat, 1 Dec 2007 19:39:37 +0300")
References: <200712011939.37552.lav@etersoft.ru>
Message-ID: <87hcixe2uj.fsf@wine.dyndns.org>

Vitaly Lipatov <lav at etersoft.ru> writes:

> lstrcpynW needs size in TCHARS
> RegEnumKey needs size in TCHARS

It would be better to change the HCR_GetDefaultVerbW function to take a
len in WCHARs since it's returning a string in all cases.

-- 
Alexandre Julliard
julliard at winehq.org


From tzi063 at student.uib.no  Wed Dec  5 06:51:32 2007
From: tzi063 at student.uib.no (Tomas Zijdemans)
Date: Wed, 05 Dec 2007 13:51:32 +0100
Subject: Wine Weekly News
In-Reply-To: <20071204234343.d47401e9.ripzonetriton@gmail.com>
References: <200712050014.02742.kai.blin@gmail.com>	<b050a5e70712041523k3e0f4707rfefb19afd4e3f3b5@mail.gmail.com>
	<20071204234343.d47401e9.ripzonetriton@gmail.com>
Message-ID: <fj66p0$kl7$1@ger.gmane.org>

This is great :)

Would it be a good idea to include major news from the appDB?
Ex: "Photoshop cs2 has now reached Gold status"

I think this would be very inspiring to users.


Tomas

Triton wrote:
> On Tue, 4 Dec 2007 18:23:10 -0500
> "Zachary Goldberg" <zgs at seas.upenn.edu> wrote:
> 
>> Kai,
>>
>> It was my pleasure :).  Keep the interesting wine discussion/news
>> coming and I'll keep writing WWNs.  I'll also make note to highlight
>> in particular GSoC developments as they happen.
>>
>> --Zach
> 
> Hi everyone, I've been following the mailing lists for some time now, this is my first post. OK, presentation done...
> 
> I also had to thank you bring to life the WWN, it's a great resource for those who don't actively follow the development discussions.
> 



From mstefani at redhat.com  Wed Dec  5 08:01:43 2007
From: mstefani at redhat.com (Michael Stefaniuc)
Date: Wed, 05 Dec 2007 15:01:43 +0100
Subject: dlls/icmp/icmp_main.c -- attempt at fixing regression in r1.30
	(RESEND)
In-Reply-To: <Pine.LNX.4.64.0712051213110.29138@acrux.dbai.tuwien.ac.at>
References: <Pine.LNX.4.64.0712050133280.29138@acrux.dbai.tuwien.ac.at>	<87lk89e6yj.fsf@wine.dyndns.org>
	<Pine.LNX.4.64.0712051213110.29138@acrux.dbai.tuwien.ac.at>
Message-ID: <4756AF47.6030301@redhat.com>

Gerald Pfeifer wrote:
> On Wed, 5 Dec 2007, Alexandre Julliard wrote:
>> Looks ok, please submit the patch with a proper Changelog entry.
> 
> Thanks for looking into this!  Here we go! :-)

> ChangeLog:
> Correctly handle underflow in IcmpSendEcho(); bug introduced in rev 1.30.
Still using cvs? I guess nobody else can do anything with rev 1.30.

bye
	michael

> Index: dlls/icmp/icmp_main.c
> ===================================================================
> RCS file: /home/wine/wine/dlls/icmp/icmp_main.c,v
> retrieving revision 1.30
> diff -u -3 -p -r1.30 icmp_main.c
> --- dlls/icmp/icmp_main.c	6 Nov 2006 11:51:07 -0000	1.30
> +++ dlls/icmp/icmp_main.c	22 Nov 2007 21:28:59 -0000
> @@ -433,8 +433,9 @@ DWORD WINAPI IcmpSendEcho(
>               * Decrease the timeout so that we don't enter an endless loop even
>               * if we get flooded with ICMP packets that are not for us.
>               */
> -            Timeout -= (recv_time - send_time);
> -            if (Timeout < 0) Timeout = 0;
> +            DWORD t = (recv_time - send_time);
> +            if (Timeout > t) Timeout -= t;
> +            else             Timeout = 0;
>              continue;
>          } else {
>              /* This is a reply to our packet */
> 
> 


-- 
Michael Stefaniuc                           Tel.: +49-711-96437-199
Consulting Communications Engineer          Fax.: +49-711-96437-111
--------------------------------------------------------------------
Reg. Adresse: Red Hat GmbH, Hauptst?tter Strasse 58, 70178 Stuttgart
Handelsregister: Amtsgericht Stuttgart HRB 153243
Gesch?ftsf?hrer: Brendan Lane, Charlie Peters, Michael Cunningham,
                 Werner Knoblich


From zgold550 at gmail.com  Wed Dec  5 09:08:27 2007
From: zgold550 at gmail.com (Zachary Goldberg)
Date: Wed, 5 Dec 2007 10:08:27 -0500
Subject: Wine Weekly News
In-Reply-To: <fj66p0$kl7$1@ger.gmane.org>
References: <200712050014.02742.kai.blin@gmail.com>
	<b050a5e70712041523k3e0f4707rfefb19afd4e3f3b5@mail.gmail.com>
	<20071204234343.d47401e9.ripzonetriton@gmail.com>
	<fj66p0$kl7$1@ger.gmane.org>
Message-ID: <b050a5e70712050708k7626c53mf4add2723191103d@mail.gmail.com>

Hmmm interesting idea.  I don't actually know just yet who the
maintainer of the AppDB is, but he/she may respond in this thread
(I'll attempt to find out their email anyway) as to whether or not its
possible to generate a weekly summary of applications which have been
"upgraded" through the week?  I agree that that would be a great
addition.


--Zach

On Dec 5, 2007 7:51 AM, Tomas Zijdemans <tzi063 at student.uib.no> wrote:
> This is great :)
>
> Would it be a good idea to include major news from the appDB?
> Ex: "Photoshop cs2 has now reached Gold status"
>
> I think this would be very inspiring to users.
>
>
> Tomas
>
>
> Triton wrote:
> > On Tue, 4 Dec 2007 18:23:10 -0500
> > "Zachary Goldberg" <zgs at seas.upenn.edu> wrote:
> >
> >> Kai,
> >>
> >> It was my pleasure :).  Keep the interesting wine discussion/news
> >> coming and I'll keep writing WWNs.  I'll also make note to highlight
> >> in particular GSoC developments as they happen.
> >>
> >> --Zach
> >
> > Hi everyone, I've been following the mailing lists for some time now, this is my first post. OK, presentation done...
> >
> > I also had to thank you bring to life the WWN, it's a great resource for those who don't actively follow the development discussions.
> >
>
>
>
>



-- 
Zachary Goldberg
Computer Science & Engineering
Electrical Captain of Penn Electric Race Team
School of Engineering at the University of Pennsylvania


From dmitry at codeweavers.com  Wed Dec  5 09:12:31 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Wed, 5 Dec 2007 23:12:31 +0800
Subject: system.sfd: make 18 pixel strike with Japanese jvgasys glyphs
References: <4756BC0D.1060308@codeweavers.com>
Message-ID: <01cb01c83751$441f4dc0$6700fea9@DMITRY>

"Aric Stewart" <aric at codeweavers.com> wrote:

>  fonts/system.sfd | 1407 
> ++++++++++++++++++++++++++++++++++++++++++++++--------
>  1 files changed, 1213 insertions(+), 194 deletions(-)

For some reason widths of many glyphs are changed by this patch,
that doesn't look correct.

-- 
Dmitry.


From alex at thehandofagony.com  Wed Dec  5 09:20:03 2007
From: alex at thehandofagony.com (Alexander Nicolaysen =?iso-8859-1?q?S=F8rnes?=)
Date: Wed, 5 Dec 2007 16:20:03 +0100
Subject: Wine Weekly News
In-Reply-To: <b050a5e70712050708k7626c53mf4add2723191103d@mail.gmail.com>
References: <200712050014.02742.kai.blin@gmail.com>
	<fj66p0$kl7$1@ger.gmane.org>
	<b050a5e70712050708k7626c53mf4add2723191103d@mail.gmail.com>
Message-ID: <200712051620.03613.alex@thehandofagony.com>

On Wednesday 05 December 2007 16:08:27 Zachary Goldberg wrote:
> Hmmm interesting idea.  I don't actually know just yet who the
> maintainer of the AppDB is, but he/she may respond in this thread
> (I'll attempt to find out their email anyway) as to whether or not its
> possible to generate a weekly summary of applications which have been
> "upgraded" through the week?  I agree that that would be a great
> addition.
>

Their e-mail is appdb at winehq.org.  They'll have to decide how to track the 
changes, but in any case the code should be in soon.



Alexander N. S?rnes

>
> --Zach
>
> On Dec 5, 2007 7:51 AM, Tomas Zijdemans <tzi063 at student.uib.no> wrote:
> > This is great :)
> >
> > Would it be a good idea to include major news from the appDB?
> > Ex: "Photoshop cs2 has now reached Gold status"
> >
> > I think this would be very inspiring to users.
> >
> >
> > Tomas
> >
> > Triton wrote:
> > > On Tue, 4 Dec 2007 18:23:10 -0500
> > >
> > > "Zachary Goldberg" <zgs at seas.upenn.edu> wrote:
> > >> Kai,
> > >>
> > >> It was my pleasure :).  Keep the interesting wine discussion/news
> > >> coming and I'll keep writing WWNs.  I'll also make note to highlight
> > >> in particular GSoC developments as they happen.
> > >>
> > >> --Zach
> > >
> > > Hi everyone, I've been following the mailing lists for some time now,
> > > this is my first post. OK, presentation done...
> > >
> > > I also had to thank you bring to life the WWN, it's a great resource
> > > for those who don't actively follow the development discussions.




From thunderbird2k at gmx.net  Wed Dec  5 11:52:07 2007
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Wed, 05 Dec 2007 18:52:07 +0100
Subject: wined3d:context.c Check for a context is added
In-Reply-To: <4756D113.405@etersoft.ru>
References: <4756D113.405@etersoft.ru>
Message-ID: <20071205175207.86820@gmx.net>

> We need to check context before than refer it.
> 
> Changelog:
>     Check for a context is added
> 
> -- 
> Best regards
> 	Anatoly Lyutin.
> 

Hi,

I'm not sure if your patch is correct. The block of code in front of the if-statement you added should have found or else created a context. If afterwards there is no context it sounds like something went wrong. Returning NULL isn't correct then. When we just return we keep using the old context (if one was around) which might work for your program but it isn't guaranteed to work at all.

So what is the real problem?

Regards,
Roderick
-- 
Der GMX SmartSurfer hilft bis zu 70% Ihrer Onlinekosten zu sparen! 
Ideal f?r Modem und ISDN: http://www.gmx.net/de/go/smartsurfer


From vostok at etersoft.ru  Wed Dec  5 12:01:12 2007
From: vostok at etersoft.ru (Anatoly Lyutin)
Date: Wed, 05 Dec 2007 21:01:12 +0300
Subject: wined3d:context.c Check for a context is added
In-Reply-To: <20071205175207.86820@gmx.net>
References: <4756D113.405@etersoft.ru> <20071205175207.86820@gmx.net>
Message-ID: <4756E768.1060402@etersoft.ru>

Roderick Colenbrander wrote:
>
> Hi,
>
>   
Hi!
> I'm not sure if your patch is correct. The block of code in front of the if-statement you added should have found or else created a context. If afterwards there is no context it sounds like something went wrong. Returning NULL isn't correct then. When we just return we keep using the old context (if one was around) which might work for your program but it isn't guaranteed to work at all.
>
> So what is the real problem?
>   
I use  one application that falls after exit:

ixme:dbghelp_dwarf:dwarf2_parse_variable Unsupported form for const value
srgb_sub_high (a)
Register dump:
 CS:0073 SS:007b DS:007b ES:007b FS:0033 GS:003b
 EIP:7ebe66f5 ESP:0033faac EBP:0033fae4 EFLAGS:00210202(   - 00      - -RI1)
 EAX:00000000 EBX:7ec91428 ECX:00000000 EDX:0013c908
 ESI:00000014 EDI:0013b588
Stack dump:
0x0033faac:  00110000 00000000 0013ae78 00000000
0x0033fabc:  7ecbad04 02ff7de8 0033fae4 7ecb01ee
0x0033facc:  02ff7de8 0033fb08 00000405 7ec91428
0x0033fadc:  02ff6360 0013c908 0033fb14 7ebe32a0
0x0033faec:  0013c908 0013b588 00000001 00000007
0x0033fafc:  00000000 00110000 00000000 7ec91428
Backtrace:
=>1 0x7ebe66f5 ActivateContext+0x75(This=0x13c908, target=0x13b588, usage=0x1)
[/srv/vostok/Projects/wine/dlls/wined3d/context.c:867] in wined3d (0x0033fae4)
  2 0x7ebe32a0 IWineD3DBaseTextureImpl_CleanUp+0x50(iface=<register ESI not in
topmost frame>) [/srv/vostok/Projects/wine/dlls/wined3d/basetexture.c:75] in
wined3d (0x0033fb14)
  3 0x7ec4cce6 IWineD3DTextureImpl_Destroy+0xa6(iface=<register EDI not in
topmost frame>, D3DCB_DestroySurface=0x7eca75e0)
[/srv/vostok/Projects/wine/dlls/wined3d/texture.c:237] in wined3d (0x0033fb44)
  4 0x7ecb1147 IDirect3DTexture8Impl_Release+0x57(iface=0x2f0c8a0)
[/srv/vostok/Projects/wine/dlls/d3d8/texture.c:62] in d3d8 (0x0033fb84)
  5 0x005ef395 in mme (+0xaf395) (0x0033fba0)
  6 0x005ef44b in mme (+0xaf44b) (0x0033fbac)
  7 0x005ef69f in mme (+0xaf69f) (0x0033fbc8)
  8 0x005e4ad3 in mme (+0xa4ad3) (0x0033fbd4)
  9 0x0057fd3f in mme (+0x3fd3f) (0x0033fbe4)
  10 0x005a040f in mme (+0x6040f) (0x0033fbf0)
  11 0x0059a4aa in mme (+0x5a4aa) (0x0033fc08)
  12 0x0059a7bf in mme (+0x5a7bf) (0x0033fc14)
  13 0x00548ec4 in mme (+0x8ec4) (0x0033fc2c)
  14 0x0056e770 in mme (+0x2e770) (0x0033fc3c)
  15 0x005af139 in mme (+0x6f139) (0x0033fc4c)
  16 0x0054443d in mme (+0x443d) (0x0033fc6c)


> Regards,
> Roderick
>   


-- 
Best regards
	Anatoly Lyutin.



From stefandoesinger at gmx.at  Wed Dec  5 13:46:06 2007
From: stefandoesinger at gmx.at (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Wed, 5 Dec 2007 20:46:06 +0100
Subject: wined3d:context.c Check for a context is added
In-Reply-To: <4756D113.405@etersoft.ru>
References: <4756D113.405@etersoft.ru>
Message-ID: <200712052046.10836.stefandoesinger@gmx.at>

Am Mittwoch, 5. Dezember 2007 17:25:55 schrieb Anatoly Lyutin:
> We need to check context before than refer it.
>
> Changelog:
>     Check for a context is added
Does that happen to fix any game? The idea was that the activeContext pointer 
never points to NULL, so a check like that only workaround a bug somewhere 
else
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071205/baf4ef96/attachment.pgp 

From stefandoesinger at gmx.at  Wed Dec  5 13:50:59 2007
From: stefandoesinger at gmx.at (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Wed, 5 Dec 2007 20:50:59 +0100
Subject: d3dx8 [2/2]: add basic functions for MatrixStack
In-Reply-To: <20071205181330.8c78pachgkc4kgk4@webmail.math.cnrs.fr>
References: <20071205181330.8c78pachgkc4kgk4@webmail.math.cnrs.fr>
Message-ID: <200712052051.02620.stefandoesinger@gmx.at>

Am Mittwoch, 5. Dezember 2007 18:13:30 schrieb David.Adam at math.cnrs.fr:
> This is my first attempt with ICOM objects. So, all the advices are
> welcome.
A few suggestions:

+HRESULT WINAPI ID3DXMatrixStackImpl_QueryInterface(ID3DXMatrixStack *iface, 
REFIID riid, void **ppvObject)
+ ...
+     IClassFactory_AddRef(iface);
It is better to use ID3DXMatrixStack_AddRef(iface) here. It is essentially the 
same, but it looks more consistent

The AddRef() and Release() methods should have a TRACE which write either the 
new or old refcount, otherwise tracking refcounting bugs is hell.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071205/ae34fe2e/attachment.pgp 

From brian.vincent at gmail.com  Wed Dec  5 14:30:54 2007
From: brian.vincent at gmail.com (Brian Vincent)
Date: Wed, 5 Dec 2007 13:30:54 -0700
Subject: Wine Weekly News
In-Reply-To: <200712051620.03613.alex@thehandofagony.com>
References: <200712050014.02742.kai.blin@gmail.com>
	<fj66p0$kl7$1@ger.gmane.org>
	<b050a5e70712050708k7626c53mf4add2723191103d@mail.gmail.com>
	<200712051620.03613.alex@thehandofagony.com>
Message-ID: <3010968c0712051230t21ab7ce2g8f22e9eca660227d@mail.gmail.com>

On Dec 5, 2007 8:20 AM, Alexander Nicolaysen S?rnes
<alex at thehandofagony.com> wrote:
>
> Their e-mail is appdb at winehq.org.  They'll have to decide how to track the
> changes, but in any case the code should be in soon.

What about downgrades?  Regressions happen.  It'd be terrible one week
to promise something working and then a user finding out it's broken a
few months later.  Of course, even if we could report on apps
regressing it would rely on people actually changing the status in
AppDB and I'm not so sure that'll happen.

-Brian


From zgold550 at gmail.com  Wed Dec  5 14:32:08 2007
From: zgold550 at gmail.com (Zachary Goldberg)
Date: Wed, 5 Dec 2007 15:32:08 -0500
Subject: Wine Weekly News
In-Reply-To: <3010968c0712051230t21ab7ce2g8f22e9eca660227d@mail.gmail.com>
References: <200712050014.02742.kai.blin@gmail.com>
	<fj66p0$kl7$1@ger.gmane.org>
	<b050a5e70712050708k7626c53mf4add2723191103d@mail.gmail.com>
	<200712051620.03613.alex@thehandofagony.com>
	<3010968c0712051230t21ab7ce2g8f22e9eca660227d@mail.gmail.com>
Message-ID: <b050a5e70712051232y60f26574m1b80fa37a6826138@mail.gmail.com>

Brian,

Yep -- i'll be tracking downgrades too.  I'm actually writing the code
myself, you'll likely see the results in next weeks issue

--Zach

On Dec 5, 2007 3:30 PM, Brian Vincent <brian.vincent at gmail.com> wrote:
> On Dec 5, 2007 8:20 AM, Alexander Nicolaysen S?rnes
> <alex at thehandofagony.com> wrote:
> >
> > Their e-mail is appdb at winehq.org.  They'll have to decide how to track the
> > changes, but in any case the code should be in soon.
>
> What about downgrades?  Regressions happen.  It'd be terrible one week
> to promise something working and then a user finding out it's broken a
> few months later.  Of course, even if we could report on apps
> regressing it would rely on people actually changing the status in
> AppDB and I'm not so sure that'll happen.
>
> -Brian
>



-- 
Zachary Goldberg
Computer Science & Engineering
Electrical Captain of Penn Electric Race Team
School of Engineering at the University of Pennsylvania


From infyquest at gmail.com  Wed Dec  5 16:46:59 2007
From: infyquest at gmail.com (Vijay Kiran Kamuju)
Date: Wed, 5 Dec 2007 16:46:59 -0600
Subject: A small question regarding cpuid
Message-ID: <36bf289b0712051446o8168860x57ab9df0c1c0b944@mail.gmail.com>

Hi,

I was going through dlls/kernel32/cpu.c and stumbled upon the
functions do_cpuid and have_cpuid.
It seems the assembly code for both the Intel and AMD 64 bit processors.
Is it possible to remove the ifdefs or add the x86_64 ifdef.
And one more question does this change help 64 bit windows support?

Thanks,
VJ


From ben at atomnet.co.uk  Wed Dec  5 16:50:51 2007
From: ben at atomnet.co.uk (Ben Hodgetts (Enverex))
Date: Wed, 05 Dec 2007 22:50:51 +0000
Subject: Wine Weekly News
In-Reply-To: <fj66p0$kl7$1@ger.gmane.org>
References: <200712050014.02742.kai.blin@gmail.com>	<b050a5e70712041523k3e0f4707rfefb19afd4e3f3b5@mail.gmail.com>	<20071204234343.d47401e9.ripzonetriton@gmail.com>
	<fj66p0$kl7$1@ger.gmane.org>
Message-ID: <47572B4B.4030707@atomnet.co.uk>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Possibly, but on the other hand it could just as easily become "Garbage"
in the next release of Wine ;)

(sorry, I already sent this once at the start of the day but emailed it
directly to the previous person rather than back to the list)

Ben H.

Tomas Zijdemans wrote:
> This is great :)
>
> Would it be a good idea to include major news from the appDB?
> Ex: "Photoshop cs2 has now reached Gold status"
>
> I think this would be very inspiring to users.
>
>
> Tomas
>
> Triton wrote:
>> On Tue, 4 Dec 2007 18:23:10 -0500
>> "Zachary Goldberg" <zgs at seas.upenn.edu> wrote:
>>
>>> Kai,
>>>
>>> It was my pleasure :).  Keep the interesting wine discussion/news
>>> coming and I'll keep writing WWNs.  I'll also make note to highlight
>>> in particular GSoC developments as they happen.
>>>
>>> --Zach
>> Hi everyone, I've been following the mailing lists for some time now, this is my first post. OK, presentation done...
>>
>> I also had to thank you bring to life the WWN, it's a great resource for those who don't actively follow the development discussions.
>>
>
>
>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFHVytLuqCUopk11kIRAkesAJ9d/vngVV71xY/749SA8g5hkys4DgCfVEwh
IlVnueogwUYAb4y1qx4iU38=
=qmuz
-----END PGP SIGNATURE-----


From mstefani at redhat.com  Wed Dec  5 16:51:58 2007
From: mstefani at redhat.com (Michael Stefaniuc)
Date: Wed, 05 Dec 2007 23:51:58 +0100
Subject: secur32: Remove the SECUR32_ALLOC() macro around HeapAlloc().
In-Reply-To: <3a768c550712051254o5c1f175dh3cf31a03fbfa4d55@mail.gmail.com>
References: <20071205205220.GA26291@redhat.com>
	<3a768c550712051254o5c1f175dh3cf31a03fbfa4d55@mail.gmail.com>
Message-ID: <47572B8E.3070203@redhat.com>

Juan Lang wrote:
> On Dec 5, 2007 12:52 PM, Michael Stefaniuc <mstefani at redhat.de> wrote:
>> Checked with Kai and Dmitry and there is nothing special about
>> SECUR32_ALLOC(). There are more direct usages of HeapAlloc()
>> than of the macro so instead of replacing SECUR32_ALLOC() with
>> heap_alloc() just remove it altogether.
> 
> No prob.  I introduced those macros some years ago before valgrind was
> usable with wine, it made debugging memory leaks (via redefinition of
> the macros with special leak-tracking ones) easier.  Valgrind is
> certainly better.
I thought that was still the reason why those $dll_alloc() and now
heap_alloc() wrappers are used. I mean the main reason cause we all know
that the HeapAlloc() API just sucks.

bye
	michael
-- 
Michael Stefaniuc               Tel.: +49-711-96437-199
Sr. Network Engineer            Fax.: +49-711-96437-111
--------------------------------------------------------------------
Reg. Adresse: Red Hat GmbH, Hauptst?tter Strasse 58, 70178 Stuttgart
Handelsregister: Amtsgericht Stuttgart HRB 153243
Gesch?ftsf?hrer: Brendan Lane, Charlie Peters, Michael Cunningham,
                 Werner Knoblich


From zgold550 at gmail.com  Wed Dec  5 17:02:36 2007
From: zgold550 at gmail.com (Zachary Goldberg)
Date: Wed, 5 Dec 2007 18:02:36 -0500
Subject: Wine Weekly News
In-Reply-To: <47572B4B.4030707@atomnet.co.uk>
References: <200712050014.02742.kai.blin@gmail.com>
	<b050a5e70712041523k3e0f4707rfefb19afd4e3f3b5@mail.gmail.com>
	<20071204234343.d47401e9.ripzonetriton@gmail.com>
	<fj66p0$kl7$1@ger.gmane.org> <47572B4B.4030707@atomnet.co.uk>
Message-ID: <b050a5e70712051502p4da42a09p209bce3e9b663bf2@mail.gmail.com>

I've finished coding a script which runs the necessary query to
generate data (I download a database backup and run the queries on my
local machine.).  As a sampling (if anybody feels like tripple
checking that the data is correct) of "Upgrades" (and some downgrades)
from 11-27-2007 to 12-04-2007:

Chromadrome 2 - Demo 1.0 (18165)  went from Garbage (2007-11-25
01:25:25) to Platinum (2007-12-02 11:50:43)
Age of Empires II The Age of Kings: 2.x (18083)  went from Silver
(2007-11-15 15:58:30) to Gold (2007-11-30 16:30:18)
Dreamweaver MX (18123)  went from Silver (2007-07-22 03:17:03) to
Garbage (2007-12-01 17:41:49)
Call of Duty United Offensive: 1.5 (18163)  went from Gold (2007-04-06
07:46:23) to Platinum (2007-12-02 11:12:50)
Crysis Single player demo (18094)  went from Garbage (2007-11-06
12:49:00) to Bronze (2007-12-01 03:25:13)
Eschalon Book I Demo Demo (18029)  went from Garbage (2007-11-22
02:37:49) to Platinum (2007-11-29 03:11:20)
Gothic 1.0x (18154)  went from Bronze (2007-11-09 11:48:03) to Garbage
(2007-12-02 09:21:57)
Proteus 7.2 (18050)  went from Garbage (2007-11-18 07:08:51) to Silver
(2007-11-29 22:20:27)
Ys origin 1.1.0.0 - Adol Version (18060)  went from Bronze (2007-07-13
00:20:48) to Silver (2007-11-30 01:38:14)
Mp3tag v2.39 (17994)  went from Platinum (2007-10-20 11:01:13) to Gold
(2007-11-27 15:44:51)
Crayon Release 1 (17988)  went from Gold (2007-11-17 13:34:11) to
Platinum (2007-11-27 11:30:05)
Silencer 1.10.1 (18087)  went from Silver (2007-11-16 15:04:45) to
Platinum (2007-11-30 17:22:00)
.NET Framework 2.0 (18042)  went from Garbage (2007-11-29 10:07:26) to
Platinum (2007-11-30 11:35:57)
Tom Clancy's Rainbow Six 3: Raven Shield 1.60 (18057)  went from
Garbage (2007-10-17 11:44:55) to Bronze (2007-11-29 21:43:19)
Safari 3.x Public Beta (18196)  went from Garbage (2007-11-21
03:21:32) to Bronze (2007-12-03 10:03:37)
TTPlayer 5.0.1 (18191)  went from Silver (2007-11-07 05:24:39) to Gold
(2007-12-03 08:43:31)
Sid Meier's Civilization IV Civilization IV Beyond The Sword (3.13)
(18108)  went from Bronze (2007-11-07 06:34:47) to Silver (2007-12-01
10:08:49)
Original War 1.08 (18041)  went from Garbage (2007-11-18 19:59:13) to
Bronze (2007-11-29 09:31:33)
Half-Life 2 Half-Life: Source (17993)  went from Garbage (2007-11-05
14:08:10) to Platinum (2007-11-27 13:49:48)
Serif PhotoPlus PhotoPlus 11 (18201)  went from Garbage (2007-11-17
17:02:33) to Gold (2007-12-03 12:40:39)
MapSource 6.11.5 (18021)  went from Silver (2007-10-17 05:19:10) to
Gold (2007-11-28 18:11:37)
Call of Duty 4: Modern Warfare Demo (18143)  went from Garbage
(2007-11-16 11:59:30) to Silver (2007-12-02 06:40:04)
SimCity 4 1.1 638 Rush Hour (18148)  went from Gold (2007-11-25
14:58:28) to Bronze (2007-12-02 07:40:50)





On Dec 5, 2007 5:50 PM, Ben Hodgetts (Enverex) <ben at atomnet.co.uk> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Possibly, but on the other hand it could just as easily become "Garbage"
> in the next release of Wine ;)
>
> (sorry, I already sent this once at the start of the day but emailed it
> directly to the previous person rather than back to the list)
>
> Ben H.
>
>
> Tomas Zijdemans wrote:
> > This is great :)
> >
> > Would it be a good idea to include major news from the appDB?
> > Ex: "Photoshop cs2 has now reached Gold status"
> >
> > I think this would be very inspiring to users.
> >
> >
> > Tomas
> >
> > Triton wrote:
> >> On Tue, 4 Dec 2007 18:23:10 -0500
> >> "Zachary Goldberg" <zgs at seas.upenn.edu> wrote:
> >>
> >>> Kai,
> >>>
> >>> It was my pleasure :).  Keep the interesting wine discussion/news
> >>> coming and I'll keep writing WWNs.  I'll also make note to highlight
> >>> in particular GSoC developments as they happen.
> >>>
> >>> --Zach
> >> Hi everyone, I've been following the mailing lists for some time now, this is my first post. OK, presentation done...
> >>
> >> I also had to thank you bring to life the WWN, it's a great resource for those who don't actively follow the development discussions.
> >>
> >
> >
> >
>
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.6 (GNU/Linux)
>
> iD8DBQFHVytLuqCUopk11kIRAkesAJ9d/vngVV71xY/749SA8g5hkys4DgCfVEwh
> IlVnueogwUYAb4y1qx4iU38=
> =qmuz
> -----END PGP SIGNATURE-----
>
>
>



-- 
Zachary Goldberg
Computer Science & Engineering
Electrical Captain of Penn Electric Race Team
School of Engineering at the University of Pennsylvania


From alex at thehandofagony.com  Wed Dec  5 17:18:09 2007
From: alex at thehandofagony.com (Alexander Nicolaysen =?iso-8859-1?q?S=F8rnes?=)
Date: Thu, 6 Dec 2007 00:18:09 +0100
Subject: Wine Weekly News
In-Reply-To: <b050a5e70712051502p4da42a09p209bce3e9b663bf2@mail.gmail.com>
References: <200712050014.02742.kai.blin@gmail.com>
	<47572B4B.4030707@atomnet.co.uk>
	<b050a5e70712051502p4da42a09p209bce3e9b663bf2@mail.gmail.com>
Message-ID: <200712060018.10307.alex@thehandofagony.com>

The problem of using test results as background for this is that they are very 
dependent on the experience of each user. For instance some might be unable 
to run a game because they have execshield or other stuff that mess up Wine, 
or simply because they are not following the how-to instructions.

Take the Age of Empires II test report, for instance.  The user has rated it 
Gold even though the text on the main menu is displayed black instead of 
white (on a dark background), and the game is a bit slow even on a modern 
computer.


The alternative is to use the maintainer ratings, which are generally more 
correct but updated far less frequently.


Alexander N. S?rnes

On Thursday 06 December 2007 00:02:36 Zachary Goldberg wrote:
> I've finished coding a script which runs the necessary query to
> generate data (I download a database backup and run the queries on my
> local machine.).  As a sampling (if anybody feels like tripple
> checking that the data is correct) of "Upgrades" (and some downgrades)
> from 11-27-2007 to 12-04-2007:
>
> Chromadrome 2 - Demo 1.0 (18165)  went from Garbage (2007-11-25
> 01:25:25) to Platinum (2007-12-02 11:50:43)
> Age of Empires II The Age of Kings: 2.x (18083)  went from Silver
> (2007-11-15 15:58:30) to Gold (2007-11-30 16:30:18)
> Dreamweaver MX (18123)  went from Silver (2007-07-22 03:17:03) to
> Garbage (2007-12-01 17:41:49)
> Call of Duty United Offensive: 1.5 (18163)  went from Gold (2007-04-06
> 07:46:23) to Platinum (2007-12-02 11:12:50)
> Crysis Single player demo (18094)  went from Garbage (2007-11-06
> 12:49:00) to Bronze (2007-12-01 03:25:13)
> Eschalon Book I Demo Demo (18029)  went from Garbage (2007-11-22
> 02:37:49) to Platinum (2007-11-29 03:11:20)
> Gothic 1.0x (18154)  went from Bronze (2007-11-09 11:48:03) to Garbage
> (2007-12-02 09:21:57)
> Proteus 7.2 (18050)  went from Garbage (2007-11-18 07:08:51) to Silver
> (2007-11-29 22:20:27)
> Ys origin 1.1.0.0 - Adol Version (18060)  went from Bronze (2007-07-13
> 00:20:48) to Silver (2007-11-30 01:38:14)
> Mp3tag v2.39 (17994)  went from Platinum (2007-10-20 11:01:13) to Gold
> (2007-11-27 15:44:51)
> Crayon Release 1 (17988)  went from Gold (2007-11-17 13:34:11) to
> Platinum (2007-11-27 11:30:05)
> Silencer 1.10.1 (18087)  went from Silver (2007-11-16 15:04:45) to
> Platinum (2007-11-30 17:22:00)
> .NET Framework 2.0 (18042)  went from Garbage (2007-11-29 10:07:26) to
> Platinum (2007-11-30 11:35:57)
> Tom Clancy's Rainbow Six 3: Raven Shield 1.60 (18057)  went from
> Garbage (2007-10-17 11:44:55) to Bronze (2007-11-29 21:43:19)
> Safari 3.x Public Beta (18196)  went from Garbage (2007-11-21
> 03:21:32) to Bronze (2007-12-03 10:03:37)
> TTPlayer 5.0.1 (18191)  went from Silver (2007-11-07 05:24:39) to Gold
> (2007-12-03 08:43:31)
> Sid Meier's Civilization IV Civilization IV Beyond The Sword (3.13)
> (18108)  went from Bronze (2007-11-07 06:34:47) to Silver (2007-12-01
> 10:08:49)
> Original War 1.08 (18041)  went from Garbage (2007-11-18 19:59:13) to
> Bronze (2007-11-29 09:31:33)
> Half-Life 2 Half-Life: Source (17993)  went from Garbage (2007-11-05
> 14:08:10) to Platinum (2007-11-27 13:49:48)
> Serif PhotoPlus PhotoPlus 11 (18201)  went from Garbage (2007-11-17
> 17:02:33) to Gold (2007-12-03 12:40:39)
> MapSource 6.11.5 (18021)  went from Silver (2007-10-17 05:19:10) to
> Gold (2007-11-28 18:11:37)
> Call of Duty 4: Modern Warfare Demo (18143)  went from Garbage
> (2007-11-16 11:59:30) to Silver (2007-12-02 06:40:04)
> SimCity 4 1.1 638 Rush Hour (18148)  went from Gold (2007-11-25
> 14:58:28) to Bronze (2007-12-02 07:40:50)
>
> On Dec 5, 2007 5:50 PM, Ben Hodgetts (Enverex) <ben at atomnet.co.uk> wrote:
> > -----BEGIN PGP SIGNED MESSAGE-----
> > Hash: SHA1
> >
> > Possibly, but on the other hand it could just as easily become "Garbage"
> > in the next release of Wine ;)
> >
> > (sorry, I already sent this once at the start of the day but emailed it
> > directly to the previous person rather than back to the list)
> >
> > Ben H.
> >
> > Tomas Zijdemans wrote:
> > > This is great :)
> > >
> > > Would it be a good idea to include major news from the appDB?
> > > Ex: "Photoshop cs2 has now reached Gold status"
> > >
> > > I think this would be very inspiring to users.
> > >
> > >
> > > Tomas
> > >
> > > Triton wrote:
> > >> On Tue, 4 Dec 2007 18:23:10 -0500
> > >>
> > >> "Zachary Goldberg" <zgs at seas.upenn.edu> wrote:
> > >>> Kai,
> > >>>
> > >>> It was my pleasure :).  Keep the interesting wine discussion/news
> > >>> coming and I'll keep writing WWNs.  I'll also make note to highlight
> > >>> in particular GSoC developments as they happen.
> > >>>
> > >>> --Zach
> > >>
> > >> Hi everyone, I've been following the mailing lists for some time now,
> > >> this is my first post. OK, presentation done...
> > >>
> > >> I also had to thank you bring to life the WWN, it's a great resource
> > >> for those who don't actively follow the development discussions.
> >
> > -----BEGIN PGP SIGNATURE-----
> > Version: GnuPG v1.4.6 (GNU/Linux)
> >
> > iD8DBQFHVytLuqCUopk11kIRAkesAJ9d/vngVV71xY/749SA8g5hkys4DgCfVEwh
> > IlVnueogwUYAb4y1qx4iU38=
> > =qmuz
> > -----END PGP SIGNATURE-----




From zgold550 at gmail.com  Wed Dec  5 17:44:03 2007
From: zgold550 at gmail.com (Zachary Goldberg)
Date: Wed, 5 Dec 2007 18:44:03 -0500
Subject: Wine Weekly News
In-Reply-To: <200712060018.10307.alex@thehandofagony.com>
References: <200712050014.02742.kai.blin@gmail.com>
	<47572B4B.4030707@atomnet.co.uk>
	<b050a5e70712051502p4da42a09p209bce3e9b663bf2@mail.gmail.com>
	<200712060018.10307.alex@thehandofagony.com>
Message-ID: <b050a5e70712051544k3e11188hb9334adea559a2e@mail.gmail.com>

Here are the updated results for when we only look at updates from App
Maintainers.  It also just so happens that that age of empires case
you mentioned is in fact by a maintainer.  Please respond and leave
your opinion as to which is more worthwhile in the WWN.  Perhaps i'll
put both in different sections.

(replaced dates with wine versions)
Age of Empires II The Age of Kings: 2.x went from Silver (0.9.49) to
Gold (0.9.50)
TTPlayer 5.0.1 went from Silver (0.9.48) to Gold (0.9.50)
Sid Meier's Civilization IV Civilization IV Beyond The Sword (3.13)
went from Bronze (0.9.48) to Silver (0.9.50)
Original War 1.08 went from Garbage (0.9.49) to Bronze (0.9.49)
Call of Duty United Offensive: 1.5 went from Gold (0.9.34) to Platinum (0.9.48)
Gothic 1.0x went from Bronze (0.9.48) to Garbage (0.9.50)
Ys origin 1.1.0.0 - Adol Version went from Bronze (0.9.40) to Silver (0.9.49)
Serif PhotoPlus PhotoPlus 11 went from Garbage (0.9.49) to Gold (0.9.50)





On Dec 5, 2007 6:18 PM, Alexander Nicolaysen S?rnes
<alex at thehandofagony.com> wrote:
> The problem of using test results as background for this is that they are very
> dependent on the experience of each user. For instance some might be unable
> to run a game because they have execshield or other stuff that mess up Wine,
> or simply because they are not following the how-to instructions.
>
> Take the Age of Empires II test report, for instance.  The user has rated it
> Gold even though the text on the main menu is displayed black instead of
> white (on a dark background), and the game is a bit slow even on a modern
> computer.
>
>
> The alternative is to use the maintainer ratings, which are generally more
> correct but updated far less frequently.
>
>
> Alexander N. S?rnes
>
>
> On Thursday 06 December 2007 00:02:36 Zachary Goldberg wrote:
> > I've finished coding a script which runs the necessary query to
> > generate data (I download a database backup and run the queries on my
> > local machine.).  As a sampling (if anybody feels like tripple
> > checking that the data is correct) of "Upgrades" (and some downgrades)
> > from 11-27-2007 to 12-04-2007:
> >
> > Chromadrome 2 - Demo 1.0 (18165)  went from Garbage (2007-11-25
> > 01:25:25) to Platinum (2007-12-02 11:50:43)
> > Age of Empires II The Age of Kings: 2.x (18083)  went from Silver
> > (2007-11-15 15:58:30) to Gold (2007-11-30 16:30:18)
> > Dreamweaver MX (18123)  went from Silver (2007-07-22 03:17:03) to
> > Garbage (2007-12-01 17:41:49)
> > Call of Duty United Offensive: 1.5 (18163)  went from Gold (2007-04-06
> > 07:46:23) to Platinum (2007-12-02 11:12:50)
> > Crysis Single player demo (18094)  went from Garbage (2007-11-06
> > 12:49:00) to Bronze (2007-12-01 03:25:13)
> > Eschalon Book I Demo Demo (18029)  went from Garbage (2007-11-22
> > 02:37:49) to Platinum (2007-11-29 03:11:20)
> > Gothic 1.0x (18154)  went from Bronze (2007-11-09 11:48:03) to Garbage
> > (2007-12-02 09:21:57)
> > Proteus 7.2 (18050)  went from Garbage (2007-11-18 07:08:51) to Silver
> > (2007-11-29 22:20:27)
> > Ys origin 1.1.0.0 - Adol Version (18060)  went from Bronze (2007-07-13
> > 00:20:48) to Silver (2007-11-30 01:38:14)
> > Mp3tag v2.39 (17994)  went from Platinum (2007-10-20 11:01:13) to Gold
> > (2007-11-27 15:44:51)
> > Crayon Release 1 (17988)  went from Gold (2007-11-17 13:34:11) to
> > Platinum (2007-11-27 11:30:05)
> > Silencer 1.10.1 (18087)  went from Silver (2007-11-16 15:04:45) to
> > Platinum (2007-11-30 17:22:00)
> > .NET Framework 2.0 (18042)  went from Garbage (2007-11-29 10:07:26) to
> > Platinum (2007-11-30 11:35:57)
> > Tom Clancy's Rainbow Six 3: Raven Shield 1.60 (18057)  went from
> > Garbage (2007-10-17 11:44:55) to Bronze (2007-11-29 21:43:19)
> > Safari 3.x Public Beta (18196)  went from Garbage (2007-11-21
> > 03:21:32) to Bronze (2007-12-03 10:03:37)
> > TTPlayer 5.0.1 (18191)  went from Silver (2007-11-07 05:24:39) to Gold
> > (2007-12-03 08:43:31)
> > Sid Meier's Civilization IV Civilization IV Beyond The Sword (3.13)
> > (18108)  went from Bronze (2007-11-07 06:34:47) to Silver (2007-12-01
> > 10:08:49)
> > Original War 1.08 (18041)  went from Garbage (2007-11-18 19:59:13) to
> > Bronze (2007-11-29 09:31:33)
> > Half-Life 2 Half-Life: Source (17993)  went from Garbage (2007-11-05
> > 14:08:10) to Platinum (2007-11-27 13:49:48)
> > Serif PhotoPlus PhotoPlus 11 (18201)  went from Garbage (2007-11-17
> > 17:02:33) to Gold (2007-12-03 12:40:39)
> > MapSource 6.11.5 (18021)  went from Silver (2007-10-17 05:19:10) to
> > Gold (2007-11-28 18:11:37)
> > Call of Duty 4: Modern Warfare Demo (18143)  went from Garbage
> > (2007-11-16 11:59:30) to Silver (2007-12-02 06:40:04)
> > SimCity 4 1.1 638 Rush Hour (18148)  went from Gold (2007-11-25
> > 14:58:28) to Bronze (2007-12-02 07:40:50)
> >
> > On Dec 5, 2007 5:50 PM, Ben Hodgetts (Enverex) <ben at atomnet.co.uk> wrote:
> > > -----BEGIN PGP SIGNED MESSAGE-----
> > > Hash: SHA1
> > >
> > > Possibly, but on the other hand it could just as easily become "Garbage"
> > > in the next release of Wine ;)
> > >
> > > (sorry, I already sent this once at the start of the day but emailed it
> > > directly to the previous person rather than back to the list)
> > >
> > > Ben H.
> > >
> > > Tomas Zijdemans wrote:
> > > > This is great :)
> > > >
> > > > Would it be a good idea to include major news from the appDB?
> > > > Ex: "Photoshop cs2 has now reached Gold status"
> > > >
> > > > I think this would be very inspiring to users.
> > > >
> > > >
> > > > Tomas
> > > >
> > > > Triton wrote:
> > > >> On Tue, 4 Dec 2007 18:23:10 -0500
> > > >>
> > > >> "Zachary Goldberg" <zgs at seas.upenn.edu> wrote:
> > > >>> Kai,
> > > >>>
> > > >>> It was my pleasure :).  Keep the interesting wine discussion/news
> > > >>> coming and I'll keep writing WWNs.  I'll also make note to highlight
> > > >>> in particular GSoC developments as they happen.
> > > >>>
> > > >>> --Zach
> > > >>
> > > >> Hi everyone, I've been following the mailing lists for some time now,
> > > >> this is my first post. OK, presentation done...
> > > >>
> > > >> I also had to thank you bring to life the WWN, it's a great resource
> > > >> for those who don't actively follow the development discussions.
> > >
> > > -----BEGIN PGP SIGNATURE-----
> > > Version: GnuPG v1.4.6 (GNU/Linux)
> > >
> > > iD8DBQFHVytLuqCUopk11kIRAkesAJ9d/vngVV71xY/749SA8g5hkys4DgCfVEwh
> > > IlVnueogwUYAb4y1qx4iU38=
> > > =qmuz
> > > -----END PGP SIGNATURE-----
>
>
>



-- 
Zachary Goldberg
Computer Science & Engineering
Electrical Captain of Penn Electric Race Team
School of Engineering at the University of Pennsylvania


From alex at thehandofagony.com  Wed Dec  5 17:52:58 2007
From: alex at thehandofagony.com (Alexander Nicolaysen =?iso-8859-1?q?S=F8rnes?=)
Date: Thu, 6 Dec 2007 00:52:58 +0100
Subject: Wine Weekly News
In-Reply-To: <b050a5e70712051544k3e11188hb9334adea559a2e@mail.gmail.com>
References: <200712050014.02742.kai.blin@gmail.com>
	<200712060018.10307.alex@thehandofagony.com>
	<b050a5e70712051544k3e11188hb9334adea559a2e@mail.gmail.com>
Message-ID: <200712060052.59033.alex@thehandofagony.com>

On Thursday 06 December 2007 00:44:03 Zachary Goldberg wrote:
> Here are the updated results for when we only look at updates from App
> Maintainers.  It also just so happens that that age of empires case
> you mentioned is in fact by a maintainer.  Please respond and leave
> your opinion as to which is more worthwhile in the WWN.  Perhaps i'll
> put both in different sections.
>

The maintainer ratings are a field in the appVersions table, but they are not 
as frequently updated as test results.

An option might be to take the highest rating from each Wine version from the 
test results and compare them.  That would avoid many errors, but would still 
not help in cases where apps are over-rated, such as with Age of Empires II.


Alexander

> (replaced dates with wine versions)
> Age of Empires II The Age of Kings: 2.x went from Silver (0.9.49) to
> Gold (0.9.50)
> TTPlayer 5.0.1 went from Silver (0.9.48) to Gold (0.9.50)
> Sid Meier's Civilization IV Civilization IV Beyond The Sword (3.13)
> went from Bronze (0.9.48) to Silver (0.9.50)
> Original War 1.08 went from Garbage (0.9.49) to Bronze (0.9.49)
> Call of Duty United Offensive: 1.5 went from Gold (0.9.34) to Platinum
> (0.9.48) Gothic 1.0x went from Bronze (0.9.48) to Garbage (0.9.50)
> Ys origin 1.1.0.0 - Adol Version went from Bronze (0.9.40) to Silver
> (0.9.49) Serif PhotoPlus PhotoPlus 11 went from Garbage (0.9.49) to Gold
> (0.9.50)
>
>
>
>
>
> On Dec 5, 2007 6:18 PM, Alexander Nicolaysen S?rnes
>
> <alex at thehandofagony.com> wrote:
> > The problem of using test results as background for this is that they are
> > very dependent on the experience of each user. For instance some might be
> > unable to run a game because they have execshield or other stuff that
> > mess up Wine, or simply because they are not following the how-to
> > instructions.
> >
> > Take the Age of Empires II test report, for instance.  The user has rated
> > it Gold even though the text on the main menu is displayed black instead
> > of white (on a dark background), and the game is a bit slow even on a
> > modern computer.
> >
> >
> > The alternative is to use the maintainer ratings, which are generally
> > more correct but updated far less frequently.
> >
> >
> > Alexander N. S?rnes
> >
> > On Thursday 06 December 2007 00:02:36 Zachary Goldberg wrote:
> > > I've finished coding a script which runs the necessary query to
> > > generate data (I download a database backup and run the queries on my
> > > local machine.).  As a sampling (if anybody feels like tripple
> > > checking that the data is correct) of "Upgrades" (and some downgrades)
> > > from 11-27-2007 to 12-04-2007:
> > >
> > > Chromadrome 2 - Demo 1.0 (18165)  went from Garbage (2007-11-25
> > > 01:25:25) to Platinum (2007-12-02 11:50:43)
> > > Age of Empires II The Age of Kings: 2.x (18083)  went from Silver
> > > (2007-11-15 15:58:30) to Gold (2007-11-30 16:30:18)
> > > Dreamweaver MX (18123)  went from Silver (2007-07-22 03:17:03) to
> > > Garbage (2007-12-01 17:41:49)
> > > Call of Duty United Offensive: 1.5 (18163)  went from Gold (2007-04-06
> > > 07:46:23) to Platinum (2007-12-02 11:12:50)
> > > Crysis Single player demo (18094)  went from Garbage (2007-11-06
> > > 12:49:00) to Bronze (2007-12-01 03:25:13)
> > > Eschalon Book I Demo Demo (18029)  went from Garbage (2007-11-22
> > > 02:37:49) to Platinum (2007-11-29 03:11:20)
> > > Gothic 1.0x (18154)  went from Bronze (2007-11-09 11:48:03) to Garbage
> > > (2007-12-02 09:21:57)
> > > Proteus 7.2 (18050)  went from Garbage (2007-11-18 07:08:51) to Silver
> > > (2007-11-29 22:20:27)
> > > Ys origin 1.1.0.0 - Adol Version (18060)  went from Bronze (2007-07-13
> > > 00:20:48) to Silver (2007-11-30 01:38:14)
> > > Mp3tag v2.39 (17994)  went from Platinum (2007-10-20 11:01:13) to Gold
> > > (2007-11-27 15:44:51)
> > > Crayon Release 1 (17988)  went from Gold (2007-11-17 13:34:11) to
> > > Platinum (2007-11-27 11:30:05)
> > > Silencer 1.10.1 (18087)  went from Silver (2007-11-16 15:04:45) to
> > > Platinum (2007-11-30 17:22:00)
> > > .NET Framework 2.0 (18042)  went from Garbage (2007-11-29 10:07:26) to
> > > Platinum (2007-11-30 11:35:57)
> > > Tom Clancy's Rainbow Six 3: Raven Shield 1.60 (18057)  went from
> > > Garbage (2007-10-17 11:44:55) to Bronze (2007-11-29 21:43:19)
> > > Safari 3.x Public Beta (18196)  went from Garbage (2007-11-21
> > > 03:21:32) to Bronze (2007-12-03 10:03:37)
> > > TTPlayer 5.0.1 (18191)  went from Silver (2007-11-07 05:24:39) to Gold
> > > (2007-12-03 08:43:31)
> > > Sid Meier's Civilization IV Civilization IV Beyond The Sword (3.13)
> > > (18108)  went from Bronze (2007-11-07 06:34:47) to Silver (2007-12-01
> > > 10:08:49)
> > > Original War 1.08 (18041)  went from Garbage (2007-11-18 19:59:13) to
> > > Bronze (2007-11-29 09:31:33)
> > > Half-Life 2 Half-Life: Source (17993)  went from Garbage (2007-11-05
> > > 14:08:10) to Platinum (2007-11-27 13:49:48)
> > > Serif PhotoPlus PhotoPlus 11 (18201)  went from Garbage (2007-11-17
> > > 17:02:33) to Gold (2007-12-03 12:40:39)
> > > MapSource 6.11.5 (18021)  went from Silver (2007-10-17 05:19:10) to
> > > Gold (2007-11-28 18:11:37)
> > > Call of Duty 4: Modern Warfare Demo (18143)  went from Garbage
> > > (2007-11-16 11:59:30) to Silver (2007-12-02 06:40:04)
> > > SimCity 4 1.1 638 Rush Hour (18148)  went from Gold (2007-11-25
> > > 14:58:28) to Bronze (2007-12-02 07:40:50)
> > >
> > > On Dec 5, 2007 5:50 PM, Ben Hodgetts (Enverex) <ben at atomnet.co.uk> 
wrote:
> > > > -----BEGIN PGP SIGNED MESSAGE-----
> > > > Hash: SHA1
> > > >
> > > > Possibly, but on the other hand it could just as easily become
> > > > "Garbage" in the next release of Wine ;)
> > > >
> > > > (sorry, I already sent this once at the start of the day but emailed
> > > > it directly to the previous person rather than back to the list)
> > > >
> > > > Ben H.
> > > >
> > > > Tomas Zijdemans wrote:
> > > > > This is great :)
> > > > >
> > > > > Would it be a good idea to include major news from the appDB?
> > > > > Ex: "Photoshop cs2 has now reached Gold status"
> > > > >
> > > > > I think this would be very inspiring to users.
> > > > >
> > > > >
> > > > > Tomas
> > > > >
> > > > > Triton wrote:
> > > > >> On Tue, 4 Dec 2007 18:23:10 -0500
> > > > >>
> > > > >> "Zachary Goldberg" <zgs at seas.upenn.edu> wrote:
> > > > >>> Kai,
> > > > >>>
> > > > >>> It was my pleasure :).  Keep the interesting wine discussion/news
> > > > >>> coming and I'll keep writing WWNs.  I'll also make note to
> > > > >>> highlight in particular GSoC developments as they happen.
> > > > >>>
> > > > >>> --Zach
> > > > >>
> > > > >> Hi everyone, I've been following the mailing lists for some time
> > > > >> now, this is my first post. OK, presentation done...
> > > > >>
> > > > >> I also had to thank you bring to life the WWN, it's a great
> > > > >> resource for those who don't actively follow the development
> > > > >> discussions.
> > > >
> > > > -----BEGIN PGP SIGNATURE-----
> > > > Version: GnuPG v1.4.6 (GNU/Linux)
> > > >
> > > > iD8DBQFHVytLuqCUopk11kIRAkesAJ9d/vngVV71xY/749SA8g5hkys4DgCfVEwh
> > > > IlVnueogwUYAb4y1qx4iU38=
> > > > =qmuz
> > > > -----END PGP SIGNATURE-----




From zgold550 at gmail.com  Wed Dec  5 18:01:00 2007
From: zgold550 at gmail.com (Zachary Goldberg)
Date: Wed, 5 Dec 2007 19:01:00 -0500
Subject: Wine Weekly News
In-Reply-To: <200712060052.59033.alex@thehandofagony.com>
References: <200712050014.02742.kai.blin@gmail.com>
	<200712060018.10307.alex@thehandofagony.com>
	<b050a5e70712051544k3e11188hb9334adea559a2e@mail.gmail.com>
	<200712060052.59033.alex@thehandofagony.com>
Message-ID: <b050a5e70712051601l7cc3b790mf3c0bcdac8e1f978@mail.gmail.com>

Do you feel apps get updated enough that there are enough instances of
an app being reviewed more than once per release to change these
results?


On Dec 5, 2007 6:52 PM, Alexander Nicolaysen S?rnes
<alex at thehandofagony.com> wrote:
> On Thursday 06 December 2007 00:44:03 Zachary Goldberg wrote:
> > Here are the updated results for when we only look at updates from App
> > Maintainers.  It also just so happens that that age of empires case
> > you mentioned is in fact by a maintainer.  Please respond and leave
> > your opinion as to which is more worthwhile in the WWN.  Perhaps i'll
> > put both in different sections.
> >
>
> The maintainer ratings are a field in the appVersions table, but they are not
> as frequently updated as test results.
>
> An option might be to take the highest rating from each Wine version from the
> test results and compare them.  That would avoid many errors, but would still
> not help in cases where apps are over-rated, such as with Age of Empires II.
>
>
> Alexander
>
>
> > (replaced dates with wine versions)
> > Age of Empires II The Age of Kings: 2.x went from Silver (0.9.49) to
> > Gold (0.9.50)
> > TTPlayer 5.0.1 went from Silver (0.9.48) to Gold (0.9.50)
> > Sid Meier's Civilization IV Civilization IV Beyond The Sword (3.13)
> > went from Bronze (0.9.48) to Silver (0.9.50)
> > Original War 1.08 went from Garbage (0.9.49) to Bronze (0.9.49)
> > Call of Duty United Offensive: 1.5 went from Gold (0.9.34) to Platinum
> > (0.9.48) Gothic 1.0x went from Bronze (0.9.48) to Garbage (0.9.50)
> > Ys origin 1.1.0.0 - Adol Version went from Bronze (0.9.40) to Silver
> > (0.9.49) Serif PhotoPlus PhotoPlus 11 went from Garbage (0.9.49) to Gold
> > (0.9.50)
> >
> >
> >
> >
> >
> > On Dec 5, 2007 6:18 PM, Alexander Nicolaysen S?rnes
> >
> > <alex at thehandofagony.com> wrote:
> > > The problem of using test results as background for this is that they are
> > > very dependent on the experience of each user. For instance some might be
> > > unable to run a game because they have execshield or other stuff that
> > > mess up Wine, or simply because they are not following the how-to
> > > instructions.
> > >
> > > Take the Age of Empires II test report, for instance.  The user has rated
> > > it Gold even though the text on the main menu is displayed black instead
> > > of white (on a dark background), and the game is a bit slow even on a
> > > modern computer.
> > >
> > >
> > > The alternative is to use the maintainer ratings, which are generally
> > > more correct but updated far less frequently.
> > >
> > >
> > > Alexander N. S?rnes
> > >
> > > On Thursday 06 December 2007 00:02:36 Zachary Goldberg wrote:
> > > > I've finished coding a script which runs the necessary query to
> > > > generate data (I download a database backup and run the queries on my
> > > > local machine.).  As a sampling (if anybody feels like tripple
> > > > checking that the data is correct) of "Upgrades" (and some downgrades)
> > > > from 11-27-2007 to 12-04-2007:
> > > >
> > > > Chromadrome 2 - Demo 1.0 (18165)  went from Garbage (2007-11-25
> > > > 01:25:25) to Platinum (2007-12-02 11:50:43)
> > > > Age of Empires II The Age of Kings: 2.x (18083)  went from Silver
> > > > (2007-11-15 15:58:30) to Gold (2007-11-30 16:30:18)
> > > > Dreamweaver MX (18123)  went from Silver (2007-07-22 03:17:03) to
> > > > Garbage (2007-12-01 17:41:49)
> > > > Call of Duty United Offensive: 1.5 (18163)  went from Gold (2007-04-06
> > > > 07:46:23) to Platinum (2007-12-02 11:12:50)
> > > > Crysis Single player demo (18094)  went from Garbage (2007-11-06
> > > > 12:49:00) to Bronze (2007-12-01 03:25:13)
> > > > Eschalon Book I Demo Demo (18029)  went from Garbage (2007-11-22
> > > > 02:37:49) to Platinum (2007-11-29 03:11:20)
> > > > Gothic 1.0x (18154)  went from Bronze (2007-11-09 11:48:03) to Garbage
> > > > (2007-12-02 09:21:57)
> > > > Proteus 7.2 (18050)  went from Garbage (2007-11-18 07:08:51) to Silver
> > > > (2007-11-29 22:20:27)
> > > > Ys origin 1.1.0.0 - Adol Version (18060)  went from Bronze (2007-07-13
> > > > 00:20:48) to Silver (2007-11-30 01:38:14)
> > > > Mp3tag v2.39 (17994)  went from Platinum (2007-10-20 11:01:13) to Gold
> > > > (2007-11-27 15:44:51)
> > > > Crayon Release 1 (17988)  went from Gold (2007-11-17 13:34:11) to
> > > > Platinum (2007-11-27 11:30:05)
> > > > Silencer 1.10.1 (18087)  went from Silver (2007-11-16 15:04:45) to
> > > > Platinum (2007-11-30 17:22:00)
> > > > .NET Framework 2.0 (18042)  went from Garbage (2007-11-29 10:07:26) to
> > > > Platinum (2007-11-30 11:35:57)
> > > > Tom Clancy's Rainbow Six 3: Raven Shield 1.60 (18057)  went from
> > > > Garbage (2007-10-17 11:44:55) to Bronze (2007-11-29 21:43:19)
> > > > Safari 3.x Public Beta (18196)  went from Garbage (2007-11-21
> > > > 03:21:32) to Bronze (2007-12-03 10:03:37)
> > > > TTPlayer 5.0.1 (18191)  went from Silver (2007-11-07 05:24:39) to Gold
> > > > (2007-12-03 08:43:31)
> > > > Sid Meier's Civilization IV Civilization IV Beyond The Sword (3.13)
> > > > (18108)  went from Bronze (2007-11-07 06:34:47) to Silver (2007-12-01
> > > > 10:08:49)
> > > > Original War 1.08 (18041)  went from Garbage (2007-11-18 19:59:13) to
> > > > Bronze (2007-11-29 09:31:33)
> > > > Half-Life 2 Half-Life: Source (17993)  went from Garbage (2007-11-05
> > > > 14:08:10) to Platinum (2007-11-27 13:49:48)
> > > > Serif PhotoPlus PhotoPlus 11 (18201)  went from Garbage (2007-11-17
> > > > 17:02:33) to Gold (2007-12-03 12:40:39)
> > > > MapSource 6.11.5 (18021)  went from Silver (2007-10-17 05:19:10) to
> > > > Gold (2007-11-28 18:11:37)
> > > > Call of Duty 4: Modern Warfare Demo (18143)  went from Garbage
> > > > (2007-11-16 11:59:30) to Silver (2007-12-02 06:40:04)
> > > > SimCity 4 1.1 638 Rush Hour (18148)  went from Gold (2007-11-25
> > > > 14:58:28) to Bronze (2007-12-02 07:40:50)
> > > >
> > > > On Dec 5, 2007 5:50 PM, Ben Hodgetts (Enverex) <ben at atomnet.co.uk>
> wrote:
> > > > > -----BEGIN PGP SIGNED MESSAGE-----
> > > > > Hash: SHA1
> > > > >
> > > > > Possibly, but on the other hand it could just as easily become
> > > > > "Garbage" in the next release of Wine ;)
> > > > >
> > > > > (sorry, I already sent this once at the start of the day but emailed
> > > > > it directly to the previous person rather than back to the list)
> > > > >
> > > > > Ben H.
> > > > >
> > > > > Tomas Zijdemans wrote:
> > > > > > This is great :)
> > > > > >
> > > > > > Would it be a good idea to include major news from the appDB?
> > > > > > Ex: "Photoshop cs2 has now reached Gold status"
> > > > > >
> > > > > > I think this would be very inspiring to users.
> > > > > >
> > > > > >
> > > > > > Tomas
> > > > > >
> > > > > > Triton wrote:
> > > > > >> On Tue, 4 Dec 2007 18:23:10 -0500
> > > > > >>
> > > > > >> "Zachary Goldberg" <zgs at seas.upenn.edu> wrote:
> > > > > >>> Kai,
> > > > > >>>
> > > > > >>> It was my pleasure :).  Keep the interesting wine discussion/news
> > > > > >>> coming and I'll keep writing WWNs.  I'll also make note to
> > > > > >>> highlight in particular GSoC developments as they happen.
> > > > > >>>
> > > > > >>> --Zach
> > > > > >>
> > > > > >> Hi everyone, I've been following the mailing lists for some time
> > > > > >> now, this is my first post. OK, presentation done...
> > > > > >>
> > > > > >> I also had to thank you bring to life the WWN, it's a great
> > > > > >> resource for those who don't actively follow the development
> > > > > >> discussions.
> > > > >
> > > > > -----BEGIN PGP SIGNATURE-----
> > > > > Version: GnuPG v1.4.6 (GNU/Linux)
> > > > >
> > > > > iD8DBQFHVytLuqCUopk11kIRAkesAJ9d/vngVV71xY/749SA8g5hkys4DgCfVEwh
> > > > > IlVnueogwUYAb4y1qx4iU38=
> > > > > =qmuz
> > > > > -----END PGP SIGNATURE-----
>
>
>



-- 
Zachary Goldberg
Computer Science & Engineering
Electrical Captain of Penn Electric Race Team
School of Engineering at the University of Pennsylvania


From ngompa13 at gmail.com  Wed Dec  5 19:05:59 2007
From: ngompa13 at gmail.com (King InuYasha)
Date: Wed, 5 Dec 2007 19:05:59 -0600
Subject: replying to wine-devel?
Message-ID: <8278b1b0712051705g4575d34epfc78c9e34c1e1b7@mail.gmail.com>

I have noticed some unusual behavior in the wine-devel mailing list
compared to others (e.g. fedora's, etc.). Wine's wine-devel mailing
list does not automatically set the reply to wine-devel at winehq.org.
Why is that? If other mailing lists do so, how come Wine's doesn't?
Personally, I find myself making a mistake sometimes and not adding in
the wine-devel part because I am used to seeing it automatically set.
If I remember how emails are set up, isn't there a hidden field called
reply-to? AFAICT, other mailing lists either override or rewrite this
field and replace it with the email address of the mailing list.


From mihai.dontu at gmail.com  Wed Dec  5 19:26:23 2007
From: mihai.dontu at gmail.com (Mihai =?utf-8?q?Don=C8=9Bu?=)
Date: Thu, 6 Dec 2007 03:26:23 +0200
Subject: replying to wine-devel?
In-Reply-To: <8278b1b0712051705g4575d34epfc78c9e34c1e1b7@mail.gmail.com>
References: <8278b1b0712051705g4575d34epfc78c9e34c1e1b7@mail.gmail.com>
Message-ID: <200712060326.24239.mihai.dontu@gmail.com>

On Thursday 06 December 2007, King InuYasha wrote:
> I have noticed some unusual behavior in the wine-devel mailing list
> compared to others (e.g. fedora's, etc.). Wine's wine-devel mailing
> list does not automatically set the reply to wine-devel at winehq.org.

I think it's a client problem. I'm using KMail and hitting 'reply'
always set's the 'To' field to 'wine-devel at winehq.org'.

-- 
Mihai Don?u


From jjmckenzie51 at sprintpcs.com  Wed Dec  5 19:47:40 2007
From: jjmckenzie51 at sprintpcs.com (James McKenzie)
Date: Wed, 05 Dec 2007 18:47:40 -0700
Subject: replying to wine-devel?
In-Reply-To: <200712060326.24239.mihai.dontu@gmail.com>
References: <8278b1b0712051705g4575d34epfc78c9e34c1e1b7@mail.gmail.com>
	<200712060326.24239.mihai.dontu@gmail.com>
Message-ID: <475754BC.8000404@sprintpcs.com>

Mihai Don?u wrote:
> On Thursday 06 December 2007, King InuYasha wrote:
>   
>> I have noticed some unusual behavior in the wine-devel mailing list
>> compared to others (e.g. fedora's, etc.). Wine's wine-devel mailing
>> list does not automatically set the reply to wine-devel at winehq.org.
>>     
>
> I think it's a client problem. I'm using KMail and hitting 'reply'
> always set's the 'To' field to 'wine-devel at winehq.org'.
>
>   
It does not with any of the Wine mailing lists with Thunderbird. 

James McKenzie



From aric at codeweavers.com  Wed Dec  5 19:54:07 2007
From: aric at codeweavers.com (Aric Stewart)
Date: Thu, 06 Dec 2007 10:54:07 +0900
Subject: system.sfd: make 18 pixel strike with Japanese jvgasys glyphs
In-Reply-To: <01cb01c83751$441f4dc0$6700fea9@DMITRY>
References: <4756BC0D.1060308@codeweavers.com>
	<01cb01c83751$441f4dc0$6700fea9@DMITRY>
Message-ID: <4757563F.2090005@codeweavers.com>

Ahh, too late at night and my attempts to get the widths for the 18 
pixel strikes had side effects.

I have resubmitted.  Hand checked the widths of the glyphs for both 16 
and 18 pixles to make sure they are correct.  Had to redraw many of the 
18 pixel strikes (The capitals) to get them to fit into the proper widths.

-aric

Dmitry Timoshkov wrote:
> "Aric Stewart" <aric at codeweavers.com> wrote:
> 
>>  fonts/system.sfd | 1407 
>> ++++++++++++++++++++++++++++++++++++++++++++++--------
>>  1 files changed, 1213 insertions(+), 194 deletions(-)
> 
> For some reason widths of many glyphs are changed by this patch,
> that doesn't look correct.
> 



From truiken at gmail.com  Wed Dec  5 19:57:37 2007
From: truiken at gmail.com (James Hawkins)
Date: Wed, 5 Dec 2007 19:57:37 -0600
Subject: replying to wine-devel?
In-Reply-To: <8278b1b0712051705g4575d34epfc78c9e34c1e1b7@mail.gmail.com>
References: <8278b1b0712051705g4575d34epfc78c9e34c1e1b7@mail.gmail.com>
Message-ID: <BF863A0F-9E12-4EC6-B1E0-1566F50B4B0F@gmail.com>


On Dec 5, 2007, at 7:05 PM, "King InuYasha" <ngompa13 at gmail.com> wrote:

> I have noticed some unusual behavior in the wine-devel mailing list
> compared to others (e.g. fedora's, etc.). Wine's wine-devel mailing
> list does not automatically set the reply to wine-devel at winehq.org.
> Why is that? If other mailing lists do so, how come Wine's doesn't?
> Personally, I find myself making a mistake sometimes and not adding in
> the wine-devel part because I am used to seeing it automatically set.
> If I remember how emails are set up, isn't there a hidden field called
> reply-to? AFAICT, other mailing lists either override or rewrite this
> field and replace it with the email address of the mailing list.
>
>

You're supposed to reply-all.

--
James Hawkins


From jjmckenzie51 at sprintpcs.com  Wed Dec  5 20:06:25 2007
From: jjmckenzie51 at sprintpcs.com (James McKenzie)
Date: Wed, 05 Dec 2007 19:06:25 -0700
Subject: replying to wine-devel?
In-Reply-To: <BF863A0F-9E12-4EC6-B1E0-1566F50B4B0F@gmail.com>
References: <8278b1b0712051705g4575d34epfc78c9e34c1e1b7@mail.gmail.com>
	<BF863A0F-9E12-4EC6-B1E0-1566F50B4B0F@gmail.com>
Message-ID: <47575921.5090805@sprintpcs.com>

James Hawkins wrote:
> On Dec 5, 2007, at 7:05 PM, "King InuYasha" <ngompa13 at gmail.com> wrote:
>
>   
>> I have noticed some unusual behavior in the wine-devel mailing list
>> compared to others (e.g. fedora's, etc.). Wine's wine-devel mailing
>> list does not automatically set the reply to wine-devel at winehq.org.
>> Why is that? If other mailing lists do so, how come Wine's doesn't?
>> Personally, I find myself making a mistake sometimes and not adding in
>> the wine-devel part because I am used to seeing it automatically set.
>> If I remember how emails are set up, isn't there a hidden field called
>> reply-to? AFAICT, other mailing lists either override or rewrite this
>> field and replace it with the email address of the mailing list.
>>
>>
>>     
>
> You're supposed to reply-all.
>
>
>   
Most mailing lists have the reply-to field set for to mailing list address.

James




From chmorgan at gmail.com  Wed Dec  5 20:11:01 2007
From: chmorgan at gmail.com (Chris Morgan)
Date: Wed, 5 Dec 2007 21:11:01 -0500
Subject: Wine Weekly News
In-Reply-To: <200712060018.10307.alex@thehandofagony.com>
References: <200712050014.02742.kai.blin@gmail.com>
	<47572B4B.4030707@atomnet.co.uk>
	<b050a5e70712051502p4da42a09p209bce3e9b663bf2@mail.gmail.com>
	<200712060018.10307.alex@thehandofagony.com>
Message-ID: <f3f1b91a0712051811s15dee897t724d8d5ab265e8ad@mail.gmail.com>

i'd argue that this means we need to be smarter about how we process
the test results. We need both a confidence and a rating and some way
to reflect this in the results.

Your other point about configuration, if users have problems with
configuration then while it may be their fault its not really their
fault if we let them misconfigure wine. I'm of course assuming that
they aren't being malicious of course.

Chris


On Dec 5, 2007 6:18 PM, Alexander Nicolaysen S?rnes
<alex at thehandofagony.com> wrote:
> The problem of using test results as background for this is that they are very
> dependent on the experience of each user. For instance some might be unable
> to run a game because they have execshield or other stuff that mess up Wine,
> or simply because they are not following the how-to instructions.
>
> Take the Age of Empires II test report, for instance.  The user has rated it
> Gold even though the text on the main menu is displayed black instead of
> white (on a dark background), and the game is a bit slow even on a modern
> computer.
>
>
> The alternative is to use the maintainer ratings, which are generally more
> correct but updated far less frequently.
>
>
> Alexander N. S?rnes
>
>
> On Thursday 06 December 2007 00:02:36 Zachary Goldberg wrote:
> > I've finished coding a script which runs the necessary query to
> > generate data (I download a database backup and run the queries on my
> > local machine.).  As a sampling (if anybody feels like tripple
> > checking that the data is correct) of "Upgrades" (and some downgrades)
> > from 11-27-2007 to 12-04-2007:
> >
> > Chromadrome 2 - Demo 1.0 (18165)  went from Garbage (2007-11-25
> > 01:25:25) to Platinum (2007-12-02 11:50:43)
> > Age of Empires II The Age of Kings: 2.x (18083)  went from Silver
> > (2007-11-15 15:58:30) to Gold (2007-11-30 16:30:18)
> > Dreamweaver MX (18123)  went from Silver (2007-07-22 03:17:03) to
> > Garbage (2007-12-01 17:41:49)
> > Call of Duty United Offensive: 1.5 (18163)  went from Gold (2007-04-06
> > 07:46:23) to Platinum (2007-12-02 11:12:50)
> > Crysis Single player demo (18094)  went from Garbage (2007-11-06
> > 12:49:00) to Bronze (2007-12-01 03:25:13)
> > Eschalon Book I Demo Demo (18029)  went from Garbage (2007-11-22
> > 02:37:49) to Platinum (2007-11-29 03:11:20)
> > Gothic 1.0x (18154)  went from Bronze (2007-11-09 11:48:03) to Garbage
> > (2007-12-02 09:21:57)
> > Proteus 7.2 (18050)  went from Garbage (2007-11-18 07:08:51) to Silver
> > (2007-11-29 22:20:27)
> > Ys origin 1.1.0.0 - Adol Version (18060)  went from Bronze (2007-07-13
> > 00:20:48) to Silver (2007-11-30 01:38:14)
> > Mp3tag v2.39 (17994)  went from Platinum (2007-10-20 11:01:13) to Gold
> > (2007-11-27 15:44:51)
> > Crayon Release 1 (17988)  went from Gold (2007-11-17 13:34:11) to
> > Platinum (2007-11-27 11:30:05)
> > Silencer 1.10.1 (18087)  went from Silver (2007-11-16 15:04:45) to
> > Platinum (2007-11-30 17:22:00)
> > .NET Framework 2.0 (18042)  went from Garbage (2007-11-29 10:07:26) to
> > Platinum (2007-11-30 11:35:57)
> > Tom Clancy's Rainbow Six 3: Raven Shield 1.60 (18057)  went from
> > Garbage (2007-10-17 11:44:55) to Bronze (2007-11-29 21:43:19)
> > Safari 3.x Public Beta (18196)  went from Garbage (2007-11-21
> > 03:21:32) to Bronze (2007-12-03 10:03:37)
> > TTPlayer 5.0.1 (18191)  went from Silver (2007-11-07 05:24:39) to Gold
> > (2007-12-03 08:43:31)
> > Sid Meier's Civilization IV Civilization IV Beyond The Sword (3.13)
> > (18108)  went from Bronze (2007-11-07 06:34:47) to Silver (2007-12-01
> > 10:08:49)
> > Original War 1.08 (18041)  went from Garbage (2007-11-18 19:59:13) to
> > Bronze (2007-11-29 09:31:33)
> > Half-Life 2 Half-Life: Source (17993)  went from Garbage (2007-11-05
> > 14:08:10) to Platinum (2007-11-27 13:49:48)
> > Serif PhotoPlus PhotoPlus 11 (18201)  went from Garbage (2007-11-17
> > 17:02:33) to Gold (2007-12-03 12:40:39)
> > MapSource 6.11.5 (18021)  went from Silver (2007-10-17 05:19:10) to
> > Gold (2007-11-28 18:11:37)
> > Call of Duty 4: Modern Warfare Demo (18143)  went from Garbage
> > (2007-11-16 11:59:30) to Silver (2007-12-02 06:40:04)
> > SimCity 4 1.1 638 Rush Hour (18148)  went from Gold (2007-11-25
> > 14:58:28) to Bronze (2007-12-02 07:40:50)
> >
> > On Dec 5, 2007 5:50 PM, Ben Hodgetts (Enverex) <ben at atomnet.co.uk> wrote:
> > > -----BEGIN PGP SIGNED MESSAGE-----
> > > Hash: SHA1
> > >
> > > Possibly, but on the other hand it could just as easily become "Garbage"
> > > in the next release of Wine ;)
> > >
> > > (sorry, I already sent this once at the start of the day but emailed it
> > > directly to the previous person rather than back to the list)
> > >
> > > Ben H.
> > >
> > > Tomas Zijdemans wrote:
> > > > This is great :)
> > > >
> > > > Would it be a good idea to include major news from the appDB?
> > > > Ex: "Photoshop cs2 has now reached Gold status"
> > > >
> > > > I think this would be very inspiring to users.
> > > >
> > > >
> > > > Tomas
> > > >
> > > > Triton wrote:
> > > >> On Tue, 4 Dec 2007 18:23:10 -0500
> > > >>
> > > >> "Zachary Goldberg" <zgs at seas.upenn.edu> wrote:
> > > >>> Kai,
> > > >>>
> > > >>> It was my pleasure :).  Keep the interesting wine discussion/news
> > > >>> coming and I'll keep writing WWNs.  I'll also make note to highlight
> > > >>> in particular GSoC developments as they happen.
> > > >>>
> > > >>> --Zach
> > > >>
> > > >> Hi everyone, I've been following the mailing lists for some time now,
> > > >> this is my first post. OK, presentation done...
> > > >>
> > > >> I also had to thank you bring to life the WWN, it's a great resource
> > > >> for those who don't actively follow the development discussions.
> > >
> > > -----BEGIN PGP SIGNATURE-----
> > > Version: GnuPG v1.4.6 (GNU/Linux)
> > >
> > > iD8DBQFHVytLuqCUopk11kIRAkesAJ9d/vngVV71xY/749SA8g5hkys4DgCfVEwh
> > > IlVnueogwUYAb4y1qx4iU38=
> > > =qmuz
> > > -----END PGP SIGNATURE-----
>
>
>
>
>
>


From dmitry at codeweavers.com  Wed Dec  5 21:14:35 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Thu, 6 Dec 2007 11:14:35 +0800
Subject: system.sfd: make 18 pixel strike with Japanese jvgasys glyphs
References: <4756BC0D.1060308@codeweavers.com><01cb01c83751$441f4dc0$6700fea9@DMITRY>
	<4757563F.2090005@codeweavers.com>
Message-ID: <009701c837b6$22ff2060$6700fea9@DMITRY>

"Aric Stewart" <aric at codeweavers.com> wrote:

> Ahh, too late at night and my attempts to get the widths for the 18 
> pixel strikes had side effects.
> 
> I have resubmitted.  Hand checked the widths of the glyphs for both 16 
> and 18 pixles to make sure they are correct.  Had to redraw many of the 
> 18 pixel strikes (The capitals) to get them to fit into the proper widths.

New patch still changes widths of a lot of existing glyphs, watch out
for changes like:

>  StartChar: space
>  Encoding: 32 32 0
> -Width: 4
> +Width: 291

-- 
Dmitry.


From kai.blin at gmail.com  Thu Dec  6 00:49:31 2007
From: kai.blin at gmail.com (Kai Blin)
Date: Thu, 6 Dec 2007 07:49:31 +0100
Subject: replying to wine-devel?
In-Reply-To: <8278b1b0712051705g4575d34epfc78c9e34c1e1b7@mail.gmail.com>
References: <8278b1b0712051705g4575d34epfc78c9e34c1e1b7@mail.gmail.com>
Message-ID: <200712060749.32406.kai.blin@gmail.com>

On Thursday 06 December 2007 02:05:59 King InuYasha wrote:
> I have noticed some unusual behavior in the wine-devel mailing list
> compared to others (e.g. fedora's, etc.). Wine's wine-devel mailing
> list does not automatically set the reply to wine-devel at winehq.org.
> Why is that? If other mailing lists do so, how come Wine's doesn't?
> Personally, I find myself making a mistake sometimes and not adding in
> the wine-devel part because I am used to seeing it automatically set.
> If I remember how emails are set up, isn't there a hidden field called
> reply-to? AFAICT, other mailing lists either override or rewrite this
> field and replace it with the email address of the mailing list.

The reason is explained in http://www.unicom.com/pw/reply-to-harmful.html

In short, the downside to only replying to the author by accident is pretty 
small compared to mistakenly replying to the whole list with something 
intended just for the author.

Cheers,
Kai

-- 
Kai Blin
WorldForge developer  http://www.worldforge.org/
Wine developer        http://wiki.winehq.org/KaiBlin
Samba team member     http://www.samba.org/samba/team/
--
Will code for cotton.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071206/2c6a6597/attachment.pgp 

From truiken at gmail.com  Thu Dec  6 01:16:49 2007
From: truiken at gmail.com (James Hawkins)
Date: Thu, 6 Dec 2007 01:16:49 -0600
Subject: quartz: move current tests into its own test case [1/5]
In-Reply-To: <558b2f5c0712052035s32d3cf4bva316e5c5159534a1@mail.gmail.com>
References: <558b2f5c0712052035s32d3cf4bva316e5c5159534a1@mail.gmail.com>
Message-ID: <22821af30712052316i901ee97xfad3bb2af0117e53@mail.gmail.com>

On Dec 5, 2007 10:35 PM, Lei Zhang <thestig at google.com> wrote:
> Hi,
>
> I'm moving the current tests into their own function in preparation to
> write more tests.
>

When submitting a numbered patch series, can you put the numbers [x/y]
right after the module name?  That makes it easier to spot the
ordering of the patches.

Thanks,
James Hawkins


From hverbeet at gmail.com  Thu Dec  6 02:38:51 2007
From: hverbeet at gmail.com (H. Verbeet)
Date: Thu, 6 Dec 2007 09:38:51 +0100
Subject: d3dx8 [2/2]: add basic functions for MatrixStack
In-Reply-To: <200712052051.02620.stefandoesinger@gmx.at>
References: <20071205181330.8c78pachgkc4kgk4@webmail.math.cnrs.fr>
	<200712052051.02620.stefandoesinger@gmx.at>
Message-ID: <d658b69e0712060038g12329dfem786c57166c8cfb69@mail.gmail.com>

On 05/12/2007, Stefan D?singer <stefandoesinger at gmx.at> wrote:
> Am Mittwoch, 5. Dezember 2007 18:13:30 schrieb David.Adam at math.cnrs.fr:
> > This is my first attempt with ICOM objects. So, all the advices are
> > welcome.
> A few suggestions:
>
> +HRESULT WINAPI ID3DXMatrixStackImpl_QueryInterface(ID3DXMatrixStack *iface,
> REFIID riid, void **ppvObject)
> + ...
> +     IClassFactory_AddRef(iface);
> It is better to use ID3DXMatrixStack_AddRef(iface) here. It is essentially the
> same, but it looks more consistent
>
> The AddRef() and Release() methods should have a TRACE which write either the
> new or old refcount, otherwise tracking refcounting bugs is hell.
>
Having a TRACE in QueryInterface is occasionally useful as well.

A few more comments:
  - QueryInterface should return S_OK rather than D3D_OK, unless
you've got tests to prove it doesn't.
  - AFAIK on failure you should set *ppvObject to NULL.
  - There's no real reason to stick to MS names for parameters.


From huw at codeweavers.com  Thu Dec  6 03:29:42 2007
From: huw at codeweavers.com (Huw Davies)
Date: Thu, 06 Dec 2007 09:29:42 +0000
Subject: (corrected) Add 18 pixel strike with japanese fonts to system.sdf
	Widths corrected and double checked for both strikes
In-Reply-To: <475755DD.1000103@codeweavers.com>
References: <475755DD.1000103@codeweavers.com>
Message-ID: <4757C106.6050708@codeweavers.com>

Aric Stewart wrote:
> ---
>  fonts/system.sfd | 1587 
> +++++++++++++++++++++++++++++++++++++++++++++---------
>  1 files changed, 1341 insertions(+), 246 deletions(-)

You seem to have changed a couple of glyphs in the 16 pixel strike too. 
  Was that on purpose (and if so shouldn't it be a separate patch?).

Huw.



From huw at codeweavers.com  Thu Dec  6 03:33:26 2007
From: huw at codeweavers.com (Huw Davies)
Date: Thu, 06 Dec 2007 09:33:26 +0000
Subject: system.sfd: make 18 pixel strike with Japanese jvgasys glyphs
In-Reply-To: <009701c837b6$22ff2060$6700fea9@DMITRY>
References: <4756BC0D.1060308@codeweavers.com><01cb01c83751$441f4dc0$6700fea9@DMITRY>	<4757563F.2090005@codeweavers.com>
	<009701c837b6$22ff2060$6700fea9@DMITRY>
Message-ID: <4757C1E6.507@codeweavers.com>

Dmitry Timoshkov wrote:
> "Aric Stewart" <aric at codeweavers.com> wrote:
> 
>> Ahh, too late at night and my attempts to get the widths for the 18 
>> pixel strikes had side effects.
>>
>> I have resubmitted.  Hand checked the widths of the glyphs for both 16 
>> and 18 pixles to make sure they are correct.  Had to redraw many of the 
>> 18 pixel strikes (The capitals) to get them to fit into the proper widths.
> 
> New patch still changes widths of a lot of existing glyphs, watch out
> for changes like:
> 
>>  StartChar: space
>>  Encoding: 32 32 0
>> -Width: 4
>> +Width: 291

I think this is ok.  The Width between the StartChar/EndChar lines is 
the width of the outline glyph, but these fonts don't have outline 
glyphs so it doesn't really matter.  Fontforge seems to reset this 
whenever you add a new bitmap strike.

I do tend to edit the sfd to remove these changes in order to reduce the 
size of the diff.

Huw.



From aric at codeweavers.com  Thu Dec  6 03:54:05 2007
From: aric at codeweavers.com (Aric Stewart)
Date: Thu, 06 Dec 2007 18:54:05 +0900
Subject: (corrected) Add 18 pixel strike with japanese fonts to system.sdf
	Widths corrected and double checked for both strikes
In-Reply-To: <4757C106.6050708@codeweavers.com>
References: <475755DD.1000103@codeweavers.com>
	<4757C106.6050708@codeweavers.com>
Message-ID: <4757C6BD.9000805@codeweavers.com>

I added a number of the black boxes to the 18 pixel strike  (the range 
before 161)  and fontforge seemed unhappy if i did not add something to 
the 16 pixel one. (maybe it was my misinterperting fontforge) but so i 
added similar black boxes to what where already there.

-aric

Huw Davies wrote:
> Aric Stewart wrote:
>> ---
>>  fonts/system.sfd | 1587 
>> +++++++++++++++++++++++++++++++++++++++++++++---------
>>  1 files changed, 1341 insertions(+), 246 deletions(-)
> 
> You seem to have changed a couple of glyphs in the 16 pixel strike too. 
>   Was that on purpose (and if so shouldn't it be a separate patch?).
> 
> Huw.
> 
> 
> 



From tzi063 at student.uib.no  Thu Dec  6 02:21:45 2007
From: tzi063 at student.uib.no (Tomas Zijdemans)
Date: Thu, 06 Dec 2007 09:21:45 +0100
Subject: Wine Weekly News
In-Reply-To: <200712060018.10307.alex@thehandofagony.com>
References: <200712050014.02742.kai.blin@gmail.com>	<47572B4B.4030707@atomnet.co.uk>	<b050a5e70712051502p4da42a09p209bce3e9b663bf2@mail.gmail.com>
	<200712060018.10307.alex@thehandofagony.com>
Message-ID: <fj8bb0$6l8$1@ger.gmane.org>

All good points (from a fellow Norwegian :)

On the other hand, appDB entries are (and probably always will be) user 
generated content, and users will always have different opinions (and 
environment setup).

IMHO users won't sue wine if the abbDB status differs from their 
experience with an app. It's regarded more of a pointer at this stage.

But, as more and more lovely testing code gets into wine, and if there's 
going to be a stable and unstable branch after 1.0 - things will look 
slightly different...


Tomas Zijdemans


Alexander Nicolaysen S?rnes wrote:
> The problem of using test results as background for this is that they are very 
> dependent on the experience of each user. For instance some might be unable 
> to run a game because they have execshield or other stuff that mess up Wine, 
> or simply because they are not following the how-to instructions.
> 
> Take the Age of Empires II test report, for instance.  The user has rated it 
> Gold even though the text on the main menu is displayed black instead of 
> white (on a dark background), and the game is a bit slow even on a modern 
> computer.
> 
> 
> The alternative is to use the maintainer ratings, which are generally more 
> correct but updated far less frequently.
> 
> 
> Alexander N. S?rnes
> 
> On Thursday 06 December 2007 00:02:36 Zachary Goldberg wrote:
>> I've finished coding a script which runs the necessary query to
>> generate data (I download a database backup and run the queries on my
>> local machine.).  As a sampling (if anybody feels like tripple
>> checking that the data is correct) of "Upgrades" (and some downgrades)
>> from 11-27-2007 to 12-04-2007:
>>
>> Chromadrome 2 - Demo 1.0 (18165)  went from Garbage (2007-11-25
>> 01:25:25) to Platinum (2007-12-02 11:50:43)
>> Age of Empires II The Age of Kings: 2.x (18083)  went from Silver
>> (2007-11-15 15:58:30) to Gold (2007-11-30 16:30:18)
>> Dreamweaver MX (18123)  went from Silver (2007-07-22 03:17:03) to
>> Garbage (2007-12-01 17:41:49)
>> Call of Duty United Offensive: 1.5 (18163)  went from Gold (2007-04-06
>> 07:46:23) to Platinum (2007-12-02 11:12:50)
>> Crysis Single player demo (18094)  went from Garbage (2007-11-06
>> 12:49:00) to Bronze (2007-12-01 03:25:13)
>> Eschalon Book I Demo Demo (18029)  went from Garbage (2007-11-22
>> 02:37:49) to Platinum (2007-11-29 03:11:20)
>> Gothic 1.0x (18154)  went from Bronze (2007-11-09 11:48:03) to Garbage
>> (2007-12-02 09:21:57)
>> Proteus 7.2 (18050)  went from Garbage (2007-11-18 07:08:51) to Silver
>> (2007-11-29 22:20:27)
>> Ys origin 1.1.0.0 - Adol Version (18060)  went from Bronze (2007-07-13
>> 00:20:48) to Silver (2007-11-30 01:38:14)
>> Mp3tag v2.39 (17994)  went from Platinum (2007-10-20 11:01:13) to Gold
>> (2007-11-27 15:44:51)
>> Crayon Release 1 (17988)  went from Gold (2007-11-17 13:34:11) to
>> Platinum (2007-11-27 11:30:05)
>> Silencer 1.10.1 (18087)  went from Silver (2007-11-16 15:04:45) to
>> Platinum (2007-11-30 17:22:00)
>> .NET Framework 2.0 (18042)  went from Garbage (2007-11-29 10:07:26) to
>> Platinum (2007-11-30 11:35:57)
>> Tom Clancy's Rainbow Six 3: Raven Shield 1.60 (18057)  went from
>> Garbage (2007-10-17 11:44:55) to Bronze (2007-11-29 21:43:19)
>> Safari 3.x Public Beta (18196)  went from Garbage (2007-11-21
>> 03:21:32) to Bronze (2007-12-03 10:03:37)
>> TTPlayer 5.0.1 (18191)  went from Silver (2007-11-07 05:24:39) to Gold
>> (2007-12-03 08:43:31)
>> Sid Meier's Civilization IV Civilization IV Beyond The Sword (3.13)
>> (18108)  went from Bronze (2007-11-07 06:34:47) to Silver (2007-12-01
>> 10:08:49)
>> Original War 1.08 (18041)  went from Garbage (2007-11-18 19:59:13) to
>> Bronze (2007-11-29 09:31:33)
>> Half-Life 2 Half-Life: Source (17993)  went from Garbage (2007-11-05
>> 14:08:10) to Platinum (2007-11-27 13:49:48)
>> Serif PhotoPlus PhotoPlus 11 (18201)  went from Garbage (2007-11-17
>> 17:02:33) to Gold (2007-12-03 12:40:39)
>> MapSource 6.11.5 (18021)  went from Silver (2007-10-17 05:19:10) to
>> Gold (2007-11-28 18:11:37)
>> Call of Duty 4: Modern Warfare Demo (18143)  went from Garbage
>> (2007-11-16 11:59:30) to Silver (2007-12-02 06:40:04)
>> SimCity 4 1.1 638 Rush Hour (18148)  went from Gold (2007-11-25
>> 14:58:28) to Bronze (2007-12-02 07:40:50)
>>
>> On Dec 5, 2007 5:50 PM, Ben Hodgetts (Enverex) <ben at atomnet.co.uk> wrote:
>>> -----BEGIN PGP SIGNED MESSAGE-----
>>> Hash: SHA1
>>>
>>> Possibly, but on the other hand it could just as easily become "Garbage"
>>> in the next release of Wine ;)
>>>
>>> (sorry, I already sent this once at the start of the day but emailed it
>>> directly to the previous person rather than back to the list)
>>>
>>> Ben H.
>>>
>>> Tomas Zijdemans wrote:
>>>> This is great :)
>>>>
>>>> Would it be a good idea to include major news from the appDB?
>>>> Ex: "Photoshop cs2 has now reached Gold status"
>>>>
>>>> I think this would be very inspiring to users.
>>>>
>>>>
>>>> Tomas
>>>>
>>>> Triton wrote:
>>>>> On Tue, 4 Dec 2007 18:23:10 -0500
>>>>>
>>>>> "Zachary Goldberg" <zgs at seas.upenn.edu> wrote:
>>>>>> Kai,
>>>>>>
>>>>>> It was my pleasure :).  Keep the interesting wine discussion/news
>>>>>> coming and I'll keep writing WWNs.  I'll also make note to highlight
>>>>>> in particular GSoC developments as they happen.
>>>>>>
>>>>>> --Zach
>>>>> Hi everyone, I've been following the mailing lists for some time now,
>>>>> this is my first post. OK, presentation done...
>>>>>
>>>>> I also had to thank you bring to life the WWN, it's a great resource
>>>>> for those who don't actively follow the development discussions.
>>> -----BEGIN PGP SIGNATURE-----
>>> Version: GnuPG v1.4.6 (GNU/Linux)
>>>
>>> iD8DBQFHVytLuqCUopk11kIRAkesAJ9d/vngVV71xY/749SA8g5hkys4DgCfVEwh
>>> IlVnueogwUYAb4y1qx4iU38=
>>> =qmuz
>>> -----END PGP SIGNATURE-----
> 
> 
> 
> 
> 



From hurtta+gmane at siilo.fmi.fi  Thu Dec  6 04:04:18 2007
From: hurtta+gmane at siilo.fmi.fi (Kari Hurtta)
Date: 06 Dec 2007 12:04:18 +0200
Subject: replying to wine-devel?
References: <8278b1b0712051705g4575d34epfc78c9e34c1e1b7@mail.gmail.com>
	<BF863A0F-9E12-4EC6-B1E0-1566F50B4B0F@gmail.com>
	<47575921.5090805@sprintpcs.com>
Message-ID: <5d7ijs3zrx.fsf@Hurtta06k.keh.iki.fi>

James McKenzie <jjmckenzie51 at sprintpcs.com> writes
in gmane.comp.emulators.wine.devel:

> James Hawkins wrote:
> > On Dec 5, 2007, at 7:05 PM, "King InuYasha" <ngompa13 at gmail.com> wrote:
> >
> >   
> >> I have noticed some unusual behavior in the wine-devel mailing list
> >> compared to others (e.g. fedora's, etc.). Wine's wine-devel mailing
> >> list does not automatically set the reply to wine-devel at winehq.org.
> >> Why is that? If other mailing lists do so, how come Wine's doesn't?
> >> Personally, I find myself making a mistake sometimes and not adding in
> >> the wine-devel part because I am used to seeing it automatically set.
> >> If I remember how emails are set up, isn't there a hidden field called
> >> reply-to? AFAICT, other mailing lists either override or rewrite this
> >> field and replace it with the email address of the mailing list.

> > You're supposed to reply-all.
> >   
> Most mailing lists have the reply-to field set for to mailing list address.

There seems to have

List-Post: <mailto:wine-devel at winehq.org>

 
> James

/ Kari Hurtta



From stefan at codeweavers.com  Thu Dec  6 05:22:47 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Thu, 6 Dec 2007 12:22:47 +0100
Subject: d3dx8 [2/2]: add basic functions for MatrixStack
In-Reply-To: <d658b69e0712060038g12329dfem786c57166c8cfb69@mail.gmail.com>
References: <20071205181330.8c78pachgkc4kgk4@webmail.math.cnrs.fr>
	<200712052051.02620.stefandoesinger@gmx.at>
	<d658b69e0712060038g12329dfem786c57166c8cfb69@mail.gmail.com>
Message-ID: <200712061222.50316.stefan@codeweavers.com>

Am Donnerstag, 6. Dezember 2007 09:38:51 schrieb H. Verbeet:
> On 05/12/2007, Stefan D?singer <stefandoesinger at gmx.at> wrote:
> > Am Mittwoch, 5. Dezember 2007 18:13:30 schrieb David.Adam at math.cnrs.fr:
> > > This is my first attempt with ICOM objects. So, all the advices are
> > > welcome.
> >
> > A few suggestions:
> >
> > +HRESULT WINAPI ID3DXMatrixStackImpl_QueryInterface(ID3DXMatrixStack
> > *iface, REFIID riid, void **ppvObject)
> > + ...
> > +     IClassFactory_AddRef(iface);
> > It is better to use ID3DXMatrixStack_AddRef(iface) here. It is
> > essentially the same, but it looks more consistent
> >
> > The AddRef() and Release() methods should have a TRACE which write either
> > the new or old refcount, otherwise tracking refcounting bugs is hell.
>
> Having a TRACE in QueryInterface is occasionally useful as well.
>
> A few more comments:
>   - QueryInterface should return S_OK rather than D3D_OK, unless
> you've got tests to prove it doesn't.
Well, that one is unprovable since D3D_OK is just S_OK :-)

>   - AFAIK on failure you should set *ppvObject to NULL.
>   - There's no real reason to stick to MS names for parameters.
Agreed
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071206/658fc6ed/attachment.pgp 

From ngompa13 at gmail.com  Thu Dec  6 05:45:12 2007
From: ngompa13 at gmail.com (King InuYasha)
Date: Thu, 6 Dec 2007 05:45:12 -0600
Subject: replying to wine-devel?
In-Reply-To: <5d7ijs3zrx.fsf@Hurtta06k.keh.iki.fi>
References: <8278b1b0712051705g4575d34epfc78c9e34c1e1b7@mail.gmail.com>
	<BF863A0F-9E12-4EC6-B1E0-1566F50B4B0F@gmail.com>
	<47575921.5090805@sprintpcs.com> <5d7ijs3zrx.fsf@Hurtta06k.keh.iki.fi>
Message-ID: <8278b1b0712060345g70cab1b7xa41dfc552a6fcf81@mail.gmail.com>

Hmm... Well, I use the Gmail interface sometimes and Thunderbird as well.
But apparently I missed the Reply to All button was there, which pretty much
makes it Cc to wine-devel. It should probably be noted that if you want to
mail the whole list, select reply to all. Replying will only mail to the
author.

On 06 Dec 2007 12:04:18 +0200, Kari Hurtta <hurtta+gmane at siilo.fmi.fi>
wrote:
> James McKenzie <jjmckenzie51 at sprintpcs.com> writes
> in gmane.comp.emulators.wine.devel:
>
>
> > James Hawkins wrote:
> > > On Dec 5, 2007, at 7:05 PM, "King InuYasha" <ngompa13 at gmail.com>
wrote:
> > >
> > >
> > >> I have noticed some unusual behavior in the wine-devel mailing list
> > >> compared to others (e.g. fedora's, etc.). Wine's wine-devel mailing
> > >> list does not automatically set the reply to wine-devel at winehq.org.
> > >> Why is that? If other mailing lists do so, how come Wine's doesn't?
> > >> Personally, I find myself making a mistake sometimes and not adding
in
> > >> the wine-devel part because I am used to seeing it automatically set.
> > >> If I remember how emails are set up, isn't there a hidden field
called
> > >> reply-to? AFAICT, other mailing lists either override or rewrite this
> > >> field and replace it with the email address of the mailing list.
>
> > > You're supposed to reply-all.
> > >
> > Most mailing lists have the reply-to field set for to mailing list
address.
>
> There seems to have
>
> List-Post: <mailto:wine-devel at winehq.org>
>
>
> > James
>
> / Kari Hurtta
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20071206/67e9f139/attachment.htm 

From julliard at winehq.org  Thu Dec  6 05:50:03 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 06 Dec 2007 12:50:03 +0100
Subject: msxml3: Implement cloneNode (resend)
In-Reply-To: <fj7nf0$pqn$1@ger.gmane.org> (Alistair Leslie-Hughes's message of
	"Thu, 06 Dec 2007 13:36:25 +1100")
References: <fj7nf0$pqn$1@ger.gmane.org>
Message-ID: <87lk88avpw.fsf@wine.dyndns.org>

Alistair Leslie-Hughes <leslie_alistair at hotmail.com> writes:

> +static void test_cloneNode(void )
> +{
> +    // NOTE TO SELF - r = IXMLDOMNode_selectSingleNode(node, _bstr_("br"), &node); //test

Please cleanup that sort of thing before submitting.

-- 
Alexandre Julliard
julliard at winehq.org


From hverbeet at gmail.com  Thu Dec  6 06:05:15 2007
From: hverbeet at gmail.com (H. Verbeet)
Date: Thu, 6 Dec 2007 13:05:15 +0100
Subject: d3dx8 [2/2]: add basic functions for MatrixStack
In-Reply-To: <200712061222.50316.stefan@codeweavers.com>
References: <20071205181330.8c78pachgkc4kgk4@webmail.math.cnrs.fr>
	<200712052051.02620.stefandoesinger@gmx.at>
	<d658b69e0712060038g12329dfem786c57166c8cfb69@mail.gmail.com>
	<200712061222.50316.stefan@codeweavers.com>
Message-ID: <d658b69e0712060405s415a4150ybf80bf397ecc1fa4@mail.gmail.com>

On 06/12/2007, Stefan D?singer <stefan at codeweavers.com> wrote:
> Well, that one is unprovable since D3D_OK is just S_OK :-)
>
Uh, right. The code should use S_OK then.


From alexd4 at inbox.lv  Thu Dec  6 22:49:26 2007
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Thu, 06 Dec 2007 20:49:26 -0800
Subject: GetMessage related Jagged Alliance 2 regression
Message-ID: <4758D0D6.2000407@inbox.lv>

Hello.

I get freezes in Jagged Alliance 2 (seems to be tied to moving the mouse). It
used to work in older versions. The game doesn't lock up totally (the music and
sounds continue to play normally, for example), but the screen doesn't redraw
and it doesn't respond to input. Activating some other window than the game
window (if it's not full screen) usually unfreezes it.

Bisect pointed to this change:

http://source.winehq.org/git/wine.git/?a=commitdiff;h=2896540a34a18b8aff848d728308c5811cdd122a

server: Set the queue mask directly in get_message to avoid an extra server call.

I did a bit of debugging and it looks like the game is getting stuck within a
GetMessageW call. It stays in that while loop in GetMessage, mostly in
MsgWaitForMultipleObjectsEx. If the mouse is moved, then it awakes, gets to
PeekMessageW, from there it goes to peek_message which returns false and so
PeekMessageW returns false and the game goes back to waiting within GetMessageW.

peek_message returns false, because in a first call to server it gets a 
MSG_HARDWARE (mouse) message which it drops for some reason, then it clears 
PM_QS_ flags and so in a next call to server it can't get a WM_TIMER message 
despite an expired timer seems to be ready in the queue.

I'm not sure what would be a proper fix, although I did find out that commenting 
out this line in peek_message()

if (HIWORD(flags)) flags = PM_QS_SENDMESSAGE | LOWORD(flags);

makes the game playable. Maybe this clearing of PM_QS_* flags shouldn't be done 
in case when the message gets dropped? Before that commit nothing was passed in 
flags high word, which is probably why this problem wasn't happening.


From julliard at winehq.org  Thu Dec  6 13:19:03 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 06 Dec 2007 20:19:03 +0100
Subject: GetMessage related Jagged Alliance 2 regression
In-Reply-To: <4758D0D6.2000407@inbox.lv> (Alexander Dorofeyev's message of
	"Thu, 06 Dec 2007 20:49:26 -0800")
References: <4758D0D6.2000407@inbox.lv>
Message-ID: <87hcivbpi0.fsf@wine.dyndns.org>

Alexander Dorofeyev <alexd4 at inbox.lv> writes:

> I'm not sure what would be a proper fix, although I did find out that commenting 
> out this line in peek_message()
>
> if (HIWORD(flags)) flags = PM_QS_SENDMESSAGE | LOWORD(flags);
>
> makes the game playable. Maybe this clearing of PM_QS_* flags shouldn't be done 
> in case when the message gets dropped? Before that commit nothing was passed in 
> flags high word, which is probably why this problem wasn't happening.

Does this help?

diff --git a/dlls/user32/message.c b/dlls/user32/message.c
index 53d1c1d..d3f4a3a 100644
--- a/dlls/user32/message.c
+++ b/dlls/user32/message.c
@@ -2173,11 +2173,11 @@ static BOOL peek_message( MSG *msg, HWND hwnd, UINT first, UINT last, UINT flags
                                    WMCHAR_MAP_RECVMESSAGE );
         reply_message( &info, result, TRUE );
         thread_info->receive_info = old_info;
-    next:
-        HeapFree( GetProcessHeap(), 0, buffer );
 
         /* if some PM_QS* flags were specified, only handle sent messages from now on */
         if (HIWORD(flags)) flags = PM_QS_SENDMESSAGE | LOWORD(flags);
+    next:
+        HeapFree( GetProcessHeap(), 0, buffer );
     }
 }
 

-- 
Alexandre Julliard
julliard at winehq.org


From ken at codeweavers.com  Thu Dec  6 15:35:38 2007
From: ken at codeweavers.com (Ken Thomases)
Date: Thu, 6 Dec 2007 15:35:38 -0600
Subject: wine 0.9.5 IO completion port questions
In-Reply-To: <47547DAA.2070206@gmail.com>
References: <08b801c835d1$d106f430$7314dc90$@slyzius@scimore.com>
	<47547DAA.2070206@gmail.com>
Message-ID: <A80A1946-EA06-43CC-801E-8E0C3E5F0DE3@codeweavers.com>

On Dec 3, 2007, at 4:05 PM, Andrey Turkin wrote:

> Marius Slyzius wrote:
>> 2) possible bug: the server sends 1500 bytes with WsaSend ( with 2
>> WSABUFFER ) and the client receive only 1452 bytes and calls WsaRecv
>> again. Also on the server, the completion port receive event that
>> transferred 1452 bytes. However, the last 8 bytes are never sends nor
>> completion port event arrives. Is it perhaps something to do with the
>> VMWare tool where I run Ubuntu 7.10?
>>
> WsaSend can send partial data when operating on non-blocking socket;
> from your description it looks like this is the case. Is this error
> reproducible with the same numbers every run?
> Your both questions are actually not about IOCP but about asynchronous
> I/O support.


My brain may be misfiring, but isn't 1452 bytes a common MTU size?   
Are your client and server remote from one another?  In that case,  
your client may really be receiving 1452 data bytes first, with the  
rest coming a (very) short while later.

-Ken



From frick at sc-networks.de  Thu Dec  6 15:57:53 2007
From: frick at sc-networks.de (Christoph Frick)
Date: Thu, 6 Dec 2007 22:57:53 +0100
Subject: d3d fill caps oddity
Message-ID: <20071206215753.GD1897@byleth.sc-networks.de>

Hi wined3d devs,

i get this message on my notebook (Quadro 570m):

fixme:d3d:IWineD3DImpl_FillGLCaps OpenGL implementation supports 32 vertex samplers and 32 total samplers
fixme:d3d:IWineD3DImpl_FillGLCaps Expected vertex samplers + MAX_TEXTURES(=8) > combined_samplers

does anyone want some traces or other infos? or is this a problem most
likely going away with the next nvidia driver update?

-- 
cu
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 163 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071206/44adc82e/attachment.pgp 

From jjmckenzie51 at sprintpcs.com  Thu Dec  6 18:48:09 2007
From: jjmckenzie51 at sprintpcs.com (James McKenzie)
Date: Thu, 06 Dec 2007 17:48:09 -0700
Subject: [Wine] TortoiseCVS- Unimplemented functions in ntdll.dll causes
	program to terminate.
In-Reply-To: <1196985257.24984.51.camel@mercury.sprymusic>
References: <1196979295.24984.42.camel@mercury.sprymusic>
	<b6bb06270712061421w6ccfba59md8593992028be704@mail.gmail.com>
	<1196985257.24984.51.camel@mercury.sprymusic>
Message-ID: <47589849.4040305@sprintpcs.com>

Jean-Claude Gervais wrote:
> Thank you, Austin!
>
> 	I installed Samba to obtain winbind and ntlm_auth, and it did change
> the outcome a bit:
>
> 	Tortoise still checks out the first file and pops up an error dialog,
> so there is no apparent difference, but the session output from Wine HAS
> changed, it has gotten quieter:
>
>  wine TortoiseAct.exe CVSCheckOut -f "C:\windows\Temp\TCV1.tmp" -h
> 0x300b4
> fixme:actctx:parse_depend_manifests Could not find dependent assembly
> L"Microsoft.Windows.Common-Controls"
> fixme:richedit:RichEditWndProc_common WM_STYLECHANGING: stub
> fixme:richedit:RichEditWndProc_common WM_STYLECHANGED: stub
> wine: Call from 0x7bc38828 to unimplemented function
> ntdll.dll.NtQueryEaFile, aborting
> wine: Call from 0x7bc38828 to unimplemented function
> ntdll.dll.NtSetEaFile, aborting
> err:mmio:MMIO_ParseExtA No . in szFileName: "TCVS_Error"
>
> Sadly, it appears that it really is the two unimplemented functions
> (NtQueryEaFile and NtSetEaFile) causing the problem.
>
> Thank you kindly for your help in any case and if you have any other
> strategies or ideas to workaround this, I would gladly try them.
>
> Thanks again.
> J
>   
As others have stated here, please file a bug against ntdll.dll and name
your program as the source of
the problem.  It may be possible to get your program to run with a
minimum of effort, but this may
take considerable effort.  The more reports of problems with these
functions, the more effort should be
brought in to build and implement these functions.
It also appears that you are using a program that is dependent on other
functions that are implemented
elsewhere in the Windows environment.

James



From chris.kcat at gmail.com  Thu Dec  6 18:46:54 2007
From: chris.kcat at gmail.com (Chris Robinson)
Date: Thu, 6 Dec 2007 16:46:54 -0800
Subject: [5/5] WineD3D: Use the disabled opengl extension string
In-Reply-To: <200712062305.52704.stefan@codeweavers.com>
References: <200712062305.52704.stefan@codeweavers.com>
Message-ID: <200712061646.54194.chris.kcat@gmail.com>

On Thursday 06 December 2007 02:05:52 pm Stefan D?singer wrote:
> +                    if(wined3d_settings.disabled_extensions &&
> +                       strstr(wined3d_settings.disabled_extensions,
> ThisExtn)) {

You need to be careful with this. I read somewhere that using strstr to check 
for an opengl extension in an extension list is discourage because it can 
find false positives. Especially in this case, if you have, say:

wined3d_settings.disabled_extensions = "GL_NV_texture_shader3 
GL_NV_vertex_program2_option GL_NV_vertex_program3"

Then if you check for "GL_NV_texture_shader", "GL_NV_vertex_program2", 
or "GL_NV_vertex_program", they'll all show up as being disabled, when 
they're not. Which is a double problem because "GL_NV_vertex_program1_1" 
would still be enabled, which requires "GL_NV_vertex_program".

AFAIK, the proper way to check for OpenGL extensions in a space-delimitted 
list is like this:

const char *ptr = strstr(wined3d_settings.disabled_extensions, ThisExtn);
if(ptr) {
    if(ptr == wined3d_settings.disabled_extensions || isspace(ptr[-1])) {
        int len = strlen(ThisExtn);
        if(!ptr[len] || isspace(ptr[len])) {
            /* is disabled */
        }
    }
}


From jjmckenzie51 at sprintpcs.com  Thu Dec  6 18:54:05 2007
From: jjmckenzie51 at sprintpcs.com (James McKenzie)
Date: Thu, 06 Dec 2007 17:54:05 -0700
Subject: replying to wine-devel?
In-Reply-To: <200712060749.32406.kai.blin@gmail.com>
References: <8278b1b0712051705g4575d34epfc78c9e34c1e1b7@mail.gmail.com>
	<200712060749.32406.kai.blin@gmail.com>
Message-ID: <475899AD.5050407@sprintpcs.com>

Kai Blin wrote:
> On Thursday 06 December 2007 02:05:59 King InuYasha wrote:
>   
>> I have noticed some unusual behavior in the wine-devel mailing list
>> compared to others (e.g. fedora's, etc.). Wine's wine-devel mailing
>> list does not automatically set the reply to wine-devel at winehq.org.
>> Why is that? If other mailing lists do so, how come Wine's doesn't?
>> Personally, I find myself making a mistake sometimes and not adding in
>> the wine-devel part because I am used to seeing it automatically set.
>> If I remember how emails are set up, isn't there a hidden field called
>> reply-to? AFAICT, other mailing lists either override or rewrite this
>> field and replace it with the email address of the mailing list.
>>     
>
> The reason is explained in http://www.unicom.com/pw/reply-to-harmful.html
>
> In short, the downside to only replying to the author by accident is pretty 
> small compared to mistakenly replying to the whole list with something 
> intended just for the author.
>   
You are correct as this can prove fatal to the sender if you intended
only to send back to the original
sender rather than the entire list.  I was removed from one list after I
forgot to change the intended
receipant from the list to a single person.  Thus, I will reverse my
original opinion and state that requiring
the use of the 'Reply to All' button may delay or even remove the desire
to reply.

Thank you for this informational link and why using the 'reply-to' is
very dangerous.

James



From jjmckenzie51 at sprintpcs.com  Thu Dec  6 18:59:10 2007
From: jjmckenzie51 at sprintpcs.com (James McKenzie)
Date: Thu, 06 Dec 2007 17:59:10 -0700
Subject: wine 0.9.5 IO completion port questions
In-Reply-To: <A80A1946-EA06-43CC-801E-8E0C3E5F0DE3@codeweavers.com>
References: <08b801c835d1$d106f430$7314dc90$%slyzius@scimore.com>
	<47547DAA.2070206@gmail.com>
	<A80A1946-EA06-43CC-801E-8E0C3E5F0DE3@codeweavers.com>
Message-ID: <47589ADE.30709@sprintpcs.com>

Ken Thomases wrote:
> On Dec 3, 2007, at 4:05 PM, Andrey Turkin wrote:
>
>   
>> Marius Slyzius wrote:
>>     
>>> 2) possible bug: the server sends 1500 bytes with WsaSend ( with 2
>>> WSABUFFER ) and the client receive only 1452 bytes and calls WsaRecv
>>> again. Also on the server, the completion port receive event that
>>> transferred 1452 bytes. However, the last 8 bytes are never sends nor
>>> completion port event arrives. Is it perhaps something to do with the
>>> VMWare tool where I run Ubuntu 7.10?
>>>
>>>       
>> WsaSend can send partial data when operating on non-blocking socket;
>> from your description it looks like this is the case. Is this error
>> reproducible with the same numbers every run?
>> Your both questions are actually not about IOCP but about asynchronous
>> I/O support.
>>     
>
>
> My brain may be misfiring, but isn't 1452 bytes a common MTU size?   
> Are your client and server remote from one another?  In that case,  
> your client may really be receiving 1452 data bytes first, with the  
> rest coming a (very) short while later.
>   
Yes, 1452 is a common MTU, but I recommend setting 576 or smaller for
testing of lines.  You MAY
encounter problems sending exactly 1500 bytes over old style 10Base
systems, too.  It may be necessary
to pad on send to a different number and then remove the padding on receipt.

James



From hverbeet at gmail.com  Fri Dec  7 03:16:51 2007
From: hverbeet at gmail.com (H. Verbeet)
Date: Fri, 7 Dec 2007 10:16:51 +0100
Subject: [5/5] WineD3D: Use the disabled opengl extension string
In-Reply-To: <200712062305.52704.stefan@codeweavers.com>
References: <200712062305.52704.stefan@codeweavers.com>
Message-ID: <d658b69e0712070116u5f146624n8eb75861a49cad53@mail.gmail.com>

The clearest way to do this would probably be to simply do the
disabling in a separate loop over the disabled extensions string,
similarly to how we detect the extensions.


From stefan at codeweavers.com  Fri Dec  7 04:48:20 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Fri, 7 Dec 2007 11:48:20 +0100
Subject: [5/5] WineD3D: Use the disabled opengl extension string
In-Reply-To: <d658b69e0712070116u5f146624n8eb75861a49cad53@mail.gmail.com>
References: <200712062305.52704.stefan@codeweavers.com>
	<d658b69e0712070116u5f146624n8eb75861a49cad53@mail.gmail.com>
Message-ID: <200712071148.22538.stefan@codeweavers.com>

Am Freitag, 7. Dezember 2007 10:16:51 schrieb H. Verbeet:
> The clearest way to do this would probably be to simply do the
> disabling in a separate loop over the disabled extensions string,
> similarly to how we detect the extensions.
This will only partially work because we should also filter "extensions" 
imported from higher opengl base versions
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071207/0074fb3d/attachment.pgp 

From rob at codeweavers.com  Fri Dec  7 05:23:27 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Fri, 07 Dec 2007 11:23:27 +0000
Subject: [1/2] msxml3: Implement IPersistStream
In-Reply-To: <fjadur$fqc$2@ger.gmane.org>
References: <fjadur$fqc$2@ger.gmane.org>
Message-ID: <47592D2F.1070206@codeweavers.com>

Alistair Leslie-Hughes wrote:
> +    hr = CreateStreamOnHGlobal(NULL, TRUE, &This->stream);
> +    if (FAILED(hr))
> +        return hr

You need to free This->stream somewhere.

-- 
Rob Shearman



From hverbeet at gmail.com  Fri Dec  7 05:37:04 2007
From: hverbeet at gmail.com (H. Verbeet)
Date: Fri, 7 Dec 2007 12:37:04 +0100
Subject: Assorted spelling fixes.
In-Reply-To: <Pine.LNX.4.64.0712070103310.21564@amboise.dolphin>
References: <Pine.LNX.4.64.0712070103310.21564@amboise.dolphin>
Message-ID: <d658b69e0712070337v3257ad44secc67bb5c918212b@mail.gmail.com>

On 07/12/2007, Francois Gouget <fgouget at free.fr> wrote:
> --- a/dlls/wined3d/glsl_shader.c
> +++ b/dlls/wined3d/glsl_shader.c
> -         * out. The nvidia driver only does that if the parameter is inout instead of out, hence the
> -         * inout.
> +         * out. The nvidia driver only does that if the parameter is in/out instead of out, hence the
> +         * in/out.
I don't think that change is correct. GLSL function parameters can
have qualifiers to specify how the parameter is used. The possible
qualifiers are "in", "out" and "inout", where specifying no qualifier
is the same as specifying "in". I suppose the first "inout" could be
replaced with "in/out" without changing the meaning of the sentence
too much, but the second one is a reference to the actual qualifier.


From stefan at codeweavers.com  Fri Dec  7 05:49:54 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Fri, 7 Dec 2007 12:49:54 +0100
Subject: d3d fill caps oddity
In-Reply-To: <20071206215753.GD1897@byleth.sc-networks.de>
References: <20071206215753.GD1897@byleth.sc-networks.de>
Message-ID: <200712071249.58302.stefan@codeweavers.com>

Am Donnerstag, 6. Dezember 2007 22:57:53 schrieb Christoph Frick:
> Hi wined3d devs,
>
> i get this message on my notebook (Quadro 570m):
>
> fixme:d3d:IWineD3DImpl_FillGLCaps OpenGL implementation supports 32 vertex
> samplers and 32 total samplers fixme:d3d:IWineD3DImpl_FillGLCaps Expected
> vertex samplers + MAX_TEXTURES(=8) > combined_samplers
Ah, this is a false positive, and actually harmless. One could patch the code 
to not warn about this situation. See the comments in the code about why this 
happens.

d3d9 doesn't support more than 4 vertex samplers, so even if the card supports 
more(a gf8 class card supports 32, due to the uniformed shader architecture), 
we're still fine with 8 fixed function textures and 4 vertex samplers. So you 
can suppress the warning by capping the supported fragment samplers at 4 in 
this check(e.g. max(4, gl_info->fragment samplers)).
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071207/987cfd82/attachment.pgp 

From huw at codeweavers.com  Fri Dec  7 06:00:18 2007
From: huw at codeweavers.com (Huw Davies)
Date: Fri, 7 Dec 2007 12:00:18 +0000
Subject: [2/2] msxml3: Register Missing Components
In-Reply-To: <fjaduo$fqc$1@ger.gmane.org>
References: <fjaduo$fqc$1@ger.gmane.org>
Message-ID: <20071207120017.GB5468@merlot.physics.ox.ac.uk>

On Fri, Dec 07, 2007 at 02:07:44PM +1100, Alistair Leslie-Hughes wrote:
> diff --git a/dlls/msxml3/regsvr.c b/dlls/msxml3/regsvr.c
> index 9a0d938..1beed5b 100644
> --- a/dlls/msxml3/regsvr.c
> +++ b/dlls/msxml3/regsvr.c
> @@ -465,13 +465,13 @@ static LONG register_key_defvalueA(
>   */
>  static struct regsvr_coclass const coclass_list[] = {
>      {   &CLSID_DOMDocument,
> -	"XML DOM Document",
> -	NULL,
> -	"msxml3.dll",
> -	"Both",
> -	"Microsoft.XMLDOM",
> -	"1.0"
> -    },
> +        "XML DOM Document",
> +        NULL,
> +        "msxml3.dll",
> +        "Both",
> +        "Microsoft.XMLDOM",
> +        "1.0"
> +    },    


There are a lot of white-space changes in this patch.  Please re-submit
without them.

Thanks,
Huw.
-- 
Huw Davies
huw at codeweavers.com


From huw at codeweavers.com  Fri Dec  7 06:48:43 2007
From: huw at codeweavers.com (Huw Davies)
Date: Fri, 7 Dec 2007 12:48:43 +0000
Subject: gdi32: Update fontsubstitutes and add ms shell dlg 2
In-Reply-To: <47593AAB.7010109@codeweavers.com>
References: <47593AAB.7010109@codeweavers.com>
Message-ID: <20071207124843.GE5468@merlot.physics.ox.ac.uk>

On Fri, Dec 07, 2007 at 01:20:59PM +0100, Maarten Lankhorst wrote:
> ---
>  dlls/gdi32/freetype.c |   34 ++++++++++++++++++----------------
>  1 files changed, 18 insertions(+), 16 deletions(-)

> diff --git a/dlls/gdi32/freetype.c b/dlls/gdi32/freetype.c
> index e9fb663..1542e29 100644
> --- a/dlls/gdi32/freetype.c
> +++ b/dlls/gdi32/freetype.c
> @@ -1884,83 +1884,83 @@ static const struct nls_update_font_list
>      const char *oem, *fixed, *system;
>      const char *courier, *serif, *small, *sserif;
>     /* these are for font substitute */
> -    const char *shelldlg, *tmsrmn;
> +    const char *shelldlg, *shelldlg2, *tmsrmn;
>  } nls_update_font_list[] =
>  {
>      /* Latin 1 (United States) */
>      { 1252, 437, "vgaoem.fon", "vgafix.fon", "vgasys.fon",
>        "coure.fon", "serife.fon", "smalle.fon", "sserife.fon",
> -      "Tahoma","Times New Roman",
> +      "MS Sans Serif", "Tahoma","Times New Roman",
>      },

I'm fairly sure we don't want to map MS Shell Dlg to MS Sans Serif.
Which version of Windows has this mapping?  Some map it to Microsoft
Sans Serif, but that's a completely different font...

Huw.
-- 
Huw Davies
huw at codeweavers.com


From kornelpal at gmail.com  Fri Dec  7 07:19:55 2007
From: kornelpal at gmail.com (=?iso-8859-2?B?S29ybulsIFDhbA==?=)
Date: Fri, 7 Dec 2007 14:19:55 +0100
Subject: Mono 1.2.5.1 on Wine
Message-ID: <000901c838d3$dce502b0$0100a8c0@kornelpal.hu>

Hi,

I tried to run Mono 1.2.5.1 on Wine but it dies with the "Weird VirtualQuery 
result" error message. Are there any know bugs of Wine or Mono that prevent 
it from running?

I would like to make Mono run on Wine and I am willing to contribute patches 
to Wine and Mono as well to achieve that.

Korn?l 



From dank at kegel.com  Fri Dec  7 08:27:54 2007
From: dank at kegel.com (Dan Kegel)
Date: Fri, 7 Dec 2007 06:27:54 -0800
Subject: Nifty new valgrind report script. New error in oleaut32. Call for
	volunteer(s).
Message-ID: <a71bd89a0712070627m735cd649o47e6ba5c6e607499@mail.gmail.com>

I finally got tired of doing "history | grep diff" etc, and
partially automated the daily valgrind run; the resulting
script is at http://kegel.com/wine/valgrind/valgrind-daily.sh

The results are now in directories named like
http://kegel.com/wine/valgrind/logs-2007-12-06/
A summary of the new problems compared to last run are in files named like
http://kegel.com/wine/valgrind/logs-2007-12-06-summary.txt
And next to each individual result, there is a diff with the previous run, e.g.
http://kegel.com/wine/valgrind/logs-2007-12-06/vg-oleaut32_varformat.txt
http://kegel.com/wine/valgrind/logs-2007-12-06/vg-oleaut32_varformat-diff.txt

To look at what changed since yesterday, start by looking at the day's
summary file.
In it, there's one line per test, followed by the changes in that
test's results, if any.
Lines that start with + indicate new problems (boo);
lines that start with - indicate old problems that are now gone (yay!)
Nearby lines that are identical except for one starting with + and one
starting with -
indicate a problem that moved, so ignore those.

For example, in today's summary,
http://kegel.com/wine/valgrind/logs-2007-12-06-summary.txt
the first test with changes is in hlink:

diff -u logs-2007-12-05/vg-hlink_hlink.txt logs-2007-12-06/vg-hlink_hlink.txt
- Syscall param write(buf) points to uninitialised byte(s)

That means the hlink test has one fewer error.  Yay!

The next test with changes is

diff -u logs-2007-12-05/vg-ole32_moniker.txt
logs-2007-12-06/vg-ole32_moniker.txt
+ Syscall param write(buf) points to uninitialised byte(s)
- Syscall param write(buf) points to uninitialised byte(s)
- Conditional jump or move depends on uninitialised value(s)

The 'Syscall' error just moved, so that's not really a change.
The 'Conditional' error went away, yay!

The next test with changes is

diff -u logs-2007-12-05/vg-oleaut32_varformat.txt
logs-2007-12-06/vg-oleaut32_varformat.txt
+ Invalid read of size 2

That's a + with no matching -, so it's a new error, boo!
Let's see if it's a real error, or just crap in the log.  The
first thing to check is the diff of that test's results with the last run:
http://kegel.com/wine/valgrind/logs-2007-12-06/vg-oleaut32_varformat-diff.txt
It shows a fairly convincing new error:

+ Invalid read of size 2
+    at  VarFormatFromTokens (varformat.c:1888)
+    by  VarFormat (varformat.c:2096)
+    by  func_varformat (varformat.c:317)
+    by  run_test (test.h:387)
+    by  main (test.h:436)
+  Address 0x7F00AB01 is 15 bytes before a block of size 8 alloc'd
+    at  RtlAllocateHeap (heap.c:1225)
+    by  SysAllocStringByteLen (oleaut.c:357)
+    by  VariantCopy (variant.c:722)
+    by  VariantChangeTypeEx (variant.c:992)
+    by  VarFormatFromTokens (varformat.c:1884)
+    by  VarFormat (varformat.c:2096)
+    by  func_varformat (varformat.c:317)
+    by  run_test (test.h:387)
+    by  main (test.h:436)

Now, sometimes tests are flaky, and errors
just happen to come and go, so this doesn't mean
for sure it's a new error.  But looking back a
few days, I don't see it before.  So it's probably
a new error.  Let's see, who's been submitting changes
to oleaut32 lately?    Only change in git since the last run seems to be
http://www.winehq.org/pipermail/wine-cvs/2007-December/038491.html
It's not clear how that patch could have caused the error offhand,
but it's worth emailing the author and asking him to check,
so I've cc'd him.

And that's the only new error in the whole run.

It's worth watching for new errors and alerting the authors,
since the change is fresh in their mind, they'll probably
be able to fix it quickly.   Egg in the face is a dish best served warm.

I'll try to keep running this script daily, but it'd be nice if
somebody else took over (and possibly even increased
the automation; I still have to do git pull, run the script, and
upload by hand.)
It doesn't help that valgrind only works well on some machines,
but hey, what's life without challenges.
- Dan


From huw at codeweavers.com  Fri Dec  7 08:31:49 2007
From: huw at codeweavers.com (Huw Davies)
Date: Fri, 7 Dec 2007 14:31:49 +0000
Subject: (corrected) Add 18 pixel strike with japanese fonts to system.sdf
	Widths corrected and double checked for both strikes
In-Reply-To: <4757C6BD.9000805@codeweavers.com>
References: <475755DD.1000103@codeweavers.com>
	<4757C106.6050708@codeweavers.com>
	<4757C6BD.9000805@codeweavers.com>
Message-ID: <20071207143149.GI5468@merlot.physics.ox.ac.uk>

On Thu, Dec 06, 2007 at 06:54:05PM +0900, Aric Stewart wrote:
> I added a number of the black boxes to the 18 pixel strike  (the range 
> before 161)  and fontforge seemed unhappy if i did not add something to 
> the 16 pixel one. (maybe it was my misinterperting fontforge) but so i 
> added similar black boxes to what where already there.

It was these lines that looked suspicious:

-BDFChar: 351 154 4 0 2 0 8
-?smAM?smAM?iU0,
-BDFChar: 352 156 4 0 2 0 8
-?smAM?smAM?iU0,
+BDFChar: 351 154 4 1 2 0 8
+^qdb$^qdb$^]4?7
+BDFChar: 352 156 4 1 2 0 8
+^qdb$^qdb$^]4?7

Huw.
-- 
Huw Davies
huw at codeweavers.com


From fgouget at free.fr  Fri Dec  7 09:14:24 2007
From: fgouget at free.fr (Francois Gouget)
Date: Fri, 7 Dec 2007 16:14:24 +0100 (CET)
Subject: Assorted spelling fixes.
In-Reply-To: <d658b69e0712070337v3257ad44secc67bb5c918212b@mail.gmail.com>
References: <Pine.LNX.4.64.0712070103310.21564@amboise.dolphin>
	<d658b69e0712070337v3257ad44secc67bb5c918212b@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0712071613440.15881@amboise.dolphin>

On Fri, 7 Dec 2007, H. Verbeet wrote:

> On 07/12/2007, Francois Gouget <fgouget at free.fr> wrote:
> > --- a/dlls/wined3d/glsl_shader.c
> > +++ b/dlls/wined3d/glsl_shader.c
> > -         * out. The nvidia driver only does that if the parameter is inout instead of out, hence the
> > -         * inout.
> > +         * out. The nvidia driver only does that if the parameter is in/out instead of out, hence the
> > +         * in/out.
> I don't think that change is correct. GLSL function parameters can
> have qualifiers to specify how the parameter is used. The possible
> qualifiers are "in", "out" and "inout", where specifying no qualifier
> is the same as specifying "in". I suppose the first "inout" could be
> replaced with "in/out" without changing the meaning of the sentence
> too much, but the second one is a reference to the actual qualifier.

Oh, ok. I'll fix that.

-- 
Francois Gouget <fgouget at free.fr>              http://fgouget.free.fr/
                              145 = 1! + 4! + 5!


From ben at atomnet.co.uk  Fri Dec  7 09:58:44 2007
From: ben at atomnet.co.uk (Ben Hodgetts)
Date: Fri, 07 Dec 2007 15:58:44 +0000
Subject: Missing 32bit support libraries on x86_64 Debian
Message-ID: <47596DB4.3070000@atomnet.co.uk>

I just submitted this to the Debian tracker system, thought it may be 
useful to echo here in-case anyone else is using x86_64 Debian as it 
seems since Julliard put in a patch just before .42 to check more 
completely for dependencies it now shows that Debian (64) actually lacks 
certain deps for Wine.

Ben H.

---------------------------------------

Package: wine
Version: All
Severity: important

Wine, when compiled from source (upstream source) shows that Debian is 
missing certain dependencies which cause loss of functionality in Wine 
on x86_64. These are libpng, libcups, libcapi20, libhal and openssl. 
This means that 32bit support packages need to be made for Debian for 
Wine to work properly (just like there is currently a lib32asound(-dev), 
etc to give ALSA support).

-- System Information:
Debian Release: lenny/sid
   APT prefers unstable
   APT policy: (500, 'unstable'), (500, 'testing')
Architecture: amd64 (x86_64)

Kernel: Linux 2.6.22-3-amd64 (SMP w/2 CPU cores)
Locale: LANG=en_GB.UTF-8, LC_CTYPE=en_GB.UTF-8 (charmap=UTF-8)
Shell: /bin/sh linked to /bin/bash

Versions of packages wine depends on:
ii  debconf [debconf-2.0]         1.5.17     Debian configuration 
management sy
pn  libwine                       <none>     (no description available)
ii  xbase-clients                 1:7.3+7    miscellaneous X clients - 
metapack

Versions of packages wine recommends:
ii  msttcorefonts                 2.4        Installer for Microsoft 
TrueType c
pn  wine-utils                    <none>     (no description available)


From julliard at winehq.org  Fri Dec  7 10:39:33 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 07 Dec 2007 17:39:33 +0100
Subject: msi 2: Reimplement MsiGetProductCode
In-Reply-To: <22821af30712060934w6ce2d32cw8941369b4dd98f61@mail.gmail.com>
	(James Hawkins's message of "Thu, 6 Dec 2007 11:34:25 -0600")
References: <22821af30712060934w6ce2d32cw8941369b4dd98f61@mail.gmail.com>
Message-ID: <874peulare.fsf@wine.dyndns.org>

"James Hawkins" <truiken at gmail.com> writes:

> Changelog:
> * Reimplement MsiGetProductCode.

The test fails occasionally with something like:

../../../tools/runtest -q -P wine -M msi.dll -T ../../.. -p msi_test.exe.so msi.c && touch msi.ok
msi.c:1426: Test failed: Expected {E853FAEA-A4E2-11DC-A19E-001A923592CB}, got {E853FAAE-A4E2-11DC-A19E-001A923592CB}
msi.c:1530: Test failed: Expected {E853FAEA-A4E2-11DC-A19E-001A923592CB}, got {E853FAAE-A4E2-11DC-A19E-001A923592CB}
make: *** [msi.ok] Error 2

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Fri Dec  7 10:41:38 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 07 Dec 2007 17:41:38 +0100
Subject: [PATCH 1/5] winealsa: Make widGetPos more accurate
In-Reply-To: <47591733.1000908@codeweavers.com> (Maarten Lankhorst's message
	of "Fri, 07 Dec 2007 10:49:39 +0100")
References: <47591733.1000908@codeweavers.com>
Message-ID: <87zlwmjw3h.fsf@wine.dyndns.org>

Maarten Lankhorst <maarten at codeweavers.com> writes:

> ---
>  dlls/winealsa.drv/wavein.c |    6 +++++-

This doesn't work for me:

../../../tools/runtest -q -P wine -M winmm.dll -T ../../.. -p winmm_test.exe.so capture.c && touch capture.ok
capture.c:73: Test failed: waveInGetPosition(0): returned 2730 bytes, should be 0
capture.c:84: Test failed: waveInGetPosition(0): returned 2730 samples, should be 0
capture.c:96: Test failed: waveInGetPosition(0): returned 341 ms, should be 0
capture.c:108: Test failed: waveInGetPosition(0): SMPTE test failed
capture.c:119: Test failed: waveInGetPosition(0): MIDI test failed
capture.c:130: Test failed: waveInGetPosition(0): TICKS test failed
[lots more of the same]

-- 
Alexandre Julliard
julliard at winehq.org


From maarten at codeweavers.com  Fri Dec  7 11:49:50 2007
From: maarten at codeweavers.com (Maarten Lankhorst)
Date: Fri, 07 Dec 2007 18:49:50 +0100
Subject: [PATCH 1/5] winealsa: Make widGetPos more accurate
In-Reply-To: <87zlwmjw3h.fsf@wine.dyndns.org>
References: <47591733.1000908@codeweavers.com> <87zlwmjw3h.fsf@wine.dyndns.org>
Message-ID: <475987BE.9090805@codeweavers.com>

Hi Alex,

Alexandre Julliard schreef:
> This doesn't work for me:
>
> ../../../tools/runtest -q -P wine -M winmm.dll -T ../../.. -p winmm_test.exe.so capture.c && touch capture.ok
> capture.c:73: Test failed: waveInGetPosition(0): returned 2730 bytes, should be 0
> capture.c:84: Test failed: waveInGetPosition(0): returned 2730 samples, should be 0
> capture.c:96: Test failed: waveInGetPosition(0): returned 341 ms, should be 0
> capture.c:108: Test failed: waveInGetPosition(0): SMPTE test failed
> capture.c:119: Test failed: waveInGetPosition(0): MIDI test failed
> capture.c:130: Test failed: waveInGetPosition(0): TICKS test failed
> [lots more of the same]
>   
Oops, it's a naive assumption on my side. Omit this patch, the other 4
should be fine.

-Maarten


From julliard at winehq.org  Fri Dec  7 12:01:22 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 07 Dec 2007 19:01:22 +0100
Subject: Monthcal lost focus fix
In-Reply-To: <475298EF.2060404@home.se> (Gregor Brunmar's message of "Sun, 02
	Dec 2007 12:37:19 +0100")
References: <475298EF.2060404@home.se>
Message-ID: <87sl2ejsel.fsf@wine.dyndns.org>

Gregor Brunmar <gregor.brunmar at home.se> writes:

> diff --git a/dlls/comctl32/monthcal.c b/dlls/comctl32/monthcal.c
> index 8a92d42..e826612 100644
> --- a/dlls/comctl32/monthcal.c
> +++ b/dlls/comctl32/monthcal.c
> @@ -1719,11 +1719,12 @@ MONTHCAL_Paint(MONTHCAL_INFO *infoPtr, WPARAM wParam)
>  
>  
>  static LRESULT
> -MONTHCAL_KillFocus(const MONTHCAL_INFO *infoPtr)
> +MONTHCAL_KillFocus(const MONTHCAL_INFO *infoPtr, HWND hFocusWnd)
>  {
>    TRACE("\n");
>  
> -  InvalidateRect(infoPtr->hwndSelf, NULL, TRUE);
> +  if (infoPtr->hwndNotify != hFocusWnd)
> +    ShowWindow(infoPtr->hwndSelf, SW_HIDE);

Is there a reason for removing the InvalidateRect completely?

-- 
Alexandre Julliard
julliard at winehq.org


From dank at kegel.com  Fri Dec  7 20:14:15 2007
From: dank at kegel.com (Dan Kegel)
Date: Fri, 7 Dec 2007 18:14:15 -0800
Subject: Wine Problem
Message-ID: <a71bd89a0712071814g722f42ecwcc3e6a95e599c7c9@mail.gmail.com>

Pedro Ferreira wrote:
> I installed a software that talks with the informix client 2.7.0
> everything was running fine, the instalation went with minor problems.
> Until now
>
>when i stated a connection to the informix server wine simply stops

Which version of Wine?

Have you tested the connection using the ilogin.exe demo
that comes with the informix SDK?  If you don't have it,
you can download a free trial of the 2.80 SDK, that's probably close enough.

The procedure for testing the connection is described here:
http://www.synametrics.com/ifmxODBC.htm

BTW the right mailing list for this is probably wine-users, not wine-devel.
- Dan


From jjmckenzie51 at sprintpcs.com  Fri Dec  7 23:57:23 2007
From: jjmckenzie51 at sprintpcs.com (James McKenzie)
Date: Fri, 07 Dec 2007 22:57:23 -0700
Subject: Mono 1.2.5.1 on Wine
In-Reply-To: <000901c838d3$dce502b0$0100a8c0@kornelpal.hu>
References: <000901c838d3$dce502b0$0100a8c0@kornelpal.hu>
Message-ID: <475A3243.20704@sprintpcs.com>

Korn?l P?l wrote:
> Hi,
>
> I tried to run Mono 1.2.5.1 on Wine but it dies with the "Weird VirtualQuery 
> result" error message. Are there any know bugs of Wine or Mono that prevent 
> it from running?
>
> I would like to make Mono run on Wine and I am willing to contribute patches 
> to Wine and Mono as well to achieve that.
>
>   
Use Mono 1.2.5.2.  It works, but 1.2.5.1 does not.

James



From luis.busquets at ilidium.com  Sat Dec  8 00:55:34 2007
From: luis.busquets at ilidium.com (=?ISO-8859-1?Q?=22Luis_C=2E_Busquets_P=E9rez=22?=)
Date: Sat, 08 Dec 2007 07:55:34 +0100
Subject: d3ds9_xx
Message-ID: <475A3FE6.9070901@ilidium.com>

I have not seen any patch committed beginning the implementation of 
these libraries. Therefore, I was wondering which is the tree structure 
for these dlls that all of you propose and Alexander is willing to commit.



From stefan at codeweavers.com  Sat Dec  8 10:31:30 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sat, 8 Dec 2007 17:31:30 +0100
Subject: ddraw: fix wrong initialization order in IDirect3DDevice vtable
In-Reply-To: <475B4C3C.1090802@inbox.lv>
References: <475B4C3C.1090802@inbox.lv>
Message-ID: <200712081731.35188.stefan@codeweavers.com>

Am Sonntag, 9. Dezember 2007 03:00:28 schrieb Alexander Dorofeyev:
> Helps bug#7584 (http://bugs.winehq.org/show_bug.cgi?id=7584)
> ---
>     dlls/ddraw/device.c |    2 +-
>     1 files changed, 1 insertions(+), 1 deletions(-)
Looks correct to me, good catch!
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071208/002c34f6/attachment.pgp 

From rob at codeweavers.com  Sat Dec  8 11:13:27 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Sat, 08 Dec 2007 17:13:27 +0000
Subject: Valgrind support for our unit tests
In-Reply-To: <a71bd89a0712071354v2ff9d3c0ie5e26f74c324f433@mail.gmail.com>
References: <a71bd89a0712071354v2ff9d3c0ie5e26f74c324f433@mail.gmail.com>
Message-ID: <475AD0B7.4020903@codeweavers.com>

Dan Kegel wrote:
> +{
> +   todo_suppress_exception_addr4
> +   Memcheck:Addr4
> +   fun:__wine_call_from_32_regs
> +   obj:/home/dank/wine-git/dlls/ntdll/ntdll.dll.so
> +   obj:/home/dank/wine-git/dlls/ntdll/ntdll.dll.so
> +   fun:raise_exception

I'm not sure this will work for other people unless they log on as dank :-)

However, I don't think maintaining the valgrind suppressions file in 
tree is viable since most of the warnings come from system libraries 
which means that it is very dependent on user's distribution.

It might be best to set up an external git tree for this, which would 
allow for people to submit patches for any bogus warnings in the runs 
that you publish on your website.

-- 
Rob Shearman



From coke at lounge.lu  Sat Dec  8 12:27:35 2007
From: coke at lounge.lu (Gilles May)
Date: Sat, 08 Dec 2007 19:27:35 +0100
Subject: File a bug report?
Message-ID: <475AE217.40707@lounge.lu>

Hi everybody.

After updating WINE to from 0.9.49 to 0.9.50 I noticed major slowdown in
Company of Heroes, to the point that I get like 1 Frame every 2 seconds.
Wine spams the console with:

fixme:d3d_shader:IWineD3DVertexShaderImpl_CompileShader Vertexshader
0x4d20b78 recompiled more than 50 times

Trying to find out the cause for the slowdown I did my first attempt at
using git bisect and I could trace the slowdown to this patch:

959212304dfaf0e7459374593b20b74fe22a0b57 is first bad commit
commit 959212304dfaf0e7459374593b20b74fe22a0b57
Author: Stefan D?singer <stefan at codeweavers.com>
Date:   Tue Nov 20 21:14:10 2007 +0100

    wined3d: Track vertex declaration changes on vertex shaders.
   
    If an attribute has type D3DDECLTYPE_D3DCOLOR, the red and blue channels
    are swizzled in the shader. Since the attribute is stored in the vertex
    declaration and not the vertex shader, it can change by setting a new
    vertex declaration. If this happens, we have to recompile the shader
    with the swizzling of that specific attribute turned on or off.

:040000 040000 327661a4d0f8a02bdc18380084589c891b64af9c
e35a2bcbf9514e4f261d8b7a93dcb24c0b3c89a7 M      dlls

Now without that patch there is slight texture corruption in the game,
with the patch it's much much less but it renders the game unplayable.
The reason I didn't file a bug report is that I am not sure if it is
really a bug or not since obviously the patch fixes in-game texture
corruption.

Regards, Gilles




From dank at kegel.com  Sat Dec  8 14:13:27 2007
From: dank at kegel.com (Dan Kegel)
Date: Sat, 8 Dec 2007 12:13:27 -0800
Subject: Valgrind support for our unit tests
In-Reply-To: <475AD0B7.4020903@codeweavers.com>
References: <a71bd89a0712071354v2ff9d3c0ie5e26f74c324f433@mail.gmail.com>
	<475AD0B7.4020903@codeweavers.com>
Message-ID: <a71bd89a0712081213od3cf325x2b3f056fe1a1123f@mail.gmail.com>

On Dec 8, 2007 9:13 AM, Robert Shearman <rob at codeweavers.com> wrote:
> Dan Kegel wrote:
> > +   obj:/home/dank/wine-git/dlls/ntdll/ntdll.dll.so
> I'm not sure this will work for other people unless they log on as dank :-)

Whoops!

> However, I don't think maintaining the valgrind suppressions file in
> tree is viable since most of the warnings come from system libraries
> which means that it is very dependent on user's distribution.

Right, but we can add suppressions for them all as needed,
it's not that hard to get all the popular libc etc. versions.

> It might be best to set up an external git tree for this, which would
> allow for people to submit patches for any bogus warnings

I'd rather that be maintained in the main tree.  I'm trying
to reduce my typing...
and really, I'd like to see more than just one person running
valgrind with wine.
- Dan


From lav at etersoft.ru  Sat Dec  8 14:31:45 2007
From: lav at etersoft.ru (Vitaly Lipatov)
Date: Sat, 8 Dec 2007 23:31:45 +0300
Subject: Alexander Nicolaysen
	=?utf-8?q?S=C3=B8rnes_=3A_comdlg32=3A_PageSetupDlgA=3A_Read_margins_from?=
	=?utf-8?q?_correct_edit?= boxes.
In-Reply-To: <E1J15aN-0002FC-8W@wine.codeweavers.com>
References: <E1J15aN-0002FC-8W@wine.codeweavers.com>
Message-ID: <200712082331.45919.lav@etersoft.ru>

Hello,
I already posted the same patch to wine-patches one month ago:
http://www.winehq.org/pipermail/wine-patches/2007-November/046156.html
Why my patch was ignored? I am in some black list?

? ????????? ?? 8 ??????? 2007 Alexandre Julliard ???????(a):
> Module: wine
> Branch: master
> Commit: 51086b5513a436f51460d006f4fa7156e9d58a92
> URL:   
> http://source.winehq.org/git/wine.git/?a=commit;h=51086b5513a436f51460d006f
>4fa7156e9d58a92
>
> Author: Alexander Nicolaysen S?rnes <alex at thehandofagony.com>
> Date:   Sat Dec  8 13:53:32 2007 +0100
>
> comdlg32: PageSetupDlgA: Read margins from correct edit boxes.
>
> ---
>
>  dlls/comdlg32/printdlg.c |    4 ++--
>  1 files changed, 2 insertions(+), 2 deletions(-)
>
> diff --git a/dlls/comdlg32/printdlg.c b/dlls/comdlg32/printdlg.c
> index e04e145..5baa90e 100644
> --- a/dlls/comdlg32/printdlg.c
> +++ b/dlls/comdlg32/printdlg.c
> @@ -2890,10 +2890,10 @@ PRINTDLG_PS_WMCommandA(
>      	GETVAL(id, pda->curdlg.rtMargin.left);
>  	break;
>      case edt5:
> -    	GETVAL(id, pda->curdlg.rtMargin.right);
> +	GETVAL(id, pda->curdlg.rtMargin.top);
>  	break;
>      case edt6:
> -    	GETVAL(id, pda->curdlg.rtMargin.top);
> +	GETVAL(id, pda->curdlg.rtMargin.right);
>  	break;
>      case edt7:
>      	GETVAL(id, pda->curdlg.rtMargin.bottom);




-- 
Vitaly Lipatov, ALT Linux Team
Russia, Saint-Petersburg, www.etersoft.ru


From jjmckenzie51 at sprintpcs.com  Sat Dec  8 14:41:01 2007
From: jjmckenzie51 at sprintpcs.com (James McKenzie)
Date: Sat, 08 Dec 2007 13:41:01 -0700
Subject: File a bug report?
In-Reply-To: <475AE217.40707@lounge.lu>
References: <475AE217.40707@lounge.lu>
Message-ID: <475B015D.2060205@sprintpcs.com>

Gilles May wrote:
> Hi everybody.
>
> After updating WINE to from 0.9.49 to 0.9.50 I noticed major slowdown in
> Company of Heroes, to the point that I get like 1 Frame every 2 seconds.
> Wine spams the console with:
>
>   
Please file a bug report for this, thank you.

Also, in the future, please bring up issues like this in the wine-users
list as well.

James



From jjmckenzie51 at sprintpcs.com  Sat Dec  8 14:42:59 2007
From: jjmckenzie51 at sprintpcs.com (James McKenzie)
Date: Sat, 08 Dec 2007 13:42:59 -0700
Subject: Valgrind support for our unit tests
In-Reply-To: <a71bd89a0712081213od3cf325x2b3f056fe1a1123f@mail.gmail.com>
References: <a71bd89a0712071354v2ff9d3c0ie5e26f74c324f433@mail.gmail.com>
	<475AD0B7.4020903@codeweavers.com>
	<a71bd89a0712081213od3cf325x2b3f056fe1a1123f@mail.gmail.com>
Message-ID: <475B01D3.2060209@sprintpcs.com>

Dan Kegel wrote:
> On Dec 8, 2007 9:13 AM, Robert Shearman <rob at codeweavers.com> wrote:
>   
>> Dan Kegel wrote:
>>     
>>> +   obj:/home/dank/wine-git/dlls/ntdll/ntdll.dll.so
>>>       
>> I'm not sure this will work for other people unless they log on as dank :-)
>>     
>
> Whoops!
>
>
>   
Since I am a Mac user, does valgrind exist for this platform and if so,
where can it get/build it?

I feel that reports from Mac users would be useful as well as from the
Linux community.

Thank you.

James




From zac at zacbrown.org  Sat Dec  8 14:59:06 2007
From: zac at zacbrown.org (Zac Brown)
Date: Sat, 08 Dec 2007 15:59:06 -0500
Subject: Valgrind support for our unit tests
In-Reply-To: <475B01D3.2060209@sprintpcs.com>
References: <a71bd89a0712071354v2ff9d3c0ie5e26f74c324f433@mail.gmail.com>	<475AD0B7.4020903@codeweavers.com>	<a71bd89a0712081213od3cf325x2b3f056fe1a1123f@mail.gmail.com>
	<475B01D3.2060209@sprintpcs.com>
Message-ID: <475B059A.5010001@zacbrown.org>

James McKenzie wrote:
> Dan Kegel wrote:
>> On Dec 8, 2007 9:13 AM, Robert Shearman <rob at codeweavers.com> wrote:
>>   
>>> Dan Kegel wrote:
>>>     
>>>> +   obj:/home/dank/wine-git/dlls/ntdll/ntdll.dll.so
>>>>       
>>> I'm not sure this will work for other people unless they log on as dank :-)
>>>     
>> Whoops!
>>
>>
>>   
> Since I am a Mac user, does valgrind exist for this platform and if so,
> where can it get/build it?
> 
> I feel that reports from Mac users would be useful as well as from the
> Linux community.
> 
> Thank you.
> 
> James
> 
> 
> 

There is no valgrind port for Mac OS X yet but it looks to me that the
likelihood of there being one is pretty good.

See this link: http://valgrind.org/info/platforms.html

It mentions that Darwin support for x86 will be high, but would that
be that helpful in Leopard? If I recall correctly, Leopard is
fully 64-bit now. <-- Someone correct me if I'm wrong on that.

-Zac


From stefan at codeweavers.com  Sat Dec  8 15:18:30 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sat, 8 Dec 2007 22:18:30 +0100
Subject: File a bug report?
In-Reply-To: <475AE217.40707@lounge.lu>
References: <475AE217.40707@lounge.lu>
Message-ID: <200712082218.35047.stefan@codeweavers.com>

Am Samstag, 8. Dezember 2007 19:27:35 schrieb Gilles May:
> Hi everybody.
>
> After updating WINE to from 0.9.49 to 0.9.50 I noticed major slowdown in
> Company of Heroes, to the point that I get like 1 Frame every 2 seconds.
> Wine spams the console with:
>
> fixme:d3d_shader:IWineD3DVertexShaderImpl_CompileShader Vertexshader
> 0x4d20b78 recompiled more than 50 times
This patch caused quite a few similar regressions, I fixed one of them before 
the .50 release, and another one afterwards, so you might want to give the 
current git code a try. However, there is at least one (not yet known) 
situation left where shaders recompile all over.


-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071208/55113f32/attachment.pgp 

From dank at kegel.com  Sat Dec  8 15:56:48 2007
From: dank at kegel.com (Dan Kegel)
Date: Sat, 8 Dec 2007 13:56:48 -0800
Subject: Valgrind support for our unit tests
In-Reply-To: <475B01D3.2060209@sprintpcs.com>
References: <a71bd89a0712071354v2ff9d3c0ie5e26f74c324f433@mail.gmail.com>
	<475AD0B7.4020903@codeweavers.com>
	<a71bd89a0712081213od3cf325x2b3f056fe1a1123f@mail.gmail.com>
	<475B01D3.2060209@sprintpcs.com>
Message-ID: <a71bd89a0712081356s22723110x7d6ce23fa6bd27a2@mail.gmail.com>

On Dec 8, 2007 12:42 PM, James McKenzie <jjmckenzie51 at sprintpcs.com> wrote:
> I feel that reports from Mac users would be useful as well as from the
> Linux community.

Yes, it'd be nice to have MacOSX support for
Valgrind sometime.  It would probably take significant
effort; hopefully Apple or some very motivated grad
student will do it someday.

But most of the useful errors Valgrind picks up are
probably platform independent, so Wine on Mac
will still benefit from the Valgrinding going on under Linux.
- Dan


From dank at kegel.com  Sat Dec  8 19:09:40 2007
From: dank at kegel.com (Dan Kegel)
Date: Sat, 8 Dec 2007 17:09:40 -0800
Subject: Saturday's(!) valgrind results
Message-ID: <a71bd89a0712081709n609a0607j28b679ae829785af@mail.gmail.com>

For the first time I can recall, Alexandre committed lots
of changes on a Saturday, so I did a valgrind run.

http://kegel.com/wine/valgrind/logs-2007-12-08-summary.txt
shows the highlights; basically, lots more warnings like
+ Syscall param writev(vector[1]) points to uninitialised byte(s)
For example, the one at the top of
http://kegel.com/wine/valgrind/logs-2007-12-08/vg-user32_edit-diff.txt

+ Syscall param writev(vector[1]) points to uninitialised byte(s)
+    at  (within /lib/ld-2.5.so)
+    by  writev (in /lib/tls/i686/cmov/libc-2.5.so)
+    by  wine_server_call (server.c:244)

The only change in the server was
http://source.winehq.org/git/wine.git/?a=commitdiff;h=edd3f264d95c0c6bed9c18f51e42a9523bd305eb
so I guess the new errors reflect additional
error completion events being sent,
and that kind of event just happens to contain some
uninitialized bytes.

So this is probably in Alexandre's court, and
my guess is he'll consider this a false positive.
- Dan

-- 
Wine for Windows ISVs: http://kegel.com/wine/isv


From alex at thehandofagony.com  Sat Dec  8 19:14:53 2007
From: alex at thehandofagony.com (Alexander Nicolaysen =?utf-8?q?S=C3=B8rnes?=)
Date: Sun, 9 Dec 2007 02:14:53 +0100
Subject: Alexander Nicolaysen
	=?utf-8?q?S=C3=B8rnes_=3A_comdlg32=3A_PageSetupDlgA=3A_Read_margins_from?=
	=?utf-8?q?_correct_edit?= boxes.
In-Reply-To: <200712082331.45919.lav@etersoft.ru>
References: <E1J15aN-0002FC-8W@wine.codeweavers.com>
	<200712082331.45919.lav@etersoft.ru>
Message-ID: <200712090214.54024.alex@thehandofagony.com>

On Saturday 08 December 2007 21:31:45 Vitaly Lipatov wrote:
> Hello,
> I already posted the same patch to wine-patches one month ago:
> http://www.winehq.org/pipermail/wine-patches/2007-November/046156.html
> Why my patch was ignored? I am in some black list?
>

I discovered the issue while working on PageDlgA/W.  Are you working on those, 
too?  Just so we don't duplicate work.


Alexander


> ? ????????? ?? 8 ??????? 2007 Alexandre Julliard ???????(a):
> > Module: wine
> > Branch: master
> > Commit: 51086b5513a436f51460d006f4fa7156e9d58a92
> > URL:
> > http://source.winehq.org/git/wine.git/?a=commit;h=51086b5513a436f51460d00
> >6f 4fa7156e9d58a92
> >
> > Author: Alexander Nicolaysen S?rnes <alex at thehandofagony.com>
> > Date:   Sat Dec  8 13:53:32 2007 +0100
> >
> > comdlg32: PageSetupDlgA: Read margins from correct edit boxes.
> >
> > ---
> >
> >  dlls/comdlg32/printdlg.c |    4 ++--
> >  1 files changed, 2 insertions(+), 2 deletions(-)
> >
> > diff --git a/dlls/comdlg32/printdlg.c b/dlls/comdlg32/printdlg.c
> > index e04e145..5baa90e 100644
> > --- a/dlls/comdlg32/printdlg.c
> > +++ b/dlls/comdlg32/printdlg.c
> > @@ -2890,10 +2890,10 @@ PRINTDLG_PS_WMCommandA(
> >      	GETVAL(id, pda->curdlg.rtMargin.left);
> >  	break;
> >      case edt5:
> > -    	GETVAL(id, pda->curdlg.rtMargin.right);
> > +	GETVAL(id, pda->curdlg.rtMargin.top);
> >  	break;
> >      case edt6:
> > -    	GETVAL(id, pda->curdlg.rtMargin.top);
> > +	GETVAL(id, pda->curdlg.rtMargin.right);
> >  	break;
> >      case edt7:
> >      	GETVAL(id, pda->curdlg.rtMargin.bottom);




From dank at kegel.com  Sat Dec  8 23:14:21 2007
From: dank at kegel.com (Dan Kegel)
Date: Sat, 8 Dec 2007 21:14:21 -0800
Subject: speeding up regression testing by disabling building of tests?
Message-ID: <a71bd89a0712082114ge31b370i148cd53801ee8d96@mail.gmail.com>

Lots of the time in regression searches is spent
compiling tests, but when you're only going to
run the app that's breaking, that's not too useful.
How does one disable compilation of conformance tests?
I have this funny feeling Lei or Mikolaj did this
recently, but I couldn't track it down.


From maarten at codeweavers.com  Sun Dec  9 04:13:57 2007
From: maarten at codeweavers.com (Maarten Lankhorst)
Date: Sun, 09 Dec 2007 11:13:57 +0100
Subject: speeding up regression testing by disabling building of tests?
In-Reply-To: <a71bd89a0712082114ge31b370i148cd53801ee8d96@mail.gmail.com>
References: <a71bd89a0712082114ge31b370i148cd53801ee8d96@mail.gmail.com>
Message-ID: <475BBFE5.1080103@codeweavers.com>

Hi Dan,

Dan Kegel schreef:
> Lots of the time in regression searches is spent
> compiling tests, but when you're only going to
> run the app that's breaking, that's not too useful.
> How does one disable compilation of conformance tests?
> I have this funny feeling Lei or Mikolaj did this
> recently, but I couldn't track it down.
>   
Try my hack:
http://repo.or.cz/w/wine/hacks.git?a=commit;h=df41d984eafa372547b9aa5ae80a3adff5f8efb7

You need to do autoconf after applying, then build with configure
--disable-tests. I still wish alexandre would accept this into the main
tree. :-/

Cheers,
Maarten.



From lav at etersoft.ru  Sun Dec  9 04:32:07 2007
From: lav at etersoft.ru (Vitaly Lipatov)
Date: Sun, 9 Dec 2007 13:32:07 +0300
Subject: Alexander Nicolaysen
	=?utf-8?q?S=C3=B8rnes_=3A_comdlg32=3A_PageSetupDlgA=3A_Read_margins_from?=
	=?utf-8?q?_correct_edit?= boxes.
In-Reply-To: <200712090214.54024.alex@thehandofagony.com>
References: <E1J15aN-0002FC-8W@wine.codeweavers.com>
	<200712082331.45919.lav@etersoft.ru>
	<200712090214.54024.alex@thehandofagony.com>
Message-ID: <200712091332.07888.lav@etersoft.ru>

? ????????? ?? 9 ??????? 2007 Alexander Nicolaysen S?rnes ???????(a):
> On Saturday 08 December 2007 21:31:45 Vitaly Lipatov wrote:
> > Hello,
> > I already posted the same patch to wine-patches one month ago:
> > http://www.winehq.org/pipermail/wine-patches/2007-November/046156.html
> > Why my patch was ignored? I am in some black list?
>
> I discovered the issue while working on PageDlgA/W.  Are you working on
> those, too?  Just so we don't duplicate work.
I did some works two years ago. Today I resend my patches to wine-patches with 
CC to you. Please pay attention to incorporate these changes in you works.


-- 
Vitaly Lipatov, ALT Linux Team
Russia, Saint-Petersburg, www.etersoft.ru


From lionel_debroux at yahoo.fr  Sun Dec  9 05:00:55 2007
From: lionel_debroux at yahoo.fr (Lionel_Debroux)
Date: Sun, 09 Dec 2007 12:00:55 +0100
Subject: msi: fix missing alloc check.
Message-ID: <475BCAE7.5070100@yahoo.fr>

"msi_dialog_list_box" in dlls/msi/dialog.c gets flagged by Michael
Stefaniuc's unfree-wine.pl script.

* As far as I can see, "info", allocated line 2203, is not used before
the return that leaks it (line 2214), neither in a direct nor an
indirect (macro) way. But maybe the "fail-fast" behaviour is intended
(because if allocation of "info" fails, there are chances the allocation
of "control" would fail, too) ?
* While looking at the source of the functions called by
"msi_dialog_list_box" to make sure they didn't use "info", I spotted a
call to msi_alloc, whose result is not checked. Therefore, the
subsequent lines may write to NULL+some_offset.

The patch contains only the fix for the latter problem, because I'm not
100% sure that the memory leak can be solved by moving the allocation of
info after the call to "msi_dialog_add_control", without ill side
effects (e.g. msi_dialog_add_control calls msi_dialog_create_window,
which calls CreateWindowExW).


2007-12-09  Lionel Debroux <lionel_debroux at yahoo.fr>
        * dlls/msi/dialog.c:
        msi: fix missing alloc check.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0003-msi-fix-missing-alloc-check.patch
Type: text/x-diff
Size: 0 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071209/b9a0a39c/attachment.patch 

From lionel_debroux at yahoo.fr  Sun Dec  9 04:58:46 2007
From: lionel_debroux at yahoo.fr (Lionel Debroux)
Date: Sun, 9 Dec 2007 11:58:46 +0100
Subject: msi: fix missing alloc check.
Message-ID: <mailman.84.1197198795.6275.wine-devel@winehq.org>

---
 dlls/msi/dialog.c |   75 +++++++++++++++++++++++++++-------------------------
 1 files changed, 39 insertions(+), 36 deletions(-)

diff --git a/dlls/msi/dialog.c b/dlls/msi/dialog.c
index d0e91cd..871d7b2 100644
--- a/dlls/msi/dialog.c
+++ b/dlls/msi/dialog.c
@@ -409,46 +409,49 @@ static msi_control *msi_dialog_create_window( msi_dialog *dialog,
     style |= WS_CHILD;
 
     control = msi_alloc( sizeof *control + strlenW(name)*sizeof(WCHAR) );
-    strcpyW( control->name, name );
-    list_add_head( &dialog->controls, &control->entry );
-    control->handler = NULL;
-    control->property = NULL;
-    control->value = NULL;
-    control->hBitmap = NULL;
-    control->hIcon = NULL;
-    control->hDll = NULL;
-    control->tabnext = strdupW( MSI_RecordGetString( rec, 11) );
-    control->type = strdupW( MSI_RecordGetString( rec, 3 ) );
-    control->progress_current = 0;
-    control->progress_max = 100;
-
-    x = MSI_RecordGetInteger( rec, 4 );
-    y = MSI_RecordGetInteger( rec, 5 );
-    width = MSI_RecordGetInteger( rec, 6 );
-    height = MSI_RecordGetInteger( rec, 7 );
-
-    x = msi_dialog_scale_unit( dialog, x );
-    y = msi_dialog_scale_unit( dialog, y );
-    width = msi_dialog_scale_unit( dialog, width );
-    height = msi_dialog_scale_unit( dialog, height );
-
-    if( text )
-    {
-        deformat_string( dialog->package, text, &title_font );
-        font = msi_dialog_get_style( title_font, &title );
-    }
+    if (control)
+    {
+        strcpyW( control->name, name );
+        list_add_head( &dialog->controls, &control->entry );
+        control->handler = NULL;
+        control->property = NULL;
+        control->value = NULL;
+        control->hBitmap = NULL;
+        control->hIcon = NULL;
+        control->hDll = NULL;
+        control->tabnext = strdupW( MSI_RecordGetString( rec, 11) );
+        control->type = strdupW( MSI_RecordGetString( rec, 3 ) );
+        control->progress_current = 0;
+        control->progress_max = 100;
+
+        x = MSI_RecordGetInteger( rec, 4 );
+        y = MSI_RecordGetInteger( rec, 5 );
+        width = MSI_RecordGetInteger( rec, 6 );
+        height = MSI_RecordGetInteger( rec, 7 );
+
+        x = msi_dialog_scale_unit( dialog, x );
+        y = msi_dialog_scale_unit( dialog, y );
+        width = msi_dialog_scale_unit( dialog, width );
+        height = msi_dialog_scale_unit( dialog, height );
+
+        if( text )
+        {
+            deformat_string( dialog->package, text, &title_font );
+            font = msi_dialog_get_style( title_font, &title );
+        }
 
-    control->hwnd = CreateWindowExW( exstyle, szCls, title, style,
-                          x, y, width, height, parent, NULL, NULL, NULL );
+        control->hwnd = CreateWindowExW( exstyle, szCls, title, style,
+                              x, y, width, height, parent, NULL, NULL, NULL );
 
-    TRACE("Dialog %s control %s hwnd %p\n",
-           debugstr_w(dialog->name), debugstr_w(text), control->hwnd );
+        TRACE("Dialog %s control %s hwnd %p\n",
+               debugstr_w(dialog->name), debugstr_w(text), control->hwnd );
 
-    msi_dialog_set_font( dialog, control->hwnd,
-                         font ? font : dialog->default_font );
+        msi_dialog_set_font( dialog, control->hwnd,
+                             font ? font : dialog->default_font );
 
-    msi_free( title_font );
-    msi_free( font );
+        msi_free( title_font );
+        msi_free( font );
+    }
 
     return control;
 }
-- 
1.5.3.4


--------------060408090500040007030204--


From jonathan at ernstfamily.ch  Sun Dec  9 07:07:39 2007
From: jonathan at ernstfamily.ch (Jonathan Ernst)
Date: Sun, 09 Dec 2007 14:07:39 +0100
Subject: [press] Phoronix compares 7 versions of Wine
Message-ID: <1197205659.6197.2.camel@jernst-desktop>

Hello,

What do you think about their tests and results ?

http://www.phoronix.com/vr.php?view=11539

"The performance in the fourteen 3DMark 2001 SE and 3DMark 2003 tests
were fairly consistent in the releases between WINE 0.9.44 and WINE
0.9.50 -- generally only swaying a few frames in either direction --
though the performance overall has slightly declined and we were
surprised by a few of the results."


-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071209/2e4858e5/attachment.pgp 

From jonathan at ernstfamily.ch  Sun Dec  9 07:10:33 2007
From: jonathan at ernstfamily.ch (Jonathan Ernst)
Date: Sun, 09 Dec 2007 14:10:33 +0100
Subject: [press] Phoronix compares 7 versions of Wine
In-Reply-To: <1197205659.6197.2.camel@jernst-desktop>
References: <1197205659.6197.2.camel@jernst-desktop>
Message-ID: <1197205833.6197.3.camel@jernst-desktop>

On dim, 2007-12-09 at 14:07 +0100, Jonathan Ernst wrote:
> Hello,
> 
> What do you think about their tests and results ?
> 
> http://www.phoronix.com/vr.php?view=11539

I guess it's linked with http://bugs.winehq.org/show_bug.cgi?id=10631





From klaute at gmx.de  Sun Dec  9 07:35:47 2007
From: klaute at gmx.de (Kai Lauterbach)
Date: Sun, 09 Dec 2007 14:35:47 +0100
Subject: Read Application Memory
Message-ID: <1197207347.6582.19.camel@yoku>

Hi,

at the moment I'm writing a little Linux based program to read some
variables from a Windows application. But my problem is, that i can't
access to the virtual memory of the Win App running under wine. I don't
know how to do this. c/c++ isn't the problem but the right way to do it.

I've already read the wineserver's main.c and fd.c but I think that it's
not a good way to put a code into, which give's me the chance to read
something. I need sth to connect, like /dev/mem or a network port.

My second idea was the wine debugger. Is it possible to get access the
application memory at runtime from this? I mean, without stopping the
application?

I hope you can help me and I've described my problem as clear as
possible ;)

Greetings,
Kai

-- 
Kai Lauterbach <klaute at gmx.de>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: Dies ist ein digital signierter Nachrichtenteil
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071209/c6ca9535/attachment.pgp 

From dmitry at codeweavers.com  Sun Dec  9 08:10:10 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sun, 9 Dec 2007 22:10:10 +0800
Subject: [PATCH 3/6] COMDLG32: printdlg: check hook pointer (resend 3)
References: <200712091327.52194.lav@etersoft.ru>
Message-ID: <00ae01c83a6d$379161a0$a600fea9@DMITRY>

"Vitaly Lipatov" <lav at etersoft.ru> wrote:

> --- dlls/commdlg/printdlg.c 11 Jan 2006 11:37:03 -0000 1.100
> +++ dlls/comdlg32/printdlg.c 24 Feb 2006 17:47:53 -0000

The way you've generated this patch looks pretty strange.

>      /* Call user paint hook if enable */
>      if (pda->dlga->Flags & PSD_ENABLEPAGEPAINTHOOK)
> -        if (pda->dlga->lpfnPagePaintHook(hwndDlg, uMsg, wParam, lParam))
> +        if (pda->dlga->lpfnPagePaintHook && pda->dlga->lpfnPagePaintHook(hwndDlg, uMsg, wParam, lParam))

You have to add the checks existing in PageSetupDlgA to PageSetupDlgW instead.

Also, in order to increase the probability of your patches to be included
should either point to existing bug that each of your patches fix, or/and
add a test case which doesn't pass without your patch and does with it.

-- 
Dmitry.


From lav at etersoft.ru  Sun Dec  9 08:35:05 2007
From: lav at etersoft.ru (Vitaly Lipatov)
Date: Sun, 9 Dec 2007 17:35:05 +0300
Subject: [PATCH 3/6] COMDLG32: printdlg: check hook pointer (resend 3)
In-Reply-To: <00ae01c83a6d$379161a0$a600fea9@DMITRY>
References: <200712091327.52194.lav@etersoft.ru>
	<00ae01c83a6d$379161a0$a600fea9@DMITRY>
Message-ID: <200712091735.05445.lav@etersoft.ru>

? ????????? ?? 9 ??????? 2007 Dmitry Timoshkov ???????(a):
> "Vitaly Lipatov" <lav at etersoft.ru> wrote:
> > --- dlls/commdlg/printdlg.c 11 Jan 2006 11:37:03 -0000 1.100
> > +++ dlls/comdlg32/printdlg.c 24 Feb 2006 17:47:53 -0000
>
> The way you've generated this patch looks pretty strange.
Just a too old patch, partially updated by script.

>
> >      /* Call user paint hook if enable */
> >      if (pda->dlga->Flags & PSD_ENABLEPAGEPAINTHOOK)
> > -        if (pda->dlga->lpfnPagePaintHook(hwndDlg, uMsg, wParam, lParam))
> > +        if (pda->dlga->lpfnPagePaintHook &&
> > pda->dlga->lpfnPagePaintHook(hwndDlg, uMsg, wParam, lParam))
>
> You have to add the checks existing in PageSetupDlgA to PageSetupDlgW
> instead.
Instead or also?
I guess, this check is needed in this place in any way.

> Also, in order to increase the probability of your patches to be included
> should either point to existing bug that each of your patches fix, or/and
> add a test case which doesn't pass without your patch and does with it.
I do not know  a way to check print dialogs without installed printer drivers 
in the system/wine.


-- 
Vitaly Lipatov, ALT Linux Team
Russia, Saint-Petersburg, www.etersoft.ru


From dank at kegel.com  Sun Dec  9 08:38:47 2007
From: dank at kegel.com (Dan Kegel)
Date: Sun, 9 Dec 2007 06:38:47 -0800
Subject: speeding up regression testing by disabling building of tests?
In-Reply-To: <475BBFE5.1080103@codeweavers.com>
References: <a71bd89a0712082114ge31b370i148cd53801ee8d96@mail.gmail.com>
	<475BBFE5.1080103@codeweavers.com>
Message-ID: <a71bd89a0712090638p178e5d94n23c85bf4f122a161@mail.gmail.com>

On Dec 9, 2007 2:13 AM, Maarten Lankhorst <maarten at codeweavers.com> wrote:
> Try my hack:
> http://repo.or.cz/w/wine/hacks.git?a=commit;h=df41d984eafa372547b9aa5ae80a3adff5f8efb7
>
> You need to do autoconf after applying, then build with configure
> --disable-tests. I still wish alexandre would accept this into the main
> tree. :-/

Next best thing: you could document it at
http://wiki.winehq.org/RegressionTesting
- Dan


From dmitry at codeweavers.com  Sun Dec  9 08:51:39 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sun, 9 Dec 2007 22:51:39 +0800
Subject: [PATCH 3/6] COMDLG32: printdlg: check hook pointer (resend 3)
References: <200712091327.52194.lav@etersoft.ru><00ae01c83a6d$379161a0$a600fea9@DMITRY>
	<200712091735.05445.lav@etersoft.ru>
Message-ID: <00dd01c83a73$02d40ac0$a600fea9@DMITRY>

"Vitaly Lipatov" <lav at etersoft.ru> wrote:

>> > --- dlls/commdlg/printdlg.c 11 Jan 2006 11:37:03 -0000 1.100
>> > +++ dlls/comdlg32/printdlg.c 24 Feb 2006 17:47:53 -0000
>>
>> The way you've generated this patch looks pretty strange.
> Just a too old patch, partially updated by script.

Looking at the file dates that doesn't sound plausibly. The patches
are supposed not just to be applied, but also tested with current
git sources.

>> >      /* Call user paint hook if enable */
>> >      if (pda->dlga->Flags & PSD_ENABLEPAGEPAINTHOOK)
>> > -        if (pda->dlga->lpfnPagePaintHook(hwndDlg, uMsg, wParam, lParam))
>> > +        if (pda->dlga->lpfnPagePaintHook &&
>> > pda->dlga->lpfnPagePaintHook(hwndDlg, uMsg, wParam, lParam))
>>
>> You have to add the checks existing in PageSetupDlgA to PageSetupDlgW
>> instead.
> Instead or also?
> I guess, this check is needed in this place in any way.

No.

>> Also, in order to increase the probability of your patches to be included
>> should either point to existing bug that each of your patches fix, or/and
>> add a test case which doesn't pass without your patch and does with it.
> I do not know  a way to check print dialogs without installed printer drivers 
> in the system/wine.

That's a relatively rare case which is simply to avoid. Have a look at
the existing tests how they test printing functionality. In any case
having a bug report or posting a backtrace (you are trying to fix a crash,
right?) would help.

-- 
Dmitry.


From stefan at codeweavers.com  Sun Dec  9 09:54:44 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sun, 9 Dec 2007 16:54:44 +0100
Subject: [press] Phoronix compares 7 versions of Wine
In-Reply-To: <1197205833.6197.3.camel@jernst-desktop>
References: <1197205659.6197.2.camel@jernst-desktop>
	<1197205833.6197.3.camel@jernst-desktop>
Message-ID: <200712091654.46855.stefan@codeweavers.com>

Am Sonntag, 9. Dezember 2007 14:10:33 schrieb Jonathan Ernst:
> On dim, 2007-12-09 at 14:07 +0100, Jonathan Ernst wrote:
> > Hello,
> >
> > What do you think about their tests and results ?
> >
> > http://www.phoronix.com/vr.php?view=11539
>
> I guess it's linked with http://bugs.winehq.org/show_bug.cgi?id=10631
No, it doesn't look like they are hit by the 3dmark2k1 bug, which is strange. 
They are hit by the stencil test slowness in 3dmark2k3 though, which we 
resolved as a driver bug on geforce 8 cards, since we couldn't reproduce it 
elsewhere.

I didn't find any info what card they used, so it is a bit hard to say what 
might be wrong.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071209/332629d0/attachment.pgp 

From alexd4 at inbox.lv  Sun Dec  9 20:20:15 2007
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Sun, 09 Dec 2007 18:20:15 -0800
Subject: GetMessage related Jagged Alliance 2 regression
In-Reply-To: <87hcivbpi0.fsf@wine.dyndns.org>
References: <4758D0D6.2000407@inbox.lv> <87hcivbpi0.fsf@wine.dyndns.org>
Message-ID: <475CA25F.8090509@inbox.lv>

Hello.

Is there a reason this fix you sent didn't make it to git yet? I think I 
accidentally replied to author only when previously answering, so in case it was 
something unexpected and got lost somehow I'm resending to wine-devel too.

The patch works fine for me, I've played JA2 with this patch applied for a 
substantial time, no problems noticed. Sorry for the noise, if you've already 
seen it.

Alexandre Julliard wrote:
> Alexander Dorofeyev <alexd4 at inbox.lv> writes:
> 
>> I'm not sure what would be a proper fix, although I did find out that commenting 
>> out this line in peek_message()
>>
>> if (HIWORD(flags)) flags = PM_QS_SENDMESSAGE | LOWORD(flags);
>>
>> makes the game playable. Maybe this clearing of PM_QS_* flags shouldn't be done 
>> in case when the message gets dropped? Before that commit nothing was passed in 
>> flags high word, which is probably why this problem wasn't happening.
> 
> Does this help?
> 
> diff --git a/dlls/user32/message.c b/dlls/user32/message.c
> index 53d1c1d..d3f4a3a 100644
> --- a/dlls/user32/message.c
> +++ b/dlls/user32/message.c
> @@ -2173,11 +2173,11 @@ static BOOL peek_message( MSG *msg, HWND hwnd, UINT first, UINT last, UINT flags
>                                     WMCHAR_MAP_RECVMESSAGE );
>          reply_message( &info, result, TRUE );
>          thread_info->receive_info = old_info;
> -    next:
> -        HeapFree( GetProcessHeap(), 0, buffer );
>  
>          /* if some PM_QS* flags were specified, only handle sent messages from now on */
>          if (HIWORD(flags)) flags = PM_QS_SENDMESSAGE | LOWORD(flags);
> +    next:
> +        HeapFree( GetProcessHeap(), 0, buffer );
>      }
>  }
>  
> 



From juan.lang at gmail.com  Sun Dec  9 10:38:34 2007
From: juan.lang at gmail.com (Juan Lang)
Date: Sun, 9 Dec 2007 08:38:34 -0800
Subject: Read Application Memory
In-Reply-To: <1197207347.6582.19.camel@yoku>
References: <1197207347.6582.19.camel@yoku>
Message-ID: <3a768c550712090838k2c1f2ebfq41e7c44d4e78468a@mail.gmail.com>

> at the moment I'm writing a little Linux based program to read some
> variables from a Windows application. But my problem is, that i can't
> access to the virtual memory of the Win App running under wine. I don't
> know how to do this. c/c++ isn't the problem but the right way to do it.

ReadProcessMemory?  You can only call that from a winelib app (or
another windows executable), so if your app can't be a winelib app,
you might have to resort to the usual trick:  create a winelib app
that does what you want, and connect to it via a socket.

--Juan


From truiken at gmail.com  Sun Dec  9 12:35:29 2007
From: truiken at gmail.com (James Hawkins)
Date: Sun, 9 Dec 2007 12:35:29 -0600
Subject: msi: fix memory leaks (found by Smatch).
In-Reply-To: <475BC701.4090807@yahoo.fr>
References: <475BC701.4090807@yahoo.fr>
Message-ID: <22821af30712091035o2c2b6813r3008bd39b3b917b9@mail.gmail.com>

On Dec 9, 2007 4:44 AM, Lionel_Debroux <lionel_debroux at yahoo.fr> wrote:
> "msi_build_insertsql_data" and "MSI_DatabaseImport" in
> dlls/msi/database.c get flagged by Michael Stefaniuc's unfree-wine.pl
> script.
>
> It looks there are more leaks than unfree-wine.pl reports, due to
> constructs of the form
> ptr = msi_realloc(ptr, size);
> Fixed those as well.
>
> 2007-12-09  Lionel Debroux <lionel_debroux at yahoo.fr>
>         * dlls/msi/database.c:
>         msi: fix memory leaks (found by Smatch).
>

-        columns = msi_realloc(columns, sql_size * sizeof(WCHAR));
-        if (!columns)
+        temp_columns = msi_realloc(columns, sql_size * sizeof(WCHAR));
+        if (!temp_columns)
+        {
+            HeapFree( GetProcessHeap(), 0, columns);
             return NULL;
+        }

         lstrcatW(columns, expanded);


This is wrong.  There's no guarantee that realloc returns the same
position in memory.

-- 
James Hawkins


From truiken at gmail.com  Sun Dec  9 12:39:53 2007
From: truiken at gmail.com (James Hawkins)
Date: Sun, 9 Dec 2007 12:39:53 -0600
Subject: msi: fix missing alloc check.
In-Reply-To: <475BCAE7.5070100@yahoo.fr>
References: <475BCAE7.5070100@yahoo.fr>
Message-ID: <22821af30712091039q6c3e6b41w50ff01ceb9d99d3@mail.gmail.com>

On Dec 9, 2007 5:00 AM, Lionel_Debroux <lionel_debroux at yahoo.fr> wrote:
> "msi_dialog_list_box" in dlls/msi/dialog.c gets flagged by Michael
> Stefaniuc's unfree-wine.pl script.
>
> * As far as I can see, "info", allocated line 2203, is not used before
> the return that leaks it (line 2214), neither in a direct nor an
> indirect (macro) way. But maybe the "fail-fast" behaviour is intended
> (because if allocation of "info" fails, there are chances the allocation
> of "control" would fail, too) ?
> * While looking at the source of the functions called by
> "msi_dialog_list_box" to make sure they didn't use "info", I spotted a
> call to msi_alloc, whose result is not checked. Therefore, the
> subsequent lines may write to NULL+some_offset.
>
> The patch contains only the fix for the latter problem, because I'm not
> 100% sure that the memory leak can be solved by moving the allocation of
> info after the call to "msi_dialog_add_control", without ill side
> effects (e.g. msi_dialog_add_control calls msi_dialog_create_window,
> which calls CreateWindowExW).
>
>
> 2007-12-09  Lionel Debroux <lionel_debroux at yahoo.fr>
>         * dlls/msi/dialog.c:
>         msi: fix missing alloc check.
>

+    if (control)
+    {
+        strcpyW( control->name, name );

Just check if control is NULL, and if so, return NULL.  There's no
need to add a whole extra level of indentation.

-- 
James Hawkins


From kingofallhearts999 at gmail.com  Sun Dec  9 13:24:10 2007
From: kingofallhearts999 at gmail.com (Bryan Haskins)
Date: Sun, 9 Dec 2007 14:24:10 -0500
Subject: [press] Phoronix compares 7 versions of Wine
In-Reply-To: <200712091654.46855.stefan@codeweavers.com>
References: <1197205659.6197.2.camel@jernst-desktop>
	<1197205833.6197.3.camel@jernst-desktop>
	<200712091654.46855.stefan@codeweavers.com>
Message-ID: <f85ab1ea0712091124v610375d2m166da21b6ae448e2@mail.gmail.com>

Phoronix often uses the 8 series cards when not testing things like driver
versions, we can probably assume they did use an 8 series.

On Dec 9, 2007 10:54 AM, Stefan D?singer <stefan at codeweavers.com> wrote:

> Am Sonntag, 9. Dezember 2007 14:10:33 schrieb Jonathan Ernst:
> > On dim, 2007-12-09 at 14:07 +0100, Jonathan Ernst wrote:
> > > Hello,
> > >
> > > What do you think about their tests and results ?
> > >
> > > http://www.phoronix.com/vr.php?view=11539
> >
> > I guess it's linked with http://bugs.winehq.org/show_bug.cgi?id=10631
> No, it doesn't look like they are hit by the 3dmark2k1 bug, which is
> strange.
> They are hit by the stencil test slowness in 3dmark2k3 though, which we
> resolved as a driver bug on geforce 8 cards, since we couldn't reproduce
> it
> elsewhere.
>
> I didn't find any info what card they used, so it is a bit hard to say
> what
> might be wrong.
>
>
>
>


-- 
Cheers,
Bryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20071209/7a3eb1fa/attachment.htm 

From lionel_debroux at yahoo.fr  Sun Dec  9 13:20:23 2007
From: lionel_debroux at yahoo.fr (Lionel_Debroux)
Date: Sun, 09 Dec 2007 20:20:23 +0100
Subject: msi: fix missing alloc check [try 2]
Message-ID: <475C3FF7.7000102@yahoo.fr>

Removed a level of indentation, following feedback of James Hawkins.

2007-12-09  Lionel Debroux <lionel_debroux at yahoo.fr>
        * dlls/msi/dialog.c:
        msi: fix missing alloc check.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0003-msi-fix-missing-alloc-check.patch
Type: text/x-diff
Size: 0 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071209/9c1d9d07/attachment.patch 

From lionel_debroux at yahoo.fr  Sun Dec  9 13:14:47 2007
From: lionel_debroux at yahoo.fr (Lionel Debroux)
Date: Sun, 9 Dec 2007 20:14:47 +0100
Subject: msi: fix missing alloc check.
Message-ID: <mailman.86.1197228441.6275.wine-devel@winehq.org>

---
 dlls/msi/dialog.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/dlls/msi/dialog.c b/dlls/msi/dialog.c
index d0e91cd..a838adb 100644
--- a/dlls/msi/dialog.c
+++ b/dlls/msi/dialog.c
@@ -409,6 +409,11 @@ static msi_control *msi_dialog_create_window( msi_dialog *dialog,
     style |= WS_CHILD;
 
     control = msi_alloc( sizeof *control + strlenW(name)*sizeof(WCHAR) );
+    if (!control)
+    {
+        return NULL;
+    }
+
     strcpyW( control->name, name );
     list_add_head( &dialog->controls, &control->entry );
     control->handler = NULL;
-- 
1.5.3.4


--------------050809050104020807030800--


From lionel_debroux at yahoo.fr  Sun Dec  9 13:18:51 2007
From: lionel_debroux at yahoo.fr (Lionel_Debroux)
Date: Sun, 09 Dec 2007 20:18:51 +0100
Subject: msi: fix memory leaks (found by Smatch) [try 2]
Message-ID: <475C3F9B.6030600@yahoo.fr>

Fixed stupid mistake pointed by James Hawkins.

2007-12-09  Lionel Debroux <lionel_debroux at yahoo.fr>
        * dlls/msi/database.c:
        msi: fix memory leaks (found by Smatch).

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0002-msi-fix-memory-leaks-found-by-Smatch.patch
Type: text/x-diff
Size: 0 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071209/662a004f/attachment.patch 

From lionel_debroux at yahoo.fr  Sun Dec  9 12:54:14 2007
From: lionel_debroux at yahoo.fr (Lionel Debroux)
Date: Sun, 9 Dec 2007 19:54:14 +0100
Subject: msi: fix memory leaks (found by Smatch).
Message-ID: <mailman.88.1197232832.6275.wine-devel@winehq.org>

---
 dlls/msi/database.c |   27 ++++++++++++++++++++-------
 1 files changed, 20 insertions(+), 7 deletions(-)

diff --git a/dlls/msi/database.c b/dlls/msi/database.c
index f4ed1d7..a690ee4 100644
--- a/dlls/msi/database.c
+++ b/dlls/msi/database.c
@@ -552,7 +552,7 @@ static LPWSTR msi_build_insertsql_columns(LPWSTR *columns_data, LPWSTR *types, D
 
 static LPWSTR msi_build_insertsql_data(LPWSTR **records, LPWSTR *types, DWORD num_columns, DWORD irec)
 {
-    LPWSTR columns;
+    LPWSTR columns, temp_columns;
     DWORD sql_size = 1, i;
     WCHAR expanded[128];
 
@@ -578,6 +578,7 @@ static LPWSTR msi_build_insertsql_data(LPWSTR **records, LPWSTR *types, DWORD nu
                     lstrcpyW(expanded, empty);
                 break;
             default:
+                HeapFree( GetProcessHeap(), 0, columns );
                 return NULL;
         }
 
@@ -585,9 +586,13 @@ static LPWSTR msi_build_insertsql_data(LPWSTR **records, LPWSTR *types, DWORD nu
             expanded[lstrlenW(expanded) - 2] = '\0';
 
         sql_size += lstrlenW(expanded);
-        columns = msi_realloc(columns, sql_size * sizeof(WCHAR));
-        if (!columns)
+        temp_columns = msi_realloc(columns, sql_size * sizeof(WCHAR));
+        if (!temp_columns)
+        {
+            HeapFree( GetProcessHeap(), 0, columns);
             return NULL;
+        }
+        columns = temp_columns;
 
         lstrcatW(columns, expanded);
     }
@@ -654,6 +659,7 @@ UINT MSI_DatabaseImport(MSIDATABASE *db, LPCWSTR folder, LPCWSTR file)
     LPWSTR *columns, *types, *labels;
     LPWSTR path, ptr, data;
     LPWSTR **records;
+    LPWSTR **temp_records;
 
     static const WCHAR backslash[] = {'\\',0};
 
@@ -680,7 +686,10 @@ UINT MSI_DatabaseImport(MSIDATABASE *db, LPCWSTR folder, LPCWSTR file)
 
     records = msi_alloc(sizeof(LPWSTR *));
     if (!records)
-        return ERROR_OUTOFMEMORY;
+    {
+        r = ERROR_OUTOFMEMORY;
+        goto done;
+    }
 
     /* read in the table records */
     while (*ptr)
@@ -688,9 +697,13 @@ UINT MSI_DatabaseImport(MSIDATABASE *db, LPCWSTR folder, LPCWSTR file)
         msi_parse_line( &ptr, &records[num_records], NULL );
 
         num_records++;
-        records = msi_realloc(records, (num_records + 1) * sizeof(LPWSTR *));
-        if (!records)
-            return ERROR_OUTOFMEMORY;
+        temp_records = msi_realloc(records, (num_records + 1) * sizeof(LPWSTR *));
+        if (!temp_records)
+        {
+            r = ERROR_OUTOFMEMORY;
+            goto done;
+        }
+        records = temp_records;
     }
 
     r = msi_add_table_to_db( db, columns, types, labels, num_labels, num_columns );
-- 
1.5.3.4


--------------000806000604010304050104--


From austinenglish at gmail.com  Sun Dec  9 17:52:03 2007
From: austinenglish at gmail.com (Austin English)
Date: Sun, 9 Dec 2007 17:52:03 -0600
Subject: ALLUSERSPROFILE Patch
Message-ID: <b6bb06270712091552o4b92d67eoc2f24faed1c92898@mail.gmail.com>

While looking at bug 7292
(http://bugs.winehq.org/show_bug.cgi?id=7292) I wrote a patch to
implement ALLUSERSPROFILE. I looked on MSDN/Google for the dirid for
this shell folder, but can only find dirids for it's subdirectories.
For example:
16406 	All Users\Start Menu
16407 	All Users\Start Menu\Programs
16408 	All Users\Start Menu\Programs\Startup
16409 	All Users\Desktop
16415 	All Users\Favorites
16419 	All Users\Application Data

Looking for an opinion on which would be better, to map ALLUSERSPROFILE to
%10%\profiles\All Users
(This is how my current patch does it)

Or I could continue looking for the windows implementation of it,
which so far hasn't proven very fruitful.

Patch is attached.
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ADD_ALLUSERSPROFILE.txt
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20071209/4b05b86c/attachment.txt 

From wine-devel at kievinfo.com  Sun Dec  9 18:29:27 2007
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sun, 09 Dec 2007 17:29:27 -0700
Subject: ALLUSERSPROFILE Patch
In-Reply-To: <b6bb06270712091552o4b92d67eoc2f24faed1c92898@mail.gmail.com>
References: <b6bb06270712091552o4b92d67eoc2f24faed1c92898@mail.gmail.com>
Message-ID: <475C8867.5090008@kievinfo.com>

I wonder how is this different from: 
http://www.winehq.org/pipermail/wine-patches/2007-May/038805.html

And what AJ replied to it:
http://www.winehq.org/pipermail/wine-devel/2007-May/056555.html

Vitaliy.

Austin English wrote:
> While looking at bug 7292
> (http://bugs.winehq.org/show_bug.cgi?id=7292) I wrote a patch to
> implement ALLUSERSPROFILE. I looked on MSDN/Google for the dirid for
> this shell folder, but can only find dirids for it's subdirectories.
> For example:
> 16406 	All Users\Start Menu
> 16407 	All Users\Start Menu\Programs
> 16408 	All Users\Start Menu\Programs\Startup
> 16409 	All Users\Desktop
> 16415 	All Users\Favorites
> 16419 	All Users\Application Data
> 
> Looking for an opinion on which would be better, to map ALLUSERSPROFILE to
> %10%\profiles\All Users
> (This is how my current patch does it)
> 
> Or I could continue looking for the windows implementation of it,
> which so far hasn't proven very fruitful.
> 
> Patch is attached.
> 
> 
> ------------------------------------------------------------------------
> 
> 



From mclark4386 at charter.net  Sun Dec  9 22:51:18 2007
From: mclark4386 at charter.net (Matthew Clark)
Date: Sun, 09 Dec 2007 22:51:18 -0600
Subject: [press] Phoronix compares 7 versions of Wine
In-Reply-To: <f85ab1ea0712091124v610375d2m166da21b6ae448e2@mail.gmail.com>
References: <1197205659.6197.2.camel@jernst-desktop>	<1197205833.6197.3.camel@jernst-desktop>	<200712091654.46855.stefan@codeweavers.com>
	<f85ab1ea0712091124v610375d2m166da21b6ae448e2@mail.gmail.com>
Message-ID: <475CC5C6.9090705@charter.net>

I want to say it said somewhere that it was a 8600 that they used... 
pretty sure

Bryan Haskins wrote:
> Phoronix often uses the 8 series cards when not testing things like 
> driver versions, we can probably assume they did use an 8 series.
>
> On Dec 9, 2007 10:54 AM, Stefan D?singer < stefan at codeweavers.com 
> <mailto:stefan at codeweavers.com>> wrote:
>
>     Am Sonntag, 9. Dezember 2007 14:10:33 schrieb Jonathan Ernst:
>     > On dim, 2007-12-09 at 14:07 +0100, Jonathan Ernst wrote:
>     > > Hello,
>     > >
>     > > What do you think about their tests and results ?
>     > >
>     > > http://www.phoronix.com/vr.php?view=11539
>     >
>     > I guess it's linked with
>     http://bugs.winehq.org/show_bug.cgi?id=10631
>     No, it doesn't look like they are hit by the 3dmark2k1 bug, which
>     is strange.
>     They are hit by the stencil test slowness in 3dmark2k3 though,
>     which we
>     resolved as a driver bug on geforce 8 cards, since we couldn't
>     reproduce it
>     elsewhere.
>
>     I didn't find any info what card they used, so it is a bit hard to
>     say what
>     might be wrong.
>
>
>
>
>
>
> -- 
> Cheers,
> Bryan
> ------------------------------------------------------------------------
>
>
>   



From stefan at codeweavers.com  Mon Dec 10 01:39:07 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Mon, 10 Dec 2007 08:39:07 +0100
Subject: wined3d: improve thread safety in IWineD3DSurfaceImpl_BltOverride
In-Reply-To: <475D2587.9060700@inbox.lv>
References: <475D2587.9060700@inbox.lv>
Message-ID: <200712100839.10093.stefan@codeweavers.com>

Am Montag, 10. Dezember 2007 12:39:51 schrieb Alexander Dorofeyev:
> Fixes crash in Aliens vs Predator 2 loading screen (bug # 4513
> http://bugs.winehq.org/show_bug.cgi?id=4513).
>
> ---
>    dlls/wined3d/surface.c |    5 +++++
>    1 files changed, 5 insertions(+), 0 deletions(-)
Looks good to me
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071210/25e01c3e/attachment-0001.pgp 

From alexd4 at inbox.lv  Mon Dec 10 11:39:49 2007
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Mon, 10 Dec 2007 09:39:49 -0800
Subject: ENTER_GL and ActivateContext question
Message-ID: <475D79E5.4010706@inbox.lv>

Hello.

I was recently experimenting with a fix that involved ActivateContext and needed 
  to figure out whether it is ok if ActivateContext is called inside 
ENTER_GL()... LEAVE_GL() (also if recursive ENTER_GL is ok). At first I tried to 
look for example code in wined3d/surface.c, which seemed to indicate this is ok, 
because it obviously seems to happen in one or few places. Then I found this

http://bugs.winehq.org/show_bug.cgi?id=9810

from which it seems it is sort of a bug(?). Can any of 3d guys here clarify this 
matter - how bad is ActivateContext between ENTER_GL/LEAVE_GL and recursive 
ENTER_GL, does it definitely need to be avoided and should things like this

     ENTER_GL();
     ...
     IWineD3DSurface_BindTexture();
     ...
     LEAVE_GL();

(BindTexture does ActivateContext and ENTER_GL)

be changed to something like

ENTER_GL()
...
LEAVE_GL()

IWineD3DSurface_BindTexture();

ENTER_GL()
...
LEAVE_GL()

and submitted as patch if I find it?


From may.gilles at mindgate.lu  Fri Dec  7 08:41:04 2007
From: may.gilles at mindgate.lu (Gilles May)
Date: Fri, 07 Dec 2007 15:41:04 +0100
Subject: File a bug report?
Message-ID: <47595B80.5020403@mindgate.lu>

Hi everybody.

After updating WINE to from 0.9.49 to 0.9.50 I noticed major slowdown in
Company of Heroes, to the point that I get like 1 Frame every 2 seconds.
Wine spams the console with:

fixme:d3d_shader:IWineD3DVertexShaderImpl_CompileShader Vertexshader
0x4d20b78 recompiled more than 50 times

Trying to find out the cause for the slowdown I did my first attempt at
using git bisect and I could trace the slowdown to this patch:

959212304dfaf0e7459374593b20b74fe22a0b57 is first bad commit
commit 959212304dfaf0e7459374593b20b74fe22a0b57
Author: Stefan D?singer <stefan at codeweavers.com>
Date:   Tue Nov 20 21:14:10 2007 +0100

    wined3d: Track vertex declaration changes on vertex shaders.
   
    If an attribute has type D3DDECLTYPE_D3DCOLOR, the red and blue channels
    are swizzled in the shader. Since the attribute is stored in the vertex
    declaration and not the vertex shader, it can change by setting a new
    vertex declaration. If this happens, we have to recompile the shader
    with the swizzling of that specific attribute turned on or off.

:040000 040000 327661a4d0f8a02bdc18380084589c891b64af9c
e35a2bcbf9514e4f261d8b7a93dcb24c0b3c89a7 M      dlls

Now without that patch there is slight texture corruption in the game,
with the patch it's much much less but it renders the game unplayable.
The reason I didn't file a bug report is that I am not sure if it is
really a bug or not since obviously the patch fixes in-game texture
corruption.

Regards, Gilles



From jc.gervais at videotron.ca  Fri Dec  7 14:03:28 2007
From: jc.gervais at videotron.ca (Jean-Claude Gervais)
Date: Fri, 07 Dec 2007 15:03:28 -0500
Subject: [Wine] TortoiseCVS- Unimplemented functions in ntdll.dll	causes
	program to terminate.
In-Reply-To: <47589849.4040305@sprintpcs.com>
References: <1196979295.24984.42.camel@mercury.sprymusic>
	<b6bb06270712061421w6ccfba59md8593992028be704@mail.gmail.com>
	<1196985257.24984.51.camel@mercury.sprymusic>
	<47589849.4040305@sprintpcs.com>
Message-ID: <1197057808.23140.16.camel@mercury.sprymusic>


On Thu, 2007-12-06 at 17:48 -0700, James McKenzie wrote:
> As others have stated here, please file a bug against ntdll.dll and name
> your program as the source of
> the problem.  It may be possible to get your program to run with a
> minimum of effort, but this may

Thanks James,

http://bugs.winehq.org/show_bug.cgi?id=10706




From m.bosner at c-t-b.info  Sat Dec  8 04:41:00 2007
From: m.bosner at c-t-b.info (Martin Bosner)
Date: Sat, 8 Dec 2007 11:41:00 +0100
Subject: GetMessage related Jagged Alliance 2 regression
In-Reply-To: <4758D0D6.2000407@inbox.lv>
References: <4758D0D6.2000407@inbox.lv>
Message-ID: <200712081141.00828.m.bosner@c-t-b.info>

On Friday 07 December 2007 05:49:26 Alexander Dorofeyev wrote:
> Hello.
>
> I get freezes in Jagged Alliance 2 (seems to be tied to moving the mouse).
> It used to work in older versions. The game doesn't lock up totally (the
> music and sounds continue to play normally, for example), but the screen
> doesn't redraw and it doesn't respond to input. Activating some other
> window than the game window (if it's not full screen) usually unfreezes it.
>
> Bisect pointed to this change:
>
> http://source.winehq.org/git/wine.git/?a=commitdiff;h=2896540a34a18b8aff848
>d728308c5811cdd122a
>
> server: Set the queue mask directly in get_message to avoid an extra server
> call.
>
> I did a bit of debugging and it looks like the game is getting stuck within
> a GetMessageW call. It stays in that while loop in GetMessage, mostly in
> MsgWaitForMultipleObjectsEx. If the mouse is moved, then it awakes, gets to
> PeekMessageW, from there it goes to peek_message which returns false and so
> PeekMessageW returns false and the game goes back to waiting within
> GetMessageW.
>
> peek_message returns false, because in a first call to server it gets a
> MSG_HARDWARE (mouse) message which it drops for some reason, then it clears
> PM_QS_ flags and so in a next call to server it can't get a WM_TIMER
> message despite an expired timer seems to be ready in the queue.
>
> I'm not sure what would be a proper fix, although I did find out that
> commenting out this line in peek_message()
>
> if (HIWORD(flags)) flags = PM_QS_SENDMESSAGE | LOWORD(flags);
>
> makes the game playable. Maybe this clearing of PM_QS_* flags shouldn't be
> done in case when the message gets dropped? Before that commit nothing was
> passed in flags high word, which is probably why this problem wasn't
> happening.
I just wanted to say that that JA2 is the most unstable windows game i ever 
played (on windows XP!). JA2 crashing is a 100% natural Windows behaviour. 
Most times it just became unresponsive and the music was still playing in the 
background...

Martin



From gerald at pfeifer.com  Sat Dec  8 08:14:10 2007
From: gerald at pfeifer.com (Gerald Pfeifer)
Date: Sat, 8 Dec 2007 15:14:10 +0100 (CET)
Subject: dlls/comctl32/listview.c warning elimination
In-Reply-To: <Pine.LNX.4.64.0711041921400.26054@acrux.dbai.tuwien.ac.at>
References: <Pine.LNX.4.64.0710281356520.26054@acrux.dbai.tuwien.ac.at>
	<87ejfenk7y.fsf@wine.dyndns.org>
	<Pine.LNX.4.64.0711041921400.26054@acrux.dbai.tuwien.ac.at>
Message-ID: <Pine.LNX.4.64.0712081512400.29138@acrux.dbai.tuwien.ac.at>

On Sun, 4 Nov 2007, Gerald Pfeifer wrote:
> The only patch I can think of that avoid *both* warnings is the one
> below.  Not perfect, but I fair compromise.  What do you think?  Or
> do you have any better idea that we might want to try?

For the record, your fix that you committed yesterday certainly looks 
simpler.  A few cycles longer, but that isn't a performance critical path.

Gerald


From sonia.xapelli at ilidium.com  Sat Dec  8 13:42:05 2007
From: sonia.xapelli at ilidium.com (=?ISO-8859-1?Q?S=F2nia_Xapell=ED_Br=FA?=)
Date: Sat, 08 Dec 2007 20:42:05 +0100
Subject: directX 10 and hlsl2glsl
Message-ID: <475AF38D.6050006@ilidium.com>

 I know there was some discussion concerning the use of hlsl2glsl and 
that it is not directly useful as it seems that the conversion to 
assembler is necessary in d3d9. Nevertheless, when it comes to 
d3d10,Shader Model 4 relies only  in source code and forbids the 
programmers from implementing directly the assembler tokens. Therefore, 
I think that in this case the best solution, maximising the use of the 
graphic card capabilities goes mandatory to the use of the trasnlator 
and leaving up to the graphic card driver the compilation of GLSL.

What do you think?


From lauterbach.kai at web.de  Sun Dec  9 06:58:53 2007
From: lauterbach.kai at web.de (Kai Lauterbach)
Date: Sun, 09 Dec 2007 13:58:53 +0100
Subject: Read RAM from Process
Message-ID: <1197205134.6582.14.camel@yoku>

Hi,

at the moment I'm writing a little Linux based program to read some
variables from a Windows application. But my problem is, that i can't
access to the virtual memory of the Win App running under wine. I don't
know how to do this. c/c++ isn't the problem but the right way to do it.

I've already read the wineserver's main.c and fd.c but I think that it's
not a good way to put a code into, which give's me the chance to read
something. I need sth to connect, like /dev/mem or a network port.

My second idea was the wine debugger. Is it possible to get access the
application memory at runtime from this? I mean, without stopping the
application?

I hope you can help me and I've described my problem as clear as
possible ;)

Greetings,
Kai

-- 
Kai Lauterbach <lauterbach.kai at web.de>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: Dies ist ein digital signierter Nachrichtenteil
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071209/668f53e0/attachment.pgp 

From klaute at web.de  Sun Dec  9 07:07:35 2007
From: klaute at web.de (Kai Lauterbach)
Date: Sun, 09 Dec 2007 14:07:35 +0100
Subject: Read Application Memory
Message-ID: <1197205655.6582.17.camel@yoku>

Hi,

at the moment I'm writing a little Linux based program to read some
variables from a Windows application. But my problem is, that i can't
access to the virtual memory of the Win App running under wine. I don't
know how to do this. c/c++ isn't the problem but the right way to do it.

I've already read the wineserver's main.c and fd.c but I think that it's
not a good way to put a code into, which give's me the chance to read
something. I need sth to connect, like /dev/mem or a network port.

My second idea was the wine debugger. Is it possible to get access the
application memory at runtime from this? I mean, without stopping the
application?

I hope you can help me and I've described my problem as clear as
possible ;)

Greetings,
Kai

-- 
Kai Lauterbach <klaute at web.de>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: Dies ist ein digital signierter Nachrichtenteil
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071209/87fb5b74/attachment.pgp 

From stefandoesinger at gmx.at  Mon Dec 10 01:53:18 2007
From: stefandoesinger at gmx.at (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Mon, 10 Dec 2007 08:53:18 +0100
Subject: ENTER_GL and ActivateContext question
In-Reply-To: <475D79E5.4010706@inbox.lv>
References: <475D79E5.4010706@inbox.lv>
Message-ID: <200712100853.22116.stefandoesinger@gmx.at>

Am Montag, 10. Dezember 2007 18:39:49 schrieb Alexander Dorofeyev:
> Hello.
>
> I was recently experimenting with a fix that involved ActivateContext and
> needed to figure out whether it is ok if ActivateContext is called inside
> ENTER_GL()... LEAVE_GL() (also if recursive ENTER_GL is ok). At first I
> tried to look for example code in wined3d/surface.c, which seemed to
> indicate this is ok, because it obviously seems to happen in one or few
> places. Then I found this
ActivateContext inside ENTER_GL() and LEAVE_GL() is *not* ok, but it happens 
in quite a few places unfortunately. The problem this causes is stated in 
this bugreport. ActivateContext can call GDI calls, and they can deadlock if 
called between ENTER_GL and LEAVE_GL.

The example with BindTexture you gave is the main problem indeed, patches like 
that are a way forward. However, instead of just adding a LEAVE_GL() and 
ENTER_GL() it should be checked if this can be avoided by moving code around 
a bit. Be warned that there are a few other troubles with ActivateContext and 
gl calls as well, for example fbo setup vs ActivateContext
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071210/bf88cd75/attachment.pgp 

From marcus at jet.franken.de  Mon Dec 10 01:55:14 2007
From: marcus at jet.franken.de (Marcus Meissner)
Date: Mon, 10 Dec 2007 08:55:14 +0100
Subject: Read RAM from Process
In-Reply-To: <1197205134.6582.14.camel@yoku>
References: <1197205134.6582.14.camel@yoku>
Message-ID: <20071210075514.GA21955@galeere>

On Sun, Dec 09, 2007 at 01:58:53PM +0100, Kai Lauterbach wrote:
> Hi,
> 
> at the moment I'm writing a little Linux based program to read some
> variables from a Windows application. But my problem is, that i can't
> access to the virtual memory of the Win App running under wine. I don't
> know how to do this. c/c++ isn't the problem but the right way to do it.
> 
> I've already read the wineserver's main.c and fd.c but I think that it's
> not a good way to put a code into, which give's me the chance to read
> something. I need sth to connect, like /dev/mem or a network port.
> 
> My second idea was the wine debugger. Is it possible to get access the
> application memory at runtime from this? I mean, without stopping the
> application?
> 
> I hope you can help me and I've described my problem as clear as
> possible ;)

It will not help to repost the same question several times with
differetn subjects.

Reading other process memory in Linux is done using the ptrace()
function. Its use is a bit difficult, but there is a nice manpage.

You could also make your application a Wine app and then use the
NtReadVirtualMemory() or ReadProcessMemory() functions on the other
process (after finding it via toolhelp32).

Ciao, Marcus


From luis.busquets at ilidium.com  Mon Dec 10 02:24:14 2007
From: luis.busquets at ilidium.com (luis.busquets at ilidium.com)
Date: Mon, 10 Dec 2007 09:24:14 +0100 (CET)
Subject: hlsl2glsl
Message-ID: <25721.158.169.131.14.1197275054.squirrel@www.ilidium.com>

hlsl2glsl is the good solution for implementing shaders on directX 10.
Nevertheless, the hlsl compilation to tokens has to be done for d3d9. On
the other hand, if we implement d3dx9_xx, it is likely that the
application will be using the compile D3DX9CompileShader to get the
tokens. Currently it works and we can use the libraries d3dx9_xx and get
good results but the following tranfosmations:
1. HLSL is compiled to tokens
2. Tokens are transformed to GLSL.
I think that a good addition if the d3dx9_xx libraries are going to be
implemented is to put a resource in wined3d that would let know which
source HLSL code the tokens are meant to be and add the capability to
instead of transform tokens to GLSL, to let wine know which is the HLSL
source code the tokens came from. Then, there is the possibility to let
wine do if it is available a HLSL2GLSL transfomation directly from the
HLSL to GLSL.
1. HLSL is compiled to tokens and the result structure has a pointer to
the HLSL source code.
2. If activated the "use HLSL2GLSL for directX9 Shaders when available"
and the HLSL source code is available then
    2.1. use HLSL2GLSL to transform the HLSL source code
    2.2. Compile GLSL.
3. If not 2. then Tokens are transformed to GLSL.

The aim would not be to gain compilation time but to be more loyal to the
source HLSL. The final executable instead of making exactly what the ASM
is meant to do, it would make exactly what the HLSL is meant to do and
probably would be more optimized for the particular system.
HLSL --> Tokens --> GLSL  --> Executable that performs the actions of the
tokens
HLSL --> GLSL --> Executable that performs the actions of the HLSL.

Furthermo, taking into consideration the need of HLSL2GLSL for DirectX 10,
the hlsl2glsl will have to be set anyway. Therefore, the code needs are
not so big but just leaving the door open.
What do you all think and in particular David?



From thunderbird2k at gmx.net  Mon Dec 10 02:28:39 2007
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Mon, 10 Dec 2007 09:28:39 +0100
Subject: wined3d: improve thread safety in IWineD3DSurfaceImpl_BltOverride
In-Reply-To: <475D2587.9060700@inbox.lv>
References: <475D2587.9060700@inbox.lv>
Message-ID: <20071210082839.16170@gmx.net>

Hi,

The patch itself could be correct in the sense that indeed there might be a missing ActivateContext. But we should avoid making recursive ENTER_GL's. Between the ENTER_GL block there is a call to IWineD3DDevice_Clear which also calls ENTER_GL.

You could put a LEAVE_GL before it and an ENTER_GL after it but there is something else which you couldn't have known. A number of places in surface.c are messing with glDrawBuffer. These days activatecontext is also handling this, so in a number of places glDrawBuffer is redundant. This might be one of those places but I haven't checked that in detail. Stefan might be able to answer that.

Regards,
Roderick

-- 
GMX FreeMail: 1 GB Postfach, 5 E-Mail-Adressen, 10 Free SMS.
Alle Infos und kostenlose Anmeldung: http://www.gmx.net/de/go/freemail


From thunderbird2k at gmx.net  Mon Dec 10 02:34:54 2007
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Mon, 10 Dec 2007 09:34:54 +0100
Subject: ENTER_GL and ActivateContext question
In-Reply-To: <475D79E5.4010706@inbox.lv>
References: <475D79E5.4010706@inbox.lv>
Message-ID: <20071210083454.16170@gmx.net>

> Hello.
> 
> I was recently experimenting with a fix that involved ActivateContext and
> needed 
>   to figure out whether it is ok if ActivateContext is called inside 
> ENTER_GL()... LEAVE_GL() (also if recursive ENTER_GL is ok). At first I
> tried to 
> look for example code in wined3d/surface.c, which seemed to indicate this
> is ok, 
> because it obviously seems to happen in one or few places. Then I found
> this
> 
> http://bugs.winehq.org/show_bug.cgi?id=9810
> 
> >from which it seems it is sort of a bug(?). Can any of 3d guys here
> clarify this 
> matter - how bad is ActivateContext between ENTER_GL/LEAVE_GL and
> recursive 
> ENTER_GL, does it definitely need to be avoided and should things like
> this
> 
>      ENTER_GL();
>      ...
>      IWineD3DSurface_BindTexture();
>      ...
>      LEAVE_GL();
> 
> (BindTexture does ActivateContext and ENTER_GL)
> 
> be changed to something like
> 
> ENTER_GL()
> ...
> LEAVE_GL()
> 
> IWineD3DSurface_BindTexture();
> 
> ENTER_GL()
> ...
> LEAVE_GL()
> 
> and submitted as patch if I find it?
> 

GDI calls should be avoided within ENTER_GL/LEAVE_GL ('wine_tsx11_lock') as it can conflict with the GDI lock. (WGL calls used to be standard GDI calls, they are less sensitive to this now). ActivateContext is one of the calls which can make GDI calls and that's why it should be avoided.

A while ago I fixed most of these cases but I haven't played with the code for lets say a month or so. This piece seems to be new.

Regards,
Roderick
-- 
Der GMX SmartSurfer hilft bis zu 70% Ihrer Onlinekosten zu sparen! 
Ideal f?r Modem und ISDN: http://www.gmx.net/de/go/smartsurfer


From hverbeet at gmail.com  Mon Dec 10 02:37:32 2007
From: hverbeet at gmail.com (H. Verbeet)
Date: Mon, 10 Dec 2007 09:37:32 +0100
Subject: hlsl2glsl
In-Reply-To: <25721.158.169.131.14.1197275054.squirrel@www.ilidium.com>
References: <25721.158.169.131.14.1197275054.squirrel@www.ilidium.com>
Message-ID: <d658b69e0712100037kebe099jb6d921a6cc9834a0@mail.gmail.com>

On 10/12/2007, luis.busquets at ilidium.com <luis.busquets at ilidium.com> wrote:
> What do you all think and in particular David?
>
In the first place, I think this is all irrelevant without having an
actual d3d10 implementation.

Second, you'll need a proper implementation of the SM 4.0
implementation either way, because D3D10 still allows binary shaders,
and I expect the majority of games to ship those instead of actual
source. So it would be an additional path that needs to be maintained,
and the most feasible way to implement it I've heard so far would be
to embed GLSL code a comment section inside the shader byte code,
which would be rather ugly.

And finally, the actual hardware has it's own hardware specific
language for shaders. HLSL or D3D bytecode isn't really any closer to
the actual hardware language than GLSL or ARB asm, so it isn't even
guaranteed to gain us much.


From thunderbird2k at gmx.net  Mon Dec 10 02:42:08 2007
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Mon, 10 Dec 2007 09:42:08 +0100
Subject: hlsl2glsl
In-Reply-To: <25721.158.169.131.14.1197275054.squirrel@www.ilidium.com>
References: <25721.158.169.131.14.1197275054.squirrel@www.ilidium.com>
Message-ID: <20071210084208.278140@gmx.net>

> hlsl2glsl is the good solution for implementing shaders on directX 10.
> Nevertheless, the hlsl compilation to tokens has to be done for d3d9. On
> the other hand, if we implement d3dx9_xx, it is likely that the
> application will be using the compile D3DX9CompileShader to get the
> tokens. Currently it works and we can use the libraries d3dx9_xx and get
> good results but the following tranfosmations:
> 1. HLSL is compiled to tokens
> 2. Tokens are transformed to GLSL.
> I think that a good addition if the d3dx9_xx libraries are going to be
> implemented is to put a resource in wined3d that would let know which
> source HLSL code the tokens are meant to be and add the capability to
> instead of transform tokens to GLSL, to let wine know which is the HLSL
> source code the tokens came from. Then, there is the possibility to let
> wine do if it is available a HLSL2GLSL transfomation directly from the
> HLSL to GLSL.
> 1. HLSL is compiled to tokens and the result structure has a pointer to
> the HLSL source code.
> 2. If activated the "use HLSL2GLSL for directX9 Shaders when available"
> and the HLSL source code is available then
>     2.1. use HLSL2GLSL to transform the HLSL source code
>     2.2. Compile GLSL.
> 3. If not 2. then Tokens are transformed to GLSL.
> 
> The aim would not be to gain compilation time but to be more loyal to the
> source HLSL. The final executable instead of making exactly what the ASM
> is meant to do, it would make exactly what the HLSL is meant to do and
> probably would be more optimized for the particular system.
> HLSL --> Tokens --> GLSL  --> Executable that performs the actions of the
> tokens
> HLSL --> GLSL --> Executable that performs the actions of the HLSL.
> 
> Furthermo, taking into consideration the need of HLSL2GLSL for DirectX 10,
> the hlsl2glsl will have to be set anyway. Therefore, the code needs are
> not so big but just leaving the door open.
> What do you all think and in particular David?

The hlsl2glsl project isn't that useful. It was discussed a long time. One of the reasons is that the code is written in C++. Second we would need our parser anyway for the binary path. We agreed it is better to write our own parser to have more control of the code and to avoid NIH problems (not invented here).

Roderick
-- 
GMX FreeMail: 1 GB Postfach, 5 E-Mail-Adressen, 10 Free SMS.
Alle Infos und kostenlose Anmeldung: http://www.gmx.net/de/go/freemail


From stefandoesinger at gmx.at  Mon Dec 10 03:35:43 2007
From: stefandoesinger at gmx.at (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Mon, 10 Dec 2007 10:35:43 +0100
Subject: directX 10 and hlsl2glsl
In-Reply-To: <475AF38D.6050006@ilidium.com>
References: <475AF38D.6050006@ilidium.com>
Message-ID: <200712101035.47086.stefandoesinger@gmx.at>

Am Samstag, 8. Dezember 2007 20:42:05 schrieb S?nia Xapell? Br?:
>  I know there was some discussion concerning the use of hlsl2glsl and
> that it is not directly useful as it seems that the conversion to
> assembler is necessary in d3d9. Nevertheless, when it comes to
> d3d10,Shader Model 4 relies only  in source code and forbids the
> programmers from implementing directly the assembler tokens. Therefore,
> I think that in this case the best solution, maximising the use of the
> graphic card capabilities goes mandatory to the use of the trasnlator
> and leaving up to the graphic card driver the compilation of GLSL.
DirectX10 allows assembly(or better: bytecode) shaders as well. It has a 
compiler built in, so we need our own, but we do need a SM4 bytecode parser
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071210/9ad9fd90/attachment.pgp 

From dmitry at codeweavers.com  Mon Dec 10 05:05:24 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Mon, 10 Dec 2007 19:05:24 +0800
Subject: sfnt2fnt: Use code from gdi32/freetype to do a better job
	findingthe TTAG_EBLC to deal with older version of freetype
	without having tofall back on unreliable hacks
References: <475CE99A.10601@codeweavers.com>
Message-ID: <005201c83b1c$973f72e0$a600fea9@DMITRY>

"Aric Stewart" <aric at codeweavers.com> wrote:

> +    /* If the FT_Load_Sfnt_Table function is there we'll use it */
> +#ifdef HAVE_FT_LOAD_SFNT_TABLE
> +    err = FT_Load_Sfnt_Table(ft_face, table, offset, buf, len);
> +#endif
> +#ifdef HAVE_FREETYPE_INTERNAL_SFNT_H

Probably using #elif instead of #endif+#ifdef above would be more correct.

-- 
Dmitry.


From julliard at winehq.org  Mon Dec 10 05:08:23 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 10 Dec 2007 12:08:23 +0100
Subject: user32: Test the initial state of the cursor.
In-Reply-To: <689de9370712092315u48af3d7p26fdc1cc0095522b@mail.gmail.com>
	(Andrew Riedi's message of "Sun, 9 Dec 2007 23:15:43 -0800")
References: <689de9370712092315u48af3d7p26fdc1cc0095522b@mail.gmail.com>
Message-ID: <87y7c2lsd4.fsf@wine.dyndns.org>

"Andrew Riedi" <andrewriedi at gmail.com> writes:

> +static void test_initial_cursor(void)
> +{
> +    HCURSOR cursor, cursor2;
> +    DWORD error;
> +
> +    cursor = GetCursor();
> +
> +    /* Check what handle GetCursor() returns if a cursor is not set yet. */
> +    SetLastError(0xdeadbeef);
> +    cursor2 = LoadCursor(NULL, IDC_WAIT);
> +    todo_wine {
> +        ok(cursor == (HCURSOR) 0x00010015, "Cursor handle is %p, not 0x00010015.\n", cursor);

It doesn't make sense to hardcode handle values, it's not a behavior we
want to replicate.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Mon Dec 10 06:24:18 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 10 Dec 2007 13:24:18 +0100
Subject: [PATCH 1/3] qmgr: Added DllGetClassObject and DllCanUnloadNow.
In-Reply-To: <20071209211123.GA4228@knuth.cs.hmc.edu> (Roy Shea's message of
	"Sun, 9 Dec 2007 13:11:24 -0800")
References: <20071209211123.GA4228@knuth.cs.hmc.edu>
Message-ID: <87tzmqloul.fsf@wine.dyndns.org>

Roy Shea <roy at cs.hmc.edu> writes:

> Revision 2.  Made dll_ref static for now.
> ---
>  dlls/qmgr/qmgr.spec   |    2 ++
>  dlls/qmgr/qmgr_main.c |   16 ++++++++++++++++
>  2 files changed, 18 insertions(+), 0 deletions(-)
>
> diff --git a/dlls/qmgr/qmgr.spec b/dlls/qmgr/qmgr.spec
> index 1a63b32..c534b4f 100644
> --- a/dlls/qmgr/qmgr.spec
> +++ b/dlls/qmgr/qmgr.spec
> @@ -1,2 +1,4 @@
> +@ stdcall -private DllCanUnloadNow()
> +@ stdcall -private DllGetClassObject(ptr ptr ptr)
>  @ stub DllRegisterServer
>  @ stub DllUnregisterServer

These don't exist in the Windows dll. I don't think they make much sense
in a service dll.

-- 
Alexandre Julliard
julliard at winehq.org


From luis.busquets at ilidium.com  Mon Dec 10 07:23:46 2007
From: luis.busquets at ilidium.com (luis.busquets at ilidium.com)
Date: Mon, 10 Dec 2007 14:23:46 +0100 (CET)
Subject: hlsl2glsl
In-Reply-To: <20071210084208.278140@gmx.net>
References: <25721.158.169.131.14.1197275054.squirrel@www.ilidium.com>
	<20071210084208.278140@gmx.net>
Message-ID: <20176.158.169.131.14.1197293026.squirrel@www.ilidium.com>

Ok. I get that the program realeased by a private vendor is not good.
Nevertheless, what about the philosophy? What about:
1. The implementation shaders of DirectX 10 making the card compile GLSL
code generate by transforming the HLSL code.
2. The Implementation for D3DX9 of the "possibility" to store the HLSL
source code, transfomr it to GLSL and use the card resources to compile
the latter, so that a mor loyal executable in relation to the HLSL is at
the video card.

>
> The hlsl2glsl project isn't that useful. It was discussed a long time. One
> of the reasons is that the code is written in C++. Second we would need
> our parser anyway for the binary path. We agreed it is better to write our
> own parser to have more control of the code and to avoid NIH problems (not
> invented here).
>
> Roderick
> --
> GMX FreeMail: 1 GB Postfach, 5 E-Mail-Adressen, 10 Free SMS.
> Alle Infos und kostenlose Anmeldung: http://www.gmx.net/de/go/freemail
>




From kuba at mareimbrium.org  Mon Dec 10 08:06:09 2007
From: kuba at mareimbrium.org (Kuba Ober)
Date: Mon, 10 Dec 2007 09:06:09 -0500
Subject: Read Application Memory
In-Reply-To: <1197207347.6582.19.camel@yoku>
References: <1197207347.6582.19.camel@yoku>
Message-ID: <200712100906.09666.kuba@mareimbrium.org>

On Sunday 09 December 2007, Kai Lauterbach wrote:
> Hi,
>
> at the moment I'm writing a little Linux based program to read some
> variables from a Windows application. But my problem is, that i can't
> access to the virtual memory of the Win App running under wine. I don't
> know how to do this. c/c++ isn't the problem but the right way to do it.

On Linux, you'd typically use ptrace(). You PTRACE_ATTACH to the process 
(which becomes your child), wait() for the child to actually stop (attaching 
sends it SIGSTOP), you can then use PTRACE_PEEK/POKE to read/write process's 
memory.

Looks easy on paper, at least.

Cheers, Kuba


From julliard at winehq.org  Mon Dec 10 08:24:35 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 10 Dec 2007 15:24:35 +0100
Subject: winex11drv: Treat CapsLock and NumLock keys as normal keys. They
	should toggle on button down.
In-Reply-To: <475CB585.7050506@kievinfo.com> (Vitaliy Margolen's message of
	"Sun, 09 Dec 2007 20:41:57 -0700")
References: <475CB585.7050506@kievinfo.com>
Message-ID: <87prxelja4.fsf@wine.dyndns.org>

Vitaliy Margolen <wine-patches at kievinfo.com> writes:

> On winxp both keys toggle on button down not button up. So no need for any extra treatment.
> Fixes bug 10446.

You still have to handle the case when the state has been toggled
outside of Wine, you can't just get rid of the whole thing.

-- 
Alexandre Julliard
julliard at winehq.org


From stefan at codeweavers.com  Mon Dec 10 08:41:49 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Mon, 10 Dec 2007 15:41:49 +0100
Subject: hlsl2glsl
In-Reply-To: <20176.158.169.131.14.1197293026.squirrel@www.ilidium.com>
References: <25721.158.169.131.14.1197275054.squirrel@www.ilidium.com>
	<20071210084208.278140@gmx.net>
	<20176.158.169.131.14.1197293026.squirrel@www.ilidium.com>
Message-ID: <200712101541.51659.stefan@codeweavers.com>

Am Montag, 10. Dezember 2007 14:23:46 schrieb luis.busquets at ilidium.com:
> Ok. I get that the program realeased by a private vendor is not good.
> Nevertheless, what about the philosophy? What about:
> 1. The implementation shaders of DirectX 10 making the card compile GLSL
> code generate by transforming the HLSL code.
> 2. The Implementation for D3DX9 of the "possibility" to store the HLSL
> source code, transfomr it to GLSL and use the card resources to compile
> the latter, so that a mor loyal executable in relation to the HLSL is at
> the video card.
That HLSL2GLSL is written by ATI is absolutely no issue. It is released under 
an open source license and we can make use of the code. The philosophy you 
suggest is more of a problem.

Keep in mind that getting shaders translated into GLSL, which we can then send 
to the card, is only a small part of the whole dx10 topic. We will need our 
own codepath anyway(HLSL -> d3d asm -> GLSL). We have to investigate wether a 
direct HLSL -> GLSL path will gain us any performance. We can optimize the 
HLSL -> d3d asm ourselves, and the d3d asm->GLSL->card native code is 
lossless in theory. If the GLSL compiler is good, then it will recognise the 
assembler instructions in our GLSL code and essentially we have d3d asm -> 
card native then.

We will have to investigate what we gain with a 2nd direct HLSL->GLSL 
translation. I think we won't gain anything, and the effort is better spent 
elsewhere.

Also, the card never compiles shaders. This is always done on the CPU.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071210/f4b996e4/attachment-0001.pgp 

From infyquest at gmail.com  Mon Dec 10 10:06:09 2007
From: infyquest at gmail.com (Vijay Kiran Kamuju)
Date: Mon, 10 Dec 2007 10:06:09 -0600
Subject: File a bug report?
In-Reply-To: <47595B80.5020403@mindgate.lu>
References: <47595B80.5020403@mindgate.lu>
Message-ID: <36bf289b0712100806nbd5c52eyda3116f229e5bbe7@mail.gmail.com>

On Dec 7, 2007 8:41 AM, Gilles May <may.gilles at mindgate.lu> wrote:
> Hi everybody.
>
> After updating WINE to from 0.9.49 to 0.9.50 I noticed major slowdown in
> Company of Heroes, to the point that I get like 1 Frame every 2 seconds.
> Wine spams the console with:
>
> fixme:d3d_shader:IWineD3DVertexShaderImpl_CompileShader Vertexshader
> 0x4d20b78 recompiled more than 50 times
>
> Trying to find out the cause for the slowdown I did my first attempt at
> using git bisect and I could trace the slowdown to this patch:
>
> 959212304dfaf0e7459374593b20b74fe22a0b57 is first bad commit
> commit 959212304dfaf0e7459374593b20b74fe22a0b57
> Author: Stefan D?singer <stefan at codeweavers.com>
> Date:   Tue Nov 20 21:14:10 2007 +0100
>
>     wined3d: Track vertex declaration changes on vertex shaders.
This has been fixed to an extent in the current git, please test with
current git or wait for the 0.9.51
---
VJ
>
>     If an attribute has type D3DDECLTYPE_D3DCOLOR, the red and blue channels
>     are swizzled in the shader. Since the attribute is stored in the vertex
>     declaration and not the vertex shader, it can change by setting a new
>     vertex declaration. If this happens, we have to recompile the shader
>     with the swizzling of that specific attribute turned on or off.
>
> :040000 040000 327661a4d0f8a02bdc18380084589c891b64af9c
> e35a2bcbf9514e4f261d8b7a93dcb24c0b3c89a7 M      dlls
>
> Now without that patch there is slight texture corruption in the game,
> with the patch it's much much less but it renders the game unplayable.
> The reason I didn't file a bug report is that I am not sure if it is
> really a bug or not since obviously the patch fixes in-game texture
> corruption.
>
> Regards, Gilles
>
>
>
>

From adelle at akemi.com.au  Mon Dec 10 11:06:08 2007
From: adelle at akemi.com.au (Adelle Hartley)
Date: Tue, 11 Dec 2007 04:06:08 +1100
Subject: COM
Message-ID: <1197306368.5800.4.camel@brentano>

Hi all,

I have some COM DLLs which work fine with VB6 applications on wine.

Is it possible to instantiate a windowsy COM object from a linuxy
application written in some form of C++ (eg, for compilation with gcc)?

Adelle.




From alexd4 at inbox.lv  Tue Dec 11 00:06:02 2007
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Mon, 10 Dec 2007 22:06:02 -0800
Subject: ENTER_GL and ActivateContext question
In-Reply-To: <200712100853.22116.stefandoesinger@gmx.at>
References: <475D79E5.4010706@inbox.lv>
	<200712100853.22116.stefandoesinger@gmx.at>
Message-ID: <475E28CA.30504@inbox.lv>

Ok, thank you and Roderick for useful info. I figure that my previous patch
wasn't ideal, unfortunately it introduced one more of such recursive ENTERGL /
ActivateContext situations. I'll try to improve that and send another patch.

Regarding moving code around - I wish I was so competent in Direct3D and OpenGL
to freely move code around in wined3d etc :). Hopefully, wine hacking may
improve my grasp on it, but at the moment that's probably over my head. If you
don't object, I'll do basic stuff, like putting additional LEAVE_GL/ENTER_GL in
my own recent change to _BltOverride and wherever else I find similar problem,
and maybe I'll look into possible redundance of glDrawBuffer call Roderick
mentioned.

Also may be worth to think if it's reasonable to put a substantial amount of
effort into eliminating a few redundant gl* calls or a LEAVE_GL/ENTER_GL block
now (then possibly also hunting regressions), when there are major problems like
crashes etc. Say, to use Aliens vs Predator 2 game as an illustration - despite
now one can at least get into the game proper (i.e. load a level), it's still
largerly unusable because of a dinput bug and terrible performance (some
fog-related software emulation fixme - I'll probably submit this to bugzilla).

Stefan D?singer wrote:
> Am Montag, 10. Dezember 2007 18:39:49 schrieb Alexander Dorofeyev:
>> Hello.
>>
>> I was recently experimenting with a fix that involved ActivateContext and
>> needed to figure out whether it is ok if ActivateContext is called inside
>> ENTER_GL()... LEAVE_GL() (also if recursive ENTER_GL is ok). At first I
>> tried to look for example code in wined3d/surface.c, which seemed to
>> indicate this is ok, because it obviously seems to happen in one or few
>> places. Then I found this
> ActivateContext inside ENTER_GL() and LEAVE_GL() is *not* ok, but it happens 
> in quite a few places unfortunately. The problem this causes is stated in 
> this bugreport. ActivateContext can call GDI calls, and they can deadlock if 
> called between ENTER_GL and LEAVE_GL.
> 
> The example with BindTexture you gave is the main problem indeed, patches like 
> that are a way forward. However, instead of just adding a LEAVE_GL() and 
> ENTER_GL() it should be checked if this can be avoided by moving code around 
> a bit. Be warned that there are a few other troubles with ActivateContext and 
> gl calls as well, for example fbo setup vs ActivateContext





From jonathan at ernstfamily.ch  Mon Dec 10 14:57:17 2007
From: jonathan at ernstfamily.ch (Jonathan Ernst)
Date: Mon, 10 Dec 2007 21:57:17 +0100
Subject: Wine Weekly News
In-Reply-To: <b050a5e70712051601l7cc3b790mf3c0bcdac8e1f978@mail.gmail.com>
References: <200712050014.02742.kai.blin@gmail.com>
	<200712060018.10307.alex@thehandofagony.com>
	<b050a5e70712051544k3e11188hb9334adea559a2e@mail.gmail.com>
	<200712060052.59033.alex@thehandofagony.com>
	<b050a5e70712051601l7cc3b790mf3c0bcdac8e1f978@mail.gmail.com>
Message-ID: <1197320237.6507.2.camel@jernst-laptop>

Hello,

First, thank you for your work on the WWN !

About the new "AppDB Application Status Changes", I see that you have a
"change" column. What do you think about adding the sum of this column
somewhere so we can see how/if Wine is improving between releases
regarding application compatibility (of course this would be just an
indication).

Best regards.

Jonathan



From zgold550 at gmail.com  Mon Dec 10 15:06:30 2007
From: zgold550 at gmail.com (Zachary Goldberg)
Date: Mon, 10 Dec 2007 16:06:30 -0500
Subject: Wine Weekly News
In-Reply-To: <1197320237.6507.2.camel@jernst-laptop>
References: <200712050014.02742.kai.blin@gmail.com>
	<200712060018.10307.alex@thehandofagony.com>
	<b050a5e70712051544k3e11188hb9334adea559a2e@mail.gmail.com>
	<200712060052.59033.alex@thehandofagony.com>
	<b050a5e70712051601l7cc3b790mf3c0bcdac8e1f978@mail.gmail.com>
	<1197320237.6507.2.camel@jernst-laptop>
Message-ID: <b050a5e70712101306x43ce8a94j7d97a6eca8dae621@mail.gmail.com>

I thought about it, but wasn't sure of the usefulness of such a
number.  If consensus is that it would be worth having, i'll add it
for WWN 335.

On Dec 10, 2007 3:57 PM, Jonathan Ernst <jonathan at ernstfamily.ch> wrote:
> Hello,
>
> First, thank you for your work on the WWN !
>
> About the new "AppDB Application Status Changes", I see that you have a
> "change" column. What do you think about adding the sum of this column
> somewhere so we can see how/if Wine is improving between releases
> regarding application compatibility (of course this would be just an
> indication).
>
> Best regards.
>
> Jonathan
>
>



-- 
Zachary Goldberg
Computer Science & Engineering
Electrical Captain of Penn Electric Race Team
School of Engineering at the University of Pennsylvania


From r.swanwick at gmail.com  Mon Dec 10 03:53:14 2007
From: r.swanwick at gmail.com (Richard S)
Date: Mon, 10 Dec 2007 09:53:14 +0000 (UTC)
Subject: deleting AppDB deleted
Message-ID: <loom.20071210T094857-337@post.gmane.org>

Hi

Im one of the maintainers of the iTunes 6.x (was)

On Saturday I received this email

'
Subject: 	[AppDB] Version '6.x' of 'iTunes' deleted
Date: 	Sat, 08 Dec 2007 12:15:45 -0600 (18:15 GMT)

Version '6.x' of 'iTunes' deleted
-------------------------------------------------------
The action was performed by Wesley Hamel
Reasons given
Cleanup
'

Is it standard practice to remove all old versions of a program except for the
most recent?

IF this is true, WHY?

Rich







From Snub_Fighter at snubfighter.com  Mon Dec 10 11:32:44 2007
From: Snub_Fighter at snubfighter.com (Snub_Fighter)
Date: Mon, 10 Dec 2007 09:32:44 -0800 (PST)
Subject: Bugzilla rights
In-Reply-To: <474F6E81.8090201@sprintpcs.com>
References: <4730C463.9020809@kievinfo.com>
	<200711062109.14748.research@science.su>
	<20071111090214.GL5380@crissy.swd.zerebecki.de>
	<474ED2F1.9040209@kievinfo.com> <474F6E81.8090201@sprintpcs.com>
Message-ID: <14257253.post@talk.nabble.com>




James McKenzie-2 wrote:
> 
> Vitaliy Margolen wrote:
>> Jan Zerebecki wrote:
>>   
>>> On Tue, Nov 06, 2007 at 09:09:14PM +0000, L. Rahyen wrote:
>>>     
>>>> On Tuesday November 6 2007 19:45, Vitaliy Margolen wrote:
>>>>       
>>>>> Bugzilla admin, please disallow people to add/remove e-mail addresses
>>>>> to/from bugs unless they've been given that right. Or at least have
>>>>> rights
>>>>> to modify any aspect of the bug.
>>>>>         
>>>> 	I think that we should remove the right to add/remove e-mail addresses
>>>> ONLY 
>>>> from user who abuse his/her rights (like Toby Brommerich). All other
>>>> users 
>>>> should have this right - at least the right to add others to CC list.
>>>>       
>>> Sorry, neither of these seem to be possible with bugzilla as it
>>> currently is. I suppose in this case it was just an error from
>>> which something was learned. If someone doesn't learn, we still
>>> can disable their account.
>>>
>>>
>>> Jan
>>>
>>>
>>>
>>>     
>> Yet again I'm asking to do that. Please allow users to remove some one's 
>> e-mail form CC _only_ if they have rights to edit any aspects of the bug.
>>
>>   
> I would ask that the permission of a user to be able to remove
> themselves from the cc: block be
> retained in case they want to be removed from a bug they are no longer
> interested in or no longer
> use Wine.  Otherwise, I side with Vitaliy, only admins should be able to
> remove CCs from bug reports.
> 
> James
> 
> 
> 
> 
> 

I was the person who accidentally did this at one point, which I can see the
problem with letting people have control however, I think if there was a
decent faq for bugzilla controls on the wine site it'd be less of a problem.
Not to mention verbal aggression at someone new to the scene wasn't very
tactful, a simple explanation would have sufficed. I only bring this up
because it will drive new users away. 
-- 
View this message in context: http://www.nabble.com/Bugzilla-rights-tp13614383p14257253.html
Sent from the Wine - Devel mailing list archive at Nabble.com.



From Snub_Fighter at snubfighter.com  Mon Dec 10 11:34:20 2007
From: Snub_Fighter at snubfighter.com (Snub_Fighter)
Date: Mon, 10 Dec 2007 09:34:20 -0800 (PST)
Subject: Bugzilla rights
Message-ID: <14257253.post@talk.nabble.com>



James McKenzie-2 wrote:
> 
> Vitaliy Margolen wrote:
>> Jan Zerebecki wrote:
>>   
>>> On Tue, Nov 06, 2007 at 09:09:14PM +0000, L. Rahyen wrote:
>>>     
>>>> On Tuesday November 6 2007 19:45, Vitaliy Margolen wrote:
>>>>       
>>>>> Bugzilla admin, please disallow people to add/remove e-mail addresses
>>>>> to/from bugs unless they've been given that right. Or at least have
>>>>> rights
>>>>> to modify any aspect of the bug.
>>>>>         
>>>> 	I think that we should remove the right to add/remove e-mail addresses
>>>> ONLY 
>>>> from user who abuse his/her rights (like Toby Brommerich). All other
>>>> users 
>>>> should have this right - at least the right to add others to CC list.
>>>>       
>>> Sorry, neither of these seem to be possible with bugzilla as it
>>> currently is. I suppose in this case it was just an error from
>>> which something was learned. If someone doesn't learn, we still
>>> can disable their account.
>>>
>>>
>>> Jan
>>>
>>>
>>>
>>>     
>> Yet again I'm asking to do that. Please allow users to remove some one's 
>> e-mail form CC _only_ if they have rights to edit any aspects of the bug.
>>
>>   
> I would ask that the permission of a user to be able to remove
> themselves from the cc: block be
> retained in case they want to be removed from a bug they are no longer
> interested in or no longer
> use Wine.  Otherwise, I side with Vitaliy, only admins should be able to
> remove CCs from bug reports.
> 
> James
> 
> 
> 
> 
> 

I was the person who accidentally did this at one point, 
which I can see the problem with letting people have control however, 
I think if there was a decent faq for bugzilla controls on the wine site
it'd 
be less of a problem. Not to mention verbal aggression at someone new 
to the scene wasn't very tactful, a simple explanation would have sufficed. 
I only bring this up because it will drive new users away. 
-- 
View this message in context: http://www.nabble.com/Bugzilla-rights-tp13614383p14257253.html
Sent from the Wine - Devel mailing list archive at Nabble.com.



From zac at zacbrown.org  Mon Dec 10 15:11:37 2007
From: zac at zacbrown.org (Zac Brown)
Date: Mon, 10 Dec 2007 16:11:37 -0500
Subject: Wine Weekly News
In-Reply-To: <b050a5e70712101306x43ce8a94j7d97a6eca8dae621@mail.gmail.com>
References: <200712050014.02742.kai.blin@gmail.com>	<200712060018.10307.alex@thehandofagony.com>	<b050a5e70712051544k3e11188hb9334adea559a2e@mail.gmail.com>	<200712060052.59033.alex@thehandofagony.com>	<b050a5e70712051601l7cc3b790mf3c0bcdac8e1f978@mail.gmail.com>	<1197320237.6507.2.camel@jernst-laptop>
	<b050a5e70712101306x43ce8a94j7d97a6eca8dae621@mail.gmail.com>
Message-ID: <475DAB89.6000608@zacbrown.org>

Zachary Goldberg wrote:
> I thought about it, but wasn't sure of the usefulness of such a
> number.  If consensus is that it would be worth having, i'll add it
> for WWN 335.
> 
> On Dec 10, 2007 3:57 PM, Jonathan Ernst <jonathan at ernstfamily.ch> wrote:
>> Hello,
>>
>> First, thank you for your work on the WWN !
>>
>> About the new "AppDB Application Status Changes", I see that you have a
>> "change" column. What do you think about adding the sum of this column
>> somewhere so we can see how/if Wine is improving between releases
>> regarding application compatibility (of course this would be just an
>> indication).
>>
>> Best regards.
>>
>> Jonathan
>>
>>
> 
> 
> 

I'd like to see that as well. Could be interesting.

Cheers,

-Zac



From kingofallhearts999 at gmail.com  Mon Dec 10 15:15:50 2007
From: kingofallhearts999 at gmail.com (Bryan Haskins)
Date: Mon, 10 Dec 2007 16:15:50 -0500
Subject: deleting AppDB deleted
In-Reply-To: <loom.20071210T094857-337@post.gmane.org>
References: <loom.20071210T094857-337@post.gmane.org>
Message-ID: <f85ab1ea0712101315g403c997dk936e8baacb1fdf21@mail.gmail.com>

It really depends on the case, if a program is entirely superseded by
another version, ie you can't use the old version at all anymore, totally.
If it's still entirely possible to use an older version, and people have a
reason too, I would personally not delete it. However it really is up to the
management of the maintainers, and how they want to handle things.

On Dec 10, 2007 4:53 AM, Richard S <r.swanwick at gmail.com> wrote:

> Hi
>
> Im one of the maintainers of the iTunes 6.x (was)
>
> On Saturday I received this email
>
> '
> Subject:        [AppDB] Version '6.x' of 'iTunes' deleted
> Date:   Sat, 08 Dec 2007 12:15:45 -0600 (18:15 GMT)
>
> Version '6.x' of 'iTunes' deleted
> -------------------------------------------------------
> The action was performed by Wesley Hamel
> Reasons given
> Cleanup
> '
>
> Is it standard practice to remove all old versions of a program except for
> the
> most recent?
>
> IF this is true, WHY?
>
> Rich
>
>
>
>
>
>
>
>


-- 
Cheers,
Bryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20071210/3999cdf3/attachment.htm 

From juan.lang at gmail.com  Mon Dec 10 15:16:10 2007
From: juan.lang at gmail.com (Juan Lang)
Date: Mon, 10 Dec 2007 13:16:10 -0800
Subject: deleting AppDB deleted
In-Reply-To: <loom.20071210T094857-337@post.gmane.org>
References: <loom.20071210T094857-337@post.gmane.org>
Message-ID: <3a768c550712101316teab9173if38716f79fee2766@mail.gmail.com>

> Is it standard practice to remove all old versions of a program except for the
> most recent?

Not standard practice, and this shouldn't have been done (since few of
the 7.x versions of iTunes work with Wine.)
--Juan


From alex at thehandofagony.com  Mon Dec 10 15:40:54 2007
From: alex at thehandofagony.com (Alexander Nicolaysen =?iso-8859-1?q?S=F8rnes?=)
Date: Mon, 10 Dec 2007 22:40:54 +0100
Subject: deleting AppDB deleted
In-Reply-To: <3a768c550712101316teab9173if38716f79fee2766@mail.gmail.com>
References: <loom.20071210T094857-337@post.gmane.org>
	<3a768c550712101316teab9173if38716f79fee2766@mail.gmail.com>
Message-ID: <200712102240.54936.alex@thehandofagony.com>

On Monday 10 December 2007 22:16:10 Juan Lang wrote:
> > Is it standard practice to remove all old versions of a program except
> > for the most recent?
>
> Not standard practice, and this shouldn't have been done (since few of
> the 7.x versions of iTunes work with Wine.)
> --Juan


That's correct.  If a version is not usable anymore (because it connects to a 
server etc.) it can be made obsolete so votes will be moved to a usable one.

We are in the process of adding an un-delete system to the AppDB so issues 
like the recent ones can be fixed.


Alexander N. S?rnes


From stefandoesinger at gmx.at  Mon Dec 10 17:33:48 2007
From: stefandoesinger at gmx.at (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Tue, 11 Dec 2007 00:33:48 +0100
Subject: ENTER_GL and ActivateContext question
In-Reply-To: <475E28CA.30504@inbox.lv>
References: <475D79E5.4010706@inbox.lv>
	<200712100853.22116.stefandoesinger@gmx.at>
	<475E28CA.30504@inbox.lv>
Message-ID: <200712110033.50701.stefandoesinger@gmx.at>

Am Dienstag, 11. Dezember 2007 07:06:02 schrieb Alexander Dorofeyev:
> Ok, thank you and Roderick for useful info. I figure that my previous patch
> wasn't ideal, unfortunately it introduced one more of such recursive
> ENTERGL / ActivateContext situations. I'll try to improve that and send
> another patch.
>
> Regarding moving code around - I wish I was so competent in Direct3D and
> OpenGL to freely move code around in wined3d etc :). Hopefully, wine
> hacking may improve my grasp on it, but at the moment that's probably over
> my head. If you don't object, I'll do basic stuff, like putting additional
> LEAVE_GL/ENTER_GL in my own recent change to _BltOverride and wherever else
> I find similar problem, and maybe I'll look into possible redundance of
> glDrawBuffer call Roderick mentioned.
We definitely need some help in cleaning up issues like that, so help is 
highly welcome! Quite often it is the "basic" stuff that is annoying and time 
consuming.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071211/3e9248bd/attachment-0001.pgp 

From wine-devel at kievinfo.com  Mon Dec 10 19:45:37 2007
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Mon, 10 Dec 2007 18:45:37 -0700
Subject: winex11drv: Treat CapsLock and NumLock keys as normal keys. They
	should toggle on button down.
In-Reply-To: <87prxelja4.fsf@wine.dyndns.org>
References: <475CB585.7050506@kievinfo.com> <87prxelja4.fsf@wine.dyndns.org>
Message-ID: <475DEBC1.1050504@kievinfo.com>

Alexandre Julliard wrote:
> Vitaliy Margolen <wine-patches at kievinfo.com> writes:
> 
>> On winxp both keys toggle on button down not button up. So no need for any extra treatment.
>> Fixes bug 10446.
> 
> You still have to handle the case when the state has been toggled
> outside of Wine, you can't just get rid of the whole thing.
> 
And how's the current code handles that? By setting few internal thread 
unsafe constantly being reset flags?

Yes that old code can be just getting rid of without breaking anything.

Vitaliy


From dank at kegel.com  Mon Dec 10 21:52:26 2007
From: dank at kegel.com (Dan Kegel)
Date: Mon, 10 Dec 2007 19:52:26 -0800
Subject: Monday's valgrind results: no new errors
Message-ID: <a71bd89a0712101952y291d2a3bv56303ec6950b1102@mail.gmail.com>

http://kegel.com/wine/valgrind/logs-2007-12-10-summary.txt
seems to show lots of valgrind regressions in mshtml, but
http://kegel.com/wine/valgrind/logs-2007-12-10/vg-mshtml_dom-diff.txt
shows the difference is that I happen to have installed Gecko.
So they aren't really regressions (or if there are any, they're
buried in the noise), and today's git is probably about
as Valgrind-clean as Saturday's.
- Dan


From dank at kegel.com  Mon Dec 10 22:02:27 2007
From: dank at kegel.com (Dan Kegel)
Date: Mon, 10 Dec 2007 20:02:27 -0800
Subject: COM
Message-ID: <a71bd89a0712102002m4f97389die9114e8f22becbe1@mail.gmail.com>

Adelle wrote:
> I have some COM DLLs which work fine with VB6 applications on wine.
> Is it possible to instantiate a windowsy COM object from a linuxy
> application written in some form of C++ (eg, for compilation with gcc)?

Erm, maybe you could write a winelib app, but
you might have to use the C interface to COM.

Why not keep using the VB6 app?
- Dan


-- 
Wine for Windows ISVs: http://kegel.com/wine/isv


From leslie_alistair at hotmail.com  Mon Dec 10 23:01:09 2007
From: leslie_alistair at hotmail.com (Alistair Leslie-Hughes)
Date: Tue, 11 Dec 2007 16:01:09 +1100
Subject: Monday's valgrind results: no new errors
In-Reply-To: <a71bd89a0712101952y291d2a3bv56303ec6950b1102@mail.gmail.com>
References: <a71bd89a0712101952y291d2a3bv56303ec6950b1102@mail.gmail.com>
Message-ID: <fjl5ko$meo$1@ger.gmane.org>

Dan Kegel wrote:
> http://kegel.com/wine/valgrind/logs-2007-12-10-summary.txt
> seems to show lots of valgrind regressions in mshtml, but
> http://kegel.com/wine/valgrind/logs-2007-12-10/vg-mshtml_dom-diff.txt
> shows the difference is that I happen to have installed Gecko.
> So they aren't really regressions (or if there are any, they're
> buried in the noise), and today's git is probably about
> as Valgrind-clean as Saturday's.
> - Dan
> 
Hi Dan,

 From todays list there isn't a memory leak in vg-shlwapi_string.txt 
from but on the 8th there was.  Just a little concerned that something 
has been missed. I have a patch locally that I haven't submitted yet.

Also vg-msxml3_domdoc.txt has 2 "Conditional jump or move depends on 
uninitialised value" statements that don't appear in todays results.

Did something change?

Best Regards
  Alistair Leslie-Hughes



From leslie_alistair at hotmail.com  Mon Dec 10 23:05:01 2007
From: leslie_alistair at hotmail.com (Alistair Leslie-Hughes)
Date: Tue, 11 Dec 2007 16:05:01 +1100
Subject: Monday's valgrind results: no new errors
In-Reply-To: <fjl5ko$meo$1@ger.gmane.org>
References: <a71bd89a0712101952y291d2a3bv56303ec6950b1102@mail.gmail.com>
	<fjl5ko$meo$1@ger.gmane.org>
Message-ID: <fjl5rv$meo$2@ger.gmane.org>

Alistair Leslie-Hughes wrote:
> Dan Kegel wrote:
>> http://kegel.com/wine/valgrind/logs-2007-12-10-summary.txt
>> seems to show lots of valgrind regressions in mshtml, but
>> http://kegel.com/wine/valgrind/logs-2007-12-10/vg-mshtml_dom-diff.txt
>> shows the difference is that I happen to have installed Gecko.
>> So they aren't really regressions (or if there are any, they're
>> buried in the noise), and today's git is probably about
>> as Valgrind-clean as Saturday's.
>> - Dan
>>
> Hi Dan,
> 
>  From todays list there isn't a memory leak in vg-shlwapi_string.txt 
> from but on the 8th there was.  Just a little concerned that something 
> has been missed. I have a patch locally that I haven't submitted yet.
> 
> Also vg-msxml3_domdoc.txt has 2 "Conditional jump or move depends on 
> uninitialised value" statements that don't appear in todays results.
> 
Just ignore the last domdoc comment.  Its the noise of 
err:msxml:create_node shouldn't be here!.  That I am not seeing.

Best



From zac at zacbrown.org  Mon Dec 10 23:11:35 2007
From: zac at zacbrown.org (Zac Brown)
Date: Tue, 11 Dec 2007 00:11:35 -0500
Subject: shlwapi: Fix memory leak in test
In-Reply-To: <fjl61q$meo$3@ger.gmane.org>
References: <fjl61q$meo$3@ger.gmane.org>
Message-ID: <475E1C07.2070704@zacbrown.org>

Alistair Leslie-Hughes wrote:
> Hi,
>    Changelog:
> 	shlwapi: Fix memory leak in test.
> 
> Best Regards
> Alistair Leslie-Hughes
> 
> 
> 

No patch attached?

-Zac


From chris.kcat at gmail.com  Mon Dec 10 23:18:30 2007
From: chris.kcat at gmail.com (Chris Robinson)
Date: Mon, 10 Dec 2007 21:18:30 -0800
Subject: [2/5] WineD3D: Remove 24/32 bit hacks
In-Reply-To: <200712110024.04923.stefan@codeweavers.com>
References: <200712110024.04923.stefan@codeweavers.com>
Message-ID: <200712102118.30728.chris.kcat@gmail.com>

On Monday 10 December 2007 03:24:04 pm Stefan D?singer wrote:
>   devmode.dmFields     = DM_BITSPERPEL | DM_PELSWIDTH | DM_PELSHEIGHT;
> - devmode.dmBitsPerPel = (bpp >= 24) ? 32 : bpp; /* Stupid XVidMode cannot
> change bpp */ 

Did you mean to leave dmBitsPerPel at 0?


From stefan at codeweavers.com  Tue Dec 11 01:35:15 2007
From: stefan at codeweavers.com (Stefan =?utf-8?q?D=C3=B6singer?=)
Date: Tue, 11 Dec 2007 08:35:15 +0100
Subject: [2/5] WineD3D: Remove 24/32 bit hacks
In-Reply-To: <200712102118.30728.chris.kcat@gmail.com>
References: <200712110024.04923.stefan@codeweavers.com>
	<200712102118.30728.chris.kcat@gmail.com>
Message-ID: <200712110835.17638.stefan@codeweavers.com>

Am Dienstag, 11. Dezember 2007 06:18:30 schrieb Chris Robinson:
> On Monday 10 December 2007 03:24:04 pm Stefan D?singer wrote:
> >   devmode.dmFields     = DM_BITSPERPEL | DM_PELSWIDTH | DM_PELSHEIGHT;
> > - devmode.dmBitsPerPel = (bpp >= 24) ? 32 : bpp; /* Stupid XVidMode
> > cannot change bpp */
>
> Did you mean to leave dmBitsPerPel at 0?
Ooops, that one here works differently. No, that was not my intention, good 
catch!
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071211/fe444e52/attachment.pgp 

From julliard at winehq.org  Tue Dec 11 03:44:38 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Tue, 11 Dec 2007 10:44:38 +0100
Subject: winex11drv: Treat CapsLock and NumLock keys as normal keys. They
	should toggle on button down.
In-Reply-To: <475DEBC1.1050504@kievinfo.com> (Vitaliy Margolen's message of
	"Mon, 10 Dec 2007 18:45:37 -0700")
References: <475CB585.7050506@kievinfo.com> <87prxelja4.fsf@wine.dyndns.org>
	<475DEBC1.1050504@kievinfo.com>
Message-ID: <878x41lg55.fsf@wine.dyndns.org>

Vitaliy Margolen <wine-devel at kievinfo.com> writes:

> Alexandre Julliard wrote:
>> Vitaliy Margolen <wine-patches at kievinfo.com> writes:
>> 
>>> On winxp both keys toggle on button down not button up. So no need for any extra treatment.
>>> Fixes bug 10446.
>> 
>> You still have to handle the case when the state has been toggled
>> outside of Wine, you can't just get rid of the whole thing.
>> 
> And how's the current code handles that? By setting few internal thread 
> unsafe constantly being reset flags?

No, it does this by simulating a keypress if the state has been changed
outside Wine, nothing to do with the global flags. I certainly agree the
global flags can be removed, but that doesn't mean you can remove the
rest of the code without understanding what it does.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Tue Dec 11 05:08:29 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Tue, 11 Dec 2007 12:08:29 +0100
Subject: kernel32: cpu: Detect AMD 64bit CPUs
In-Reply-To: <200712110929.41853.alex@thehandofagony.com> ("Alexander
	Nicolaysen =?utf-8?Q?S=C3=B8rnes=22's?= message of "Tue, 11 Dec 2007
	09:29:41 +0100")
References: <200712110929.41853.alex@thehandofagony.com>
Message-ID: <87k5nlij4i.fsf@wine.dyndns.org>

Alexander Nicolaysen S?rnes <alex at thehandofagony.com> writes:

> kernel32: cpu: Detect AMD 64bit CPUs

Are you really supposed to return a 64bit CPU in 32-bit mode?  Do you
have a test case?

-- 
Alexandre Julliard
julliard at winehq.org


From alex at thehandofagony.com  Tue Dec 11 05:14:08 2007
From: alex at thehandofagony.com (Alexander Nicolaysen =?utf-8?q?S=C3=B8rnes?=)
Date: Tue, 11 Dec 2007 12:14:08 +0100
Subject: kernel32: cpu: Detect AMD 64bit CPUs
In-Reply-To: <87k5nlij4i.fsf@wine.dyndns.org>
References: <200712110929.41853.alex@thehandofagony.com>
	<87k5nlij4i.fsf@wine.dyndns.org>
Message-ID: <200712111214.09214.alex@thehandofagony.com>

On Tuesday 11 December 2007 12:08:29 you wrote:
> Alexander Nicolaysen S?rnes <alex at thehandofagony.com> writes:
> > kernel32: cpu: Detect AMD 64bit CPUs
>
> Are you really supposed to return a 64bit CPU in 32-bit mode?  Do you
> have a test case?


It only identifies the model as an AMD x86 64bit CPU, so it doesn't imply that 
the Windows version is 64 bit.
I don't have such a CPU myself; it was a fix for bug 10742 
(http://bugs.winehq.org/show_bug.cgi?id=10742)




Alexander


From julliard at winehq.org  Tue Dec 11 05:18:32 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Tue, 11 Dec 2007 12:18:32 +0100
Subject: ntdll: Initialize APC call and result variables to suppress
	valgrind warnings
In-Reply-To: <E1J1zLV-0008Ki-3O@mail.codeweavers.com> (Dmitry Timoshkov's
	message of "Tue, 11 Dec 2007 15:16:04 +0800")
References: <E1J1zLV-0008Ki-3O@mail.codeweavers.com>
Message-ID: <87fxy9iinr.fsf@wine.dyndns.org>

Dmitry Timoshkov <dmitry at codeweavers.com> writes:

> Alexandre said that it's OK to use memset for server requests because of
> backwards compatibility.

It's OK for requests, but why do you want to initialize the result
structure too?

-- 
Alexandre Julliard
julliard at winehq.org


From felix at compsoc.nuigalway.ie  Tue Dec 11 05:52:32 2007
From: felix at compsoc.nuigalway.ie (Darragh Bailey)
Date: Tue, 11 Dec 2007 11:52:32 +0000
Subject: Work legalities
In-Reply-To: <45F06FC9.2050203@winehq.org>
References: <5989a080703071140x488675b3u3a41161f2c042467@mail.gmail.com>
	<1173301308.8471.1.camel@medbi01-9.localdomain>
	<5989a080703071342s2d43df33vfc6d08544b46bacd@mail.gmail.com>
	<45EFF7D0.7020508@shemesh.biz> <45F06FC9.2050203@winehq.org>
Message-ID: <20071211115232.GB20852@compsoc.nuigalway.ie>

I was hoping to be able to submit some patches for wine over the
christmas holidays. So I'm trying to sort out with work any legalities
with regards to my employment contract and working on other projects.

Basically the contract states that they own what I do, unless I get
permission from the relevant managers internally to write code for
work outside of my employment.

In general there isn't any issues in work getting permission to work 
on open source projects, the company is involved in enough of them
itself. However I did remember reading some emails over a year ago on
this list about getting written permission, and examples of what would
be needed. Just have a query on part of the text.


On Thu, Mar 08, 2007 at 02:19:21PM -0600, Jeremy White wrote:
> I asked James Vasile, of the Software Freedom Law Center,
> to comment on this.  (For those who don't recall, the SFLC
> officially represents the Wine project on legal matters).
> 
> This is essentially what he had to say (and James, correct
> me if I get anything wrong :-/):
> 
> > If you are employed to do programming (even at a university), or have
> > made an agreement with your employer, school or anyone else saying it
> > owns software you write, then you and we need a signed document from
> > them disclaiming any rights they may have to the software.  The
> > disclaimer should be signed by a vice president, general manager, or
> > anyone else who is authorized to assign software owned by them.  Here
> > is a sample wording:
> >
> > As a general rule, get everything in writing.  The below will suffice.
> > Email is fine, paper is better.  The project needs a copy (or, better
> > yet, the original) of the document.
> >
> > Here's some sample text:
> >
> > ACME Corporation ("Company") hereby disclaims all copyright interest
> > in the code written by Jane Doe for the program "[insert name of
> > program]" ("Program"), including original Program code and
> > documentation and support files, changes and enhancements to the
> > Program and files, and any future modifications of the Program and
> > files.  We do not consider the code as work made for hire for us.
> > Company affirms that it has no other intellectual property interest
> > that would undermine this release, or the use of the Program, and will
> > do nothing to undermine it in the future.
> >
> > [signature of John Smith], 30 March 2006
> > John Smith, Vice President, ACME Corp.
> 
> 
> Ideally, you would obtain this in writing and then get this
> on to James (vasille - at - softwarefreedom - dot - org, or
> use snail mail/fax from their web site).
> 
> Cheers,
> 
> Jeremy
> 

These lines specifically may be an issue.

> > files.  We do not consider the code as work made for hire for us.
> > Company affirms that it has no other intellectual property interest
> > that would undermine this release, or the use of the Program, and
> > will do nothing to undermine it in the future.

My reading of this, is it would cover patents as well. So if the company 
(it's a big multi-national, really really big, but not microsoft :) ), 
has any patents covering wine, not just the code I write for wine, this 
would mean they release all rights to any patents possibly covering wine.

Now I just cannot see them being willing to perform a risk assessment on
all IP they might have in this case. Just to let one employee

I can see the possibility of getting sign off on them not claiming any
copyright over any code I write provided it doesn't use any company
resources (equipment or time), but not where it covers all IP. 


So, do I have the correct reading of what the statement means? 

Any suggestions on how to deal with this, without simply leaving the
company. As I mentioned early, they do work on open source code here
too, so I plan to discuss this with my manager as well.

-- 
Darragh

"Nothing is foolproof to a sufficiently talented fool."


From kornelpal at gmail.com  Tue Dec 11 06:16:08 2007
From: kornelpal at gmail.com (=?utf-8?B?S29ybsOpbCBQw6Fs?=)
Date: Tue, 11 Dec 2007 13:16:08 +0100
Subject: kernel32: cpu: Detect AMD 64bit CPUs
References: <200712110929.41853.alex@thehandofagony.com><87k5nlij4i.fsf@wine.dyndns.org>
	<200712111214.09214.alex@thehandofagony.com>
Message-ID: <028501c83bef$9d5fe870$dc6c26c3@kornelpal.hu>

Hi,

I think GetSystemInfo should return x86 even on x64 when running 32-bit 
applications just like a 32-bit Windows or WOW64 does. But 
GetNativeSystemInfo could return the actual 64-bit CPU altough I'm not sure 
that it makes any sense without WOW64.

Korn?l

----- Original Message ----- 
From: "Alexander Nicolaysen S?rnes" <alex at thehandofagony.com>
To: "Alexandre Julliard" <julliard at winehq.org>; <wine-devel at winehq.org>
Sent: Tuesday, December 11, 2007 12:14 PM
Subject: Re: kernel32: cpu: Detect AMD 64bit CPUs


> On Tuesday 11 December 2007 12:08:29 you wrote:
>> Alexander Nicolaysen S?rnes <alex at thehandofagony.com> writes:
>> > kernel32: cpu: Detect AMD 64bit CPUs
>>
>> Are you really supposed to return a 64bit CPU in 32-bit mode?  Do you
>> have a test case?
>
>
> It only identifies the model as an AMD x86 64bit CPU, so it doesn't imply 
> that
> the Windows version is 64 bit.
> I don't have such a CPU myself; it was a fix for bug 10742
> (http://bugs.winehq.org/show_bug.cgi?id=10742)
>
>
>
>
> Alexander
>
>
> 



From dmitry at codeweavers.com  Tue Dec 11 07:07:45 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Tue, 11 Dec 2007 21:07:45 +0800
Subject: ntdll: Initialize APC call and result variables to
	suppressvalgrind warnings
References: <E1J1zLV-0008Ki-3O@mail.codeweavers.com>
	<87fxy9iinr.fsf@wine.dyndns.org>
Message-ID: <004001c83bf6$d40c0410$a600fea9@DMITRY>

"Alexandre Julliard" <julliard at winehq.org> wrote:

> It's OK for requests, but why do you want to initialize the result
> structure too?

NTDLL_queue_process_apc for a local process calls invoke_apc() which
initializes the result to 0 before proceeding. Perhaps memset() should
be added for a not local case as well, or memset() should be removed
from invoke_apc() and replaced by explicit initialization as done in
my patch. What's your opinion?

-- 
Dmitry.


From fgouget at free.fr  Tue Dec 11 07:08:18 2007
From: fgouget at free.fr (Francois Gouget)
Date: Tue, 11 Dec 2007 14:08:18 +0100 (CET)
Subject: Wine Weekly News
In-Reply-To: <1197320237.6507.2.camel@jernst-laptop>
References: <200712050014.02742.kai.blin@gmail.com>
	<200712060018.10307.alex@thehandofagony.com>
	<b050a5e70712051544k3e11188hb9334adea559a2e@mail.gmail.com>
	<200712060052.59033.alex@thehandofagony.com>
	<b050a5e70712051601l7cc3b790mf3c0bcdac8e1f978@mail.gmail.com>
	<1197320237.6507.2.camel@jernst-laptop>
Message-ID: <Pine.LNX.4.64.0712111356290.4089@amboise.dolphin>

On Mon, 10 Dec 2007, Jonathan Ernst wrote:
[...]
> About the new "AppDB Application Status Changes", I see that you have a
> "change" column.

I'm not convinced this column is of any use: it only repeats what we see 
in the other two columns but in a less obvious way.

The total / global trend however would be more useful. Something like:
Applications whose rating improved: X
Applications whose rating worsened: Y

I'm not sure more detail is pratical because there are lots of possible 
transitions: from Garbage to Bronze, Silver, Gold, Platinum; from 
Silver to Garbage, ... (10 total).

We could also have a count of new applications for each rating. But 
if this also counts newly added applications, then it does not say much 
about whether applications improve or not. But it would give an idea of 
the level of activity in the application database.


-- 
Francois Gouget <fgouget at free.fr>              http://fgouget.free.fr/
                            $live{free} || die "";


From dmitry at codeweavers.com  Tue Dec 11 07:56:46 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Tue, 11 Dec 2007 21:56:46 +0800
Subject: winspool: implement EnumFormsA/W for form level 1,
	add a few builtinforms
References: <475E933D.1000806@gmx.net>
Message-ID: <00be01c83bfd$ad72dd90$a600fea9@DMITRY>

"Marcel Partap" <mpartap at gmx.net> wrote:

> +static const struct builtin_form builtin_forms[] = {
> +    {{'L','e','t','t','e','r',0}, {{216000,279000}, {0,0,216000,279000}, 0, FORM_BUILTIN}},
> +    {{'A','3',0}, {{297000,420000}, {0,0,297000,420000}, 0, FORM_BUILTIN}},
> +    {{'A','4',0}, {{210000,297000}, {0,0,210000,297000}, 0, FORM_BUILTIN}},
> +    {{'A','5',0}, {{148000,210000}, {0,0,148000,210000}, 0, FORM_BUILTIN}} };

I guess this info should be fetched from the printer, not hard coded.

-- 
Dmitry.


From julliard at winehq.org  Tue Dec 11 07:57:45 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Tue, 11 Dec 2007 14:57:45 +0100
Subject: ntdll: Initialize APC call and result variables to
	suppressvalgrind warnings
In-Reply-To: <004001c83bf6$d40c0410$a600fea9@DMITRY> (Dmitry Timoshkov's
	message of "Tue, 11 Dec 2007 21:07:45 +0800")
References: <E1J1zLV-0008Ki-3O@mail.codeweavers.com>
	<87fxy9iinr.fsf@wine.dyndns.org>
	<004001c83bf6$d40c0410$a600fea9@DMITRY>
Message-ID: <874pepibae.fsf@wine.dyndns.org>

"Dmitry Timoshkov" <dmitry at codeweavers.com> writes:

> "Alexandre Julliard" <julliard at winehq.org> wrote:
>
>> It's OK for requests, but why do you want to initialize the result
>> structure too?
>
> NTDLL_queue_process_apc for a local process calls invoke_apc() which
> initializes the result to 0 before proceeding. Perhaps memset() should
> be added for a not local case as well, or memset() should be removed
> from invoke_apc() and replaced by explicit initialization as done in
> my patch. What's your opinion?

In the local case there's no server call, so there's no need for a
memset. In the remote case there's a need for a memset in the target
process, i.e. in invoke_apc. A memset in the source process is always
useless since it never sends the result anywhere.

-- 
Alexandre Julliard
julliard at winehq.org


From mpartap at gmx.net  Tue Dec 11 08:04:19 2007
From: mpartap at gmx.net (Marcel Partap)
Date: Tue, 11 Dec 2007 15:04:19 +0100
Subject: winspool: implement EnumFormsA/W for form level 1, add a few
	builtinforms
In-Reply-To: <00be01c83bfd$ad72dd90$a600fea9@DMITRY>
References: <475E933D.1000806@gmx.net> <00be01c83bfd$ad72dd90$a600fea9@DMITRY>
Message-ID: <475E98E3.70502@gmx.net>

> I guess this info should be fetched from the printer, not hard coded.
No no there are indeed builtin forms:
(from http://www.unixwiz.net/techtips/winspooler-forms.html)
FORM_INFO_1.Flags
 Each form can be one of three types: FORM_BUILTIN, FORM_PRINTER and FORM_USER. Builtin forms are an
inherent part of the print system (TODO: which part?), and they cannot be deleted or changed with
the Forms API.
Printer" forms are stored in the registry, as are "User" forms. The Microsoft documentation suggests
that the "Printer" forms are associated with individual printers, but we've not found any indication
that they are anything other than system wide and available to all printers. We have not found how
"user" forms are implemented.
 The database of user and print forms (but not builtin forms) is found in the registry:
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Print\Forms\"

first I wanted to put them into the registry somewhere beneath the wine tree but decided against..
There are lots more builtin forms on windows of course (try winspool crosstest)..
regards marcel



From dank at kegel.com  Tue Dec 11 08:29:48 2007
From: dank at kegel.com (Dan Kegel)
Date: Tue, 11 Dec 2007 06:29:48 -0800
Subject: Monday's valgrind results: no new errors
In-Reply-To: <a71bd89a0712101952y291d2a3bv56303ec6950b1102@mail.gmail.com>
References: <a71bd89a0712101952y291d2a3bv56303ec6950b1102@mail.gmail.com>
Message-ID: <a71bd89a0712110629p34918cb7u2cb4629cfcc0a71c@mail.gmail.com>

Alistair Leslie-Hughes wrote:
>Dan Kegel <dank at kegel.com> wrote:
>> http://kegel.com/wine/valgrind/logs-2007-12-10-summary.txt
>> ... today's git is probably about as Valgrind-clean as Saturday's.
>
>From todays list there isn't a memory leak in vg-shlwapi_string.txt
>from but on the 8th there was.  Just a little concerned that something
>has been missed. I have a patch locally that I haven't submitted yet.

I haven't been paying any attention to memory leaks myself.
In fact, I only show files that include pointer and uninitialized access errors,
so if a module doesn't have any non-memory-leak
errors, I don't even show the file.  That may be why the
file is missing on the 10th.

I guess my thinking was "let's fix all the serious errors, then start
fixing memory leaks".  But I guess I should put some effort into
making the logs more useful for people looking for memory leaks.

Of course, if you can run valgrind locally, that's the best way to
investigate things in detail.
- Dan


From juan.lang at gmail.com  Tue Dec 11 09:14:03 2007
From: juan.lang at gmail.com (Juan Lang)
Date: Tue, 11 Dec 2007 07:14:03 -0800
Subject: imagehlp: improve last error handling in ImageGetCertificateData
Message-ID: <3a768c550712110714p5d9358dcv62e9cd6293643d1e@mail.gmail.com>

Hi Aric,

-    if( !Certificate )
+    if( *RequiredLength < size )
     {
         *RequiredLength = size;
-        return TRUE;
+        SetLastError( ERROR_INSUFFICIENT_BUFFER );
+        return FALSE;
     }

-    if( *RequiredLength < size )
+    if( !Certificate )
     {
         *RequiredLength = size;
-        SetLastError( ERROR_INSUFFICIENT_BUFFER );
-        return FALSE;
+        return TRUE;
     }

Are you sure this is the order that *RequiredLength and Certificate
are checked in?  Seems backwards to the normal style to me.  I won't
bug you for a proper regression test, as I failed to produce one too
:)
--Juan


From jacek at codeweavers.com  Tue Dec 11 11:24:04 2007
From: jacek at codeweavers.com (Jacek Caban)
Date: Tue, 11 Dec 2007 18:24:04 +0100
Subject: wintrust: implementations for WTHelperGetFileName
	and	WTHelperGetFIleHandle
In-Reply-To: <475E8D93.9070903@codeweavers.com>
References: <475E8D93.9070903@codeweavers.com>
Message-ID: <475EC7B4.5050902@codeweavers.com>

Hi Aric,

Aric Stewart wrote:
> + else
> +     return (HANDLE)0xffffffff;

That's what is INVALID_HANDLE_VALUE for.

Jacek




From g.martinez at pcbsd.es  Tue Dec 11 11:02:53 2007
From: g.martinez at pcbsd.es (Gonzalo Martinez - Sanjuan Sanchez)
Date: Tue, 11 Dec 2007 18:02:53 +0100
Subject: wine proccess list
Message-ID: <EDB99C04-7455-4E75-89D2-FA485769A24F@pcbsd.es>

Hello to all.

I have something in mind that I would like to ask to Wine developers.
Is it possible using a hack/trick or a hidden option to change the  
name of wine in the proccess lists?
I mean, Is it possible to list 'wine' proccess as, for example  
'iexplorer' when I use Internet Explorer under Wine?

Thanks a lot for your work, hope my question find the answer here.


From stefan at codeweavers.com  Tue Dec 11 12:34:49 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Tue, 11 Dec 2007 19:34:49 +0100
Subject: wine proccess list
In-Reply-To: <EDB99C04-7455-4E75-89D2-FA485769A24F@pcbsd.es>
References: <EDB99C04-7455-4E75-89D2-FA485769A24F@pcbsd.es>
Message-ID: <200712111934.52087.stefan@codeweavers.com>

Am Dienstag, 11. Dezember 2007 18:02:53 schrieb Gonzalo Martinez - Sanjuan 
Sanchez:
> Hello to all.
>
> I have something in mind that I would like to ask to Wine developers.
> Is it possible using a hack/trick or a hidden option to change the
> name of wine in the proccess lists?
> I mean, Is it possible to list 'wine' proccess as, for example
> 'iexplorer' when I use Internet Explorer under Wine?
>
> Thanks a lot for your work, hope my question find the answer here.
This is done since quite some time. apps are usually called "iexplore.exe", or 
they have the name of the file that was passed to wine, like C:\Program 
Files\Internet Explorer\iexplore.exe

If you still see "wine", "wineloader" or something similar you have a very 
outdated version of wine.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071211/a5661c9d/attachment.pgp 

From stefan at codeweavers.com  Tue Dec 11 13:38:24 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Tue, 11 Dec 2007 20:38:24 +0100
Subject: wine proccess list
In-Reply-To: <200712112025.20589.g.martinez@pcbsd.es>
References: <EDB99C04-7455-4E75-89D2-FA485769A24F@pcbsd.es>
	<200712111934.52087.stefan@codeweavers.com>
	<200712112025.20589.g.martinez@pcbsd.es>
Message-ID: <200712112038.27198.stefan@codeweavers.com>

Am Dienstag, 11. Dezember 2007 20:25:20 schrieb Gonzalo Martinez - Sanjuan 
Sanchez:
> El Tuesday 11 December 2007 7:34:49 pm escribi?:
> > Am Dienstag, 11. Dezember 2007 18:02:53 schrieb Gonzalo Martinez -
> > Sanjuan
> >
> > Sanchez:
> > > Hello to all.
> > >
> > > I have something in mind that I would like to ask to Wine developers.
> > > Is it possible using a hack/trick or a hidden option to change the
> > > name of wine in the proccess lists?
> > > I mean, Is it possible to list 'wine' proccess as, for example
> > > 'iexplorer' when I use Internet Explorer under Wine?
> > >
> > > Thanks a lot for your work, hope my question find the answer here.
> >
> > This is done since quite some time. apps are usually called
> > "iexplore.exe", or they have the name of the file that was passed to
> > wine, like C:\Program Files\Internet Explorer\iexplore.exe
> >
> > If you still see "wine", "wineloader" or something similar you have a
> > very outdated version of wine.
>
> Well, im talking about Wine 0.9.48 under FreeBSD/PC-BSD OS.
Ow, ah, this is a different business. I think we use some Linux-only feature 
to set the name, and Alexandre told me that at least MacOS doesn't have it. I 
have no idea if there is a way to change the process name under BSD. If there 
is, feel free to implement it and send a patch

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071211/faac35d3/attachment.pgp 

From maarten at codeweavers.com  Tue Dec 11 14:01:13 2007
From: maarten at codeweavers.com (Maarten Lankhorst)
Date: Tue, 11 Dec 2007 21:01:13 +0100
Subject: wine proccess list
In-Reply-To: <200712112038.27198.stefan@codeweavers.com>
References: <EDB99C04-7455-4E75-89D2-FA485769A24F@pcbsd.es>	<200712111934.52087.stefan@codeweavers.com>	<200712112025.20589.g.martinez@pcbsd.es>
	<200712112038.27198.stefan@codeweavers.com>
Message-ID: <475EEC89.5050607@codeweavers.com>

Hi Gonzalo,

Stefan D?singer schreef:
> Ow, ah, this is a different business. I think we use some Linux-only feature 
> to set the name, and Alexandre told me that at least MacOS doesn't have it. I 
> have no idea if there is a way to change the process name under BSD. If there 
> is, feel free to implement it and send a patch
>   
A slightly hacky method is to copy the process to /tmp, rename it and
execute it there. It would work for mac and bsd, but I have no idea
wether Alexandre would accept it into wine.

Cheers,
Maarten.


From g.martinez at pcbsd.es  Tue Dec 11 13:25:20 2007
From: g.martinez at pcbsd.es (Gonzalo Martinez - Sanjuan Sanchez)
Date: Tue, 11 Dec 2007 20:25:20 +0100
Subject: wine proccess list
In-Reply-To: <200712111934.52087.stefan@codeweavers.com>
References: <EDB99C04-7455-4E75-89D2-FA485769A24F@pcbsd.es>
	<200712111934.52087.stefan@codeweavers.com>
Message-ID: <200712112025.20589.g.martinez@pcbsd.es>

El Tuesday 11 December 2007 7:34:49 pm escribi?:
> Am Dienstag, 11. Dezember 2007 18:02:53 schrieb Gonzalo Martinez - Sanjuan
>
> Sanchez:
> > Hello to all.
> >
> > I have something in mind that I would like to ask to Wine developers.
> > Is it possible using a hack/trick or a hidden option to change the
> > name of wine in the proccess lists?
> > I mean, Is it possible to list 'wine' proccess as, for example
> > 'iexplorer' when I use Internet Explorer under Wine?
> >
> > Thanks a lot for your work, hope my question find the answer here.
>
> This is done since quite some time. apps are usually called "iexplore.exe",
> or they have the name of the file that was passed to wine, like C:\Program
> Files\Internet Explorer\iexplore.exe
>
> If you still see "wine", "wineloader" or something similar you have a very
> outdated version of wine.

Well, im talking about Wine 0.9.48 under FreeBSD/PC-BSD OS.


From mah at jump-ing.de  Tue Dec 11 14:56:08 2007
From: mah at jump-ing.de (Markus Hitter)
Date: Tue, 11 Dec 2007 21:56:08 +0100
Subject: [Wine] wine proccess list
In-Reply-To: <EDB99C04-7455-4E75-89D2-FA485769A24F@pcbsd.es>
References: <EDB99C04-7455-4E75-89D2-FA485769A24F@pcbsd.es>
Message-ID: <E67D6C58-7FC3-4A12-9201-E96776B25668@jump-ing.de>


Am 11.12.2007 um 18:02 schrieb Gonzalo Martinez - Sanjuan Sanchez:

> Is it possible using a hack/trick or a hidden option to change the
> name of wine in the proccess lists?

While this isn't a Wine specific question, you'd have to write your  
own executable-launcher. None of the shells I'm aware of allow to  
tweak argv[0]. The hearth of a custom launcher would be an execve()  
system call, see "man execve" on what it does.


Markus

- - - - - - - - - - - - - - - - - - -
Dipl. Ing. Markus Hitter
http://www.jump-ing.de/






From kris at pcbsd.com  Tue Dec 11 15:29:12 2007
From: kris at pcbsd.com (Kris Moore)
Date: Tue, 11 Dec 2007 16:29:12 -0500
Subject: wine proccess list
Message-ID: <475F0128.3060605@pcbsd.com>



Gonzalo sent me this thread, and I may be able to get a patch put 
together here soon. First, I wanted to make sure I'm on the right path:

Can somebody confirm for me that this is the right location where I 
should be trying to fix this?

http://source.winehq.org/source/loader/preloader.c#L1006

FreeBSD has a function called setproctitle(), which I'm pretty sure is 
the right one for this task.

http://www.freebsd.org/cgi/man.cgi?query=setproctitle&apropos=0&sektion=0&manpath=FreeBSD+6.2-RELEASE&format=html

I'll probably try and see about a patch here in the next day or so. Who 
do I send it to if I can get it working?


-- 

Kris Moore
PC-BSD Software
http://www.pcbsd.com


Am Dienstag, 11. Dezember 2007 20:25:20 schrieb Gonzalo Martinez - Sanjuan
Sanchez:
 > El Tuesday 11 December 2007 7:34:49 pm escribi?:
 > > Am Dienstag, 11. Dezember 2007 18:02:53 schrieb Gonzalo Martinez -
 > > Sanjuan
 > >
 > > Sanchez:
 > > > Hello to all.
 > > >
 > > > I have something in mind that I would like to ask to Wine developers.
 > > > Is it possible using a hack/trick or a hidden option to change the
 > > > name of wine in the proccess lists?
 > > > I mean, Is it possible to list 'wine' proccess as, for example
 > > > 'iexplorer' when I use Internet Explorer under Wine?
 > > >
 > > > Thanks a lot for your work, hope my question find the answer here.
 > >
 > > This is done since quite some time. apps are usually called
 > > "iexplore.exe", or they have the name of the file that was passed to
 > > wine, like C:\Program Files\Internet Explorer\iexplore.exe
 > >
 > > If you still see "wine", "wineloader" or something similar you have a
 > > very outdated version of wine.
 >
 > Well, im talking about Wine 0.9.48 under FreeBSD/PC-BSD OS.

Ow, ah, this is a different business. I think we use some Linux-only 
feature
to set the name, and Alexandre told me that at least MacOS doesn't have 
it. I
have no idea if there is a way to change the process name under BSD. If 
there
is, feel free to implement it and send a patch




From stefan at codeweavers.com  Tue Dec 11 15:41:07 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Tue, 11 Dec 2007 22:41:07 +0100
Subject: wine proccess list
In-Reply-To: <475F0128.3060605@pcbsd.com>
References: <475F0128.3060605@pcbsd.com>
Message-ID: <200712112241.10888.stefan@codeweavers.com>

Am Dienstag, 11. Dezember 2007 22:29:12 schrieb Kris Moore:
> Gonzalo sent me this thread, and I may be able to get a patch put
> together here soon. First, I wanted to make sure I'm on the right path:
>
> Can somebody confirm for me that this is the right location where I
> should be trying to fix this?
>
> http://source.winehq.org/source/loader/preloader.c#L1006
I am not familiar to this code unfortunately, so I cannot answer that. It 
might be that wine-preloader isn't used on BSD, it might use wine-kthread or 
wine-pthread instead

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071211/0961b86d/attachment.pgp 

From julliard at winehq.org  Tue Dec 11 15:51:29 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Tue, 11 Dec 2007 22:51:29 +0100
Subject: wine proccess list
In-Reply-To: <475EEC89.5050607@codeweavers.com> (Maarten Lankhorst's message
	of "Tue, 11 Dec 2007 21:01:13 +0100")
References: <EDB99C04-7455-4E75-89D2-FA485769A24F@pcbsd.es>
	<200712111934.52087.stefan@codeweavers.com>
	<200712112025.20589.g.martinez@pcbsd.es>
	<200712112038.27198.stefan@codeweavers.com>
	<475EEC89.5050607@codeweavers.com>
Message-ID: <87r6hshpcu.fsf@wine.dyndns.org>

Maarten Lankhorst <maarten at codeweavers.com> writes:

> Hi Gonzalo,
>
> Stefan D?singer schreef:
>> Ow, ah, this is a different business. I think we use some Linux-only feature 
>> to set the name, and Alexandre told me that at least MacOS doesn't have it. I 
>> have no idea if there is a way to change the process name under BSD. If there 
>> is, feel free to implement it and send a patch
>>   
> A slightly hacky method is to copy the process to /tmp, rename it and
> execute it there. It would work for mac and bsd, but I have no idea
> wether Alexandre would accept it into wine.

I wouldn't, but on FreeBSD you can use setproctitle() for this.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Tue Dec 11 15:56:32 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Tue, 11 Dec 2007 22:56:32 +0100
Subject: wine proccess list
In-Reply-To: <475F0128.3060605@pcbsd.com> (Kris Moore's message of "Tue, 11
	Dec 2007 16:29:12 -0500")
References: <475F0128.3060605@pcbsd.com>
Message-ID: <87mysghp4f.fsf@wine.dyndns.org>

Kris Moore <kris at pcbsd.com> writes:

> Gonzalo sent me this thread, and I may be able to get a patch put 
> together here soon. First, I wanted to make sure I'm on the right path:
>
> Can somebody confirm for me that this is the right location where I 
> should be trying to fix this?
>
> http://source.winehq.org/source/loader/preloader.c#L1006

No, the right place is set_process_name() in dlls/kernel32/process.c.

-- 
Alexandre Julliard
julliard at winehq.org


From aric at codeweavers.com  Tue Dec 11 19:00:07 2007
From: aric at codeweavers.com (Aric Stewart)
Date: Wed, 12 Dec 2007 10:00:07 +0900
Subject: imagehlp: improve last error handling in ImageGetCertificateData
In-Reply-To: <3a768c550712110714p5d9358dcv62e9cd6293643d1e@mail.gmail.com>
References: <3a768c550712110714p5d9358dcv62e9cd6293643d1e@mail.gmail.com>
Message-ID: <475F3297.3040207@codeweavers.com>

Humm,  I wrote a test program mimicking the calls in the application I 
am working on and found this behavior. The app was passing in a NULL 
buffer and a pointer for the size set to 0,  We where exiting with TRUE 
and not setting the last error correctly which was confusing the app. 
Testing on windows seems to show that we needed to set the size and set 
last error (and return FALSE).

I am not sure how i would set up a regression test since wouldn't we 
need an exe with a certificate in it to test with? There must be a 
programmatic way to set that up.

-aric

Juan Lang wrote:
> Hi Aric,
> 
> -    if( !Certificate )
> +    if( *RequiredLength < size )
>      {
>          *RequiredLength = size;
> -        return TRUE;
> +        SetLastError( ERROR_INSUFFICIENT_BUFFER );
> +        return FALSE;
>      }
> 
> -    if( *RequiredLength < size )
> +    if( !Certificate )
>      {
>          *RequiredLength = size;
> -        SetLastError( ERROR_INSUFFICIENT_BUFFER );
> -        return FALSE;
> +        return TRUE;
>      }
> 
> Are you sure this is the order that *RequiredLength and Certificate
> are checked in?  Seems backwards to the normal style to me.  I won't
> bug you for a proper regression test, as I failed to produce one too
> :)
> --Juan
> 
> 



From juan.lang at gmail.com  Tue Dec 11 19:49:43 2007
From: juan.lang at gmail.com (Juan Lang)
Date: Tue, 11 Dec 2007 17:49:43 -0800
Subject: imagehlp: improve last error handling in ImageGetCertificateData
In-Reply-To: <475F3297.3040207@codeweavers.com>
References: <3a768c550712110714p5d9358dcv62e9cd6293643d1e@mail.gmail.com>
	<475F3297.3040207@codeweavers.com>
Message-ID: <3a768c550712111749s7a796a7bv86d89a2a90ab2b47@mail.gmail.com>

> Humm,  I wrote a test program mimicking the calls in the application I
> am working on and found this behavior. The app was passing in a NULL
> buffer and a pointer for the size set to 0,  We where exiting with TRUE
> and not setting the last error correctly which was confusing the app.

In that case, this part of the patch is still suspect:

-    if( *RequiredLength < size )
+    if( !Certificate )
     {
         *RequiredLength = size;
-        SetLastError( ERROR_INSUFFICIENT_BUFFER );
-        return FALSE;
+        return TRUE;

I'm not sure how Windows behaves in this case, but if it returns FALSE
(ERROR_INSUFFICIENT_BUFFER) when Certificate is NULL and
*RequiredLength is 0, I'd be surprised if it returned TRUE when
Certificate is NULL and *RequiredLength is large enough.

> I am not sure how i would set up a regression test since wouldn't we
> need an exe with a certificate in it to test with? There must be a
> programmatic way to set that up.

Indeed, I thought the same thing, and tried copying in bits from
kernel32/tests/process.c to create an image.  I failed to create one
that Windows would accept, so I gave up.  You can blame that on my
laziness, though.  Feel free to try yourself.
--Juan


From aric at codeweavers.com  Tue Dec 11 19:57:55 2007
From: aric at codeweavers.com (Aric Stewart)
Date: Wed, 12 Dec 2007 10:57:55 +0900
Subject: imagehlp: improve last error handling in ImageGetCertificateData
In-Reply-To: <3a768c550712111749s7a796a7bv86d89a2a90ab2b47@mail.gmail.com>
References: <3a768c550712110714p5d9358dcv62e9cd6293643d1e@mail.gmail.com>	
	<475F3297.3040207@codeweavers.com>
	<3a768c550712111749s7a796a7bv86d89a2a90ab2b47@mail.gmail.com>
Message-ID: <475F4023.3050705@codeweavers.com>

Indeed testing with my test app i see that if the Len is sufficient but 
the buffer is null i get a return of FALSE and a last error of 
ERROR_INVALID_PARAMETER.  I will update my patch.

-aric

Juan Lang wrote:
>> Humm,  I wrote a test program mimicking the calls in the application I
>> am working on and found this behavior. The app was passing in a NULL
>> buffer and a pointer for the size set to 0,  We where exiting with TRUE
>> and not setting the last error correctly which was confusing the app.
> 
> In that case, this part of the patch is still suspect:
> 
> -    if( *RequiredLength < size )
> +    if( !Certificate )
>      {
>          *RequiredLength = size;
> -        SetLastError( ERROR_INSUFFICIENT_BUFFER );
> -        return FALSE;
> +        return TRUE;
> 
> I'm not sure how Windows behaves in this case, but if it returns FALSE
> (ERROR_INSUFFICIENT_BUFFER) when Certificate is NULL and
> *RequiredLength is 0, I'd be surprised if it returned TRUE when
> Certificate is NULL and *RequiredLength is large enough.
> 
>> I am not sure how i would set up a regression test since wouldn't we
>> need an exe with a certificate in it to test with? There must be a
>> programmatic way to set that up.
> 
> Indeed, I thought the same thing, and tried copying in bits from
> kernel32/tests/process.c to create an image.  I failed to create one
> that Windows would accept, so I gave up.  You can blame that on my
> laziness, though.  Feel free to try yourself.
> --Juan
> 



From dank06 at kegel.com  Tue Dec 11 22:11:23 2007
From: dank06 at kegel.com (Dan Kegel)
Date: Tue, 11 Dec 2007 20:11:23 -0800
Subject: Valgrind results Dec 11: new quartz/filtergraph crash (oh, Lei...)
Message-ID: <a71bd89a0712112011u467654dfp1e9f47e4a4c4984e@mail.gmail.com>

New results at
http://kegel.com/wine/valgrind/logs-2007-12-11-summary.txt
The changes from yesterday are probably noise except:

The tests crashed and valgrind hung while running the
quartz/filtergraph test; see
http://kegel.com/wine/valgrind/logs-2007-12-11/vg-quartz_filtergraph-diff.txt

+Unhandled exception: page fault on read access to 0xffffffff in
32-bit code (0x045e1290).
+Backtrace:
+=>1 0x045e1290 func_filtergraph+0x110()
[/home/dank/wine-git/dlls/quartz/tests/filtergraph.c:161] in
quartz_test (0x7f22fe58)
+  2 0x045e20e8 run_test+0x128(name=0x7f0003f7)
[/home/dank/wine-git/dlls/quartz/tests/../../../include/wine/test.h:389]
in quartz_test (0x7f22fea8)
+  3 0x045e277d main+0x14d(argc=<register ECX not in topmost frame>,
argv=<register ECX not in topmost frame>)
[/home/dank/wine-git/dlls/quartz/tests/../../../include/wine/test.h:437]
in quartz_test (0x7f22fed8)
+  4 0x045e284b __wine_spec_exe_entry+0x5b(peb=0x7ffdf000)
[/home/dank/wine-git/dlls/winecrt0/exe_entry.c:36] in quartz_test
(0x7f22ff08)
+  5 0x045198be start_process+0xee(arg=0x0)
[/home/dank/wine-git/dlls/kernel32/process.c:839] in kernel32
(0x7f22ffe8)
+  6 0x0402c9e7 wine_switch_to_stack+0x17() in libwine.so.1 (0x00000000)
+0x045e1290 func_filtergraph+0x110
[/home/dank/wine-git/dlls/quartz/tests/filtergraph.c:161] in
quartz_test: movl	0x0(%eax),%edx
+161	    hr = IFilterGraph2_Release(pF);

Lei, could you have a look?  You were just in here...
- Dan


From patrol at sinus.cz  Tue Dec 11 23:07:15 2007
From: patrol at sinus.cz (Pavel Troller)
Date: Wed, 12 Dec 2007 06:07:15 +0100
Subject: wine proccess list
In-Reply-To: <200712111934.52087.stefan@codeweavers.com>
References: <EDB99C04-7455-4E75-89D2-FA485769A24F@pcbsd.es>
	<200712111934.52087.stefan@codeweavers.com>
Message-ID: <20071212050715.GA25501@tangens.sinus.cz>

> Am Dienstag, 11. Dezember 2007 18:02:53 schrieb Gonzalo Martinez - Sanjuan 
> Sanchez:
> > Hello to all.
> >
> > I have something in mind that I would like to ask to Wine developers.
> > Is it possible using a hack/trick or a hidden option to change the
> > name of wine in the proccess lists?
> > I mean, Is it possible to list 'wine' proccess as, for example
> > 'iexplorer' when I use Internet Explorer under Wine?
> >
> > Thanks a lot for your work, hope my question find the answer here.
> This is done since quite some time. apps are usually called "iexplore.exe", or 
> they have the name of the file that was passed to wine, like C:\Program 
> Files\Internet Explorer\iexplore.exe
> 
> If you still see "wine", "wineloader" or something similar you have a very 
> outdated version of wine.
Hi!
  BTW I don't like this feature and I would prefer at least a commandline 
switch, or maybe a registry key, to prevent it.
  Why ?
  Because wine (and windows apps) sometimes crash and remain running, doing
nothing useful but eating CPU/memory, and not being able to be killed easily
(even killing the window doesn't close the app reliably). For this case, it's
most easy to execute "killall -KILL <some static name like wine/wine-pthread>"
instead of doing ps axufw, searching for the name of the app and then killing
it. I had a single-liner script called kw (kill wine) and doing exactly the
above command, and a beutifull bomb icon calling it. Now I can't se it - even
killing wineserver sometimes doesn't help.
  With regards, Pavel Troller


> 



From dmitry at codeweavers.com  Tue Dec 11 23:14:50 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Wed, 12 Dec 2007 13:14:50 +0800
Subject: Valgrind results Dec 11: new quartz/filtergraph crash (oh, Lei...)
References: <a71bd89a0712112011u467654dfp1e9f47e4a4c4984e@mail.gmail.com>
Message-ID: <006701c83c7d$ee0eb920$a600fea9@DMITRY>

"Dan Kegel" <dank06 at kegel.com> wrote:

> New results at
> http://kegel.com/wine/valgrind/logs-2007-12-11-summary.txt
> The changes from yesterday are probably noise except:

I wonder why 
http://kegel.com/wine/valgrind/logs-2007-12-11/vg-kernel32_virtual.txt
still shows NTDLL_queue_process_apc as an offender since Alexandre committed
my patch which supposedly should fix that.

-- 
Dmitry.


From chris.kcat at gmail.com  Tue Dec 11 23:53:01 2007
From: chris.kcat at gmail.com (Chris Robinson)
Date: Tue, 11 Dec 2007 21:53:01 -0800
Subject: wine proccess list
In-Reply-To: <20071212050715.GA25501@tangens.sinus.cz>
References: <EDB99C04-7455-4E75-89D2-FA485769A24F@pcbsd.es>
	<200712111934.52087.stefan@codeweavers.com>
	<20071212050715.GA25501@tangens.sinus.cz>
Message-ID: <200712112153.01225.chris.kcat@gmail.com>

On Tuesday 11 December 2007 09:07:15 pm Pavel Troller wrote:
>   Because wine (and windows apps) sometimes crash and remain running, doing
> nothing useful but eating CPU/memory, and not being able to be killed
> easily (even killing the window doesn't close the app reliably). For this
> case, it's most easy to execute "killall -KILL <some static name like
> wine/wine-pthread>" instead of doing ps axufw, searching for the name of
> the app and then killing it. I had a single-liner script called kw (kill
> wine) and doing exactly the above command, and a beutifull bomb icon
> calling it. Now I can't se it - even killing wineserver sometimes doesn't
> help.

IIRC, running 'wineserver -k' will kill wineserver and its processes. It's 
always worked for me, even on apparently stuck programs.

Though both methods (killall with a static wine process name and 
wineserver -k) will kill all wine/windows processes, even ones that are 
running fine. It's easier to killall a specific .exe named process, than 
using ps -fel to look for the PID and using regular kill on it.


From the3dfxdude at gmail.com  Tue Dec 11 23:52:26 2007
From: the3dfxdude at gmail.com (Jesse Allen)
Date: Tue, 11 Dec 2007 22:52:26 -0700
Subject: [5/5] gdi: Test bitmap depths
In-Reply-To: <200712112131.39384.stefan@codeweavers.com>
References: <200712112131.39384.stefan@codeweavers.com>
Message-ID: <530468570712112152t1bfcd73fy70627331ba661749@mail.gmail.com>

This is good since 15-bpp DIB is not supported in my DIB engine. As it
is right now, the 15-bit DIB stuff in winex11/gdi is not really
correct (even if it might work).

On Dec 11, 2007 1:31 PM, Stefan D?singer <stefan at codeweavers.com> wrote:
>
>
>
>
>


From research at science.su  Wed Dec 12 00:27:59 2007
From: research at science.su (L. Rahyen)
Date: Wed, 12 Dec 2007 06:27:59 +0000
Subject: wine proccess list
In-Reply-To: <20071212050715.GA25501@tangens.sinus.cz>
References: <EDB99C04-7455-4E75-89D2-FA485769A24F@pcbsd.es>
	<200712111934.52087.stefan@codeweavers.com>
	<20071212050715.GA25501@tangens.sinus.cz>
Message-ID: <200712120628.01077.research@science.su>

On Wednesday December 12 2007 05:07, Pavel Troller wrote:
> > Am Dienstag, 11. Dezember 2007 18:02:53 schrieb Gonzalo Martinez -
> > Sanjuan
> >
> > Sanchez:
> > > Hello to all.
> > >
> > > I have something in mind that I would like to ask to Wine developers.
> > > Is it possible using a hack/trick or a hidden option to change the
> > > name of wine in the proccess lists?
> > > I mean, Is it possible to list 'wine' proccess as, for example
> > > 'iexplorer' when I use Internet Explorer under Wine?
> > >
> > > Thanks a lot for your work, hope my question find the answer here.
> >
> > This is done since quite some time. apps are usually called
> > "iexplore.exe", or they have the name of the file that was passed to
> > wine, like C:\Program Files\Internet Explorer\iexplore.exe
> >
> > If you still see "wine", "wineloader" or something similar you have a
> > very outdated version of wine.
>
> Hi!
>   BTW I don't like this feature and I would prefer at least a commandline
> switch, or maybe a registry key, to prevent it.
>   Why ?
>   Because wine (and windows apps) sometimes crash and remain running, doing
> nothing useful but eating CPU/memory, and not being able to be killed
> easily (even killing the window doesn't close the app reliably). For this
> case, it's most easy to execute "killall -KILL <some static name like
> wine/wine-pthread>" instead of doing ps axufw, searching for the name of
> the app and then killing it. I had a single-liner script called kw (kill
> wine) and doing exactly the above command, and a beutifull bomb icon
> calling it. Now I can't se it - even killing wineserver sometimes doesn't
> help.

	You can simply run:

wineserver -k

	This kills all processes which belongs to current WINE prefix (as specified 
in WINEPREFIX environment variable or ~/.wine otherwise). For me this works 
in 100% of cases so I see no problem here.
	Personally I really like this feature because I always know what Windows 
program(s) use my CPU and I can easily send STOP/CONT/KILL signals to Windows 
program(s) I want. Without this features this would be (almost) impossible.


From stefan at codeweavers.com  Wed Dec 12 01:14:41 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Wed, 12 Dec 2007 08:14:41 +0100
Subject: [5/5] gdi: Test bitmap depths
In-Reply-To: <530468570712112152t1bfcd73fy70627331ba661749@mail.gmail.com>
References: <200712112131.39384.stefan@codeweavers.com>
	<530468570712112152t1bfcd73fy70627331ba661749@mail.gmail.com>
Message-ID: <200712120814.44250.stefan@codeweavers.com>

Am Mittwoch, 12. Dezember 2007 06:52:26 schrieb Jesse Allen:
> This is good since 15-bpp DIB is not supported in my DIB engine. As it
> is right now, the 15-bit DIB stuff in winex11/gdi is not really
> correct (even if it might work).
It is the intention of this patch, and coming ones, to clean up the 24/32 bpp 
mess, also with regard to 15/16 bpp confusion, although I am missing hardware 
capable of running X at depth 15 for testing, so it will be mainly about the 
24/32 bpp differences which break some games.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071212/925785ff/attachment.pgp 

From thestig at google.com  Wed Dec 12 01:34:54 2007
From: thestig at google.com (Lei Zhang)
Date: Tue, 11 Dec 2007 23:34:54 -0800
Subject: Valgrind results Dec 11: new quartz/filtergraph crash (oh, Lei...)
In-Reply-To: <a71bd89a0712112011u467654dfp1e9f47e4a4c4984e@mail.gmail.com>
References: <a71bd89a0712112011u467654dfp1e9f47e4a4c4984e@mail.gmail.com>
Message-ID: <558b2f5c0712112334m2cd4b87bra04ac95af864f89d@mail.gmail.com>

On Dec 11, 2007 8:11 PM, Dan Kegel <dank06 at kegel.com> wrote:
> New results at
> http://kegel.com/wine/valgrind/logs-2007-12-11-summary.txt
> The changes from yesterday are probably noise except:
>
> The tests crashed and valgrind hung while running the
> quartz/filtergraph test; see
> http://kegel.com/wine/valgrind/logs-2007-12-11/vg-quartz_filtergraph-diff.txt
>
> +Unhandled exception: page fault on read access to 0xffffffff in
> 32-bit code (0x045e1290).
> +Backtrace:
> +=>1 0x045e1290 func_filtergraph+0x110()
> [/home/dank/wine-git/dlls/quartz/tests/filtergraph.c:161] in
> quartz_test (0x7f22fe58)
> +  2 0x045e20e8 run_test+0x128(name=0x7f0003f7)
> [/home/dank/wine-git/dlls/quartz/tests/../../../include/wine/test.h:389]
> in quartz_test (0x7f22fea8)
> +  3 0x045e277d main+0x14d(argc=<register ECX not in topmost frame>,
> argv=<register ECX not in topmost frame>)
> [/home/dank/wine-git/dlls/quartz/tests/../../../include/wine/test.h:437]
> in quartz_test (0x7f22fed8)
> +  4 0x045e284b __wine_spec_exe_entry+0x5b(peb=0x7ffdf000)
> [/home/dank/wine-git/dlls/winecrt0/exe_entry.c:36] in quartz_test
> (0x7f22ff08)
> +  5 0x045198be start_process+0xee(arg=0x0)
> [/home/dank/wine-git/dlls/kernel32/process.c:839] in kernel32
> (0x7f22ffe8)
> +  6 0x0402c9e7 wine_switch_to_stack+0x17() in libwine.so.1 (0x00000000)
> +0x045e1290 func_filtergraph+0x110
> [/home/dank/wine-git/dlls/quartz/tests/filtergraph.c:161] in
> quartz_test: movl       0x0(%eax),%edx
> +161        hr = IFilterGraph2_Release(pF);
>
> Lei, could you have a look?  You were just in here...
> - Dan
>

It looks as though you're running the current test with an older quartz.dll.so.

http://kegel.com/wine/valgrind/logs-2007-12-11/vg-quartz_filtergraph.txt says:

fixme:quartz:Filtergraph_QueryInterface unknown interface
{36b73882-c2c8-11cf-8b46-00805f6cef60}

the patch that fixed that also added the test that caused your crash.


From dmitry at codeweavers.com  Wed Dec 12 03:15:32 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Wed, 12 Dec 2007 17:15:32 +0800
Subject: [5/5] gdi: Test bitmap depths
References: <200712112131.39384.stefan@codeweavers.com>
Message-ID: <007501c83c9f$8db783a0$a600fea9@DMITRY>

Stefan Doesinger <stefan at codeweavers.com> wrote:

> This obsolettes the 15 bpp bitmap and 16 bpp screen compatibility since
> 15 bpp bitmaps do not exist.

15 bpp bitmaps do exist. According to the Feng Yuan's book that depends on
the driver and hardware.

-- 
Dmitry.


From luis.busquets at ilidium.com  Wed Dec 12 03:18:52 2007
From: luis.busquets at ilidium.com (luis.busquets at ilidium.com)
Date: Wed, 12 Dec 2007 10:18:52 +0100 (CET)
Subject: hlsl2glsl
In-Reply-To: <200712101541.51659.stefan@codeweavers.com>
References: <25721.158.169.131.14.1197275054.squirrel@www.ilidium.com>
	<20071210084208.278140@gmx.net>
	<20176.158.169.131.14.1197293026.squirrel@www.ilidium.com>
	<200712101541.51659.stefan@codeweavers.com>
Message-ID: <36227.158.169.9.14.1197451132.squirrel@www.ilidium.com>

Just to add that msdn states that

"Direct3D 10 limits the use of assembly language to that of debugging
purposes only, therefore any hand written assembly shaders used in
Direct3D 9 will need to be converted to HLSL."

http://msdn2.microsoft.com/en-us/library/bb205073.aspx#Porting_Shaders

I think that the idea is that the dreiver vendor has the possibility to
implement its own compiler and adapt the code to the specifics of its
hardware. I think that translating HLSL to GLSL for D3D10 is the write
path. (For D3D9 obviously not) Therefore I think that it should be wine 's
strategy towars the implementation of this next D3D release.

> That HLSL2GLSL is written by ATI is absolutely no issue. It is released
> under
> an open source license and we can make use of the code. The philosophy you
> suggest is more of a problem.
>
> Keep in mind that getting shaders translated into GLSL, which we can then
> send
> to the card, is only a small part of the whole dx10 topic. We will need
> our
> own codepath anyway(HLSL -> d3d asm -> GLSL). We have to investigate
> wether a
> direct HLSL -> GLSL path will gain us any performance. We can optimize the
> HLSL -> d3d asm ourselves, and the d3d asm->GLSL->card native code is
> lossless in theory. If the GLSL compiler is good, then it will recognise
> the
> assembler instructions in our GLSL code and essentially we have d3d asm ->
> card native then.
>
> We will have to investigate what we gain with a 2nd direct HLSL->GLSL
> translation. I think we won't gain anything, and the effort is better
> spent
> elsewhere.
>
> Also, the card never compiles shaders. This is always done on the CPU.
>




From hverbeet at gmail.com  Wed Dec 12 03:33:39 2007
From: hverbeet at gmail.com (H. Verbeet)
Date: Wed, 12 Dec 2007 10:33:39 +0100
Subject: hlsl2glsl
In-Reply-To: <36227.158.169.9.14.1197451132.squirrel@www.ilidium.com>
References: <25721.158.169.131.14.1197275054.squirrel@www.ilidium.com>
	<20071210084208.278140@gmx.net>
	<20176.158.169.131.14.1197293026.squirrel@www.ilidium.com>
	<200712101541.51659.stefan@codeweavers.com>
	<36227.158.169.9.14.1197451132.squirrel@www.ilidium.com>
Message-ID: <d658b69e0712120133o1e2d376br4a75ae20b222e844@mail.gmail.com>

On 12/12/2007, luis.busquets at ilidium.com <luis.busquets at ilidium.com> wrote:
> Just to add that msdn states that
>
> "Direct3D 10 limits the use of assembly language to that of debugging
> purposes only, therefore any hand written assembly shaders used in
> Direct3D 9 will need to be converted to HLSL."
>
> http://msdn2.microsoft.com/en-us/library/bb205073.aspx#Porting_Shaders
>
> I think that the idea is that the dreiver vendor has the possibility to
> implement its own compiler and adapt the code to the specifics of its
> hardware. I think that translating HLSL to GLSL for D3D10 is the write
> path. (For D3D9 obviously not) Therefore I think that it should be wine 's
> strategy towars the implementation of this next D3D release.
>
No, that's not how it works.

The device functions that create shaders still get fed bytecode, and
it would at least in theory be possible to create an assembler for
that bytecode. See
http://msdn2.microsoft.com/en-us/library/bb205084.aspx and
http://msdn2.microsoft.com/en-us/library/bb173562.aspx for example.
Also potentially interesting is
http://msdn2.microsoft.com/en-us/library/bb310589.aspx


From stefan at codeweavers.com  Wed Dec 12 06:28:00 2007
From: stefan at codeweavers.com (Stefan =?utf-8?q?D=C3=B6singer?=)
Date: Wed, 12 Dec 2007 13:28:00 +0100
Subject: [5/5] gdi: Test bitmap depths
In-Reply-To: <007501c83c9f$8db783a0$a600fea9@DMITRY>
References: <200712112131.39384.stefan@codeweavers.com>
	<007501c83c9f$8db783a0$a600fea9@DMITRY>
Message-ID: <200712121328.06717.stefan@codeweavers.com>

Am Mittwoch, 12. Dezember 2007 10:15:32 schrieb Dmitry Timoshkov:
> Stefan Doesinger <stefan at codeweavers.com> wrote:
> > This obsolettes the 15 bpp bitmap and 16 bpp screen compatibility since
> > 15 bpp bitmaps do not exist.
>
> 15 bpp bitmaps do exist. According to the Feng Yuan's book that depends on
> the driver and hardware.
Do you have any driver / hardware where we could verify or falsify that?
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071212/788508f9/attachment.pgp 

From julliard at winehq.org  Wed Dec 12 07:01:03 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 12 Dec 2007 14:01:03 +0100
Subject: #2 usp10: Do glyph translation for truetype fonts only.
In-Reply-To: <200712121044.58425.hans@it.vu.nl> (Hans Leidekker's message of
	"Wed, 12 Dec 2007 10:44:58 +0100")
References: <200712121044.58425.hans@it.vu.nl>
Message-ID: <87sl28qd80.fsf@wine.dyndns.org>

Hans Leidekker <hans at it.vu.nl> writes:

> Changelog
>  Do glyph translation for truetype fonts only.

This fails here:

../../../tools/runtest -q -P wine -M usp10.dll -T ../../.. -p usp10_test.exe.so usp10.c && touch usp10.ok
usp10.c:217: Test failed: Translation to place when told not to. WCHAR 0 - 0054 != 0037
make[2]: *** [usp10.ok] Error 1

-- 
Alexandre Julliard
julliard at winehq.org


From dank at kegel.com  Wed Dec 12 07:56:11 2007
From: dank at kegel.com (Dan Kegel)
Date: Wed, 12 Dec 2007 05:56:11 -0800
Subject: Valgrind results Dec 11: new quartz/filtergraph crash (oh, Lei...)
In-Reply-To: <558b2f5c0712112334m2cd4b87bra04ac95af864f89d@mail.gmail.com>
References: <a71bd89a0712112011u467654dfp1e9f47e4a4c4984e@mail.gmail.com>
	<558b2f5c0712112334m2cd4b87bra04ac95af864f89d@mail.gmail.com>
Message-ID: <a71bd89a0712120556v66e610bbo58b833f4e6c38b05@mail.gmail.com>

On Dec 11, 2007 11:34 PM, Lei Zhang <thestig at google.com> wrote:
> It looks as though you're running the current test with an older quartz.dll.so.

I'd better add a 'make clean' to my automated script.
And for that matter, a "rm -rf ~/.wine".
- Dan


From dmitry at codeweavers.com  Wed Dec 12 09:15:11 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Wed, 12 Dec 2007 23:15:11 +0800
Subject: [5/5] gdi: Test bitmap depths
References: <200712112131.39384.stefan@codeweavers.com><007501c83c9f$8db783a0$a600fea9@DMITRY>
	<200712121328.06717.stefan@codeweavers.com>
Message-ID: <002201c83cd1$cbcab4f0$a600fea9@DMITRY>

"Stefan D?singer" <stefan at codeweavers.com> wrote:

> > Stefan Doesinger <stefan at codeweavers.com> wrote:
> > > This obsolettes the 15 bpp bitmap and 16 bpp screen compatibility since
> > > 15 bpp bitmaps do not exist.
> >
> > 15 bpp bitmaps do exist. According to the Feng Yuan's book that depends on
> > the driver and hardware.
> Do you have any driver / hardware where we could verify or falsify that?

No, I don't. I'd say that even with a technically 15 bpp screen depth
video memory organization a driver would still say "16" in the user
visible settings to avoid a possible user confusion, but report "15"
on the API level.

A google search "15 bpp screen depth site:microsoft.com" finds some info
about this.

-- 
Dmitry. 



From stefan at codeweavers.com  Wed Dec 12 10:34:07 2007
From: stefan at codeweavers.com (Stefan =?utf-8?q?D=C3=B6singer?=)
Date: Wed, 12 Dec 2007 17:34:07 +0100
Subject: [5/5] gdi: Test bitmap depths
In-Reply-To: <002201c83cd1$cbcab4f0$a600fea9@DMITRY>
References: <200712112131.39384.stefan@codeweavers.com>
	<200712121328.06717.stefan@codeweavers.com>
	<002201c83cd1$cbcab4f0$a600fea9@DMITRY>
Message-ID: <200712121734.10844.stefan@codeweavers.com>

Am Mittwoch, 12. Dezember 2007 16:15:11 schrieb Dmitry Timoshkov:
> No, I don't. I'd say that even with a technically 15 bpp screen depth
> video memory organization a driver would still say "16" in the user
> visible settings to avoid a possible user confusion, but report "15"
> on the API level.
>
> A google search "15 bpp screen depth site:microsoft.com" finds some info
> about this.
Most of the pages found are about Windows CE / Windows Mobile, and others 
contain the words "15" and "bpp" without any connection between them. The 
only interesting bit I found was the first hit, which states that "15 bpp" 
translates to "32,768 (32K) colors".

However, some pages which look Windows Mobile related suggst that the remote 
desktop feature can be configured to use 15 bpp. Maybe we can set a terminal 
server into that mode and see what the API returns?

Another disturbing thing about 15 bpp is the complete lack of 15 bpp formats 
in the DirectX API.

Also, if Windows supports 15 bpp displays, why does a normal Windows refuse to 
create 15 bpp bitmaps? Even if it is running at 8, 16, 24 or 32 bpp, it 
accepts 1, 4, 8, 16, 24 and 32 bit bitmaps, but never 15 bit ones.

Perhaps 15 bpp is one of the features that were once planned, so Feng Juan 
wrote about it, but no driver uses it and it is dead and nonfunctional in all 
Windows versions?
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071212/fb7078e3/attachment.pgp 

From juan.lang at gmail.com  Wed Dec 12 11:26:23 2007
From: juan.lang at gmail.com (Juan Lang)
Date: Wed, 12 Dec 2007 09:26:23 -0800
Subject: Undocumented behaviour in ReqQueryValueEx when 'count' and 'type'
	point to the same address
Message-ID: <3a768c550712120926l46061045qd8108303dc815a47@mail.gmail.com>

Hi Sam,

-    DWORD total_size;
+    DWORD total_size, datalen;
(snip)
+    if (count) datalen = *count;
(snip)
-                if (len > *count) status = STATUS_BUFFER_OVERFLOW;
+                if (len > datalen) status = STATUS_BUFFER_OVERFLOW;

I mentioned when I reviewed the patch that datalen might be
uninitialized.  You're right that it isn't, since it's set when count
is not NULL, and read when data is not NULL.  The function fails
earlier if data is not NULL and count is NULL, so again, you're right:
 it isn't uninitialized when it's read.

Nevertheless, it took a pretty in-depth read to check that, and the
patch introduces an unneeded warning.  You can avoid it simply, so
please do.
--Juan


From geoff at dyalog.com  Wed Dec 12 03:00:50 2007
From: geoff at dyalog.com (Geoff Streeter)
Date: Wed, 12 Dec 2007 09:00:50 +0000
Subject: [Wine] wine proccess list
In-Reply-To: <475EEC89.5050607@codeweavers.com>
References: <EDB99C04-7455-4E75-89D2-FA485769A24F@pcbsd.es>
	<200712111934.52087.stefan@codeweavers.com>
	<200712112025.20589.g.martinez@pcbsd.es>
	<200712112038.27198.stefan@codeweavers.com>
	<475EEC89.5050607@codeweavers.com>
Message-ID: <mailman.124.1197483623.6275.wine-devel@winehq.org>

At 2007-12-11 20:01, Maarten Lankhorst wrote:
>Hi Gonzalo,
>
>Stefan D?singer schreef:
> > Ow, ah, this is a different business. I think 
> we use some Linux-only feature
> > to set the name, and Alexandre told me that 
> at least MacOS doesn't have it. I
> > have no idea if there is a way to change the 
> process name under BSD. If there
> > is, feel free to implement it and send a patch
> >
>A slightly hacky method is to copy the process to /tmp, rename it and
>execute it there. It would work for mac and bsd, but I have no idea
>wether Alexandre would accept it into wine.
>
>Cheers,
>Maarten.
>
>_______________________________________________
>wine-users mailing list
>wine-users at winehq.org
>http://www.winehq.org/mailman/listinfo/wine-users

Every time you installed a new app to run under 
wine you could create a new hard link for wine 
which had the requisite name. Use that name to 
start wine and hay presto that's the name in the ps listing.

Warning: be very careful when you update wine 
that you keep the same inode number otherwise all 
of the links will point to the old wine. Or give 
yourself a directory like 
/usr/local/bin/wineapps, put the links in there. 
Put it on your PATH. Then when you update wine, 
run a simple script to relink them to the new wine.

Geoff  



From the3dfxdude at gmail.com  Wed Dec 12 14:26:14 2007
From: the3dfxdude at gmail.com (Jesse Allen)
Date: Wed, 12 Dec 2007 13:26:14 -0700
Subject: [5/5] gdi: Test bitmap depths
In-Reply-To: <007501c83c9f$8db783a0$a600fea9@DMITRY>
References: <200712112131.39384.stefan@codeweavers.com>
	<007501c83c9f$8db783a0$a600fea9@DMITRY>
Message-ID: <530468570712121226q2eef44cai79dfb59ecf8c225a@mail.gmail.com>

On Dec 12, 2007 2:15 AM, Dmitry Timoshkov <dmitry at codeweavers.com> wrote:
> Stefan Doesinger <stefan at codeweavers.com> wrote:
>
> > This obsolettes the 15 bpp bitmap and 16 bpp screen compatibility since
> > 15 bpp bitmaps do not exist.
>
> 15 bpp bitmaps do exist. According to the Feng Yuan's book that depends on
> the driver and hardware.
>


I almost bought that book, but got another one, unfortunately. There
are "15-bpp" bitmaps, but they are padded with an extra bit. Windows
does not have true 15-bpp aligned bitmaps. There are graphics cards
that do 15-bpp too, whether they do not have 16-bit screen depths I
don't know. I think windows obfuscates them and calls them all 16-bit
in gdi whether it does 15 or 16, and then it is up to the driver to do
it correctly. Unfortunately I do not have a card anymore that can do
15-bit modes.

Anyway if you try to select in a bitmap that says it is 15-bpp in the
format on windows, it will fail. Wine does not, and we probably need
test cases like this.


From stefan at codeweavers.com  Wed Dec 12 15:47:26 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Wed, 12 Dec 2007 22:47:26 +0100
Subject: Patch for process title on FreeBSD
In-Reply-To: <47601F6F.1010504@pcbsd.com>
References: <47601F6F.1010504@pcbsd.com>
Message-ID: <200712122247.48041.stefan@codeweavers.com>

Am Mittwoch, 12. Dezember 2007 18:50:39 schrieb Kris Moore:
> Hey all!
>
> One of our devs noticed that on FreeBSD we don't get the process name
> set properly, so in "ps" we get a lot of wine-pthread garbage. Here's a
> small patch to fix this in dlls/kernel32/process.c
>
> I tried to make this as small & simple as possible, please let me know
> what you think!
I think using argv[1] is not the best way, as some wine parameter might be 
added in the future, or someone might use something like binfmt_misc on Linux 
to launch the app. In that case the .exe name is propably argv[0], but I am 
not sure.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071212/6c3374ef/attachment.pgp 

From kris at pcbsd.com  Wed Dec 12 15:56:35 2007
From: kris at pcbsd.com (Kris Moore)
Date: Wed, 12 Dec 2007 16:56:35 -0500
Subject: Patch for process title on FreeBSD
In-Reply-To: <200712122247.48041.stefan@codeweavers.com>
References: <47601F6F.1010504@pcbsd.com>
	<200712122247.48041.stefan@codeweavers.com>
Message-ID: <47605913.3080005@pcbsd.com>







Stefan D?singer wrote:
> Am Mittwoch, 12. Dezember 2007 18:50:39 schrieb Kris Moore:
>> Hey all!
>>
>> One of our devs noticed that on FreeBSD we don't get the process name
>> set properly, so in "ps" we get a lot of wine-pthread garbage. Here's a
>> small patch to fix this in dlls/kernel32/process.c
>>
>> I tried to make this as small & simple as possible, please let me know
>> what you think!
> I think using argv[1] is not the best way, as some wine parameter might be 
> added in the future, or someone might use something like binfmt_misc on Linux 
> to launch the app. In that case the .exe name is propably argv[0], but I am 
> not sure.

Any suggestions on how we should weed through this / add this function? 
It looks like the rest of the function assumes removing argv[0] as well, 
if I'm reading it right.

I've tested this fix out on FreeBSD here, and it looks like it works, 
showing a process as the actual win exe instead of wine-pthread now.



-- 

Kris Moore
PC-BSD Software
http://www.pcbsd.com


From juan.lang at gmail.com  Wed Dec 12 22:18:29 2007
From: juan.lang at gmail.com (Juan Lang)
Date: Wed, 12 Dec 2007 20:18:29 -0800
Subject: [3/4] WineX11: Ignore the alpha if all pixels are 0x00
Message-ID: <3a768c550712122018k19fb800cu14b3bff5a1308025@mail.gmail.com>

Hi Stefan, a few minor nits:

+     * one pixel has alpha != 0x00, and the mask ignored as described in the

Do you mean, "the mask is ignored...", or "the AND mask is ignored..." ?

+     * written at 8 / 16 bpp times do not knwow about the 32 bit alpha, so

s/knwow/know/

+        for (y = 0; y < ymax; ++y)
+        {
+            xor_ptr = xor_bits + (y * xor_width_bytes);
+            for (x = 0; x < xmax; ++x)
+            {
+                if(xor_ptr[3] != 0x00) {
+                    alpha_zero = FALSE;
+                    break;

For the first for loop, you probably want something like (for y = 0;
alpha_zero && y < ymax...
Also, the whitespace around the if is a bit funny.
--Juan


From aric at codeweavers.com  Thu Dec 13 00:15:16 2007
From: aric at codeweavers.com (Aric Stewart)
Date: Thu, 13 Dec 2007 15:15:16 +0900
Subject: shdocvw #3: Set default home and search page.
In-Reply-To: <475540EB.6080401@codeweavers.com>
References: <473F3AF8.1050201@codeweavers.com>		<4754D893.4010406@codeweavers.com>		<19e31a080712040252w4b9d63f3w1d0efd66e41cb25b@mail.gmail.com>		<47553258.8060401@codeweavers.com>	<19e31a080712040301o30446a33u7635a2c594e72674@mail.gmail.com>	<475534AB.4050807@codeweavers.com>	<47553964.4010505@codeweavers.com>	<47553A51.6090300@codeweavers.com>
	<475540EB.6080401@codeweavers.com>
Message-ID: <4760CDF4.2010703@codeweavers.com>

Other side effect of the new code in shdocvw.inf  is that it causes the 
path in Internet Explorer shortcuts to be created incorrectly and 
invalidly making IE unable to launch from its link file.

I would suggest all that IE registration stuff go into our iexplore.exe 
instead of shdocvw.dll.
Either that or we move the registration of shdocvw.dll into win2000 
bottles only where IE does not install anyway.  But to be correct to 
windows i feel like none of that extra registration code should be there.

-aric

Jacek Caban wrote:
> Aric Stewart wrote:
>> Humm, maybe i am confused but (at least the win98 version of )
>> shdocvw.dll implements DllRegisterServer which seems to do a lot of
>> stuff.  But Setting the Start Page is not one of them.  In my
>> experience installing IE does not actually set a Start Page by
>> default, but instead the browser seem to handle not having a Start
>> Page by pulling up a default one.
>>
> 
> I've checked it again and it looks like shdocvw registers only its
> typelib, nothing else like coclasses. I will do more testing later today.
> 
> Jacek
> 
> 
> 



From stefan at codeweavers.com  Thu Dec 13 04:44:59 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Thu, 13 Dec 2007 11:44:59 +0100
Subject: [3/4] WineX11: Ignore the alpha if all pixels are 0x00
In-Reply-To: <3a768c550712122018k19fb800cu14b3bff5a1308025@mail.gmail.com>
References: <3a768c550712122018k19fb800cu14b3bff5a1308025@mail.gmail.com>
Message-ID: <200712131145.03619.stefan@codeweavers.com>

Am Donnerstag, 13. Dezember 2007 05:18:29 schrieb Juan Lang:
> Hi Stefan, a few minor nits:
>
> For the first for loop, you probably want something like (for y = 0;
> alpha_zero && y < ymax...
> Also, the whitespace around the if is a bit funny.
Ah right, it won't drop out of the outer loop of course :-). Thanks for the 
hint
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071213/89bc1c7f/attachment.pgp 

From julliard at winehq.org  Thu Dec 13 04:52:45 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 13 Dec 2007 11:52:45 +0100
Subject: includes: Update oleacc with new constants and iaccessible
	interface
In-Reply-To: <47606488.7020201@codeweavers.com> (Maarten Lankhorst's message
	of "Wed, 12 Dec 2007 23:45:28 +0100")
References: <47606488.7020201@codeweavers.com>
Message-ID: <877ijisw76.fsf@wine.dyndns.org>

Maarten Lankhorst <maarten at codeweavers.com> writes:

> +cpp_quote("#define ROLE_SYSTEM_ALERT 8")
> +cpp_quote("#define ROLE_SYSTEM_ANIMATION 54")
> +cpp_quote("#define ROLE_SYSTEM_APPLICATION 14")
> +cpp_quote("#define ROLE_SYSTEM_BORDER 19")
> +cpp_quote("#define ROLE_SYSTEM_BUTTONDROPDOWN  56")
> +cpp_quote("#define ROLE_SYSTEM_BUTTONDROPDOWNGRID 58")
> +cpp_quote("#define ROLE_SYSTEM_BUTTONMENU 57")
> +cpp_quote("#define ROLE_SYSTEM_CARET 7")

Entries should be sorted by value, not by name.

> +typedef enum tagSELFLAG
> +{
> +  SELFLAG_NONE = 0,
> +  SELFLAG_TAKEFOCUS = 1,
> +  SELFLAG_TAKESELECTION = 2,
> +  SELFLAG_EXTENDSELECTION = 4,
> +  SELFLAG_ADDSELECTION = 8,
> +  SELFLAG_REMOVESELECTION = 16
> +} SELFLAG;

These should be defines, not enums.

> +    HRESULT get_accParent([out, retval]IDispatch** ppdispParent);
> +    HRESULT get_accChildCount([out, retval] long* pcountChildren);
> +    HRESULT get_accChild([in] VARIANT varChildID, [out, retval]IDispatch **ppdispChild);

These (and the others) should be propget functions.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Thu Dec 13 04:53:29 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 13 Dec 2007 11:53:29 +0100
Subject: Patch for process title on FreeBSD
In-Reply-To: <47601F6F.1010504@pcbsd.com> (Kris Moore's message of "Wed, 12
	Dec 2007 12:50:39 -0500")
References: <47601F6F.1010504@pcbsd.com>
Message-ID: <873au6sw5y.fsf@wine.dyndns.org>

Kris Moore <kris at pcbsd.com> writes:

> --- dlls/kernel32/process.c.orig	2007-12-12 12:34:45.000000000 -0500
> +++ dlls/kernel32/process.c	2007-12-12 12:35:17.000000000 -0500
> @@ -853,6 +853,11 @@
>   */
>  static void set_process_name( int argc, char *argv[] )
>  {
> +
> +#if defined(__FreeBSD__)
> +    setproctitle("-%s", argv[1]);
> +#endif

You should add a configure check for this function, instead of checking
for __FreeBSD__.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Thu Dec 13 04:56:02 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 13 Dec 2007 11:56:02 +0100
Subject: user32: DPRINTF -> TRACE.
In-Reply-To: <689de9370712122156p2527e1fl2777f374ae1e044f@mail.gmail.com>
	(Andrew Riedi's message of "Wed, 12 Dec 2007 21:56:31 -0800")
References: <689de9370712122156p2527e1fl2777f374ae1e044f@mail.gmail.com>
Message-ID: <87y7byrhh9.fsf@wine.dyndns.org>

"Andrew Riedi" <andrewriedi at gmail.com> writes:

>      LRESULT ret;
>  
> -    if (TRACE_ON(relay))
> -        DPRINTF( "%04x:Call hook proc %p (id=%s,code=%x,wp=%08lx,lp=%08lx)\n",
> -                 GetCurrentThreadId(), proc, hook_names[id-WH_MINHOOK], code, wparam, lparam );
> +    TRACE_(relay)( "%04x:Call hook proc %p (id=%s,code=%x,wp=%08lx,lp=%08lx)\n",
> +                   GetCurrentThreadId(), proc, hook_names[id-WH_MINHOOK], code,
> +                   wparam, lparam );

Relay traces are different, they must not use TRACE.

-- 
Alexandre Julliard
julliard at winehq.org


From rob at codeweavers.com  Thu Dec 13 05:03:35 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Thu, 13 Dec 2007 11:03:35 +0000
Subject: ntoskrnl.exe: DPRINTF -> TRACE.
In-Reply-To: <689de9370712122156s6d9039d6r83a3bdc98be6b3ae@mail.gmail.com>
References: <689de9370712122156s6d9039d6r83a3bdc98be6b3ae@mail.gmail.com>
Message-ID: <47611187.90702@codeweavers.com>

Andrew Riedi wrote:
> -    if (TRACE_ON(relay))
> -        DPRINTF( "%04x:Call driver dispatch %p (device=%p,irp=%p)\n",
> -                 GetCurrentThreadId(), dispatch, device, &irp );
> +    TRACE_(relay)( "%04x:Call driver dispatch %p (device=%p,irp=%p)\n",
> +                   GetCurrentThreadId(), dispatch, device, &irp );

Please don't change relay traces to use TRACE. This channel has specific 
requirements and so doesn't benefit from using TRACE instead of DPRINTF.

-- 
Rob Shearman



From julliard at winehq.org  Thu Dec 13 06:22:17 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 13 Dec 2007 13:22:17 +0100
Subject: shlwapi:ordinal:Add comment to a function. [resend]
In-Reply-To: <475EEEEC.9060605@etersoft.ru> (Anatoly Lyutin's message of "Tue, 
	11 Dec 2007 23:11:24 +0300")
References: <475EEEEC.9060605@etersoft.ru>
Message-ID: <87lk7yrdhi.fsf@wine.dyndns.org>

Anatoly Lyutin <vostok at etersoft.ru> writes:

> Changelog:
>  Add comment to a function SHCreateShellPalette().

There's no point in resending doc patches that have clearly been written
by looking at the MSDN docs, they won't be applied.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Thu Dec 13 08:21:41 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 13 Dec 2007 15:21:41 +0100
Subject: urlmon #1: Fixed handling MIME type in Binding object.
In-Reply-To: <475FF764.8090808@codeweavers.com> (Jacek Caban's message of
	"Wed, 12 Dec 2007 15:59:48 +0100")
References: <475FF764.8090808@codeweavers.com>
Message-ID: <87d4tar7yi.fsf@wine.dyndns.org>

Jacek Caban <jacek at codeweavers.com> writes:

> ---
>  dlls/urlmon/binding.c     |   97
> +++++++++++++++++++++++++++++++++++---------

This breaks the tests for me:

../../../tools/runtest -q -P wine -M mshtml.dll -T ../../.. -p mshtml_test.exe.so htmldoc.c && touch htmldoc.ok
htmldoc.c:3069: Test failed: unexpected fontname "(null)"
htmldoc.c:3069: Test failed: unexpected fontname "Arial"
htmldoc.c:3069: Test failed: unexpected fontname "(null)"
htmldoc.c:3948: Test failed: (60) cmdf=00000003, expected 00000007
htmldoc.c:3956: Test failed: (57) cmdf=00000003, expected 00000007
make: *** [htmldoc.ok] Error 5

-- 
Alexandre Julliard
julliard at winehq.org


From rob at codeweavers.com  Thu Dec 13 08:36:45 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Thu, 13 Dec 2007 14:36:45 +0000
Subject: Alexandre Julliard : hhctrl.ocx:	Store a copy of the string
	pointers to enable freeing them without	casting away const .
In-Reply-To: <E1J2oy3-0000Iy-Hg@wine.codeweavers.com>
References: <E1J2oy3-0000Iy-Hg@wine.codeweavers.com>
Message-ID: <4761437D.2020606@codeweavers.com>

Alexandre Julliard wrote:
> hhctrl.ocx: Store a copy of the string pointers to enable freeing them without casting away const.

I've noticed that there is a trend of doing more and more of this type 
of fix. Is it really worth the performance penalty of doing this instead 
of adding in an appropriate macro or just not turning on the warning?

-- 
Rob Shearman



From julliard at winehq.org  Thu Dec 13 08:55:15 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 13 Dec 2007 15:55:15 +0100
Subject: Alexandre Julliard : hhctrl.ocx:	Store a copy of the string
	pointers to enable freeing them without	casting away const .
In-Reply-To: <4761437D.2020606@codeweavers.com> (Robert Shearman's message of
	"Thu, 13 Dec 2007 14:36:45 +0000")
References: <E1J2oy3-0000Iy-Hg@wine.codeweavers.com>
	<4761437D.2020606@codeweavers.com>
Message-ID: <878x3yr6ek.fsf@wine.dyndns.org>

Robert Shearman <rob at codeweavers.com> writes:

> Alexandre Julliard wrote:
>> hhctrl.ocx: Store a copy of the string pointers to enable freeing them without casting away const.
>
> I've noticed that there is a trend of doing more and more of this type
> of fix. Is it really worth the performance penalty of doing this
> instead of adding in an appropriate macro or just not turning on the
> warning?

This warning is on by default now, which is why I fixed it. I don't
think we want to add macros for that sort of thing except in cases where
there's really no way around it. In this specific case, the right way is
to get rid of the Windows structure to avoid the duplication, but I'll
leave that for someone who knows the code better.

-- 
Alexandre Julliard
julliard at winehq.org


From a_villacis at palosanto.com  Thu Dec 13 14:02:01 2007
From: a_villacis at palosanto.com (=?ISO-8859-1?Q?Alex_Villac=ED=ADs_Lasso?=)
Date: Thu, 13 Dec 2007 15:02:01 -0500
Subject: GDI32: GetSystemPaletteEntries should fill with default palette
	in	non-palette video mode (with tests)
In-Reply-To: <47586FC1.6000906@palosanto.com>
References: <47586FC1.6000906@palosanto.com>
Message-ID: <47618FB9.80601@palosanto.com>

Alex Villac??s Lasso escribi?:
> Patches originally by Alexander Dorofeyev <alexd14 at hushmail.com>.
>
> This patch tries to fix bug #201 (igowin shows black squares instead 
> of proper transparency). It was sent back in October, but there was no 
> feedback back then. So I am resending a rediff against current git.
>
> Changelog:
> * GetSystemPaletteEntries() should fill entries with default 20-color 
> system palette when called in a non-palette video mode.
> * Tests for above behavior.
>
> ------------------------------------------------------------------------
>
>
Any feedback on this patch?

-- 
perl -e '$x=2.4;print sprintf("%.0f + %.0f = %.0f\n",$x,$x,$x+$x);'



From alexd4 at inbox.lv  Fri Dec 14 00:25:16 2007
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Thu, 13 Dec 2007 22:25:16 -0800
Subject: ENTER_GL and ActivateContext question
In-Reply-To: <200712110033.50701.stefandoesinger@gmx.at>
References: <475D79E5.4010706@inbox.lv>
	<200712100853.22116.stefandoesinger@gmx.at>
	<475E28CA.30504@inbox.lv>
	<200712110033.50701.stefandoesinger@gmx.at>
Message-ID: <476221CC.6050504@inbox.lv>

Hello.

I've spent some time trying to get into this stuff and what can be improved in 
IWineD3DSurfaceImpl_BltOverride. Code that does glDrawBuffer in the Colorfill 
path and possibly elsewhere indeed appears to be redundant to ActivateContext 
and probably should go. That's in theory :), in practice though I've run into 
some problems. IWineD3DDevice_Clear call that it uses to perform the job does a 
thing that looks strange to me:

ActivateContext(This, This->render_targets[0], CTXUSAGE_CLEAR);

So whatever the IWineD3DSurfaceImpl_BltOverride does to properly ActivateContext 
select draw buffer etc may be overriden by ActivateContext within 
IWineD3DDevice_Clear seemingly. This looks buggy(?). Often things still get 
drawn properly because ActivateContext within IWineD3DDevice_Clear in many cases 
doesn't see a need to change context or do glDrawBuffer, so nothing happens even 
though it's passed not that render target which should get cleared. My recent 
change to BltOverride though made problems more likely, in fact it appears it 
broke something as basic as ddraw colorfill to the front buffer / primary 
surface if a back buffer exists :(, because now in such case ActivateContext 
called from Clear with wrong target is guaranteed to do its job and back buffer 
gets cleared instead.

Do you have any advices on how to handle that? In my tests I tried to use 
Get/SetRenderTarget before calling Clear, and restore the old one afterwards, 
which seems to make the colorfill work right on front buffer, but maybe there 
are better/less overhead ways to force Clear to pass right render target to 
ActivateContext? Or maybe something along the lines of device->isInDraw 
mechanism I saw in few other places, to tell Clear not to bother with 
ActivateContext at all?


From stefan at codeweavers.com  Thu Dec 13 15:00:09 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Thu, 13 Dec 2007 22:00:09 +0100
Subject: ENTER_GL and ActivateContext question
In-Reply-To: <476221CC.6050504@inbox.lv>
References: <475D79E5.4010706@inbox.lv>
	<200712110033.50701.stefandoesinger@gmx.at>
	<476221CC.6050504@inbox.lv>
Message-ID: <200712132200.15008.stefan@codeweavers.com>

Hi,

You are right, there is some problem here.

I think that the code originates from times when this codepath in colorfill 
was only entered when iface == device->render_targets[0], or when Clear 
didn't set any draw buffer itself. But you have spotted correctly, if iface 
is the device's front buffer, then the colorfill will fail.

device-isInDraw is not correct for this, because Clear() can never be called 
during a draw; DrawPrimitive doesn't call it, and another thread can't call 
it because the critical section is held. Installing a similar variable is 
possible, but hacky.

Another way would be to reverse the mapping, and make Clear() call colorfill; 
That would run through the whole find-the-surface code however, and be more 
overhead than a SetRenderTarget; Furthermore it is un-d3d9ish. Also, Clear() 
takes a few parameters into account that colorfill doesn't

GetRenderTarget and SetRenderTarget is a useable way to solve this. 
SetRenderTarget currently calls ActivateContext itself, but this call should 
be removed. I added it during the context management introduction to lower 
the propability of regressions.
A lot of code in WineD3D avoids the getters and setters, and just accesses the 
implementation structure. While any object oriented programmer screams when 
doing that, we need it for performance reasons. Currently we spend 10 to 20 
per cent of the CPU time spent in WineD3D just in surface::GetContainer and 
its callees, if we'd use Getters and Setters everywhere then goodbye 
performance(I want to replace GetContainer somewhen). However, 
GetRenderTarget and SetRenderTarget do a bit of setup and refcounting, so 
bypassing that certainly has an impact on maintainability. I'd be fine with 
direct impl access in this case, but it is a corner case.

A last option is to move the biggest part of Clear() into a subroutine, call 
the ActivateContext in Clear and BltOverride, and perform the rest of the job 
in the subroutine. The drawback of this is that d3d8 and d3d9 clears run 
through an extra call, but it avoids the SetRenderTarget/GetRenderTarget 
overhead and direct implementation access. The function could be inlined as 
well, but I am not sure if that works across .c files.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071213/37cbcb18/attachment.pgp 

From ivg231 at gmail.com  Thu Dec 13 19:46:42 2007
From: ivg231 at gmail.com (Ivan Gyurdiev)
Date: Thu, 13 Dec 2007 20:46:42 -0500
Subject: ENTER_GL and ActivateContext question
In-Reply-To: <200712132200.15008.stefan@codeweavers.com>
References: <475D79E5.4010706@inbox.lv>	<200712110033.50701.stefandoesinger@gmx.at>	<476221CC.6050504@inbox.lv>
	<200712132200.15008.stefan@codeweavers.com>
Message-ID: <4761E082.9080302@gmail.com>


> A lot of code in WineD3D avoids the getters and setters, and just accesses the 
> implementation structure. While any object oriented programmer screams when 
> doing that, we need it for performance reasons. Currently we spend 10 to 20 
> per cent of the CPU time spent in WineD3D just in surface::GetContainer and 
> its callees, if we'd use Getters and Setters everywhere then goodbye 
> performance(I want to replace GetContainer somewhen). 

So inline it... imho the performance argument is a bad reason to abandon 
maintainability. 

Your codebase is constantly getting more complex, and now you're having 
threading issues, which will only get more important with multi-core and 
other such things becoming standard.  Meanwhile graphics cards are 
getting a lot more powerful - I solved the performance problem 2 weeks 
ago w/ a GeForce 8800 GT.

As for the "object oriented programmer" - I would hope every programmer 
thinks in terms of objects, even when writing C code.
The GLSL backend wouldn't be available today if the shader compiler was 
still a big series of if statements.

Ivan


From leslie_alistair at hotmail.com  Thu Dec 13 21:50:05 2007
From: leslie_alistair at hotmail.com (Alistair Leslie-Hughes)
Date: Fri, 14 Dec 2007 14:50:05 +1100
Subject: Tracking down missing controls (drawn)
Message-ID: <fjsujk$68i$1@ger.gmane.org>

Hi,
  I've manage to get MS Money 2008 loading there sample file, (with some 
help from Juan).

The next issue is trying to get the information to display correctly.

The first image is the one currently running in WINE, and the second is 
within WinXP
http://members.dodo.com.au/~lesliehughes/MS_Money2008.png
http://members.dodo.com.au/~lesliehughes/Msmoney2008real.PNG

As you can see the control at the bottom doesnt display as it should.

Where can I start to look to workout how to get this control(s) to display 
correctly?

Best Regards
 Alistair Leslie-Hughes






From rob at codeweavers.com  Fri Dec 14 02:04:39 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Fri, 14 Dec 2007 08:04:39 +0000
Subject: Tracking down missing controls (drawn)
In-Reply-To: <fjsujk$68i$1@ger.gmane.org>
References: <fjsujk$68i$1@ger.gmane.org>
Message-ID: <47623917.1060804@codeweavers.com>

Alistair Leslie-Hughes wrote:
> Hi,
>   I've manage to get MS Money 2008 loading there sample file, (with some 
> help from Juan).
>   

Nice work.

> The next issue is trying to get the information to display correctly.
>
> The first image is the one currently running in WINE, and the second is 
> within WinXP
> http://members.dodo.com.au/~lesliehughes/MS_Money2008.png
> http://members.dodo.com.au/~lesliehughes/Msmoney2008real.PNG
>
> As you can see the control at the bottom doesnt display as it should.
>
> Where can I start to look to workout how to get this control(s) to display 
> correctly?
>   

It looks like a webpage to me, so mshtml is probably being used.

-- 
Rob Shearman



From dmitry at codeweavers.com  Fri Dec 14 02:36:15 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 14 Dec 2007 16:36:15 +0800
Subject: Undocumented behaviour in ReqQueryValueEx when 'count' and
	'type'point to the same address
References: <4a2e86560712111557v73c00acfrad017398c99e1460@mail.gmail.com>
	<4a2e86560712132148p1d79c1a7v2e7badd6365ba0c6@mail.gmail.com>
Message-ID: <004101c83e2c$665aa9c0$a600fea9@DMITRY>

"Sam Dennis" <samuel.howard.dennis at gmail.com> wrote:

> +    size = 4;
> +    ret = RegQueryValueExA(hkey_main, "BIN32", NULL, &size, buffer, &size);
> +    ok(ret == ERROR_SUCCESS, "expected ERROR_SUCCESS, got %d\n", ret);

What this test is supposed to test?

-- 
Dmitry.


From adamrimon at gmail.com  Fri Dec 14 02:45:48 2007
From: adamrimon at gmail.com (Adam Rimon)
Date: Fri, 14 Dec 2007 10:45:48 +0200
Subject: dinput - mouse warping -games that needs it?
Message-ID: <90fcedb70712140045l5997c439o6017e38793bee22d@mail.gmail.com>

Hi,

I'm trying to get rid of the warping patch, or at least to change it to
something that won't make the mouse
stuck in the middle of the screen in some games (Next Life for instance).

Can you give me names of games that need this warping?
(I had found in the archives a mention of Quake II, but when I downloaded
it's demo and tried to play it with
a dinput.dll that doesn't have this warping, everything worked just fine.)

Thanks,
-Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20071214/e28839fc/attachment.htm 

From twickline at gmail.com  Fri Dec 14 02:57:28 2007
From: twickline at gmail.com (Tom Wickline)
Date: Fri, 14 Dec 2007 03:57:28 -0500
Subject: dinput - mouse warping -games that needs it?
In-Reply-To: <90fcedb70712140045l5997c439o6017e38793bee22d@mail.gmail.com>
References: <90fcedb70712140045l5997c439o6017e38793bee22d@mail.gmail.com>
Message-ID: <53e3a9930712140057y1b0251c6q9fd25a82868e9a55@mail.gmail.com>

swat 4 ?

On Dec 14, 2007 3:45 AM, Adam Rimon <adamrimon at gmail.com> wrote:
> Hi,
>
> I'm trying to get rid of the warping patch, or at least to change it to
> something that won't make the mouse
> stuck in the middle of the screen in some games (Next Life for instance).
>
> Can you give me names of games that need this warping?
> (I had found in the archives a mention of Quake II, but when I downloaded
> it's demo and tried to play it with
> a dinput.dll that doesn't have this warping, everything worked just fine.)
>
> Thanks,
> -Adam
>
>
>
>


From stefan at codeweavers.com  Fri Dec 14 03:30:54 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Fri, 14 Dec 2007 10:30:54 +0100
Subject: ENTER_GL and ActivateContext question
In-Reply-To: <4761E082.9080302@gmail.com>
References: <475D79E5.4010706@inbox.lv>
	<200712132200.15008.stefan@codeweavers.com>
	<4761E082.9080302@gmail.com>
Message-ID: <200712141030.58501.stefan@codeweavers.com>

Am Freitag, 14. Dezember 2007 02:46:42 schrieb Ivan Gyurdiev:
> Your codebase is constantly getting more complex, and now you're having
> threading issues, which will only get more important with multi-core and
> other such things becoming standard.  Meanwhile graphics cards are
> getting a lot more powerful - I solved the performance problem 2 weeks
> ago w/ a GeForce 8800 GT.
For every other program I'd agree with that, but for WineD3D that doesn't 
apply. Gamers do not care about algorithmic complexity and the 
the-next-gen-hardware-will-fix-it argument. This is true for almost 
everything else out there, but gamers see that they get 70 fps in windows and 
45 in Wine, and they'll complain. Heck, they even complain if they get 70 in 
Windows and 65 in Wine.

> As for the "object oriented programmer" - I would hope every programmer
> thinks in terms of objects, even when writing C code.
> The GLSL backend wouldn't be available today if the shader compiler was
> still a big series of if statements.
This is true; And the rest of the code isn't a collection of if statements 
either(BltOverride is, but that should be fixed). If we had proper C++, then 
we could have the compiler inline the getters and setters, however, with the 
current C setup we can't do that(unless we write a bunch of macros or extra 
inline functions, which doesn't really help maintainability either).
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071214/d77a8936/attachment.pgp 

From stefan at codeweavers.com  Fri Dec 14 03:41:56 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Fri, 14 Dec 2007 10:41:56 +0100
Subject: dinput - mouse warping -games that needs it?
In-Reply-To: <90fcedb70712140045l5997c439o6017e38793bee22d@mail.gmail.com>
References: <90fcedb70712140045l5997c439o6017e38793bee22d@mail.gmail.com>
Message-ID: <200712141041.58583.stefan@codeweavers.com>

Am Freitag, 14. Dezember 2007 09:45:48 schrieb Adam Rimon:
> Hi,
>
> I'm trying to get rid of the warping patch, or at least to change it to
> something that won't make the mouse
> stuck in the middle of the screen in some games (Next Life for instance).
>
> Can you give me names of games that need this warping?
> (I had found in the archives a mention of Quake II, but when I downloaded
> it's demo and tried to play it with
> a dinput.dll that doesn't have this warping, everything worked just fine.)
Be warned that this is a very complex problem. You'll most likely have to 
modify the X server for that, and get a patch accepted into the Xorg code. 
Search the wine-patches and wine-devel mailing list for patches and mails 
from Vitaliy Margolen for more information
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071214/9b7b2271/attachment-0001.pgp 

From mstefani at redhat.com  Fri Dec 14 03:55:10 2007
From: mstefani at redhat.com (Michael Stefaniuc)
Date: Fri, 14 Dec 2007 10:55:10 +0100
Subject: ENTER_GL and ActivateContext question
In-Reply-To: <200712141030.58501.stefan@codeweavers.com>
References: <475D79E5.4010706@inbox.lv>	<200712132200.15008.stefan@codeweavers.com>	<4761E082.9080302@gmail.com>
	<200712141030.58501.stefan@codeweavers.com>
Message-ID: <476252FE.8020207@redhat.com>

Stefan D?singer wrote:
> Am Freitag, 14. Dezember 2007 02:46:42 schrieb Ivan Gyurdiev:
>> As for the "object oriented programmer" - I would hope every programmer
>> thinks in terms of objects, even when writing C code.
>> The GLSL backend wouldn't be available today if the shader compiler was
>> still a big series of if statements.
> This is true; And the rest of the code isn't a collection of if statements 
> either(BltOverride is, but that should be fixed). If we had proper C++, then 
> we could have the compiler inline the getters and setters, however, with the 
> current C setup we can't do that(unless we write a bunch of macros or extra 
> inline functions, which doesn't really help maintainability either).
I don't know what you mean with proper inline. It's true that "inline"
is only a hint to the compiler but normally the compiler knows anyway
better what to inline and what not.

If you really want to force an inline you have the
__attribute__((always_inline))

bye
	michael
-- 
Michael Stefaniuc                           Tel.: +49-711-96437-199
Consulting Communications Engineer          Fax.: +49-711-96437-111
--------------------------------------------------------------------
Reg. Adresse: Red Hat GmbH, Hauptst?tter Strasse 58, 70178 Stuttgart
Handelsregister: Amtsgericht Stuttgart HRB 153243
Gesch?ftsf?hrer: Brendan Lane, Charlie Peters, Michael Cunningham,
                 Werner Knoblich


From stefan at codeweavers.com  Fri Dec 14 04:17:41 2007
From: stefan at codeweavers.com (Stefan =?utf-8?q?D=C3=B6singer?=)
Date: Fri, 14 Dec 2007 11:17:41 +0100
Subject: ENTER_GL and ActivateContext question
In-Reply-To: <476252FE.8020207@redhat.com>
References: <475D79E5.4010706@inbox.lv>
	<200712141030.58501.stefan@codeweavers.com>
	<476252FE.8020207@redhat.com>
Message-ID: <200712141117.48574.stefan@codeweavers.com>

Am Freitag, 14. Dezember 2007 10:55:10 schrieb Michael Stefaniuc:
> I don't know what you mean with proper inline. It's true that "inline"
> is only a hint to the compiler but normally the compiler knows anyway
> better what to inline and what not.
>
> If you really want to force an inline you have the
> __attribute__((always_inline))
What I meant is that we can do a method call, and the C++ compiler finds out 
statically at compile time where it will go, and inlines the method 
implementation. For example, we do IWineD3DSurface::GetContainer, and the 
compiler knows that we have an instance of IWineD3DSurface, and the 
implementation of GetContainer is IWineD3DBaseSurface::GetContainer, and 
inlines it.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071214/a377d1ae/attachment.pgp 

From julliard at winehq.org  Fri Dec 14 05:21:50 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 14 Dec 2007 12:21:50 +0100
Subject: winex11.drv: style changes can change a managed window to
	unmanaged
In-Reply-To: <47623206.4060505@codeweavers.com> (Ken Thomases's message of
	"Fri, 14 Dec 2007 01:34:30 -0600")
References: <47623206.4060505@codeweavers.com>
Message-ID: <87y7bxplm9.fsf@wine.dyndns.org>

Ken Thomases <ken at codeweavers.com> writes:

> This fixes an issue with Internet Explorer's tooltips.  On the Mac, at least,
> they steal focus from the main window, disrupting user interaction.

This won't work with many window managers; the only way would be to
destroy the window and create a brand new one, but that's fairly tricky
to get right.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Fri Dec 14 05:35:53 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 14 Dec 2007 12:35:53 +0100
Subject: [PATCH 3/4] quartz: make test_aggregation non-static
In-Reply-To: <558b2f5c0712131544n7078351ao63e95f52e8753c4f@mail.gmail.com>
	(Lei Zhang's message of "Thu, 13 Dec 2007 15:44:33 -0800")
References: <558b2f5c0712131544n7078351ao63e95f52e8753c4f@mail.gmail.com>
Message-ID: <87tzmlpkyu.fsf@wine.dyndns.org>

"Lei Zhang" <thestig at google.com> writes:

> Hi,
>
> This lets us call test_aggregation() from other files.

In general it's better to avoid sharing functions across tests, it makes
it hard to grab a single test and quickly build it on Windows. In this
case you could test all the interfaces in the same file.

-- 
Alexandre Julliard
julliard at winehq.org


From maarten at codeweavers.com  Fri Dec 14 06:07:28 2007
From: maarten at codeweavers.com (Maarten Lankhorst)
Date: Fri, 14 Dec 2007 13:07:28 +0100
Subject: Create a 'take bug' option in bugzilla?
Message-ID: <47627200.6030407@codeweavers.com>

Hi all,

I'm getting tired of having to do 3 changes to take a bug.

First I have to set the status to  'assigned', this makes the bug
assigned to wine-bugs. Now that it is assigned, I can set the assignee
to my own email address, that automatically changes the status to 'new',
and I have to set the status to 'assigned' again.

Is it at least possible that an option 'assign to me'  shows up and
works for people with sufficient bugzilla access?

-Maarten


From julliard at winehq.org  Fri Dec 14 07:04:36 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Fri, 14 Dec 2007 14:04:36 +0100
Subject: [PATCH] use a better size to lstrcpynW
In-Reply-To: <877ijiqp5r.fsf@totally-fudged-out-message-id> (Marcus Meissner's
	message of "Thu, 13 Dec 2007 17:52:50 +0100")
References: <877ijiqp5r.fsf@totally-fudged-out-message-id>
Message-ID: <87d4t9pguz.fsf@wine.dyndns.org>

Marcus Meissner <meissner at suse.de> writes:

> -        lstrcpynW( num, begin + 1, end - begin );
> -        begin += end - begin + 1;
> +
> +        xcnt =  end - begin;
> +        if (xcnt > sizeof(num)/sizeof(WCHAR))
> +            xcnt = sizeof(num)/sizeof(WCHAR);
> +        lstrcpynW( num, begin + 1, xcnt );
> +        begin += xcnt + 1;

Truncating the string is not a correct fix. Overflow should either be
treated as an error, or a buffer should be allocated dynamically.

-- 
Alexandre Julliard
julliard at winehq.org


From juan.lang at gmail.com  Fri Dec 14 09:05:16 2007
From: juan.lang at gmail.com (Juan Lang)
Date: Fri, 14 Dec 2007 07:05:16 -0800
Subject: Undocumented behaviour in ReqQueryValueEx when 'count' and
	'type'point to the same address
In-Reply-To: <004101c83e2c$665aa9c0$a600fea9@DMITRY>
References: <4a2e86560712111557v73c00acfrad017398c99e1460@mail.gmail.com>
	<4a2e86560712132148p1d79c1a7v2e7badd6365ba0c6@mail.gmail.com>
	<004101c83e2c$665aa9c0$a600fea9@DMITRY>
Message-ID: <3a768c550712140705y1bbf211ci659f9241ac9b270e@mail.gmail.com>

> > +    size = 4;
> > +    ret = RegQueryValueExA(hkey_main, "BIN32", NULL, &size, buffer, &size);
> > +    ok(ret == ERROR_SUCCESS, "expected ERROR_SUCCESS, got %d\n", ret);
>
> What this test is supposed to test?

It tests the order in which type and count are checked.  When type and
count are (erroneously) passed the same pointer, RegQueryValueExA
still succeeds on Windows.  It fails on Wine, due to type being set to
0 early in the function, which caused a regression in Sam's (buggy)
program.
--Juan


From wine-devel at kievinfo.com  Fri Dec 14 09:12:53 2007
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Fri, 14 Dec 2007 08:12:53 -0700
Subject: dinput - mouse warping -games that needs it?
In-Reply-To: <90fcedb70712140045l5997c439o6017e38793bee22d@mail.gmail.com>
References: <90fcedb70712140045l5997c439o6017e38793bee22d@mail.gmail.com>
Message-ID: <47629D75.3020800@kievinfo.com>

Adam Rimon wrote:
> Hi,
> 
> I'm trying to get rid of the warping patch, or at least to change it to 
> something that won't make the mouse
> stuck in the middle of the screen in some games (Next Life for instance).
> 
> Can you give me names of games that need this warping?
> (I had found in the archives a mention of Quake II, but when I 
> downloaded it's demo and tried to play it with
> a dinput.dll that doesn't have this warping, everything worked just fine.)
> 
> Thanks,
> -Adam
> 
> 
See bug http://bugs.winehq.org/show_bug.cgi?id=6971 for programs that are 
currently broken. That's an example of what you will get it you completely 
remove mouse warping.

Yes Quake2 and all based on it games are the best example. However Q2 has a 
bug in mouse initializing code which will fail to properly acquire dinput 
mouse and will revert back to not using dinput. But it some cases (some 
games) it will acquire mouse in non-exclusive mode - the part which is 
broken atm.

For a simple test - download DXSDK it has dinput mouse test.

Vitaliy.


From dmitry at codeweavers.com  Fri Dec 14 09:20:21 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 14 Dec 2007 23:20:21 +0800
Subject: Undocumented behaviour in ReqQueryValueEx when 'count'
	and'type'point to the same address
References: <4a2e86560712111557v73c00acfrad017398c99e1460@mail.gmail.com><4a2e86560712132148p1d79c1a7v2e7badd6365ba0c6@mail.gmail.com><004101c83e2c$665aa9c0$a600fea9@DMITRY>
	<3a768c550712140705y1bbf211ci659f9241ac9b270e@mail.gmail.com>
Message-ID: <007e01c83e64$d941d0c0$a600fea9@DMITRY>

"Juan Lang" <juan.lang at gmail.com> wrote:

>> > +    size = 4;
>> > +    ret = RegQueryValueExA(hkey_main, "BIN32", NULL, &size, buffer, &size);
>> > +    ok(ret == ERROR_SUCCESS, "expected ERROR_SUCCESS, got %d\n", ret);
>>
>> What this test is supposed to test?
> 
> It tests the order in which type and count are checked.  When type and
> count are (erroneously) passed the same pointer, RegQueryValueExA
> still succeeds on Windows.  It fails on Wine, due to type being set to
> 0 early in the function, which caused a regression in Sam's (buggy)
> program.

Shouldn't the test also check for returned values in size and buffer?

-- 
Dmitry.


From juan.lang at gmail.com  Fri Dec 14 09:21:28 2007
From: juan.lang at gmail.com (Juan Lang)
Date: Fri, 14 Dec 2007 07:21:28 -0800
Subject: Undocumented behaviour in ReqQueryValueEx when 'count'
	and'type'point to the same address
In-Reply-To: <007e01c83e64$d941d0c0$a600fea9@DMITRY>
References: <4a2e86560712111557v73c00acfrad017398c99e1460@mail.gmail.com>
	<4a2e86560712132148p1d79c1a7v2e7badd6365ba0c6@mail.gmail.com>
	<004101c83e2c$665aa9c0$a600fea9@DMITRY>
	<3a768c550712140705y1bbf211ci659f9241ac9b270e@mail.gmail.com>
	<007e01c83e64$d941d0c0$a600fea9@DMITRY>
Message-ID: <3a768c550712140721t2730ea52of3d9e54cd5265d9f@mail.gmail.com>

> Shouldn't the test also check for returned values in size and buffer?

Yes, I expect so.
--Juan


From cjstimpson at utwire.net  Fri Dec 14 09:39:51 2007
From: cjstimpson at utwire.net (Clinton Stimpson)
Date: Fri, 14 Dec 2007 08:39:51 -0700
Subject: user32: add tests for handling exposed regions created by other
	threads
In-Reply-To: <200712120839.36330.cjstimpson@utwire.net>
References: <200712120839.36330.cjstimpson@utwire.net>
Message-ID: <4762A3C7.3030300@utwire.net>

Anything wrong with this patch?  I'm guessing its the Sleep().  Any 
other way to force X server to put expose events in the queue, if any?
This is for bug #9875.

Clinton Stimpson

-------------- next part --------------
A non-text attachment was scrubbed...
Name: user32.patch
Type: text/x-diff
Size: 4928 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071214/ccace347/attachment-0001.patch 

From kgbricola at web.de  Fri Dec 14 10:26:39 2007
From: kgbricola at web.de (=?ISO-8859-1?Q?Rico_Sch=FCller?=)
Date: Fri, 14 Dec 2007 17:26:39 +0100
Subject: docu - broken links
Message-ID: <4762AEBF.2060401@web.de>

Hi,

while I was looking in the docu (html) I found some links that are
broken. In some cases these are typos, in other I don't know. Here is a
list width broken links, I've found. I would like to fix this. But I
don't know which one are typos and which one are broken because the
function which is referred to isn't documented.

This is e.g. a typo I think:
file ChosseFontW.html in ChooseFontA.html not found.
*** ChosseFontW.html -> ChooseFontW.html

Could someone with more knowledge take a look at this list and say which
one are typos?


Regards
Rico
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: checked_winehtml.txt
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20071214/1e2f6989/attachment.txt 

From dank at kegel.com  Fri Dec 14 13:25:10 2007
From: dank at kegel.com (Dan Kegel)
Date: Fri, 14 Dec 2007 11:25:10 -0800
Subject: msi valgrind regression around Dec 4th
Message-ID: <a71bd89a0712141125v28377e02h3d12d88e897c186a@mail.gmail.com>

This error
 Conditional jump or move depends on uninitialised value(s)
    at  ACTION_AppSearchSigName (appsearch.c:435)
    by  ITERATE_CCPSearch (appsearch.c:916)
    by  MSI_IterateRecords (msiquery.c:190)
    by  ACTION_CCPSearch (appsearch.c:943)
    by  ACTION_HandleStandardAction (action.c:974)
    by  ACTION_PerformUIAction (action.c:1042)
    by  MsiDoActionW (install.c:108)
    by  MsiDoActionA (install.c:56)
    by  test_ccpsearch (package.c:4954)
    by  func_package (package.c:5384)
    by  run_test (test.h:387)
    by  main (test.h:436)
appeared between Nov 30 and Dec 4, and is still present in today's,
http://kegel.com/wine/valgrind/logs-2007-12-14/vg-msi_package.txt

I pinged James about it and a few others on Dec 5th; he
seems to have fixed the others, but this one remains.
- Dan


From truiken at gmail.com  Fri Dec 14 13:34:55 2007
From: truiken at gmail.com (James Hawkins)
Date: Fri, 14 Dec 2007 13:34:55 -0600
Subject: msi valgrind regression around Dec 4th
In-Reply-To: <a71bd89a0712141125v28377e02h3d12d88e897c186a@mail.gmail.com>
References: <a71bd89a0712141125v28377e02h3d12d88e897c186a@mail.gmail.com>
Message-ID: <22821af30712141134x4b97c90bja146dfbc07feab6@mail.gmail.com>

On Dec 14, 2007 1:25 PM, Dan Kegel <dank at kegel.com> wrote:
> This error
>  Conditional jump or move depends on uninitialised value(s)
>     at  ACTION_AppSearchSigName (appsearch.c:435)
>     by  ITERATE_CCPSearch (appsearch.c:916)
>     by  MSI_IterateRecords (msiquery.c:190)
>     by  ACTION_CCPSearch (appsearch.c:943)
>     by  ACTION_HandleStandardAction (action.c:974)
>     by  ACTION_PerformUIAction (action.c:1042)
>     by  MsiDoActionW (install.c:108)
>     by  MsiDoActionA (install.c:56)
>     by  test_ccpsearch (package.c:4954)
>     by  func_package (package.c:5384)
>     by  run_test (test.h:387)
>     by  main (test.h:436)
> appeared between Nov 30 and Dec 4, and is still present in today's,
> http://kegel.com/wine/valgrind/logs-2007-12-14/vg-msi_package.txt
>
> I pinged James about it and a few others on Dec 5th; he
> seems to have fixed the others, but this one remains.
> - Dan
>

I don't have a computer right now, so any fixes I do are by eyeballing
the code.  This will have to wait until I can get a new computer,
unless someone else wants to fix it.

-- 
James Hawkins


From wine-devel at kievinfo.com  Fri Dec 14 15:07:59 2007
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Fri, 14 Dec 2007 14:07:59 -0700
Subject: [PATCH] dinput: mouse.c: extracted the warping code into a
	function, 
	got rid from goto's in alloc_device, and made the code more readable.
	(no change in functionality)
In-Reply-To: <4762AB1A.4020607@gmail.com>
References: <4762AB1A.4020607@gmail.com>
Message-ID: <4762F0AF.2090603@kievinfo.com>

First of all your patch is wrapped. Second, do not send white space changes 
only. Same for formatting - do not change formatting only. If you can't read 
it, reformat for yourself, or get used to reading some one else's code.

What's wrong with gotos? If you don't like it doesn't mean everyone else 
can't use them. Don't change that part. Copying 10 lines of code into 10 
places doesn't justify removing 10 lines of code.

You should probably check the patch requirements: 
http://winehq.org/site/sending_patches

Vitaliy.

Adam Rimon wrote:
> ---
> 
>  dlls/dinput/mouse.c |  415 
> +++++++++++++++++++++++++++++----------------------
>  1 files changed, 235 insertions(+), 180 deletions(-)
> 



From truiken at gmail.com  Fri Dec 14 15:21:17 2007
From: truiken at gmail.com (James Hawkins)
Date: Fri, 14 Dec 2007 15:21:17 -0600
Subject: msi: Fix an off-by-one error
In-Reply-To: <22821af30712141318o3c266702g366f1e556002d326@mail.gmail.com>
References: <22821af30712141318o3c266702g366f1e556002d326@mail.gmail.com>
Message-ID: <22821af30712141321n74c19626if0779e2db90966ea@mail.gmail.com>

On Dec 14, 2007 3:18 PM, James Hawkins <truiken at gmail.com> wrote:
> Hi,
>
> Changelog:
> * Fix an off-by-one error.
>

Please ignore this patch.  This whole function needs to be rewritten.

-- 
James Hawkins


From leslie_alistair at hotmail.com  Fri Dec 14 17:46:57 2007
From: leslie_alistair at hotmail.com (Alistair Leslie-Hughes)
Date: Sat, 15 Dec 2007 10:46:57 +1100
Subject: Tracking down missing controls (drawn)
References: <fjsujk$68i$1@ger.gmane.org> <47623917.1060804@codeweavers.com>
Message-ID: <fjv4mg$3ml$1@ger.gmane.org>


"Robert Shearman" <rob at codeweavers.com> wrote in message 
news:47623917.1060804 at codeweavers.com...
>> Where can I start to look to workout how to get this control(s) to 
>> display
>> correctly?
>>
>
> It looks like a webpage to me, so mshtml is probably being used.
>

From adamrimon at gmail.com  Fri Dec 14 17:53:03 2007
From: adamrimon at gmail.com (Adam Rimon)
Date: Sat, 15 Dec 2007 01:53:03 +0200
Subject: [PATCH] dinput: mouse.c: extracted the warping code into a
	function, got rid from goto's in alloc_device,
	and made the code more readable. (no change in functionality)
In-Reply-To: <4762F0AF.2090603@kievinfo.com>
References: <4762AB1A.4020607@gmail.com> <4762F0AF.2090603@kievinfo.com>
Message-ID: <4763175F.6030102@gmail.com>

Using gotos is ok, when it's really needed. There is no need to use 
gotos here - it doesn't save source lines.
Why are you against changing the format and fixing the mixed using of 
tabs and white spaces?
Anyway, extracting the warping code into a function makes the warping 
code more maintainable.

On 12/14/2007 11:07 PM, Vitaliy Margolen wrote:
> First of all your patch is wrapped. Second, do not send white space 
> changes only. Same for formatting - do not change formatting only. If 
> you can't read it, reformat for yourself, or get used to reading some 
> one else's code.
>
> What's wrong with gotos? If you don't like it doesn't mean everyone 
> else can't use them. Don't change that part. Copying 10 lines of code 
> into 10 places doesn't justify removing 10 lines of code.
>
> You should probably check the patch requirements: 
> http://winehq.org/site/sending_patches
>
> Vitaliy.
>
> Adam Rimon wrote:
>> ---
>>
>>  dlls/dinput/mouse.c |  415 
>> +++++++++++++++++++++++++++++----------------------
>>  1 files changed, 235 insertions(+), 180 deletions(-)
>>
>



From juan.lang at gmail.com  Fri Dec 14 17:58:19 2007
From: juan.lang at gmail.com (Juan Lang)
Date: Fri, 14 Dec 2007 15:58:19 -0800
Subject: [PATCH] dinput: mouse.c: extracted the warping code into a
	function, got rid from goto's in alloc_device,
	and made the code more readable. (no change in functionality)
In-Reply-To: <4763175F.6030102@gmail.com>
References: <4762AB1A.4020607@gmail.com> <4762F0AF.2090603@kievinfo.com>
	<4763175F.6030102@gmail.com>
Message-ID: <3a768c550712141558u741d5701yc34b543abf9d90cc@mail.gmail.com>

Please bottom-post on this list.

> Why are you against changing the format and fixing the mixed using of
> tabs and white spaces?

That's a rule here.  Leaving in extraneous patches will get the patch
rejected.  If you insist on changing whitespace, do it in a separate
patch (which, by the way, will also likely get rejected.)

So, whether or not he (or I, or anyone except AJ) is against it, your
patch will get rejected as-is.  Follow Vitaliy's advice to increase
the likelihood of it getting accepted.
--Juan


From fgouget at free.fr  Fri Dec 14 18:19:05 2007
From: fgouget at free.fr (Francois Gouget)
Date: Sat, 15 Dec 2007 01:19:05 +0100 (CET)
Subject: [5/5] gdi: Test bitmap depths
In-Reply-To: <200712120814.44250.stefan@codeweavers.com>
References: <200712112131.39384.stefan@codeweavers.com>
	<530468570712112152t1bfcd73fy70627331ba661749@mail.gmail.com>
	<200712120814.44250.stefan@codeweavers.com>
Message-ID: <Pine.LNX.4.64.0712150116360.31271@amboise.dolphin>

On Wed, 12 Dec 2007, Stefan D?singer wrote:
[...]
> It is the intention of this patch, and coming ones, to clean up the 24/32 bpp 
> mess, also with regard to 15/16 bpp confusion, although I am missing hardware 
> capable of running X at depth 15 for testing, so it will be mainly about the 
> 24/32 bpp differences which break some games.


VNC server supports all depths, including 15bpp. It's ideal for tests.

-- 
Francois Gouget <fgouget at free.fr>              http://fgouget.free.fr/
           Demander si un ordinateur peut penser revient ? demander
                          si un sous-marin peut nager.

From dank at kegel.com  Fri Dec 14 18:25:41 2007
From: dank at kegel.com (Dan Kegel)
Date: Fri, 14 Dec 2007 16:25:41 -0800
Subject: winex11.drv:clipboard.c: Adds zero to the end of string.
Message-ID: <a71bd89a0712141625g16caa4b3w772bf3ff1a775025@mail.gmail.com>

Anatoly wrote:
> We do it to make sure that the strings will terminate by zero.

What bug does this fix?
Can you add a conformance test?
- Dan


From stefan at codeweavers.com  Fri Dec 14 18:58:19 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sat, 15 Dec 2007 01:58:19 +0100
Subject: [5/5] gdi: Test bitmap depths
In-Reply-To: <Pine.LNX.4.64.0712150116360.31271@amboise.dolphin>
References: <200712112131.39384.stefan@codeweavers.com>
	<200712120814.44250.stefan@codeweavers.com>
	<Pine.LNX.4.64.0712150116360.31271@amboise.dolphin>
Message-ID: <200712150158.21712.stefan@codeweavers.com>

Am Samstag, 15. Dezember 2007 01:19:05 schrieb Francois Gouget:
> On Wed, 12 Dec 2007, Stefan D?singer wrote:
> [...]
>
> > It is the intention of this patch, and coming ones, to clean up the 24/32
> > bpp mess, also with regard to 15/16 bpp confusion, although I am missing
> > hardware capable of running X at depth 15 for testing, so it will be
> > mainly about the 24/32 bpp differences which break some games.
>
> VNC server supports all depths, including 15bpp. It's ideal for tests.
Do you mean the X11 VNC server? Or some Windows server?
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071215/455b6951/attachment.pgp 

From alexd4 at inbox.lv  Sat Dec 15 05:19:36 2007
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Sat, 15 Dec 2007 03:19:36 -0800
Subject: ENTER_GL and ActivateContext question
In-Reply-To: <200712132200.15008.stefan@codeweavers.com>
References: <475D79E5.4010706@inbox.lv>
	<200712110033.50701.stefandoesinger@gmx.at>
	<476221CC.6050504@inbox.lv>
	<200712132200.15008.stefan@codeweavers.com>
Message-ID: <4763B848.1010306@inbox.lv>

Hi.

Here's preliminary version of a changes to BltOverride/Clear, with Clear 
subroutine approach discussed previously. Please look through it if you can. 
Basically everything except a check for error condition and deciding the target 
surface moved from Clear to subroutine. Another thing I did is moving code that 
does IWineD3DSurface_LoadLocation below the ActivateContext in the subroutine 
(originally it was done prior to ActivateContext), because it seems to do GL 
calls at least in some codepaths and doesn't seem to do ActivateContext.

Another issue I noticed in tests (seems to be present in wine-0.9.50 too, before 
ActivateContext was added to BltOverride) is that BltOverride/colorfill to front 
buffer often doesn't actually make filled rectangles appear - they can fail to 
appear for indefinite time, especially if there are no subsequent identical or 
similar calls, but there are no visible errors in traces. glFlush does make them 
appear, so maybe they are somehow getting buffered. This seems to be specific to 
front buffer. Maybe glFlush really should be called in BltOverride (or clearing 
subroutine) if the target is front buffer?

Stefan D?singer wrote:
> A last option is to move the biggest part of Clear() into a subroutine, call 
> the ActivateContext in Clear and BltOverride, and perform the rest of the job 
> in the subroutine. The drawback of this is that d3d8 and d3d9 clears run 
> through an extra call, but it avoids the SetRenderTarget/GetRenderTarget 
> overhead and direct implementation access. The function could be inlined as 
> well, but I am not sure if that works across .c files.

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: 0001-wined3d-restructure-and-cleanup-colorfill-codepath-in.txt
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20071215/0fd8af01/attachment-0002.txt 

From alexd4 at inbox.lv  Sat Dec 15 03:56:44 2007
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Sat, 15 Dec 2007 01:56:44 -0800
Subject: [PATCH] wined3d: restructure and cleanup colorfill codepath in IWineD3DSurfaceImpl_BltOverride
Message-ID: <mailman.129.1197681886.6275.wine-devel@winehq.org>

---
 dlls/wined3d/device.c          |  160 ++++++++++++++++++++++++++++++++++++++++
 dlls/wined3d/surface.c         |   50 ++++---------
 dlls/wined3d/wined3d_private.h |    3 +
 3 files changed, 177 insertions(+), 36 deletions(-)

diff --git a/dlls/wined3d/device.c b/dlls/wined3d/device.c
index 8245563..bafa740 100644
--- a/dlls/wined3d/device.c
+++ b/dlls/wined3d/device.c
@@ -4780,6 +4780,166 @@ static HRESULT WINAPI IWineD3DDeviceImpl_Present(IWineD3DDevice *iface,
     return WINED3D_OK;
 }
 
+/* Not called from the VTable (internal subroutine) */
+void IWineD3DDeviceImpl_ClearSurface(IWineD3DDeviceImpl *This,  IWineD3DSurfaceImpl *target, DWORD Count,
+                                        CONST WINED3DRECT* pRects, DWORD Flags, WINED3DCOLOR Color,
+                                        float Z, DWORD Stencil) {
+    GLbitfield     glMask = 0;
+    unsigned int   i;
+    WINED3DRECT curRect;
+    RECT vp_rect;
+    WINED3DVIEWPORT *vp = &This->stateBlock->viewport;
+    UINT drawable_width, drawable_height;
+
+    ActivateContext(This, (IWineD3DSurface *) target, CTXUSAGE_CLEAR);
+    /* When we're clearing parts of the drawable, make sure that the target surface is well up to date in the
+     * drawable. After the clear we'll mark the drawable up to date, so we have to make sure that this is true
+     * for the cleared parts, and the untouched parts.
+     *
+     * If we're clearing the whole target there is no need to copy it into the drawable, it will be overwritten
+     * anyway. If we're not clearing the color buffer we don't have to copy either since we're not going to set
+     * the drawable up to date. We have to check all settings that limit the clear area though. Do not bother
+     * checking all this if the dest surface is in the drawable anyway.
+     */
+    if((Flags & WINED3DCLEAR_TARGET) && !(target->Flags & SFLAG_INDRAWABLE)) {
+        while(1) {
+            if(vp->X != 0 || vp->Y != 0 ||
+               vp->Width < target->currentDesc.Width || vp->Height < target->currentDesc.Height) {
+                IWineD3DSurface_LoadLocation((IWineD3DSurface *) target, SFLAG_INDRAWABLE, NULL);
+                break;
+            }
+            if(This->stateBlock->renderState[WINED3DRS_SCISSORTESTENABLE] && (
+               This->stateBlock->scissorRect.left > 0 || This->stateBlock->scissorRect.top > 0 ||
+               This->stateBlock->scissorRect.right < target->currentDesc.Width ||
+               This->stateBlock->scissorRect.bottom < target->currentDesc.Height)) {
+                IWineD3DSurface_LoadLocation((IWineD3DSurface *) target, SFLAG_INDRAWABLE, NULL);
+                break;
+            }
+            if(Count > 0 && pRects && (
+               pRects[0].x1 > 0 || pRects[0].y1 > 0 ||
+               pRects[0].x2 < target->currentDesc.Width ||
+               pRects[0].y2 < target->currentDesc.Height)) {
+                IWineD3DSurface_LoadLocation((IWineD3DSurface *) target, SFLAG_INDRAWABLE, NULL);
+                break;
+            }
+            break;
+        }
+    }
+
+    target->get_drawable_size(target, &drawable_width, &drawable_height);
+
+    ENTER_GL();
+
+    if (wined3d_settings.offscreen_rendering_mode == ORM_FBO) {
+        apply_fbo_state((IWineD3DDevice *) This);
+    }
+
+    /* Only set the values up once, as they are not changing */
+    if (Flags & WINED3DCLEAR_STENCIL) {
+        glClearStencil(Stencil);
+        checkGLcall("glClearStencil");
+        glMask = glMask | GL_STENCIL_BUFFER_BIT;
+        glStencilMask(0xFFFFFFFF);
+    }
+
+    if (Flags & WINED3DCLEAR_ZBUFFER) {
+        glDepthMask(GL_TRUE);
+        glClearDepth(Z);
+        checkGLcall("glClearDepth");
+        glMask = glMask | GL_DEPTH_BUFFER_BIT;
+        IWineD3DDeviceImpl_MarkStateDirty(This, STATE_RENDER(WINED3DRS_ZWRITEENABLE));
+    }
+
+    if (Flags & WINED3DCLEAR_TARGET) {
+        TRACE("Clearing screen with glClear to color %x\n", Color);
+        glClearColor(D3DCOLOR_R(Color),
+                     D3DCOLOR_G(Color),
+                     D3DCOLOR_B(Color),
+                     D3DCOLOR_A(Color));
+        checkGLcall("glClearColor");
+
+        /* Clear ALL colors! */
+        glColorMask(GL_TRUE, GL_TRUE, GL_TRUE, GL_TRUE);
+        glMask = glMask | GL_COLOR_BUFFER_BIT;
+    }
+
+    vp_rect.left = vp->X;
+    vp_rect.top = vp->Y;
+    vp_rect.right = vp->X + vp->Width;
+    vp_rect.bottom = vp->Y + vp->Height;
+    if (!(Count > 0 && pRects)) {
+        if(This->stateBlock->renderState[WINED3DRS_SCISSORTESTENABLE]) {
+            IntersectRect(&vp_rect, &vp_rect, &This->stateBlock->scissorRect);
+        }
+        if(This->render_offscreen) {
+            glScissor(vp_rect.left, vp_rect.top,
+                        vp_rect.right - vp_rect.left, vp_rect.bottom - vp_rect.top);
+        } else {
+            glScissor(vp_rect.left, drawable_height - vp_rect.bottom,
+                        vp_rect.right - vp_rect.left, vp_rect.bottom - vp_rect.top);
+        }
+        checkGLcall("glScissor");
+        glClear(glMask);
+        checkGLcall("glClear");
+    } else {
+        /* Now process each rect in turn */
+        for (i = 0; i < Count; i++) {
+            /* Note gl uses lower left, width/height */
+            IntersectRect((RECT *) &curRect, &vp_rect, (RECT *) &pRects[i]);
+            if(This->stateBlock->renderState[WINED3DRS_SCISSORTESTENABLE]) {
+                IntersectRect((RECT *) &curRect, (RECT *) &curRect, &This->stateBlock->scissorRect);
+            }
+            TRACE("(%p) Rect=(%d,%d)->(%d,%d) glRect=(%d,%d), len=%d, hei=%d\n", This,
+                  pRects[i].x1, pRects[i].y1, pRects[i].x2, pRects[i].y2,
+                  curRect.x1, (target->currentDesc.Height - curRect.y2),
+                  curRect.x2 - curRect.x1, curRect.y2 - curRect.y1);
+
+            /* Tests show that rectangles where x1 > x2 or y1 > y2 are ignored silently.
+             * The rectangle is not cleared, no error is returned, but further rectanlges are
+             * still cleared if they are valid
+             */
+            if(curRect.x1 > curRect.x2 || curRect.y1 > curRect.y2) {
+                TRACE("Rectangle with negative dimensions, ignoring\n");
+                continue;
+            }
+
+            if(This->render_offscreen) {
+                glScissor(curRect.x1, curRect.y1,
+                          curRect.x2 - curRect.x1, curRect.y2 - curRect.y1);
+            } else {
+                glScissor(curRect.x1, drawable_height - curRect.y2,
+                          curRect.x2 - curRect.x1, curRect.y2 - curRect.y1);
+            }
+            checkGLcall("glScissor");
+
+            glClear(glMask);
+            checkGLcall("glClear");
+        }
+    }
+
+    /* Restore the old values (why..?) */
+    if (Flags & WINED3DCLEAR_STENCIL) {
+        glStencilMask(This->stateBlock->renderState[WINED3DRS_STENCILWRITEMASK]);
+    }
+    if (Flags & WINED3DCLEAR_TARGET) {
+        DWORD mask = This->stateBlock->renderState[WINED3DRS_COLORWRITEENABLE];
+        glColorMask(mask & WINED3DCOLORWRITEENABLE_RED ? GL_TRUE : GL_FALSE,
+                    mask & WINED3DCOLORWRITEENABLE_GREEN ? GL_TRUE : GL_FALSE,
+                    mask & WINED3DCOLORWRITEENABLE_BLUE  ? GL_TRUE : GL_FALSE,
+                    mask & WINED3DCOLORWRITEENABLE_ALPHA ? GL_TRUE : GL_FALSE);
+
+        /* Dirtify the target surface for now. If the surface is locked regularly, and an up to date sysmem copy exists,
+         * it is most likely more efficient to perform a clear on the sysmem copy too instead of downloading it
+         */
+        IWineD3DSurface_ModifyLocation(This->lastActiveRenderTarget, SFLAG_INDRAWABLE, TRUE);
+        /* TODO: Move the fbo logic into ModifyLocation() */
+        if(This->render_offscreen && wined3d_settings.offscreen_rendering_mode == ORM_FBO) {
+            target->Flags |= SFLAG_INTEXTURE;
+        }
+    }
+    LEAVE_GL();
+}
+
 static HRESULT WINAPI IWineD3DDeviceImpl_Clear(IWineD3DDevice *iface, DWORD Count, CONST WINED3DRECT* pRects,
                                         DWORD Flags, WINED3DCOLOR Color, float Z, DWORD Stencil) {
     IWineD3DDeviceImpl *This = (IWineD3DDeviceImpl *)iface;
diff --git a/dlls/wined3d/surface.c b/dlls/wined3d/surface.c
index 3f69baf..ab8749b 100644
--- a/dlls/wined3d/surface.c
+++ b/dlls/wined3d/surface.c
@@ -3201,6 +3201,15 @@ static HRESULT IWineD3DSurfaceImpl_BltOverride(IWineD3DSurfaceImpl *This, RECT *
 
             TRACE("Colorfill\n");
 
+            /* This == (IWineD3DSurfaceImpl *) myDevice->render_targets[0] || dstSwapchain
+                must be true if we are here */
+            if (This != (IWineD3DSurfaceImpl *) myDevice->render_targets[0] &&
+                    !(This == (IWineD3DSurfaceImpl*) dstSwapchain->frontBuffer ||
+                      (dstSwapchain->backBuffer && This == (IWineD3DSurfaceImpl*) dstSwapchain->backBuffer[0]))) {
+                TRACE("Surface is higher back buffer, falling back to software\n");
+                return WINED3DERR_INVALIDCALL;
+            }
+
             /* The color as given in the Blt function is in the format of the frame-buffer...
              * 'clear' expect it in ARGB format => we need to do some conversion :-)
              */
@@ -3236,43 +3245,12 @@ static HRESULT IWineD3DSurfaceImpl_BltOverride(IWineD3DSurfaceImpl *This, RECT *
                 return WINED3DERR_INVALIDCALL;
             }
 
-            ActivateContext(myDevice, (IWineD3DSurface *) This, CTXUSAGE_RESOURCELOAD);
-            ENTER_GL();
-
-            if(dstSwapchain && dstSwapchain->backBuffer && This == (IWineD3DSurfaceImpl*) dstSwapchain->backBuffer[0]) {
-                glDrawBuffer(GL_BACK);
-                checkGLcall("glDrawBuffer(GL_BACK)");
-            } else if (dstSwapchain && This == (IWineD3DSurfaceImpl*) dstSwapchain->frontBuffer) {
-                glDrawBuffer(GL_FRONT);
-                checkGLcall("glDrawBuffer(GL_FRONT)");
-            } else if(This == (IWineD3DSurfaceImpl *) myDevice->render_targets[0]) {
-                glDrawBuffer(myDevice->offscreenBuffer);
-                checkGLcall("glDrawBuffer(myDevice->offscreenBuffer3)");
-            } else {
-                LEAVE_GL();
-                TRACE("Surface is higher back buffer, falling back to software\n");
-                return WINED3DERR_INVALIDCALL;
-            }
-
             TRACE("(%p) executing Render Target override, color = %x\n", This, color);
-
-            IWineD3DDevice_Clear( (IWineD3DDevice *) myDevice,
-                                1 /* Number of rectangles */,
-                                &rect,
-                                WINED3DCLEAR_TARGET,
-                                color,
-                                0.0 /* Z */,
-                                0 /* Stencil */);
-
-            /* Restore the original draw buffer */
-            if(!dstSwapchain) {
-                glDrawBuffer(myDevice->offscreenBuffer);
-            } else if(dstSwapchain->backBuffer && dstSwapchain->backBuffer[0]) {
-                glDrawBuffer(GL_BACK);
-            }
-            vcheckGLcall("glDrawBuffer");
-            LEAVE_GL();
-
+            IWineD3DDeviceImpl_ClearSurface(myDevice, This,
+                                            1, /* Number of rectangles */
+                                            &rect, WINED3DCLEAR_TARGET, color,
+                                            0.0 /* Z */,
+                                            0 /* Stencil */);
             return WINED3D_OK;
         }
     }
diff --git a/dlls/wined3d/wined3d_private.h b/dlls/wined3d/wined3d_private.h
index 6806bfe..7951b9b 100644
--- a/dlls/wined3d/wined3d_private.h
+++ b/dlls/wined3d/wined3d_private.h
@@ -773,6 +773,9 @@ struct IWineD3DDeviceImpl
 
 extern const IWineD3DDeviceVtbl IWineD3DDevice_Vtbl;
 
+void IWineD3DDeviceImpl_ClearSurface(IWineD3DDeviceImpl *This,  IWineD3DSurfaceImpl *target, DWORD Count,
+                                        CONST WINED3DRECT* pRects, DWORD Flags, WINED3DCOLOR Color,
+                                        float Z, DWORD Stencil);
 void IWineD3DDeviceImpl_FindTexUnitMap(IWineD3DDeviceImpl *This);
 void IWineD3DDeviceImpl_MarkStateDirty(IWineD3DDeviceImpl *This, DWORD state);
 static inline BOOL isStateDirty(WineD3DContext *context, DWORD state) {
-- 
1.5.3.4


--------------020901050207010200020603
Content-Type: text/plain;
 name="0002-wined3d-restructure-IWineD3DDeviceImpl_Clear.txt"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename*0="0002-wined3d-restructure-IWineD3DDeviceImpl_Clear.txt"


From alexd4 at inbox.lv  Sat Dec 15 03:58:27 2007
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Sat, 15 Dec 2007 01:58:27 -0800
Subject: [PATCH] wined3d: restructure IWineD3DDeviceImpl_Clear
Message-ID: <mailman.130.1197681886.6275.wine-devel@winehq.org>

---
 dlls/wined3d/device.c |  158 +------------------------------------------------
 1 files changed, 1 insertions(+), 157 deletions(-)

diff --git a/dlls/wined3d/device.c b/dlls/wined3d/device.c
index bafa740..1bcd412 100644
--- a/dlls/wined3d/device.c
+++ b/dlls/wined3d/device.c
@@ -4945,13 +4945,6 @@ static HRESULT WINAPI IWineD3DDeviceImpl_Clear(IWineD3DDevice *iface, DWORD Coun
     IWineD3DDeviceImpl *This = (IWineD3DDeviceImpl *)iface;
     IWineD3DSurfaceImpl *target = (IWineD3DSurfaceImpl *)This->render_targets[0];
 
-    GLbitfield     glMask = 0;
-    unsigned int   i;
-    WINED3DRECT curRect;
-    RECT vp_rect;
-    WINED3DVIEWPORT *vp = &This->stateBlock->viewport;
-    UINT drawable_width, drawable_height;
-
     TRACE("(%p) Count (%d), pRects (%p), Flags (%x), Color (0x%08x), Z (%f), Stencil (%d)\n", This,
           Count, pRects, Flags, Color, Z, Stencil);
 
@@ -4961,156 +4954,7 @@ static HRESULT WINAPI IWineD3DDeviceImpl_Clear(IWineD3DDevice *iface, DWORD Coun
         return WINED3DERR_INVALIDCALL;
     }
 
-    /* When we're clearing parts of the drawable, make sure that the target surface is well up to date in the
-     * drawable. After the clear we'll mark the drawable up to date, so we have to make sure that this is true
-     * for the cleared parts, and the untouched parts.
-     *
-     * If we're clearing the whole target there is no need to copy it into the drawable, it will be overwritten
-     * anyway. If we're not clearing the color buffer we don't have to copy either since we're not going to set
-     * the drawable up to date. We have to check all settings that limit the clear area though. Do not bother
-     * checking all this if the dest surface is in the drawable anyway.
-     */
-    if((Flags & WINED3DCLEAR_TARGET) && !(target->Flags & SFLAG_INDRAWABLE)) {
-        while(1) {
-            if(vp->X != 0 || vp->Y != 0 ||
-               vp->Width < target->currentDesc.Width || vp->Height < target->currentDesc.Height) {
-                IWineD3DSurface_LoadLocation((IWineD3DSurface *) target, SFLAG_INDRAWABLE, NULL);
-                break;
-            }
-            if(This->stateBlock->renderState[WINED3DRS_SCISSORTESTENABLE] && (
-               This->stateBlock->scissorRect.left > 0 || This->stateBlock->scissorRect.top > 0 ||
-               This->stateBlock->scissorRect.right < target->currentDesc.Width ||
-               This->stateBlock->scissorRect.bottom < target->currentDesc.Height)) {
-                IWineD3DSurface_LoadLocation((IWineD3DSurface *) target, SFLAG_INDRAWABLE, NULL);
-                break;
-            }
-            if(Count > 0 && pRects && (
-               pRects[0].x1 > 0 || pRects[0].y1 > 0 ||
-               pRects[0].x2 < target->currentDesc.Width ||
-               pRects[0].y2 < target->currentDesc.Height)) {
-                IWineD3DSurface_LoadLocation((IWineD3DSurface *) target, SFLAG_INDRAWABLE, NULL);
-                break;
-            }
-            break;
-        }
-    }
-
-    target->get_drawable_size(target, &drawable_width, &drawable_height);
-
-    /* This is for offscreen rendering as well as for multithreading, thus activate the set render target
-     * and not the last active one.
-     */
-    ActivateContext(This, This->render_targets[0], CTXUSAGE_CLEAR);
-    ENTER_GL();
-
-    if (wined3d_settings.offscreen_rendering_mode == ORM_FBO) {
-        apply_fbo_state(iface);
-    }
-
-    /* Only set the values up once, as they are not changing */
-    if (Flags & WINED3DCLEAR_STENCIL) {
-        glClearStencil(Stencil);
-        checkGLcall("glClearStencil");
-        glMask = glMask | GL_STENCIL_BUFFER_BIT;
-        glStencilMask(0xFFFFFFFF);
-    }
-
-    if (Flags & WINED3DCLEAR_ZBUFFER) {
-        glDepthMask(GL_TRUE);
-        glClearDepth(Z);
-        checkGLcall("glClearDepth");
-        glMask = glMask | GL_DEPTH_BUFFER_BIT;
-        IWineD3DDeviceImpl_MarkStateDirty(This, STATE_RENDER(WINED3DRS_ZWRITEENABLE));
-    }
-
-    if (Flags & WINED3DCLEAR_TARGET) {
-        TRACE("Clearing screen with glClear to color %x\n", Color);
-        glClearColor(D3DCOLOR_R(Color),
-                     D3DCOLOR_G(Color),
-                     D3DCOLOR_B(Color),
-                     D3DCOLOR_A(Color));
-        checkGLcall("glClearColor");
-
-        /* Clear ALL colors! */
-        glColorMask(GL_TRUE, GL_TRUE, GL_TRUE, GL_TRUE);
-        glMask = glMask | GL_COLOR_BUFFER_BIT;
-    }
-
-    vp_rect.left = vp->X;
-    vp_rect.top = vp->Y;
-    vp_rect.right = vp->X + vp->Width;
-    vp_rect.bottom = vp->Y + vp->Height;
-    if (!(Count > 0 && pRects)) {
-        if(This->stateBlock->renderState[WINED3DRS_SCISSORTESTENABLE]) {
-            IntersectRect(&vp_rect, &vp_rect, &This->stateBlock->scissorRect);
-        }
-        if(This->render_offscreen) {
-            glScissor(vp_rect.left, vp_rect.top,
-                        vp_rect.right - vp_rect.left, vp_rect.bottom - vp_rect.top);
-        } else {
-            glScissor(vp_rect.left, drawable_height - vp_rect.bottom,
-                        vp_rect.right - vp_rect.left, vp_rect.bottom - vp_rect.top);
-        }
-        checkGLcall("glScissor");
-        glClear(glMask);
-        checkGLcall("glClear");
-    } else {
-        /* Now process each rect in turn */
-        for (i = 0; i < Count; i++) {
-            /* Note gl uses lower left, width/height */
-            IntersectRect((RECT *) &curRect, &vp_rect, (RECT *) &pRects[i]);
-            if(This->stateBlock->renderState[WINED3DRS_SCISSORTESTENABLE]) {
-                IntersectRect((RECT *) &curRect, (RECT *) &curRect, &This->stateBlock->scissorRect);
-            }
-            TRACE("(%p) Rect=(%d,%d)->(%d,%d) glRect=(%d,%d), len=%d, hei=%d\n", This,
-                  pRects[i].x1, pRects[i].y1, pRects[i].x2, pRects[i].y2,
-                  curRect.x1, (target->currentDesc.Height - curRect.y2),
-                  curRect.x2 - curRect.x1, curRect.y2 - curRect.y1);
-
-            /* Tests show that rectangles where x1 > x2 or y1 > y2 are ignored silently.
-             * The rectangle is not cleared, no error is returned, but further rectanlges are
-             * still cleared if they are valid
-             */
-            if(curRect.x1 > curRect.x2 || curRect.y1 > curRect.y2) {
-                TRACE("Rectangle with negative dimensions, ignoring\n");
-                continue;
-            }
-
-            if(This->render_offscreen) {
-                glScissor(curRect.x1, curRect.y1,
-                          curRect.x2 - curRect.x1, curRect.y2 - curRect.y1);
-            } else {
-                glScissor(curRect.x1, drawable_height - curRect.y2,
-                          curRect.x2 - curRect.x1, curRect.y2 - curRect.y1);
-            }
-            checkGLcall("glScissor");
-
-            glClear(glMask);
-            checkGLcall("glClear");
-        }
-    }
-
-    /* Restore the old values (why..?) */
-    if (Flags & WINED3DCLEAR_STENCIL) {
-        glStencilMask(This->stateBlock->renderState[WINED3DRS_STENCILWRITEMASK]);
-    }
-    if (Flags & WINED3DCLEAR_TARGET) {
-        DWORD mask = This->stateBlock->renderState[WINED3DRS_COLORWRITEENABLE];
-        glColorMask(mask & WINED3DCOLORWRITEENABLE_RED ? GL_TRUE : GL_FALSE,
-                    mask & WINED3DCOLORWRITEENABLE_GREEN ? GL_TRUE : GL_FALSE,
-                    mask & WINED3DCOLORWRITEENABLE_BLUE  ? GL_TRUE : GL_FALSE,
-                    mask & WINED3DCOLORWRITEENABLE_ALPHA ? GL_TRUE : GL_FALSE);
-
-        /* Dirtify the target surface for now. If the surface is locked regularly, and an up to date sysmem copy exists,
-         * it is most likely more efficient to perform a clear on the sysmem copy too instead of downloading it
-         */
-        IWineD3DSurface_ModifyLocation(This->lastActiveRenderTarget, SFLAG_INDRAWABLE, TRUE);
-        /* TODO: Move the fbo logic into ModifyLocation() */
-        if(This->render_offscreen && wined3d_settings.offscreen_rendering_mode == ORM_FBO) {
-            target->Flags |= SFLAG_INTEXTURE;
-        }
-    }
-    LEAVE_GL();
+    IWineD3DDeviceImpl_ClearSurface(This, target, Count, pRects, Flags, Color, Z, Stencil);
 
     return WINED3D_OK;
 }
-- 
1.5.3.4


--------------020901050207010200020603--


From wine-devel at kievinfo.com  Sat Dec 15 00:18:35 2007
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Fri, 14 Dec 2007 23:18:35 -0700
Subject: [PATCH] dinput: mouse.c: extracted the warping code into a
	function, got rid from goto's in alloc_device,
	and made the code more readable. (no change in functionality)
In-Reply-To: <4763175F.6030102@gmail.com>
References: <4762AB1A.4020607@gmail.com> <4762F0AF.2090603@kievinfo.com>
	<4763175F.6030102@gmail.com>
Message-ID: <476371BB.2030803@kievinfo.com>

There is nothing to maintain in that warping code. It needs to be removed 
you right. But you can do that only after x11drv can properly warp mouse 
itself (and keep it from leaving Wine window).

And for format only changes - read that link. It explains what type of 
changes you should not send.

Vitaliy.

Adam Rimon wrote:
> Using gotos is ok, when it's really needed. There is no need to use 
> gotos here - it doesn't save source lines.
> Why are you against changing the format and fixing the mixed using of 
> tabs and white spaces?
> Anyway, extracting the warping code into a function makes the warping 
> code more maintainable.
> 
> On 12/14/2007 11:07 PM, Vitaliy Margolen wrote:
>> First of all your patch is wrapped. Second, do not send white space 
>> changes only. Same for formatting - do not change formatting only. If 
>> you can't read it, reformat for yourself, or get used to reading some 
>> one else's code.
>>
>> What's wrong with gotos? If you don't like it doesn't mean everyone 
>> else can't use them. Don't change that part. Copying 10 lines of code 
>> into 10 places doesn't justify removing 10 lines of code.
>>
>> You should probably check the patch requirements: 
>> http://winehq.org/site/sending_patches
>>
>> Vitaliy.
>>
>> Adam Rimon wrote:
>>> ---
>>>
>>>  dlls/dinput/mouse.c |  415 
>>> +++++++++++++++++++++++++++++----------------------
>>>  1 files changed, 235 insertions(+), 180 deletions(-)
>>>
>>
> 



From adamrimon at gmail.com  Sat Dec 15 03:01:44 2007
From: adamrimon at gmail.com (Adam Rimon)
Date: Sat, 15 Dec 2007 11:01:44 +0200
Subject: [PATCH] dinput: mouse.c: extracted the warping code into a
	function, got rid from goto's in alloc_device,
	and made the code more readable. (no change in functionality)
In-Reply-To: <476371BB.2030803@kievinfo.com>
References: <4762AB1A.4020607@gmail.com>
	<4762F0AF.2090603@kievinfo.com>	<4763175F.6030102@gmail.com>
	<476371BB.2030803@kievinfo.com>
Message-ID: <476397F8.5070400@gmail.com>

Yeah, I read it. Can you explain to me the logic behind this decision 
(In general, not about this specific code)?

I think formatting a code is an important thing to do.

It makes the code easier to understand for programmers who have never 
seen the code before,

and makes it also more maintainable.


In this code, for example, the white spaces and tabs are mixed, the 
curly braces are sometimes right next to the line before

and sometimes in the next line, etc.


-Adam


On 12/15/2007 08:18 AM, Vitaliy Margolen wrote:

> There is nothing to maintain in that warping code. It needs to be removed 
> you right. But you can do that only after x11drv can properly warp mouse 
> itself (and keep it from leaving Wine window).
>
> And for format only changes - read that link. It explains what type of 
> changes you should not send.
>
> Vitaliy.
>
> Adam Rimon wrote:
>   
>> Using gotos is ok, when it's really needed. There is no need to use 
>> gotos here - it doesn't save source lines.
>> Why are you against changing the format and fixing the mixed using of 
>> tabs and white spaces?
>> Anyway, extracting the warping code into a function makes the warping 
>> code more maintainable.
>>
>> On 12/14/2007 11:07 PM, Vitaliy Margolen wrote:
>>     
>>> First of all your patch is wrapped. Second, do not send white space 
>>> changes only. Same for formatting - do not change formatting only. If 
>>> you can't read it, reformat for yourself, or get used to reading some 
>>> one else's code.
>>>
>>> What's wrong with gotos? If you don't like it doesn't mean everyone 
>>> else can't use them. Don't change that part. Copying 10 lines of code 
>>> into 10 places doesn't justify removing 10 lines of code.
>>>
>>> You should probably check the patch requirements: 
>>> http://winehq.org/site/sending_patches
>>>
>>> Vitaliy.
>>>
>>> Adam Rimon wrote:
>>>       
>>>> ---
>>>>
>>>>  dlls/dinput/mouse.c |  415 
>>>> +++++++++++++++++++++++++++++----------------------
>>>>  1 files changed, 235 insertions(+), 180 deletions(-)
>>>>
>>>>         
>
>
>
>   

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20071215/12b48f0a/attachment.htm 

From kai.blin at gmail.com  Sat Dec 15 03:35:17 2007
From: kai.blin at gmail.com (Kai Blin)
Date: Sat, 15 Dec 2007 10:35:17 +0100
Subject: [PATCH] dinput: mouse.c: extracted the warping code into a
	function, got rid from goto's in alloc_device,
	and made the code more readable. (no change in functionality)
In-Reply-To: <476397F8.5070400@gmail.com>
References: <4762AB1A.4020607@gmail.com> <476371BB.2030803@kievinfo.com>
	<476397F8.5070400@gmail.com>
Message-ID: <200712151035.20879.kai.blin@gmail.com>

On Saturday 15 December 2007 10:01:44 Adam Rimon wrote:
> Yeah, I read it. Can you explain to me the logic behind this decision
> (In general, not about this specific code)?

You mess up the output of e.g. git blame without ever changing the 
functionality of the code.

> I think formatting a code is an important thing to do.

Yes, but it needs to be done initially, or when the code is touched, not for 
it's own sake.

> It makes the code easier to understand for programmers who have never
> seen the code before,

If they want to read the code the way you think it should be read.

> and makes it also more maintainable.

Agreed.

> In this code, for example, the white spaces and tabs are mixed, the
> curly braces are sometimes right next to the line before
> and sometimes in the next line, etc.

I think there's no argument about the less than optimal formatting of the code 
you're talking about. Nevertheless, we're just telling you that it's very 
unlikely that this patch will be rejected.

Alexandre doesn't like patches like that, you'll have to fork or deal with it. 
People on this list decided to deal with it, so don't be surprised if that's 
the answer you get again and again.

Cheers,
Kai

-- 
Kai Blin
WorldForge developer  http://www.worldforge.org/
Wine developer        http://wiki.winehq.org/KaiBlin
Samba team member     http://www.samba.org/samba/team/
--
Will code for cotton.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071215/5dbea26b/attachment.pgp 

From fgouget at free.fr  Sat Dec 15 04:45:31 2007
From: fgouget at free.fr (Francois Gouget)
Date: Sat, 15 Dec 2007 11:45:31 +0100 (CET)
Subject: [5/5] gdi: Test bitmap depths
In-Reply-To: <200712150158.21712.stefan@codeweavers.com>
References: <200712112131.39384.stefan@codeweavers.com>
	<200712120814.44250.stefan@codeweavers.com>
	<Pine.LNX.4.64.0712150116360.31271@amboise.dolphin>
	<200712150158.21712.stefan@codeweavers.com>
Message-ID: <Pine.LNX.4.64.0712151145001.16999@amboise.dolphin>

On Sat, 15 Dec 2007, Stefan D?singer wrote:

> Am Samstag, 15. Dezember 2007 01:19:05 schrieb Francois Gouget:
> > On Wed, 12 Dec 2007, Stefan D?singer wrote:
> > [...]
> >
> > > It is the intention of this patch, and coming ones, to clean up the 24/32
> > > bpp mess, also with regard to 15/16 bpp confusion, although I am missing
> > > hardware capable of running X at depth 15 for testing, so it will be
> > > mainly about the 24/32 bpp differences which break some games.
> >
> > VNC server supports all depths, including 15bpp. It's ideal for tests.
> Do you mean the X11 VNC server? Or some Windows server?

The X11 one. It's pretty useful for testing Wine, though I admit it 
won't help you test Windows.

-- 
Francois Gouget <fgouget at free.fr>              http://fgouget.free.fr/
    Indifference will certainly be the downfall of mankind, but who cares?

From stefan at codeweavers.com  Sat Dec 15 11:06:43 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sat, 15 Dec 2007 18:06:43 +0100
Subject: ENTER_GL and ActivateContext question
In-Reply-To: <4763B848.1010306@inbox.lv>
References: <475D79E5.4010706@inbox.lv>
	<200712132200.15008.stefan@codeweavers.com>
	<4763B848.1010306@inbox.lv>
Message-ID: <200712151806.46852.stefan@codeweavers.com>

Am Samstag, 15. Dezember 2007 12:19:36 schrieb Alexander Dorofeyev:
> This seems to be specific to front buffer. Maybe
> glFlush really should be called in BltOverride (or clearing subroutine) if
> the target is front buffer?
Yes, glFlush() has to be called when writing to the front buffer. SwapBuffers 
does an implicit flush, so for the back buffer you don't have to do anything, 
but the front buffer needs a glFlush(). It isn't there yet, so it should be 
added.

Your patch looks quite good, but you should remove the original code from 
IWineD3DDeviceImpl_Clear() and make it call ClearSurface() as well.

The fbo activation you moved is a different problem. It needs to be fixed as 
well, but it is not as easy as swapping the calls :-( . Essentially, 
ActivateContext has to be called before the fbo setup, due to multithreading 
concerns. On the other hand, some things ActivateContext does fail if an fbo 
is active, so fbos must be set before activatecontext. Essentially we'll have 
to move fbo setup into ActivateContext, but this has some implications on 
multiple render targets and depth stencil swapping which need more 
investigation. OpenGL driver limitations play a role here as well.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071215/3cd80dd2/attachment.pgp 

From wine-devel at kievinfo.com  Sat Dec 15 11:08:56 2007
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sat, 15 Dec 2007 10:08:56 -0700
Subject: New bugzilla components.
Message-ID: <47640A28.7080701@kievinfo.com>

Please add these new components:

wine-vdm - Wine 16-bit compatibility layer
wine-comdlg - Common dialogs such as open/save/print/font

Vitaliy.


From actong88 at gmail.com  Sat Dec 15 12:19:25 2007
From: actong88 at gmail.com (Allan Tong)
Date: Sat, 15 Dec 2007 13:19:25 -0500
Subject: wined3d: Bind device framebuffer in ActivateContext
In-Reply-To: <d75158870711252200r4684de95x1e7a109446707e5b@mail.gmail.com>
References: <d75158870711241507s3c43ae9dvcb20e7b1ec822299@mail.gmail.com>
	<200711251315.13466.stefan@codeweavers.com>
	<d75158870711250913k4eca0ad6r511969b6791578dd@mail.gmail.com>
	<200711251930.24876.stefan@codeweavers.com>
	<d75158870711252200r4684de95x1e7a109446707e5b@mail.gmail.com>
Message-ID: <d75158870712151019u2597d85fh19869de5ae11b339@mail.gmail.com>

Here's my second attempt at this, this time merging FBO draw buffer
selection into ActivateContext.  Could you please review it?
Hopefully I'm going in the right direction.  The first patch moves the
call to ActivateContext before the GL calls that setup the blit.  This
is needed so the second patch doesn't break stretch_rect_fbo.

The second patch moves FBO draw buffer selection to ActivateContext.
For onscreen rendering, not much changes except binding framebuffer 0.
 For offscreen rendering, the behavior depends on the specified
context usage.  For BLIT and RESOURCE_LOAD, the target surface is
attached to dst_fbo and used as the draw buffer.  For DRAWPRIM and
CLEAR, I simply call apply_fbo_state.  This assumes that DRAWPRIM and
CLEAR will always be used with device->render_targets[0].

With these patches, the visual tests in ddraw/d3d8/d3d9 mostly succeed
with FBO offscreen rendering.  The newly added alpha blending test
still fails in ddraw, but it still does better than without the
patches.

 - Allan
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: 0001-wined3d-Activate-GL-context-before-making-any-GL-ca.patch
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20071215/2ab49af1/attachment.txt 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: 0002-wined3d-Make-FBO-draw-buffer-selection-in-ActivateC.patch
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20071215/2ab49af1/attachment-0001.txt 

From shachar at shemesh.biz  Sat Dec 15 16:38:46 2007
From: shachar at shemesh.biz (Shachar Shemesh)
Date: Sun, 16 Dec 2007 00:38:46 +0200
Subject: Wine and LD_PRELOAD
In-Reply-To: <200711182348.31301.lionel.tricon@free.fr>
References: <200711181713.20173.lionel.tricon@free.fr>	<200711182014.43381.stefandoesinger@gmx.at>
	<200711182348.31301.lionel.tricon@free.fr>
Message-ID: <47645776.40905@shemesh.biz>

Sorry for answering a little late.


Lionel Tricon wrote:

> In fact, we overload a lot of common system call from the standard libc. We 
> have slightly modified the fackechroot library and we need to trap almost all 
> system calls linked to the filesystem.
I have just (a couple of weeks ago) started a project called 
Fakeroot-ng. You can get the (extremely preliminary) sources from SVN on 
http://sf.net/projects/fakerootng.

Fakeroot-ng aims to achieve the same goal as fakeroot and fakechroot, 
except it uses the ptrace interface rather than the LD_PRELOAD 
interface, which, as you can see, has lots and lots of problems with 
non-standard applications.

Fakeroot-ng is extremely far from being complete at the moment, but if 
you will find it useful, then I can use the extra programming skills.

Shachar


From dmitry at codeweavers.com  Sat Dec 15 22:19:00 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sun, 16 Dec 2007 12:19:00 +0800
Subject: New bugzilla components.
References: <47640A28.7080701@kievinfo.com>
Message-ID: <004f01c83f9a$cae2e500$a600fea9@DMITRY>

"Vitaliy Margolen" <wine-devel at kievinfo.com> wrote:

> Please add these new components:
> 
> wine-vdm - Wine 16-bit compatibility layer
> wine-comdlg - Common dialogs such as open/save/print/font

(it either should be wine-commdlg, or wine-comdlg32 IMO)

What's happened to the proposal to remove the wine- prefix from
bugzilla components and have the components represent the dlls
they belong to?

-- 
Dmitry.


From dmitry at codeweavers.com  Sat Dec 15 22:24:36 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sun, 16 Dec 2007 12:24:36 +0800
Subject: winex11.drv deadkey handling and games
References: <154588.83243.qm@web38009.mail.mud.yahoo.com>
Message-ID: <007201c83f9b$929024a0$a600fea9@DMITRY>

"F Capela" <darkwalker_ at yahoo.com> wrote:

> A small fix to those who play games using keyboard layouts with
> deadkeys. Patch generated against 0.9.51 release.
> Wine currently don't pass keypress events to the windows executable
> when the keypress is either a deadkey or follows a deadkey. This makes
> it impossible to use any of those keys with games that use WM_KEYDOWN
> events to track keypresses - two examples are Guild Wars and World of
> Warcraft.
> This patch modifies dlls/winex11.drv/event.c to send all keypresses to
> the client, and dlls/winex11.drv/keyboard.c to implement a WM_KEYDOWN
> translation cache in order to correctly treat them as keys or deadkeys
> and keep text input with deadkeys working.
> Only tested with Notepad and Guild Wars.
> This is my first patch; don't hesitate to point any problems.

This hack completely breaks native dead keys support on the X11 side.
First thing to do is to write a test case which replicates the behaviour
you would like to fix.

-- 
Dmitry.


From wine-devel at kievinfo.com  Sat Dec 15 22:27:52 2007
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sat, 15 Dec 2007 21:27:52 -0700
Subject: New bugzilla components.
In-Reply-To: <004f01c83f9a$cae2e500$a600fea9@DMITRY>
References: <47640A28.7080701@kievinfo.com>
	<004f01c83f9a$cae2e500$a600fea9@DMITRY>
Message-ID: <4764A948.9050205@kievinfo.com>

Dmitry Timoshkov wrote:
> "Vitaliy Margolen" <wine-devel at kievinfo.com> wrote:
> 
>> Please add these new components:
>>
>> wine-vdm - Wine 16-bit compatibility layer
>> wine-comdlg - Common dialogs such as open/save/print/font
> 
> (it either should be wine-commdlg, or wine-comdlg32 IMO)
Doesn't matter they all uniquely identify the part of Wine. I'd like to have 
"comdlg" - it corresponds to the dll name without "32" part.

> 
> What's happened to the proposal to remove the wine- prefix from
> bugzilla components and have the components represent the dlls
> they belong to?
> 

This would be really nice, however not sure how much work will it take. 
Don't think bugzilla supports renaming of the components. Might need some 
custom converter.

Vitaliy


From dmitry at codeweavers.com  Sat Dec 15 22:29:25 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sun, 16 Dec 2007 12:29:25 +0800
Subject: Clear padding in the buffer due to alignment.
References: <4762DF71.70702@codeweavers.com>
Message-ID: <008401c83f9c$3ebef850$a600fea9@DMITRY>

"Robert Shearman" <rob at codeweavers.com> wrote:

> This isn't done in MIDL, but I think it's desirable both for silencing 
> Valgrind warnings and for security purposes (fixes potential for leaking 
> information to remote computers or other processes).

> +    print_file(file, indent, "memset(_StubMsg.Buffer, 0, ((long)_StubMsg.Buffer) & 0x%x);\n", alignment - 1);

Is it possible to make it 64-bit and Wine/Windows compatible by using
ULONG_PTR instead of long?

-- 
Dmitry.


From truiken at gmail.com  Sat Dec 15 22:34:18 2007
From: truiken at gmail.com (James Hawkins)
Date: Sat, 15 Dec 2007 22:34:18 -0600
Subject: New bugzilla components.
In-Reply-To: <004f01c83f9a$cae2e500$a600fea9@DMITRY>
References: <47640A28.7080701@kievinfo.com>
	<004f01c83f9a$cae2e500$a600fea9@DMITRY>
Message-ID: <22821af30712152034t1ee5318ai38eba71df919d38f@mail.gmail.com>

On Dec 15, 2007 10:19 PM, Dmitry Timoshkov <dmitry at codeweavers.com> wrote:
>
> "Vitaliy Margolen" <wine-devel at kievinfo.com> wrote:
>
> > Please add these new components:
> >
> > wine-vdm - Wine 16-bit compatibility layer
> > wine-comdlg - Common dialogs such as open/save/print/font
>
> (it either should be wine-commdlg, or wine-comdlg32 IMO)
>
> What's happened to the proposal to remove the wine- prefix from
> bugzilla components and have the components represent the dlls
> they belong to?
>

Yes, can someone with sufficient privileges enact what was agreed upon
by the majority in this thread:

http://www.winehq.org/pipermail/wine-devel/2007-October/059715.html

To summarize:

* Change all wine-X components to just X.
* Remove the following components:
  - wine-rebar
  - wine-gui
  - wine-multimedia
  - wine-net
  - wine-patches
  - test

Any bug report listed under the components that are removed would have
to be set to wine-misc and eventually relabeled to the correct
component (which might need to be added).  I'm not a web guy, so I
don't know how this would be done, but it would certainly be
appreciated.

Thanks,
James Hawkins


From dmitry at codeweavers.com  Sat Dec 15 22:45:32 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sun, 16 Dec 2007 12:45:32 +0800
Subject: New bugzilla components.
References: <47640A28.7080701@kievinfo.com>
	<004f01c83f9a$cae2e500$a600fea9@DMITRY>
	<22821af30712152034t1ee5318ai38eba71df919d38f@mail.gmail.com>
Message-ID: <00e801c83f9e$835afca0$a600fea9@DMITRY>

"James Hawkins" <truiken at gmail.com> wrote:

> Yes, can someone with sufficient privileges enact what was agreed upon
> by the majority in this thread:
> 
> http://www.winehq.org/pipermail/wine-devel/2007-October/059715.html
> 
> To summarize:
> 
> * Change all wine-X components to just X.
> * Remove the following components:
>  - wine-rebar
>  - wine-gui
>  - wine-multimedia
>  - wine-net
>  - wine-patches
>  - test

Also remove wine-binary, wine-debug, wine-files, wine-gdi (printing), wine-gui,
wine-ipc, wine-net, wine-patches, wine-ports, wine-resources, wine-winelib

Rename wine-kernel -> kernel32, wine-ole -> ole32, wine-opengl -> opengl32,
wine-user -> user32

Add gdi32, ntdll, oleaut32, rpcrt4 and any other missing DLL component.

-- 
Dmitry.


From truiken at gmail.com  Sat Dec 15 22:48:41 2007
From: truiken at gmail.com (James Hawkins)
Date: Sat, 15 Dec 2007 22:48:41 -0600
Subject: New bugzilla components.
In-Reply-To: <00e801c83f9e$835afca0$a600fea9@DMITRY>
References: <47640A28.7080701@kievinfo.com>
	<004f01c83f9a$cae2e500$a600fea9@DMITRY>
	<22821af30712152034t1ee5318ai38eba71df919d38f@mail.gmail.com>
	<00e801c83f9e$835afca0$a600fea9@DMITRY>
Message-ID: <22821af30712152048y6186aca0s13e98b5f44ab7b0e@mail.gmail.com>

On Dec 15, 2007 10:45 PM, Dmitry Timoshkov <dmitry at codeweavers.com> wrote:
> "James Hawkins" <truiken at gmail.com> wrote:
>
> > Yes, can someone with sufficient privileges enact what was agreed upon
> > by the majority in this thread:
> >
> > http://www.winehq.org/pipermail/wine-devel/2007-October/059715.html
> >
> > To summarize:
> >
> > * Change all wine-X components to just X.
> > * Remove the following components:
> >  - wine-rebar
> >  - wine-gui
> >  - wine-multimedia
> >  - wine-net
> >  - wine-patches
> >  - test
>
> Also remove wine-binary, wine-debug, wine-files, wine-gdi (printing), wine-gui,
> wine-ipc, wine-net, wine-patches, wine-ports, wine-resources, wine-winelib
>
> Rename wine-kernel -> kernel32, wine-ole -> ole32, wine-opengl -> opengl32,
> wine-user -> user32
>
> Add gdi32, ntdll, oleaut32, rpcrt4 and any other missing DLL component.
>

And if there are objections to this approach, I'd like to remind all
that we decided to use keywords for generic identification, like we've
successfully done with the Installer keyword.

-- 
James Hawkins


From wine-devel at kievinfo.com  Sat Dec 15 23:02:48 2007
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sat, 15 Dec 2007 22:02:48 -0700
Subject: New bugzilla components.
In-Reply-To: <00e801c83f9e$835afca0$a600fea9@DMITRY>
References: <47640A28.7080701@kievinfo.com>
	<004f01c83f9a$cae2e500$a600fea9@DMITRY>
	<22821af30712152034t1ee5318ai38eba71df919d38f@mail.gmail.com>
	<00e801c83f9e$835afca0$a600fea9@DMITRY>
Message-ID: <4764B178.2030501@kievinfo.com>

Dmitry Timoshkov wrote:
> Rename wine-kernel -> kernel32, wine-ole -> ole32, wine-opengl -> opengl32,
> wine-user -> user32
> 
Why do you want "32" at the end? Also note that opengl32 is a thunk dll. 
Most of it's code somewhere else.

> Add gdi32, ntdll, oleaut32, rpcrt4 and any other missing DLL component.
> 
No, please do not add all dlls, listed are fine. That will create huge 
clutter. Lets do it one at a time, whenever we need it.


From truiken at gmail.com  Sat Dec 15 23:09:51 2007
From: truiken at gmail.com (James Hawkins)
Date: Sat, 15 Dec 2007 23:09:51 -0600
Subject: New bugzilla components.
In-Reply-To: <4764B178.2030501@kievinfo.com>
References: <47640A28.7080701@kievinfo.com>
	<004f01c83f9a$cae2e500$a600fea9@DMITRY>
	<22821af30712152034t1ee5318ai38eba71df919d38f@mail.gmail.com>
	<00e801c83f9e$835afca0$a600fea9@DMITRY>
	<4764B178.2030501@kievinfo.com>
Message-ID: <22821af30712152109s63200d36w7326948ba13ad7cf@mail.gmail.com>

On Dec 15, 2007 11:02 PM, Vitaliy Margolen <wine-devel at kievinfo.com> wrote:
> Dmitry Timoshkov wrote:
> > Rename wine-kernel -> kernel32, wine-ole -> ole32, wine-opengl -> opengl32,
> > wine-user -> user32
> >
> Why do you want "32" at the end? Also note that opengl32 is a thunk dll.
> Most of it's code somewhere else.
>

It's consistent with the policy: one component per module reported.
What do you have against the 32?  As opengl32 is a thunk, there
shouldn't be any bug reports attributed to that component, and the
component shouldn't exist.  I'm fine with an opengl keyword if people
want it, but as you said, the bug lies elsewhere.

> > Add gdi32, ntdll, oleaut32, rpcrt4 and any other missing DLL component.
> >
> No, please do not add all dlls, listed are fine. That will create huge
> clutter. Lets do it one at a time, whenever we need it.
>

I'm fine with waiting for the report to add components, but there are
bug reports now that need components that do not exist.

-- 
James Hawkins


From dmitry at codeweavers.com  Sat Dec 15 23:10:45 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sun, 16 Dec 2007 13:10:45 +0800
Subject: New bugzilla components.
References: <47640A28.7080701@kievinfo.com><004f01c83f9a$cae2e500$a600fea9@DMITRY><22821af30712152034t1ee5318ai38eba71df919d38f@mail.gmail.com><00e801c83f9e$835afca0$a600fea9@DMITRY>
	<4764B178.2030501@kievinfo.com>
Message-ID: <027801c83fa2$0548fb60$a600fea9@DMITRY>

"Vitaliy Margolen" <wine-devel at kievinfo.com> wrote:

>> Rename wine-kernel -> kernel32, wine-ole -> ole32, wine-opengl -> opengl32,
>> wine-user -> user32
>> 
> Why do you want "32" at the end? Also note that opengl32 is a thunk dll. 
> Most of it's code somewhere else.

If the component exists it should be named properly, i.e. represent the DLL
it belongs to in order to avoid a possible confusion.

-- 
Dmitry.


From wine-devel at kievinfo.com  Sat Dec 15 23:27:08 2007
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sat, 15 Dec 2007 22:27:08 -0700
Subject: New bugzilla components.
In-Reply-To: <22821af30712152109s63200d36w7326948ba13ad7cf@mail.gmail.com>
References: <47640A28.7080701@kievinfo.com>	
	<004f01c83f9a$cae2e500$a600fea9@DMITRY>	
	<22821af30712152034t1ee5318ai38eba71df919d38f@mail.gmail.com>	
	<00e801c83f9e$835afca0$a600fea9@DMITRY>	
	<4764B178.2030501@kievinfo.com>
	<22821af30712152109s63200d36w7326948ba13ad7cf@mail.gmail.com>
Message-ID: <4764B72C.4020709@kievinfo.com>

James Hawkins wrote:
> On Dec 15, 2007 11:02 PM, Vitaliy Margolen <wine-devel at kievinfo.com> wrote:
>> Dmitry Timoshkov wrote:
>>> Rename wine-kernel -> kernel32, wine-ole -> ole32, wine-opengl -> opengl32,
>>> wine-user -> user32
>>>
>> Why do you want "32" at the end? Also note that opengl32 is a thunk dll.
>> Most of it's code somewhere else.
>>
> 
> It's consistent with the policy: one component per module reported.
> What do you have against the 32?  As opengl32 is a thunk, there
> shouldn't be any bug reports attributed to that component, and the
> component shouldn't exist.  I'm fine with an opengl keyword if people
> want it, but as you said, the bug lies elsewhere.
> 
Assigning openGL bugs to user32 or gdi32 doesn't make it any more clear 
where the problem is. Because in most case that would be somewhere between 
x11drv, gdi32, user32. There are lots of examples like that all over the 
place. Don't forget who designed all this... hm not even sure there was any 
designs actually. Hard assigning bugs to the dll won't make it any better 
then too generic categories like we have now.

>>> Add gdi32, ntdll, oleaut32, rpcrt4 and any other missing DLL component.
>>>
>> No, please do not add all dlls, listed are fine. That will create huge
>> clutter. Lets do it one at a time, whenever we need it.
>>
> 
> I'm fine with waiting for the report to add components, but there are
> bug reports now that need components that do not exist.
> 
Then please list them.


From wine-devel at kievinfo.com  Sat Dec 15 23:28:38 2007
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sat, 15 Dec 2007 22:28:38 -0700
Subject: New bugzilla components.
In-Reply-To: <027801c83fa2$0548fb60$a600fea9@DMITRY>
References: <47640A28.7080701@kievinfo.com><004f01c83f9a$cae2e500$a600fea9@DMITRY><22821af30712152034t1ee5318ai38eba71df919d38f@mail.gmail.com><00e801c83f9e$835afca0$a600fea9@DMITRY>
	<4764B178.2030501@kievinfo.com>
	<027801c83fa2$0548fb60$a600fea9@DMITRY>
Message-ID: <4764B786.20206@kievinfo.com>

Dmitry Timoshkov wrote:
> "Vitaliy Margolen" <wine-devel at kievinfo.com> wrote:
> 
>>> Rename wine-kernel -> kernel32, wine-ole -> ole32, wine-opengl -> 
>>> opengl32,
>>> wine-user -> user32
>>>
>> Why do you want "32" at the end? Also note that opengl32 is a thunk 
>> dll. Most of it's code somewhere else.
> 
> If the component exists it should be named properly, i.e. represent the DLL
> it belongs to in order to avoid a possible confusion.
> 
That's the part I'd like to avoid. Unless we want to list most of the 
subsystems in keywords, that span small parts of multiple dlls.


From dmitry at codeweavers.com  Sat Dec 15 23:46:19 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sun, 16 Dec 2007 13:46:19 +0800
Subject: New bugzilla components.
References: <47640A28.7080701@kievinfo.com><004f01c83f9a$cae2e500$a600fea9@DMITRY><22821af30712152034t1ee5318ai38eba71df919d38f@mail.gmail.com><00e801c83f9e$835afca0$a600fea9@DMITRY><4764B178.2030501@kievinfo.com><027801c83fa2$0548fb60$a600fea9@DMITRY>
	<4764B786.20206@kievinfo.com>
Message-ID: <037b01c83fa6$fd023340$a600fea9@DMITRY>

"Vitaliy Margolen" <wine-devel at kievinfo.com> wrote:

>> If the component exists it should be named properly, i.e. represent the DLL
>> it belongs to in order to avoid a possible confusion.
>> 
> That's the part I'd like to avoid. Unless we want to list most of the 
> subsystems in keywords, that span small parts of multiple dlls.

In the vast majority of cases a bug belongs to a particular DLL, not
a group of DLLs, in very rare cases the keywords are supposed to help
with identification of the component.

-- 
Dmitry.


From truiken at gmail.com  Sun Dec 16 00:08:57 2007
From: truiken at gmail.com (James Hawkins)
Date: Sun, 16 Dec 2007 00:08:57 -0600
Subject: New bugzilla components.
In-Reply-To: <4764B72C.4020709@kievinfo.com>
References: <47640A28.7080701@kievinfo.com>
	<004f01c83f9a$cae2e500$a600fea9@DMITRY>
	<22821af30712152034t1ee5318ai38eba71df919d38f@mail.gmail.com>
	<00e801c83f9e$835afca0$a600fea9@DMITRY>
	<4764B178.2030501@kievinfo.com>
	<22821af30712152109s63200d36w7326948ba13ad7cf@mail.gmail.com>
	<4764B72C.4020709@kievinfo.com>
Message-ID: <22821af30712152208l70db8d0cn56c94b893e38ad53@mail.gmail.com>

On Dec 15, 2007 11:27 PM, Vitaliy Margolen <wine-devel at kievinfo.com> wrote:
> James Hawkins wrote:
> > On Dec 15, 2007 11:02 PM, Vitaliy Margolen <wine-devel at kievinfo.com> wrote:
> >> Dmitry Timoshkov wrote:
> >>> Rename wine-kernel -> kernel32, wine-ole -> ole32, wine-opengl -> opengl32,
> >>> wine-user -> user32
> >>>
> >> Why do you want "32" at the end? Also note that opengl32 is a thunk dll.
> >> Most of it's code somewhere else.
> >>
> >
> > It's consistent with the policy: one component per module reported.
> > What do you have against the 32?  As opengl32 is a thunk, there
> > shouldn't be any bug reports attributed to that component, and the
> > component shouldn't exist.  I'm fine with an opengl keyword if people
> > want it, but as you said, the bug lies elsewhere.
> >
> Assigning openGL bugs to user32 or gdi32 doesn't make it any more clear
> where the problem is. Because in most case that would be somewhere between
> x11drv, gdi32, user32. There are lots of examples like that all over the
> place. Don't forget who designed all this... hm not even sure there was any
> designs actually. Hard assigning bugs to the dll won't make it any better
> then too generic categories like we have now.
>
> >>> Add gdi32, ntdll, oleaut32, rpcrt4 and any other missing DLL component.
> >>>
> >> No, please do not add all dlls, listed are fine. That will create huge
> >> clutter. Lets do it one at a time, whenever we need it.
> >>
> >
> > I'm fine with waiting for the report to add components, but there are
> > bug reports now that need components that do not exist.
> >
> Then please list them.
>

As Dmitry already said: ntdl, oleaut32, rpcrt4.  Searching through
bugzilla: wininet, wintrust, secur32, advpack, hhctrl, imagehlp,
mshtml, shlwapi, urlmon.  There are probably more, but that's a good
starter list.

-- 
James Hawkins


From kai.blin at gmail.com  Sun Dec 16 02:33:04 2007
From: kai.blin at gmail.com (Kai Blin)
Date: Sun, 16 Dec 2007 09:33:04 +0100
Subject: New bugzilla components.
In-Reply-To: <22821af30712152034t1ee5318ai38eba71df919d38f@mail.gmail.com>
References: <47640A28.7080701@kievinfo.com>
	<004f01c83f9a$cae2e500$a600fea9@DMITRY>
	<22821af30712152034t1ee5318ai38eba71df919d38f@mail.gmail.com>
Message-ID: <200712160933.09187.kai.blin@gmail.com>

On Sunday 16 December 2007 05:34:18 James Hawkins wrote:

> * Remove the following components:
>   - wine-rebar
>   - wine-gui
>   - wine-multimedia
>   - wine-net
>   - wine-patches
>   - test
>
> Any bug report listed under the components that are removed would have
> to be set to wine-misc and eventually relabeled to the correct
> component (which might need to be added).  I'm not a web guy, so I
> don't know how this would be done, but it would certainly be
> appreciated.

Is there an inherent advantage of splitting wine-net into wininet and winsock?
(Apart from probably getting less .NET bugs filed in the category? ;) )

I'm not sure if diversifying more than needed will actually help. The time 
saved by not seeing e.g. wininet reports in the winsock category might be 
spent reclassifying bugs to the appropriate category. Right now users can 
just select "wine-net" if there's a problem with networking.

Cheers,
Kai

-- 
Kai Blin
WorldForge developer  http://www.worldforge.org/
Wine developer        http://wiki.winehq.org/KaiBlin
Samba team member     http://www.samba.org/samba/team/
--
Will code for cotton.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071216/0cb99b7b/attachment.pgp 

From kai.blin at gmail.com  Sun Dec 16 02:36:26 2007
From: kai.blin at gmail.com (Kai Blin)
Date: Sun, 16 Dec 2007 09:36:26 +0100
Subject: New bugzilla components.
In-Reply-To: <22821af30712152208l70db8d0cn56c94b893e38ad53@mail.gmail.com>
References: <47640A28.7080701@kievinfo.com> <4764B72C.4020709@kievinfo.com>
	<22821af30712152208l70db8d0cn56c94b893e38ad53@mail.gmail.com>
Message-ID: <200712160936.26873.kai.blin@gmail.com>

On Sunday 16 December 2007 07:08:57 James Hawkins wrote:
> As Dmitry already said: ntdl, oleaut32, rpcrt4.  Searching through
> bugzilla: wininet, wintrust, secur32, advpack, hhctrl, imagehlp,
> mshtml, shlwapi, urlmon.  There are probably more, but that's a good
> starter list.

There's a category for secur32, called wine-sspi for now. As Microsoft calls 
the whole GSSAPI clone implemented in secur32 and possibly additional dlls 
SSPI, it makes sense to call the bugzilla component that way.

Cheers,
Kai

-- 
Kai Blin
WorldForge developer  http://www.worldforge.org/
Wine developer        http://wiki.winehq.org/KaiBlin
Samba team member     http://www.samba.org/samba/team/
--
Will code for cotton.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071216/ddc2acc9/attachment-0001.pgp 

From wine at electrozaur.com  Sun Dec 16 03:50:24 2007
From: wine at electrozaur.com (Boaz Harrosh)
Date: Sun, 16 Dec 2007 11:50:24 +0200
Subject: COM
In-Reply-To: <1197306368.5800.4.camel@brentano>
References: <1197306368.5800.4.camel@brentano>
Message-ID: <4764F4E0.1080109@electrozaur.com>

----- Original Message -----
*From:* Adelle Hartley <adelle at akemi.com.au>
*To:* wine-devel at winehq.org
*Sent:* Mon, Dec 10 2007 at 19:06 +0200
*Subject:* COM


> Hi all,
>
> I have some COM DLLs which work fine with VB6 applications on wine.
>
> Is it possible to instantiate a windowsy COM object from a linuxy
> application written in some form of C++ (eg, for compilation with gcc)?
>
> Adelle.
>
>   
You can use a C++ winlib and directly call the COM's C++ API.
It works like a charm. MinGW and Linux. C++ winlib is just your regular
winelib Makefile, with some files named .cpp the gcc will automatically
invoke g++ on them. Regular C-to-C++  linking rules apply.

GCC command line switches are the same, with 16-bit Unicode strings and
others. One more switch that you might need is that -m something that causes
all functions to use the __stdcall, because some versions of GCC have bugs
in regard to function pointers to __stdcall methods. But the regular
CoCreateInstance()/
abstract-class call works in all modes.

Happy COMing
Boaz



From dmitry at codeweavers.com  Sun Dec 16 04:12:28 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sun, 16 Dec 2007 18:12:28 +0800
Subject: New bugzilla components.
References: <47640A28.7080701@kievinfo.com>
	<004f01c83f9a$cae2e500$a600fea9@DMITRY>
	<22821af30712152034t1ee5318ai38eba71df919d38f@mail.gmail.com>
	<200712160933.09187.kai.blin@gmail.com>
Message-ID: <001101c83fcc$2b6cd490$a600fea9@DMITRY>

"Kai Blin" <kai.blin at gmail.com> wrote:

> Is there an inherent advantage of splitting wine-net into wininet and winsock?
> (Apart from probably getting less .NET bugs filed in the category? ;) )

wininet and winsock are two absolutely different layers of very different
functionality.

> I'm not sure if diversifying more than needed will actually help. The time 
> saved by not seeing e.g. wininet reports in the winsock category might be 
> spent reclassifying bugs to the appropriate category. Right now users can 
> just select "wine-net" if there's a problem with networking.

Users are not supposed to set a category the bug belongs to, this requires
an investigation and knowledge of a developer. Personally I'd prefer to have
"default" in the list instead of "wine-misc".

-- 
Dmitry.


From dmitry at codeweavers.com  Sun Dec 16 04:18:11 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sun, 16 Dec 2007 18:18:11 +0800
Subject: New bugzilla components.
References: <47640A28.7080701@kievinfo.com>
	<4764B72C.4020709@kievinfo.com><22821af30712152208l70db8d0cn56c94b893e38ad53@mail.gmail.com>
	<200712160936.26873.kai.blin@gmail.com>
Message-ID: <002701c83fcc$f8625010$a600fea9@DMITRY>

"Kai Blin" <kai.blin at gmail.com> wrote:

> There's a category for secur32, called wine-sspi for now. As Microsoft calls 
> the whole GSSAPI clone implemented in secur32 and possibly additional dlls 
> SSPI, it makes sense to call the bugzilla component that way.

sspi consists of at least a host and many security provider dlls, which by itself
tells nothing to a user, or a developer who tries to fix a bug where to look for
a problem: all of the sspi dlls? some specific dll, provider? somewhere else?

-- 
Dmitry.


From kai.blin at gmail.com  Sun Dec 16 04:49:17 2007
From: kai.blin at gmail.com (Kai Blin)
Date: Sun, 16 Dec 2007 11:49:17 +0100
Subject: New bugzilla components.
In-Reply-To: <002701c83fcc$f8625010$a600fea9@DMITRY>
References: <47640A28.7080701@kievinfo.com>
	<200712160936.26873.kai.blin@gmail.com>
	<002701c83fcc$f8625010$a600fea9@DMITRY>
Message-ID: <200712161149.22375.kai.blin@gmail.com>

On Sunday 16 December 2007 11:18:11 Dmitry Timoshkov wrote:
> "Kai Blin" <kai.blin at gmail.com> wrote:
> > There's a category for secur32, called wine-sspi for now. As Microsoft
> > calls the whole GSSAPI clone implemented in secur32 and possibly
> > additional dlls SSPI, it makes sense to call the bugzilla component that
> > way.
>
> sspi consists of at least a host and many security provider dlls, which by
> itself tells nothing to a user, or a developer who tries to fix a bug where
> to look for a problem: all of the sspi dlls? some specific dll, provider?
> somewhere else?

IIRC there are five providers that Win2k and WinXP ship, all of them 
implemented in secur32.dll. I don't see how renaming the component will 
create less confusion for the developers.

However, I'm not feeling strong enough about this to really care. If the wine- 
prefix is removed, I need to adapt my email filters anyway. :)

Cheers,
Kai

-- 
Kai Blin
WorldForge developer  http://www.worldforge.org/
Wine developer        http://wiki.winehq.org/KaiBlin
Samba team member     http://www.samba.org/samba/team/
--
Will code for cotton.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071216/eb16bb68/attachment.pgp 

From rob at codeweavers.com  Sun Dec 16 06:05:30 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Sun, 16 Dec 2007 12:05:30 +0000
Subject: New bugzilla components.
In-Reply-To: <00e801c83f9e$835afca0$a600fea9@DMITRY>
References: <47640A28.7080701@kievinfo.com>	<004f01c83f9a$cae2e500$a600fea9@DMITRY>	<22821af30712152034t1ee5318ai38eba71df919d38f@mail.gmail.com>
	<00e801c83f9e$835afca0$a600fea9@DMITRY>
Message-ID: <4765148A.204@codeweavers.com>

Dmitry Timoshkov wrote:
> Rename wine-ole -> ole32
>
> Add oleaut32, rpcrt4
>   

Currently, all of the above are filed in wine-ole and I don't have a 
problem with that. Since a common question by our bugzilla advocates is 
"does installing DCOM fix the bug?" then this makes sense.

Care needs to be taken with creating other categories too so that any 
new categories you create are useful to the developers that work on that 
area and to the people who triage bugs. (For example, consult Jacek 
before creating separate mshtml, shdocvw and urlmon components.)

-- 
Rob Shearman



From rob at codeweavers.com  Sun Dec 16 06:07:52 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Sun, 16 Dec 2007 12:07:52 +0000
Subject: Clear padding in the buffer due to alignment.
In-Reply-To: <008401c83f9c$3ebef850$a600fea9@DMITRY>
References: <4762DF71.70702@codeweavers.com>
	<008401c83f9c$3ebef850$a600fea9@DMITRY>
Message-ID: <47651518.4010403@codeweavers.com>

Dmitry Timoshkov wrote:
> "Robert Shearman" <rob at codeweavers.com> wrote:
>
>> This isn't done in MIDL, but I think it's desirable both for 
>> silencing Valgrind warnings and for security purposes (fixes 
>> potential for leaking information to remote computers or other 
>> processes).
>
>> +    print_file(file, indent, "memset(_StubMsg.Buffer, 0, 
>> ((long)_StubMsg.Buffer) & 0x%x);\n", alignment - 1);
>
> Is it possible to make it 64-bit and Wine/Windows compatible by using
> ULONG_PTR instead of long?

At the moment, widl doesn't support generating 64-bit compatible client, 
server and proxy code so doing so would be useless. FWIW, MIDL outputs 
__int64 here instead of long when targeting 64-bit.

Getting support for the Microsoft 64-bit calling convention into 
upstream gcc is the most important requirement for a 64-bit Wine.

-- 
Rob Shearman



From jan.wine at zerebecki.de  Sun Dec 16 06:20:26 2007
From: jan.wine at zerebecki.de (Jan Zerebecki)
Date: Sun, 16 Dec 2007 13:20:26 +0100
Subject: New bugzilla components.
In-Reply-To: <4764A948.9050205@kievinfo.com>
References: <47640A28.7080701@kievinfo.com>
	<004f01c83f9a$cae2e500$a600fea9@DMITRY>
	<4764A948.9050205@kievinfo.com>
Message-ID: <20071216122026.GA3426@crissy.swd.zerebecki.de>


For me with this renaming is important that at least from the
description it should then be absolutely clear what goes into a
component and what not (for a developer).


On Sat, Dec 15, 2007 at 09:27:52PM -0700, Vitaliy Margolen wrote:
> > What's happened to the proposal to remove the wine- prefix from
> > bugzilla components and have the components represent the dlls
> > they belong to?

I didn't want to remove the wine- prefix without also getting
most of the other wanted changes done in the same go. But those
require that someone gets a list of the exact changes posted and
agreed upon on. I didn't have time for that yet... but if none of
the other admins get it done I can probably find the time to make
the changes in such a list.

I think such a list would need: old name (empty for new
components); new name; description (should list other names that are associated with the
component or things contained in the component, list of source
files that this component contains with bash style globs).

We can also change the default assignee (currently
wine-bugs at winehq.org for all components) and/or default cc list
(AFAIK currently empty for all components).

Possibly bad example:
wine-directx-dshow; directx-dshow; DirectShow ( dlls/{quartz,msdmo,qcap}/ );
    dshow-hacker at test.test; dshowhacker2 at test.test, dhowhacker3 at test.text;

If we want to move all the bugs from one component to other
components we can delete the component after it doesn't contain
any bugs anymore:

wine-foo; deprecated-foo; Bugs in this component should be moved to bar or misc.

> This would be really nice, however not sure how much work will it take. 
> Don't think bugzilla supports renaming of the components. Might need some 
> custom converter.

Bugzilla supports renaming components.



Jan



From dmitry at codeweavers.com  Sun Dec 16 06:27:03 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Sun, 16 Dec 2007 20:27:03 +0800
Subject: Clear padding in the buffer due to alignment.
References: <4762DF71.70702@codeweavers.com><008401c83f9c$3ebef850$a600fea9@DMITRY>
	<47651518.4010403@codeweavers.com>
Message-ID: <00ce01c83fde$f80a8df0$a600fea9@DMITRY>

"Robert Shearman" <rob at codeweavers.com> wrote:

>> Is it possible to make it 64-bit and Wine/Windows compatible by using
>> ULONG_PTR instead of long?
> 
> At the moment, widl doesn't support generating 64-bit compatible client, 
> server and proxy code so doing so would be useless. FWIW, MIDL outputs 
> __int64 here instead of long when targeting 64-bit.

If it doesn't take too much effort to write a 64-bit clean code, why avoid
that, especially all that's required is using an appropriate cast?

> Getting support for the Microsoft 64-bit calling convention into 
> upstream gcc is the most important requirement for a 64-bit Wine.

That's a completely different problem, but we still should be able to build
a working 64-bit Wine without binary win64 support.

-- 
Dmitry.


From wine.dev at web.de  Sun Dec 16 08:23:05 2007
From: wine.dev at web.de (Detlef Riekenberg)
Date: Sun, 16 Dec 2007 15:23:05 +0100
Subject: New bugzilla components.
In-Reply-To: <037b01c83fa6$fd023340$a600fea9@DMITRY>
References: <47640A28.7080701@kievinfo.com>
	<004f01c83f9a$cae2e500$a600fea9@DMITRY>
	<22821af30712152034t1ee5318ai38eba71df919d38f@mail.gmail.com>
	<00e801c83f9e$835afca0$a600fea9@DMITRY><4764B178.2030501@kievinfo.com>
	<027801c83fa2$0548fb60$a600fea9@DMITRY> <4764B786.20206@kievinfo.com>
	<037b01c83fa6$fd023340$a600fea9@DMITRY>
Message-ID: <1197814985.7518.13.camel@p4>

On So, 2007-12-16 at 13:46 +0800, Dmitry Timoshkov wrote:
> "Vitaliy Margolen" <wine-devel at kievinfo.com> wrote:

> > Unless we want to list most of the 
> > subsystems in keywords, that span small parts of multiple dlls.
> 
> In the vast majority of cases a bug belongs to a particular DLL, not
> a group of DLLs, in very rare cases the keywords are supposed to help
> with identification of the component.

One of the needed keywords is printing.
I asked for a seperate component years ago, 
but only got "wine-gdi" renamed to "wine-gdi-(printing)".

Printing is also a part of gdi, but printing is much more than gdi.
(wineps.drv and winspool.drv are the big visible parts).



-- 
 
By by ... Detlef




From rob at codeweavers.com  Sun Dec 16 08:36:03 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Sun, 16 Dec 2007 14:36:03 +0000
Subject: Clear padding in the buffer due to alignment.
In-Reply-To: <00ce01c83fde$f80a8df0$a600fea9@DMITRY>
References: <4762DF71.70702@codeweavers.com><008401c83f9c$3ebef850$a600fea9@DMITRY>
	<47651518.4010403@codeweavers.com>
	<00ce01c83fde$f80a8df0$a600fea9@DMITRY>
Message-ID: <476537D3.4060402@codeweavers.com>

Dmitry Timoshkov wrote:
> "Robert Shearman" <rob at codeweavers.com> wrote:
>
>>> Is it possible to make it 64-bit and Wine/Windows compatible by using
>>> ULONG_PTR instead of long?
>>
>> At the moment, widl doesn't support generating 64-bit compatible 
>> client, server and proxy code so doing so would be useless. FWIW, 
>> MIDL outputs __int64 here instead of long when targeting 64-bit.
>
> If it doesn't take too much effort to write a 64-bit clean code, why 
> avoid
> that, especially all that's required is using an appropriate cast?

1. Both of these lines are correct using Unix compilers since long is 
64-bit when pointers are 64-bit:
    print_file(file, indent, "memset(_StubMsg.Buffer, 0, 
((long)_StubMsg.Buffer) & 0x%x);\n", alignment - 1);
    print_file(file, indent, "_StubMsg.Buffer = (unsigned char 
*)(((long)_StubMsg.Buffer + %u) & ~0x%x);\n",
                alignment - 1, alignment - 1);

2. It's independent of my patch (even if long is 32-bits, we're not 
going to have alignments above 4Gb).
3. Supporting 64-bit pointers in widl is a lot more complicated than 
just casting using the correct type (it involves making anything with 
embedded pointers into a complex type).

-- 
Rob Shearman



From dmitry at codeweavers.com  Sun Dec 16 10:20:57 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Mon, 17 Dec 2007 00:20:57 +0800
Subject: WineX11.drv: create X11 window for client area 1/3
References: <20071216160829.295120@gmx.net>
Message-ID: <01bd01c83fff$a5e97510$a600fea9@DMITRY>

"Roderick Colenbrander" <thunderbird2k at gmx.net> wrote:

> This patch creates an X11 window for the client area. The code is inspired
> by old x11drv of which even a few pieces got copied over. Further Chris
> Robinson assisted with positioning issues.
> 
> After this patch most remnants of bug 2398 should be fixed, so both Direct3D
> and OpenGL apps should work fine in windowed mode (except for programs which
> use their own window rendering code).

Did you run the dlls/user32/tests with your patches applied?

-- 
Dmitry.


From jacek at codeweavers.com  Sun Dec 16 11:59:49 2007
From: jacek at codeweavers.com (Jacek Caban)
Date: Sun, 16 Dec 2007 18:59:49 +0100
Subject: New bugzilla components.
In-Reply-To: <4765148A.204@codeweavers.com>
References: <47640A28.7080701@kievinfo.com>	<004f01c83f9a$cae2e500$a600fea9@DMITRY>	<22821af30712152034t1ee5318ai38eba71df919d38f@mail.gmail.com>	<00e801c83f9e$835afca0$a600fea9@DMITRY>
	<4765148A.204@codeweavers.com>
Message-ID: <47656795.9070908@codeweavers.com>

Robert Shearman wrote:
> (For example, consult Jacek before creating separate mshtml, shdocvw and urlmon components.)
>   

We currently have wine-shdocvw and wine-urlmon. That's fine for me and I
don't think we want to split shdocvw to mshtml and shdocvw. Although the
current name may be confusing (I don't really care about the name), it's
often not obvious which of these DLLs has caused the bug (it will be
even worse when we will move part of shdocvw.dll to ieframe.dll, as IE7
did).

Jacek


From hverbeet at gmail.com  Sun Dec 16 12:48:09 2007
From: hverbeet at gmail.com (H. Verbeet)
Date: Sun, 16 Dec 2007 19:48:09 +0100
Subject: [2/5] wined3d: fix broken link in comment
In-Reply-To: <4765F359.20405@inbox.lv>
References: <4765F359.20405@inbox.lv>
Message-ID: <d658b69e0712161048u6da9cc84g407be4a23b8a6143@mail.gmail.com>

On 17/12/2007, Alexander Dorofeyev <alexd4 at inbox.lv> wrote:
> ---
>    dlls/wined3d/device.c |    2 +-
>    1 files changed, 1 insertions(+), 1 deletions(-)
>
MSDN URLs should generally just be removed. They change too often to
be of any use anyway.


From stefan at codeweavers.com  Sun Dec 16 12:51:16 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sun, 16 Dec 2007 19:51:16 +0100
Subject: [2/5] wined3d: fix broken link in comment
In-Reply-To: <4765F359.20405@inbox.lv>
References: <4765F359.20405@inbox.lv>
Message-ID: <200712161951.16536.stefan@codeweavers.com>

Am Montag, 17. Dezember 2007 04:56:09 schrieb Alexander Dorofeyev:
> ---
>    dlls/wined3d/device.c |    2 +-
>    1 files changed, 1 insertions(+), 1 deletions(-)
I actually removed a bunch of links like that some time ago, I think we can 
just remove that as well. The source isn't a link collection, and keeping the 
links up to date would need constant monitoring of the msdn.


From thunderbird2k at gmx.net  Sun Dec 16 14:01:23 2007
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Sun, 16 Dec 2007 21:01:23 +0100
Subject: WineX11.drv: create X11 window for client area 1/3
In-Reply-To: <01bd01c83fff$a5e97510$a600fea9@DMITRY>
References: <20071216160829.295120@gmx.net>
	<01bd01c83fff$a5e97510$a600fea9@DMITRY>
Message-ID: <20071216200123.157040@gmx.net>

> "Roderick Colenbrander" <thunderbird2k at gmx.net> wrote:
> 
> > This patch creates an X11 window for the client area. The code is
> inspired
> > by old x11drv of which even a few pieces got copied over. Further Chris
> > Robinson assisted with positioning issues.
> > 
> > After this patch most remnants of bug 2398 should be fixed, so both
> Direct3D
> > and OpenGL apps should work fine in windowed mode (except for programs
> which
> > use their own window rendering code).
> 
> Did you run the dlls/user32/tests with your patches applied?
> 
> -- 
> Dmitry.

I have tested with a large number of apps but didn't know about this test. I just ran it and all tests run as before except for the 'msg' test but even without the patch it already returns different results each time, so I'm not sure what to think about it.

Below I have attached some of the results.

Roderick

A log without the patch
fixme:nonclient:NC_HandleSysCommand unimplemented WM_SYSCOMMAND f050!
fixme:nonclient:NC_HandleSysCommand unimplemented WM_SYSCOMMAND f040!
fixme:nonclient:NC_HandleSysCommand unimplemented WM_SYSCOMMAND f040!
fixme:nonclient:NC_HandleSysCommand unimplemented WM_SYSCOMMAND f050!
msg.c:9307: Test failed: 46: ShowWindow(SW_RESTORE): in msg 0x0047 expecting wParam 0x8120 got 0x8122
msg.c:9307: Test failed: 48: ShowWindow(SW_SHOWMAXIMIZED): the msg 0x0047 was expected, but got msg 0x0005 instead
msg.c:9307: Test failed: 48: ShowWindow(SW_SHOWMAXIMIZED): the msg 0x0003 was expected, but got msg 0x0009 instead
msg.c:9307: Test failed: 48: ShowWindow(SW_SHOWMAXIMIZED): the msg 0x0005 was expected, but got msg 0x0047 instead
msg.c:9307: Test failed: 48: ShowWindow(SW_SHOWMAXIMIZED): the msg sequence is not complete: expected 0000 - actual 0003
msg.c:9307: Test failed: 50: ShowWindow(SW_SHOWNORMAL): in msg 0x0047 expecting wParam 0x8020 got 0x8821
msg.c:7573: Test failed: ScrollWindowEx: the msg sequence is not complete: expected 0000 - actual 0014
msg.c:4034: Test failed: SetWindowPos:WmSWP_ResizeNoZOrder: the msg 0x0047 was expected, but got msg 0x0005 instead
msg.c:4034: Test failed: SetWindowPos:WmSWP_ResizeNoZOrder: the msg 0x0005 was expected, but got msg 0x030f instead
msg.c:4034: Test failed: SetWindowPos:WmSWP_ResizeNoZOrder: the msg sequence is not complete: expected 0000 - actual 001c
fixme:msg:pack_message msg 14 (WM_ERASEBKGND) not supported yet
fixme:msg:pack_message msg 14 (WM_ERASEBKGND) not supported yet
msg.c:5117: Test failed: WmEmptySeq: the msg sequence is not complete: expected 0000 - actual 0021
msg.c:5125: Test failed: WmEmptySeq: the msg sequence is not complete: expected 0000 - actual 000f
msg.c:5273: Test failed: WmParentPaintNc: the msg sequence is not complete: expected 0000 - actual 0021
msg.c:8881: Test failed: WmMouseHoverSeq: the msg 0x0118 was expected, but got msg 0x0046 instead
msg.c:8881: Test failed: WmMouseHoverSeq: the msg 0x02a1 was expected, but got msg 0x0047 instead
msg.c:8881: Test failed: WmMouseHoverSeq: the msg sequence is not complete: expected 0000 - actual 0003
msg.c:9590: Tests skipped: Skipping DBCS WM_CHAR test in SBCS codepage 'ANSI Latin 1'
msg.c:10115: Tests skipped: UnhookWinEvent is not available
make: *** [msg.ok] Error 16


Run with the patch
../../../tools/runtest -q -P wine -M user32.dll -T ../../.. -p user32_test.exe.so msg.c && touch msg.ok
fixme:nonclient:NC_HandleSysCommand unimplemented WM_SYSCOMMAND f050!
fixme:nonclient:NC_HandleSysCommand unimplemented WM_SYSCOMMAND f040!
fixme:nonclient:NC_HandleSysCommand unimplemented WM_SYSCOMMAND f040!
fixme:nonclient:NC_HandleSysCommand unimplemented WM_SYSCOMMAND f050!
msg.c:9307: Test failed: 48: ShowWindow(SW_SHOWMAXIMIZED): in msg 0x0046 expecting wParam 0x8020 got 0x8120
msg.c:9307: Test failed: 48: ShowWindow(SW_SHOWMAXIMIZED): the msg 0x0047 was expected, but got msg 0x0005 instead
msg.c:9307: Test failed: 48: ShowWindow(SW_SHOWMAXIMIZED): the msg 0x0003 was expected, but got msg 0x0009 instead
msg.c:9307: Test failed: 48: ShowWindow(SW_SHOWMAXIMIZED): the msg 0x0005 was expected, but got msg 0x0047 instead
msg.c:9307: Test failed: 48: ShowWindow(SW_SHOWMAXIMIZED): the msg sequence is not complete: expected 0000 - actual 0003
msg.c:9307: Test failed: 52: ShowWindow(SW_HIDE): in msg 0x0046 expecting wParam 0x83 got 0x93
msg.c:9307: Test failed: 52: ShowWindow(SW_HIDE): in msg 0x0047 expecting wParam 0x1883 got 0x1893
msg.c:9307: Test failed: 56: ShowWindow(SW_SHOWNOACTIVATE): in msg 0x0047 expecting wParam 0x8170 got 0x8172
msg.c:7573: Test failed: ScrollWindowEx: the msg sequence is not complete: expected 0000 - actual 0014
msg.c:4034: Test failed: SetWindowPos:WmSWP_ResizeNoZOrder: the msg 0x0047 was expected, but got msg 0x0005 instead
msg.c:4034: Test failed: SetWindowPos:WmSWP_ResizeNoZOrder: the msg 0x0005 was expected, but got msg 0x030f instead
msg.c:4034: Test failed: SetWindowPos:WmSWP_ResizeNoZOrder: the msg sequence is not complete: expected 0000 - actual 001c
msg.c:4251: Test failed: DrawMenuBar: the msg sequence is not complete: expected 0000 - actual 000f
fixme:msg:pack_message msg 14 (WM_ERASEBKGND) not supported yet
msg.c:5094: Test failed: Paint: the msg sequence is not complete: expected 0000 - actual 0014
fixme:msg:pack_message msg 14 (WM_ERASEBKGND) not supported yet
msg.c:5273: Test failed: WmParentPaintNc: the msg sequence is not complete: expected 0000 - actual 0021
msg.c:9590: Tests skipped: Skipping DBCS WM_CHAR test in SBCS codepage 'ANSI Latin 1'
msg.c:10115: Tests skipped: UnhookWinEvent is not available
make: *** [msg.ok] Error 15

And another run with the patch
../../../tools/runtest -q -P wine -M user32.dll -T ../../.. -p user32_test.exe.so msg.c && touch msg.ok
fixme:nonclient:NC_HandleSysCommand unimplemented WM_SYSCOMMAND f050!
fixme:nonclient:NC_HandleSysCommand unimplemented WM_SYSCOMMAND f040!
fixme:nonclient:NC_HandleSysCommand unimplemented WM_SYSCOMMAND f040!
fixme:nonclient:NC_HandleSysCommand unimplemented WM_SYSCOMMAND f050!
msg.c:9307: Test failed: 46: ShowWindow(SW_RESTORE): in msg 0x0047 expecting wParam 0x8120 got 0x8122
msg.c:9307: Test failed: 48: ShowWindow(SW_SHOWMAXIMIZED): the msg 0x0047 was expected, but got msg 0x0005 instead
msg.c:9307: Test failed: 48: ShowWindow(SW_SHOWMAXIMIZED): the msg 0x0003 was expected, but got msg 0x0009 instead
msg.c:9307: Test failed: 48: ShowWindow(SW_SHOWMAXIMIZED): the msg 0x0005 was expected, but got msg 0x0047 instead
msg.c:9307: Test failed: 48: ShowWindow(SW_SHOWMAXIMIZED): the msg sequence is not complete: expected 0000 - actual 0003
msg.c:9307: Test failed: 50: ShowWindow(SW_SHOWNORMAL): in msg 0x0047 expecting wParam 0x8020 got 0x8821
msg.c:7562: Test failed: ScrollWindowEx: the msg 0x000f was expected, but got msg 0x0021 instead
msg.c:7562: Test failed: ScrollWindowEx: the msg 0x0014 was expected, but got msg 0x000f instead
msg.c:7562: Test failed: ScrollWindowEx: the msg sequence is not complete: expected 0000 - actual 0014
fixme:msg:pack_message msg 14 (WM_ERASEBKGND) not supported yet
msg.c:5094: Test failed: Paint: the msg sequence is not complete: expected 0000 - actual 000f
fixme:msg:pack_message msg 14 (WM_ERASEBKGND) not supported yet
msg.c:5273: Test failed: WmParentPaintNc: the msg sequence is not complete: expected 0000 - actual 0021
msg.c:8881: Test failed: WmMouseHoverSeq: the msg 0x0118 was expected, but got msg 0x0046 instead
msg.c:8881: Test failed: WmMouseHoverSeq: the msg 0x02a1 was expected, but got msg 0x0047 instead
msg.c:8881: Test failed: WmMouseHoverSeq: the msg sequence is not complete: expected 0000 - actual 0003
msg.c:9590: Tests skipped: Skipping DBCS WM_CHAR test in SBCS codepage 'ANSI Latin 1'
msg.c:10115: Tests skipped: UnhookWinEvent is not available
make: *** [msg.ok] Error 14
-- 
Der GMX SmartSurfer hilft bis zu 70% Ihrer Onlinekosten zu sparen! 
Ideal f?r Modem und ISDN: http://www.gmx.net/de/go/smartsurfer


From truiken at gmail.com  Sun Dec 16 14:14:16 2007
From: truiken at gmail.com (James Hawkins)
Date: Sun, 16 Dec 2007 14:14:16 -0600
Subject: New bugzilla components.
In-Reply-To: <20071216122026.GA3426@crissy.swd.zerebecki.de>
References: <47640A28.7080701@kievinfo.com>
	<004f01c83f9a$cae2e500$a600fea9@DMITRY>
	<4764A948.9050205@kievinfo.com>
	<20071216122026.GA3426@crissy.swd.zerebecki.de>
Message-ID: <22821af30712161214k420168c5te62f6fc5ed56ba87@mail.gmail.com>

On Dec 16, 2007 6:20 AM, Jan Zerebecki <jan.wine at zerebecki.de> wrote:
>
> For me with this renaming is important that at least from the
> description it should then be absolutely clear what goes into a
> component and what not (for a developer).
>
>
> On Sat, Dec 15, 2007 at 09:27:52PM -0700, Vitaliy Margolen wrote:
> > > What's happened to the proposal to remove the wine- prefix from
> > > bugzilla components and have the components represent the dlls
> > > they belong to?
>
> I didn't want to remove the wine- prefix without also getting
> most of the other wanted changes done in the same go. But those
> require that someone gets a list of the exact changes posted and
> agreed upon on. I didn't have time for that yet... but if none of
> the other admins get it done I can probably find the time to make
> the changes in such a list.
>
> I think such a list would need: old name (empty for new
> components); new name; description (should list other names that are associated with the
> component or things contained in the component, list of source
> files that this component contains with bash style globs).
>
> We can also change the default assignee (currently
> wine-bugs at winehq.org for all components) and/or default cc list
> (AFAIK currently empty for all components).
>
> Possibly bad example:
> wine-directx-dshow; directx-dshow; DirectShow ( dlls/{quartz,msdmo,qcap}/ );
>     dshow-hacker at test.test; dshowhacker2 at test.test, dhowhacker3 at test.text;
>
> If we want to move all the bugs from one component to other
> components we can delete the component after it doesn't contain
> any bugs anymore:
>
> wine-foo; deprecated-foo; Bugs in this component should be moved to bar or misc.
>
> > This would be really nice, however not sure how much work will it take.
> > Don't think bugzilla supports renaming of the components. Might need some
> > custom converter.
>
> Bugzilla supports renaming components.
>

Ok, I'll start off the list.  This is a first draft, open to changes
and discussion.  Entries with a (?) means I'm not sure.

Components:

test ->
wine-advapi32 -> advapi32
wine-atl -> atl
wine-binary ->
wine-comctl32 -> comctl32
wine-console -> console (?)
wine-crypt32 -> crypt32
wine-dbghelp -> dbghelp
wine-debug ->
wine-directx* -> directx* (?)
wine-documentation -> documentation
wine-dos -> dos
wine-dotnet -> (?) I have a feeling this should be a keyword
wine-files ->
wine-gdi-(printing) -> wine-gdi32
wine-gdiplus -> gdiplus
wine-gui ->
wine-help -> hhctrl. the remaining wine-help bugs should be user32 if
they're not hhctrl.
wine-ipc ->
wine-kernel -> kernel32
wine-loader ->loader
wine-misc -> misc or default
wine-msi -> msi
wine-msvcrt -> msvcrt
wine-msxml -> msxml(3)
wine-multimedia ->
wine-net ->
wine-ole -> ole
wine-opengl -> opengl keyword (?)
wine-patches ->
wine-ports ->
wine-programs -> programs (might want to keep it wine-programs to not
confuse users)
wine-quartz -> quartz
Wine-Rebar -> bugs moved to comctl32
wine-resources ->
wine-richedit -> richedit
wine-setupapi -> setupapi
wine-shdocvw -> shdocvw
wine-shell32 -> shell32
wine-sspi -> (?) I prefer individual modules with a security or sspi
keyword, but it's not up to me
wine-tools -> (?)
wine-urlmon -> urlmon
wine-user -> user32
wine-usp10.dll -> usp10
wine-winelib ->
wine-x11driver -> x11driver
-> wininet
-> wintrust
-> secur32
-> advpack
-> hhctrl
-> imagehlp
-> shlwapi


-- 
James Hawkins


From kai.blin at gmail.com  Sun Dec 16 15:37:46 2007
From: kai.blin at gmail.com (Kai Blin)
Date: Sun, 16 Dec 2007 22:37:46 +0100
Subject: New bugzilla components.
In-Reply-To: <22821af30712161214k420168c5te62f6fc5ed56ba87@mail.gmail.com>
References: <47640A28.7080701@kievinfo.com>
	<20071216122026.GA3426@crissy.swd.zerebecki.de>
	<22821af30712161214k420168c5te62f6fc5ed56ba87@mail.gmail.com>
Message-ID: <200712162237.53992.kai.blin@gmail.com>

On Sunday 16 December 2007 21:14:16 James Hawkins wrote:

> Ok, I'll start off the list.  This is a first draft, open to changes
> and discussion.  Entries with a (?) means I'm not sure.
>
> Components:
[...]
> wine-net ->
If you delete that one, we definitely need a "winsock" component. Or ws2_32... 
or wsock.. I prefer "winsock" as that matches the debug channel as well.

[...]
> wine-sspi -> (?) I prefer individual modules with a security or sspi
> keyword, but it's not up to me
[...]
> -> secur32

Coming to think about that, if we're fine to add more categories for things 
like secur32.dll, how about splitting up those by debug channel? E.g. my ntlm 
provider has an "ntlm" debug channel, the kerberos provider that I keep 
starting and restarting in some branches on my box always uses "kerberos", 
and Juan might want to use schannel as debug channel.

That would also help advanced users to correctly file bugs according to 
fixmes, e.g. if they run into an unimplemented function.

Cheers,
Kai

-- 
Kai Blin
WorldForge developer  http://www.worldforge.org/
Wine developer        http://wiki.winehq.org/KaiBlin
Samba team member     http://www.samba.org/samba/team/
--
Will code for cotton.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071216/345eab61/attachment.pgp 

From alexd4 at inbox.lv  Mon Dec 17 01:38:47 2007
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Sun, 16 Dec 2007 23:38:47 -0800
Subject: ENTER_GL and ActivateContext question
In-Reply-To: <200712151806.46852.stefan@codeweavers.com>
References: <475D79E5.4010706@inbox.lv>
	<200712132200.15008.stefan@codeweavers.com>
	<4763B848.1010306@inbox.lv>
	<200712151806.46852.stefan@codeweavers.com>
Message-ID: <47662787.4060302@inbox.lv>

Hi.

Stefan D?singer wrote:
> Am Samstag, 15. Dezember 2007 12:19:36 schrieb Alexander Dorofeyev:
>> This seems to be specific to front buffer. Maybe
>> glFlush really should be called in BltOverride (or clearing subroutine) if
>> the target is front buffer?
> Yes, glFlush() has to be called when writing to the front buffer. SwapBuffers 
> does an implicit flush, so for the back buffer you don't have to do anything, 
> but the front buffer needs a glFlush(). It isn't there yet, so it should be 
> added.

OK, I'll work on that. There seem to be more places with this issue, at least
UnlockRect appears to need it, it helps problems in one ddraw game I tested (Red
Alert 2). BTW, if no swapchain exists for a render target and iface ==
device->render_targets[0], it's a front buffer, right?

> The fbo activation you moved is a different problem. It needs to be fixed as 
> well, but it is not as easy as swapping the calls :-( . Essentially, 
> ActivateContext has to be called before the fbo setup, due to multithreading 
> concerns. On the other hand, some things ActivateContext does fail if an fbo 
> is active, so fbos must be set before activatecontext. Essentially we'll have 
> to move fbo setup into ActivateContext, but this has some implications on 
> multiple render targets and depth stencil swapping which need more 
> investigation. OpenGL driver limitations play a role here as well.

Just to be sure, by fbo activation you mean LoadLocation(..., SFLAG_INDRAWABLE,
...) or apply_fbo_state? I think I only moved the former relative to
ActivateContext. At the moment I backtracked on that change anyway. Actually I
guess I was wrong that LoadLocation before ActivateContext may be a problem,
because in SFLAG_INDRAWABLE case LoadLocation seems to call either
surface_blt_to_drawable or flush_to_framebuffer_drawpixels both of which do
ActivateContext. GL calls are in other codepaths that won't be entered,
unfortunately I didn't notice it previous time. At least that's so at the moment.



From truiken at gmail.com  Sun Dec 16 15:47:23 2007
From: truiken at gmail.com (James Hawkins)
Date: Sun, 16 Dec 2007 15:47:23 -0600
Subject: New bugzilla components.
In-Reply-To: <200712162237.53992.kai.blin@gmail.com>
References: <47640A28.7080701@kievinfo.com>
	<20071216122026.GA3426@crissy.swd.zerebecki.de>
	<22821af30712161214k420168c5te62f6fc5ed56ba87@mail.gmail.com>
	<200712162237.53992.kai.blin@gmail.com>
Message-ID: <22821af30712161347u3236fb2en4269dd97b7068593@mail.gmail.com>

On Dec 16, 2007 3:37 PM, Kai Blin <kai.blin at gmail.com> wrote:
> On Sunday 16 December 2007 21:14:16 James Hawkins wrote:
>
> > Ok, I'll start off the list.  This is a first draft, open to changes
> > and discussion.  Entries with a (?) means I'm not sure.
> >
> > Components:
> [...]
> > wine-net ->
> If you delete that one, we definitely need a "winsock" component. Or ws2_32...
> or wsock.. I prefer "winsock" as that matches the debug channel as well.
>

ws2_32 or wsock32, or both, depending on the existing bugs.

> [...]
> > wine-sspi -> (?) I prefer individual modules with a security or sspi
> > keyword, but it's not up to me
> [...]
> > -> secur32
>
> Coming to think about that, if we're fine to add more categories for things
> like secur32.dll, how about splitting up those by debug channel? E.g. my ntlm
> provider has an "ntlm" debug channel, the kerberos provider that I keep
> starting and restarting in some branches on my box always uses "kerberos",
> and Juan might want to use schannel as debug channel.
>
> That would also help advanced users to correctly file bugs according to
> fixmes, e.g. if they run into an unimplemented function.
>
>

I have to voice my disagreement on this one.  per-debug channel is too
fine-grained, and that's a road we don't want to go down.  Think of it
like this: the components are not meant to help the users in any way,
only the developers.  As a developer, will the different provider
components (ntlm, kerberos, et.al.) help you any?  You'll have to read
the logs anyway.  schannel, on the other hand, is a module in the wine
tree, so that would be a useful component.

-- 
James Hawkins


From kai.blin at gmail.com  Sun Dec 16 16:08:53 2007
From: kai.blin at gmail.com (Kai Blin)
Date: Sun, 16 Dec 2007 23:08:53 +0100
Subject: New bugzilla components.
In-Reply-To: <22821af30712161347u3236fb2en4269dd97b7068593@mail.gmail.com>
References: <47640A28.7080701@kievinfo.com>
	<200712162237.53992.kai.blin@gmail.com>
	<22821af30712161347u3236fb2en4269dd97b7068593@mail.gmail.com>
Message-ID: <200712162308.56983.kai.blin@gmail.com>

On Sunday 16 December 2007 22:47:23 James Hawkins wrote:

> ws2_32 or wsock32, or both, depending on the existing bugs.

Given that wsock32 forwards over 90% of the calls to ws2_32, let's go for that 
one then.

> > Coming to think about that, if we're fine to add more categories for
> > things like secur32.dll, how about splitting up those by debug channel?
> > E.g. my ntlm provider has an "ntlm" debug channel, the kerberos provider
> > that I keep starting and restarting in some branches on my box always
> > uses "kerberos", and Juan might want to use schannel as debug channel.
>
> I have to voice my disagreement on this one.  per-debug channel is too
> fine-grained, and that's a road we don't want to go down.  Think of it
> like this: the components are not meant to help the users in any way,
> only the developers. 

But I as a part-time developer can't keep track of all the areas in Wine. I 
don't know anything about.. say GUI.. or actually anything that's not secur32 
or maybe winsock. Where's the advantage of me refiling a bug someone filed 
as.. say "ws2_32" to "default" again because I don't know what gui component 
is responsible as opposed to me refiling it as wine-gui (see bug 9771 as a 
specific example that just came up).

> As a developer, will the different provider 
> components (ntlm, kerberos, et.al.) help you any?  You'll have to read 
> the logs anyway.

Well, maybe. Once schannel is implemented, I probably won't look at those 
because I don't know about schannel. I don't get your point about having to 
read logs, because I think that is needed for all but the most obviously 
invalid bugs.

> schannel, on the other hand, is a module in the wine 
> tree, so that would be a useful component.

Nope. It forwards to secur32.dll, apart from two calls. I'm kind of certain 
we're just arguing about what color the bikeshed should be painted in, but 
either we just lump all sspi errors into one category, or we have one per 
logical module.

So I guess the real question is how much diversity we want and need.

Cheers,
Kai

-- 
Kai Blin
WorldForge developer  http://www.worldforge.org/
Wine developer        http://wiki.winehq.org/KaiBlin
Samba team member     http://www.samba.org/samba/team/
--
Will code for cotton.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071216/040a6cc0/attachment-0001.pgp 

From truiken at gmail.com  Sun Dec 16 16:19:39 2007
From: truiken at gmail.com (James Hawkins)
Date: Sun, 16 Dec 2007 16:19:39 -0600
Subject: New bugzilla components.
In-Reply-To: <200712162308.56983.kai.blin@gmail.com>
References: <47640A28.7080701@kievinfo.com>
	<200712162237.53992.kai.blin@gmail.com>
	<22821af30712161347u3236fb2en4269dd97b7068593@mail.gmail.com>
	<200712162308.56983.kai.blin@gmail.com>
Message-ID: <22821af30712161419y6285acb6y253ec00abbc01e80@mail.gmail.com>

On Dec 16, 2007 4:08 PM, Kai Blin <kai.blin at gmail.com> wrote:
> On Sunday 16 December 2007 22:47:23 James Hawkins wrote:
>
> > ws2_32 or wsock32, or both, depending on the existing bugs.
>
> Given that wsock32 forwards over 90% of the calls to ws2_32, let's go for that
> one then.
>
> > > Coming to think about that, if we're fine to add more categories for
> > > things like secur32.dll, how about splitting up those by debug channel?
> > > E.g. my ntlm provider has an "ntlm" debug channel, the kerberos provider
> > > that I keep starting and restarting in some branches on my box always
> > > uses "kerberos", and Juan might want to use schannel as debug channel.
> >
> > I have to voice my disagreement on this one.  per-debug channel is too
> > fine-grained, and that's a road we don't want to go down.  Think of it
> > like this: the components are not meant to help the users in any way,
> > only the developers.
>
> But I as a part-time developer can't keep track of all the areas in Wine. I
> don't know anything about.. say GUI.. or actually anything that's not secur32
> or maybe winsock. Where's the advantage of me refiling a bug someone filed
> as.. say "ws2_32" to "default" again because I don't know what gui component
> is responsible as opposed to me refiling it as wine-gui (see bug 9771 as a
> specific example that just came up).
>

You refile it as misc/default so another developer who is more
familiar with the correct component can set the right component.
We're getting rid of wine-gui because wine-gui doesn't mean
anything...the bug description alone is enough to know that it's a gui
bug.

> > As a developer, will the different provider
> > components (ntlm, kerberos, et.al.) help you any?  You'll have to read
> > the logs anyway.
>
> Well, maybe. Once schannel is implemented, I probably won't look at those
> because I don't know about schannel. I don't get your point about having to
> read logs, because I think that is needed for all but the most obviously
> invalid bugs.
>

You said an advanced user could read the logs and set the provider
component based on the fixme's in the logs, and I'm saying that you'll
have to read the logs anyway, so the one advantage of that method is
taken away.

> > schannel, on the other hand, is a module in the wine
> > tree, so that would be a useful component.
>
> Nope. It forwards to secur32.dll, apart from two calls. I'm kind of certain
> we're just arguing about what color the bikeshed should be painted in, but
> either we just lump all sspi errors into one category, or we have one per
> logical module.
>

I have no idea about secur32, schannel, etc.  If schannel just
forwards to secur32, then there's no need for an schannel component,
and any bugs of that nature should be marked as secur32.  That still
doesn't mean we need an sspi component.

> So I guess the real question is how much diversity we want and need.
>

If most of the functionality is in secur32, where's the need for sspi,
and if there's more functionality in other modules besides secur32,
then there should be a component for each module that has a reported
bug.  Like I said before, I don't mind an sspi keyword.

-- 
James Hawkins


From jjmckenzie51 at sprintpcs.com  Sun Dec 16 19:39:33 2007
From: jjmckenzie51 at sprintpcs.com (James McKenzie)
Date: Sun, 16 Dec 2007 18:39:33 -0700
Subject: [Wine] Problems with the console functions?
In-Reply-To: <200712151013.lBFADF2d049671@sirppi.helsinki.fi>
References: <200712151013.lBFADF2d049671@sirppi.helsinki.fi>
Message-ID: <4765D355.7070005@sprintpcs.com>

Reijo T Sund wrote:
> Dear Wine-experts,
>
> I've tested the functionality of simple CUI-applications with
> wineconsole (Wine-0.9.50, Ubuntu 7.10). Somewhat surprisingly,
> there seems to be numerous major flaws in the current
> implementation.
>
> The best (worst?) example is the widely distributed sample code
> ("Console: Demonstration of the Console Functions") available in
> the MSDN library (http://msdn2.microsoft.com/en-us/library/aa263818.aspx).
>
> With this code it is easy to replicate the "missing output" bug 
> (http://bugs.winehq.org/show_bug.cgi?id=10404) and demonstrate several
> other previously unreported bugs and crashes. In fact, these problems
> seem to prevent the sound running of virtually all CUI-applications
> utilizing console functions.
>   
Please add your results to this bug and vote on it.
> Should there be one big bug report for this sample console application
> or a separate report for each defect?
>   
One bug/defect -> One report.  Attach logs/output.  And please do a
through search of
Bugzilla before reporting. 
> I also wonder if someone else could test whether these potential
> problems are real, and confirm that no simple solutions are available..
>   
Please add as much information to reproduce in the bug reports.  If they
require downloading
large packages, please be aware that some are bandwidth restricted. 

> The actual sources are available in the full PSDK sample package 
> downloadable from: 
> http://download.microsoft.com/download/vstudio60pro/Utility/6.0/W98NT42KMeXP/EN-US/vs6samples.exe.
>
> As that is a quite large file (131Mb), the example of interest extracted
> from the package is temporarily available at 
> http://www.helsinki.fi/~sund/sdk_WinUI_console.exe,
> or in a zipped form at http://www.helsinki.fi/~sund/console_vs6.zip.
> An older (vs97) version of the same SDK sample that includes a compiled
> binary can be found at http://www.helsinki.fi/~sund/console_vs97.zip.
>   
Please put these links in the bug reports.  Not many are going to
download possibly damaging code
from your site, however.  The sources maybe all that are needed.

James McKenzie



From jjmckenzie51 at sprintpcs.com  Sun Dec 16 19:41:50 2007
From: jjmckenzie51 at sprintpcs.com (James McKenzie)
Date: Sun, 16 Dec 2007 18:41:50 -0700
Subject: [Wine] crash running Myst
In-Reply-To: <Pine.GSO.4.55.0712152349310.11788@helios.cs.csubak.edu>
References: <Pine.GSO.4.55.0712152349310.11788@helios.cs.csubak.edu>
Message-ID: <4765D3DE.8060304@sprintpcs.com>

David Griffith wrote:
> I'm trying to run Myst (masterpiece edition).  By upgrading Wine to .51,
> I've gotten the install to finish without complaint.  When I attempt to
> run Myst, the following is written to the terminal:
>
> $ wine Myst.exe
> fixme:mixer:ALSA_MixerInit No master control found on MPU-401 UART,
> disabling mixer
> wine: Unhandled page fault on write access to 0x00150000 at address
> 0xb7d75cbc (thread 0009), starting debugger...
> First chance exception: page fault on write access to 0x00150000 in 32-bit
> code (0xb7d75cbc).
>
> After that comes a register dump, stack dump, and 28 lines of backtrace.
> Where do I go from here?
>
>
>   
File a bug report AFTER searching for problems with Myst.  If you find
an existing problem, add
your information and the bug logs, zipped if they are large >.5 MB.  If
you can, vote on an existing problem.

James McKenzie



From jjmckenzie51 at sprintpcs.com  Sun Dec 16 19:53:11 2007
From: jjmckenzie51 at sprintpcs.com (James McKenzie)
Date: Sun, 16 Dec 2007 18:53:11 -0700
Subject: [Fwd: Re: New bugzilla components.]
Message-ID: <4765D687.6080506@sprintpcs.com>



-------- Original Message --------
Subject: 	Re: New bugzilla components.
Date: 	Sun, 16 Dec 2007 18:52:40 -0700
From: 	James McKenzie <jjmckenzie51 at sprintpcs.com>
To: 	Dmitry Timoshkov <dmitry at codeweavers.com>
References: 	<47640A28.7080701 at kievinfo.com>
<004f01c83f9a$cae2e500$a600fea9 at DMITRY>
<22821af30712152034t1ee5318ai38eba71df919d38f at mail.gmail.com>
<200712160933.09187.kai.blin at gmail.com>
<001101c83fcc$2b6cd490$a600fea9 at DMITRY>



Dmitry Timoshkov wrote:
>
> Users are not supposed to set a category the bug belongs to, this requires
> an investigation and knowledge of a developer. Personally I'd prefer to have
> "default" in the list instead of "wine-misc".
>
>   
Better choice:  Unknown or intial report.  This will allow a user to
file a bug without having to get technical.
This also allows bug triage and for the appropriate developer or
development team to be notified of a new
bug.

As to listing each and every dll, that would be a mess.  Keep it to
components and parts and use keywords if necessary
to identify offending dlls.

James McKenzie





From truiken at gmail.com  Sun Dec 16 20:00:53 2007
From: truiken at gmail.com (James Hawkins)
Date: Sun, 16 Dec 2007 20:00:53 -0600
Subject: [Fwd: Re: New bugzilla components.]
In-Reply-To: <4765D687.6080506@sprintpcs.com>
References: <4765D687.6080506@sprintpcs.com>
Message-ID: <22821af30712161800y4b94f876wa12fb49296ad16cd@mail.gmail.com>

On Dec 16, 2007 7:53 PM, James McKenzie <jjmckenzie51 at sprintpcs.com> wrote:
>
>
> -------- Original Message --------
> Subject:        Re: New bugzilla components.
> Date:   Sun, 16 Dec 2007 18:52:40 -0700
> From:   James McKenzie <jjmckenzie51 at sprintpcs.com>
> To:     Dmitry Timoshkov <dmitry at codeweavers.com>
> References:     <47640A28.7080701 at kievinfo.com>
> <004f01c83f9a$cae2e500$a600fea9 at DMITRY>
> <22821af30712152034t1ee5318ai38eba71df919d38f at mail.gmail.com>
> <200712160933.09187.kai.blin at gmail.com>
> <001101c83fcc$2b6cd490$a600fea9 at DMITRY>
>
>
>
> Dmitry Timoshkov wrote:
> >
> > Users are not supposed to set a category the bug belongs to, this requires
> > an investigation and knowledge of a developer. Personally I'd prefer to have
> > "default" in the list instead of "wine-misc".
> >
> >
> Better choice:  Unknown or intial report.  This will allow a user to
> file a bug without having to get technical.
> This also allows bug triage and for the appropriate developer or
> development team to be notified of a new
> bug.
>

What?  I assume you're talking about adding a new landing page like a
simplified initial bug report.  That has nothing to do with the
current discussion, so please bring that up out of this thread if you
really want that.  Also, we already are notified of new bug reports
through wine-bugs.

> As to listing each and every dll, that would be a mess.  Keep it to
> components and parts and use keywords if necessary
> to identify offending dlls.
>

huh?  No one said to list each and every dll.  I have a feeling you
don't quite understand the issue...

-- 
James Hawkins


From wine-devel at kievinfo.com  Sun Dec 16 21:21:18 2007
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sun, 16 Dec 2007 20:21:18 -0700
Subject: [Wine] crash running Myst
In-Reply-To: <4765D3DE.8060304@sprintpcs.com>
References: <Pine.GSO.4.55.0712152349310.11788@helios.cs.csubak.edu>
	<4765D3DE.8060304@sprintpcs.com>
Message-ID: <4765EB2E.3040103@kievinfo.com>

James, check your reply settings. You have done this several times - do not 
bring wine-user discussions to wine-devel mailing list.

Vitaliy.

James McKenzie wrote:
> David Griffith wrote:
>> I'm trying to run Myst (masterpiece edition).  By upgrading Wine to .51,
>> I've gotten the install to finish without complaint.  When I attempt to
>> run Myst, the following is written to the terminal:
>>
>> $ wine Myst.exe
>> fixme:mixer:ALSA_MixerInit No master control found on MPU-401 UART,
>> disabling mixer
>> wine: Unhandled page fault on write access to 0x00150000 at address
>> 0xb7d75cbc (thread 0009), starting debugger...
>> First chance exception: page fault on write access to 0x00150000 in 32-bit
>> code (0xb7d75cbc).
>>
>> After that comes a register dump, stack dump, and 28 lines of backtrace.
>> Where do I go from here?
>>
>>
>>   
> File a bug report AFTER searching for problems with Myst.  If you find
> an existing problem, add
> your information and the bug logs, zipped if they are large >.5 MB.  If
> you can, vote on an existing problem.
> 
> James McKenzie
> 
> 
> 



From austinenglish at gmail.com  Mon Dec 17 00:51:27 2007
From: austinenglish at gmail.com (Austin English)
Date: Mon, 17 Dec 2007 00:51:27 -0600
Subject: [Fwd: Re: New bugzilla components.]
In-Reply-To: <22821af30712161800y4b94f876wa12fb49296ad16cd@mail.gmail.com>
References: <4765D687.6080506@sprintpcs.com>
	<22821af30712161800y4b94f876wa12fb49296ad16cd@mail.gmail.com>
Message-ID: <b6bb06270712162251x6e196153i9a3305c0a51720ec@mail.gmail.com>

> > Dmitry Timoshkov wrote:
> > >
> > > Users are not supposed to set a category the bug belongs to, this requires
> > > an investigation and knowledge of a developer. Personally I'd prefer to have
> > > "default" in the list instead of "wine-misc".
> > >
> > >
> > Better choice:  Unknown or intial report.  This will allow a user to
> > file a bug without having to get technical.
> > This also allows bug triage and for the appropriate developer or
> > development team to be notified of a new
> > bug.
> >
>
> What?  I assume you're talking about adding a new landing page like a
> simplified initial bug report.  That has nothing to do with the
> current discussion, so please bring that up out of this thread if you
> really want that.  Also, we already are notified of new bug reports
> through wine-bugs.

While wine-bugs can notify us of new bugs, there's not really anyway
to search for 'untriaged' bugs. A keyword or a default component would
allow for this. Since I spend most of my time attempting to
verify/triage new bugs as well as trimming out old bugs, this would be
a big help.

On a side note, what is the general consensus on an 'unimplemented
function' keyword?

-Austin


From dgriffi at cs.csubak.edu  Sun Dec 16 21:25:48 2007
From: dgriffi at cs.csubak.edu (David Griffith)
Date: Sun, 16 Dec 2007 19:25:48 -0800 (PST)
Subject: [Wine] crash running Myst
In-Reply-To: <4765D3DE.8060304@sprintpcs.com>
References: <Pine.GSO.4.55.0712152349310.11788@helios.cs.csubak.edu>
	<4765D3DE.8060304@sprintpcs.com>
Message-ID: <Pine.GSO.4.55.0712161905330.10963@helios.cs.csubak.edu>

On Sun, 16 Dec 2007, James McKenzie wrote:

> David Griffith wrote:
> > I'm trying to run Myst (masterpiece edition).  By upgrading Wine to .51,
> > I've gotten the install to finish without complaint.  When I attempt to
> > run Myst, the following is written to the terminal:
> >
> > $ wine Myst.exe
> > fixme:mixer:ALSA_MixerInit No master control found on MPU-401 UART,
> > disabling mixer
> > wine: Unhandled page fault on write access to 0x00150000 at address
> > 0xb7d75cbc (thread 0009), starting debugger...
> > First chance exception: page fault on write access to 0x00150000 in 32-bit
> > code (0xb7d75cbc).
> >
> > After that comes a register dump, stack dump, and 28 lines of backtrace.
> > Where do I go from here?
>
> File a bug report AFTER searching for problems with Myst.  If you find
> an existing problem, add
> your information and the bug logs, zipped if they are large >.5 MB.  If
> you can, vote on an existing problem.

Further investigation revealed that the latest version of Wine that works
with Myst-ME is 0.9.48.  It leaves a lot to be desired.

1) Myst seems to work only if the window manager is allowed to control the
windows.  Upon startup, though, it looks as if the window is unmanaged.
In particular, the entire top part of the screen is taken over by a menu
bar generated by Myst, even though the Myst "window" is only a quarter of
the screen.

2) After the introduction video finishes, the game is begun by opening the
book shown and touching the picture.  At this point the audio repeats the
last quarter second.  It grabs the mouse and refuses to let go even though
this option is not checked.  Control can be grabbed back by doing
ctrl-alt-backspace, which forces gdm to reset.

Slightly related to these, I found a more general problem which is still
present in .51.  If you start winecfg and set it to emulate a virtual
desktop of say, 800x600, you cannot sucessfully use winecfg after that
because the buttons on the bottom are more than 800 pixels away from the
top.  The top cannot be moved up nor can the window be resized.  It's not
clear to me how to turn off the virtual desktop behavior without using
winecfg or wiping out $HOME/.wine/.

-- 
David Griffith
dgriffi at cs.csubak.edu

A: Because it fouls the order in which people normally read text.
Q: Why is top-posting such a bad thing?
A: Top-posting.
Q: What is the most annoying thing in e-mail?


From stefan at codeweavers.com  Mon Dec 17 05:18:41 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Mon, 17 Dec 2007 12:18:41 +0100
Subject: wined3d: Bind device framebuffer in ActivateContext
In-Reply-To: <d75158870712151019u2597d85fh19869de5ae11b339@mail.gmail.com>
References: <d75158870711241507s3c43ae9dvcb20e7b1ec822299@mail.gmail.com>
	<d75158870711252200r4684de95x1e7a109446707e5b@mail.gmail.com>
	<d75158870712151019u2597d85fh19869de5ae11b339@mail.gmail.com>
Message-ID: <200712171218.41676.stefan@codeweavers.com>

Am Samstag, 15. Dezember 2007 19:19:25 schrieb Allan Tong:

Sorry for the late reply, your mail got stuck in my messy inbox :-(

> The second patch moves FBO draw buffer selection to ActivateContext.
> For onscreen rendering, not much changes except binding framebuffer 0.
>  For offscreen rendering, the behavior depends on the specified
> context usage.  For BLIT and RESOURCE_LOAD, the target surface is
> attached to dst_fbo and used as the draw buffer.  For DRAWPRIM and
> CLEAR, I simply call apply_fbo_state.  This assumes that DRAWPRIM and
> CLEAR will always be used with device->render_targets[0].
There is a problem with GL_COLOR_ATTACHMENT1_EXT and higher, and the depth 
attachment. You're only applying the first color attachment, but that can 
lead to incomplete fbos, if for example the render target and depth stencil 
are changed. If you're only reapplying the first color attachment, you can 
get a size mismatch, which makes the driver pretty angry and can slow 
everything down.

You don't have to apply the fbo state in CTXUSAGE_RESOURCELOAD in theory. 
Resourceload never draws anything, nor does it read from the framebuffer, so 
it should be fine with any drawable / framebuffer.


From stefan at codeweavers.com  Mon Dec 17 05:25:07 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Mon, 17 Dec 2007 12:25:07 +0100
Subject: [3/5] wined3d: create IWineD3DDeviceImpl_ClearSurface routine
In-Reply-To: <4765F35E.5010309@inbox.lv>
References: <4765F35E.5010309@inbox.lv>
Message-ID: <200712171225.08020.stefan@codeweavers.com>

Am Montag, 17. Dezember 2007 04:56:14 schrieb Alexander Dorofeyev:
> ---
>    dlls/wined3d/device.c          |  162
> ++++++++++++++++++++++++++++++++++++++++ dlls/wined3d/wined3d_private.h |  
>  3 +
>    2 files changed, 165 insertions(+), 0 deletions(-)
This patch, and 4 and 5 look good to me content wise, but patch 3 doesn't make 
much sense without either 4 or 5. It's up to AJ to decide, but you could 
propably combine patches 3 and 4(and keep 5 separate).



From alexd4 at inbox.lv  Mon Dec 17 04:46:36 2007
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Mon, 17 Dec 2007 02:46:36 -0800
Subject: [3/5] wined3d: create IWineD3DDeviceImpl_ClearSurface routine
In-Reply-To: <200712171225.08020.stefan@codeweavers.com>
References: <4765F35E.5010309@inbox.lv>
	<200712171225.08020.stefan@codeweavers.com>
Message-ID: <4766538C.6060604@inbox.lv>

Hi.

There was a bit of a problem with combining 3 & 4, because diff mixes 
parts of two functions together and the patch is a total mess that would 
be difficult to review. 2 separate patches looked like an easiest way 
around that. If that's not ok I can try other workarounds, may be 
experiment with some diff options or combine 3 & 5.

Stefan D?singer wrote:
> Am Montag, 17. Dezember 2007 04:56:14 schrieb Alexander Dorofeyev:
>> ---
>>    dlls/wined3d/device.c          |  162
>> ++++++++++++++++++++++++++++++++++++++++ dlls/wined3d/wined3d_private.h |  
>>  3 +
>>    2 files changed, 165 insertions(+), 0 deletions(-)
> This patch, and 4 and 5 look good to me content wise, but patch 3 doesn't make 
> much sense without either 4 or 5. It's up to AJ to decide, but you could 
> propably combine patches 3 and 4(and keep 5 separate).



From julliard at winehq.org  Mon Dec 17 05:53:46 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 17 Dec 2007 12:53:46 +0100
Subject: WineX11.drv: create X11 window for client area 1/3
In-Reply-To: <20071216160829.295120@gmx.net> (Roderick Colenbrander's message
	of "Sun, 16 Dec 2007 17:08:29 +0100")
References: <20071216160829.295120@gmx.net>
Message-ID: <873au11qr9.fsf@wine.dyndns.org>

"Roderick Colenbrander" <thunderbird2k at gmx.net> writes:

> +    {
> +        escape.drawable = X11DRV_get_client_window( top );
> +        if(!escape.drawable)
> +            escape.drawable = X11DRV_get_whole_window( top );

You shouldn't need that test, all windows should have a client window;
otherwise you have to tell the server about it too.

> +static Window create_client_window( Display *display, struct x11drv_win_data *data)
> +{
> +    RECT rect = data->whole_rect;
> +    XSetWindowAttributes attr;
> +
> +    OffsetRect( &rect, -data->whole_rect.left, -data->whole_rect.top );
> +    data->client_rect = rect;
> +
> +    attr.event_mask = ExposureMask;
> +    attr.bit_gravity = ForgetGravity;

ForgetGravity is wasteful, you should use NorthWestGravity and compute
the proper valid rects in SetWindowPos. ForgetGravity may be appropriate
for the non-client area though.

> @@ -1582,6 +1646,7 @@ void X11DRV_SetParent( HWND hwnd, HWND parent, HWND old_parent )
>      {
>          /* FIXME: we ignore errors since we can't really recover anyway */
>          create_whole_window( display, data, GetWindowLongW( hwnd, GWL_STYLE ) );
> +        create_client_window( display, data );

You need to destroy the client window in SetParent too.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Mon Dec 17 05:56:50 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 17 Dec 2007 12:56:50 +0100
Subject: [PATCH 2/2] qmgr: Stub functions for queue manager interface.
In-Reply-To: <20071213182727.GA1278@knuth.cs.hmc.edu> (Roy Shea's message of
	"Thu, 13 Dec 2007 10:27:27 -0800")
References: <20071213182727.GA1278@knuth.cs.hmc.edu>
Message-ID: <87y7btzg8t.fsf@wine.dyndns.org>

Roy Shea <roy at cs.hmc.edu> writes:

> ---
>  dlls/qmgr/Makefile.in |    1 +
>  dlls/qmgr/qmgr.c      |  103 +++++++++++++++++++++++++++++++++++++++++++++++++
>  dlls/qmgr/qmgr.h      |   38 ++++++++++++++++++
>  3 files changed, 142 insertions(+), 0 deletions(-)

Sending small patches is good, but they still need to do something
useful. So for a stub interface you should at least implement AddRef and
Release, and a way to create an instance.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Mon Dec 17 05:58:41 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 17 Dec 2007 12:58:41 +0100
Subject: RESUBMIT [PATCH] enumerate processes in reverse
In-Reply-To: <877ijd1zmr.fsf@totally-fudged-out-message-id> (Marcus Meissner's
	message of "Thu, 18 Oct 2007 08:44:16 +0200")
References: <877ijd1zmr.fsf@totally-fudged-out-message-id>
Message-ID: <87tzmhzg5q.fsf@wine.dyndns.org>

Marcus Meissner <marcus at jet.franken.de> writes:

> A game does:
> 	Process32First();
> 	while (Process32First()) {
> 		/* look for stuff */
> 	}
> completely missing the first process. Unfortunately it
> is looking for its own child, which gets missed.
>
> -> reverse enumerate processes
>
> Also with testcase.
>
> (I mailed this 4 weeks ago already, any comments?)

Are you sure the order is supposed to be reversed between kernel32 and
ntdll?  That feels a bit strange.

-- 
Alexandre Julliard
julliard at winehq.org


From chris.kcat at gmail.com  Mon Dec 17 08:04:39 2007
From: chris.kcat at gmail.com (Chris Robinson)
Date: Mon, 17 Dec 2007 06:04:39 -0800
Subject: WineX11.drv: create X11 window for client area 1/3
In-Reply-To: <873au11qr9.fsf@wine.dyndns.org>
References: <20071216160829.295120@gmx.net> <873au11qr9.fsf@wine.dyndns.org>
Message-ID: <200712170604.39695.chris.kcat@gmail.com>

On Monday 17 December 2007 03:53:46 am Alexandre Julliard wrote:
> "Roderick Colenbrander" <thunderbird2k at gmx.net> writes:
> > +    {
> > +        escape.drawable = X11DRV_get_client_window( top );
> > +        if(!escape.drawable)
> > +            escape.drawable = X11DRV_get_whole_window( top );
>
> You shouldn't need that test, all windows should have a client window;
> otherwise you have to tell the server about it too.

The desktop/root_window doesn't have a client window. All attempts to give it 
one were met with limitted success.

> > @@ -1582,6 +1646,7 @@ void X11DRV_SetParent( HWND hwnd, HWND parent, HWND
> > old_parent ) {
> >          /* FIXME: we ignore errors since we can't really recover anyway
> > */ create_whole_window( display, data, GetWindowLongW( hwnd, GWL_STYLE )
> > ); +        create_client_window( display, data );
>
> You need to destroy the client window in SetParent too.

The client window, being a child of the whole window, should be destroyed 
automagically with the whole window. Though the client_window ID does at 
least need to be set to 0, I suppose.


From julliard at winehq.org  Mon Dec 17 09:26:42 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 17 Dec 2007 16:26:42 +0100
Subject: WineX11.drv: create X11 window for client area 1/3
In-Reply-To: <200712170604.39695.chris.kcat@gmail.com> (Chris Robinson's
	message of "Mon, 17 Dec 2007 06:04:39 -0800")
References: <20071216160829.295120@gmx.net> <873au11qr9.fsf@wine.dyndns.org>
	<200712170604.39695.chris.kcat@gmail.com>
Message-ID: <87prx5z6j1.fsf@wine.dyndns.org>

Chris Robinson <chris.kcat at gmail.com> writes:

> The desktop/root_window doesn't have a client window. All attempts to give it 
> one were met with limitted success.

You don't have to create a separate client window for the desktop, you
can use the same window id for both.

> The client window, being a child of the whole window, should be destroyed 
> automagically with the whole window. Though the client_window ID does at 
> least need to be set to 0, I suppose.

Yes, the X window is destroyed automatically, but the data structures
need to reflect that fact.

-- 
Alexandre Julliard
julliard at winehq.org


From kuba at mareimbrium.org  Mon Dec 17 10:01:19 2007
From: kuba at mareimbrium.org (Kuba Ober)
Date: Mon, 17 Dec 2007 11:01:19 -0500
Subject: Unimplemented function KERNEL32.dll.FindFirstVolumeW
In-Reply-To: <2095224754@web.de>
References: <2095224754@web.de>
Message-ID: <200712171101.19417.kuba@mareimbrium.org>

On Monday 19 November 2007, devzero at web.de wrote:
> > Yes, Wine shouldn't be able to do that. You're not running Wine
> > as root are you?
>
> whoops - i did. shame on me :)
>
> i retried with ordinary account and the crash didn`t happen there.
> anyway - should i expect such problems with root ?

If selinux is not in use, root can write to /proc/kcore for example.
Do not run anything as root unless you are doing system administration. It's
as easy as that.

Cheers, Kuba


From kuba at mareimbrium.org  Mon Dec 17 10:03:37 2007
From: kuba at mareimbrium.org (Kuba Ober)
Date: Mon, 17 Dec 2007 11:03:37 -0500
Subject: Unimplemented function KERNEL32.dll.FindFirstVolumeW
In-Reply-To: <2096050935@web.de>
References: <2096050935@web.de>
Message-ID: <200712171103.37870.kuba@mareimbrium.org>

On Tuesday 20 November 2007, devzero at web.de wrote:
> mhhh - since it cost me more then one hour to find out why my machine
> reboots and triggering a reboot by just _reading_ a file on my system,
> device node or not is at least very weird behaviour from a user`s
> perspective.

Root's perspective != user's perspective. Normal users don't have access
to /dev/watchdog (if they do, your system is misconfigured).

> it`s looks a little bit too simple for me. triggering a reboot just by some
> simple open() and read() and close() ? let`s wait what the maintainer has
> to tell.

If you do it as root - yes. /dev/watchdog won't be the only culprit.

Cheers, Kuba


From dank at kegel.com  Mon Dec 17 11:54:32 2007
From: dank at kegel.com (Dan Kegel)
Date: Mon, 17 Dec 2007 09:54:32 -0800
Subject: New valgrind regressions in riched20, rpcrt4
Message-ID: <a71bd89a0712170954h3d8cf43fyc4b61e6544f60a37@mail.gmail.com>

http://kegel.com/wine/valgrind/logs-2007-12-17-summary.txt
shows interesting things happened since Friday in riched20.
See
http://kegel.com/wine/valgrind/logs-2007-12-17/vg-riched20_editor-diff.txt
for a whole heap of new errors.  The only change since Friday
was Maarten's, http://www.winehq.org/pipermail/wine-cvs/2007-December/038829.html,
which seems somewhat unrelated, maybe he's getting slagged
unfairly here.  (But it would still be nice if he could have a look.)

There's also the somewhat questionable new warning
+ Source and destination overlap in memcpy(0x7F00F844, 0x7F00F844, 22)
in
http://kegel.com/wine/valgrind/logs-2007-12-17/vg-rpcrt4_ndr_marshall-diff.txt
which would be Rob's if it turns out to be a real problem.
- Dan


From truiken at gmail.com  Mon Dec 17 12:05:01 2007
From: truiken at gmail.com (James Hawkins)
Date: Mon, 17 Dec 2007 12:05:01 -0600
Subject: [Fwd: Re: New bugzilla components.]
In-Reply-To: <b6bb06270712162251x6e196153i9a3305c0a51720ec@mail.gmail.com>
References: <4765D687.6080506@sprintpcs.com>
	<22821af30712161800y4b94f876wa12fb49296ad16cd@mail.gmail.com>
	<b6bb06270712162251x6e196153i9a3305c0a51720ec@mail.gmail.com>
Message-ID: <22821af30712171005k19d6f515m6ea7c9b09006c484@mail.gmail.com>

On Dec 17, 2007 12:51 AM, Austin English <austinenglish at gmail.com> wrote:
> > > Dmitry Timoshkov wrote:
> > > >
> > > > Users are not supposed to set a category the bug belongs to, this requires
> > > > an investigation and knowledge of a developer. Personally I'd prefer to have
> > > > "default" in the list instead of "wine-misc".
> > > >
> > > >
> > > Better choice:  Unknown or intial report.  This will allow a user to
> > > file a bug without having to get technical.
> > > This also allows bug triage and for the appropriate developer or
> > > development team to be notified of a new
> > > bug.
> > >
> >
> > What?  I assume you're talking about adding a new landing page like a
> > simplified initial bug report.  That has nothing to do with the
> > current discussion, so please bring that up out of this thread if you
> > really want that.  Also, we already are notified of new bug reports
> > through wine-bugs.
>
> While wine-bugs can notify us of new bugs, there's not really anyway
> to search for 'untriaged' bugs. A keyword or a default component would
> allow for this. Since I spend most of my time attempting to
> verify/triage new bugs as well as trimming out old bugs, this would be
> a big help.
>

Bad idea.  This would promote inactivity on older bugs.  Just pay
attention to wine-bugs.

> On a side note, what is the general consensus on an 'unimplemented
> function' keyword?
>

I'm pretty sure the consensus is against.

-- 
James Hawkins


From maarten at codeweavers.com  Mon Dec 17 12:09:29 2007
From: maarten at codeweavers.com (Maarten Lankhorst)
Date: Mon, 17 Dec 2007 19:09:29 +0100
Subject: New valgrind regressions in riched20, rpcrt4
In-Reply-To: <a71bd89a0712170954h3d8cf43fyc4b61e6544f60a37@mail.gmail.com>
References: <a71bd89a0712170954h3d8cf43fyc4b61e6544f60a37@mail.gmail.com>
Message-ID: <4766BB59.505@codeweavers.com>

Hi Dan,

Dan Kegel schreef:
> http://kegel.com/wine/valgrind/logs-2007-12-17-summary.txt
> shows interesting things happened since Friday in riched20.
> See
> http://kegel.com/wine/valgrind/logs-2007-12-17/vg-riched20_editor-diff.txt
> for a whole heap of new errors.  The only change since Friday
> was Maarten's, http://www.winehq.org/pipermail/wine-cvs/2007-December/038829.html,
> which seems somewhat unrelated, maybe he's getting slagged
> unfairly here.  (But it would still be nice if he could have a look.)
>   
There are 2 changes I did on friday, the first one was making some
functions static, the second one was the selectionbar. I don't see how
the selectionbar could cause this, so could you check if
f0c4fdbad92c4e553a442078464c8abfe5a23522 already has those errors?

Cheers & Thanks,
Maarten.


From actong88 at gmail.com  Mon Dec 17 15:56:58 2007
From: actong88 at gmail.com (Allan Tong)
Date: Mon, 17 Dec 2007 16:56:58 -0500
Subject: wined3d: Bind device framebuffer in ActivateContext
In-Reply-To: <200712171218.41676.stefan@codeweavers.com>
References: <d75158870711241507s3c43ae9dvcb20e7b1ec822299@mail.gmail.com>
	<d75158870711252200r4684de95x1e7a109446707e5b@mail.gmail.com>
	<d75158870712151019u2597d85fh19869de5ae11b339@mail.gmail.com>
	<200712171218.41676.stefan@codeweavers.com>
Message-ID: <d75158870712171356sa8a8e1bw3dee27d67dcc65c@mail.gmail.com>

On Dec 17, 2007 6:18 AM, Stefan D?singer <stefan at codeweavers.com> wrote:
> Am Samstag, 15. Dezember 2007 19:19:25 schrieb Allan Tong:
>
> Sorry for the late reply, your mail got stuck in my messy inbox :-(

No problem.

> > The second patch moves FBO draw buffer selection to ActivateContext.
> > For onscreen rendering, not much changes except binding framebuffer 0.
> >  For offscreen rendering, the behavior depends on the specified
> > context usage.  For BLIT and RESOURCE_LOAD, the target surface is
> > attached to dst_fbo and used as the draw buffer.  For DRAWPRIM and
> > CLEAR, I simply call apply_fbo_state.  This assumes that DRAWPRIM and
> > CLEAR will always be used with device->render_targets[0].
> There is a problem with GL_COLOR_ATTACHMENT1_EXT and higher, and the depth
> attachment. You're only applying the first color attachment, but that can
> lead to incomplete fbos, if for example the render target and depth stencil
> are changed. If you're only reapplying the first color attachment, you can
> get a size mismatch, which makes the driver pretty angry and can slow
> everything down.

As far as I can tell, the only thing that's ever attached to
device->dst_fbo is the first color attachment, so I wouldn't think
there's any chance for a size mismatch.  Do I still need to unset the
depth attachment or the higher color attachments?  I'm assuming
there's no reason to have a depth attachment for a blit operation.

> You don't have to apply the fbo state in CTXUSAGE_RESOURCELOAD in theory.
> Resourceload never draws anything, nor does it read from the framebuffer, so
> it should be fine with any drawable / framebuffer.

I left it in since some places call ActivateContext using
CTXUSAGE_RESOURCELOAD but with something other than
device->lastActiveRenderTarget, e.g. SetRenderTarget.  I wasn't sure
if there is any code that's relying on the draw buffer being set by
these calls.

 - Allan

From truiken at gmail.com  Mon Dec 17 19:54:16 2007
From: truiken at gmail.com (James Hawkins)
Date: Mon, 17 Dec 2007 19:54:16 -0600
Subject: msi [2/2]: Sort each table of the join separately
In-Reply-To: <22821af30712171735r1b156275w78f057878b2ed592@mail.gmail.com>
References: <22821af30712171735r1b156275w78f057878b2ed592@mail.gmail.com>
Message-ID: <22821af30712171754u7a470e78n95907e6a194405de@mail.gmail.com>

On Dec 17, 2007 7:35 PM, James Hawkins <truiken at gmail.com> wrote:
> Hi,
>
> This is another fix for the National Instruments LabView mega-installer.
>
> Changelog:
> * Sort each table of the join separately.
>

Oops, ignore this patch (first one can go in).  I forgot to add the
freeing code for the order.  I'll have to resend it tomorrow.

-- 
James Hawkins


From mk144210 at bcm.edu  Mon Dec 17 20:23:01 2007
From: mk144210 at bcm.edu (Misha Koshelev)
Date: Mon, 17 Dec 2007 20:23:01 -0600
Subject: Vector NTI on Mac, WinHelp improvements
Message-ID: <1197944582.7703.9.camel@misha-laptop>

Hi guys,

It's been a bit since I wrote to the list (or contributed anything...
been somewhat busy I guess with lab/school/life). Anyhow I just wanted
to acknowledge the new WinHelp fixes (Kirill thanks in particular).
Although there is still no Contents or Search, which would make the
Vector NTI help more usable, the bug where it would complain about not
being able to open help when it was requested even though help would
open just fine has now been fixed. Thanks!

Also, I've been starting to play some with Wine on Mac and may in time
end up contributing some patches for this goal, provided I will have to
acquaint myself with some more Mac specific coding ideas first.
Specifically though, I'd like to point out that I think the Mac is a
hugely important platform for Wine I believe in terms of end-user
adoption, and although I understand the rationale for not having binary
packages available because Apple's X11 is buggy (which it clearly is), I
think it would still be nice to have the Mac at least be an important
focus.

And yes my thought initially was "well there's usually a Mac version of
the Windows program." But alas unfortunately this seems to not quite be
the case a lot of times. For example, even Vector NTI, which has both
"mac and windows" versions, actually has a Mac version that does not
work on MacOS 10.4 and higher (the company reports they are working on a
code rewrite for Mac versions, but meanwhile there are tons of people
out there on Google looking for ways around this/alternatives as Vector
NTI is very common in molecular biology and Macs are traditionally the
platform of choice in the field)... Wine would find a very nice niche
here with a bunch of people that otherwise prob would not end up using
it.

Another program we use a lot, Kodak Molecular Imaging, also actually has
problems with MacOS 10.4+ on Intel (not PowerPC) Macs, although this has
to do with the dongle drivers (USB dongle = Sentinel SuperPro), so
likely Wine would need a little more improvement to be of use here.

Anyway, just wanted to point out my observations about the Mac and that
although others might be thinking along the same lines I was... "well
most programs available for Windows are available for Mac", in two
examples I've discovered that upon careful examination this actually
turns out to be quite opposite of the actual case.

Thanks for you time
Misha


From hverbeet at gmail.com  Tue Dec 18 02:49:37 2007
From: hverbeet at gmail.com (H. Verbeet)
Date: Tue, 18 Dec 2007 09:49:37 +0100
Subject: wined3d: Bind device framebuffer in ActivateContext
In-Reply-To: <d75158870712171356sa8a8e1bw3dee27d67dcc65c@mail.gmail.com>
References: <d75158870711241507s3c43ae9dvcb20e7b1ec822299@mail.gmail.com>
	<d75158870711252200r4684de95x1e7a109446707e5b@mail.gmail.com>
	<d75158870712151019u2597d85fh19869de5ae11b339@mail.gmail.com>
	<200712171218.41676.stefan@codeweavers.com>
	<d75158870712171356sa8a8e1bw3dee27d67dcc65c@mail.gmail.com>
Message-ID: <d658b69e0712180049s6bec059vb6678fe4be048ab0@mail.gmail.com>

On 17/12/2007, Allan Tong <actong88 at gmail.com> wrote:
> > > The second patch moves FBO draw buffer selection to ActivateContext.
> > > For onscreen rendering, not much changes except binding framebuffer 0.
> > >  For offscreen rendering, the behavior depends on the specified
> > > context usage.  For BLIT and RESOURCE_LOAD, the target surface is
> > > attached to dst_fbo and used as the draw buffer.  For DRAWPRIM and
> > > CLEAR, I simply call apply_fbo_state.  This assumes that DRAWPRIM and
> > > CLEAR will always be used with device->render_targets[0].
> > There is a problem with GL_COLOR_ATTACHMENT1_EXT and higher, and the depth
> > attachment. You're only applying the first color attachment, but that can
> > lead to incomplete fbos, if for example the render target and depth stencil
> > are changed. If you're only reapplying the first color attachment, you can
> > get a size mismatch, which makes the driver pretty angry and can slow
> > everything down.
>
> As far as I can tell, the only thing that's ever attached to
> device->dst_fbo is the first color attachment, so I wouldn't think
> there's any chance for a size mismatch.  Do I still need to unset the
> depth attachment or the higher color attachments?  I'm assuming
> there's no reason to have a depth attachment for a blit operation.
>
Currently src_fbo and dst_fbo are only used for doing blits between
surfaces in stretch_rect_fbo() and a colorfill in color_fill_fbo(), so
there will only ever be something attached to
GL_COLOR_ATTACHMENT0_EXT.


From damian at wojslaw.pl  Tue Dec 18 03:15:40 2007
From: damian at wojslaw.pl (=?ISO-8859-2?Q?Damian_Wojs=B3aw?=)
Date: Tue, 18 Dec 2007 10:15:40 +0100
Subject: DTrace instrumentation
Message-ID: <47678FBC.9030707@wojslaw.pl>

Hi

I have an idea that I can put some time into. Since Leopard, FreeBSD 
and, of course, Solaris, now all have DTrace, I thought of implementing 
some simple probes. Function entry/return for starters. However, I'd 
firstly need to know two things:
- would anyone be interested in it?
- would it be legal (it wold link with dtrace library, which on Solaris 
is CDDL).

Regards


-- 
Damian Wojs?aw
OpenSolaris Core Contributor
SCA No. OS00073


From thunderbird2k at gmx.net  Tue Dec 18 04:15:45 2007
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Tue, 18 Dec 2007 11:15:45 +0100
Subject: WineX11.drv: Add an X11 window for the client area [attempt2]
In-Reply-To: <20071218095211.227660@gmx.net>
References: <20071218093857.133970@gmx.net> <20071218095211.227660@gmx.net>
Message-ID: <20071218101545.16540@gmx.net>

By accident I discovered that with this patch the wine desktop window doesn't work properly if there are multiple windows around (you notice redrawing issues). I haven't seen those before, so there is something wrong in this patch but I don't know where to look (I guess it is the client_window = whole_window code).

Roderick

> The previous patch accidently undid one of Stefan's changes and prevented
> it from compiling. This patch should be fine.
> 
> Roderick
> 
> 
> > Hi,
> > 
> > This is an updated version of the previous patch. It contains the
> > following changes:
> > - the client window is set to the whole window in case of the desktop
> > - NortWestGravity is used when creating the client window
> > - the client window is destroyed in SetParent together with the other
> X11
> > windows
> > 
> > The patch was tested using the user32 tests and various opengl / d3d
> test
> > apps. All worked correctly.
> > 
> > Regards,
> > Roderick Colenbrander
> > 
> > -- 
> > GMX FreeMail: 1 GB Postfach, 5 E-Mail-Adressen, 10 Free SMS.
> > Alle Infos und kostenlose Anmeldung: http://www.gmx.net/de/go/freemail
> 
> -- 
> GMX FreeMail: 1 GB Postfach, 5 E-Mail-Adressen, 10 Free SMS.
> Alle Infos und kostenlose Anmeldung: http://www.gmx.net/de/go/freemail

-- 
Ist Ihr Browser Vista-kompatibel? Jetzt die neuesten 
Browser-Versionen downloaden: http://www.gmx.net/de/go/browser


From stefan at codeweavers.com  Tue Dec 18 05:52:27 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Tue, 18 Dec 2007 12:52:27 +0100
Subject: [10/10] WineD3D: Implement blits from the active render target to
	swapchains
In-Reply-To: <200712172104.46841.stefan@codeweavers.com>
References: <200712172104.46841.stefan@codeweavers.com>
Message-ID: <200712181252.28049.stefan@codeweavers.com>

Am Montag, 17. Dezember 2007 21:04:46 schrieb Stefan D?singer:
Do not apply this patch yet, it has some problems


From thunder.m at email.cz  Tue Dec 18 06:08:33 2007
From: thunder.m at email.cz (=?windows-1252?Q?Mirek_Slugen=28?=)
Date: Tue, 18 Dec 2007 13:08:33 +0100
Subject: [10/10] WineD3D: Implement blits from the active render target
	to swapchains
In-Reply-To: <200712181252.28049.stefan@codeweavers.com>
References: <200712172104.46841.stefan@codeweavers.com>
	<200712181252.28049.stefan@codeweavers.com>
Message-ID: <4767B841.5010406@email.cz>

Hi, this patch caused some rendering issues to NFS PRO STREET too.

Mirek Slugen

Stefan D?singer napsal(a):
> Am Montag, 17. Dezember 2007 21:04:46 schrieb Stefan D?singer:
> Do not apply this patch yet, it has some problems
> 
> 
> 


From rob at codeweavers.com  Tue Dec 18 09:08:32 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Tue, 18 Dec 2007 15:08:32 +0000
Subject: gdi32: Add a GdiConvertToDevmodeW test, make it pass under Wine
In-Reply-To: <E1J4bS1-0005uR-Nw@mail.codeweavers.com>
References: <E1J4bS1-0005uR-Nw@mail.codeweavers.com>
Message-ID: <4767E270.8040707@codeweavers.com>

Dmitry Timoshkov wrote:
>      DEVMODEW *dmW;
>      WORD dmW_size;
>  
> -    dmW_size = dmA->dmSize + CCHDEVICENAME;
> -    if (dmA->dmSize >= (const char *)dmA->dmFormName - (const char *)dmA + CCHFORMNAME)
> +    dmW_size = dmA->dmSize;
> +    if (dmW_size > sizeof(DEVMODEA))
> +        dmW_size = sizeof(DEVMODEA);
>   

Shouldn't this be sizeof(DEVMODEW)?

> +
> +    dmW_size += CCHDEVICENAME;
>   

Shouldn't this be CCDEVICENAME * sizeof(WCHAR)?

> +    if (dmA->dmSize >= FIELD_OFFSET(DEVMODEA, dmFormName) + CCHFORMNAME)
>          dmW_size += CCHFORMNAME; 
>   

Shouldn't this be CCHFORMNAME * sizeof(WCHAR)?

-- 
Rob Shearman



From dmitry at codeweavers.com  Tue Dec 18 09:19:02 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Tue, 18 Dec 2007 23:19:02 +0800
Subject: gdi32: Add a GdiConvertToDevmodeW test, make it pass under Wine
References: <E1J4bS1-0005uR-Nw@mail.codeweavers.com>
	<4767E270.8040707@codeweavers.com>
Message-ID: <014d01c84189$53fcf1b0$a600fea9@DMITRY>

"Robert Shearman" <rob at codeweavers.com> wrote:

>> -    dmW_size = dmA->dmSize + CCHDEVICENAME;
>> -    if (dmA->dmSize >= (const char *)dmA->dmFormName - (const char *)dmA + CCHFORMNAME)
>> +    dmW_size = dmA->dmSize;
>> +    if (dmW_size > sizeof(DEVMODEA))
>> +        dmW_size = sizeof(DEVMODEA);
>>   
> 
> Shouldn't this be sizeof(DEVMODEW)?

No, because of below reasons.

>> +
>> +    dmW_size += CCHDEVICENAME;
>>   
> 
> Shouldn't this be CCDEVICENAME * sizeof(WCHAR)?
> 
>> +    if (dmA->dmSize >= FIELD_OFFSET(DEVMODEA, dmFormName) + CCHFORMNAME)
>>          dmW_size += CCHFORMNAME; 
>>   
> 
> Shouldn't this be CCHFORMNAME * sizeof(WCHAR)?

DEVMODEA already allocates space for 1-byte buffers, by adding the size of
each buffer I effectively multiply the size of buffers in A structure by 2.

-- 
Dmitry.


From p.beutner at gmx.net  Tue Dec 18 09:43:27 2007
From: p.beutner at gmx.net (Peter Beutner)
Date: Tue, 18 Dec 2007 16:43:27 +0100
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>
Message-ID: <4767EA9F.2030109@gmx.net>

Andrew Riedi schrieb:
> Sometimes Wine has optional features that users want to enable, but that
> require specific headers to compile.  For bug reports, and the user IRC
> channel, it seemed a good idea to add an option to Wine to figure out
> what optional features have been compiled into Wine.  Also, specific
> versions of GCC may cause problems for specific programs that involve
> copy protection software.  To help out users, testers, people who tend
> to our bugzilla, and other people involved with Wine, I decided to add
> an option to Wine to output this valuable information.
> 

+        /* Compiler */
+        printf( "\nCompiler:\n" );
+#ifdef __GNUC__
+        printf( "\tGCC %d.%d.%d\n", __GNUC__, __GNUC_MINOR__, __GNUC_PATCHLEVEL__ );
+# if (__GNUC__ == 4 && (__GNUC_MINOR__ == 0 || __GNUC_MINOR__ == 1))
+        printf( "\t**This GCC may cause problems with copy protection.**\n" );
+# endif
+#endif

As I recall this is not the only version that causes problems. Plus certain compiler 
flags have an influence as well. And as most distros ship gcc with a bunch
of patches you probably can't even rely on the gcc version alone.

Imo it would be better to collect the info on a wiki page.


From winehacker at gmail.com  Tue Dec 18 10:10:19 2007
From: winehacker at gmail.com (Steven Edwards)
Date: Tue, 18 Dec 2007 11:10:19 -0500
Subject: DTrace instrumentation
In-Reply-To: <47678FBC.9030707@wojslaw.pl>
References: <47678FBC.9030707@wojslaw.pl>
Message-ID: <19e31a080712180810p25de4246v6d1f0512e7cfb349@mail.gmail.com>

On Dec 18, 2007 4:15 AM, Damian Wojs?aw <damian at wojslaw.pl> wrote:
> - would it be legal (it wold link with dtrace library, which on Solaris
> is CDDL).

As long as you are not distributing code licensed under the CDDL and
your code is licensed under a LGPL compatible license then there is no
reason why you can't link to it.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo

From xixsimplicityxix at gmail.com  Tue Dec 18 11:49:10 2007
From: xixsimplicityxix at gmail.com (John Klehm)
Date: Tue, 18 Dec 2007 11:49:10 -0600
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <4767EA9F.2030109@gmx.net>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>
	<4767EA9F.2030109@gmx.net>
Message-ID: <78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com>

On Dec 18, 2007 9:43 AM, Peter Beutner <p.beutner at gmx.net> wrote:

> As I recall this is not the only version that causes problems. Plus certain compiler
> flags have an influence as well. And as most distros ship gcc with a bunch
> of patches you probably can't even rely on the gcc version alone.
>
> Imo it would be better to collect the info on a wiki page.
>

Like this one?  http://wiki.winehq.org/GccVersions

Nothing wrong with having the info output reflect the knowledge
gathered on the wiki page.

--John


From chris.kcat at gmail.com  Tue Dec 18 11:51:04 2007
From: chris.kcat at gmail.com (Chris Robinson)
Date: Tue, 18 Dec 2007 09:51:04 -0800
Subject: WineX11.drv: Add an X11 window for the client area [attempt2]
In-Reply-To: <20071218095211.227660@gmx.net>
References: <20071218093857.133970@gmx.net> <20071218095211.227660@gmx.net>
Message-ID: <200712180951.04869.chris.kcat@gmail.com>

On Tuesday 18 December 2007 01:52:11 am Roderick Colenbrander wrote:
> > This is an updated version of the previous patch. It contains the
> > following changes:
> > - the client window is set to the whole window in case of the desktop

I think you also need to set the desktop hwnd's client_window_prop too, so 
GetDC and friends will get the right window when not using the DCX_WINDOW 
flag.

> > - the client window is destroyed in SetParent together with the other X11
> > windows

In the case of data->whole_window == data->client_window, you should probably 
make sure the client_window (and it's prop) are both set back to 0, too.


From dank at kegel.com  Tue Dec 18 12:38:26 2007
From: dank at kegel.com (Dan Kegel)
Date: Tue, 18 Dec 2007 10:38:26 -0800
Subject: Today's git won't hunt. Server crash, lots of other problems?
Message-ID: <a71bd89a0712181038l5cfbd7bdk7c6e238093876db7@mail.gmail.com>

On Dec 18, 2007 10:29 AM, Susan Cragin <susancragin at earthlink.net> wrote:
> My git won't install DNS9P any more, as of today's git.
> Any suggestions?
>
> susan at ubuntu:~/DNS9$ wine setup
> fixme:advapi:LookupAccountNameW (null) L"susan" (nil) 0x34b944 (nil) 0x34b948 0x34b93c - stub
> fixme:advapi:LookupAccountNameW (null) L"susan" 0x1463f0 0x34b944 0x146998 0x34b948 0x34b93c - stub
> fixme:msi:ITERATE_DuplicateFiles We should track these duplicate files as well
> fixme:msi:msi_unimplemented_action_stub RemoveFolders -> 2 ignored L"CreateFolder" table values
> fixme:advapi:LookupAccountNameW (null) L"susan" (nil) 0x34f7fc (nil) 0x34f800 0x34f7f4 - stub
> fixme:advapi:LookupAccountNameW (null) L"susan" 0x1423a0 0x34f7fc 0x13ce80 0x34f800 0x34f7f4 - stub
> fixme:atl:AtlModuleInit SEMI-STUB (0x40eb40 0x40c040 0x400000)
> wineserver crashed, please enable coredumps (ulimit -c unlimited) and restart.

I just ran into that myself.    ALVIN!!!!!!!!!

But it doesn't seem easy to repeat; I keep getting other errors now.

Roy next to me says he ran into another regression, he's doing a bisect,
maybe it's the same thing.  He should be done shortly.
- Dan


From rob at codeweavers.com  Tue Dec 18 12:56:22 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Tue, 18 Dec 2007 18:56:22 +0000
Subject: Today's git won't hunt. Server crash, lots of other problems?
In-Reply-To: <a71bd89a0712181038l5cfbd7bdk7c6e238093876db7@mail.gmail.com>
References: <a71bd89a0712181038l5cfbd7bdk7c6e238093876db7@mail.gmail.com>
Message-ID: <476817D6.7040909@codeweavers.com>

Dan Kegel wrote:
> On Dec 18, 2007 10:29 AM, Susan Cragin <susancragin at earthlink.net> wrote:
>   
>> My git won't install DNS9P any more, as of today's git.
>> Any suggestions?
>>
>> susan at ubuntu:~/DNS9$ wine setup
>> fixme:advapi:LookupAccountNameW (null) L"susan" (nil) 0x34b944 (nil) 0x34b948 0x34b93c - stub
>> fixme:advapi:LookupAccountNameW (null) L"susan" 0x1463f0 0x34b944 0x146998 0x34b948 0x34b93c - stub
>> fixme:msi:ITERATE_DuplicateFiles We should track these duplicate files as well
>> fixme:msi:msi_unimplemented_action_stub RemoveFolders -> 2 ignored L"CreateFolder" table values
>> fixme:advapi:LookupAccountNameW (null) L"susan" (nil) 0x34f7fc (nil) 0x34f800 0x34f7f4 - stub
>> fixme:advapi:LookupAccountNameW (null) L"susan" 0x1423a0 0x34f7fc 0x13ce80 0x34f800 0x34f7f4 - stub
>> fixme:atl:AtlModuleInit SEMI-STUB (0x40eb40 0x40c040 0x400000)
>> wineserver crashed, please enable coredumps (ulimit -c unlimited) and restart.
>>     
>
> I just ran into that myself.    ALVIN!!!!!!!!!
>
> But it doesn't seem easy to repeat; I keep getting other errors now.
>
> Roy next to me says he ran into another regression, he's doing a bisect,
> maybe it's the same thing.  He should be done shortly.

I don't think DNS9 uses the console API, and the only other recent 
changes in the server are to do with I/O completion ports. If you can't 
reproduce it very easily, then it might be worth just trying to confirm 
that it does use I/O completion ports.

-- 
Rob Shearman



From julliard at winehq.org  Tue Dec 18 13:08:16 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Tue, 18 Dec 2007 20:08:16 +0100
Subject: Today's git won't hunt. Server crash, lots of other problems?
In-Reply-To: <476817D6.7040909@codeweavers.com> (Robert Shearman's message of
	"Tue, 18 Dec 2007 18:56:22 +0000")
References: <a71bd89a0712181038l5cfbd7bdk7c6e238093876db7@mail.gmail.com>
	<476817D6.7040909@codeweavers.com>
Message-ID: <878x3rzuqn.fsf@wine.dyndns.org>

Robert Shearman <rob at codeweavers.com> writes:

> I don't think DNS9 uses the console API, and the only other recent 
> changes in the server are to do with I/O completion ports. If you can't 
> reproduce it very easily, then it might be worth just trying to confirm 
> that it does use I/O completion ports.

Yes, the crash is with completion ports. I just pushed out a fix.

-- 
Alexandre Julliard
julliard at winehq.org


From p.beutner at gmx.net  Tue Dec 18 13:20:23 2007
From: p.beutner at gmx.net (Peter Beutner)
Date: Tue, 18 Dec 2007 20:20:23 +0100
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>	
	<4767EA9F.2030109@gmx.net>
	<78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com>
Message-ID: <47681D77.8080007@gmx.net>

John Klehm schrieb:
> On Dec 18, 2007 9:43 AM, Peter Beutner <p.beutner at gmx.net> wrote:
> 
>> As I recall this is not the only version that causes problems. Plus certain compiler
>> flags have an influence as well. And as most distros ship gcc with a bunch
>> of patches you probably can't even rely on the gcc version alone.
>>
>> Imo it would be better to collect the info on a wiki page.
>>
> 
> Like this one?  http://wiki.winehq.org/GccVersions

ah, nice. didn't know about that one.

> Nothing wrong with having the info output reflect the knowledge
> gathered on the wiki page.

So let's add to that info that gcc 4.2.2 (on gentoo) doesn't work.
As well as recent 4.3-snapshots. (At least that was the status a few
releases back, haven't tested in a while.)
But they did work if you compile with -fstack-protector. And some
distros(I think Ubuntu for example) patch gcc to use that flag by default.
And at least with gcc-4.2.2 it was always very close at the line
between working and non-working. Just a few changes in gdi/kernel/user
could make a difference. So it might even vary between single wine releases.

You want to put and more importantly maintain all those details in the
src code?

I don't think that this is such a great idea. But hey, that's just my
opinion.



From the3dfxdude at gmail.com  Tue Dec 18 13:53:38 2007
From: the3dfxdude at gmail.com (Jesse Allen)
Date: Tue, 18 Dec 2007 12:53:38 -0700
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <47681D77.8080007@gmx.net>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>
	<4767EA9F.2030109@gmx.net>
	<78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com>
	<47681D77.8080007@gmx.net>
Message-ID: <530468570712181153x55cc68f8uc5898dd07895952a@mail.gmail.com>

On Dec 18, 2007 12:20 PM, Peter Beutner <p.beutner at gmx.net> wrote:
> John Klehm schrieb:
> > On Dec 18, 2007 9:43 AM, Peter Beutner <p.beutner at gmx.net> wrote:
> >
> >> As I recall this is not the only version that causes problems. Plus certain compiler
> >> flags have an influence as well. And as most distros ship gcc with a bunch
> >> of patches you probably can't even rely on the gcc version alone.
> >>
> >> Imo it would be better to collect the info on a wiki page.
> >>
> >
> > Like this one?  http://wiki.winehq.org/GccVersions
>
> ah, nice. didn't know about that one.
>
> > Nothing wrong with having the info output reflect the knowledge
> > gathered on the wiki page.
>
> So let's add to that info that gcc 4.2.2 (on gentoo) doesn't work.
> As well as recent 4.3-snapshots. (At least that was the status a few
> releases back, haven't tested in a while.)
> But they did work if you compile with -fstack-protector. And some
> distros(I think Ubuntu for example) patch gcc to use that flag by default.
> And at least with gcc-4.2.2 it was always very close at the line
> between working and non-working. Just a few changes in gdi/kernel/user
> could make a difference. So it might even vary between single wine releases.
>
> You want to put and more importantly maintain all those details in the
> src code?
>
> I don't think that this is such a great idea. But hey, that's just my
> opinion.
>
>


Hmmm.  It's good that we have a wiki for this now. While that page
seems to be focused on SafeDisc, I have long known that gcc 4.0.x
breaks SecuRom. Should we differentiate the two? Maybe not. Since we
have a wiki up, I will probably link to it from my appdb pages now. If
there is anything we can do to identify which distros have broken
gcc's for copy protection we need to do it. These days I still get
people complaining their disc doesn't work and I have no clue what's
wrong as I have not seen a regression in years (this is older
SecuRom), and they do have what I consider to be a working version of
gcc. Sounds like a we're getting into packaging/flags stuff. I don't
even want to go there.


From rob at codeweavers.com  Tue Dec 18 14:38:26 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Tue, 18 Dec 2007 20:38:26 +0000
Subject: [PATCH] Implement BindIoCompletionCallback
In-Reply-To: <476827B3.1060006@gmail.com>
References: <476827B3.1060006@gmail.com>
Message-ID: <47682FC2.5020403@codeweavers.com>

Andrey Turkin wrote:
>  /******************************************************************************
>   *		BindIoCompletionCallback (KERNEL32.@)
>   */
> +extern NTSTATUS WINAPI RtlSetIoCompletionCallback(HANDLE,LPOVERLAPPED_COMPLETION_ROUTINE,ULONG);
>   

This should go in winternl.h.

>  BOOL WINAPI BindIoCompletionCallback( HANDLE FileHandle, LPOVERLAPPED_COMPLETION_ROUTINE Function, ULONG Flags)
>  {
> -    FIXME("%p, %p, %d, stub!\n", FileHandle, Function, Flags);
> -    SetLastError(ERROR_CALL_NOT_IMPLEMENTED);
> +    NTSTATUS status;
> +
> +    TRACE("(%p, %p, %d)\n", FileHandle, Function, Flags);
> +
> +    status = RtlSetIoCompletionCallback( FileHandle, Function, Flags );
> +    if (status == STATUS_SUCCESS) return TRUE;
> +    SetLastError( RtlNtStatusToDosError(status) );
>      return FALSE;
>  } 
>   


-- 
Rob Shearman



From andrey.turkin at gmail.com  Tue Dec 18 14:49:17 2007
From: andrey.turkin at gmail.com (Andrey Turkin)
Date: Tue, 18 Dec 2007 23:49:17 +0300
Subject: [PATCH] Implement BindIoCompletionCallback
In-Reply-To: <47682FC2.5020403@codeweavers.com>
References: <476827B3.1060006@gmail.com> <47682FC2.5020403@codeweavers.com>
Message-ID: <4768324D.9000207@gmail.com>

Robert Shearman wrote:
> Andrey Turkin wrote:
>>  /******************************************************************************
>>
>>   *        BindIoCompletionCallback (KERNEL32.@)
>>   */
>> +extern NTSTATUS WINAPI
>> RtlSetIoCompletionCallback(HANDLE,LPOVERLAPPED_COMPLETION_ROUTINE,ULONG);
>>
>>   
>
> This should go in winternl.h.
winternl.h may not depend on winbase.h for some reason, so this would
mean either changing prototype to "(HANDLE,LPVOID,ULONG)", which seems
wrong, or redefining LPOVERLAPPED_COMPLETION_ROUTINE and
OVERLAPPED/LPOVERLAPPED, which seems to be too much duplication.
>
>>  BOOL WINAPI BindIoCompletionCallback( HANDLE FileHandle,
>> LPOVERLAPPED_COMPLETION_ROUTINE Function, ULONG Flags)
>>  {
>> -    FIXME("%p, %p, %d, stub!\n", FileHandle, Function, Flags);
>> -    SetLastError(ERROR_CALL_NOT_IMPLEMENTED);
>> +    NTSTATUS status;
>> +
>> +    TRACE("(%p, %p, %d)\n", FileHandle, Function, Flags);
>> +
>> +    status = RtlSetIoCompletionCallback( FileHandle, Function, Flags );
>> +    if (status == STATUS_SUCCESS) return TRUE;
>> +    SetLastError( RtlNtStatusToDosError(status) );
>>      return FALSE;
>>  }   
>
>



From winehacker at gmail.com  Tue Dec 18 17:17:53 2007
From: winehacker at gmail.com (Steven Edwards)
Date: Tue, 18 Dec 2007 18:17:53 -0500
Subject: [PATCH] Implement BindIoCompletionCallback
In-Reply-To: <4768324D.9000207@gmail.com>
References: <476827B3.1060006@gmail.com> <47682FC2.5020403@codeweavers.com>
	<4768324D.9000207@gmail.com>
Message-ID: <19e31a080712181517k63c6ee1cte18c5e1d48ca182a@mail.gmail.com>

On Dec 18, 2007 3:49 PM, Andrey Turkin <andrey.turkin at gmail.com> wrote:
> winternl.h may not depend on winbase.h for some reason, so this would
> mean either changing prototype to "(HANDLE,LPVOID,ULONG)", which seems
> wrong, or redefining LPOVERLAPPED_COMPLETION_ROUTINE and
> OVERLAPPED/LPOVERLAPPED, which seems to be too much duplication.

Has anyone looked at the latest WDK to see where this goes? Is it
really winternl.h? That header seems to be a bit of a bastard hack
Microsoft threw together to shut-up the anti-trust case. These
functions and others we have had to add to winternl.h have got to be
documented in some other DDK header which we can implement.

Thanks

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From scott at open-vote.org  Tue Dec 18 19:20:00 2007
From: scott at open-vote.org (Scott Ritchie)
Date: Tue, 18 Dec 2007 17:20:00 -0800
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <530468570712181153x55cc68f8uc5898dd07895952a@mail.gmail.com>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>	<4767EA9F.2030109@gmx.net>	<78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com>	<47681D77.8080007@gmx.net>
	<530468570712181153x55cc68f8uc5898dd07895952a@mail.gmail.com>
Message-ID: <476871C0.9050102@open-vote.org>

Jesse Allen wrote:
> On Dec 18, 2007 12:20 PM, Peter Beutner <p.beutner at gmx.net> wrote:
>> John Klehm schrieb:
>>> On Dec 18, 2007 9:43 AM, Peter Beutner <p.beutner at gmx.net> wrote:
>>>
>>>> As I recall this is not the only version that causes problems. Plus certain compiler
>>>> flags have an influence as well. And as most distros ship gcc with a bunch
>>>> of patches you probably can't even rely on the gcc version alone.
>>>>
>>>> Imo it would be better to collect the info on a wiki page.
>>>>
>>> Like this one?  http://wiki.winehq.org/GccVersions
>> ah, nice. didn't know about that one.
>>
>>> Nothing wrong with having the info output reflect the knowledge
>>> gathered on the wiki page.
>> So let's add to that info that gcc 4.2.2 (on gentoo) doesn't work.
>> As well as recent 4.3-snapshots. (At least that was the status a few
>> releases back, haven't tested in a while.)
>> But they did work if you compile with -fstack-protector. And some
>> distros(I think Ubuntu for example) patch gcc to use that flag by default.
>> And at least with gcc-4.2.2 it was always very close at the line
>> between working and non-working. Just a few changes in gdi/kernel/user
>> could make a difference. So it might even vary between single wine releases.
>>
>> You want to put and more importantly maintain all those details in the
>> src code?
>>
>> I don't think that this is such a great idea. But hey, that's just my
>> opinion.
>>
>>
> 
> 
> Hmmm.  It's good that we have a wiki for this now. While that page
> seems to be focused on SafeDisc, I have long known that gcc 4.0.x
> breaks SecuRom. Should we differentiate the two? Maybe not. Since we
> have a wiki up, I will probably link to it from my appdb pages now. If
> there is anything we can do to identify which distros have broken
> gcc's for copy protection we need to do it. These days I still get
> people complaining their disc doesn't work and I have no clue what's
> wrong as I have not seen a regression in years (this is older
> SecuRom), and they do have what I consider to be a working version of
> gcc. Sounds like a we're getting into packaging/flags stuff. I don't
> even want to go there.
> 
> 

Ugh....this means that 4.2 for Ubuntu might NOT actually work, and that
this is why System Shock 2 has been crashing at startup for me.

I'm gonna try building with 3.4 and see if that fixes anything

Thanks,
Scott Ritchie


From p.beutner at gmx.net  Tue Dec 18 19:49:01 2007
From: p.beutner at gmx.net (Peter Beutner)
Date: Wed, 19 Dec 2007 02:49:01 +0100
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <476871C0.9050102@open-vote.org>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>	<4767EA9F.2030109@gmx.net>	<78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com>	<47681D77.8080007@gmx.net>	<530468570712181153x55cc68f8uc5898dd07895952a@mail.gmail.com>
	<476871C0.9050102@open-vote.org>
Message-ID: <4768788D.7070205@gmx.net>

Scott Ritchie schrieb:
> 
> Ugh....this means that 4.2 for Ubuntu might NOT actually work, and that
> this is why System Shock 2 has been crashing at startup for me.

It usually didn't crash, just exits silently if the check fails, so this is 
probably another issue. Anyway all this affects only safedisc 2.x and google
says System Shock2 is safedisc 1.x. Which has it's own problems and doesn't
work currently at all (afaik).


From dmitry at codeweavers.com  Tue Dec 18 22:11:14 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Wed, 19 Dec 2007 12:11:14 +0800
Subject: ntoskrnl: Implement or add stubs for several functions.
References: <1198036585.11726.23.camel@cybertron>
Message-ID: <017601c841f5$3433c4a0$a600fea9@DMITRY>

"Chris Wulff" <crwulff at rochester.rr.com> wrote:

> NOTE: This is required for the  "hal: Stubs for ExAcquireFastMutex and
> ExReleaseFastMutex" patch to build. (it contains the fast mutex
> typedefs.) I apologize for submitting them out of order.

You need to send every API implementation as a separate self contained
patch, and avoid not necessary white space changes.

-- 
Dmitry.


From dank at kegel.com  Tue Dec 18 23:26:27 2007
From: dank at kegel.com (Dan Kegel)
Date: Tue, 18 Dec 2007 21:26:27 -0800
Subject: Interview with Alexandre on Lug Radio
Message-ID: <a71bd89a0712182126q7bd28c5ep7239f29a205ed30f@mail.gmail.com>

http://www.lugradio.org/episodes/90
"Alexandre Juillard from the Wine Project talks about
where Wine is, why it isn't finished, and what's coming next (2.02)"

In which we learn that Wine now has a release manager,
and that the plan is to release 1.0 for the 15th anniversary
of the project.

- Dan


From dank at kegel.com  Wed Dec 19 00:26:15 2007
From: dank at kegel.com (Dan Kegel)
Date: Tue, 18 Dec 2007 22:26:15 -0800
Subject: Early wine history
Message-ID: <a71bd89a0712182226t1bc13a15i8912327263911be0@mail.gmail.com>

winehq.org doesn't seem to have a link to the message
that launched the wine project, so I went looking.

The first message I found contemplating it was dated 1 Jun 1993,
http://groups.google.com/group/comp.os.linux/msg/0a7c3867abdb4a76
Is that about the right estimate for Wine's birthday?

A roughly 1995 writeup about Wine is at
http://www.softlookup.com/tutorial/redhat/rhl58.asp
It has a screen shot of a game Pipe Dream running under
Wine.  I just checked; the game is still online at
http://members.chello.at/theodor.lauppert/games/pipe1.htm
and runs well on today's wine :-)


From andrewriedi at gmail.com  Wed Dec 19 01:18:38 2007
From: andrewriedi at gmail.com (Andrew Riedi)
Date: Tue, 18 Dec 2007 23:18:38 -0800
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <4768788D.7070205@gmx.net>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>
	<4767EA9F.2030109@gmx.net>
	<78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com>
	<47681D77.8080007@gmx.net>
	<530468570712181153x55cc68f8uc5898dd07895952a@mail.gmail.com>
	<476871C0.9050102@open-vote.org> <4768788D.7070205@gmx.net>
Message-ID: <689de9370712182318s1c2b6a70ob9b32f244dec3821@mail.gmail.com>

I have sent in a new patch with the same title to address the problems
discussed in this thread.  Thanks to all of the people who looked over my
patch and discussed its possible problems.  It should surely help debugging
Wine in the future, especially if we decide to take advantage of the
http://wiki.winehq.org/GccVersions page.

-- 
Andrew Riedi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20071218/6face9df/attachment.htm 

From kubrick at fgv6.net  Wed Dec 19 03:10:43 2007
From: kubrick at fgv6.net (kubrick at fgv6.net)
Date: Wed, 19 Dec 2007 10:10:43 +0100 (CET)
Subject: [Fwd: Re: About the WWN]
Message-ID: <19543.195.6.79.173.1198055443.squirrel@www.fgv6.net>

Hello.

As indicated by Zachary, I post the suggestion I made him on the wine-devel list.
The suggestion was : "what do you think about writing in the WWN an article about what did the last changes of the last release
brought? I mean, knowing that there is "a ton of rpcrt4 fixes" or "New Bidi text implementation that doesn't depend on libicu"
is really great, but from a user point of view it doesn't mean anything. It would be great if you'd explain us the problems it
solves and which opportunities it gives."
What he replies is that he need your help !

Thanks.

Fran?ois.

------------------------------------------------------- Original Message -------------------------------------------------------
Subject: Re: About the WWN
From:    "Zachary Goldberg" <zgold at bluesata.com>
Date:    Tue, December 18, 2007 19:50
To:      Fran?ois Guerraz <kubrick at fgv6.net>
--------------------------------------------------------------------------------------------------------------------------------

Francois,

If you could do me a favor of suggesting your second point on the
wine-devel mailing list then we could start a discussion for it.  I
think it would be a good idea; however It would require perhaps a bit
more detail being made in the commit comments to WINE so that I can go
through them and put together the real changes.

--Zach

On Dec 18, 2007 1:47 PM, Fran?ois Guerraz <kubrick at fgv6.net> wrote:
>  Hello.
>
> First of all : thank you so much for being the new author of the WWN. I am a
> fervent reader and I was really upset that it was almost never written. I
> hope you'll find this task interesting and that you won't be fed up with it
> too quick :)
> Second I have a suggestion to make : what do you think about writing in the
> WWN an article about what did the last changes of the last release brought?
> I mean, knowing that there is "a ton of rpcrt4 fixes" or "New Bidi text
> implementation that doesn't depend on libicu" is really great, but from a
> user point of view it doesn't mean anything. It would be great if you'd
> explain us the problems it solves and which opportunities it gives.
>
> Thank you for your time and implication.
>
> Regards,
>
>
> Fran?ois Guerraz
> kubrick at fgv6.net
>
>
>
>



-- 
Zachary Goldberg
Computer Science & Engineering
Electrical Captain of Penn Electric Race Team
School of Engineering at the University of Pennsylvania




From r.kalbermatter at hccnet.nl  Wed Dec 19 05:42:02 2007
From: r.kalbermatter at hccnet.nl (Rolf Kalbermatter)
Date: Wed, 19 Dec 2007 12:42:02 +0100
Subject: [PATCH] Implement BindIoCompletionCallback
Message-ID: <006901c84234$2c4178c0$4001a8c0@NATERS>

Andrey Turkin wrote:

>diff --git a/dlls/kernel32/tests/sync.c b/dlls/kernel32/tests/sync.c
>index e402fed..7bbb3e2 100644
>--- a/dlls/kernel32/tests/sync.c
>+++ b/dlls/kernel32/tests/sync.c
>@@ -327,7 +327,7 @@ static void test_iocp_callback(void)
>     retb = p_BindIoCompletionCallback(hFile, iocp_callback, 0);
>     ok(retb == FALSE, "BindIoCompletionCallback succeeded on a file that
wasn't created with FILE_FLAG_OVERLAPPED\n");
>     if(retb == FALSE && GetLastError() == ERROR_CALL_NOT_IMPLEMENTED) {
>-        todo_wine ok (0, "BindIoCompletionCallback returned
ERROR_CALL_NOT_IMPLEMENTED\n");
>+        ok (0, "BindIoCompletionCallback returned
ERROR_CALL_NOT_IMPLEMENTED\n");
>         return;
>     }

I don't think this check makes much sense after the change anymore. It's at
best a skip() for older Windows versions.

Rolf Kalbermatter



From julliard at winehq.org  Wed Dec 19 06:04:37 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 19 Dec 2007 13:04:37 +0100
Subject: [msiexec] A nicer icon
In-Reply-To: <379381.95708.qm@web25806.mail.ukl.yahoo.com> (=?utf-8?Q?=22H?=
	=?utf-8?Q?erv=C3=BFffffe=22's?=
	message of "Wed, 19 Dec 2007 08:36:08 +0000 (GMT)")
References: <379381.95708.qm@web25806.mail.ukl.yahoo.com>
Message-ID: <873atyzy96.fsf@wine.dyndns.org>

Herv?ffffe9 Chanal <chanal_herve at yahoo.fr> writes:

> Hello,
>
> It's a larger nicer icon for msiexec with the svg source.

Having icons in .svg format is a nice improvement, but we'll need a tool
to build the .ico from the .svg. We also need to include multiple sizes
in the .ico, most places want a 32x32 icon, and scaling down the 48x48
looks bad. Of course we should also look into taking advantage of the
larger size where that's possible without breaking compatibility.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Wed Dec 19 06:20:16 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 19 Dec 2007 13:20:16 +0100
Subject: [PATCH 2/3] qmgr: AddRef, QueryInterface,
	and stub functions for queue manager interface.
In-Reply-To: <20071217224026.GA31617@knuth.cs.hmc.edu> (Roy Shea's message of
	"Mon, 17 Dec 2007 14:40:27 -0800")
References: <20071217224026.GA31617@knuth.cs.hmc.edu>
Message-ID: <87y7bqyiyn.fsf@wine.dyndns.org>

Roy Shea <roy at cs.hmc.edu> writes:

> +static ULONG WINAPI BITS_IBackgroundCopyManager_AddRef(
> +        IBackgroundCopyManager* iface)
> +{
> +    ICOM_THIS_MULTI(BackgroundCopyManagerImpl, lpVtbl, iface);

There's no reason to use ICOM_THIS_MULTI with a single vtbl.

> +    if (This == NULL)
> +    {
> +        return E_POINTER;
> +    }

Checking This for NULL is a waste of time.

-- 
Alexandre Julliard
julliard at winehq.org


From rob at codeweavers.com  Wed Dec 19 09:00:26 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Wed, 19 Dec 2007 15:00:26 +0000
Subject: [PATCH] Implement BindIoCompletionCallback
In-Reply-To: <4768324D.9000207@gmail.com>
References: <476827B3.1060006@gmail.com> <47682FC2.5020403@codeweavers.com>
	<4768324D.9000207@gmail.com>
Message-ID: <4769320A.2000609@codeweavers.com>

Andrey Turkin wrote:
> Robert Shearman wrote:
>   
>> Andrey Turkin wrote:
>>     
>>>  /******************************************************************************
>>>
>>>   *        BindIoCompletionCallback (KERNEL32.@)
>>>   */
>>> +extern NTSTATUS WINAPI
>>> RtlSetIoCompletionCallback(HANDLE,LPOVERLAPPED_COMPLETION_ROUTINE,ULONG);
>>>
>>>   
>>>       
>> This should go in winternl.h.
>>     
> winternl.h may not depend on winbase.h for some reason, so this would
> mean either changing prototype to "(HANDLE,LPVOID,ULONG)", which seems
> wrong, or redefining LPOVERLAPPED_COMPLETION_ROUTINE and
> OVERLAPPED/LPOVERLAPPED, which seems to be too much duplication.
>   

I think you should guard the function with an #ifdef __WINE_WINBASE_H 
statement, but I would wait for some other developers to chime in to get 
a consensus before accepting this though.

-- 
Rob Shearman



From julliard at winehq.org  Wed Dec 19 09:56:30 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 19 Dec 2007 16:56:30 +0100
Subject: [PATCH] Implement BindIoCompletionCallback
In-Reply-To: <4769320A.2000609@codeweavers.com> (Robert Shearman's message of
	"Wed, 19 Dec 2007 15:00:26 +0000")
References: <476827B3.1060006@gmail.com> <47682FC2.5020403@codeweavers.com>
	<4768324D.9000207@gmail.com> <4769320A.2000609@codeweavers.com>
Message-ID: <87tzmey8y9.fsf@wine.dyndns.org>

Robert Shearman <rob at codeweavers.com> writes:

> Andrey Turkin wrote:
>> Robert Shearman wrote:
>>   
>>> Andrey Turkin wrote:
>>>     
>>>>  /******************************************************************************
>>>>
>>>>   *        BindIoCompletionCallback (KERNEL32.@)
>>>>   */
>>>> +extern NTSTATUS WINAPI
>>>> RtlSetIoCompletionCallback(HANDLE,LPOVERLAPPED_COMPLETION_ROUTINE,ULONG);
>>>>
>>>>   
>>>>       
>>> This should go in winternl.h.
>>>     
>> winternl.h may not depend on winbase.h for some reason, so this would
>> mean either changing prototype to "(HANDLE,LPVOID,ULONG)", which seems
>> wrong, or redefining LPOVERLAPPED_COMPLETION_ROUTINE and
>> OVERLAPPED/LPOVERLAPPED, which seems to be too much duplication.
>>   
>
> I think you should guard the function with an #ifdef __WINE_WINBASE_H 
> statement, but I would wait for some other developers to chime in to get 
> a consensus before accepting this though.

It doesn't seem right for an ntdll function to use an OVERLAPPED
pointer. Shouldn't it take an IO_STATUS_BLOCK instead?

-- 
Alexandre Julliard
julliard at winehq.org


From kris at pcbsd.com  Tue Dec 18 14:05:57 2007
From: kris at pcbsd.com (Kris Moore)
Date: Tue, 18 Dec 2007 15:05:57 -0500
Subject: Patch for process title on FreeBSD
In-Reply-To: <873au6sw5y.fsf@wine.dyndns.org>
References: <47601F6F.1010504@pcbsd.com> <873au6sw5y.fsf@wine.dyndns.org>
Message-ID: <47682825.8010105@pcbsd.com>



How exactly would you like that done? I'm not much of a C programmer, I 
live more in the C++ / Shell world :)



-- 

Kris Moore
PC-BSD Software
http://www.pcbsd.com


Alexandre Julliard wrote:
> Kris Moore <kris at pcbsd.com> writes:
> 
>> --- dlls/kernel32/process.c.orig	2007-12-12 12:34:45.000000000 -0500
>> +++ dlls/kernel32/process.c	2007-12-12 12:35:17.000000000 -0500
>> @@ -853,6 +853,11 @@
>>   */
>>  static void set_process_name( int argc, char *argv[] )
>>  {
>> +
>> +#if defined(__FreeBSD__)
>> +    setproctitle("-%s", argv[1]);
>> +#endif
> 
> You should add a configure check for this function, instead of checking
> for __FreeBSD__.
> 


From maarten at codeweavers.com  Wed Dec 19 10:56:53 2007
From: maarten at codeweavers.com (Maarten Lankhorst)
Date: Wed, 19 Dec 2007 17:56:53 +0100
Subject: Patch for process title on FreeBSD
In-Reply-To: <47682825.8010105@pcbsd.com>
References: <47601F6F.1010504@pcbsd.com> <873au6sw5y.fsf@wine.dyndns.org>
	<47682825.8010105@pcbsd.com>
Message-ID: <47694D55.5040808@codeweavers.com>

Hi Kris,

Kris Moore schreef:
> How exactly would you like that done? I'm not much of a C programmer, I 
> live more in the C++ / Shell world :)
>   
With autoconf of course (configure.ac).

Cheers,
Maarten.



From austinenglish at gmail.com  Wed Dec 19 11:02:06 2007
From: austinenglish at gmail.com (Austin English)
Date: Wed, 19 Dec 2007 11:02:06 -0600
Subject: Early wine history
In-Reply-To: <a71bd89a0712182226t1bc13a15i8912327263911be0@mail.gmail.com>
References: <a71bd89a0712182226t1bc13a15i8912327263911be0@mail.gmail.com>
Message-ID: <b6bb06270712190902j3ec30d75pe4f03b124347984d@mail.gmail.com>

I found this announcement from Bob Amstadt announcing the mailing
list, this was dated September 16, 1993:
http://groups.google.com/group/comp.windows.x.i386unix/browse_thread/thread/ee272fa922314342/a08260429f730cdf

But according to this status report, it was started in early June 1993:
http://groups.google.com/group/comp.windows.x.i386unix/browse_thread/thread/88fbd87c0ae2e48f/5003eb8ed33ae522

Which makes your June 1, 1993 date sound about right :-). Looking a
bit further in that discussion, you can see Eric making a call for
volunteers the next day:
http://groups.google.com/group/comp.os.linux/msg/106b5f2702b1c53d

-Austin


On Dec 19, 2007 12:26 AM, Dan Kegel <dank at kegel.com> wrote:
> winehq.org doesn't seem to have a link to the message
> that launched the wine project, so I went looking.
>
> The first message I found contemplating it was dated 1 Jun 1993,
> http://groups.google.com/group/comp.os.linux/msg/0a7c3867abdb4a76
> Is that about the right estimate for Wine's birthday?
>
> A roughly 1995 writeup about Wine is at
> http://www.softlookup.com/tutorial/redhat/rhl58.asp
> It has a screen shot of a game Pipe Dream running under
> Wine.  I just checked; the game is still online at
> http://members.chello.at/theodor.lauppert/games/pipe1.htm
> and runs well on today's wine :-)
>
>
>


From andrey.turkin at gmail.com  Wed Dec 19 11:36:52 2007
From: andrey.turkin at gmail.com (Andrey Turkin)
Date: Wed, 19 Dec 2007 20:36:52 +0300
Subject: [PATCH] Implement BindIoCompletionCallback
In-Reply-To: <87tzmey8y9.fsf@wine.dyndns.org>
References: <476827B3.1060006@gmail.com>
	<47682FC2.5020403@codeweavers.com>	<4768324D.9000207@gmail.com>
	<4769320A.2000609@codeweavers.com> <87tzmey8y9.fsf@wine.dyndns.org>
Message-ID: <476956B4.4010303@gmail.com>

Alexandre Julliard wrote:
> Robert Shearman <rob at codeweavers.com> writes:
>
>   
>> Andrey Turkin wrote:
>>     
>>> Robert Shearman wrote:
>>>   
>>>       
>>>> Andrey Turkin wrote:
>>>>     
>>>>         
>>>>>  /******************************************************************************
>>>>>
>>>>>   *        BindIoCompletionCallback (KERNEL32.@)
>>>>>   */
>>>>> +extern NTSTATUS WINAPI
>>>>> RtlSetIoCompletionCallback(HANDLE,LPOVERLAPPED_COMPLETION_ROUTINE,ULONG);
>>>>>
>>>>>   
>>>>>       
>>>>>           
>>>> This should go in winternl.h.
>>>>     
>>>>         
>>> winternl.h may not depend on winbase.h for some reason, so this would
>>> mean either changing prototype to "(HANDLE,LPVOID,ULONG)", which seems
>>> wrong, or redefining LPOVERLAPPED_COMPLETION_ROUTINE and
>>> OVERLAPPED/LPOVERLAPPED, which seems to be too much duplication.
>>>   
>>>       
>> I think you should guard the function with an #ifdef __WINE_WINBASE_H 
>> statement, but I would wait for some other developers to chime in to get 
>> a consensus before accepting this though.
>>     
>
> It doesn't seem right for an ntdll function to use an OVERLAPPED
> pointer. Shouldn't it take an IO_STATUS_BLOCK instead?
>
>   

It is not used in the function itself, it is only passed to
user-provided callback. So, I see several possibilities:
1) change RtlSetIoCompletionCallback to use another callback prototype,
with LPVOID or ULONG_PTR or something instead of LPOVERLAPPED
2) leave callback prototype as in BindIoCompletionCallback, and protect
RtlSetIoCompletionCallback with #ifdefs as Robert suggested
3) do not implement RtlSetIoCompletionCallback at all and move all code
in kernel32

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20071219/873fcc6e/attachment.htm 

From dank at kegel.com  Wed Dec 19 12:08:51 2007
From: dank at kegel.com (Dan Kegel)
Date: Wed, 19 Dec 2007 10:08:51 -0800
Subject: Piddly little erratic valgrind warning in ole32_moniker
Message-ID: <a71bd89a0712191008s2479f81bhc773ca2de4f0b99c@mail.gmail.com>

Nothing really new yesterday or today.

This one's annoying:

http://kegel.com/wine/valgrind/logs-2007-12-19/vg-ole32_moniker-diff.txt
+ Syscall param write(buf) points to uninitialised byte(s)
+    at  (within /lib/ld-2.5.so)
+    by  WriteFile (file.c:512)
+    by  RPCSS_BecomePipeServer (np_server.c:379)
+    by  main (rpcss_main.c:101)

because it keeps looking like it's new every other day

$ grep RPCSS_BecomePipeServer logs-*/vg-ole32_mon*diff.txt
logs-2007-12-06/vg-ole32_moniker-diff.txt:+    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-06/vg-ole32_moniker-diff.txt:+   fun:RPCSS_BecomePipeServer
logs-2007-12-06/vg-ole32_moniker-diff.txt:-    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-06/vg-ole32_moniker-diff.txt:-   fun:RPCSS_BecomePipeServer
logs-2007-12-07/vg-ole32_moniker-diff.txt:    fun:RPCSS_BecomePipeServer
logs-2007-12-08/vg-ole32_moniker-diff.txt:+    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-08/vg-ole32_moniker-diff.txt:+   fun:RPCSS_BecomePipeServer
logs-2007-12-08/vg-ole32_moniker-diff.txt:-    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-08/vg-ole32_moniker-diff.txt:-   fun:RPCSS_BecomePipeServer
logs-2007-12-10/vg-ole32_moniker-diff.txt:-    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-10/vg-ole32_moniker-diff.txt:-   fun:RPCSS_BecomePipeServer
logs-2007-12-10/vg-ole32_moniker-diff.txt:+    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-10/vg-ole32_moniker-diff.txt:+   fun:RPCSS_BecomePipeServer
logs-2007-12-12/vg-ole32_moniker-diff.txt:+    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-12/vg-ole32_moniker-diff.txt:+   fun:RPCSS_BecomePipeServer
logs-2007-12-12/vg-ole32_moniker-diff.txt:-    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-12/vg-ole32_moniker-diff.txt:-   fun:RPCSS_BecomePipeServer
logs-2007-12-13/vg-ole32_moniker-diff.txt:-    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-13/vg-ole32_moniker-diff.txt:-   fun:RPCSS_BecomePipeServer
logs-2007-12-14/vg-ole32_moniker-diff.txt:+    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-14/vg-ole32_moniker-diff.txt:+   fun:RPCSS_BecomePipeServer
logs-2007-12-17/vg-ole32_moniker-diff.txt:-    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-17/vg-ole32_moniker-diff.txt:-   fun:RPCSS_BecomePipeServer
logs-2007-12-17/vg-ole32_moniker-diff.txt:+    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-17/vg-ole32_moniker-diff.txt:+   fun:RPCSS_BecomePipeServer
logs-2007-12-18/vg-ole32_moniker-diff.txt:-    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-18/vg-ole32_moniker-diff.txt:-   fun:RPCSS_BecomePipeServer
logs-2007-12-19/vg-ole32_moniker-diff.txt:+    by
RPCSS_BecomePipeServer (np_server.c:379)
logs-2007-12-19/vg-ole32_moniker-diff.txt:+   fun:RPCSS_BecomePipeServer


From julliard at winehq.org  Wed Dec 19 12:58:01 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 19 Dec 2007 19:58:01 +0100
Subject: Early wine history
In-Reply-To: <a71bd89a0712182226t1bc13a15i8912327263911be0@mail.gmail.com>
	(Dan Kegel's message of "Tue, 18 Dec 2007 22:26:15 -0800")
References: <a71bd89a0712182226t1bc13a15i8912327263911be0@mail.gmail.com>
Message-ID: <87mys6y0jq.fsf@wine.dyndns.org>

"Dan Kegel" <dank at kegel.com> writes:

> The first message I found contemplating it was dated 1 Jun 1993,
> http://groups.google.com/group/comp.os.linux/msg/0a7c3867abdb4a76
> Is that about the right estimate for Wine's birthday?

The 0.0.2 release was on June 29, and 0.0.1 was about a week before
that IIRC. I don't have the exact date unfortunately.

> A roughly 1995 writeup about Wine is at
> http://www.softlookup.com/tutorial/redhat/rhl58.asp
> It has a screen shot of a game Pipe Dream running under
> Wine.  I just checked; the game is still online at
> http://members.chello.at/theodor.lauppert/games/pipe1.htm
> and runs well on today's wine :-)

Hehe, I remember spending lots of time playing, I mean testing that
game...

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Wed Dec 19 13:01:34 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 19 Dec 2007 20:01:34 +0100
Subject: [PATCH] Implement BindIoCompletionCallback
In-Reply-To: <476956B4.4010303@gmail.com> (Andrey Turkin's message of "Wed, 19
	Dec 2007 20:36:52 +0300")
References: <476827B3.1060006@gmail.com> <47682FC2.5020403@codeweavers.com>
	<4768324D.9000207@gmail.com> <4769320A.2000609@codeweavers.com>
	<87tzmey8y9.fsf@wine.dyndns.org> <476956B4.4010303@gmail.com>
Message-ID: <87ir2uy0dt.fsf@wine.dyndns.org>

Andrey Turkin <andrey.turkin at gmail.com> writes:

> It is not used in the function itself, it is only passed to
> user-provided callback. So, I see several possibilities:

I know it's in the callback, what I meant is that the ntdll function
should not be taking a LPOVERLAPPED_COMPLETION_ROUTINE, which is a
kernel32 thing, it should be taking some sort of IO_COMPLETION_CALLBACK
routine, that uses an IO_STATUS_BLOCK (or probably better a void*, since
it's opaque) instead of an OVERLAPPED pointer.

-- 
Alexandre Julliard
julliard at winehq.org


From bridd at bridd.com  Wed Dec 19 13:12:53 2007
From: bridd at bridd.com (bridd)
Date: Wed, 19 Dec 2007 19:12:53 +0000
Subject: dll to .so wrapper
In-Reply-To: <87ir2uy0dt.fsf@wine.dyndns.org>
References: <476827B3.1060006@gmail.com> <47682FC2.5020403@codeweavers.com>
	<4768324D.9000207@gmail.com> <4769320A.2000609@codeweavers.com>
	<87tzmey8y9.fsf@wine.dyndns.org> <476956B4.4010303@gmail.com>
	<87ir2uy0dt.fsf@wine.dyndns.org>
Message-ID: <1198091573.6283.1.camel@nebba.config>

Hi there,

I've got a bit of a specific task, that I don't know if it's achievable
via wine in some way or not.  I'd like to make a windows dll available
to linux programs as a .so file.

The dll itself is a video plugin (freeframe.sourceforge.net).  These are
available commercially to buy, and I'd like to be able to use them in a
linux application that supports the plugin format for native linux
compiled plugins, without having to request linux native versions from
the commercial developers.

I've been doing some searching, and have found a few mails on this list
about this sort of thing in the past, but haven't been able to find a
conclusive method.

I guess that this might be possible via some sort of wrapper that maps
the inputs/outputs to the dll .  Does anyone know if there is anything
that runs like this already out there that I could take a look at as an
example piece of code to hack about with?

Cheers

Dave



From frank.richter at gmail.com  Wed Dec 19 13:14:24 2007
From: frank.richter at gmail.com (Frank Richter)
Date: Wed, 19 Dec 2007 20:14:24 +0100
Subject: [msiexec] A nicer icon
In-Reply-To: <873atyzy96.fsf@wine.dyndns.org>
References: <379381.95708.qm@web25806.mail.ukl.yahoo.com>
	<873atyzy96.fsf@wine.dyndns.org>
Message-ID: <47696D90.8090606@gmail.com>

On 19.12.2007 13:04, Alexandre Julliard wrote:
> Having icons in .svg format is a nice improvement, but we'll need a tool
> to build the .ico from the .svg. We also need to include multiple sizes
> in the .ico, most places want a 32x32 icon, and scaling down the 48x48
> looks bad. Of course we should also look into taking advantage of the
> larger size where that's possible without breaking compatibility.

I've created a system to produce Win32 .icos from SVGs for another
project[1]. I used rsvg to convert svg->png, imagemagick's convert to
reduce color depths and finally icotool[2] to assemble the Win32 icon.

-f.r.

[1]
http://trac.crystalspace3d.org/trac/CS/browser/CS/trunk/mk/jam/icons.jam
- it's for the Jam build system, but at least you can see the commands
used (the stuff in 'actions').
[2] Part of icoutils: http://www.nongnu.org/icoutils/



From twickline at gmail.com  Wed Dec 19 14:08:41 2007
From: twickline at gmail.com (Tom Wickline)
Date: Wed, 19 Dec 2007 15:08:41 -0500
Subject: Early wine history
In-Reply-To: <87mys6y0jq.fsf@wine.dyndns.org>
References: <a71bd89a0712182226t1bc13a15i8912327263911be0@mail.gmail.com>
	<87mys6y0jq.fsf@wine.dyndns.org>
Message-ID: <53e3a9930712191208y18ff8cf5pf5c83d43c7714fec@mail.gmail.com>

I have a copy of iX Magazine (  http://www.heise.de/ix/ ) from
July 1994 that has a four page write up about Wine. There is also
a full page interview, Q&A with Bob Amstadt.

Pages 122 to 127

Tom


From maarten at codeweavers.com  Wed Dec 19 15:26:38 2007
From: maarten at codeweavers.com (Maarten Lankhorst)
Date: Wed, 19 Dec 2007 22:26:38 +0100
Subject: dll to .so wrapper
In-Reply-To: <1198091573.6283.1.camel@nebba.config>
References: <476827B3.1060006@gmail.com>
	<47682FC2.5020403@codeweavers.com>	<4768324D.9000207@gmail.com>
	<4769320A.2000609@codeweavers.com>	<87tzmey8y9.fsf@wine.dyndns.org>
	<476956B4.4010303@gmail.com>	<87ir2uy0dt.fsf@wine.dyndns.org>
	<1198091573.6283.1.camel@nebba.config>
Message-ID: <47698C8E.8050605@codeweavers.com>

Hi bridd,

bridd schreef:
> Hi there,
>
> I've got a bit of a specific task, that I don't know if it's achievable
> via wine in some way or not.  I'd like to make a windows dll available
> to linux programs as a .so file.
>
> The dll itself is a video plugin (freeframe.sourceforge.net).  These are
> available commercially to buy, and I'd like to be able to use them in a
> linux application that supports the plugin format for native linux
> compiled plugins, without having to request linux native versions from
> the commercial developers.
>
> I've been doing some searching, and have found a few mails on this list
> about this sort of thing in the past, but haven't been able to find a
> conclusive method.
>
> I guess that this might be possible via some sort of wrapper that maps
> the inputs/outputs to the dll .  Does anyone know if there is anything
> that runs like this already out there that I could take a look at as an
> example piece of code to hack about with?
>   
This topic comes up from time to time, usually with mild variations. The
problem is that wine sets up its own environment and memory layout. In
the end you will need a .exe (or winelib binary) that uses wine, and a
socket/pipe/shm function to communicate with the .so, there is no easy
way to just  dynamically load a dll in an existing program.

Cheers,
Maarten.



From marcus at jet.franken.de  Wed Dec 19 16:06:37 2007
From: marcus at jet.franken.de (Marcus Meissner)
Date: Wed, 19 Dec 2007 23:06:37 +0100
Subject: dll to .so wrapper
In-Reply-To: <47698C8E.8050605@codeweavers.com>
References: <476827B3.1060006@gmail.com> <47682FC2.5020403@codeweavers.com>
	<4768324D.9000207@gmail.com> <4769320A.2000609@codeweavers.com>
	<87tzmey8y9.fsf@wine.dyndns.org> <476956B4.4010303@gmail.com>
	<87ir2uy0dt.fsf@wine.dyndns.org>
	<1198091573.6283.1.camel@nebba.config>
	<47698C8E.8050605@codeweavers.com>
Message-ID: <20071219220637.GA4133@jet.franken.de>

On Wed, Dec 19, 2007 at 10:26:38PM +0100, Maarten Lankhorst wrote:
> Hi bridd,
> 
> bridd schreef:
> > Hi there,
> >
> > I've got a bit of a specific task, that I don't know if it's achievable
> > via wine in some way or not.  I'd like to make a windows dll available
> > to linux programs as a .so file.
> >
> > The dll itself is a video plugin (freeframe.sourceforge.net).  These are
> > available commercially to buy, and I'd like to be able to use them in a
> > linux application that supports the plugin format for native linux
> > compiled plugins, without having to request linux native versions from
> > the commercial developers.
> >
> > I've been doing some searching, and have found a few mails on this list
> > about this sort of thing in the past, but haven't been able to find a
> > conclusive method.

Yes, it is called "MPlayer", which has a rudimentary WIne derived
Codec loading and executing framework.

You are perhaps easier off using it ;)

Ciao, Marcus


From bridd at bridd.com  Wed Dec 19 16:54:18 2007
From: bridd at bridd.com (bridd)
Date: Wed, 19 Dec 2007 22:54:18 +0000
Subject: dll to .so wrapper
In-Reply-To: <20071219220637.GA4133@jet.franken.de>
References: <476827B3.1060006@gmail.com> <47682FC2.5020403@codeweavers.com>
	<4768324D.9000207@gmail.com> <4769320A.2000609@codeweavers.com>
	<87tzmey8y9.fsf@wine.dyndns.org> <476956B4.4010303@gmail.com>
	<87ir2uy0dt.fsf@wine.dyndns.org> <1198091573.6283.1.camel@nebba.config>
	<47698C8E.8050605@codeweavers.com>
	<20071219220637.GA4133@jet.franken.de>
Message-ID: <1198104858.6283.9.camel@nebba.config>

On Wed, 2007-12-19 at 23:06 +0100, Marcus Meissner wrote:

> > > The dll itself is a video plugin (freeframe.sourceforge.net).  These are
> > > available commercially to buy, and I'd like to be able to use them in a
> > > linux application that supports the plugin format for native linux
> > > compiled plugins, without having to request linux native versions from
> > > the commercial developers.
> > >
> > > I've been doing some searching, and have found a few mails on this list
> > > about this sort of thing in the past, but haven't been able to find a
> > > conclusive method.
> 
> Yes, it is called "MPlayer", which has a rudimentary WIne derived
> Codec loading and executing framework.
> 
> You are perhaps easier off using it ;)

That kind-of misses my point though; freeframe is a plug-in format for
adding effects to a video input (usually used in live VJ applications).
As far as I know, MPlayer doesn't support it, nor would that enable
support in any linux VJ'ing software! :)

I was simply looking at the possibility of running freeframe plugins
compiled under windows, in linux using wine as the middle-layer.

Cheers

Dave



From bridd at bridd.com  Wed Dec 19 16:57:24 2007
From: bridd at bridd.com (bridd)
Date: Wed, 19 Dec 2007 22:57:24 +0000
Subject: dll to .so wrapper
In-Reply-To: <47698C8E.8050605@codeweavers.com>
References: <476827B3.1060006@gmail.com> <47682FC2.5020403@codeweavers.com>
	<4768324D.9000207@gmail.com> <4769320A.2000609@codeweavers.com>
	<87tzmey8y9.fsf@wine.dyndns.org> <476956B4.4010303@gmail.com>
	<87ir2uy0dt.fsf@wine.dyndns.org> <1198091573.6283.1.camel@nebba.config>
	<47698C8E.8050605@codeweavers.com>
Message-ID: <1198105044.6283.13.camel@nebba.config>


On Wed, 2007-12-19 at 22:26 +0100, Maarten Lankhorst wrote:

> This topic comes up from time to time, usually with mild variations. The
> problem is that wine sets up its own environment and memory layout. In
> the end you will need a .exe (or winelib binary) that uses wine, and a
> socket/pipe/shm function to communicate with the .so, there is no easy
> way to just  dynamically load a dll in an existing program.

I see, so it's sounding like to do this I'd need to have something more
akin to a VST host, that acts as an intermediatory and pumps the video
data from the linux application via a native plugin (.so), into a
winelib compiled program that executes the windows compiled plugin
(.dll) and the sends it back out again.

Probably beyond my skills right now, but thought it was worth seeing if
anyone had trodden a similar route already!

Thanks,

Dave



From p.beutner at gmx.net  Wed Dec 19 18:59:39 2007
From: p.beutner at gmx.net (Peter Beutner)
Date: Thu, 20 Dec 2007 01:59:39 +0100
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <47681D77.8080007@gmx.net>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>		<4767EA9F.2030109@gmx.net>	<78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com>
	<47681D77.8080007@gmx.net>
Message-ID: <4769BE7B.7010204@gmx.net>

Peter Beutner schrieb:
> John Klehm schrieb:
>> On Dec 18, 2007 9:43 AM, Peter Beutner <p.beutner at gmx.net> wrote:
>>
>>> As I recall this is not the only version that causes problems. Plus certain compiler
>>> flags have an influence as well. And as most distros ship gcc with a bunch
>>> of patches you probably can't even rely on the gcc version alone.
>>>
>>> Imo it would be better to collect the info on a wiki page.
>>>
>> Like this one?  http://wiki.winehq.org/GccVersions
> 
> ah, nice. didn't know about that one.
> 
>> Nothing wrong with having the info output reflect the knowledge
>> gathered on the wiki page.
> 
> So let's add to that info that gcc 4.2.2 (on gentoo) doesn't work.
> As well as recent 4.3-snapshots. (At least that was the status a few
> releases back, haven't tested in a while.)

just tested again with current git and it worked with every gcc version
I had at hand here: 4.2.2, 4.1.2, 4.0.4 and 3.4.6.


From stefandoesinger at gmx.at  Wed Dec 19 19:48:41 2007
From: stefandoesinger at gmx.at (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Thu, 20 Dec 2007 02:48:41 +0100
Subject: [patch 1/2,
	try 2] wined3d: rewrite IWineD3DSurfaceImpl_BltOverride colorfill
	codepath
Message-ID: <200712200248.41938.stefandoesinger@gmx.at>

Hi Alexander,

I had a look at your patches again, and another issue came to my mind: I am 
not sure how the scissor rectangle and viewport affects ColorFill blits. 
IDirect3DDevice::Clear is limited by the viewport, the scissor test and the 
rectangles passed in, but I think that this doesn't apply to ColorFills. If 
that is true, I think there isn't much point in having a common codepath, and 
we should just put the glClear() call into COLORFILL itself - Dealing with 
the differences of those two calls will be more effort than the code shared.

But I think we need a test for this. There is a clear() test in 
dlls/ddraw/tests/visual.c, but the d3d9 test tests a few more things. It 
should be possible to add a COLORFILL test to the visual.c clear test in 
ddraw as well, this will show if Windows honors the scissor and viewport in 
COLORFILL or not.

Yes, I know... Start fixing one bug, and you'll run into a lot more. Happens 
to me all the time as well :-)

Stefan


From dank at kegel.com  Wed Dec 19 20:47:43 2007
From: dank at kegel.com (Dan Kegel)
Date: Wed, 19 Dec 2007 18:47:43 -0800
Subject: Today's git won't hunt. Server crash, lots of other problems?
In-Reply-To: <a71bd89a0712181038l5cfbd7bdk7c6e238093876db7@mail.gmail.com>
References: <a71bd89a0712181038l5cfbd7bdk7c6e238093876db7@mail.gmail.com>
Message-ID: <a71bd89a0712191847h37c3e0ds44be9feb145d8189@mail.gmail.com>

On Dec 18, 2007 10:38 AM, Dan Kegel <dank at kegel.com> wrote:
> > My git won't install DNS9P any more, as of today's git.
> But it doesn't seem easy to repeat; I keep getting other errors now.
>
> Roy next to me says he ran into another regression, he's doing a bisect,

There were bunches of regressions, it seems, but
today's git plus the patches sent to wine-patches
by Rob and Maarten fix the DNS 9 problem.
Thanks, guys!
- Dan


From dmitry at codeweavers.com  Thu Dec 20 02:31:53 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Thu, 20 Dec 2007 16:31:53 +0800
Subject: The BS_GROUPBOX style should only be used if the
	HasBorderattribute is set
References: <22821af30712191301n704f8a77k7250d81b9e575463@mail.gmail.com>
Message-ID: <016601c842e2$c8b5f830$a600fea9@DMITRY>

"James Hawkins" <truiken at gmail.com> wrote:

> Changelog:
> * The BS_GROUPBOX style should only be used if the HasBorder attribute is set.

Alexandre, please don't apply this patch. I sent another patch that reverts
commit 96e4320feb22b3a2c9564de100c09990622edb59 which is the real source
of the problem.

Perhaps James' patch is going in the right direction when a group box should
really be displayed by a WM_DRAWITEM handler, or BS_GROUPBOX should be used
instead in that case. But that needs a test case.

-- 
Dmitry.


From hverbeet at gmail.com  Thu Dec 20 02:46:29 2007
From: hverbeet at gmail.com (H. Verbeet)
Date: Thu, 20 Dec 2007 09:46:29 +0100
Subject: [5/6] WineD3D: Move the GL info structure into the adapter
In-Reply-To: <200712200206.06524.stefan@codeweavers.com>
References: <200712200206.06524.stefan@codeweavers.com>
Message-ID: <d658b69e0712200046t6669c8dfpdef75b892b3d0aeb@mail.gmail.com>

On 20/12/2007, Stefan D?singer <stefan at codeweavers.com> wrote:
> +#define WINED3D_ATR_TYPE(type)          GLINFO_LOCATION.glTypeLookup[type].d3dType
> +#define WINED3D_ATR_SIZE(type)          GLINFO_LOCATION.glTypeLookup[type].size
> +#define WINED3D_ATR_GLTYPE(type)        GLINFO_LOCATION.glTypeLookup[type].glType
> +#define WINED3D_ATR_NORMALIZED(type)    GLINFO_LOCATION.glTypeLookup[type].normalized
> +#define WINED3D_ATR_TYPESIZE(type)      GLINFO_LOCATION.glTypeLookup[type].typesize

Unrelated to the actual patch, but I think it wouldn't hurt to get rid
of these macros. They're pretty much unnecessary.


From hverbeet at gmail.com  Thu Dec 20 03:02:27 2007
From: hverbeet at gmail.com (H. Verbeet)
Date: Thu, 20 Dec 2007 10:02:27 +0100
Subject: [patch 1/2,
	try 2] wined3d: rewrite IWineD3DSurfaceImpl_BltOverride colorfill
	codepath
In-Reply-To: <200712200248.41938.stefandoesinger@gmx.at>
References: <200712200248.41938.stefandoesinger@gmx.at>
Message-ID: <d658b69e0712200102o375f0d12u1e08fa151e77be7d@mail.gmail.com>

On 20/12/2007, Stefan D?singer <stefandoesinger at gmx.at> wrote:
> Hi Alexander,
>
> I had a look at your patches again, and another issue came to my mind: I am
> not sure how the scissor rectangle and viewport affects ColorFill blits.
> IDirect3DDevice::Clear is limited by the viewport, the scissor test and the
> rectangles passed in, but I think that this doesn't apply to ColorFills. If
> that is true, I think there isn't much point in having a common codepath, and
> we should just put the glClear() call into COLORFILL itself - Dealing with
> the differences of those two calls will be more effort than the code shared.
>
> But I think we need a test for this. There is a clear() test in
> dlls/ddraw/tests/visual.c, but the d3d9 test tests a few more things. It
> should be possible to add a COLORFILL test to the visual.c clear test in
> ddraw as well, this will show if Windows honors the scissor and viewport in
> COLORFILL or not.
>
> Yes, I know... Start fixing one bug, and you'll run into a lot more. Happens
> to me all the time as well :-)
>
> Stefan
>
Note that while IDirect3DDevice9 also has a ColorFill() method, it
uses either the ddraw implementation or the color_fill_fbo()
implementation. It's probably worth it to make sure that works as
well.


From rob at codeweavers.com  Thu Dec 20 03:39:53 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Thu, 20 Dec 2007 09:39:53 +0000
Subject: rpcrt4: Fix regression in NdrConformantStringUnmarshall by doing
	the memcpy check in safe_copy_from_buffer
In-Reply-To: <47699AA2.7070207@codeweavers.com>
References: <47699AA2.7070207@codeweavers.com>
Message-ID: <476A3869.1010505@codeweavers.com>

Maarten Lankhorst wrote:
> @@ -665,7 +665,8 @@ static inline void safe_copy_from_buffer(MIDL_STUB_MESSAGE *pStubMsg, void *p, U
>      if ((pStubMsg->Buffer + size < pStubMsg->Buffer) || /* integer overflow of pStubMsg->Buffer */
>          (pStubMsg->Buffer + size > pStubMsg->BufferEnd))
>          RpcRaiseException(RPC_X_BAD_STUB_DATA);
> -    memcpy(p, pStubMsg->Buffer, size);
> +    if (p != pStubMsg->Buffer)
> +        memcpy(p, pStubMsg->Buffer, size);
>      pStubMsg->Buffer += size;
>  }
>  
> @@ -890,8 +891,7 @@ unsigned char *WINAPI NdrConformantStringUnmarshall( PMIDL_STUB_MESSAGE pStubMsg
>        *ppMemory = NdrAllocate(pStubMsg, memsize);
>    }
>  
> -  if (*ppMemory != pStubMsg->Buffer)
> -    safe_copy_from_buffer(pStubMsg, *ppMemory, bufsize);
> +  safe_copy_from_buffer(pStubMsg, *ppMemory, bufsize);
>  
>    if (*pFormat == RPC_FC_C_CSTRING) {
>      TRACE("string=%s\n", debugstr_a((char*)*ppMemory));
>   

Good work in spotting and fixing the mistake I made, but I think I'd 
prefer to fix it by making the caller of safe_copy_from_buffer do the 
incrementing of the buffer. This is to avoid confusion with the name of 
the function and to avoid the possibility that the buffer is incremented 
twice.

-- 
Rob Shearman



From maarten at codeweavers.com  Thu Dec 20 04:42:50 2007
From: maarten at codeweavers.com (Maarten Lankhorst)
Date: Thu, 20 Dec 2007 11:42:50 +0100
Subject: rpcrt4: Fix regression in NdrConformantStringUnmarshall by doing
	the memcpy check in safe_copy_from_buffer
In-Reply-To: <476A3869.1010505@codeweavers.com>
References: <47699AA2.7070207@codeweavers.com>
	<476A3869.1010505@codeweavers.com>
Message-ID: <476A472A.10205@codeweavers.com>

Hi Rob,

Robert Shearman schreef:
> Maarten Lankhorst wrote:
>> @@ -665,7 +665,8 @@ static inline void
>> safe_copy_from_buffer(MIDL_STUB_MESSAGE *pStubMsg, void *p, U
>>      if ((pStubMsg->Buffer + size < pStubMsg->Buffer) || /* integer
>> overflow of pStubMsg->Buffer */
>>          (pStubMsg->Buffer + size > pStubMsg->BufferEnd))
>>          RpcRaiseException(RPC_X_BAD_STUB_DATA);
>> -    memcpy(p, pStubMsg->Buffer, size);
>> +    if (p != pStubMsg->Buffer)
>> +        memcpy(p, pStubMsg->Buffer, size);
>>      pStubMsg->Buffer += size;
>>  }
>>  
>> @@ -890,8 +891,7 @@ unsigned char *WINAPI
>> NdrConformantStringUnmarshall( PMIDL_STUB_MESSAGE pStubMsg
>>        *ppMemory = NdrAllocate(pStubMsg, memsize);
>>    }
>>  
>> -  if (*ppMemory != pStubMsg->Buffer)
>> -    safe_copy_from_buffer(pStubMsg, *ppMemory, bufsize);
>> +  safe_copy_from_buffer(pStubMsg, *ppMemory, bufsize);
>>  
>>    if (*pFormat == RPC_FC_C_CSTRING) {
>>      TRACE("string=%s\n", debugstr_a((char*)*ppMemory));
>>   
> Good work in spotting and fixing the mistake I made, but I think I'd
> prefer to fix it by making the caller of safe_copy_from_buffer do the
> incrementing of the buffer. This is to avoid confusion with the name
> of the function and to avoid the possibility that the buffer is
> incremented twice.
If you want to remove that, you might as well remove that whole inline,
since even when the two areas are equal the check that needs to be
performed at overflowing still needs to be done even if the areas are
the same.
Maybe just call it safely_append_from_buffer instead?

Cheers,
Maarten.


From dmitry at codeweavers.com  Thu Dec 20 05:00:35 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Thu, 20 Dec 2007 19:00:35 +0800
Subject: msi: Revert commit 96e4320feb22b3a2c9564de100c09990622edb59
References: <E1J5Ggg-0001fg-8c@mail.codeweavers.com>
	<e5b662840712200239i6033b24cl858f31b91fad468a@mail.gmail.com>
Message-ID: <004101c842f7$8dd63440$a600fea9@DMITRY>

Hi Miko?aj,

"Miko?aj Zalewski" <mikolaj.zalewski at gmail.com> wrote:

>  As I wrote in
> http://www.winehq.org/pipermail/wine-patches/2007-October/045479.html the
> problem was in the Photoshop CS2 installer where the groupbox consumed mouse
> events. They didn't arrive to the edit box (which was created earlier) what
> caused it to appear to be disabled. I checked that in that installer the
> groupbox had the BS_GROUPBOX style. Maybe that depends on some flags?

James already sent a more correct patch.

-- 
Dmitry. 



From julliard at winehq.org  Thu Dec 20 05:32:03 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 20 Dec 2007 12:32:03 +0100
Subject: kernel32: invalidate local copy of console input event handle
	while reallocating console.
In-Reply-To: <200712200003.52927.lich@math.spbu.ru> (Kirill K. Smirnov's
	message of "Thu, 20 Dec 2007 00:03:52 +0300")
References: <200712200003.52927.lich@math.spbu.ru>
Message-ID: <878x3py53g.fsf@wine.dyndns.org>

"Kirill K. Smirnov" <lich at math.spbu.ru> writes:

> @@ -378,10 +381,7 @@ BOOL WINAPI CloseConsoleHandle(HANDLE handle)
>   */
>  HANDLE WINAPI GetConsoleInputWaitHandle(void)
>  {
> -    static HANDLE console_wait_event;
> - 
> -    /* FIXME: this is not thread safe */
> -    if (!console_wait_event)
> +    if (console_wait_event == INVALID_HANDLE_VALUE)

0 and INVALID_HANDLE_VALUE are not the same thing. The correct value to
use for invalid events is 0.

-- 
Alexandre Julliard
julliard at winehq.org


From rob at codeweavers.com  Thu Dec 20 05:35:50 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Thu, 20 Dec 2007 11:35:50 +0000
Subject: rpcrt4: Fix regression in NdrConformantStringUnmarshall by doing
	the memcpy check in safe_copy_from_buffer
In-Reply-To: <476A472A.10205@codeweavers.com>
References: <47699AA2.7070207@codeweavers.com>
	<476A3869.1010505@codeweavers.com> <476A472A.10205@codeweavers.com>
Message-ID: <476A5396.2080409@codeweavers.com>

Maarten Lankhorst wrote:
> Hi Rob,
>
> Robert Shearman schreef:
>   
>> Maarten Lankhorst wrote:
>>     
>>> @@ -665,7 +665,8 @@ static inline void
>>> safe_copy_from_buffer(MIDL_STUB_MESSAGE *pStubMsg, void *p, U
>>>      if ((pStubMsg->Buffer + size < pStubMsg->Buffer) || /* integer
>>> overflow of pStubMsg->Buffer */
>>>          (pStubMsg->Buffer + size > pStubMsg->BufferEnd))
>>>          RpcRaiseException(RPC_X_BAD_STUB_DATA);
>>> -    memcpy(p, pStubMsg->Buffer, size);
>>> +    if (p != pStubMsg->Buffer)
>>> +        memcpy(p, pStubMsg->Buffer, size);
>>>      pStubMsg->Buffer += size;
>>>  }
>>>  
>>>       
>> Good work in spotting and fixing the mistake I made, but I think I'd
>> prefer to fix it by making the caller of safe_copy_from_buffer do the
>> incrementing of the buffer. This is to avoid confusion with the name
>> of the function and to avoid the possibility that the buffer is
>> incremented twice.
>>     
> If you want to remove that, you might as well remove that whole inline,
> since even when the two areas are equal the check that needs to be
> performed at overflowing still needs to be done even if the areas are
> the same.
>   

That's what safe_buffer_increment does.

-- 
Rob Shearman



From dmitry at codeweavers.com  Thu Dec 20 06:28:32 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Thu, 20 Dec 2007 20:28:32 +0800
Subject: try2:winefile:Save font settings for registry
References: <200712201515.32502.ivan@etersoft.ru>
Message-ID: <00b001c84303$d80ccea0$a600fea9@DMITRY>

"Ivan Sinitsin" <ivan at etersoft.ru> wrote:

> + if( RegQueryValueExW( hKey, reg_logfont, NULL, &type,
> +                              (LPBYTE) &logfont, &size ) != ERROR_SUCCESS ) {
> +  hFont=GetStockObject(DEFAULT_GUI_FONT);
> +  GetObject(hFont,sizeof(logfont),&logfont);
> +        }

There is no need to introduce the hFont variable.

> + GetObject(Globals.hfont, sizeof(logfont), &logfont);

To make the code more readable this call should be moved where logfont
is actually used.
 
> +        RegSetValueExW( hKey, reg_logfont, 0, REG_DWORD,
> +                        (LPBYTE) &logfont, sizeof(LOGFONT) );

The type should be set to REG_BINARY.

-- 
Dmitry.


From ivan at etersoft.ru  Thu Dec 20 06:57:15 2007
From: ivan at etersoft.ru (Ivan Sinitsin)
Date: Thu, 20 Dec 2007 15:57:15 +0300
Subject: try2:winefile:Save font settings for registry
In-Reply-To: <00b001c84303$d80ccea0$a600fea9@DMITRY>
References: <200712201515.32502.ivan@etersoft.ru>
	<00b001c84303$d80ccea0$a600fea9@DMITRY>
Message-ID: <200712201557.15752.ivan@etersoft.ru>

? ????????? ?? Thursday 20 December 2007 15:28:32 ?? ????????:
> "Ivan Sinitsin" <ivan at etersoft.ru> wrote:
> > + if( RegQueryValueExW( hKey, reg_logfont, NULL, &type,
> > +                              (LPBYTE) &logfont, &size ) !=
> > ERROR_SUCCESS ) { +  hFont=GetStockObject(DEFAULT_GUI_FONT);
> > +  GetObject(hFont,sizeof(logfont),&logfont);
> > +        }
>
> There is no need to introduce the hFont variable.
>
> > + GetObject(Globals.hfont, sizeof(logfont), &logfont);
>
> To make the code more readable this call should be moved where logfont
> is actually used.
>
> > +        RegSetValueExW( hKey, reg_logfont, 0, REG_DWORD,
> > +                        (LPBYTE) &logfont, sizeof(LOGFONT) );
>
> The type should be set to REG_BINARY.

I have corrected the mistakes.
Do I understand you right?

----------------------
Sinitsin Ivan
-------------- next part --------------
A non-text attachment was scrubbed...
Name: programs-winefile.c.patch
Type: text/x-diff
Size: 2245 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071220/617e624d/attachment-0001.patch 

From dmitry at codeweavers.com  Thu Dec 20 07:03:26 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Thu, 20 Dec 2007 21:03:26 +0800
Subject: try2:winefile:Save font settings for registry
References: <200712201515.32502.ivan@etersoft.ru>
	<00b001c84303$d80ccea0$a600fea9@DMITRY>
	<200712201557.15752.ivan@etersoft.ru>
Message-ID: <015e01c84308$b72fed70$a600fea9@DMITRY>

"Ivan Sinitsin" <ivan at etersoft.ru> wrote:

> I have corrected the mistakes.
> Do I understand you right?

Yes, attached patch looks good for me.

-- 
Dmitry.


From thunder.m at email.cz  Thu Dec 20 08:33:03 2007
From: thunder.m at email.cz (=?UTF-8?B?TWlyZWsgU2x1Z2XFiA==?=)
Date: Thu, 20 Dec 2007 15:33:03 +0100
Subject: Wine Direct3D progress
In-Reply-To: <469F781B.6000908@codeweavers.com>
References: <200706251540.42192.stefan@codeweavers.com>	<200706252035.49045.stefan@codeweavers.com>	<468CE86D.70307@codeweavers.com>	<200707051538.21830.stefan@codeweavers.com>
	<469F781B.6000908@codeweavers.com>
Message-ID: <476A7D1F.1050103@email.cz>

An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20071220/c500edfd/attachment.htm 

From hverbeet at gmail.com  Thu Dec 20 08:58:05 2007
From: hverbeet at gmail.com (H. Verbeet)
Date: Thu, 20 Dec 2007 15:58:05 +0100
Subject: Wine Direct3D progress
In-Reply-To: <476A7D1F.1050103@email.cz>
References: <200706251540.42192.stefan@codeweavers.com>
	<200706252035.49045.stefan@codeweavers.com>
	<468CE86D.70307@codeweavers.com>
	<200707051538.21830.stefan@codeweavers.com>
	<469F781B.6000908@codeweavers.com> <476A7D1F.1050103@email.cz>
Message-ID: <d658b69e0712200658y630b00ak2b3527ae7e35c631@mail.gmail.com>

On 20/12/2007, Mirek Sluge? <thunder.m at email.cz> wrote:
>  OLD CONFIGURATION:
>  Configuration: Core 2 Duo E6400 at 3200MHz, 2GB RAM, GF 6800 GS
>  Options in wine registry: GLSL, FBO, VideoMemorySize 256, PS, VS,
> SoftwareEmulation
>  Patches: 3DMark hack
>
>  ACTUAL CONFIGURATION (bold results):
>  Configuration: Core 2 Duo E6400 at 3200MHz, 2GB RAM, GF 7900 GT (nvidia
> 169.04)
>  Options in wine registry: GLSL, FBO, VideoMemorySize 256, PS, VS,
> SoftwareEmulation
>  Patches: 3DMark hack, small gothic patch, wined3d: rewrite
> IWineD3DSurfaceImpl_BltOverride colorfill codepath, wined3d: use
> IWineD3DDeviceImpl_ClearSurface in IWineD3DDeviceImpl_Clear
>
Changing the graphics card skews the results a bit :-/
Unfortunately it's pretty hard to say how much of an impact that has per test.

From frick at sc-networks.de  Thu Dec 20 09:45:11 2007
From: frick at sc-networks.de (Christoph Frick)
Date: Thu, 20 Dec 2007 16:45:11 +0100
Subject: Wine Direct3D progress
In-Reply-To: <d658b69e0712200658y630b00ak2b3527ae7e35c631@mail.gmail.com>
References: <200706251540.42192.stefan@codeweavers.com>
	<200706252035.49045.stefan@codeweavers.com>
	<468CE86D.70307@codeweavers.com>
	<200707051538.21830.stefan@codeweavers.com>
	<469F781B.6000908@codeweavers.com> <476A7D1F.1050103@email.cz>
	<d658b69e0712200658y630b00ak2b3527ae7e35c631@mail.gmail.com>
Message-ID: <20071220154511.GA8286@byleth.sc-networks.de>

On Thu, Dec 20, 2007 at 03:58:05PM +0100, H. Verbeet wrote:

> >  OLD CONFIGURATION:
> >  Configuration: Core 2 Duo E6400 at 3200MHz, 2GB RAM, GF 6800 GS
> >  Options in wine registry: GLSL, FBO, VideoMemorySize 256, PS, VS,
> > SoftwareEmulation
> >  Patches: 3DMark hack
> >
> >  ACTUAL CONFIGURATION (bold results):
> >  Configuration: Core 2 Duo E6400 at 3200MHz, 2GB RAM, GF 7900 GT (nvidia
> > 169.04)
> >  Options in wine registry: GLSL, FBO, VideoMemorySize 256, PS, VS,
> > SoftwareEmulation
> >  Patches: 3DMark hack, small gothic patch, wined3d: rewrite
> > IWineD3DSurfaceImpl_BltOverride colorfill codepath, wined3d: use
> > IWineD3DDeviceImpl_ClearSurface in IWineD3DDeviceImpl_Clear
> >
> Changing the graphics card skews the results a bit :-/
> Unfortunately it's pretty hard to say how much of an impact that has per test.

and changing drivers (assumption) and the patches won't help either.

-- 
cu
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 163 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071220/02745ecb/attachment.pgp 

From rob at codeweavers.com  Thu Dec 20 10:57:27 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Thu, 20 Dec 2007 16:57:27 +0000
Subject: kernel32: Remove unneeded casts
In-Reply-To: <200712182247.56265.andrew.talbot@talbotville.com>
References: <200712182247.56265.andrew.talbot@talbotville.com>
Message-ID: <476A9EF7.5060905@codeweavers.com>

Andrew Talbot wrote:
>    /* All local heap allocations are aligned on 4-byte boundaries */
>  #define LALIGN(word)          (((word) + 3) & ~3)
>  
> -#define ARENA_PTR(ptr,arena)       ((LOCALARENA *)((char*)(ptr)+(arena)))
> +#define ARENA_PTR(ptr,arena)       ((LOCALARENA *)((ptr)+(arena)))

Don't remove casts from macros like this as they then won't be safe if 
the type that is passed in is changed to something else (like void *).

-- 
Rob Shearman



From nagarjunabandi at yahoo.co.in  Thu Dec 20 00:42:57 2007
From: nagarjunabandi at yahoo.co.in (Nagarjuna Bandi)
Date: Thu, 20 Dec 2007 06:42:57 +0000 (GMT)
Subject: Problem with winelib
Message-ID: <381477.23548.qm@web94505.mail.in2.yahoo.com>

      Dear Wine Developers Team,
 
     I am using the wine for porting windows applications under linux. This is a very powerful tool for doing this job thank you very much for providing us a such tool.
 
     Here i am getting problem with winelib when i trying to build the notepad application with the given guidelines in winelib user guide i had made the changes to Makefile you are specifying but i got another error msg like
 
 [nagarjunab at ibi212 notepad2]$ vim Makefile
 [nagarjunab at ibi212 notepad2]$ make
 wrc   -I.   -forsrc.res rsrc.rc
 winegcc -mwindows -mno-cygwin -o notepad2.exe.so dialog.o main.o  rsrc.res     -lodbc32 -lole32 -loleaut32 -lwinspool -luuid
 dialog.o(.text+0x1a5): In function `DIALOG_StringMsgBox':
 : undefined reference to `wnsprintfW'
 collect2: ld returned 1 exit status
 winegcc: gcc failed.
 make: *** [notepad2.exe.so] Error 2
 
 
      This is the error i am getting so please let me know what is the problem and what i have to do for avoiding this problem.
 
      I am expecting a fast response from you.
 
 Thanks in advance.
 
 
     
---------------------------------
 
 Regards,
 
 Nagarjuna Bandi ,
Infobrain Technologies Pvt. Ltd. | My Home Sarovar Plaza | Hyderabad |
 India.          
       
---------------------------------
 Explore your hobbies and interests. Click here to begin.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20071220/d807a274/attachment.htm 

From mikolaj.zalewski at gmail.com  Thu Dec 20 04:39:43 2007
From: mikolaj.zalewski at gmail.com (=?ISO-8859-2?Q?Miko=B3aj_Zalewski?=)
Date: Thu, 20 Dec 2007 11:39:43 +0100
Subject: msi: Revert commit 96e4320feb22b3a2c9564de100c09990622edb59
In-Reply-To: <E1J5Ggg-0001fg-8c@mail.codeweavers.com>
References: <E1J5Ggg-0001fg-8c@mail.codeweavers.com>
Message-ID: <e5b662840712200239i6033b24cl858f31b91fad468a@mail.gmail.com>

>
> I have no idea what Mikolaj tried to fix with this patch but


  As I wrote in
http://www.winehq.org/pipermail/wine-patches/2007-October/045479.html the
problem was in the Photoshop CS2 installer where the groupbox consumed mouse
events. They didn't arrive to the edit box (which was created earlier) what
caused it to appear to be disabled. I checked that in that installer the
groupbox had the BS_GROUPBOX style. Maybe that depends on some flags?

Miko?aj Zalewski
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20071220/46a6fbf2/attachment.htm 

From juan.lang at gmail.com  Thu Dec 20 12:16:25 2007
From: juan.lang at gmail.com (Juan Lang)
Date: Thu, 20 Dec 2007 10:16:25 -0800
Subject: Problem with winelib
In-Reply-To: <381477.23548.qm@web94505.mail.in2.yahoo.com>
References: <381477.23548.qm@web94505.mail.in2.yahoo.com>
Message-ID: <3a768c550712201016v65e74847j5cbce309b0a288e@mail.gmail.com>

Hi Nagarjuna,

>  dialog.o(.text+0x1a5): In function `DIALOG_StringMsgBox':
>  : undefined reference to `wnsprintfW'

That looks like a typo to me.  It should just be wnsprintf.
--Juan


From winehacker at gmail.com  Thu Dec 20 12:23:39 2007
From: winehacker at gmail.com (Steven Edwards)
Date: Thu, 20 Dec 2007 13:23:39 -0500
Subject: Problem with winelib
In-Reply-To: <381477.23548.qm@web94505.mail.in2.yahoo.com>
References: <381477.23548.qm@web94505.mail.in2.yahoo.com>
Message-ID: <19e31a080712201023o6dcd537cocf3e3c11742e1c62@mail.gmail.com>

On Dec 20, 2007 1:42 AM, Nagarjuna Bandi <nagarjunabandi at yahoo.co.in> wrote:
>      Here i am getting problem with winelib when i trying to build the
> notepad application with the given guidelines in winelib user guide i had
> made the changes to Makefile you are specifying but i got another error msg
> like
>       This is the error i am getting so please let me know what is the
> problem and what i have to do for avoiding this problem.
>
>       I am expecting a fast response from you.

Also keep in mind that unless you need to directly call a native linux
api, doing a winelib port does not gain you anything over just running
the stock windows binary.

Thanks
-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From rob at codeweavers.com  Thu Dec 20 13:16:27 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Thu, 20 Dec 2007 19:16:27 +0000
Subject: ole32: Fix a failed call to DllGetClassObject while retrieving
	class	object interface pointer.
In-Reply-To: <b4cc5a3d0712200653t738a43c4rcbd00ff8e779e128@mail.gmail.com>
References: <b4cc5a3d0712200653t738a43c4rcbd00ff8e779e128@mail.gmail.com>
Message-ID: <476ABF8B.1080509@codeweavers.com>

Huang, Zhangrong wrote:
> See dlls/ole32/compobj.c,
>
> static HRESULT apartment_getclassobject(struct apartment *apt, LPCWSTR dllpath,
>                                         BOOL apartment_threaded,
>                                         REFCLSID rclsid, REFIID riid,
> void **ppv)
> {
> ...................
>     if (SUCCEEDED(hr))
>     {
> ..................
>         TRACE("calling DllGetClassObject %p\n",
> apartment_loaded_dll->dll->DllGetClassObject);
>         /* OK: get the ClassObject */
>         hr = apartment_loaded_dll->dll->DllGetClassObject(rclsid, riid, ppv);
>                                                                   ^^^^
>         if (hr != S_OK)
>             ERR("DllGetClassObject returned error 0x%08x\n", hr);
>     }
> ..............
> }
>
> Reference to http://msdn2.microsoft.com/en-us/library/ms680760.aspx,
>
> riid
>
>     [in] Reference to the identifier of the interface that the caller
>     is to use to communicate with the class object. Usually, this is
>     IID_IClassFactory (defined in the OLE headers as the interface
>     identifier for IClassFactory).
>   

This doesn't mean anything other than CoCreateInstance is usually used 
instead of CoGetClassObject (and CoCreateInstance always passes in 
IID_IClassFactory for the IID).

> We can't pass riid to DllGetClassObject directly sometimes, causes some dlls'
> DllGetClassObject (like native adsldp.dll) can only return reference-counted
> pointer to class factory via IID_IClassFactory, for retrieving the
> pointer to the
> class object interface requested in riid, we must try another way.
>   

Thank you for your patch, but this behaviour seems a little strange and 
needs a little more investigation before I am happy that it is correct. 
What parameters are being passed in to CoGetClassObject to cause the 
call to fail for you?

-- 
Rob Shearman



From r.kalbermatter at hccnet.nl  Thu Dec 20 13:29:08 2007
From: r.kalbermatter at hccnet.nl (Rolf Kalbermatter)
Date: Thu, 20 Dec 2007 20:29:08 +0100
Subject: kernel32: Remove unneeded casts
In-Reply-To: <476A9EF7.5060905@codeweavers.com>
References: <200712182247.56265.andrew.talbot@talbotville.com>
	<476A9EF7.5060905@codeweavers.com>
Message-ID: <007c01c8433e$97ba2010$4001a8c0@NATERS>

Robert Shearman wrote:

> Andrew Talbot wrote:
> >    /* All local heap allocations are aligned on 4-byte boundaries */
> >  #define LALIGN(word)          (((word) + 3) & ~3)
> >  
> > -#define ARENA_PTR(ptr,arena)       ((LOCALARENA
*)((char*)(ptr)+(arena)))
> > +#define ARENA_PTR(ptr,arena)       ((LOCALARENA *)((ptr)+(arena)))
> 
> Don't remove casts from macros like this as they then won't 
> be safe if the type that is passed in is changed to something 
> else (like void *).

I think this would give a compile error but more fatal could be if someone
happens to pass in a variable that was declared like

long *ptr;

Then the offset calculation would be all wrong.

Rolf Kalbermatter




From stefandoesinger at gmx.at  Thu Dec 20 13:45:05 2007
From: stefandoesinger at gmx.at (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Thu, 20 Dec 2007 20:45:05 +0100
Subject: Wine Direct3D progress
In-Reply-To: <20071220154511.GA8286@byleth.sc-networks.de>
References: <200706251540.42192.stefan@codeweavers.com>
	<d658b69e0712200658y630b00ak2b3527ae7e35c631@mail.gmail.com>
	<20071220154511.GA8286@byleth.sc-networks.de>
Message-ID: <200712202045.05115.stefandoesinger@gmx.at>

Am Donnerstag, 20. Dezember 2007 16:45:11 schrieb Christoph Frick:
> > Changing the graphics card skews the results a bit :-/
> > Unfortunately it's pretty hard to say how much of an impact that has per
> > test.
>
> and changing drivers (assumption) and the patches won't help either.
Yeah, the different hardware setup limits the usefulness of the results. It 
would be really interesting to see this comparison with the same hardware and 
driver :-)

On a related note, it would be really cool if people could help with writing 
cxtest(www.cxtest.org) scripts for the various apps. This will allow 
automated performance testing and automated one-click regression testing if 
problems occur. I have once written such benchmarks for ut2004, half life 2 
and 3dmark2000, but more are definitly welcome. My time is too limited to 
take care of all this, so our D3D QA still relies on user testing for the 
most part.


From kuba at mareimbrium.org  Thu Dec 20 14:31:12 2007
From: kuba at mareimbrium.org (Kuba Ober)
Date: Thu, 20 Dec 2007 15:31:12 -0500
Subject: dll to .so wrapper
In-Reply-To: <1198105044.6283.13.camel@nebba.config>
References: <476827B3.1060006@gmail.com> <47698C8E.8050605@codeweavers.com>
	<1198105044.6283.13.camel@nebba.config>
Message-ID: <200712201531.13157.kuba@mareimbrium.org>

On Wednesday 19 December 2007, bridd wrote:
> On Wed, 2007-12-19 at 22:26 +0100, Maarten Lankhorst wrote:
> > This topic comes up from time to time, usually with mild variations. The
> > problem is that wine sets up its own environment and memory layout. In
> > the end you will need a .exe (or winelib binary) that uses wine, and a
> > socket/pipe/shm function to communicate with the .so, there is no easy
> > way to just  dynamically load a dll in an existing program.
>
> I see, so it's sounding like to do this I'd need to have something more
> akin to a VST host, that acts as an intermediatory and pumps the video
> data from the linux application via a native plugin (.so), into a
> winelib compiled program that executes the windows compiled plugin
> (.dll) and the sends it back out again.
>
> Probably beyond my skills right now, but thought it was worth seeing if
> anyone had trodden a similar route already!

Should be doable via shm, i.e. without overhead - you can share your 
framebuffer (or a few) between applications that way. Remember that you can 
do linux syscalls from a PE (windows) executable that runs under Wine.

Cheers, Kuba


From r.kalbermatter at hccnet.nl  Thu Dec 20 15:58:15 2007
From: r.kalbermatter at hccnet.nl (Rolf Kalbermatter)
Date: Thu, 20 Dec 2007 22:58:15 +0100
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <4769BE7B.7010204@gmx.net>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>		<4767EA9F.2030109@gmx.net>	<78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com><47681D77.8080007@gmx.net>
	<4769BE7B.7010204@gmx.net>
Message-ID: <000001c84353$6c60aa00$4001a8c0@NATERS>

Peter Beutner wrote:

>just tested again with current git and it worked with every gcc version
>I had at hand here: 4.2.2, 4.1.2, 4.0.4 and 3.4.6.

And what did you test there? As far as I understood the issue, it's not that
Wine won't work at all (at least for most of those gcc versions). Those gcc
version will only emit much more code that modern copy protection schemes
(Safe Disc, Secu Rom) with statistical code analysis will see as possible
attempts to counterfeit them and consequently prevent starting applications
protected by them.

As long as you do not want to run copy protected applications under Wine
most of those gcc versions should just work fine.

Rolf Kalbermatter



From andrewriedi at gmail.com  Thu Dec 20 19:09:13 2007
From: andrewriedi at gmail.com (Andrew Riedi)
Date: Thu, 20 Dec 2007 17:09:13 -0800
Subject: The #winehq Wine channel
Message-ID: <689de9370712201709l1ff1693aje0db83ed1937378e@mail.gmail.com>

There are two main issues I would like to address.

1) Normally the current #winehq OPs to a great job, but they are only human
and only have so many waking hours.  I noticed recently that it took a
little longer than normal for #winehq's topic to be updated to the latest
release.  I would like to ask for some basic OP rights to update the topic
when the regular OPs are unable to, due to real life.  Who is in charge of
this sort of thing?

2) Rules.  Should we provide a set of rules for #winehq use?  For general
Wine-based channel use?  (#winehq, #winehq-social, #winehackers,
#crossover)  Perhaps state when people deserve a kick, the purposes of each
channel, etc.  Maybe we should start a wiki page with the information,
rules, etc.?

-- 
Andrew Riedi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20071220/29e449bc/attachment.htm 

From p.beutner at gmx.net  Thu Dec 20 20:11:09 2007
From: p.beutner at gmx.net (Peter Beutner)
Date: Fri, 21 Dec 2007 03:11:09 +0100
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <000001c84353$6c60aa00$4001a8c0@NATERS>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>		<4767EA9F.2030109@gmx.net>	<78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com><47681D77.8080007@gmx.net>	<4769BE7B.7010204@gmx.net>
	<000001c84353$6c60aa00$4001a8c0@NATERS>
Message-ID: <476B20BD.4030600@gmx.net>

Rolf Kalbermatter schrieb:
> Peter Beutner wrote:
> 
>> just tested again with current git and it worked with every gcc version
>> I had at hand here: 4.2.2, 4.1.2, 4.0.4 and 3.4.6.
> 
> And what did you test there? 

That safedisc 2.x works. Wine successfully passes the statistical code analysis.
And that also with gcc versions that reportedly caused problems on earlier wine
versions. So other people might want to recheck as well with whatever compiler
they are using.

> As far as I understood the issue, it's not that
> Wine won't work at all (at least for most of those gcc versions). Those gcc
> version will only emit much more code that modern copy protection schemes
> (Safe Disc, Secu Rom) with statistical code analysis will see as possible
> attempts to counterfeit them and consequently prevent starting applications
> protected by them.

yes, but also changes at the source code level can change the results of that
analysis. There were some specific changes for that between .48 and .49 that
drastically improved the situation. Unless you were using certain "broken"
gcc versions (broken is a bit too harsh, the main problem is after all only
that the function prolog sequence is ordered a bit differently).

Now some changes seems to have improved the situation even further, so that
even with those little differences between different gcc versions it
stays below the threshold where the safedisc analyzer would start complaining.

> As long as you do not want to run copy protected applications under Wine
> most of those gcc versions should just work fine.

sry, for not being more specific. I thought the context was clear as this whole
discussion was only about copy protection vs. different gcc versions.

btw., because you said "most of those gcc versions", is there a gcc version that
is known to not work with wine (beside these copy protection issues)?


From dmitry at codeweavers.com  Thu Dec 20 21:31:29 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 21 Dec 2007 11:31:29 +0800
Subject: Problem with winelib
References: <381477.23548.qm@web94505.mail.in2.yahoo.com>
	<3a768c550712201016v65e74847j5cbce309b0a288e@mail.gmail.com>
Message-ID: <004901c84381$fb4a6ca0$a600fea9@DMITRY>

"Juan Lang" <juan.lang at gmail.com> wrote:

>>  dialog.o(.text+0x1a5): In function `DIALOG_StringMsgBox':
>>  : undefined reference to `wnsprintfW'
> 
> That looks like a typo to me.  It should just be wnsprintf.

That's not a typo, just a missing shlwapi import in the Makefile.

-- 
Dmitry.


From austinenglish at gmail.com  Thu Dec 20 22:03:09 2007
From: austinenglish at gmail.com (Austin English)
Date: Thu, 20 Dec 2007 22:03:09 -0600
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <476B20BD.4030600@gmx.net>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>
	<4767EA9F.2030109@gmx.net>
	<78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com>
	<47681D77.8080007@gmx.net> <4769BE7B.7010204@gmx.net>
	<000001c84353$6c60aa00$4001a8c0@NATERS> <476B20BD.4030600@gmx.net>
Message-ID: <b6bb06270712202003s5a9b231ftf70621cf953720f5@mail.gmail.com>

Another factor to consider is that individual distributions may work
while others do not. Vanilla gcc may work, but after Ubuntu/Suse/etc
apply their patches, this may not be the case.

-Austin

On Dec 20, 2007 8:11 PM, Peter Beutner <p.beutner at gmx.net> wrote:
> Rolf Kalbermatter schrieb:
> > Peter Beutner wrote:
> >
> >> just tested again with current git and it worked with every gcc version
> >> I had at hand here: 4.2.2, 4.1.2, 4.0.4 and 3.4.6.
> >
> > And what did you test there?
>
> That safedisc 2.x works. Wine successfully passes the statistical code analysis.
> And that also with gcc versions that reportedly caused problems on earlier wine
> versions. So other people might want to recheck as well with whatever compiler
> they are using.
>
> > As far as I understood the issue, it's not that
> > Wine won't work at all (at least for most of those gcc versions). Those gcc
> > version will only emit much more code that modern copy protection schemes
> > (Safe Disc, Secu Rom) with statistical code analysis will see as possible
> > attempts to counterfeit them and consequently prevent starting applications
> > protected by them.
>
> yes, but also changes at the source code level can change the results of that
> analysis. There were some specific changes for that between .48 and .49 that
> drastically improved the situation. Unless you were using certain "broken"
> gcc versions (broken is a bit too harsh, the main problem is after all only
> that the function prolog sequence is ordered a bit differently).
>
> Now some changes seems to have improved the situation even further, so that
> even with those little differences between different gcc versions it
> stays below the threshold where the safedisc analyzer would start complaining.
>
> > As long as you do not want to run copy protected applications under Wine
> > most of those gcc versions should just work fine.
>
> sry, for not being more specific. I thought the context was clear as this whole
> discussion was only about copy protection vs. different gcc versions.
>
> btw., because you said "most of those gcc versions", is there a gcc version that
> is known to not work with wine (beside these copy protection issues)?
>
>
>


From zac at zacbrown.org  Thu Dec 20 22:18:10 2007
From: zac at zacbrown.org (Zac Brown)
Date: Thu, 20 Dec 2007 22:18:10 -0600
Subject: advapi32: Fix domain length setting in LookupAccountNameW
In-Reply-To: <476B3828.2000503@zacbrown.org>
References: <476B3828.2000503@zacbrown.org>
Message-ID: <476B3E82.7000909@zacbrown.org>

Zac Brown wrote:
> Hi,
> 
> Changelog:
> * Fix value setting for *cchReferencedDomainName in LookupAccountNameW
> * Fix LookupAccountNameA conversion from WCHAR to CHAR by setting proper '\0'
> 
> Notes:
> * This patch addresses bug 10612
> 
> -Zac Brown
> 
> 
> ------------------------------------------------------------------------
> 
> 

Ignore this patch, it has stupid mistakes in it. Will send a second one thats correct.

-Zac


From dmitry at codeweavers.com  Thu Dec 20 22:34:34 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 21 Dec 2007 12:34:34 +0800
Subject: mapi32: Resolve FIXME regarding attachment lists in
	MAPISendMailfunction
References: <476AF853.2070704@legis.state.ak.us>
Message-ID: <012201c8438a$cb27a520$a600fea9@DMITRY>

"Mark Neyhart" <Mark_Neyhart at legis.state.ak.us> wrote:

> diff --git a/dlls/mapi32/sendmail.c b/dlls/mapi32/sendmail.c
> old mode 100644
> new mode 100755

Please fix file permissions before submitting patches.

-- 
Dmitry.


From dmitry at codeweavers.com  Thu Dec 20 22:40:03 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Fri, 21 Dec 2007 12:40:03 +0800
Subject: user32: add stub for GetLayeredWindowAttributes
References: <799143.37491.qm@web23202.mail.ird.yahoo.com>
Message-ID: <015101c8438b$8fd141b0$a600fea9@DMITRY>

"Louis. Lenders" <xerox_xerox2000 at yahoo.co.uk> wrote:

> +BOOL WINAPI GetLayeredWindowAttributes( HWND hWnd,COLORREF* prgbKey,
> +                                        BYTE* pbAlpha, DWORD* pdwFlags )
> +{
> +    FIXME("(%p,0x%.8x,%d,%d): stub!\n", hWnd, *prgbKey, *pbAlpha, *pdwFlags);
> +    return TRUE;
> +}

Probably a better idea would be to return FALSE, otherwise you have to initialize
all the requested data.

-- 
Dmitry.


From actong88 at gmail.com  Thu Dec 20 22:48:35 2007
From: actong88 at gmail.com (Allan Tong)
Date: Thu, 20 Dec 2007 23:48:35 -0500
Subject: [1/4 try 3] wined3d: Activate GL context before making any GL calls
	in stretch_rect_fbo
Message-ID: <d75158870712202048m5f39effet732de468590c90f6@mail.gmail.com>

Third try, this time without the incomplete FBO error in the ddraw
tests.  With this set of patches, all D3D tests should pass with FBO
offscreen rendering.

 - Allan
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-wined3d-Activate-GL-context-before-making-any-GL-ca.patch
Type: text/x-patch
Size: 3322 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071220/5bc25317/attachment.bin 

From twickline at gmail.com  Thu Dec 20 23:52:12 2007
From: twickline at gmail.com (Tom Wickline)
Date: Fri, 21 Dec 2007 00:52:12 -0500
Subject: Wine Direct3D progress
In-Reply-To: <476A7D1F.1050103@email.cz>
References: <200706251540.42192.stefan@codeweavers.com>
	<200706252035.49045.stefan@codeweavers.com>
	<468CE86D.70307@codeweavers.com>
	<200707051538.21830.stefan@codeweavers.com>
	<469F781B.6000908@codeweavers.com> <476A7D1F.1050103@email.cz>
Message-ID: <53e3a9930712202152q5b3ec85fva24f10a9a9b4fde7@mail.gmail.com>

On Dec 20, 2007 9:33 AM, Mirek Sluge? <thunder.m at email.cz> wrote:
>
>
>  3DMark 2006
>  game tests: 768/126/1149 points
>  game 1: 5.2/1.2/9.3 fps
>  game 2: 7.6/0.9/9.7 fps
>  hdr game tests: 298/167/1022 points
>  game 1: 1.976/1.4/8.8 fps
>  game 2: 3.989/1.9/11.6 fps
>  cpu tests: 2412/2426/2665 points
>  game 1: 0.782/0.794/0.855 fps
>  game 2: 1.190/1.186/1.329 fps
>
>
>  Mirek Slugen
>

I ran 3DMark06 just now and got a score of 3464

Some System Specs:
Quad Core 2.4Ghz,  8GB RAM,  1.2TB HD Space,
640MB 8800GTS, Gentoo Linux

SM2.0 = 1662
HDR SM3 = 880
CPU = 2841

http://img409.imageshack.us/img409/7809/screenshotwinedesktop2oy0.png
http://img516.imageshack.us/img516/3826/screenshotwinedesktop3vu1.png
http://img521.imageshack.us/img521/252/screenshotwinedesktop4xo2.png

Tom

From madewokherd+d41d at gmail.com  Fri Dec 21 01:03:19 2007
From: madewokherd+d41d at gmail.com (Vincent Povirk)
Date: Fri, 21 Dec 2007 02:03:19 -0500
Subject: Wine desktop integration: double-clicking files in file managers
Message-ID: <ced95fe0712202303j71cb4d7bw653e340b7d598415@mail.gmail.com>

I have attached a patch that adds a wrapper script to Wine for
starting files from Linux file managers such as nautilus and modifies
wine.desktop to use the script for exe, msi, lnk, chm, and hlp files.

The wrapper sets the working directory to the directory containing the
file and starts it using wine start with the full windows path. If
wine start fails, it displays an error dialog. As I understand it,
this is very close to the behavior when double-clicking a file in
windows explorer.

Please comment.


These issues worry me in particular:

I cannot double-click on exe files to open them myself because of
http://bugs.winehq.org/show_bug.cgi?id=8386 (nautilus is getting
confused about file types). As I understand it, this is a separate
problem (and should be fixed?), but I wonder if I can do anything
about it.

Nautilus is not using Wine to start hlp files. I put in every mime
type I could come up with for hlp, including
application/x-extension-hlp.

Wine does not show in the "Open With" list in nautilus. This makes the
wrapper a little bit harder to use for applications installed in wine
to handle specific filetypes.

Is the list of file extensions I decided to use reasonable?

Is the list of MIME types I decided to use for those extensions
reasonable? Is there some way Wine could help the system recognize
some of these types? I don't know much about this topic,
unfortunately, and I'm not very confident about my list.

I cannot test the kdialog command in the script myself because kdialog
consistently fails to display things here.

-- 
Vincent Povirk
-------------- next part --------------
A non-text attachment was scrubbed...
Name: winestartfile.patch
Type: text/x-patch
Size: 3762 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071221/ad4937bc/attachment.bin 

From twickline at gmail.com  Fri Dec 21 02:50:28 2007
From: twickline at gmail.com (Tom Wickline)
Date: Fri, 21 Dec 2007 03:50:28 -0500
Subject: Wine Direct3D progress
In-Reply-To: <53e3a9930712202152q5b3ec85fva24f10a9a9b4fde7@mail.gmail.com>
References: <200706251540.42192.stefan@codeweavers.com>
	<200706252035.49045.stefan@codeweavers.com>
	<468CE86D.70307@codeweavers.com>
	<200707051538.21830.stefan@codeweavers.com>
	<469F781B.6000908@codeweavers.com> <476A7D1F.1050103@email.cz>
	<53e3a9930712202152q5b3ec85fva24f10a9a9b4fde7@mail.gmail.com>
Message-ID: <53e3a9930712210050x3979613bo1d2759b16cfdcf71@mail.gmail.com>

On Dec 21, 2007 12:52 AM, Tom Wickline <twickline at gmail.com> wrote:

> 640MB 8800GTS, Gentoo Linux
>

That should say 8800GTX

>
> Tom
>


From adamrimon at gmail.com  Fri Dec 21 03:01:28 2007
From: adamrimon at gmail.com (Adam Rimon)
Date: Fri, 21 Dec 2007 11:01:28 +0200
Subject: winex11.drv: driver.c: GET_USER_FUNC
Message-ID: <476B80E8.1060008@gmail.com>

Hi,

Is there any reason for the /do { ...... } while(0);/ in the 
GET_USER_FUNC macro?

-Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.winehq.org/pipermail/wine-devel/attachments/20071221/d56f4159/attachment.htm 

From rob at codeweavers.com  Fri Dec 21 03:39:02 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Fri, 21 Dec 2007 09:39:02 +0000
Subject: winex11.drv: driver.c: GET_USER_FUNC
In-Reply-To: <476B80E8.1060008@gmail.com>
References: <476B80E8.1060008@gmail.com>
Message-ID: <476B89B6.1040505@codeweavers.com>

Adam Rimon wrote:
> Is there any reason for the /do { ...... } while(0);/ in the 
> GET_USER_FUNC macro?

It's a standard way of making sure that the macro is safe if you put it 
after an if statement or similar without opening a new block.

-- 
Rob Shearman



From hans at it.vu.nl  Fri Dec 21 04:36:25 2007
From: hans at it.vu.nl (Hans Leidekker)
Date: Fri, 21 Dec 2007 11:36:25 +0100
Subject: mapi32: Resolve FIXME regarding attachment lists in MAPISendMail
	function
In-Reply-To: <476AF853.2070704@legis.state.ak.us>
References: <476AF853.2070704@legis.state.ak.us>
Message-ID: <200712211136.25562.hans@it.vu.nl>

On Friday 21 December 2007 00:18:43 Mark Neyhart wrote:

> Extend the MAILTO: string produced by the MAPISendMail function to include
> an attachment list. Because I was unable to find any standard for MAILTO
> regarding attachments, I constructed the attachment list in the format
> specified for Mozilla command line options.

Breaking other mail clients to gain attachments support for Mozilla is not
acceptable tradeoff IMO.

 -Hans


From rolf.kalbermatter at citeng.com  Fri Dec 21 01:37:53 2007
From: rolf.kalbermatter at citeng.com (Rolf Kalbermatter)
Date: Fri, 21 Dec 2007 08:37:53 +0100
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <476B20BD.4030600@gmx.net>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>		<4767EA9F.2030109@gmx.net>	<78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com><47681D77.8080007@gmx.net>	<4769BE7B.7010204@gmx.net>
	<000001c84353$6c60aa00$4001a8c0@NATERS> <476B20BD.4030600@gmx.net>
Message-ID: <006f01c843a4$652ffb40$4001a8c0@NATERS>

Peter Beutner wrote:

> btw., because you said "most of those gcc versions", is there 
> a gcc version that is known to not work with wine (beside 
> these copy protection issues)?

I couldn't name a specific one but I think when 4.0 versions started to
appear there were a few incidents of clearly bad code sequences generated,
but have to admit that I don't remember if Wine was affected too by this.

Rolf Kalbermatter



From stefandoesinger at gmx.at  Fri Dec 21 07:03:04 2007
From: stefandoesinger at gmx.at (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Fri, 21 Dec 2007 14:03:04 +0100
Subject: [1/4 try 3] wined3d: Activate GL context before making any GL
	calls in stretch_rect_fbo
In-Reply-To: <d75158870712202050x64771d4cuf653a64088051c32@mail.gmail.com>
References: <d75158870712202050x64771d4cuf653a64088051c32@mail.gmail.com>
Message-ID: <200712211403.04327.stefandoesinger@gmx.at>

Hi,

I think your patches are on the right track, but there are a few issues to 
look at. I'll also need Henri's comments, as he wrote the fbo code.

Did you try your patches with the Deferred Shading sample from codesampler? 
http://www.codesampler.com/usersrc/usersrc_7.htm . It uses multiple render 
targets, so it is a quite interesting test.

drawprimitive() in drawprim.c calls apply_fbo_state before calling 
ActivateContext as well. This causes a lot of problems with multithreading, 
so this should be fixed too.

The first patch is OK. Calling ActivateContext before activating the fbo is 
required.

In patch 2, I was a bit confused by moving the "This->activeContext" 
assignment inside Init3D, I first thought you would remove it. But otherwise 
it looks good to me as well.

Patch 3 is ok too, keeping track of the currently bound fbo in the context is 
good. Unrelated to this patch we should look if the glBindFramebufferEXT(..., 
0) calls could be replaced with calling ActivateContext, and if that makes 
sense(it's probably not a good idea everywhere).

In patch 4, you have to be aware that in CTXUSAGE_BLIT the fbo's depth and 
color1+ attachments might be set to bad textures(e.g. different size). So 
you'll have to set them to NULL or make sure that they are set properly.

I once discussed with Henri where we should have all the functions. I think we 
could just move apply_fbo_state to context.c, make it static to make sure the 
code that requires a drawable calls ActivateContext. I am not entirely sure 
if that makes sense everywhere, e.g. the depth_blit code. Henri had some 
arguments in that regard, but I have to check the irc logs and digg out the 
discussion.

Other good testing applications are Half Life 2(demo is ok), it uses color 
buffers and depth buffers with different sizes. Battlefield 2(not 2142, no 
idea if there is a demo) depends on the depth blitting. Bioshock(demo is ok) 
is a case of an application that crashes due to multithreading issues because 
apply_fbo_state is applied before calling ActivateContext.

Thank you for all your excellent work,
Stefan


From hverbeet at gmail.com  Fri Dec 21 08:35:37 2007
From: hverbeet at gmail.com (H. Verbeet)
Date: Fri, 21 Dec 2007 15:35:37 +0100
Subject: [1/4 try 3] wined3d: Activate GL context before making any GL
	calls in stretch_rect_fbo
In-Reply-To: <200712211403.04327.stefandoesinger@gmx.at>
References: <d75158870712202050x64771d4cuf653a64088051c32@mail.gmail.com>
	<200712211403.04327.stefandoesinger@gmx.at>
Message-ID: <d658b69e0712210635n70d388d7g77e95633822388df@mail.gmail.com>

Overall, the patches look pretty reasonable.

On 21/12/2007, Stefan D?singer <stefandoesinger at gmx.at> wrote:
> Did you try your patches with the Deferred Shading sample from codesampler?
> http://www.codesampler.com/usersrc/usersrc_7.htm . It uses multiple render
> targets, so it is a quite interesting test.
>
Keep in mind that that one needs a couple of hacks to the format table
to work properly though.

> drawprimitive() in drawprim.c calls apply_fbo_state before calling
> ActivateContext as well. This causes a lot of problems with multithreading,
> so this should be fixed too.
>
Unless, I misunderstand the issue, that one should be taken care of in
the 4th patch already.

> Patch 3 is ok too, keeping track of the currently bound fbo in the context is
> good. Unrelated to this patch we should look if the glBindFramebufferEXT(...,
> 0) calls could be replaced with calling ActivateContext, and if that makes
> sense(it's probably not a good idea everywhere).
>

Personally, I don't like keeping track of flags like this all over the place:
>          GL_EXTCALL(glBindFramebufferEXT(GL_FRAMEBUFFER_EXT, 0));
> +        This->activeContext->last_fbo = 0;
I'd rather ban naked glBindFramebufferEXT() calls and either allow
bind_fbo() to accept NULL for the fbo parameter, or create an
unbind_fbo() function. Another option could be to handle framebuffer
selection completely in ActivateContext(). Arguably that's the proper
way to do it, but it would be a bit more involved, and would require
extending ActivateContext with a "source_surface" parameter, to handle
stretch_rect_fbo(), and possibly a few more CTXUSAGE types.


> In patch 4, you have to be aware that in CTXUSAGE_BLIT the fbo's depth and
> color1+ attachments might be set to bad textures(e.g. different size). So
> you'll have to set them to NULL or make sure that they are set properly.
>
Currently dst_fbo will only ever have an attachment at
GL_COLOR_ATTACHMENT0_EXT, if any. That could potentially change if we
would start to handle colorfill on depth stencils or
stretch_rect_fbo() between them, but I don't expect that to happen
very soon.

What I do wonder about is why CTXUSAGE_BLIT even binds dst_fbo though.
It's certainly not used in any of the places that currently use
dst_fbo, and I'm not sure it makes sense to bind dst_fbo in any of the
places that does call ActivateContext that way.

> I once discussed with Henri where we should have all the functions. I think we
> could just move apply_fbo_state to context.c, make it static to make sure the
> code that requires a drawable calls ActivateContext. I am not entirely sure
> if that makes sense everywhere, e.g. the depth_blit code. Henri had some
> arguments in that regard, but I have to check the irc logs and digg out the
> discussion.
>
IIRC the issue was with moving the depth blit itself to
ActivateContext(). I think just selecting the proper framebuffer etc.
should be fine.

> Other good testing applications are Half Life 2(demo is ok), it uses color
> buffers and depth buffers with different sizes. Battlefield 2(not 2142, no
> idea if there is a demo) depends on the depth blitting. Bioshock(demo is ok)
> is a case of an application that crashes due to multithreading issues because
> apply_fbo_state is applied before calling ActivateContext.
>
BF2142 does have a demo, but afaik it allows online play only, which
makes testing a bit awkward. It doesn't need depth blitting like BF2,
but does have HDR effects, IIRC. Both BF2 and BF2142 require support
for animated cursors.


From thestig at google.com  Fri Dec 21 10:30:16 2007
From: thestig at google.com (Lei Zhang)
Date: Fri, 21 Dec 2007 08:30:16 -0800
Subject: mapi32: Resolve FIXME regarding attachment lists in MAPISendMail
	function
In-Reply-To: <200712211136.25562.hans@it.vu.nl>
References: <476AF853.2070704@legis.state.ak.us>
	<200712211136.25562.hans@it.vu.nl>
Message-ID: <558b2f5c0712210830j5045bf86t7674c986544247c5@mail.gmail.com>

On Dec 21, 2007 2:36 AM, Hans Leidekker <hans at it.vu.nl> wrote:
> On Friday 21 December 2007 00:18:43 Mark Neyhart wrote:
>
> > Extend the MAILTO: string produced by the MAPISendMail function to include
> > an attachment list. Because I was unable to find any standard for MAILTO
> > regarding attachments, I constructed the attachment list in the format
> > specified for Mozilla command line options.
>
> Breaking other mail clients to gain attachments support for Mozilla is not
> acceptable tradeoff IMO.
>
>  -Hans
>
>
>

Mozilla and Thunderbird do not support attachments via mailtos. At
least not on Linux.

https://bugzilla.mozilla.org/show_bug.cgi?id=99055#c6

- Lei


From Mark_Neyhart at legis.state.ak.us  Fri Dec 21 12:06:03 2007
From: Mark_Neyhart at legis.state.ak.us (Mark Neyhart)
Date: Fri, 21 Dec 2007 09:06:03 -0900
Subject: mapi32: Resolve FIXME regarding attachment lists in MAPISendMail
	function
In-Reply-To: <558b2f5c0712210830j5045bf86t7674c986544247c5@mail.gmail.com>
References: <476AF853.2070704@legis.state.ak.us>	<200712211136.25562.hans@it.vu.nl>
	<558b2f5c0712210830j5045bf86t7674c986544247c5@mail.gmail.com>
Message-ID: <476C008B.904@legis.state.ak.us>

> On Dec 21, 2007 2:36 AM, Hans Leidekker <hans at it.vu.nl> wrote:
>> On Friday 21 December 2007 00:18:43 Mark Neyhart wrote:
>>
>>> Extend the MAILTO: string produced by the MAPISendMail function to include
>>> an attachment list. Because I was unable to find any standard for MAILTO
>>> regarding attachments, I constructed the attachment list in the format
>>> specified for Mozilla command line options.
>> Breaking other mail clients to gain attachments support for Mozilla is not
>> acceptable tradeoff IMO.
>>
>>  -Hans
>>
>>
>>
> 
> Mozilla and Thunderbird do not support attachments via mailtos. At
> least not on Linux.
> 
> https://bugzilla.mozilla.org/show_bug.cgi?id=99055#c6
> 
> - Lei
> 
> 

Hans,
As the code stands right now, attachments are not supported at all.  Using the
MAPISendMail function with a file list will bring up an email client with no
file(s) attached.  This seems to be absolutely useless, since the file(s) will have
to be manually attached before sending the message.  This patch will provide
at least the possibility for email clients to make use of the added parameter.

How about if I use the &attachment= parameter only if a file list is
provided by the caller to MAPISendMail?  That way applications which are
not attempting to provide attachments will work the same way as before.

Lei,
I am aware that Mozilla and Thunderbird do not support attachments via
mailto.  I resolved that with a simple wrapper which changes the mailto
option into the standard command line options which do support attachments.
The wrapper name can be specified the wine registry.




From thestig at google.com  Fri Dec 21 13:05:00 2007
From: thestig at google.com (Lei Zhang)
Date: Fri, 21 Dec 2007 11:05:00 -0800
Subject: mapi32: Resolve FIXME regarding attachment lists in MAPISendMail
	function
In-Reply-To: <476C008B.904@legis.state.ak.us>
References: <476AF853.2070704@legis.state.ak.us>
	<200712211136.25562.hans@it.vu.nl>
	<558b2f5c0712210830j5045bf86t7674c986544247c5@mail.gmail.com>
	<476C008B.904@legis.state.ak.us>
Message-ID: <558b2f5c0712211105w713d0bd2g5b8b139f2bfa98fd@mail.gmail.com>

On Dec 21, 2007 10:06 AM, Mark Neyhart <Mark_Neyhart at legis.state.ak.us> wrote:
>
> Lei,
> I am aware that Mozilla and Thunderbird do not support attachments via
> mailto.  I resolved that with a simple wrapper which changes the mailto
> option into the standard command line options which do support attachments.
> The wrapper name can be specified the wine registry.
>

Your script is probably unnecessary, since there's already a tool for
Linux email integration called xdg-email. It doesn't support
attachments for Thunderbird yet, but I already submitted a patch. [1]

You should specify the attachment file names as /path/to/file, which
is the format supported by xdg-email and every other Linux mail
client, rather than file:///path/to/file, which doesn't work for
anything but your script.

- Lei

[1] https://bugs.freedesktop.org/show_bug.cgi?id=13435


From hans at it.vu.nl  Fri Dec 21 14:02:16 2007
From: hans at it.vu.nl (Hans Leidekker)
Date: Fri, 21 Dec 2007 21:02:16 +0100
Subject: mapi32: Resolve FIXME regarding attachment lists in MAPISendMail
	function
In-Reply-To: <476C008B.904@legis.state.ak.us>
References: <476AF853.2070704@legis.state.ak.us>
	<558b2f5c0712210830j5045bf86t7674c986544247c5@mail.gmail.com>
	<476C008B.904@legis.state.ak.us>
Message-ID: <200712212102.16822.hans@it.vu.nl>

On Friday 21 December 2007 19:06:03 Mark Neyhart wrote:

> How about if I use the &attachment= parameter only if a file list is
> provided by the caller to MAPISendMail?  That way applications which are
> not attempting to provide attachments will work the same way as before.

I don't think that's any better. In this case, when there's an attachment,
mail clients will choke on your non-standard mailto url and fail silently,
which is worse than showing up without attachments.

How about adding an --attach option to winebrowser and replacing the
ShellExecute call with CreateProcess? I.e. make MAPISendMail fetch
the preferred mail client from the registry and start it with the mailto
url on the command line. If it's winebrowser and if there are attachments,
add them through the --attach parameter.

 -Hans


From Mark_Neyhart at legis.state.ak.us  Fri Dec 21 15:37:00 2007
From: Mark_Neyhart at legis.state.ak.us (Mark Neyhart)
Date: Fri, 21 Dec 2007 12:37:00 -0900
Subject: mapi32: Resolve FIXME regarding attachment lists in MAPISendMail
	function
In-Reply-To: <558b2f5c0712211105w713d0bd2g5b8b139f2bfa98fd@mail.gmail.com>
References: <476AF853.2070704@legis.state.ak.us>	
	<200712211136.25562.hans@it.vu.nl>	
	<558b2f5c0712210830j5045bf86t7674c986544247c5@mail.gmail.com>	
	<476C008B.904@legis.state.ak.us>
	<558b2f5c0712211105w713d0bd2g5b8b139f2bfa98fd@mail.gmail.com>
Message-ID: <476C31FC.9000004@legis.state.ak.us>

Lei Zhang wrote:
> On Dec 21, 2007 10:06 AM, Mark Neyhart <Mark_Neyhart at legis.state.ak.us> wrote:
>> Lei,
>> I am aware that Mozilla and Thunderbird do not support attachments via
>> mailto.  I resolved that with a simple wrapper which changes the mailto
>> option into the standard command line options which do support attachments.
>> The wrapper name can be specified the wine registry.
>>
> 
> Your script is probably unnecessary, since there's already a tool for
> Linux email integration called xdg-email. It doesn't support
> attachments for Thunderbird yet, but I already submitted a patch. [1]
> 
> You should specify the attachment file names as /path/to/file, which
> is the format supported by xdg-email and every other Linux mail
> client, rather than file:///path/to/file, which doesn't work for
> anything but your script.
> 
> - Lei
> 
> [1] https://bugs.freedesktop.org/show_bug.cgi?id=13435

I just used the URI style because that is what Mozilla uses on the
command line, but if that is an uncommon usage it makes sense to use
/path/to/file instead.  I also surrounded the attachment file list
with single quotes as per the Mozilla specification.  I should
probable get rid of those as well.  The attachment portion of the
mailto string will change from

&attachment="'file:///path/to/file1,file:///path/to/file2'"
to
&attachment="/path/to/file1,/path/to/file2"


From Mark_Neyhart at legis.state.ak.us  Fri Dec 21 15:54:35 2007
From: Mark_Neyhart at legis.state.ak.us (Mark Neyhart)
Date: Fri, 21 Dec 2007 12:54:35 -0900
Subject: mapi32: Resolve FIXME regarding attachment lists in MAPISendMail
	function
In-Reply-To: <200712212102.16822.hans@it.vu.nl>
References: <476AF853.2070704@legis.state.ak.us>
	<558b2f5c0712210830j5045bf86t7674c986544247c5@mail.gmail.com>
	<476C008B.904@legis.state.ak.us> <200712212102.16822.hans@it.vu.nl>
Message-ID: <476C361B.2040501@legis.state.ak.us>

Hans Leidekker wrote:
> On Friday 21 December 2007 19:06:03 Mark Neyhart wrote:
> 
>> How about if I use the &attachment= parameter only if a file list is
>> provided by the caller to MAPISendMail?  That way applications which are
>> not attempting to provide attachments will work the same way as before.
> 
> I don't think that's any better. In this case, when there's an attachment,
> mail clients will choke on your non-standard mailto url and fail silently,
> which is worse than showing up without attachments.
> 
> How about adding an --attach option to winebrowser and replacing the
> ShellExecute call with CreateProcess? I.e. make MAPISendMail fetch
> the preferred mail client from the registry and start it with the mailto
> url on the command line. If it's winebrowser and if there are attachments,
> add them through the --attach parameter.
> 
>  -Hans

This makes sense to me.  I do have a couple of questions.

Can you refer me to examples of command line parameter parsing which I could
use in winebrowser?

Are you referring to registry key [Software\\Classes\mailto\shell\open\command]
as the preferred mail client?

Should I replace the ShellExecuteA call with CreateProcessA only when I have
attachments or in all cases?



From actong88 at gmail.com  Fri Dec 21 17:53:54 2007
From: actong88 at gmail.com (Allan Tong)
Date: Fri, 21 Dec 2007 18:53:54 -0500
Subject: [1/4 try 3] wined3d: Activate GL context before making any GL
	calls in stretch_rect_fbo
In-Reply-To: <d658b69e0712210635n70d388d7g77e95633822388df@mail.gmail.com>
References: <d75158870712202050x64771d4cuf653a64088051c32@mail.gmail.com>
	<200712211403.04327.stefandoesinger@gmx.at>
	<d658b69e0712210635n70d388d7g77e95633822388df@mail.gmail.com>
Message-ID: <d75158870712211553l16e9aaebj2d7c281483064234@mail.gmail.com>

On Dec 21, 2007 9:35 AM, H. Verbeet <hverbeet at gmail.com> wrote:
> On 21/12/2007, Stefan D?singer <stefandoesinger at gmx.at> wrote:
> > Did you try your patches with the Deferred Shading sample from codesampler?
> > http://www.codesampler.com/usersrc/usersrc_7.htm . It uses multiple render
> > targets, so it is a quite interesting test.
> >
> Keep in mind that that one needs a couple of hacks to the format table
> to work properly though.

I didn't try it.  Do you know what hacks are necessary?

> In patch 2, I was a bit confused by moving the "This->activeContext"
> assignment inside Init3D, I first thought you would remove it. But otherwise
> it looks good to me as well.

I was running into a problem where last_draw_buffer was not set to
anything right after device initialization, but I'm not sure if it's
still a problem with the current patches.  It may be an issue if for
example after the device is initialized, ActivateContext is only
called on lastActiveRenderTarget (front or back buffer).  If some code
then bound a FBO outside of ActivateContext, the next call to
ActivateContext (again with lastActiveRenderTarget) would try
resetting the framebuffer binding to 0 and set the draw buffer to
context->last_draw_buffer since lastActiveRenderTarget still hasn't
changed, but context->last_draw_buffer is still 0 since we never
updated it after initializing the device.

> > Patch 3 is ok too, keeping track of the currently bound fbo in the context is
> > good. Unrelated to this patch we should look if the glBindFramebufferEXT(...,
> > 0) calls could be replaced with calling ActivateContext, and if that makes
> > sense(it's probably not a good idea everywhere).
> >
>
> Personally, I don't like keeping track of flags like this all over the place:
> >          GL_EXTCALL(glBindFramebufferEXT(GL_FRAMEBUFFER_EXT, 0));
> > +        This->activeContext->last_fbo = 0;
> I'd rather ban naked glBindFramebufferEXT() calls and either allow
> bind_fbo() to accept NULL for the fbo parameter, or create an
> unbind_fbo() function. Another option could be to handle framebuffer
> selection completely in ActivateContext(). Arguably that's the proper
> way to do it, but it would be a bit more involved, and would require
> extending ActivateContext with a "source_surface" parameter, to handle
> stretch_rect_fbo(), and possibly a few more CTXUSAGE types.

I guess I could see it getting out of hand, especially since this
patch only tracks fbos, but not the fbo attachments or even any
glDrawBuffer calls made outside of ActivateContext, all of which are
potentially problematic for ActivateContext.  I like the idea of
banning the use of
glBindFramebuffer/glDrawBuffer/glFramebufferTexture/glFramebufferRenderbuffer
outside of ActivateContext, but that may not be possible.  Maybe just
try to merge as many of these calls into ActivateContext as can be
easily done and have a strategy in place for the rest, e.g. code that
changes fbo or draw buffer state has to either update wined3d state to
match the new GL state or it needs to make sure that it restores the
GL state so that it agrees with what wined3d thinks the GL state is.

> What I do wonder about is why CTXUSAGE_BLIT even binds dst_fbo though.
> It's certainly not used in any of the places that currently use
> dst_fbo, and I'm not sure it makes sense to bind dst_fbo in any of the
> places that does call ActivateContext that way.

I was looking at some places that currently don't bind to dst_fbo,
e.g. flush_to_framebuffer_drawpixels.  It looks wrong to me for
offscreen fbo surfaces, but admittedly I'm not too familiar with when
that's used.

> > Other good testing applications are Half Life 2(demo is ok), it uses color
> > buffers and depth buffers with different sizes. Battlefield 2(not 2142, no
> > idea if there is a demo) depends on the depth blitting. Bioshock(demo is ok)
> > is a case of an application that crashes due to multithreading issues because
> > apply_fbo_state is applied before calling ActivateContext.
> >
> BF2142 does have a demo, but afaik it allows online play only, which
> makes testing a bit awkward. It doesn't need depth blitting like BF2,
> but does have HDR effects, IIRC. Both BF2 and BF2142 require support
> for animated cursors.

I tried Half Life 2 and Bioshock.  I'll take a look at BF2.

Thanks for all the comments.

 - Allan

From dank at kegel.com  Fri Dec 21 18:54:29 2007
From: dank at kegel.com (Dan Kegel)
Date: Fri, 21 Dec 2007 16:54:29 -0800
Subject: Alexandre Julliard : kernel32: Store the initial directory as a
	full path in the process parameters
Message-ID: <a71bd89a0712211654n2d291a34p35f402fade347a9a@mail.gmail.com>

That patch seems to have caused a new batch
of valgrind warnings:
http://kegel.com/wine/valgrind/logs-2007-12-21/vg-kernel32_process-diff.txt
e.g.
+ Conditional jump or move depends on uninitialised value(s)
+    at  NtAllocateVirtualMemory (virtual.c:1359)
+    by  RtlCreateProcessParameters (env.c:461)
+    by  create_process (process.c:1209)
+    by  CreateProcessW (process.c:1707)
+    by  CreateProcessA (process.c:1604)
+    by  test_Directory (process.c:839)
+    by  func_process (process.c:1410)
+    by  run_test (test.h:387)
+    by  main (test.h:436)
...
+ Conditional jump or move depends on uninitialised value(s)
+    at  create_process (server.h:76)
+    by  CreateProcessW (process.c:1707)
+    by  CreateProcessA (process.c:1604)
+    by  test_Directory (process.c:839)
+    by  func_process (process.c:1410)
+    by  run_test (test.h:387)
+    by  main (test.h:436)
-- 
Wine for Windows ISVs: http://kegel.com/wine/isv


From dank at kegel.com  Fri Dec 21 21:01:22 2007
From: dank at kegel.com (Dan Kegel)
Date: Fri, 21 Dec 2007 19:01:22 -0800
Subject: ole32: fix wrong timeout check
Message-ID: <a71bd89a0712211901y7de6094euafa478ad6d112b61@mail.gmail.com>

>-        if ((dwTimeout != INFINITE) && (start_time + dwTimeout >= now))
>+        if ((dwTimeout != INFINITE) && (now >= start_time + dwTimeout))


From jjmckenzie51 at sprintpcs.com  Fri Dec 21 21:24:44 2007
From: jjmckenzie51 at sprintpcs.com (James McKenzie)
Date: Fri, 21 Dec 2007 20:24:44 -0700
Subject: mapi32: Resolve FIXME regarding attachment lists in MAPISendMail
	function
In-Reply-To: <558b2f5c0712210830j5045bf86t7674c986544247c5@mail.gmail.com>
References: <476AF853.2070704@legis.state.ak.us>
	<200712211136.25562.hans@it.vu.nl>
	<558b2f5c0712210830j5045bf86t7674c986544247c5@mail.gmail.com>
Message-ID: <476C837C.1050703@sprintpcs.com>

Lei Zhang wrote:
> On Dec 21, 2007 2:36 AM, Hans Leidekker <hans at it.vu.nl> wrote:
>   
>> On Friday 21 December 2007 00:18:43 Mark Neyhart wrote:
>>
>>     
>>> Extend the MAILTO: string produced by the MAPISendMail function to include
>>> an attachment list. Because I was unable to find any standard for MAILTO
>>> regarding attachments, I constructed the attachment list in the format
>>> specified for Mozilla command line options.
>>>       
>> Breaking other mail clients to gain attachments support for Mozilla is not
>> acceptable tradeoff IMO.
>>
>>  -Hans
>>
>>
>>
>>     
>
> Mozilla and Thunderbird do not support attachments via mailtos. At
> least not on Linux.
>
> https://bugzilla.mozilla.org/show_bug.cgi?id=99055#c6
>
> - Lei
>
>
>   
Mozilla Mail and Thunderbird do not support mail attachments through the
methods used by other mail clients
and the Thunderbird team plans on not fixing this (the bug above should
be closed as WONTFIX if I remember
correctly from my work with OpenOffice.org for the Mac.)

Thus creating a patch for this method is worthless for both Thunderbird
as it may/may not work with the next
major release and will not work with any other Linux/Mac mail program
(Mail for the Mac works in the same manner
as does most Linux mailers.) 

Mailto: does work for Outlook and its ilk.

James McKenzie


From hans at it.vu.nl  Sat Dec 22 03:21:38 2007
From: hans at it.vu.nl (Hans Leidekker)
Date: Sat, 22 Dec 2007 10:21:38 +0100
Subject: mapi32: Resolve FIXME regarding attachment lists in MAPISendMail
	function
In-Reply-To: <476C361B.2040501@legis.state.ak.us>
References: <476AF853.2070704@legis.state.ak.us>
	<200712212102.16822.hans@it.vu.nl>
	<476C361B.2040501@legis.state.ak.us>
Message-ID: <200712221021.38933.hans@it.vu.nl>

On Friday 21 December 2007 22:54:35 Mark Neyhart wrote:

> Can you refer me to examples of command line parameter parsing which I could
> use in winebrowser?

Many apps under programs/ do command line parsing. Look at winepath for
example, which handles both long and short options.

> Are you referring to registry key [Software\\Classes\mailto\shell\open\command]
> as the preferred mail client?

Yes.

> Should I replace the ShellExecuteA call with CreateProcessA only when I have
> attachments or in all cases?

ShellExecute does elaborate argument expansion that you don't want to
duplicate so it's probably best to just make an exception when there
are attachments and winebrowser is the preferred client.

 -Hans


From alexd4 at inbox.lv  Sat Dec 22 16:37:32 2007
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Sat, 22 Dec 2007 14:37:32 -0800
Subject: ole32: fix wrong timeout check
In-Reply-To: <a71bd89a0712211901y7de6094euafa478ad6d112b61@mail.gmail.com>
References: <a71bd89a0712211901y7de6094euafa478ad6d112b61@mail.gmail.com>
Message-ID: <476D91AC.9090404@inbox.lv>

Yeah these calculations are a headache. I could probably write

now < start_time || now >= start_time + dwTimeout

to at least avoid a "hang" if GetTickCount counter overflows. This won't solve 
not waiting the required time if, say, start_time + dwTimeout overflows, and 
that can also be a problem (for example, I found this bug by bisecting a 
regression in an installer that happened because the function didn't properly 
wait). To be really purist, we would probably need a macro or a function with 
branching that correctly handles all possible overflow situations and tells if 
the required interval elapsed between "tick" values A and B. I wonder if a patch 
like that would be accepted, though, and also in what file this macro/function 
could be implemented?

This seems to be pretty widespread, too, one of CoWaitForMultipleHandles callers 
- RPC_GetLocalClassObject - now also has a similar timeout check.

Dan Kegel wrote:
>> -        if ((dwTimeout != INFINITE) && (start_time + dwTimeout >= now))
>> +        if ((dwTimeout != INFINITE) && (now >= start_time + dwTimeout))
> 
>>From time immemorial, it has been drummed into me
> that one should always handle wraparound when
> checking timers.  So something like
>     DWORD delta = now - start_time;
>     if (dwTimeout != INFINITE) && (delta < 0x80000000UL) && (delta > dwTimeout))
> might be more correct... I used to always use
> a signed variable for this, but C compilers
> now treat overflow of signed variables as
> a conceptual error, so the subtraction has to be unsigned,
> There's probably a cleaner way to code this,
> but doing the subtraction to get the delta time,
> and then comparing against the maximum desired
> delta time, is the way to avoid trouble at rollover.
> - Dan
> 
> 



From lionel_debroux at yahoo.fr  Sat Dec 22 04:30:05 2007
From: lionel_debroux at yahoo.fr (Lionel_Debroux)
Date: Sat, 22 Dec 2007 11:30:05 +0100
Subject: Calls to realloc-type functions in Wine...
Message-ID: <476CE72D.1090209@yahoo.fr>

Hi everybody,

One of the patches I sent on December 9th contained a fix for two
constructs of the form
ptr = msi_realloc (ptr, newsize);
I spotted these constructs while investigating on unrelated "potential
leak" entries of Michael Stefaniuc's list of potential issues found by
Smatch.

It's very unlikely that *realloc fails, but if it does, this leaks some
memory (or may fault, if the code is not protected against *realloc
returning NULL).

Last week, I spotted another construct of that form.
That prompted me to make a case-insensitive search of "realloc" in the
whole Wine tree. Such a simple search was bound to turn a significant
amount of noise (comments, TRACE/WARN, even correct uses of realloc,
etc.), but it would also reveal other (probably) incorrect uses of
realloc-type functions.


The sorted and hand-filtered results of the search I made December 14th
are attached. I didn't update the file before writing this mail because
it didn't make much sense: this kind of info gets outdated fast.
In short: I'd say that in the list, at least a couple hundred calls to
realloc-type functions are constructs of the form
ptr = [realloc] (..., ptr, ...);
And to be safe, all entries on the list would have to be investigated
(if nothing else, to check for leaks).


Do you think this kind of code be checked and fixed for the Wine 1.0
milestone ? That looks doable, if the usual maintainers of /
contributors to each piece of code participate.


Regards,
Lionel.
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: realloc_in_wine.txt
Url: http://www.winehq.org/pipermail/wine-devel/attachments/20071222/255b3c0b/attachment-0001.txt 

From kai.blin at gmail.com  Sat Dec 22 07:59:17 2007
From: kai.blin at gmail.com (Kai Blin)
Date: Sat, 22 Dec 2007 14:59:17 +0100
Subject: Calls to realloc-type functions in Wine...
In-Reply-To: <476CE72D.1090209@yahoo.fr>
References: <476CE72D.1090209@yahoo.fr>
Message-ID: <200712221459.22187.kai.blin@gmail.com>

On Saturday 22 December 2007 11:30:05 Lionel_Debroux wrote:
> ./dlls/secur32/dispatcher.c:152

This one is safe, as buf is only assigned to helper->com_buf on success of the 
call. helper->com_buf is free()d when the user correctly shuts down the 
security context.

Cheers,
Kai

-- 
Kai Blin
WorldForge developer  http://www.worldforge.org/
Wine developer        http://wiki.winehq.org/KaiBlin
Samba team member     http://www.samba.org/samba/team/
--
Will code for cotton.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071222/4aa8a691/attachment.pgp 

From thunderbird2k at gmx.net  Sat Dec 22 09:15:21 2007
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Sat, 22 Dec 2007 16:15:21 +0100
Subject: wined3d: fix check for P8 render target
In-Reply-To: <476CEC39.9010804@inbox.lv>
References: <476CEC39.9010804@inbox.lv>
Message-ID: <20071222151521.93140@gmx.net>

> Hi.
> 
> I think this part of d3dfmt_p8_init_palette has a bug, because it appears
> to be
> checking that render target is a render target. Incorrectly going into
> index_in_alpha codepath here causes this bug:
> 
> http://bugs.winehq.org/show_bug.cgi?id=10797
> 
> in Aliens vs Predator 1 game - it prefers P8 textures and sets color key
> on some
> textures for transparency and alpha channel is wrong on such textures in
> game.
> 
> ---
>      dlls/wined3d/surface.c |    7 ++-----
>      1 files changed, 2 insertions(+), 5 deletions(-)
> 
> 

Hi,

Unfortunately this patch is not correct and I haven't looked exactly what the real issue is.

In short most hardware (except if it has GL_EXT_paletted_texture) doesn't support 8bit textures and most of the time we do 8bit->32bit conversion in software. On hardware that supports fragment shaders we perform the conversion using a shader and this is a lot faster (it is 'free'). The palette is uploaded in d3dfmt_p8_init_palette. 

So the p8 conversion is done in hardware but in some cases we need to read back the data from the card. The p8 -> 32bit conversion was done behind the back of the game, so the game expects 8bit data back. A palette contains upto 256 entries and each color can appear multiple times in the palette. So the inverse palette lookup doesn't have a 1:1 mapping and this is problematic.

The trick we do is to store the 8bit color index in the alpha component of the palette and use this to read back the correct index during the 32bit->8bit conversion. The problem is that most games need alpha and for that reason we only use this 'hack' when the primary render target is using 8bit. In this case you can't be using 3D and only old apps like StarCraft use this.

Your game is likely using some p8 textures and is likely suffering from the 32 -> 8bit problem. I haven't check AVP but if this is the real issue there it can't be fixed. It would break other games like GTA4 and others.

Regards,
Roderick Colenbrander
-- 
Psssst! Schon vom neuen GMX MultiMessenger geh?rt?
Der kann`s mit allen: http://www.gmx.net/de/go/multimessenger?did=10


From hzhrong at gmail.com  Sat Dec 22 09:46:05 2007
From: hzhrong at gmail.com (Huang, Zhangrong)
Date: Sat, 22 Dec 2007 23:46:05 +0800
Subject: ole32: Fix a failed call to DllGetClassObject while retrieving
	class object interface pointer.
In-Reply-To: <476ABF8B.1080509@codeweavers.com>
References: <b4cc5a3d0712200653t738a43c4rcbd00ff8e779e128@mail.gmail.com>
	<476ABF8B.1080509@codeweavers.com>
Message-ID: <b4cc5a3d0712220746y4a883afau649a5f22aec8a59@mail.gmail.com>

Hi,
Sorry for the delay.
Here is a test, pls import the attached registry files, and copy
native activeds.dll, adsldpc.dll,
adsldp.dll to your windows system32 dir, and patch
wine/dlls/ole32/tests/moniker.c

Then run the test:
$ ../../../wine ole32_test.exe.so moniker
err:ole:apartment_getclassobject DllGetClassObject returned error 0x80004002
err:ole:create_server class {228d9a81-c302-11cf-9aa4-00aa004a5691} not
registered
fixme:ole:CoGetClassObject CLSCTX_REMOTE_SERVER not supported
err:ole:CoGetClassObject no class object
{228d9a81-c302-11cf-9aa4-00aa004a5691} could be created for context
0x15
moniker.c:783: Test failed: ****************LDAP**************
moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.

after my patch:
$ ../../../wine ole32_test.exe.so moniker
moniker.c:783: Test failed: ****************LDAP**************
moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.

Although the test failed, but loading class
{228d9a81-c302-11cf-9aa4-00aa004a5691} success.


2007/12/21, Robert Shearman <rob at codeweavers.com>:
> Huang, Zhangrong wrote:
> > See dlls/ole32/compobj.c,
> >
> > static HRESULT apartment_getclassobject(struct apartment *apt, LPCWSTR dllpath,
> >                                         BOOL apartment_threaded,
> >                                         REFCLSID rclsid, REFIID riid,
> > void **ppv)
> > {
> > ...................
> >     if (SUCCEEDED(hr))
> >     {
> > ..................
> >         TRACE("calling DllGetClassObject %p\n",
> > apartment_loaded_dll->dll->DllGetClassObject);
> >         /* OK: get the ClassObject */
> >         hr = apartment_loaded_dll->dll->DllGetClassObject(rclsid, riid, ppv);
> >                                                                   ^^^^
> >         if (hr != S_OK)
> >             ERR("DllGetClassObject returned error 0x%08x\n", hr);
> >     }
> > ..............
> > }
> >
> > Reference to http://msdn2.microsoft.com/en-us/library/ms680760.aspx,
> >
> > riid
> >
> >     [in] Reference to the identifier of the interface that the caller
> >     is to use to communicate with the class object. Usually, this is
> >     IID_IClassFactory (defined in the OLE headers as the interface
> >     identifier for IClassFactory).
> >
>
> This doesn't mean anything other than CoCreateInstance is usually used
> instead of CoGetClassObject (and CoCreateInstance always passes in
> IID_IClassFactory for the IID).

It's failed when calling MkParseDisplayName.

>
> > We can't pass riid to DllGetClassObject directly sometimes, causes some dlls'
> > DllGetClassObject (like native adsldp.dll) can only return reference-counted
> > pointer to class factory via IID_IClassFactory, for retrieving the
> > pointer to the
> > class object interface requested in riid, we must try another way.
> >
>
> Thank you for your patch, but this behaviour seems a little strange and
> needs a little more investigation before I am happy that it is correct.
> What parameters are being passed in to CoGetClassObject to cause the
> call to fail for you?

That's how MS does, I see this strange behaviour happening through
assembly debugging.
First time calling DllGetClassObject using riid, and it's failed, then
trying IID_IClassFactory.

Anyway, what's DllGetClassObject return depends on its implementation,
it can be a pointer to
ClassFactory or a pointer to class object, we should try both.

>
> --
> Rob Shearman
>
>


-- 
$ apt-get moo
         (__)
         (oo)
   /------\/
  / |    ||
 *  /\---/\
    ~~   ~~
...."Have you mooed today?"...
-------------- next part --------------
A non-text attachment was scrubbed...
Name: LDAP.reg
Type: application/octet-stream
Size: 476 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071222/0441f2da/attachment.obj 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: tests_moniker.diff
Type: text/x-patch
Size: 1854 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071222/0441f2da/attachment.bin 

From alexd4 at inbox.lv  Sat Dec 22 19:52:12 2007
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Sat, 22 Dec 2007 17:52:12 -0800
Subject: wined3d: fix check for P8 render target
In-Reply-To: <20071222151521.93140@gmx.net>
References: <476CEC39.9010804@inbox.lv> <20071222151521.93140@gmx.net>
Message-ID: <476DBF4C.10608@inbox.lv>

Hi.

Yes, exactly, the AVP1 game is using p8 textures and color keys on some of them
for transparency.

The thing is, the "index_in_alpha" hack DOES get enabled on its P8 3D textures,
and that's the problem I'm trying to fix. I don't see the "primary render target
is p8" check in the code, instead it looks like it checks that render_targets[0]
is a render target.

In patch I proposed I check that the passed surface is a render target, and,
since it's passed to d3dfmt_p8_init_palette then I guess it means there's a p8
render target and in such case the index_in_alpha hack is enabled. Although I
don't check anything beyond just that it's a render target, I guess it could be
some offscreen buffer. Is that the problem, essentially?

Regarding GTA - I could try looking for demo for tests, but can you clarify - is
it really GTA4? GTA4 is upcoming game AFAIK, maybe you mean GTA3?

Roderick Colenbrander wrote:
> 
> Hi,
> 
> Unfortunately this patch is not correct and I haven't looked exactly what the real issue is.
> 
> In short most hardware (except if it has GL_EXT_paletted_texture) doesn't support 8bit textures and most of the time we do 8bit->32bit conversion in software. On hardware that supports fragment shaders we perform the conversion using a shader and this is a lot faster (it is 'free'). The palette is uploaded in d3dfmt_p8_init_palette. 
> 
> So the p8 conversion is done in hardware but in some cases we need to read back the data from the card. The p8 -> 32bit conversion was done behind the back of the game, so the game expects 8bit data back. A palette contains upto 256 entries and each color can appear multiple times in the palette. So the inverse palette lookup doesn't have a 1:1 mapping and this is problematic.
> 
> The trick we do is to store the 8bit color index in the alpha component of the palette and use this to read back the correct index during the 32bit->8bit conversion. The problem is that most games need alpha and for that reason we only use this 'hack' when the primary render target is using 8bit. In this case you can't be using 3D and only old apps like StarCraft use this.
> 
> Your game is likely using some p8 textures and is likely suffering from the 32 -> 8bit problem. I haven't check AVP but if this is the real issue there it can't be fixed. It would break other games like GTA4 and others.
> 
> Regards,
> Roderick Colenbrander





From juan.lang at gmail.com  Sat Dec 22 09:59:27 2007
From: juan.lang at gmail.com (Juan Lang)
Date: Sat, 22 Dec 2007 07:59:27 -0800
Subject: Calls to realloc-type functions in Wine...
In-Reply-To: <476CE72D.1090209@yahoo.fr>
References: <476CE72D.1090209@yahoo.fr>
Message-ID: <3a768c550712220759g39a9b6d9r692c08b9b308a25a@mail.gmail.com>

Hi Lionel,

> It's very unlikely that *realloc fails, but if it does, this leaks some
> memory (or may fault, if the code is not protected against *realloc
> returning NULL).

Note that it's debatable what the best course of action here is.  It's
true that in case of failure, the original pointer should be freed.
But a fault might be acceptable too - if we're out of memory, what can
we possibly do to recover?  At least that's one line of reasoning.

> That prompted me to make a case-insensitive search of "realloc" in the
> whole Wine tree. Such a simple search was bound to turn a significant
> amount of noise (comments, TRACE/WARN, even correct uses of realloc,
> etc.), but it would also reveal other (probably) incorrect uses of
> realloc-type functions.

The results you sent aren't very useful without more investigation.
This might be a useful janitorial project, and might be better tracked
on the wiki than on this list.
--Juan


From lionel_debroux at yahoo.fr  Sat Dec 22 10:38:36 2007
From: lionel_debroux at yahoo.fr (Lionel_Debroux)
Date: Sat, 22 Dec 2007 17:38:36 +0100
Subject: Calls to realloc-type functions in Wine...
In-Reply-To: <3a768c550712220759g39a9b6d9r692c08b9b308a25a@mail.gmail.com>
References: <476CE72D.1090209@yahoo.fr>
	<3a768c550712220759g39a9b6d9r692c08b9b308a25a@mail.gmail.com>
Message-ID: <476D3D8C.5030703@yahoo.fr>

Hi Juan,

> The results you sent aren't very useful without more investigation.
Indeed.
I have started doing that on msi (which is the first place where I
spotted such a construct, but as the list shows, it's far from being the
only one), and sent a patch this morning.
However, I have neither the time, nor the knowledge of the Win32 API, to
correctly fix all cases :)

> This might be a useful janitorial project, and might be better
> tracked on the wiki than on this list.
Agreed.
Last week, between other things, I asked Michael Stefaniuc exactly that.
But he didn't reply yet, I know he's busy (or either mail was silently
eaten by a spam filter...).


Lionel.


From truiken at gmail.com  Sat Dec 22 10:55:22 2007
From: truiken at gmail.com (James Hawkins)
Date: Sat, 22 Dec 2007 10:55:22 -0600
Subject: msi: correctly handle return value of msi_realloc. [1/2]
In-Reply-To: <476CE6E5.4060200@yahoo.fr>
References: <476CE6E5.4060200@yahoo.fr>
Message-ID: <22821af30712220855q602ddc0bnda8be622f14258f4@mail.gmail.com>

On Dec 22, 2007 4:28 AM, Lionel_Debroux <lionel_debroux at yahoo.fr> wrote:
> Several functions in dlls/msi/action.c and dlls/msi/database.c use
> constructs of the form
> ptr = msi_realloc (ptr, newsize);
>
> In the (admittedly very unlikely) situation where msi_realloc fails,
> this leaks, or even faults:
> filename = msi_realloc(filename, len * sizeof(WCHAR) + sizeof(szlnk));
> memcpy(filename + len, szlnk, sizeof(szlnk));
>
> 2007-12-14  Lionel Debroux <lionel_debroux at yahoo.fr>
>         * dlls/msi/action.c, dlls/msi/database.c:
>         msi: correctly handle return value of msi_realloc.
>

-        filename = msi_realloc(filename, len * sizeof(WCHAR) + sizeof(szlnk));
+        p = msi_realloc(filename, len * sizeof(WCHAR) + sizeof(szlnk));
+        if (!p)
+        {
+            msi_free(target_folder);
+            msi_free(filename);
+            ERR("Not enough memory to grow filename\n");
+            goto err;
+        }
+        filename = p;

Don't add ERRs for out of memory...and you need to return
ERROR_OUTOFMEMORY in these cases.

-- 
James Hawkins


From truiken at gmail.com  Sat Dec 22 11:03:03 2007
From: truiken at gmail.com (James Hawkins)
Date: Sat, 22 Dec 2007 11:03:03 -0600
Subject: msi: fix memory leaks on error paths (found by Smatch). [2/2]
In-Reply-To: <476CE70D.7030802@yahoo.fr>
References: <476CE70D.7030802@yahoo.fr>
Message-ID: <22821af30712220903u5e82bec0lf0f2f268193b8894@mail.gmail.com>

On Dec 22, 2007 4:29 AM, Lionel_Debroux <lionel_debroux at yahoo.fr> wrote:
> "msi_load_summary_properties" and "MsiSourceListAddSourceExW" in
> dlls/msi/package.c and dlls/msi/source.c get flagged by Michael
> Stefaniuc's unfree-wine.pl script.
>
> 2007-12-21  Lionel Debroux <lionel_debroux at yahoo.fr>
>         * dlls/msi/package.c, dlls/msi/source.c:
>         msi: fix memory leaks on error paths (found by Smatch).
>

     if (rc != ERROR_SUCCESS)
     {
+        msi_free( package_code );
         WARN("Unable to query rev number: %d\n", rc);
         goto done;
     }

Save a line and move the msi_free a couple lines down to the done: block.

+    {
+        msi_free(source); /* This is correct because msi strdupW
calls msi_alloc. */
         return rc;
+    }

Are you serious?  Please take that comment out.  Either way the fix
isn't really right.  All you need is a 'goto done' because you're
still leaking the reg handles.

-- 
James Hawkins


From truiken at gmail.com  Sat Dec 22 11:06:58 2007
From: truiken at gmail.com (James Hawkins)
Date: Sat, 22 Dec 2007 11:06:58 -0600
Subject: ole32: Fix a failed call to DllGetClassObject while retrieving
	class object interface pointer.
In-Reply-To: <b4cc5a3d0712220746y4a883afau649a5f22aec8a59@mail.gmail.com>
References: <b4cc5a3d0712200653t738a43c4rcbd00ff8e779e128@mail.gmail.com>
	<476ABF8B.1080509@codeweavers.com>
	<b4cc5a3d0712220746y4a883afau649a5f22aec8a59@mail.gmail.com>
Message-ID: <22821af30712220906o2b313fe6oc1fbea0657f92f58@mail.gmail.com>

On Dec 22, 2007 9:46 AM, Huang, Zhangrong <hzhrong at gmail.com> wrote:
> Hi,
> Sorry for the delay.
> Here is a test, pls import the attached registry files, and copy
> native activeds.dll, adsldpc.dll,
> adsldp.dll to your windows system32 dir, and patch
> wine/dlls/ole32/tests/moniker.c
>
> Then run the test:
> $ ../../../wine ole32_test.exe.so moniker
> err:ole:apartment_getclassobject DllGetClassObject returned error 0x80004002
> err:ole:create_server class {228d9a81-c302-11cf-9aa4-00aa004a5691} not
> registered
> fixme:ole:CoGetClassObject CLSCTX_REMOTE_SERVER not supported
> err:ole:CoGetClassObject no class object
> {228d9a81-c302-11cf-9aa4-00aa004a5691} could be created for context
> 0x15
> moniker.c:783: Test failed: ****************LDAP**************
> moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.
>
> after my patch:
> $ ../../../wine ole32_test.exe.so moniker
> moniker.c:783: Test failed: ****************LDAP**************
> moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.
>
> Although the test failed, but loading class
> {228d9a81-c302-11cf-9aa4-00aa004a5691} success.
>
>
> 2007/12/21, Robert Shearman <rob at codeweavers.com>:
> > Huang, Zhangrong wrote:
> > > See dlls/ole32/compobj.c,
> > >
> > > static HRESULT apartment_getclassobject(struct apartment *apt, LPCWSTR dllpath,
> > >                                         BOOL apartment_threaded,
> > >                                         REFCLSID rclsid, REFIID riid,
> > > void **ppv)
> > > {
> > > ...................
> > >     if (SUCCEEDED(hr))
> > >     {
> > > ..................
> > >         TRACE("calling DllGetClassObject %p\n",
> > > apartment_loaded_dll->dll->DllGetClassObject);
> > >         /* OK: get the ClassObject */
> > >         hr = apartment_loaded_dll->dll->DllGetClassObject(rclsid, riid, ppv);
> > >                                                                   ^^^^
> > >         if (hr != S_OK)
> > >             ERR("DllGetClassObject returned error 0x%08x\n", hr);
> > >     }
> > > ..............
> > > }
> > >
> > > Reference to http://msdn2.microsoft.com/en-us/library/ms680760.aspx,
> > >
> > > riid
> > >
> > >     [in] Reference to the identifier of the interface that the caller
> > >     is to use to communicate with the class object. Usually, this is
> > >     IID_IClassFactory (defined in the OLE headers as the interface
> > >     identifier for IClassFactory).
> > >
> >
> > This doesn't mean anything other than CoCreateInstance is usually used
> > instead of CoGetClassObject (and CoCreateInstance always passes in
> > IID_IClassFactory for the IID).
>
> It's failed when calling MkParseDisplayName.
>
> >
> > > We can't pass riid to DllGetClassObject directly sometimes, causes some dlls'
> > > DllGetClassObject (like native adsldp.dll) can only return reference-counted
> > > pointer to class factory via IID_IClassFactory, for retrieving the
> > > pointer to the
> > > class object interface requested in riid, we must try another way.
> > >
> >
> > Thank you for your patch, but this behaviour seems a little strange and
> > needs a little more investigation before I am happy that it is correct.
> > What parameters are being passed in to CoGetClassObject to cause the
> > call to fail for you?
>
> That's how MS does, I see this strange behaviour happening through
> assembly debugging.
> First time calling DllGetClassObject using riid, and it's failed, then
> trying IID_IClassFactory.
>

Disassembling what?

-- 
James Hawkins


From thunderbird2k at gmx.net  Sat Dec 22 11:24:15 2007
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Sat, 22 Dec 2007 18:24:15 +0100
Subject: wined3d: fix check for P8 render target
In-Reply-To: <476DBF4C.10608@inbox.lv>
References: <476CEC39.9010804@inbox.lv> <20071222151521.93140@gmx.net>
	<476DBF4C.10608@inbox.lv>
Message-ID: <20071222172415.192440@gmx.net>

> Hi.
> 
> Yes, exactly, the AVP1 game is using p8 textures and color keys on some of
> them
> for transparency.
> 
> The thing is, the "index_in_alpha" hack DOES get enabled on its P8 3D
> textures,
> and that's the problem I'm trying to fix. I don't see the "primary render
> target
> is p8" check in the code, instead it looks like it checks that
> render_targets[0]
> is a render target.

Try to see if the attached patch fixes the problem. It seems that at some point I didn't check whether the target is P8 in this function while I check for it in other places. I have checked it using all my p8 testcases and it seems to work fine but I don't have AVP. If it works I'll submit it.

Roderick


-- 
GMX FreeMail: 1 GB Postfach, 5 E-Mail-Adressen, 10 Free SMS.
Alle Infos und kostenlose Anmeldung: http://www.gmx.net/de/go/freemail
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0002-Make-sure-the-format-of-the-primary-render-target-is.patch
Type: text/x-diff
Size: 0 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071222/d72c3bb2/attachment.patch 

From thunderbird2k at gmx.net  Sat Dec 22 11:25:57 2007
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Sat, 22 Dec 2007 18:25:57 +0100
Subject: [PATCH] Make sure the format of the primary render target is P8 before storing the index in the alpha component.
Message-ID: <mailman.173.1198344274.6275.wine-devel@winehq.org>

---
 dlls/wined3d/surface.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/dlls/wined3d/surface.c b/dlls/wined3d/surface.c
index 30d6507..3e34286 100644
--- a/dlls/wined3d/surface.c
+++ b/dlls/wined3d/surface.c
@@ -1931,7 +1931,7 @@ static void d3dfmt_p8_init_palette(IWineD3DSurfaceImpl *This, BYTE table[256][4]
     if (device->render_targets && device->render_targets[0]) {
         IWineD3DSurfaceImpl* render_target = (IWineD3DSurfaceImpl*)device->render_targets[0];
 
-        if(render_target->resource.usage & WINED3DUSAGE_RENDERTARGET)
+        if((render_target->resource.usage & WINED3DUSAGE_RENDERTARGET) && (render_target->resource.format == WINED3DFMT_P8))
             index_in_alpha = TRUE;
     }
 
-- 
1.5.3.4


--========GMX192441198344255398393--


From hzhrong at gmail.com  Sat Dec 22 12:25:36 2007
From: hzhrong at gmail.com (Huang, Zhangrong)
Date: Sun, 23 Dec 2007 02:25:36 +0800
Subject: ole32: Fix a failed call to DllGetClassObject while retrieving
	class object interface pointer.
In-Reply-To: <22821af30712220906o2b313fe6oc1fbea0657f92f58@mail.gmail.com>
References: <b4cc5a3d0712200653t738a43c4rcbd00ff8e779e128@mail.gmail.com>
	<476ABF8B.1080509@codeweavers.com>
	<b4cc5a3d0712220746y4a883afau649a5f22aec8a59@mail.gmail.com>
	<22821af30712220906o2b313fe6oc1fbea0657f92f58@mail.gmail.com>
Message-ID: <b4cc5a3d0712221025g3ba44bcay14f02396813c62a1@mail.gmail.com>

2007/12/23, James Hawkins <truiken at gmail.com>:
> On Dec 22, 2007 9:46 AM, Huang, Zhangrong <hzhrong at gmail.com> wrote:
> > Hi,
> > Sorry for the delay.
> > Here is a test, pls import the attached registry files, and copy
> > native activeds.dll, adsldpc.dll,
> > adsldp.dll to your windows system32 dir, and patch
> > wine/dlls/ole32/tests/moniker.c
> >
> > Then run the test:
> > $ ../../../wine ole32_test.exe.so moniker
> > err:ole:apartment_getclassobject DllGetClassObject returned error 0x80004002
> > err:ole:create_server class {228d9a81-c302-11cf-9aa4-00aa004a5691} not
> > registered
> > fixme:ole:CoGetClassObject CLSCTX_REMOTE_SERVER not supported
> > err:ole:CoGetClassObject no class object
> > {228d9a81-c302-11cf-9aa4-00aa004a5691} could be created for context
> > 0x15
> > moniker.c:783: Test failed: ****************LDAP**************
> > moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.
> >
> > after my patch:
> > $ ../../../wine ole32_test.exe.so moniker
> > moniker.c:783: Test failed: ****************LDAP**************
> > moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.
> >
> > Although the test failed, but loading class
> > {228d9a81-c302-11cf-9aa4-00aa004a5691} success.
> >
> >
> > 2007/12/21, Robert Shearman <rob at codeweavers.com>:
> > > Huang, Zhangrong wrote:
> > > > See dlls/ole32/compobj.c,
> > > >
> > > > static HRESULT apartment_getclassobject(struct apartment *apt, LPCWSTR dllpath,
> > > >                                         BOOL apartment_threaded,
> > > >                                         REFCLSID rclsid, REFIID riid,
> > > > void **ppv)
> > > > {
> > > > ...................
> > > >     if (SUCCEEDED(hr))
> > > >     {
> > > > ..................
> > > >         TRACE("calling DllGetClassObject %p\n",
> > > > apartment_loaded_dll->dll->DllGetClassObject);
> > > >         /* OK: get the ClassObject */
> > > >         hr = apartment_loaded_dll->dll->DllGetClassObject(rclsid, riid, ppv);
> > > >                                                                   ^^^^
> > > >         if (hr != S_OK)
> > > >             ERR("DllGetClassObject returned error 0x%08x\n", hr);
> > > >     }
> > > > ..............
> > > > }
> > > >
> > > > Reference to http://msdn2.microsoft.com/en-us/library/ms680760.aspx,
> > > >
> > > > riid
> > > >
> > > >     [in] Reference to the identifier of the interface that the caller
> > > >     is to use to communicate with the class object. Usually, this is
> > > >     IID_IClassFactory (defined in the OLE headers as the interface
> > > >     identifier for IClassFactory).
> > > >
> > >
> > > This doesn't mean anything other than CoCreateInstance is usually used
> > > instead of CoGetClassObject (and CoCreateInstance always passes in
> > > IID_IClassFactory for the IID).
> >
> > It's failed when calling MkParseDisplayName.
> >
> > >
> > > > We can't pass riid to DllGetClassObject directly sometimes, causes some dlls'
> > > > DllGetClassObject (like native adsldp.dll) can only return reference-counted
> > > > pointer to class factory via IID_IClassFactory, for retrieving the
> > > > pointer to the
> > > > class object interface requested in riid, we must try another way.
> > > >
> > >
> > > Thank you for your patch, but this behaviour seems a little strange and
> > > needs a little more investigation before I am happy that it is correct.
> > > What parameters are being passed in to CoGetClassObject to cause the
> > > call to fail for you?
> >
> > That's how MS does, I see this strange behaviour happening through
> > assembly debugging.
> > First time calling DllGetClassObject using riid, and it's failed, then
> > trying IID_IClassFactory.
> >
>
> Disassembling what?

Native ole32.dll, MkParseDisplayName calls adsldp.dll's
DllGetClassObject twice,
frist using IID_IParseDisplayName, second using IID_IClassFactory.


>
> --
> James Hawkins
>


-- 
$ apt-get moo
         (__)
         (oo)
   /------\/
  / |    ||
 *  /\---/\
    ~~   ~~
...."Have you mooed today?"...


From alexd4 at inbox.lv  Sat Dec 22 22:31:57 2007
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Sat, 22 Dec 2007 20:31:57 -0800
Subject: wined3d: fix check for P8 render target
In-Reply-To: <20071222172415.192440@gmx.net>
References: <476CEC39.9010804@inbox.lv> <20071222151521.93140@gmx.net>
	<476DBF4C.10608@inbox.lv> <20071222172415.192440@gmx.net>
Message-ID: <476DE4BD.3050608@inbox.lv>

Yes your patch fixes most problems (there are some remaining issues but they 
were not fixed by mine either).

Roderick Colenbrander wrote:
>> Hi.
>>
>> Yes, exactly, the AVP1 game is using p8 textures and color keys on some of
>> them
>> for transparency.
>>
>> The thing is, the "index_in_alpha" hack DOES get enabled on its P8 3D
>> textures,
>> and that's the problem I'm trying to fix. I don't see the "primary render
>> target
>> is p8" check in the code, instead it looks like it checks that
>> render_targets[0]
>> is a render target.
> 
> Try to see if the attached patch fixes the problem. It seems that at some point I didn't check whether the target is P8 in this function while I check for it in other places. I have checked it using all my p8 testcases and it seems to work fine but I don't have AVP. If it works I'll submit it.
> 
> Roderick
> 
> 
> 



From wine-devel at kievinfo.com  Sat Dec 22 12:54:17 2007
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sat, 22 Dec 2007 11:54:17 -0700
Subject: New bugzilla components (round 3)
Message-ID: <476D5D59.8050809@kievinfo.com>

Ok we talked and talked and talked and where did it all go? Where are the 
agreed upon changes?

If we can't agree on everything, then lets do parts that everyone is ok 
with. Then decide on more changes.


So far this what everyone was happy with:

wine-misc -> unknown (default selection)

test -> test (change description to "Conformance tests")
wine-advapi32 -> advapi32
wine-atl -> atl
wine-comctl32 -> comctl32
wine-console -> console
wine-crypt32 -> crypt32
wine-dbghelp -> dbghelp
wine-debug -> winedbg
wine-directx* -> directx*
wine-documentation -> documentation
wine-dos -> dos
wine-gdi-(printing) -> gdi32
wine-gdiplus -> gdiplus
wine-help -> hhctrl - Help viewer implementation
wine-kernel -> kernel32
wine-loader ->loader
wine-msi -> msi
wine-msvcrt -> msvcrt
wine-msxml -> msxml3
wine-ole -> ole
wine-opengl -> opengl
wine-quartz -> quartz
wine-richedit -> richedit
wine-setupapi -> setupapi
wine-shdocvw -> shdocvw
wine-shell32 -> shell32
wine-urlmon -> urlmon
wine-user -> user32
wine-usp10.dll -> usp10
wine-winelib -> winelib
wine-x11driver -> x11driver

Add new components:
-> wininet - Internet connectivity and Layer-7 protocols
-> wintrust - Cryptography and trust verifications
-> advpack - INF file based installation engine
-> imagehlp - PE binary file manipulations, signed file handling
-> shlwapi - Various shell helper functions
-> vdm - Wine 16-bit compatibility layer
-> comdlg32 - Common dialogs such as open/save/print/font

Remove:
Wine-Rebar



------------------------------
This is up for discussion:

New keywords:
ports - OS specific issues and portability
hardware - Issues communicating with HW such as serial/parallel/cdrom/usb
integration - Bugs related to Wine integration into OS (menu, MIME-types, look)
ipc - Communication between Wine processes or app tasks/processes/threads

New components:
-> fonts - Wine fonts
-> ntdll - NT-native API implementation
-> wineserver - The Wine "kernel"
-> build-env - Configure, Makefile and all related scripts


Need to reclassify bugs before removing:
wine-binary ->
wine-ipc ->
wine-gui ->
wine-patches ->
wine-ports ->
wine-multimedia ->
wine-net ->
wine-resources ->


Need ideas
wine-dotnet -> (should probably replace with mscoree and add "dotnet" keyword)
wine-files -> (keyword "filesystem"? Not many bugs but pretty important)


Vitaliy.


From alexd4 at inbox.lv  Sun Dec 23 00:37:05 2007
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Sat, 22 Dec 2007 22:37:05 -0800
Subject: skype regression (kernel32 / winedos)
Message-ID: <476E0211.3050401@inbox.lv>

Hi.

Unfortunately, Skype stopped working in git wine, it crashes shortly after 
start. Commit found via bisect:

http://source.winehq.org/git/wine.git/?a=commit;h=e2a366ce338d5b6b0f3c8962d70134f8d4e87f3b
kernel32: Forward interrupts in 32-bit code to winedos too

last messages with +io,+int:

warn:int:DOSVM_GetBuiltinHandler int1 not implemented, returning dummy handler
warn:int:DOSVM_GetBuiltinHandler int1 not implemented, returning dummy handler
warn:int:DOSVM_GetBuiltinHandler int1 not implemented, returning dummy handler
err:seh:raise_exception Exception frame is not in stack limits => unable to 
dispatch exception.
fixme:ntdll:RtlNtStatusToDosErrorNoTeb no mapping for 8000000a

Skype ver 3.5.0.239, wine mode - WinME


From truiken at gmail.com  Sat Dec 22 14:55:39 2007
From: truiken at gmail.com (James Hawkins)
Date: Sat, 22 Dec 2007 14:55:39 -0600
Subject: ole32: Fix a failed call to DllGetClassObject while retrieving
	class object interface pointer.
In-Reply-To: <b4cc5a3d0712221025g3ba44bcay14f02396813c62a1@mail.gmail.com>
References: <b4cc5a3d0712200653t738a43c4rcbd00ff8e779e128@mail.gmail.com>
	<476ABF8B.1080509@codeweavers.com>
	<b4cc5a3d0712220746y4a883afau649a5f22aec8a59@mail.gmail.com>
	<22821af30712220906o2b313fe6oc1fbea0657f92f58@mail.gmail.com>
	<b4cc5a3d0712221025g3ba44bcay14f02396813c62a1@mail.gmail.com>
Message-ID: <22821af30712221255h4778df15v9d714eae492d8ef5@mail.gmail.com>

On Dec 22, 2007 12:25 PM, Huang, Zhangrong <hzhrong at gmail.com> wrote:
> 2007/12/23, James Hawkins <truiken at gmail.com>:
>
> > On Dec 22, 2007 9:46 AM, Huang, Zhangrong <hzhrong at gmail.com> wrote:
> > > Hi,
> > > Sorry for the delay.
> > > Here is a test, pls import the attached registry files, and copy
> > > native activeds.dll, adsldpc.dll,
> > > adsldp.dll to your windows system32 dir, and patch
> > > wine/dlls/ole32/tests/moniker.c
> > >
> > > Then run the test:
> > > $ ../../../wine ole32_test.exe.so moniker
> > > err:ole:apartment_getclassobject DllGetClassObject returned error 0x80004002
> > > err:ole:create_server class {228d9a81-c302-11cf-9aa4-00aa004a5691} not
> > > registered
> > > fixme:ole:CoGetClassObject CLSCTX_REMOTE_SERVER not supported
> > > err:ole:CoGetClassObject no class object
> > > {228d9a81-c302-11cf-9aa4-00aa004a5691} could be created for context
> > > 0x15
> > > moniker.c:783: Test failed: ****************LDAP**************
> > > moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.
> > >
> > > after my patch:
> > > $ ../../../wine ole32_test.exe.so moniker
> > > moniker.c:783: Test failed: ****************LDAP**************
> > > moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.
> > >
> > > Although the test failed, but loading class
> > > {228d9a81-c302-11cf-9aa4-00aa004a5691} success.
> > >
> > >
> > > 2007/12/21, Robert Shearman <rob at codeweavers.com>:
> > > > Huang, Zhangrong wrote:
> > > > > See dlls/ole32/compobj.c,
> > > > >
> > > > > static HRESULT apartment_getclassobject(struct apartment *apt, LPCWSTR dllpath,
> > > > >                                         BOOL apartment_threaded,
> > > > >                                         REFCLSID rclsid, REFIID riid,
> > > > > void **ppv)
> > > > > {
> > > > > ...................
> > > > >     if (SUCCEEDED(hr))
> > > > >     {
> > > > > ..................
> > > > >         TRACE("calling DllGetClassObject %p\n",
> > > > > apartment_loaded_dll->dll->DllGetClassObject);
> > > > >         /* OK: get the ClassObject */
> > > > >         hr = apartment_loaded_dll->dll->DllGetClassObject(rclsid, riid, ppv);
> > > > >                                                                   ^^^^
> > > > >         if (hr != S_OK)
> > > > >             ERR("DllGetClassObject returned error 0x%08x\n", hr);
> > > > >     }
> > > > > ..............
> > > > > }
> > > > >
> > > > > Reference to http://msdn2.microsoft.com/en-us/library/ms680760.aspx,
> > > > >
> > > > > riid
> > > > >
> > > > >     [in] Reference to the identifier of the interface that the caller
> > > > >     is to use to communicate with the class object. Usually, this is
> > > > >     IID_IClassFactory (defined in the OLE headers as the interface
> > > > >     identifier for IClassFactory).
> > > > >
> > > >
> > > > This doesn't mean anything other than CoCreateInstance is usually used
> > > > instead of CoGetClassObject (and CoCreateInstance always passes in
> > > > IID_IClassFactory for the IID).
> > >
> > > It's failed when calling MkParseDisplayName.
> > >
> > > >
> > > > > We can't pass riid to DllGetClassObject directly sometimes, causes some dlls'
> > > > > DllGetClassObject (like native adsldp.dll) can only return reference-counted
> > > > > pointer to class factory via IID_IClassFactory, for retrieving the
> > > > > pointer to the
> > > > > class object interface requested in riid, we must try another way.
> > > > >
> > > >
> > > > Thank you for your patch, but this behaviour seems a little strange and
> > > > needs a little more investigation before I am happy that it is correct.
> > > > What parameters are being passed in to CoGetClassObject to cause the
> > > > call to fail for you?
> > >
> > > That's how MS does, I see this strange behaviour happening through
> > > assembly debugging.
> > > First time calling DllGetClassObject using riid, and it's failed, then
> > > trying IID_IClassFactory.
> > >
> >
> > Disassembling what?
>
> Native ole32.dll, MkParseDisplayName calls adsldp.dll's
> DllGetClassObject twice,
> frist using IID_IParseDisplayName, second using IID_IClassFactory.
>
>

Disassembling native Windows binaries is not allowed in this project,
so I'm afraid none of your patches can be accepted.

-- 
James Hawkins


From truiken at gmail.com  Sat Dec 22 15:03:16 2007
From: truiken at gmail.com (James Hawkins)
Date: Sat, 22 Dec 2007 15:03:16 -0600
Subject: New bugzilla components (round 3)
In-Reply-To: <476D5D59.8050809@kievinfo.com>
References: <476D5D59.8050809@kievinfo.com>
Message-ID: <22821af30712221303p25e65b38u58be489b8f21d2d8@mail.gmail.com>

On Dec 22, 2007 12:54 PM, Vitaliy Margolen <wine-devel at kievinfo.com> wrote:
> Ok we talked and talked and talked and where did it all go? Where are the
> agreed upon changes?
>
> If we can't agree on everything, then lets do parts that everyone is ok
> with. Then decide on more changes.
>
>
> So far this what everyone was happy with:
>
> wine-misc -> unknown (default selection)
>
> test -> test (change description to "Conformance tests")
> wine-advapi32 -> advapi32
> wine-atl -> atl
> wine-comctl32 -> comctl32
> wine-console -> console
> wine-crypt32 -> crypt32
> wine-dbghelp -> dbghelp
> wine-debug -> winedbg
> wine-directx* -> directx*
> wine-documentation -> documentation
> wine-dos -> dos
> wine-gdi-(printing) -> gdi32
> wine-gdiplus -> gdiplus
> wine-help -> hhctrl - Help viewer implementation
> wine-kernel -> kernel32
> wine-loader ->loader
> wine-msi -> msi
> wine-msvcrt -> msvcrt
> wine-msxml -> msxml3
> wine-ole -> ole
> wine-opengl -> opengl
> wine-quartz -> quartz
> wine-richedit -> richedit
> wine-setupapi -> setupapi
> wine-shdocvw -> shdocvw
> wine-shell32 -> shell32
> wine-urlmon -> urlmon
> wine-user -> user32
> wine-usp10.dll -> usp10
> wine-winelib -> winelib
> wine-x11driver -> x11driver
>
> Add new components:
> -> wininet - Internet connectivity and Layer-7 protocols
> -> wintrust - Cryptography and trust verifications
> -> advpack - INF file based installation engine
> -> imagehlp - PE binary file manipulations, signed file handling
> -> shlwapi - Various shell helper functions
> -> vdm - Wine 16-bit compatibility layer
> -> comdlg32 - Common dialogs such as open/save/print/font
>
> Remove:
> Wine-Rebar
>

Looks good.  Can we get confirmation from a bugzilla admin when work
on these changes has started?

-- 
James Hawkins


From maarten at codeweavers.com  Sat Dec 22 18:57:00 2007
From: maarten at codeweavers.com (Maarten Lankhorst)
Date: Sun, 23 Dec 2007 01:57:00 +0100
Subject: ole32: Fix a failed call to DllGetClassObject while retrieving
	class object interface pointer.
In-Reply-To: <22821af30712221255h4778df15v9d714eae492d8ef5@mail.gmail.com>
References: <b4cc5a3d0712200653t738a43c4rcbd00ff8e779e128@mail.gmail.com>	<476ABF8B.1080509@codeweavers.com>	<b4cc5a3d0712220746y4a883afau649a5f22aec8a59@mail.gmail.com>	<22821af30712220906o2b313fe6oc1fbea0657f92f58@mail.gmail.com>	<b4cc5a3d0712221025g3ba44bcay14f02396813c62a1@mail.gmail.com>
	<22821af30712221255h4778df15v9d714eae492d8ef5@mail.gmail.com>
Message-ID: <476DB25C.8080200@codeweavers.com>

James Hawkins schreef:
> On Dec 22, 2007 12:25 PM, Huang, Zhangrong <hzhrong at gmail.com> wrote:
>   
>> 2007/12/23, James Hawkins <truiken at gmail.com>
>>> On Dec 22, 2007 9:46 AM, Huang, Zhangrong <hzhrong at gmail.com> wrote:
>>>       
>>>> Hi,
>>>> Sorry for the delay.
>>>> Here is a test, pls import the attached registry files, and copy
>>>> native activeds.dll, adsldpc.dll,
>>>> adsldp.dll to your windows system32 dir, and patch
>>>> wine/dlls/ole32/tests/moniker.c
>>>>
>>>> Then run the test:
>>>> $ ../../../wine ole32_test.exe.so moniker
>>>> err:ole:apartment_getclassobject DllGetClassObject returned error 0x80004002
>>>> err:ole:create_server class {228d9a81-c302-11cf-9aa4-00aa004a5691} not
>>>> registered
>>>> fixme:ole:CoGetClassObject CLSCTX_REMOTE_SERVER not supported
>>>> err:ole:CoGetClassObject no class object
>>>> {228d9a81-c302-11cf-9aa4-00aa004a5691} could be created for context
>>>> 0x15
>>>> moniker.c:783: Test failed: ****************LDAP**************
>>>> moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.
>>>>
>>>> after my patch:
>>>> $ ../../../wine ole32_test.exe.so moniker
>>>> moniker.c:783: Test failed: ****************LDAP**************
>>>> moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.
>>>>
>>>> Although the test failed, but loading class
>>>> {228d9a81-c302-11cf-9aa4-00aa004a5691} success.
>>>>
>>>>
>>>> 2007/12/21, Robert Shearman <rob at codeweavers.com>:
>>>>         
>>>>> Huang, Zhangrong wrote:
>>>>>           
>>>>>> See dlls/ole32/compobj.c,
>>>>>>
>>>>>> static HRESULT apartment_getclassobject(struct apartment *apt, LPCWSTR dllpath,
>>>>>>                                         BOOL apartment_threaded,
>>>>>>                                         REFCLSID rclsid, REFIID riid,
>>>>>> void **ppv)
>>>>>> {
>>>>>> ...................
>>>>>>     if (SUCCEEDED(hr))
>>>>>>     {
>>>>>> ..................
>>>>>>         TRACE("calling DllGetClassObject %p\n",
>>>>>> apartment_loaded_dll->dll->DllGetClassObject);
>>>>>>         /* OK: get the ClassObject */
>>>>>>         hr = apartment_loaded_dll->dll->DllGetClassObject(rclsid, riid, ppv);
>>>>>>                                                                   ^^^^
>>>>>>         if (hr != S_OK)
>>>>>>             ERR("DllGetClassObject returned error 0x%08x\n", hr);
>>>>>>     }
>>>>>> ..............
>>>>>> }
>>>>>>
>>>>>> Reference to http://msdn2.microsoft.com/en-us/library/ms680760.aspx,
>>>>>>
>>>>>> riid
>>>>>>
>>>>>>     [in] Reference to the identifier of the interface that the caller
>>>>>>     is to use to communicate with the class object. Usually, this is
>>>>>>     IID_IClassFactory (defined in the OLE headers as the interface
>>>>>>     identifier for IClassFactory).
>>>>>>
>>>>>>             
>>>>> This doesn't mean anything other than CoCreateInstance is usually used
>>>>> instead of CoGetClassObject (and CoCreateInstance always passes in
>>>>> IID_IClassFactory for the IID).
>>>>>           
>>>> It's failed when calling MkParseDisplayName.
>>>>
>>>>         
>>>>>> We can't pass riid to DllGetClassObject directly sometimes, causes some dlls'
>>>>>> DllGetClassObject (like native adsldp.dll) can only return reference-counted
>>>>>> pointer to class factory via IID_IClassFactory, for retrieving the
>>>>>> pointer to the
>>>>>> class object interface requested in riid, we must try another way.
>>>>>>
>>>>>>             
>>>>> Thank you for your patch, but this behaviour seems a little strange and
>>>>> needs a little more investigation before I am happy that it is correct.
>>>>> What parameters are being passed in to CoGetClassObject to cause the
>>>>> call to fail for you?
>>>>>           
>>>> That's how MS does, I see this strange behaviour happening through
>>>> assembly debugging.
>>>> First time calling DllGetClassObject using riid, and it's failed, then
>>>> trying IID_IClassFactory.
>>>>
>>>>         
>>> Disassembling what?
>>>       
>> Native ole32.dll, MkParseDisplayName calls adsldp.dll's
>> DllGetClassObject twice,
>> frist using IID_IParseDisplayName, second using IID_IClassFactory.
>>
>>
>>     
>
> Disassembling native Windows binaries is not allowed in this project,
> so I'm afraid none of your patches can be accepted
This is not the first time such disassemble occurs, I think it should be
made more clear that disassembly is not allowed in the wine project.

After looking at the wine faq, I only see disassembling mentioned once
in "Who can't contribute to Wine?", not even in a full sentence. Perhaps
it should be made prominent in the documentation about 'sending patches'
and debugging parts, and also give it a seperate mentioning in the wiki?

-Maarten


From plr.vincent at gmail.com  Sat Dec 22 14:48:49 2007
From: plr.vincent at gmail.com (Vincent Pelletier)
Date: Sat, 22 Dec 2007 21:48:49 +0100
Subject: Fix build when valgrind header is present but does not define
	VALGRIND_MAKE_WRITABLE
Message-ID: <6453447c0712221248u45f7c287vda7042fb722d505@mail.gmail.com>

Fixes gcc error:

signal_i386.o: In function `setup_exception':
/home/vincent/git/wine/dlls/ntdll/signal_i386.c:940: undefined
reference to `VALGRIND_MAKE_WRITABLE'
collect2: ld returned 1 exit status

Others uses of this constant are already checked this way.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: fix_valgrind_ifdef.diff
Type: text/x-diff
Size: 524 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071222/58a300f3/attachment.diff 

From chris.kcat at gmail.com  Sat Dec 22 19:36:47 2007
From: chris.kcat at gmail.com (Chris Robinson)
Date: Sat, 22 Dec 2007 17:36:47 -0800
Subject: bugfix for bug #6994
In-Reply-To: <op.t3riyfhiqeis3t@alexei-desktop>
References: <op.t3riyfhiqeis3t@alexei-desktop>
Message-ID: <200712221736.47666.chris.kcat@gmail.com>

On Saturday 22 December 2007 04:43:17 pm Alexei Slepov wrote:
> We can't use ordinary backbuffer to render textures, which size is more
> than
> size of the screen. For example, if the screen size is 800x600, we can't
> render background texture, which size is 1024x1024. So, if we are using
> backbuffer, we see only part of texture, which size is exactly 800x600.
> The only way to make the application working properly is to use pbuffer.

This is what the OffscreenRenderMethod option is for. If it's set to 
backbuffer, wined3d needs to use the backbuffer as well as it can. If you 
need to use pbuffers, set it to pbuffer (which I believe is the default?). Or 
if the card supports it, use fbo, which is more flexible (and needed for some 
of D3D9's capabilities, IIRC).


From truiken at gmail.com  Sat Dec 22 21:12:18 2007
From: truiken at gmail.com (James Hawkins)
Date: Sat, 22 Dec 2007 21:12:18 -0600
Subject: ole32: Fix a failed call to DllGetClassObject while retrieving
	class object interface pointer.
In-Reply-To: <476DB25C.8080200@codeweavers.com>
References: <b4cc5a3d0712200653t738a43c4rcbd00ff8e779e128@mail.gmail.com>
	<476ABF8B.1080509@codeweavers.com>
	<b4cc5a3d0712220746y4a883afau649a5f22aec8a59@mail.gmail.com>
	<22821af30712220906o2b313fe6oc1fbea0657f92f58@mail.gmail.com>
	<b4cc5a3d0712221025g3ba44bcay14f02396813c62a1@mail.gmail.com>
	<22821af30712221255h4778df15v9d714eae492d8ef5@mail.gmail.com>
	<476DB25C.8080200@codeweavers.com>
Message-ID: <22821af30712221912y3643fc30y607ae67de6cb0f68@mail.gmail.com>

On Dec 22, 2007 6:57 PM, Maarten Lankhorst <maarten at codeweavers.com> wrote:
> James Hawkins schreef:
>
> > On Dec 22, 2007 12:25 PM, Huang, Zhangrong <hzhrong at gmail.com> wrote:
> >
> >> 2007/12/23, James Hawkins <truiken at gmail.com>
> >>> On Dec 22, 2007 9:46 AM, Huang, Zhangrong <hzhrong at gmail.com> wrote:
> >>>
> >>>> Hi,
> >>>> Sorry for the delay.
> >>>> Here is a test, pls import the attached registry files, and copy
> >>>> native activeds.dll, adsldpc.dll,
> >>>> adsldp.dll to your windows system32 dir, and patch
> >>>> wine/dlls/ole32/tests/moniker.c
> >>>>
> >>>> Then run the test:
> >>>> $ ../../../wine ole32_test.exe.so moniker
> >>>> err:ole:apartment_getclassobject DllGetClassObject returned error 0x80004002
> >>>> err:ole:create_server class {228d9a81-c302-11cf-9aa4-00aa004a5691} not
> >>>> registered
> >>>> fixme:ole:CoGetClassObject CLSCTX_REMOTE_SERVER not supported
> >>>> err:ole:CoGetClassObject no class object
> >>>> {228d9a81-c302-11cf-9aa4-00aa004a5691} could be created for context
> >>>> 0x15
> >>>> moniker.c:783: Test failed: ****************LDAP**************
> >>>> moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.
> >>>>
> >>>> after my patch:
> >>>> $ ../../../wine ole32_test.exe.so moniker
> >>>> moniker.c:783: Test failed: ****************LDAP**************
> >>>> moniker: 2 tests executed (0 marked as todo, 1 failure), 0 skipped.
> >>>>
> >>>> Although the test failed, but loading class
> >>>> {228d9a81-c302-11cf-9aa4-00aa004a5691} success.
> >>>>
> >>>>
> >>>> 2007/12/21, Robert Shearman <rob at codeweavers.com>:
> >>>>
> >>>>> Huang, Zhangrong wrote:
> >>>>>
> >>>>>> See dlls/ole32/compobj.c,
> >>>>>>
> >>>>>> static HRESULT apartment_getclassobject(struct apartment *apt, LPCWSTR dllpath,
> >>>>>>                                         BOOL apartment_threaded,
> >>>>>>                                         REFCLSID rclsid, REFIID riid,
> >>>>>> void **ppv)
> >>>>>> {
> >>>>>> ...................
> >>>>>>     if (SUCCEEDED(hr))
> >>>>>>     {
> >>>>>> ..................
> >>>>>>         TRACE("calling DllGetClassObject %p\n",
> >>>>>> apartment_loaded_dll->dll->DllGetClassObject);
> >>>>>>         /* OK: get the ClassObject */
> >>>>>>         hr = apartment_loaded_dll->dll->DllGetClassObject(rclsid, riid, ppv);
> >>>>>>                                                                   ^^^^
> >>>>>>         if (hr != S_OK)
> >>>>>>             ERR("DllGetClassObject returned error 0x%08x\n", hr);
> >>>>>>     }
> >>>>>> ..............
> >>>>>> }
> >>>>>>
> >>>>>> Reference to http://msdn2.microsoft.com/en-us/library/ms680760.aspx,
> >>>>>>
> >>>>>> riid
> >>>>>>
> >>>>>>     [in] Reference to the identifier of the interface that the caller
> >>>>>>     is to use to communicate with the class object. Usually, this is
> >>>>>>     IID_IClassFactory (defined in the OLE headers as the interface
> >>>>>>     identifier for IClassFactory).
> >>>>>>
> >>>>>>
> >>>>> This doesn't mean anything other than CoCreateInstance is usually used
> >>>>> instead of CoGetClassObject (and CoCreateInstance always passes in
> >>>>> IID_IClassFactory for the IID).
> >>>>>
> >>>> It's failed when calling MkParseDisplayName.
> >>>>
> >>>>
> >>>>>> We can't pass riid to DllGetClassObject directly sometimes, causes some dlls'
> >>>>>> DllGetClassObject (like native adsldp.dll) can only return reference-counted
> >>>>>> pointer to class factory via IID_IClassFactory, for retrieving the
> >>>>>> pointer to the
> >>>>>> class object interface requested in riid, we must try another way.
> >>>>>>
> >>>>>>
> >>>>> Thank you for your patch, but this behaviour seems a little strange and
> >>>>> needs a little more investigation before I am happy that it is correct.
> >>>>> What parameters are being passed in to CoGetClassObject to cause the
> >>>>> call to fail for you?
> >>>>>
> >>>> That's how MS does, I see this strange behaviour happening through
> >>>> assembly debugging.
> >>>> First time calling DllGetClassObject using riid, and it's failed, then
> >>>> trying IID_IClassFactory.
> >>>>
> >>>>
> >>> Disassembling what?
> >>>
> >> Native ole32.dll, MkParseDisplayName calls adsldp.dll's
> >> DllGetClassObject twice,
> >> frist using IID_IParseDisplayName, second using IID_IClassFactory.
> >>
> >>
> >>
> >
> > Disassembling native Windows binaries is not allowed in this project,
> > so I'm afraid none of your patches can be accepted
> This is not the first time such disassemble occurs, I think it should be
> made more clear that disassembly is not allowed in the wine project.
>
> After looking at the wine faq, I only see disassembling mentioned once
> in "Who can't contribute to Wine?", not even in a full sentence. Perhaps
> it should be made prominent in the documentation about 'sending patches'
> and debugging parts, and also give it a seperate mentioning in the wiki?
>
> -Maarten
>

You could paste it all over winehq.org and the docs and it'll still happen.

-- 
James Hawkins


From hzhrong at gmail.com  Sat Dec 22 22:37:05 2007
From: hzhrong at gmail.com (Huang, Zhangrong)
Date: Sun, 23 Dec 2007 12:37:05 +0800
Subject: ole32: Fix a failed call to DllGetClassObject while retrieving
	class object interface pointer.
In-Reply-To: <22821af30712221912y3643fc30y607ae67de6cb0f68@mail.gmail.com>
References: <b4cc5a3d0712200653t738a43c4rcbd00ff8e779e128@mail.gmail.com>
	<476ABF8B.1080509@codeweavers.com>
	<b4cc5a3d0712220746y4a883afau649a5f22aec8a59@mail.gmail.com>
	<22821af30712220906o2b313fe6oc1fbea0657f92f58@mail.gmail.com>
	<b4cc5a3d0712221025g3ba44bcay14f02396813c62a1@mail.gmail.com>
	<22821af30712221255h4778df15v9d714eae492d8ef5@mail.gmail.com>
	<476DB25C.8080200@codeweavers.com>
	<22821af30712221912y3643fc30y607ae67de6cb0f68@mail.gmail.com>
Message-ID: <b4cc5a3d0712222037t35033191wac9ad92717b58dd4@mail.gmail.com>

hi,

2007/12/23, James Hawkins <truiken at gmail.com>:
> On Dec 22, 2007 6:57 PM, Maarten Lankhorst <maarten at codeweavers.com> wrote:
> > James Hawkins schreef:
> >
> > > On Dec 22, 2007 12:25 PM, Huang, Zhangrong <hzhrong at gmail.com> wrote:
> > >
> > >> 2007/12/23, James Hawkins <truiken at gmail.com>
> > >>>>>

> > >>>>
> > >>> Disassembling what?
> > >>>
> > >> Native ole32.dll, MkParseDisplayName calls adsldp.dll's
> > >> DllGetClassObject twice,
> > >> frist using IID_IParseDisplayName, second using IID_IClassFactory.
> > >>
> > >>
> > >>
> > >
> > > Disassembling native Windows binaries is not allowed in this project,
> > > so I'm afraid none of your patches can be accepted
> > This is not the first time such disassemble occurs, I think it should be
> > made more clear that disassembly is not allowed in the wine project.

Thank you for mentioning that. But, I think that's kind of mixing up.
I didn't do anything like disassembly code to source code translation.
I just saw how native binaries work when debugging my app in Windows.

I didn't have much knowledge about COM, so I searched MSDN and found
some useful info about DllGetClassObject, then I wrote the patch, it's
quite clean.

Why I mentioning disassembly is just giving a sample that how to call
DllGetClassObject,
it doesn't mean I have done anything illegal to wine.

Anyway, have you tried my testcase? Then how can we fix the problem?


> >
> > After looking at the wine faq, I only see disassembling mentioned once
> > in "Who can't contribute to Wine?", not even in a full sentence. Perhaps
> > it should be made prominent in the documentation about 'sending patches'
> > and debugging parts, and also give it a seperate mentioning in the wiki?
> >
> > -Maarten
> >
>
> You could paste it all over winehq.org and the docs and it'll still happen.

That could be useful.

>
> --
> James Hawkins
>


-- 
$ apt-get moo
         (__)
         (oo)
   /------\/
  / |    ||
 *  /\---/\
    ~~   ~~
...."Have you mooed today?"...


From zgold550 at gmail.com  Sat Dec 22 23:55:09 2007
From: zgold550 at gmail.com (Zachary Goldberg)
Date: Sun, 23 Dec 2007 00:55:09 -0500
Subject: loader: Add --compile-info option to Wine.
In-Reply-To: <689de9370712182318s1c2b6a70ob9b32f244dec3821@mail.gmail.com>
References: <689de9370712180119u514ea780y4221dbbb6530919@mail.gmail.com>
	<4767EA9F.2030109@gmx.net>
	<78a7dad00712180949w326d54f8qae321c15a8439d1a@mail.gmail.com>
	<47681D77.8080007@gmx.net>
	<530468570712181153x55cc68f8uc5898dd07895952a@mail.gmail.com>
	<476871C0.9050102@open-vote.org> <4768788D.7070205@gmx.net>
	<689de9370712182318s1c2b6a70ob9b32f244dec3821@mail.gmail.com>
Message-ID: <b050a5e70712222155h65629ba3j768637c3e51a5219@mail.gmail.com>

On Dec 19, 2007 2:18 AM, Andrew Riedi <andrewriedi at gmail.com> wrote:
> I have sent in a new patch with the same title to address the problems
> discussed in this thread.  Thanks to all of the people who looked over my
> patch and discussed its possible problems.  It should surely help debugging
> Wine in the future, especially if we decide to take advantage of the
> http://wiki.winehq.org/GccVersions page.
>
> --
> Andrew Riedi
>
>
>

Any word on whether or not there are plans to accept this?  I don't
believe i've seen it go through to wine-cvs yet.  I think it might be
useful.

-- 
Zachary Goldberg
Computer Science & Engineering
Electrical Captain of Penn Electric Race Team
School of Engineering at the University of Pennsylvania


From dank at kegel.com  Sun Dec 23 02:31:49 2007
From: dank at kegel.com (Dan Kegel)
Date: Sun, 23 Dec 2007 00:31:49 -0800
Subject: New bugzilla components (round 3)
Message-ID: <a71bd89a0712230031x4cbce75araf7e5a0aff3e521@mail.gmail.com>

vdm is a bit cryptic, could we call it win16 instead?
That's a bit broader, but that's ok.

The other products could use some attention, too.

Wine HQ Apps Database
website-bugs -> appdb-misc

WineHQ Bugzilla
bug list -> delete
comments -> delete
login -> delete
misc-bugs -> bugzilla-misc

WineHQ.com (rename WineHQ.org)
misc-web -> www-misc


From truiken at gmail.com  Sun Dec 23 03:43:18 2007
From: truiken at gmail.com (James Hawkins)
Date: Sun, 23 Dec 2007 03:43:18 -0600
Subject: ole32: Fix a failed call to DllGetClassObject while retrieving
	class object interface pointer.
In-Reply-To: <b4cc5a3d0712222037t35033191wac9ad92717b58dd4@mail.gmail.com>
References: <b4cc5a3d0712200653t738a43c4rcbd00ff8e779e128@mail.gmail.com>
	<476ABF8B.1080509@codeweavers.com>
	<b4cc5a3d0712220746y4a883afau649a5f22aec8a59@mail.gmail.com>
	<22821af30712220906o2b313fe6oc1fbea0657f92f58@mail.gmail.com>
	<b4cc5a3d0712221025g3ba44bcay14f02396813c62a1@mail.gmail.com>
	<22821af30712221255h4778df15v9d714eae492d8ef5@mail.gmail.com>
	<476DB25C.8080200@codeweavers.com>
	<22821af30712221912y3643fc30y607ae67de6cb0f68@mail.gmail.com>
	<b4cc5a3d0712222037t35033191wac9ad92717b58dd4@mail.gmail.com>
Message-ID: <22821af30712230143g2fade695x898c962879bf9cff@mail.gmail.com>

On Dec 22, 2007 10:37 PM, Huang, Zhangrong <hzhrong at gmail.com> wrote:
> hi,
>
> 2007/12/23, James Hawkins <truiken at gmail.com>:
> > On Dec 22, 2007 6:57 PM, Maarten Lankhorst <maarten at codeweavers.com> wrote:
> > > James Hawkins schreef:
> > >
> > > > On Dec 22, 2007 12:25 PM, Huang, Zhangrong <hzhrong at gmail.com> wrote:
> > > >
> > > >> 2007/12/23, James Hawkins <truiken at gmail.com>
> > > >>>>>
>
> > > >>>>
> > > >>> Disassembling what?
> > > >>>
> > > >> Native ole32.dll, MkParseDisplayName calls adsldp.dll's
> > > >> DllGetClassObject twice,
> > > >> frist using IID_IParseDisplayName, second using IID_IClassFactory.
> > > >>
> > > >>
> > > >>
> > > >
> > > > Disassembling native Windows binaries is not allowed in this project,
> > > > so I'm afraid none of your patches can be accepted
> > > This is not the first time such disassemble occurs, I think it should be
> > > made more clear that disassembly is not allowed in the wine project.
>
> Thank you for mentioning that. But, I think that's kind of mixing up.
> I didn't do anything like disassembly code to source code translation.
> I just saw how native binaries work when debugging my app in Windows.
>

Disassembling of any kind is prohibited.  You don't have to convert
the disassembly to source code first to disqualify.

> I didn't have much knowledge about COM, so I searched MSDN and found
> some useful info about DllGetClassObject, then I wrote the patch, it's
> quite clean.
>

You just said you disassembled native ole32.dll.

-- 
James Hawkins


From kai.blin at gmail.com  Sun Dec 23 04:31:20 2007
From: kai.blin at gmail.com (Kai Blin)
Date: Sun, 23 Dec 2007 11:31:20 +0100
Subject: New bugzilla components (round 3)
In-Reply-To: <476D5D59.8050809@kievinfo.com>
References: <476D5D59.8050809@kievinfo.com>
Message-ID: <200712231131.26437.kai.blin@gmail.com>

On Saturday 22 December 2007 19:54:17 Vitaliy Margolen wrote:

> ------------------------------
> This is up for discussion:
[...]
> wine-net ->

I'll just go with James' suggestions here:

wine-net -> ws2_32, need to reclassify the wininet bugs to 'wininet', but that 
can be done after the rename just as well.

wine-sspi -> secur32

Cheers,
Kai

-- 
Kai Blin
WorldForge developer  http://www.worldforge.org/
Wine developer        http://wiki.winehq.org/KaiBlin
Samba team member     http://www.samba.org/samba/team/
--
Will code for cotton.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071223/8b5b80db/attachment.pgp 

From hzhrong at gmail.com  Sun Dec 23 04:49:04 2007
From: hzhrong at gmail.com (Huang, Zhangrong)
Date: Sun, 23 Dec 2007 18:49:04 +0800
Subject: ole32: Fix a failed call to DllGetClassObject while retrieving
	class object interface pointer.
In-Reply-To: <22821af30712230143g2fade695x898c962879bf9cff@mail.gmail.com>
References: <b4cc5a3d0712200653t738a43c4rcbd00ff8e779e128@mail.gmail.com>
	<476ABF8B.1080509@codeweavers.com>
	<b4cc5a3d0712220746y4a883afau649a5f22aec8a59@mail.gmail.com>
	<22821af30712220906o2b313fe6oc1fbea0657f92f58@mail.gmail.com>
	<b4cc5a3d0712221025g3ba44bcay14f02396813c62a1@mail.gmail.com>
	<22821af30712221255h4778df15v9d714eae492d8ef5@mail.gmail.com>
	<476DB25C.8080200@codeweavers.com>
	<22821af30712221912y3643fc30y607ae67de6cb0f68@mail.gmail.com>
	<b4cc5a3d0712222037t35033191wac9ad92717b58dd4@mail.gmail.com>
	<22821af30712230143g2fade695x898c962879bf9cff@mail.gmail.com>
Message-ID: <b4cc5a3d0712230249y4b4c08ala7c78da8fbfd78e6@mail.gmail.com>

2007/12/23, James Hawkins <truiken at gmail.com>:
> On Dec 22, 2007 10:37 PM, Huang, Zhangrong <hzhrong at gmail.com> wrote:
> > hi,
> >
> > 2007/12/23, James Hawkins <truiken at gmail.com>:
> > > On Dec 22, 2007 6:57 PM, Maarten Lankhorst <maarten at codeweavers.com> wrote:
> > > > James Hawkins schreef:
> > > >
> > > > > On Dec 22, 2007 12:25 PM, Huang, Zhangrong <hzhrong at gmail.com> wrote:
> > > > >
> > > > >> 2007/12/23, James Hawkins <truiken at gmail.com>
> > > > >>>>>
> >
> > > > >>>>
> > > > >>> Disassembling what?
> > > > >>>
> > > > >> Native ole32.dll, MkParseDisplayName calls adsldp.dll's
> > > > >> DllGetClassObject twice,
> > > > >> frist using IID_IParseDisplayName, second using IID_IClassFactory.
> > > > >>
> > > > >>
> > > > >>
> > > > >
> > > > > Disassembling native Windows binaries is not allowed in this project,
> > > > > so I'm afraid none of your patches can be accepted
> > > > This is not the first time such disassemble occurs, I think it should be
> > > > made more clear that disassembly is not allowed in the wine project.
> >
> > Thank you for mentioning that. But, I think that's kind of mixing up.
> > I didn't do anything like disassembly code to source code translation.
> > I just saw how native binaries work when debugging my app in Windows.
> >
>
> Disassembling of any kind is prohibited.  You don't have to convert
> the disassembly to source code first to disqualify.

Actually, I did say "assembly debugging" at first, because when I was debugging
my private app, what I saw in native ole32.dll was assembly code, so I called
"assembly debugging".  All I got that was native ole32.dll called
DllGetClassObject
twice, that's it, I didn't know how it done and still don't understand
that assembly code well.

>
> > I didn't have much knowledge about COM, so I searched MSDN and found
> > some useful info about DllGetClassObject, then I wrote the patch, it's
> > quite clean.
> >
>
> You just said you disassembled native ole32.dll.

Maybe I missed what your said and what you mean, but you said
"disassembly"  first,
I did mean I saw native ole32.dll in assembly code mode, not mean I
did disassembly
or any cracking stuff.

>
> --
> James Hawkins
>


-- 
$ apt-get moo
         (__)
         (oo)
   /------\/
  / |    ||
 *  /\---/\
    ~~   ~~
...."Have you mooed today?"...


From dank at kegel.com  Sun Dec 23 06:24:41 2007
From: dank at kegel.com (Dan Kegel)
Date: Sun, 23 Dec 2007 04:24:41 -0800
Subject: Looking for serious Photoshop 7/CS users to break wine
Message-ID: <a71bd89a0712230424s5aecf27n2319eff0f69405db@mail.gmail.com>

Our support for Photoshop 7 and maybe CS
is strong enough for industrial users --
and if it isn't, I'd like to know about it so
we can do something about it.
So I posted notes asking for serious Photoshop
users to try it and let us know what's still broken:
http://ubuntuforums.org/showthread.php?p=4001494
http://www.adobeforums.com/webx/.3c05a212
Hopefully that will bring in some good bug reports.
- Dan
p.s. The latter message reads
-- snip --
Topic: Wine Project looking for Photoshop CS users who want Linux support

If you're not a Linux user, or if you don't like the idea of
running Photoshop for Windows on Linux, you can stop reading now,
this message probably won't be interesting to you.

The Wine project is looking for hardcore Photoshop CS or 7
users who use Photoshop professionally, all day, every day,
and who are willing to tell us why they can't do that in Linux
using Wine yet.

We know everybody would like Photoshop CS3 or at least
CS2 support, but support for CS2 and CS3 isn't quite
ready, so we'd like to focus on our strengths, and support
Photoshop 7 and CS excellently. Don't worry, we're also
working on the CS2 and CS3 issues. Getting all the 7 and CS
issues taken care of builds a stronger foundation for CS2 and CS3.

If something doesn't work in Photoshop 7 or CS itself,
or your favorite plugin works in Windows with 7 or CS
but not in Wine, please let us know how to reproduce
the problem. To do that, just reply to this post,
or post in the wine-users mailing list,
or leave a comment in the wine appdb for Photoshop 7 or CS,
or file a bug in the Wine Bugzilla,
whichever you're more comfortable with.
We'll take it from there; if we can reproduce it, we'll
file a bug and see if we can get a wine developer to fix it.

Ideally you'd test with the latest release of Wine
(currently 0.9.51), but if you're still on a slightly older
version, don't sweat it, we'll retest on the latest for you.

Thanks!
Dan Kegel
Wine 1.0 Release Manager
-- snip --


From r.kalbermatter at hccnet.nl  Sun Dec 23 08:27:56 2007
From: r.kalbermatter at hccnet.nl (Rolf Kalbermatter)
Date: Sun, 23 Dec 2007 15:27:56 +0100
Subject: ole32: Fix a failed call to DllGetClassObject while
	retrievingclass object interface pointer.
Message-ID: <003001c84570$03266240$4001a8c0@NATERS>

James Hawkins [truiken at gmail.com] wrote:

>Disassembling of any kind is prohibited.  You don't have to convert the
disassembly
>to source code first to disqualify.

By that strict definition starting up any decent debugger is already
disqualifying.
Not sure we want to go quite there. I wouldn't really know how to do some of
my programs
without sometimes using a debugger, although that happens to usually break
into my own
code but in the case of an exception, also not.

Rolf Kalbermatter



From stefan at codeweavers.com  Sun Dec 23 09:09:07 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Sun, 23 Dec 2007 16:09:07 +0100
Subject: bugfix for bug #6994
In-Reply-To: <op.t3riyfhiqeis3t@alexei-desktop>
References: <op.t3riyfhiqeis3t@alexei-desktop>
Message-ID: <200712231609.07256.stefan@codeweavers.com>

Am Sonntag, 23. Dezember 2007 01:43:17 schrieb Alexei Slepov:
> Subject:
>
> We can't use ordinary backbuffer to render textures, which size is more
> than
> size of the screen. To render bigger texture we must use pbuffer.
You can't just set the setting to PBUFFER, you at least have to check if 
pbuffers are supported.

The proper fix is IMHO to fix the problems fbos suffer from and default to fbo 
offscreen rendering


From wine-devel at kievinfo.com  Sun Dec 23 11:03:46 2007
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sun, 23 Dec 2007 10:03:46 -0700
Subject: tools/wineshelllink: do not execute applications directly,  
	use 'start' utility instead
In-Reply-To: <200712231726.13705.lich@math.spbu.ru>
References: <200712231726.13705.lich@math.spbu.ru>
Message-ID: <476E94F2.4040806@kievinfo.com>

Kirill K. Smirnov wrote:
> This is needed by console applications.
> Fixes bug #10867
> 
> -Exec=env WINEPREFIX="${WINEPREFIX:-$HOME/.wine}" wine "$path" $args
> +Exec=env WINEPREFIX="${WINEPREFIX:-$HOME/.wine}" wine start "$path" $args
This is not correct. If console needs to be created for those apps and there 
isn't one, then Wine should do it when starting an app.

Vitaliy.


From julliard at winehq.org  Sun Dec 23 11:23:36 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Sun, 23 Dec 2007 18:23:36 +0100
Subject: ole32: fix wrong timeout check
In-Reply-To: <476D91AC.9090404@inbox.lv> (Alexander Dorofeyev's message of
	"Sat, 22 Dec 2007 14:37:32 -0800")
References: <a71bd89a0712211901y7de6094euafa478ad6d112b61@mail.gmail.com>
	<476D91AC.9090404@inbox.lv>
Message-ID: <871w9dmijr.fsf@wine.dyndns.org>

Alexander Dorofeyev <alexd4 at inbox.lv> writes:

> Yeah these calculations are a headache. I could probably write
>
> now < start_time || now >= start_time + dwTimeout

The right way is to write

 now - start_time > dwTimeout

using unsigned variables everywhere. Then you don't have to worry about
overflows, and you don't even need to special case INFINITE.

-- 
Alexandre Julliard
julliard at winehq.org


From lich at math.spbu.ru  Sun Dec 23 13:23:57 2007
From: lich at math.spbu.ru (Kirill K. Smirnov)
Date: Sun, 23 Dec 2007 22:23:57 +0300
Subject: tools/wineshelllink: do not execute applications directly,
	use 'start' utility instead
Message-ID: <200712232223.58154.lich@math.spbu.ru>

>> -Exec=env WINEPREFIX="${WINEPREFIX:-$HOME/.wine}" wine "$path" $args
>> +Exec=env WINEPREFIX="${WINEPREFIX:-$HOME/.wine}" wine start "$path" $args
>This is not correct. If console needs to be created for those apps and there 
>isn't one, then Wine should do it when starting an app.

  This is correct. "wine start" is the right way to start complicated (which 
use AllocConsole/FreeConsole and HWND) console applications (bug #10827 and 
bug #10867).

  I do not understand how to detect lack of console even for applications 
called from desktop shortcut. Dumb IO console is always present AFAIK. I 
tried to following:

Create simple console application.
#include <stdio.h>

int main(void)
{
        FILE *f = fopen("ia.txt", "w");
        int ret;

        ret = fprintf(stdout, "qqq\n");
        fprintf(f, "%d\n", ret);
        fclose(f);
        return 0;
}

compiled it as windows console app and run it:
1) $ wine a.exe
2) $ wine start a.exe
3) create a desktop shortcut and click on it.

1'), 2'), 3') compiled the same app as a UNIX app and run it via desktop 
shortcut.
In all cases results are the same: successful output to stdout (res=4).

This makes me think that stdio handles are always present.  I may be wrong, 
just let me know.

--
Kirill


From truiken at gmail.com  Sun Dec 23 13:36:23 2007
From: truiken at gmail.com (James Hawkins)
Date: Sun, 23 Dec 2007 13:36:23 -0600
Subject: ole32: Fix a failed call to DllGetClassObject while
	retrievingclass object interface pointer.
In-Reply-To: <003001c84570$03266240$4001a8c0@NATERS>
References: <003001c84570$03266240$4001a8c0@NATERS>
Message-ID: <22821af30712231136i2c1aa2a9qb508c171498f5cb9@mail.gmail.com>

On Dec 23, 2007 8:27 AM, Rolf Kalbermatter <r.kalbermatter at hccnet.nl> wrote:
> James Hawkins [truiken at gmail.com] wrote:
>
> >Disassembling of any kind is prohibited.  You don't have to convert the
> disassembly
> >to source code first to disqualify.
>
> By that strict definition starting up any decent debugger is already
> disqualifying.
> Not sure we want to go quite there. I wouldn't really know how to do some of
> my programs
> without sometimes using a debugger, although that happens to usually break
> into my own
> code but in the case of an exception, also not.
>
> Rolf Kalbermatter
>
>

Of course.  The issue was one of communication.  I asked him what he
was disassembling and he replied 'native ole32', so I took him quite
literally.

-- 
James Hawkins


From dank at kegel.com  Sun Dec 23 22:10:11 2007
From: dank at kegel.com (Dan Kegel)
Date: Sun, 23 Dec 2007 20:10:11 -0800
Subject: Which is more important to Linux users, itunes or photoshop?
Message-ID: <a71bd89a0712232010i715b609k5a99e300d55be90b@mail.gmail.com>

Not a real question, but I thought this graph was interesting:

http://www.google.com/trends?q=dreamweaver+linux%2C+%22world+of+warcraft%22+linux%2C++itunes+linux%2C+photoshop+linux

It seems iTunes on Linux is twice as popular a query as Photoshop on Linux.
No idea what that really means, but it does make me
want to get our iTunes support shipshape...

Then again, this graph shows mplayer beating out itunes (presumably
because it works):
http://www.google.com/trends?q=dreamweaver+linux%2C+mplayer+linux%2C++itunes+linux%2C+photoshop+linux

OK, too much fooling around with graphs.  Back to
watching Underdog with my four-year-old...


From zgold550 at gmail.com  Sun Dec 23 23:52:02 2007
From: zgold550 at gmail.com (Zachary Goldberg)
Date: Mon, 24 Dec 2007 00:52:02 -0500
Subject: [wintab32 1/7] Store and use the physical device id to match
	device to cursor.
In-Reply-To: <476E92F7.6040903@winehq.org>
References: <476E92F7.6040903@winehq.org>
Message-ID: <b050a5e70712232152nd3f22b8v4f5fddfef566e8c9@mail.gmail.com>

On Dec 23, 2007 11:55 AM, Jeremy White <jwhite at winehq.org> wrote:
> ...snip..
> +static int cursor_from_device(DWORD deviceid, LPWTI_CURSORS_INFO *cursorp)
> +{
> +    int i;
> +    for (i = 0; i < gNumCursors; i++)
> +        if (gSysCursor[i].PHYSID == deviceid)
> +        {
> +            *cursorp = &gSysCursor[i];
> +            return i;
> +        }
> +
> +    ERR("Could not map device id %d to a cursor\n", (int) deviceid);
> +    return -1;
>  }
>
> ...snip..

Perhaps a silly and/or wrong observation but, is this in an effort to
support multiple cursors?


From scott at open-vote.org  Mon Dec 24 00:32:14 2007
From: scott at open-vote.org (Scott Ritchie)
Date: Sun, 23 Dec 2007 22:32:14 -0800
Subject: Which is more important to Linux users, itunes or photoshop?
In-Reply-To: <a71bd89a0712232010i715b609k5a99e300d55be90b@mail.gmail.com>
References: <a71bd89a0712232010i715b609k5a99e300d55be90b@mail.gmail.com>
Message-ID: <476F526E.7090905@open-vote.org>

Dan Kegel wrote:
> Not a real question, but I thought this graph was interesting:
> 
> http://www.google.com/trends?q=dreamweaver+linux%2C+%22world+of+warcraft%22+linux%2C++itunes+linux%2C+photoshop+linux
> 
> It seems iTunes on Linux is twice as popular a query as Photoshop on Linux.
> No idea what that really means, but it does make me
> want to get our iTunes support shipshape...
> 
Similarly:
http://www.google.com/trends?q=photoshop+linux%2C+itunes+linux%2C+itunes+ubuntu%2C+photoshop+ubuntu&ctab=0&geo=all&date=all&sort=0

Let's not get ahead of ourselves, though.  A lot of these queries are
because there's a howto they're looking for, exactly because it's hard
to get it to work out of the box.

Thanks,
Scott Ritchie


From nemes.sorin at gmail.com  Mon Dec 24 02:55:29 2007
From: nemes.sorin at gmail.com (SorinN)
Date: Mon, 24 Dec 2007 10:55:29 +0200
Subject: Which is more important to Linux users, itunes or photoshop?
In-Reply-To: <a71bd89a0712232010i715b609k5a99e300d55be90b@mail.gmail.com>
References: <a71bd89a0712232010i715b609k5a99e300d55be90b@mail.gmail.com>
Message-ID: <e9ddc420712240055j2a58ec38ne98140bbd1fd9395@mail.gmail.com>

OK,

by meanings - Dreamweaver and Photoshop are important - iTunes are not
so important ..but a lot more peoples know about ITunes.


2007/12/24, Dan Kegel <dank at kegel.com>:
> Not a real question, but I thought this graph was interesting:
>
> http://www.google.com/trends?q=dreamweaver+linux%2C+%22world+of+warcraft%22+linux%2C++itunes+linux%2C+photoshop+linux
>
> It seems iTunes on Linux is twice as popular a query as Photoshop on Linux.
> No idea what that really means, but it does make me
> want to get our iTunes support shipshape...
>
> Then again, this graph shows mplayer beating out itunes (presumably
> because it works):
> http://www.google.com/trends?q=dreamweaver+linux%2C+mplayer+linux%2C++itunes+linux%2C+photoshop+linux
>
> OK, too much fooling around with graphs.  Back to
> watching Underdog with my four-year-old...
>
>
>


-- 
Nemes Ioan Sorin


From maarten at codeweavers.com  Mon Dec 24 07:06:30 2007
From: maarten at codeweavers.com (Maarten Lankhorst)
Date: Mon, 24 Dec 2007 14:06:30 +0100
Subject: Which is more important to Linux users, itunes or photoshop?
In-Reply-To: <a71bd89a0712232010i715b609k5a99e300d55be90b@mail.gmail.com>
References: <a71bd89a0712232010i715b609k5a99e300d55be90b@mail.gmail.com>
Message-ID: <476FAED6.6020307@codeweavers.com>

Hi Dan,

Dan Kegel schreef:
> Not a real question, but I thought this graph was interesting:
>
> http://www.google.com/trends?q=dreamweaver+linux%2C+%22world+of+warcraft%22+linux%2C++itunes+linux%2C+photoshop+linux
>
> It seems iTunes on Linux is twice as popular a query as Photoshop on Linux.
> No idea what that really means, but it does make me
> want to get our iTunes support shipshape...
>
> Then again, this graph shows mplayer beating out itunes (presumably
> because it works):
> http://www.google.com/trends?q=dreamweaver+linux%2C+mplayer+linux%2C++itunes+linux%2C+photoshop+linux
>
> OK, too much fooling around with graphs.  Back to
> watching Underdog with my four-year-old...
>   
This is just looking for search queries, there are probably a lot more
variationis of it (such as dreamweavers+ubuntu, etc). I personally think
all 3 important:
- iTunes because it's such a popular program, and wine should have
support for it.
- Photoshop and dreamweaver are because there are no professional
alternatives for it with a familiar interface.

They are 2 groups that have different demands of the os (amusement vs
productivity). So I think they are both important in their own way.

Cheers,
Maarten.


From adam at tpetaccia.com  Mon Dec 24 09:58:14 2007
From: adam at tpetaccia.com (Adam Petaccia)
Date: Mon, 24 Dec 2007 10:58:14 -0500
Subject: Which is more important to Linux users, itunes or photoshop?
In-Reply-To: <a71bd89a0712232010i715b609k5a99e300d55be90b@mail.gmail.com>
References: <a71bd89a0712232010i715b609k5a99e300d55be90b@mail.gmail.com>
Message-ID: <1198511894.11540.3.camel@mighmos>


On Sun, 2007-12-23 at 20:10 -0800, Dan Kegel wrote:
> Not a real question, but I thought this graph was interesting:
> 
> http://www.google.com/trends?q=dreamweaver+linux%2C+%22world+of+warcraft%22+linux%2C++itunes+linux%2C+photoshop+linux
> 
> It seems iTunes on Linux is twice as popular a query as Photoshop on Linux.
> No idea what that really means, but it does make me
> want to get our iTunes support shipshape...
> 
> Then again, this graph shows mplayer beating out itunes (presumably
> because it works):
> http://www.google.com/trends?q=dreamweaver+linux%2C+mplayer+linux%2C++itunes+linux%2C+photoshop+linux
> 
> OK, too much fooling around with graphs.  Back to
> watching Underdog with my four-year-old...
> 
> 

I'm not a developer, but it seems to me that people google search when
something /doesn't/ work.  Few people google wine+world of warcraft (or
WoW) because it works out of the box for most people, for example.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071224/e63dd85e/attachment.pgp 

From zac at zacbrown.org  Mon Dec 24 10:03:00 2007
From: zac at zacbrown.org (Zac Brown)
Date: Mon, 24 Dec 2007 10:03:00 -0600
Subject: Which is more important to Linux users, itunes or photoshop?
In-Reply-To: <476FAED6.6020307@codeweavers.com>
References: <a71bd89a0712232010i715b609k5a99e300d55be90b@mail.gmail.com>
	<476FAED6.6020307@codeweavers.com>
Message-ID: <476FD834.7090705@zacbrown.org>

Maarten Lankhorst wrote:
> Hi Dan,
> 
> Dan Kegel schreef:
>> Not a real question, but I thought this graph was interesting:
>>
>> http://www.google.com/trends?q=dreamweaver+linux%2C+%22world+of+warcraft%22+linux%2C++itunes+linux%2C+photoshop+linux
>>
>> It seems iTunes on Linux is twice as popular a query as Photoshop on Linux.
>> No idea what that really means, but it does make me
>> want to get our iTunes support shipshape...
>>
>> Then again, this graph shows mplayer beating out itunes (presumably
>> because it works):
>> http://www.google.com/trends?q=dreamweaver+linux%2C+mplayer+linux%2C++itunes+linux%2C+photoshop+linux
>>
>> OK, too much fooling around with graphs.  Back to
>> watching Underdog with my four-year-old...
>>   
> This is just looking for search queries, there are probably a lot more
> variationis of it (such as dreamweavers+ubuntu, etc). I personally think
> all 3 important:
> - iTunes because it's such a popular program, and wine should have
> support for it.
> - Photoshop and dreamweaver are because there are no professional
> alternatives for it with a familiar interface.
> 
> They are 2 groups that have different demands of the os (amusement vs
> productivity). So I think they are both important in their own way.
> 
> Cheers,
> Maarten.
> 
> 

I agree with this stand point. Aside from the iTunes store functionality there
a few different programs that are excellent replacements for iTunes. People are
probably just querying it to figure out how to work with their iPods.

Photoshop/Dreamweaver/Illustrator are all definitely big on the professional side.
I use Photoshop myself, though I'm sort of weened myself off of it and am getting
used to the Gimp. Maybe the new Gimp interface will be more intuitive? Either way
both should be focus points but if you put priority one, I feel like Photoshop and
friends is probably a little more important to people.

-Zac



From jwhite at winehq.org  Mon Dec 24 10:21:29 2007
From: jwhite at winehq.org (Jeremy White)
Date: Mon, 24 Dec 2007 10:21:29 -0600
Subject: [wintab32 1/7] Store and use the physical device id to match
	device to cursor.
In-Reply-To: <b050a5e70712232152nd3f22b8v4f5fddfef566e8c9@mail.gmail.com>
References: <476E92F7.6040903@winehq.org>
	<b050a5e70712232152nd3f22b8v4f5fddfef566e8c9@mail.gmail.com>
Message-ID: <476FDC89.5000701@winehq.org>

> Perhaps a silly and/or wrong observation but, is this in an effort to
> support multiple cursors?

No, not at all.  It's fixing a pretty awful bug; the old code
relied on the physical device id exactly lining up with the cursor
number.

Cheers,

Jeremy


From dank at kegel.com  Mon Dec 24 10:59:50 2007
From: dank at kegel.com (Dan Kegel)
Date: Mon, 24 Dec 2007 08:59:50 -0800
Subject: Which is more important to Linux users, itunes or photoshop?
In-Reply-To: <1198511894.11540.3.camel@mighmos>
References: <a71bd89a0712232010i715b609k5a99e300d55be90b@mail.gmail.com>
	<1198511894.11540.3.camel@mighmos>
Message-ID: <a71bd89a0712240859r43338744s22de7a979b866c78@mail.gmail.com>

On Dec 24, 2007 7:58 AM, Adam Petaccia <adam at tpetaccia.com> wrote:
> I'm not a developer, but it seems to me that people google search when
> something /doesn't/ work.  Few people google wine+world of warcraft (or
> WoW) because it works out of the box for most people, for example.

By that argument, google searches are a good indication of where we
need to focus our effort.  And that's exactly what I was after.


From dank at kegel.com  Mon Dec 24 11:13:10 2007
From: dank at kegel.com (Dan Kegel)
Date: Mon, 24 Dec 2007 09:13:10 -0800
Subject: Anyone know how to produce a win16 pkzip self-extractor?
Message-ID: <a71bd89a0712240913t776a4f36u8b205962c59862d2@mail.gmail.com>

To look into
http://bugs.winehq.org/show_bug.cgi?id=3620
I wanted to create a 16 bit self-extracting archive.

So I downloaded
ftp://ftp.pkware.com/pk263w16.exe
and followed the instructions in Help for creating a windows self-extractor.
Sadly, 'file' on the resulting .exe says it's just a zip file.

The help file says you can convert a .zip to a .exe
using File / Convert, but that crashes with
Unhandled exception: page fault on read access to 0xffffffff in 16-bit
code (12e7:be9a).
deep inside pkzip.

So I tried the 32 bit version, which according to
http://www.ecn.wfu.edu/~cottrell/pkzip.html#sfx can
do it cross-platform.

But when I tried
http://www.filegate.net/pkware/pkwin32/pk250c32.exe
with
wine PKZIP25.EXE -add -sfx=win16 test *.TXT
it said
PKZIP: (E5) Unknown or illegal sub-option - sfx=win16
which, I think, means you have to be using a registered copy
to do cross-platform self-extractors.

I also tried the DOS version, and that just hung (grumble).

Anyone figured out a way to do this yet?

I filed a bug for a console problem related to pkzip,
http://bugs.winehq.org/show_bug.cgi?id=10884
but not the crash yet.
Perhaps the failure to create a real self-extractor
is another bug, I haven't tried on windows xp yet.
- Dan


From thunderbird2k at gmx.net  Mon Dec 24 11:58:24 2007
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Mon, 24 Dec 2007 18:58:24 +0100
Subject: Which is more important to Linux users, itunes or photoshop?
In-Reply-To: <a71bd89a0712240859r43338744s22de7a979b866c78@mail.gmail.com>
References: <a71bd89a0712232010i715b609k5a99e300d55be90b@mail.gmail.com>
	<1198511894.11540.3.camel@mighmos>
	<a71bd89a0712240859r43338744s22de7a979b866c78@mail.gmail.com>
Message-ID: <20071224175824.318080@gmx.net>

> On Dec 24, 2007 7:58 AM, Adam Petaccia <adam at tpetaccia.com> wrote:
> > I'm not a developer, but it seems to me that people google search when
> > something /doesn't/ work.  Few people google wine+world of warcraft (or
> > WoW) because it works out of the box for most people, for example.
> 
> By that argument, google searches are a good indication of where we
> need to focus our effort.  And that's exactly what I was after.
> 

Another interesting search is this to add 'office linux' though the problem is that it is hard to say if everyone means microsoft office with it but even if only half the people mean that, then there is still a very high demand. I haven't looked for internet explorer or excel/word/powerpoint themselves:
http://www.google.com/trends?q=office+linux%2C+dreamweaver+linux%2C+%22world+of+warcraft%22+linux%2C++itunes+linux%2C+photoshop+linux&ctab=0&geo=all&date=all&sort=0

Roderick
-- 
Ist Ihr Browser Vista-kompatibel? Jetzt die neuesten 
Browser-Versionen downloaden: http://www.gmx.net/de/go/browser


From pgquiles at elpauer.org  Mon Dec 24 12:37:08 2007
From: pgquiles at elpauer.org (Pau Garcia i Quiles)
Date: Mon, 24 Dec 2007 19:37:08 +0100
Subject: Anyone know how to produce a win16 pkzip self-extractor?
In-Reply-To: <a71bd89a0712240913t776a4f36u8b205962c59862d2@mail.gmail.com>
References: <a71bd89a0712240913t776a4f36u8b205962c59862d2@mail.gmail.com>
Message-ID: <20071224193708.a3ma67jcgo88gk40@www.elpauer.org>

Quoting Dan Kegel <dank at kegel.com>:

I have tried with WinRAR 1.54, which is available at  
http://www.oldversion.com/program.php?n=winrar, and it works. I am not  
sure if that's 16 or 32-bit, though. The resulting executable does not  
work, by the way.

> To look into
> http://bugs.winehq.org/show_bug.cgi?id=3620
> I wanted to create a 16 bit self-extracting archive.
>
> So I downloaded
> ftp://ftp.pkware.com/pk263w16.exe
> and followed the instructions in Help for creating a windows self-extractor.
> Sadly, 'file' on the resulting .exe says it's just a zip file.
>
> The help file says you can convert a .zip to a .exe
> using File / Convert, but that crashes with
> Unhandled exception: page fault on read access to 0xffffffff in 16-bit
> code (12e7:be9a).
> deep inside pkzip.
>
> So I tried the 32 bit version, which according to
> http://www.ecn.wfu.edu/~cottrell/pkzip.html#sfx can
> do it cross-platform.
>
> But when I tried
> http://www.filegate.net/pkware/pkwin32/pk250c32.exe
> with
> wine PKZIP25.EXE -add -sfx=win16 test *.TXT
> it said
> PKZIP: (E5) Unknown or illegal sub-option - sfx=win16
> which, I think, means you have to be using a registered copy
> to do cross-platform self-extractors.
>
> I also tried the DOS version, and that just hung (grumble).
>
> Anyone figured out a way to do this yet?
>
> I filed a bug for a console problem related to pkzip,
> http://bugs.winehq.org/show_bug.cgi?id=10884
> but not the crash yet.
> Perhaps the failure to create a real self-extractor
> is another bug, I haven't tried on windows xp yet.
> - Dan
>
>
>



-- 
Pau Garcia i Quiles
http://www.elpauer.org
(Due to my workload, I may need 10 days to answer)



From kevin at plop.org  Mon Dec 24 12:36:21 2007
From: kevin at plop.org (Kevin Koltzau)
Date: Mon, 24 Dec 2007 13:36:21 -0500
Subject: Anyone know how to produce a win16 pkzip self-extractor?
In-Reply-To: <a71bd89a0712240913t776a4f36u8b205962c59862d2@mail.gmail.com>
References: <a71bd89a0712240913t776a4f36u8b205962c59862d2@mail.gmail.com>
Message-ID: <200712241336.21277.kevin@plop.org>

On Monday 24 December 2007 12:13:10 pm Dan Kegel wrote:
> To look into
> http://bugs.winehq.org/show_bug.cgi?id=3620
> I wanted to create a 16 bit self-extracting archive.
>
> I also tried the DOS version, and that just hung (grumble).

pkzip 2.5 for dos works fine under dosbox


From jwhite at winehq.org  Mon Dec 24 13:47:56 2007
From: jwhite at winehq.org (Jeremy White)
Date: Mon, 24 Dec 2007 13:47:56 -0600
Subject: The status of the wintab dll
In-Reply-To: <420BCCC8.7090405@sneakemail.com>
References: <420BCCC8.7090405@sneakemail.com>
Message-ID: <47700CEC.9010704@winehq.org>

Hi Folks,

Okay, I've now spent some time putting some love into wintab.dll,
and I've now gotten to the point where Photoshop 7 works properly,
no matter what order your X devices are in.

I've also improved behavior of a number of other test programs
I worked with as I struggled with Photoshop.

But now I'm done, because Photoshop tilt + pressure work again.  (Yay!)

I thought I'd reprise my current understanding for future posterity.

First, there are 2 immediate changes that are clearly appropriate to make:

  1.  We should strip out devices like mice and such.

      Otherwise, anyone with more than 1 mouse is going to appear to
      have a tablet with 1 cursor.  A simple exclusion of devices without
      'Wacom' or stylus/cursor/eraser in either their name or type should suffice.


  2.  The following commit, I believe, is wrong:

      commit ee2db299deb19c76a5ff9a5338b3640b490494e4
      Author: Mikolaj Zalewski <mikolajz at google.com>
      Date:   Thu Aug 30 12:41:37 2007 -0700

          winex11.drv: wintab: Copy also the button #0 state.

      That is, in X, our devices come out as 1 based (not 0 based), and
      on Windows, they report as 0 based.  iow, with this patch, pkButtons is always 2;
      on Windows, it's always 1.

      But no app I've seen so far really cares, and I don't feel that
      I know enough to really assert what the 'right' implementation is.

      The truth is, the whole logic around pkButtons and BUTTONMAP and so on is
      clearly not fully implemented; we don't do the weird magical thing with
      relative positioning reports, for example.


Finally, from a 'big picture' perspective, wintab.dll could really use some
serious love.  Further, it's a fairly straight forward process.  This would
make a really good beginner project.  You just need a tablet, mostly.

I think the appropriate next step is for someone to write a comprehensive
tablet test utility, to run both on Windows and to compare under Wine.

That's the next step imho.

I'm going into Robert's status to note what I think has changed.

> 
> ***In Painter 5
> *Cursor pressure works. (Therefore is usable by most)
> *Cursor orientation is a little odd: The orientation maths needs to be
> re-done.

  Unchanged.

> *No eraser. Haven't yet cracked what enables the eraser.

  Should be fixed.

> *Doesn't work in desktop mode: Need to map to desktop coordinates.
> *Repeats windows bugs where cursor looses pressure/orientation info
> almost bug for bug (Is this a feature? ;-)
> *Cannot detect pressure/orientation int the "Brush Tracking" window: The
> tablet context is attached to the main window, so no events get to the
> popup, even if they overlap.
> This is not how windows wintab functions.
> 
> ***In Photoshop 6.
> *Can only get tablet data in desktop mode: This is because the tablet
> context is attached to the desktop. Which generates/receives no wine
> events outside desktop mode.
> * Eraser and pen pressure working. *But* to get them working, you must
> have 3 XInput devices listed in your XF86Config file, They need to be
> the last entries in the "ServerLayout" section and the following order:
> eraser, tablet mouse. This is a far from ideal way of specifying the
> devices Wintab should use :-/
> I'll document this if someone can point me to a good place to put the docs.

  This should be fixed.
> 
> *******To Do*************
> 
> 1. Look at X11 errors. There appear to be some errors that deny some
> users the
> ability to access Wintab enabled apps. (I think I know how to fix this)
> 2. Improve orientation data. Orientation comes in as X-Y coords
> (Implicit Z), and has to leave as spherical coords. This calculation
> needs to be re-done.
> 3. When tablet context is on top, let it read XInput events from all the
> app's top-level windows. (This simulates the fact that the context is
> usually designed to cover the whole screen)
> 4. When tablet context is attached to desktop, read XInput events from
> all the app's top-level windows.
> 5. Tests
> ~    --My current philosophy on tests is...
> ~    Use Photoshop & Painter, any formal tests
> ~    can be written if anyone else gets involved in patching Wintab, to
> avoid regressions, and conflict.

  I disagree; I think a test application is the clear next step.
Too much is done by trial + error, and some rigor is the next step imho.

> 
> **********Long term to do (Anyone interested?):*********
> There's a lot of work that could be done here, but what gets done
> and who does it probably depends upon whether anyone finds an app that
> needs these features. I'd love to implement these, but realistically, I
> don't
> foresee doing this unless someone hires me to do so ;)
> 
> 1. Improve configuration of wintab.
>     Wintab could probably do with some information entered into the
>     config file, to avoid the user having to
>     hack their Xfree86cfg file.
> 2. Handle Z-Order of context properly.
>     This entails
>         *sharing Z-Order between apps.
>         *Working out exactly what role windows have in
>          determining tablet context z-orders.
>         *Allow tablet contexts that don't cover the whole
>          screen/tablet.
>         *Handle inter-application clipping of tablet contexts
>         *Allow all application's windows to receive tablet events when
> tablet
> context is on top
> 
> 3. Implement non-system tablet contexts (Where system cursor not moved
> by pen or mouse)
> 4. Unicodify

  Done, I think.

> 5. Implement various wintab extensions.
> 6. Implement wintab manager functions.
> 7. Tests.
> 
> *********Unknowns*********
> 
> 1. How are wintab contexts are raised lowered?
> Contexts have their own z-order independent of windows, and their own
> viewport concept, based upon the tablet's coordinate system, not that of
> the OS.
> It appears that entering, or clicking on the window the tablet context
> is attached to will raise/lower the context.
> But I haven't done much testing on this.
> In particular, what happens if more than one app request their tablet
> context is attached to the desktop?
> 
> 
> 2. How Painter detects the eraser.
> Have 3 possibilities
>     i. Windows can detect an eraser, and sends specific messages.
>         (I'm sure I've seen this, but can't work out where!)
>     ii. Only works if tablet and cursors are named correctly.
>         (Probably linked to wacom tablets only).
>     iii. I've missed something

   It's all the cursor number; 0 is 'puck', 1 is 'stylus', and 2 is 'eraser'.
> 
> 3. Requirements of other applications


Cheers,

Jeremy


From julliard at winehq.org  Mon Dec 24 14:05:55 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 24 Dec 2007 21:05:55 +0100
Subject: [wintab32 3/7] Add constants for cursor types and use them.
In-Reply-To: <476E9309.8030505@winehq.org> (Jeremy White's message of "Sun, 23
	Dec 2007 10:55:37 -0600")
References: <476E9309.8030505@winehq.org>
Message-ID: <87odcfluxo.fsf@wine.dyndns.org>

Jeremy White <jwhite at winehq.org> writes:

> --- a/include/wintab.h
> +++ b/include/wintab.h
> @@ -525,6 +525,23 @@ typedef struct tagROTATION {  /* 1.1 */
>  #endif
>
>  /***********************************************************************
> + * WACOM WINTAB EXTENSIONS TO SUPPORT CSR_TYPE
> + *   In Wintab 1.2, a CSR_TYPE feature was added.  This adds the
> + *   ability to return a type of cursor on a tablet.
> + *   Unfortunately, we cannot get the cursor type directly from X,
> + *   and it is not specified directly anywhere.  So we virtualize
> + *   the type here.  (This is unfortunate, the kernel module has
> + *   the exact type, but we have no way of getting that module to
> + *   pass us that type).
> + */
> +
> +#define CSR_TYPE_PEN        0x822
> +#define CSR_TYPE_ERASER     0x82a
> +#define CSR_TYPE_MOUSE_2D   0x007
> +#define CSR_TYPE_MOUSE_4D   0x094

This doesn't seem to belong in wintab.h.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Mon Dec 24 14:10:55 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Mon, 24 Dec 2007 21:10:55 +0100
Subject: WineX11.drv: Add an X11 window for the client area [attempt3]
In-Reply-To: <20071218190531.128810@gmx.net> (Roderick Colenbrander's message
	of "Tue, 18 Dec 2007 20:05:31 +0100")
References: <20071218190531.128810@gmx.net>
Message-ID: <87k5n3lupc.fsf@wine.dyndns.org>

"Roderick Colenbrander" <thunderbird2k at gmx.net> writes:

> +    if (data->client_window)
> +    {
> +        int w = data->client_rect.right - data->client_rect.left;
> +        int h = data->client_rect.bottom - data->client_rect.top;
> +
> +        TRACE("Updating client window 0x%lx to %dx%x,%dx%d\n", data->client_window,
> +              data->client_rect.left, data->client_rect.top, w, h);
> +
> +        if(w>0 && h>0) 
> +        {
> +            wine_tsx11_lock();
> +            XMoveResizeWindow(display, data->client_window, data->client_rect.left,
> +                              data->client_rect.top, w, h);
> +            wine_tsx11_unlock();

You should do that only when the size has actually changed.

> +static Window create_client_window( Display *display, struct x11drv_win_data *data)
> +{
> +    XSetWindowAttributes attr;
> +
> +    attr.event_mask = ExposureMask;
> +    attr.bit_gravity = NorthWestGravity;
> +    attr.backing_store = NotUseful;

Using NorthWestGravity is good but you still need to fix the valid rects
calculation accordingly.

> +static void destroy_client_window( Display *display, struct x11drv_win_data *data )
> +{
> +    if (!data->client_window) return;
> +
> +    wine_tsx11_lock();
> +
> +    XDeleteContext( display, data->client_window, winContext );
> +    XDestroyWindow( display, data->client_window );
> +    data->client_window = 0;
> +    XFlush(display);
> +
> +    wine_tsx11_unlock();

The XFlush shouldn't be needed.

> @@ -1569,7 +1648,19 @@ void X11DRV_SetParent( HWND hwnd, HWND parent, HWND old_parent )
>          if (old_parent == GetDesktopWindow())
>          {
>              /* destroy the old X windows */
> -            destroy_whole_window( display, data );
> +
> +            /* Don't destroy the X11 window twice in order to prevent a BadWindow error, if the client window is the whole window */
> +            if(data->whole_window == data->client_window)
> +            {
> +                destroy_whole_window( display, data );
> +                data->client_window = 0;
> +                RemovePropA( data->hwnd, client_window_prop );
> +            }

The test is useless, if you are changing the parent of the desktop
window something is very wrong...

-- 
Alexandre Julliard
julliard at winehq.org


From hverbeet at gmail.com  Mon Dec 24 14:58:35 2007
From: hverbeet at gmail.com (H. Verbeet)
Date: Mon, 24 Dec 2007 21:58:35 +0100
Subject: wined3d: add zero/near zero vertex rhw special case
In-Reply-To: <4770A399.1020301@inbox.lv>
References: <4770A399.1020301@inbox.lv>
Message-ID: <d658b69e0712241258s3b4a4cbat847bef5f85aab5ee@mail.gmail.com>

On 25/12/2007, Alexander Dorofeyev <alexd4 at inbox.lv> wrote:
>
> +    if ((pos[3] < 1e-8) && (pos[3] > -1e-8))
You should probably use eps and -eps there, like the rest of the code does.
Also, please write a test case to prevent this from regressing in the future.


From dank at kegel.com  Mon Dec 24 16:57:34 2007
From: dank at kegel.com (Dan Kegel)
Date: Mon, 24 Dec 2007 14:57:34 -0800
Subject: Anyone know how to produce a win16 pkzip self-extractor?
In-Reply-To: <200712241336.21277.kevin@plop.org>
References: <a71bd89a0712240913t776a4f36u8b205962c59862d2@mail.gmail.com>
	<200712241336.21277.kevin@plop.org>
Message-ID: <a71bd89a0712241457h649a71b9la7768b6db4086ca8@mail.gmail.com>

On Dec 24, 2007 10:36 AM, Kevin Koltzau <kevin at plop.org> wrote:
> > I also tried the DOS version, and that just hung (grumble).
>
> pkzip 2.5 for dos works fine under dosbox

I am sick and tired of us wimping out and pointing people
to dosbox.  Wine should be able to run DOS apps.
See http://bugs.winehq.org/show_bug.cgi?id=9178 for
details.  Mikolaj even provided a patch that gets it working.
IMHO this needs fixing for wine 1.0.
- Dan


From the3dfxdude at gmail.com  Mon Dec 24 17:07:54 2007
From: the3dfxdude at gmail.com (Jesse Allen)
Date: Mon, 24 Dec 2007 16:07:54 -0700
Subject: Which is more important to Linux users, itunes or photoshop?
In-Reply-To: <a71bd89a0712240859r43338744s22de7a979b866c78@mail.gmail.com>
References: <a71bd89a0712232010i715b609k5a99e300d55be90b@mail.gmail.com>
	<1198511894.11540.3.camel@mighmos>
	<a71bd89a0712240859r43338744s22de7a979b866c78@mail.gmail.com>
Message-ID: <530468570712241507g37295915k10f077eb437d13f4@mail.gmail.com>

On Dec 24, 2007 9:59 AM, Dan Kegel <dank at kegel.com> wrote:
> On Dec 24, 2007 7:58 AM, Adam Petaccia <adam at tpetaccia.com> wrote:
> > I'm not a developer, but it seems to me that people google search when
> > something /doesn't/ work.  Few people google wine+world of warcraft (or
> > WoW) because it works out of the box for most people, for example.
>
> By that argument, google searches are a good indication of where we
> need to focus our effort.  And that's exactly what I was after.
>
>

Maybe we should compare the google graph to appdb hits.


From thunderbird2k at gmx.net  Mon Dec 24 17:25:11 2007
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Tue, 25 Dec 2007 00:25:11 +0100
Subject: WineX11.drv: Add an X11 window for the client area [attempt3]
In-Reply-To: <87k5n3lupc.fsf@wine.dyndns.org>
References: <20071218190531.128810@gmx.net> <87k5n3lupc.fsf@wine.dyndns.org>
Message-ID: <20071224232511.203180@gmx.net>

> "Roderick Colenbrander" <thunderbird2k at gmx.net> writes:
> 
> > +    if (data->client_window)
> > +    {
> > +        int w = data->client_rect.right - data->client_rect.left;
> > +        int h = data->client_rect.bottom - data->client_rect.top;
> > +
> > +        TRACE("Updating client window 0x%lx to %dx%x,%dx%d\n",
> data->client_window,
> > +              data->client_rect.left, data->client_rect.top, w, h);
> > +
> > +        if(w>0 && h>0) 
> > +        {
> > +            wine_tsx11_lock();
> > +            XMoveResizeWindow(display, data->client_window,
> data->client_rect.left,
> > +                              data->client_rect.top, w, h);
> > +            wine_tsx11_unlock();
> 
> You should do that only when the size has actually changed.
Is it enough to check if the dimensions changed or should I also care about the position? (I don't think it changes)

> > +static Window create_client_window( Display *display, struct
> x11drv_win_data *data)
> > +{
> > +    XSetWindowAttributes attr;
> > +
> > +    attr.event_mask = ExposureMask;
> > +    attr.bit_gravity = NorthWestGravity;
> > +    attr.backing_store = NotUseful;
> 
> Using NorthWestGravity is good but you still need to fix the valid rects
> calculation accordingly.

What's the problem in X11DRV_SetWindowPos? I have checked valid_rects there but the contents of the two rects stored in it look ok to me. They seem to contain the current and previous location of the whole window (the location of where the window starts ignoring the border added by the WM). What should be done in this part of the code?

> > +static void destroy_client_window( Display *display, struct
> x11drv_win_data *data )
> > +{
> > +    if (!data->client_window) return;
> > +
> > +    wine_tsx11_lock();
> > +
> > +    XDeleteContext( display, data->client_window, winContext );
> > +    XDestroyWindow( display, data->client_window );
> > +    data->client_window = 0;
> > +    XFlush(display);
> > +
> > +    wine_tsx11_unlock();
> 
> The XFlush shouldn't be needed.
When destroying the client window when code to recreate the client window is there, this was needed. I guess because events hadn't arrived yet for the destroyed window. But I can remove it for now as perhaps something else was wrong.

Thanks,
Roderick

-- 
GMX FreeMail: 1 GB Postfach, 5 E-Mail-Adressen, 10 Free SMS.
Alle Infos und kostenlose Anmeldung: http://www.gmx.net/de/go/freemail


From zac at zacbrown.org  Mon Dec 24 17:32:39 2007
From: zac at zacbrown.org (Zac Brown)
Date: Mon, 24 Dec 2007 17:32:39 -0600
Subject: Anyone know how to produce a win16 pkzip self-extractor?
In-Reply-To: <a71bd89a0712241457h649a71b9la7768b6db4086ca8@mail.gmail.com>
References: <a71bd89a0712240913t776a4f36u8b205962c59862d2@mail.gmail.com>	<200712241336.21277.kevin@plop.org>
	<a71bd89a0712241457h649a71b9la7768b6db4086ca8@mail.gmail.com>
Message-ID: <47704197.8050706@zacbrown.org>

Dan Kegel wrote:
> On Dec 24, 2007 10:36 AM, Kevin Koltzau <kevin at plop.org> wrote:
>>> I also tried the DOS version, and that just hung (grumble).
>> pkzip 2.5 for dos works fine under dosbox
> 
> I am sick and tired of us wimping out and pointing people
> to dosbox.  Wine should be able to run DOS apps.
> See http://bugs.winehq.org/show_bug.cgi?id=9178 for
> details.  Mikolaj even provided a patch that gets it working.
> IMHO this needs fixing for wine 1.0.
> - Dan
> 
> 
I agree. One way or another it needs to be done.


From jjmckenzie51 at sprintpcs.com  Mon Dec 24 18:17:56 2007
From: jjmckenzie51 at sprintpcs.com (James McKenzie)
Date: Mon, 24 Dec 2007 17:17:56 -0700
Subject: Anyone know how to produce a win16 pkzip self-extractor?
In-Reply-To: <a71bd89a0712241457h649a71b9la7768b6db4086ca8@mail.gmail.com>
References: <a71bd89a0712240913t776a4f36u8b205962c59862d2@mail.gmail.com>
	<200712241336.21277.kevin@plop.org>
	<a71bd89a0712241457h649a71b9la7768b6db4086ca8@mail.gmail.com>
Message-ID: <47704C34.6080807@sprintpcs.com>

Dan Kegel wrote:
> I am sick and tired of us wimping out and pointing people
> to dosbox.  Wine should be able to run DOS apps.
> See http://bugs.winehq.org/show_bug.cgi?id=9178 for
> details.  Mikolaj even provided a patch that gets it working.
> IMHO this needs fixing for wine 1.0.
> - Dan
>
>   
Dan:

+1 for adding this to 1.0

James



From andrey.turkin at gmail.com  Tue Dec 25 03:30:55 2007
From: andrey.turkin at gmail.com (Andrey Turkin)
Date: Tue, 25 Dec 2007 12:30:55 +0300
Subject: kernel32: Add an ability to execute 32-bit applications from
	16-bit	ones using winoldap.dll
In-Reply-To: <E1J73DW-00074M-W7@mail.codeweavers.com>
References: <E1J73DW-00074M-W7@mail.codeweavers.com>
Message-ID: <4770CDCF.7090405@gmail.com>

Dmitry Timoshkov wrote:
> Hello,
>
> this patch should fix the problem reported in the bug 3620.
>
> winoldap.mod in Windows is a 16-bit .exe which uses its command line to load
> a 32-bit module and pass the parameters to it. Since winebuild doesn't allow
> to create a 16-bit builtin exe, I decided to create a 16-bit builtin dll
> instead. That adds some complexity due to need to create another thread to
> launch a 32-bit application from, and wait until it finishes.
>   
The application mentioned in the bug change current directory to output
dir and then uses WINEXEC with relative filename to start child application.
Thread created by winoldap uses another current directory because of
something, so CreateProcess fails with your patch.

<snip>


> +    if (CreateProcessA( NULL, cmdline, NULL, NULL, FALSE,
> +                        0, NULL, NULL, &startup, &info ))
> +    {
> +        HINSTANCE16 hwinoldap;
> +
> +        /* Give 30 seconds to the app to come up */
> +        wait_input_idle( info.hProcess, 30000 );
> +
> +        args->ret = TRUE;
> +        SetEvent(args->event);
> +
> +        WaitForSingleObject( info.hProcess, INFINITE );
> +
> +        CloseHandle( info.hThread );
> +        CloseHandle( info.hProcess );
> +
> +        /* decrement WINOLDAP usage count to signal that we have finished */
> +        hwinoldap = GetModuleHandle16( "winoldap" );
> +        FreeLibrary16( hwinoldap );
> +    }
>   
Usage count should be decremented regardless of CreateProcess return value.
> +
> +    RestoreThunkLock( count );
> +    HeapFree( GetProcessHeap(), 0, cmdline );
> +
> +    if (!args->ret);
> +        SetEvent( args->event );
>   
Typo.



From julliard at winehq.org  Tue Dec 25 14:11:46 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Tue, 25 Dec 2007 21:11:46 +0100
Subject: WineX11.drv: Add an X11 window for the client area [attempt3]
In-Reply-To: <20071224232511.203180@gmx.net> (Roderick Colenbrander's message
	of "Tue, 25 Dec 2007 00:25:11 +0100")
References: <20071218190531.128810@gmx.net> <87k5n3lupc.fsf@wine.dyndns.org>
	<20071224232511.203180@gmx.net>
Message-ID: <87abnylekd.fsf@wine.dyndns.org>

"Roderick Colenbrander" <thunderbird2k at gmx.net> writes:

> Is it enough to check if the dimensions changed or should I also care
> about the position? (I don't think it changes)

Position can definitely change too.

> What's the problem in X11DRV_SetWindowPos? I have checked valid_rects
> there but the contents of the two rects stored in it look ok to
> me. They seem to contain the current and previous location of the
> whole window (the location of where the window starts ignoring the
> border added by the WM). What should be done in this part of the code?

Since the client window is moved with NorthwestGravity, the valid rects
have to be computed relative to the client, not the whole window. The
client can move relative to the whole window.

-- 
Alexandre Julliard
julliard at winehq.org


From dmitry at codeweavers.com  Tue Dec 25 23:27:53 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Wed, 26 Dec 2007 13:27:53 +0800
Subject: kernel32: Add an ability to execute 32-bit applications
	from16-bit	ones using winoldap.dll
References: <E1J73DW-00074M-W7@mail.codeweavers.com>
	<4770CDCF.7090405@gmail.com>
Message-ID: <004201c84780$11c6b400$a600fea9@DMITRY>

"Andrey Turkin" <andrey.turkin at gmail.com> wrote:

> The application mentioned in the bug change current directory to output
> dir and then uses WINEXEC with relative filename to start child application.
> Thread created by winoldap uses another current directory because of
> something, so CreateProcess fails with your patch.

Thanks for the comments, I sent an improved version of the patch.

-- 
Dmitry.


From dmitry at codeweavers.com  Wed Dec 26 04:48:09 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Wed, 26 Dec 2007 18:48:09 +0800
Subject: include: added the new Vista messages.
References: <3f4fd2640712241805p1e9a6b65j2cde0fc5c7328575@mail.gmail.com>
Message-ID: <010b01c847ac$cf757eb0$a600fea9@DMITRY>

"Reece Dunn" <msclrhd at googlemail.com> wrote:

>  #define WM_SYSDEADCHAR      0x0107
> +#define WM_UNICHAR          0x0109
>  #define WM_KEYFIRST         WM_KEYDOWN
> -#define WM_KEYLAST          0x0108
> +#define WM_KEYLAST          0x0109

Please keep the entries sorted by value.

-- 
Dmitry.


From dmitry at codeweavers.com  Wed Dec 26 04:55:49 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Wed, 26 Dec 2007 18:55:49 +0800
Subject: include: added the new Vista messages.
References: <3f4fd2640712241805p1e9a6b65j2cde0fc5c7328575@mail.gmail.com>
	<010b01c847ac$cf757eb0$a600fea9@DMITRY>
Message-ID: <014e01c847ad$e1f9add0$a600fea9@DMITRY>

"Dmitry Timoshkov" <dmitry at codeweavers.com> wrote:

> "Reece Dunn" <msclrhd at googlemail.com> wrote:
> 
>>  #define WM_SYSDEADCHAR      0x0107
>> +#define WM_UNICHAR          0x0109
>>  #define WM_KEYFIRST         WM_KEYDOWN
>> -#define WM_KEYLAST          0x0108
>> +#define WM_KEYLAST          0x0109
> 
> Please keep the entries sorted by value.

Ignore this, I missed the fact that 0x0108 no more exists.

-- 
Dmitry.


From msclrhd at googlemail.com  Wed Dec 26 04:57:44 2007
From: msclrhd at googlemail.com (Reece Dunn)
Date: Wed, 26 Dec 2007 10:57:44 +0000
Subject: include: added the new Vista messages.
In-Reply-To: <010b01c847ac$cf757eb0$a600fea9@DMITRY>
References: <3f4fd2640712241805p1e9a6b65j2cde0fc5c7328575@mail.gmail.com>
	<010b01c847ac$cf757eb0$a600fea9@DMITRY>
Message-ID: <3f4fd2640712260257m1023d5f8md3661d6b24cd1e95@mail.gmail.com>

On 26/12/2007, Dmitry Timoshkov <dmitry at codeweavers.com> wrote:
> "Reece Dunn" <msclrhd at googlemail.com> wrote:
>
> >  #define WM_SYSDEADCHAR      0x0107
> > +#define WM_UNICHAR          0x0109
> >  #define WM_KEYFIRST         WM_KEYDOWN
> > -#define WM_KEYLAST          0x0108
> > +#define WM_KEYLAST          0x0109
>
> Please keep the entries sorted by value.

They are (in the above example):

0x0107 WM_SYSDEADCHAR
0x0109 WM_UNICHAR
0x010d WM_IME_STARTCOMPOSITION

There is a '-' on the first WM_KEYLAST line, as this has been updated
to 0x0109 (as WM_UNICHAR is now the last key message).

- Reece


From julliard at winehq.org  Wed Dec 26 07:09:09 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 26 Dec 2007 14:09:09 +0100
Subject: include: added the new Vista theme part and state headers.
In-Reply-To: <3f4fd2640712241650n69b1547akfbad2ae496d99450@mail.gmail.com>
	(Reece Dunn's message of "Tue, 25 Dec 2007 00:50:44 +0000")
References: <3f4fd2640712241650n69b1547akfbad2ae496d99450@mail.gmail.com>
Message-ID: <87ejd9mwlm.fsf@wine.dyndns.org>

"Reece Dunn" <msclrhd at googlemail.com> writes:

> In the SDK, vssym32.h includes vsstyle.h (as is done here). However,
> the SDK has obsoleted tmschema.h, and duplicates the entries
> throughout vsstyle.h and vssym32.h.
>
> Since it does not make sense to duplicate the entries (even if
> tmschema.h uses the TM_ macros and vsstyle.h defines the enums by
> hand), vsstyle.h includes tmschema.h.

Maybe it doesn't make sense to duplicate them, but since it's what MS
does, it's what we have to do too.

-- 
Alexandre Julliard
julliard at winehq.org


From msclrhd at googlemail.com  Wed Dec 26 07:34:40 2007
From: msclrhd at googlemail.com (Reece Dunn)
Date: Wed, 26 Dec 2007 13:34:40 +0000
Subject: include: added the new Vista theme part and state headers.
In-Reply-To: <87ejd9mwlm.fsf@wine.dyndns.org>
References: <3f4fd2640712241650n69b1547akfbad2ae496d99450@mail.gmail.com>
	<87ejd9mwlm.fsf@wine.dyndns.org>
Message-ID: <3f4fd2640712260534l5a56b058udcf7c5a48b3b7fe@mail.gmail.com>

On 26/12/2007, Alexandre Julliard <julliard at winehq.org> wrote:
> "Reece Dunn" <msclrhd at googlemail.com> writes:
>
> > In the SDK, vssym32.h includes vsstyle.h (as is done here). However,
> > the SDK has obsoleted tmschema.h, and duplicates the entries
> > throughout vsstyle.h and vssym32.h.
> >
> > Since it does not make sense to duplicate the entries (even if
> > tmschema.h uses the TM_ macros and vsstyle.h defines the enums by
> > hand), vsstyle.h includes tmschema.h.
>
> Maybe it doesn't make sense to duplicate them, but since it's what MS
> does, it's what we have to do too.

I'll rework these three patches to follow what MS do then.

In tmschema.h, MS does the following:

    If NTDDI_VERSION is set to NTDDI_LONGHORN or later (or vssym32.h
was included first), and SCHEMA_VERIFY_VSSYM32 is not defined
[backward compatibility verification mode], display an obsoleted
message and include vssym32.h.

    Otherwise, the XP tmschema.h content is used.

This would mean that if you define SCHEMA_VERIFY_VSSYM32, or include
vssym32.h after tmschema.h, then you will get multiple definitions of
the various enumerations.

- Reece


From julliard at winehq.org  Wed Dec 26 09:07:46 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 26 Dec 2007 16:07:46 +0100
Subject: dlls/user32/edit.c -- remove superflous check (RESEND)
In-Reply-To: <Pine.LNX.4.64.0712260959170.29138@acrux.dbai.tuwien.ac.at>
	(Gerald Pfeifer's message of "Wed, 26 Dec 2007 10:00:18 +0100 (CET)")
References: <Pine.LNX.4.64.0712260959170.29138@acrux.dbai.tuwien.ac.at>
Message-ID: <87abnxmr3x.fsf@wine.dyndns.org>

Gerald Pfeifer <gerald at pfeifer.com> writes:

> dwBufLen already indictes that this variable is of type DWORD and
> thus always positive.  I also looked at the implementation of 
> ImmGetCompositionStringW() and we do not seem to return a negative
> value (such as -1).

Maybe the implementation doesn't, but the function returns a LONG, and
can (and probably should) return negative values on error.

-- 
Alexandre Julliard
julliard at winehq.org


From julliard at winehq.org  Wed Dec 26 09:10:18 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Wed, 26 Dec 2007 16:10:18 +0100
Subject: dlls/d3dx8/math.c -- simple fixup (RESEND)
In-Reply-To: <Pine.LNX.4.64.0712261001140.29138@acrux.dbai.tuwien.ac.at>
	(Gerald Pfeifer's message of "Wed, 26 Dec 2007 10:03:07 +0100 (CET)")
References: <Pine.LNX.4.64.0712261001140.29138@acrux.dbai.tuwien.ac.at>
Message-ID: <8763ylmqzp.fsf@wine.dyndns.org>

Gerald Pfeifer <gerald at pfeifer.com> writes:

> Not a biggie, but still in my queue.  If you aren't going to take this
> (admittedly) minor patch, please let me know and I'll remove it locally.

There's no need to worry about the scope of variables in such a small
function.

-- 
Alexandre Julliard
julliard at winehq.org


From zgold550 at gmail.com  Wed Dec 26 11:05:47 2007
From: zgold550 at gmail.com (Zachary Goldberg)
Date: Wed, 26 Dec 2007 12:05:47 -0500
Subject: Compile info patch
Message-ID: <b050a5e70712260905j3ecacb7cr2d42f6756d8f0623@mail.gmail.com>

I've been checking recently, haven't seen any further discussion on
this patch, or seen it be committed.  Any thoughts on why?  I'm
curious because I think its useful, and because I wrote a WWN article
on it -- which of course only makes sense if the patch is applied :).

-- 
Zachary Goldberg
Computer Science & Engineering
Electrical Captain of Penn Electric Race Team
School of Engineering at the University of Pennsylvania


From stefan at codeweavers.com  Wed Dec 26 14:51:09 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Wed, 26 Dec 2007 21:51:09 +0100
Subject: wined3d: dirtify colorkey state in IWineD3DDeviceImpl_SetTexture
In-Reply-To: <477345C9.9010705@inbox.lv>
References: <477345C9.9010705@inbox.lv>
Message-ID: <200712262151.10044.stefan@codeweavers.com>

Am Donnerstag, 27. Dezember 2007 07:27:21 schrieb Alexander Dorofeyev:
> Hi.
>
> Colorkey emulation by alpha test should be disabled when game sets no
> texture (or texture without colorkey) and reenabled when needed. Dirtifying
> a state here, so that state_alpha will be called, fixes the problem.
In theory the texture stage handler calls the colorkey handler if a color key 
change condition is met. Can you check why the call to state_alpha() in 
sampler() in state.c, line 2415 isn't called properly?


From alexd4 at inbox.lv  Thu Dec 27 01:24:31 2007
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Wed, 26 Dec 2007 23:24:31 -0800
Subject: wined3d: dirtify colorkey state in IWineD3DDeviceImpl_SetTexture
In-Reply-To: <200712262151.10044.stefan@codeweavers.com>
References: <477345C9.9010705@inbox.lv>
	<200712262151.10044.stefan@codeweavers.com>
Message-ID: <4773532F.9010309@inbox.lv>

Oops, too bad I didn't notice it's supposed to happen in sampler. Why that isn't 
called - I think it's because that check at line 2415 is inside

if(stateblock->textures[sampler]) {

block. Since the app is setting texture to NULL, it's not entering. Taking the 
colorkey part out of this block helps. I guess it will be a better fix then.

Stefan D?singer wrote:
> Am Donnerstag, 27. Dezember 2007 07:27:21 schrieb Alexander Dorofeyev:
>> Hi.
>>
>> Colorkey emulation by alpha test should be disabled when game sets no
>> texture (or texture without colorkey) and reenabled when needed. Dirtifying
>> a state here, so that state_alpha will be called, fixes the problem.
> In theory the texture stage handler calls the colorkey handler if a color key 
> change condition is met. Can you check why the call to state_alpha() in 
> sampler() in state.c, line 2415 isn't called properly?



From gerald at pfeifer.com  Wed Dec 26 15:30:46 2007
From: gerald at pfeifer.com (Gerald Pfeifer)
Date: Wed, 26 Dec 2007 22:30:46 +0100 (CET)
Subject: dlls/user32/edit.c -- remove superflous check (RESEND)
In-Reply-To: <87abnxmr3x.fsf@wine.dyndns.org>
References: <Pine.LNX.4.64.0712260959170.29138@acrux.dbai.tuwien.ac.at>
	<87abnxmr3x.fsf@wine.dyndns.org>
Message-ID: <Pine.LNX.4.64.0712262215090.29138@acrux.dbai.tuwien.ac.at>

On Wed, 26 Dec 2007, Alexandre Julliard wrote:
>> dwBufLen already indictes that this variable is of type DWORD and
>> thus always positive.  I also looked at the implementation of 
>> ImmGetCompositionStringW() and we do not seem to return a negative
>> value (such as -1).
> Maybe the implementation doesn't, but the function returns a LONG, and
> can (and probably should) return negative values on error.

Okay.  In that case, to account for possible future enhancements of 
ImmGetCompositionStringW(), we'll need a patch like the following. The 
current error handling code in EDIT_GetCompositionStr() simply doesn't 
work due to the unsignedness of dwBufLen.

Gerald

ChangeLog:
Fix error handling in EDIT_GetCompositionStr().

Index: dlls/user32/edit.c
===================================================================
RCS file: /home/wine/wine/dlls/user32/edit.c,v
retrieving revision 1.16
diff -u -3 -p -r1.16 edit.c
--- dlls/user32/edit.c	20 Nov 2007 16:56:17 -0000	1.16
+++ dlls/user32/edit.c	26 Dec 2007 21:29:33 -0000
@@ -5360,6 +5348,7 @@ static void EDIT_UpdateText(EDITSTATE *e
 
 static void EDIT_GetCompositionStr(HWND hwnd, LPARAM CompFlag, EDITSTATE *es)
 {
+    LONG l;
     DWORD dwBufLen;
     LPWSTR lpCompStr = NULL;
     HIMC hIMC;
@@ -5369,9 +5358,9 @@ static void EDIT_GetCompositionStr(HWND 
     if (!(hIMC = ImmGetContext(hwnd)))
         return;
 
-    dwBufLen = ImmGetCompositionStringW(hIMC, GCS_COMPSTR, NULL, 0);
+    dwBufLen = l = ImmGetCompositionStringW(hIMC, GCS_COMPSTR, NULL, 0);
 
-    if (dwBufLen < 0)
+    if (l < 0)
     {
         ImmReleaseContext(hwnd, hIMC);
         return;


From stefan at codeweavers.com  Wed Dec 26 19:19:16 2007
From: stefan at codeweavers.com (Stefan =?iso-8859-1?q?D=F6singer?=)
Date: Thu, 27 Dec 2007 02:19:16 +0100
Subject: [PATCH] ddraw: Return a nullpointer as lpSurface in Lock() if the
	rect is invalid.
In-Reply-To: <1198704916.3577.2.camel@localhost>
References: <1198704916.3577.2.camel@localhost>
Message-ID: <200712270219.16576.stefan@codeweavers.com>

Am Mittwoch, 26. Dezember 2007 22:35:16 schrieb G?nther Brammer:
> +            memset(&locked_desc, 1, sizeof(locked_desc));
> +            locked_desc.dwSize = sizeof(locked_desc);
> +
>              hr = IDirectDrawSurface_Lock(surface, rect, &locked_desc,
> DDLOCK_WAIT, NULL); ok(hr == DDERR_INVALIDPARAMS, "Lock returned 0x%08x for
> rect [%d, %d]->[%d, %d]" ", expected DDERR_INVALIDPARAMS (0x%08x)\n", hr,
> rect->left, rect->top, rect->right, rect->bottom, DDERR_INVALIDPARAMS); +  
>          ok(!memcmp(&locked_desc, &surface_desc, sizeof(locked_desc)),
> "IDirectDrawSurface_Lock did not set lpSurface in the surface desc\n"); }
I think you should just compare lpSurface instead of memcmp'ing the entire 
structure.

Also, in the patch that changes surface.c, it seems that the patch changes a 
few whitespaces(unless I missed something).


From dmitry at codeweavers.com  Thu Dec 27 05:05:02 2007
From: dmitry at codeweavers.com (Dmitry Timoshkov)
Date: Thu, 27 Dec 2007 19:05:02 +0800
Subject: user32: Test destroying the cursor of a parent process.
References: <689de9370712270215sc48c10bg8551e8b484b73a34@mail.gmail.com>
Message-ID: <004301c84878$55e203d0$a600fea9@DMITRY>

"Andrew Riedi" <andrewriedi at gmail.com> wrote:

> changelog: user32: Test destroying the cursor of a parent process.

This doesn't look at all like a suggested way to test interprocess
cursor handles we discussed on IRC: create a process, create a window
in it, use SendMessage to pass requests/results in order to avoid
creating a child process for each thing you would like to test.

-- 
Dmitry.


From rob at codeweavers.com  Thu Dec 27 05:56:03 2007
From: rob at codeweavers.com (Robert Shearman)
Date: Thu, 27 Dec 2007 11:56:03 +0000
Subject: [wintab32] Refine how we determine cursor types; use that to
	discard	non tablet devices.
In-Reply-To: <4772B140.3060709@codeweavers.com>
References: <4772B140.3060709@codeweavers.com>
Message-ID: <477392D3.2060409@codeweavers.com>

Jeremy White wrote:
> +/* FIXME:  strcasestr is not available on all platforms; implement a simple version */
> +static char * poormans_strcasestr(const char *haystack, const char *needle)
>   

This is something that can be put in include/wine/port.h.

-- 
Rob Shearman



From julliard at winehq.org  Thu Dec 27 06:27:26 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Thu, 27 Dec 2007 13:27:26 +0100
Subject: Compile info patch
In-Reply-To: <b050a5e70712260905j3ecacb7cr2d42f6756d8f0623@mail.gmail.com>
	(Zachary Goldberg's message of "Wed, 26 Dec 2007 12:05:47 -0500")
References: <b050a5e70712260905j3ecacb7cr2d42f6756d8f0623@mail.gmail.com>
Message-ID: <87zlvw5nm9.fsf@wine.dyndns.org>

"Zachary Goldberg" <zgold550 at gmail.com> writes:

> I've been checking recently, haven't seen any further discussion on
> this patch, or seen it be committed.  Any thoughts on why?  I'm
> curious because I think its useful, and because I wrote a WWN article
> on it -- which of course only makes sense if the patch is applied :).

This stuff has nothing to do in the code, particularly not in the
loader. If you want to check the result of configure you should look at
config.log. If you want to know whether a given feature is supported,
you should try to make use of it; for instance open the audio tab in
winecfg to find out which sound drivers are working, etc.

-- 
Alexandre Julliard
julliard at winehq.org


From zac at zacbrown.org  Thu Dec 27 09:16:38 2007
From: zac at zacbrown.org (Zac Brown)
Date: Thu, 27 Dec 2007 09:16:38 -0600
Subject: [Fwd: [advapi32] Correctly handle incorrect buffer sizes
	in	LookupAccountNameA (RESEND)]
Message-ID: <4773C1D6.2000602@zacbrown.org>

Hi,

Could I get some feedback on this patch as to why it wasn't accepted? Just
trying to see where I've gone wrong and what I can do to improve the patch.

Any feedback would be greatly appreciated. Thanks!

-Zac

-------- Original Message --------
Subject: [advapi32] Correctly handle incorrect buffer sizes in
LookupAccountNameA (RESEND)
Date: Fri, 21 Dec 2007 02:32:45 -0600
From: Zac Brown <zac at zacbrown.org>
Reply-To: wine-devel at winehq.org
To: wine-patches at winehq.org

Hi,

Changelog:
* Correctly handle incorrect buffer sizes in LookupAccountNameA

Notes:
* Fixes bug 10612

-Zac Brown


-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-Correctly-handle-incorrect-buffer-sizes-in-LookupAcc.patch
Type: text/x-patch
Size: 3217 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071227/1c296335/attachment.bin 

From winehacker at gmail.com  Thu Dec 27 10:10:17 2007
From: winehacker at gmail.com (Steven Edwards)
Date: Thu, 27 Dec 2007 11:10:17 -0500
Subject: Compile info patch
In-Reply-To: <87zlvw5nm9.fsf@wine.dyndns.org>
References: <b050a5e70712260905j3ecacb7cr2d42f6756d8f0623@mail.gmail.com>
	<87zlvw5nm9.fsf@wine.dyndns.org>
Message-ID: <19e31a080712270810t7c8b98a1hf2e8c351c40d64da@mail.gmail.com>

On Dec 27, 2007 7:27 AM, Alexandre Julliard <julliard at winehq.org> wrote:
> This stuff has nothing to do in the code, particularly not in the
> loader. If you want to check the result of configure you should look at
> config.log. If you want to know whether a given feature is supported,
> you should try to make use of it; for instance open the audio tab in
> winecfg to find out which sound drivers are working, etc.

It would be kind of nice if this information was somewhere for binary
builds. Unless of course you mean the rpm/deb packagers should ship
with a config.log....


-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From zgold550 at gmail.com  Thu Dec 27 11:31:22 2007
From: zgold550 at gmail.com (Zachary Goldberg)
Date: Thu, 27 Dec 2007 12:31:22 -0500
Subject: Compile info patch
In-Reply-To: <19e31a080712270810t7c8b98a1hf2e8c351c40d64da@mail.gmail.com>
References: <b050a5e70712260905j3ecacb7cr2d42f6756d8f0623@mail.gmail.com>
	<87zlvw5nm9.fsf@wine.dyndns.org>
	<19e31a080712270810t7c8b98a1hf2e8c351c40d64da@mail.gmail.com>
Message-ID: <b050a5e70712270931oa178dd4q271ba1356f855865@mail.gmail.com>

On Dec 27, 2007 11:10 AM, Steven Edwards <winehacker at gmail.com> wrote:
> On Dec 27, 2007 7:27 AM, Alexandre Julliard <julliard at winehq.org> wrote:
> > This stuff has nothing to do in the code, particularly not in the
> > loader. If you want to check the result of configure you should look at
> > config.log. If you want to know whether a given feature is supported,
> > you should try to make use of it; for instance open the audio tab in
> > winecfg to find out which sound drivers are working, etc.
>
> It would be kind of nice if this information was somewhere for binary
> builds. Unless of course you mean the rpm/deb packagers should ship
> with a config.log....
>
>
> --
> Steven Edwards
>
> "There is one thing stronger than all the armies in the world, and
> that is an idea whose time has come." - Victor Hugo
>

Even if the config.log was shipped, my feelings are thus:

There will always be people in #wine asking for help who are fairly
hopeless to find and parse through a config.log, no matter how good
wine gets.  I agree that competent users and devs could easily find
this information; heck most of them probably would know all that
information without even needing to look for their own systems.  But
for the sake of helping people on #wine help users in debugging
issues, I think this could be a help.

Just 2 cents,
--Zach


From rmh at aybabtu.com  Thu Dec 27 15:50:55 2007
From: rmh at aybabtu.com (Robert Millan)
Date: Thu, 27 Dec 2007 22:50:55 +0100
Subject: splitting out on_winver_change() and friends
Message-ID: <20071227215055.GA13916@thorin>


Hi

I'm writing a small application to automate the process of setting Windows
version for executables that are known to require a specific one.  I'd like
it to use the knowledge about defining Windows versions contained in
winecfg/appdefaults.c instead of duplicating/forking code from it.

Would it be ok to move on_winver_change() and some of its friends like
win_versions[] and set_reg_key() to libwine.so.1 for this purpose ?

-- 
Robert Millan

<GPLv2> I know my rights; I want my phone call!
<DRM> What use is a phone call, if you are unable to speak?
(as seen on /.)


From jgardou at yahoo.fr  Thu Dec 27 18:27:20 2007
From: jgardou at yahoo.fr (=?iso-8859-1?q?J=E9r=F4me_Gardou?=)
Date: Fri, 28 Dec 2007 01:27:20 +0100
Subject: winelib and exceptions
Message-ID: <200712280127.20600.jgardou@yahoo.fr>

Hello.

I'm trying to handle exceptions in a winelib program i'm writing.

after 
#include <exceptions.h>

I'm using the GetExceptionInformation() function, but then winegcc complains 
that __eptr has not been defined.

Any tip/idea on what's going on ?

	

	
		
___________________________________________________________________________ 
Yahoo! Mail r?invente le mail ! D?couvrez le nouveau Yahoo! Mail et son interface r?volutionnaire.
http://fr.mail.yahoo.com



From alexd4 at inbox.lv  Fri Dec 28 04:39:27 2007
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Fri, 28 Dec 2007 02:39:27 -0800
Subject: What's the status of these patches by Roderick Colenbrander?
Message-ID: <4774D25F.5020305@inbox.lv>

WineD3D: p8 palette in alpha fix 2/2 [attempt 2]
WineD3D: fix p8 GL_EXT_paletted texture bug 1/2 [attempt 2]

Submitted something like 5 day ago, but I think they didn't make it to 
git? They are needed to fix some bugs, like this:

http://bugs.winehq.org/show_bug.cgi?id=10797

Roderick, maybe you can resubmit them?


From winehacker at gmail.com  Fri Dec 28 04:43:40 2007
From: winehacker at gmail.com (Steven Edwards)
Date: Fri, 28 Dec 2007 05:43:40 -0500
Subject: splitting out on_winver_change() and friends
In-Reply-To: <20071227215055.GA13916@thorin>
References: <20071227215055.GA13916@thorin>
Message-ID: <19e31a080712280243n2fb913fer392e0ed37b208145@mail.gmail.com>

Hi,

On Dec 27, 2007 4:50 PM, Robert Millan <rmh at aybabtu.com> wrote:
> I'm writing a small application to automate the process of setting Windows
> version for executables that are known to require a specific one.  I'd like
> it to use the knowledge about defining Windows versions contained in
> winecfg/appdefaults.c instead of duplicating/forking code from it.
>
> Would it be ok to move on_winver_change() and some of its friends like
> win_versions[] and set_reg_key() to libwine.so.1 for this purpose ?

How about rather than writing another application to do this, you make
winecfg take arguments on the command line so you could set something
like

winecfg foo.exe --winver win98 --dll=gdiplus.dll=n

Then all you need is a script for your known bad applications....

Thanks
Steven

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From winehacker at gmail.com  Fri Dec 28 04:49:39 2007
From: winehacker at gmail.com (Steven Edwards)
Date: Fri, 28 Dec 2007 05:49:39 -0500
Subject: splitting out on_winver_change() and friends
In-Reply-To: <19e31a080712280243n2fb913fer392e0ed37b208145@mail.gmail.com>
References: <20071227215055.GA13916@thorin>
	<19e31a080712280243n2fb913fer392e0ed37b208145@mail.gmail.com>
Message-ID: <19e31a080712280249m2d0940desd3654b841c736666@mail.gmail.com>

On Dec 28, 2007 5:43 AM, Steven Edwards <winehacker at gmail.com> wrote:
> How about rather than writing another application to do this, you make
> winecfg take arguments on the command line so you could set something
> like
>
> winecfg foo.exe --winver win98 --dll=gdiplus.dll=n
>
> Then all you need is a script for your known bad applications....

Actually, another way you could do it is to use inf files and store
them in a database. We discussed something like this for the appdb.
Using inf's would be a cleaner method than hacking winecfg to automate
importing this data in to the registry and then everyone can use it.
I'd suggest if you know of an application thats buggy, needs the
version and dll information hard set, you try the inf route and submit
it to appdb if its an application listed there.

Thanks

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From samuel at slbdata.se  Fri Dec 28 07:31:52 2007
From: samuel at slbdata.se (Samuel =?ISO-8859-1?Q?Lid=E9n?= Borell)
Date: Fri, 28 Dec 2007 14:31:52 +0100
Subject: Uninitialized static consts
Message-ID: <1198848712.5668.36.camel@crashie>

Hi,

I discovered a static constant wasn't initialized in RedrawWindow when I
was using Valgrind. I wonder if this is a problem or not, because it has
been there since 2005 and it doesn't give any compiler warnings. AFAIK
constants can't be initialized later (unless they are pointers), so it
seems to me that this really is a problem.

I used a regex to find other occurrences of uninitialized consts, and I
found a lot of them. Most of them are interfaces, but I don't know what
interfaces *really* are, so I don't know about these. But types like
structs and unions should be initialized, right?

Here's the command I used:
grep -E 'static const [^*=;]+;' `find -iname '*.c'`


Please CC me any replies because I'm not subscribing to the list.


Regards,
Samuel Lid?n Borell




From thunderbird2k at gmx.net  Fri Dec 28 08:35:19 2007
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Fri, 28 Dec 2007 15:35:19 +0100
Subject: What's the status of these patches by Roderick Colenbrander?
In-Reply-To: <4774D25F.5020305@inbox.lv>
References: <4774D25F.5020305@inbox.lv>
Message-ID: <20071228143519.203150@gmx.net>

> WineD3D: p8 palette in alpha fix 2/2 [attempt 2]
> WineD3D: fix p8 GL_EXT_paletted texture bug 1/2 [attempt 2]
> 
> Submitted something like 5 day ago, but I think they didn't make it to 
> git? They are needed to fix some bugs, like this:
> 
> http://bugs.winehq.org/show_bug.cgi?id=10797
> 
> Roderick, maybe you can resubmit them?
> 

They just entered GIT. Perhaps Alexandre was busy or missed them.

Roderick
-- 
GMX FreeMail: 1 GB Postfach, 5 E-Mail-Adressen, 10 Free SMS.
Alle Infos und kostenlose Anmeldung: http://www.gmx.net/de/go/freemail


From maarten at codeweavers.com  Fri Dec 28 10:54:18 2007
From: maarten at codeweavers.com (Maarten Lankhorst)
Date: Fri, 28 Dec 2007 17:54:18 +0100
Subject: What happened to the videos from WineConf?
Message-ID: <47752A3A.7010704@codeweavers.com>

I remember at wineconf there were some videos created, what happened
with those? I tried to look on youtube for wineconf, but I didn't find
anything. Are they online yet? Or will they be put online?

-Maarten


From dank at kegel.com  Fri Dec 28 10:57:08 2007
From: dank at kegel.com (Dan Kegel)
Date: Fri, 28 Dec 2007 08:57:08 -0800
Subject: Uninitialized static consts
Message-ID: <a71bd89a0712280857s20e60d51le89aa67a525a9f44@mail.gmail.com>

Samuel wrote:
> I discovered a static constant wasn't initialized in RedrawWindow when I
> was using Valgrind. I wonder if this is a problem or not, because it has
> been there since 2005 and it doesn't give any compiler warnings.

static vars are located in the bss section and are initialized
to zero by the runtime loader, iirc.

Can you give more details about the error you found with
Valgrind?
- Dan


From Andrew.Talbot at talbotville.com  Fri Dec 28 10:14:39 2007
From: Andrew.Talbot at talbotville.com (Andrew Talbot)
Date: Fri, 28 Dec 2007 16:14:39 +0000
Subject: Uninitialized static consts
References: <1198848712.5668.36.camel@crashie>
Message-ID: <fl37df$uuj$1@ger.gmane.org>

Samuel Lid?n Borell wrote:

> Hi,
> 
> I discovered a static constant wasn't initialized in RedrawWindow when I
> was using Valgrind. I wonder if this is a problem or not, because it has
> been there since 2005 and it doesn't give any compiler warnings. AFAIK
> constants can't be initialized later (unless they are pointers), so it
> seems to me that this really is a problem.
> 
> I used a regex to find other occurrences of uninitialized consts, and I
> found a lot of them. Most of them are interfaces, but I don't know what
> interfaces *really* are, so I don't know about these. But types like
> structs and unions should be initialized, right?
> 

Hi Samuel,

Objects with static duration, if not specifically initialized, are given
implicit initializers: their elements are zeroed.

Regards,

-- 
Andy.




From samuel at slbdata.se  Fri Dec 28 12:00:41 2007
From: samuel at slbdata.se (Samuel =?ISO-8859-1?Q?Lid=E9n?= Borell)
Date: Fri, 28 Dec 2007 19:00:41 +0100
Subject: Uninitialized static consts
In-Reply-To: <a71bd89a0712280857s20e60d51le89aa67a525a9f44@mail.gmail.com>
References: <a71bd89a0712280857s20e60d51le89aa67a525a9f44@mail.gmail.com>
Message-ID: <1198864841.5668.48.camel@crashie>


The errors (I found some more now) occur when I run a program that I've
made myself, so it could very well be bug in my program and not in Wine.
Anyway, I've uploaded the Valgrind output and the source code of my
program here:

http://www.slbdata.se/hwcheck/wine/



fre 2007-12-28 klockan 08:57 -0800 skrev Dan Kegel:
> Samuel wrote:
> > I discovered a static constant wasn't initialized in RedrawWindow when I
> > was using Valgrind. I wonder if this is a problem or not, because it has
> > been there since 2005 and it doesn't give any compiler warnings.
> 
> static vars are located in the bss section and are initialized
> to zero by the runtime loader, iirc.
> 
> Can you give more details about the error you found with
> Valgrind?
> - Dan



From thestig at google.com  Fri Dec 28 12:26:15 2007
From: thestig at google.com (Lei Zhang)
Date: Fri, 28 Dec 2007 10:26:15 -0800
Subject: What happened to the videos from WineConf?
In-Reply-To: <47752A3A.7010704@codeweavers.com>
References: <47752A3A.7010704@codeweavers.com>
Message-ID: <558b2f5c0712281026x49fe685y9f596ff9872f7059@mail.gmail.com>

On Dec 28, 2007 8:54 AM, Maarten Lankhorst <maarten at codeweavers.com> wrote:
> I remember at wineconf there were some videos created, what happened
> with those? I tried to look on youtube for wineconf, but I didn't find
> anything. Are they online yet? Or will they be put online?
>
> -Maarten
>

The videos have been processed and encoded, but we ran into problems
getting them on youtube. I've found the right person to talk to about
this, so hopefully they'll get the videos online in the next couple
weeks.


From maxime.bellenge at gmail.com  Fri Dec 28 17:05:56 2007
From: maxime.bellenge at gmail.com (Maxime =?ISO-8859-1?Q?Belleng=E9?=)
Date: Sat, 29 Dec 2007 00:05:56 +0100
Subject: [1/3] WineD3D: Fix a problem in BltOverride
In-Reply-To: <200712270209.40026.stefan@codeweavers.com>
References: <200712270209.40026.stefan@codeweavers.com>
Message-ID: <1198883156.18388.2.camel@typhoon>

Hi Stephan,

Since this patch has been commited to git I have a big regression in the
game Syberia. Everything is black. Nothing is displayed expected some
menu items.

In order to determine that this is this patch which is the problem I did
a "git bisect".

Maxime



From alexd4 at inbox.lv  Sat Dec 29 04:32:15 2007
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Sat, 29 Dec 2007 02:32:15 -0800
Subject: [1/3] WineD3D: Fix a problem in BltOverride
Message-ID: <4776222F.50707@inbox.lv>

Hi.

I think it may be the same regression I also saw in another app. At least it
seems to be in that place too. Can you check if this patch helps?

Maxime Belleng? wrote:
     > Hi Stephan,
     >
     > Since this patch has been commited to git I have a big regression in the
     > game Syberia. Everything is black. Nothing is displayed expected some
     > menu items.
     >
     > In order to determine that this is this patch which is the problem I did
     > a "git bisect".
     >
     > Maxime







-------------- next part --------------
A non-text attachment was scrubbed...
Name: e9666f062e997d4c13ef883418430aed2ceae1a4.diff
Type: text/x-patch
Size: 838 bytes
Desc: not available
Url : http://www.winehq.org/pipermail/wine-devel/attachments/20071229/d442c916/attachment.bin 

From Andrew.Talbot at talbotville.com  Sat Dec 29 02:23:14 2007
From: Andrew.Talbot at talbotville.com (Andrew Talbot)
Date: Sat, 29 Dec 2007 08:23:14 +0000
Subject: user32: Remove unneeded casts.
References: <20071229000507.GB25261@redhat.com>
Message-ID: <fl505i$aai$1@ger.gmane.org>

Michael Stefaniuc wrote:

> I just stumbled upon those while researching a potential problem for
> which Smatch issued a warning.
> [...]
> @@ -1324,7 +1324,7 @@ HDDEDATA WINAPI DdeAddData(HDDEDATA hData, LPBYTE
> pSrc, DWORD cb, DWORD cbOff)
>      if (new_sz > old_sz)
>      {
>  DdeUnaccessData(hData);
> -     hData = GlobalReAlloc((HGLOBAL)hData, new_sz +
> sizeof(DDE_DATAHANDLE_HEAD),
> +     hData = GlobalReAlloc(hData, new_sz + sizeof(DDE_DATAHANDLE_HEAD),
[...]

Hi,

In general, I have left the casts in where one PVOID-type handle was cast as
another, e.g. HMODULE as HANDLE: I wasn't sure if strict typing might (one
day) be an issue. AFAIK, my only transgressions were when I removed the
casts from the return values of some {Local|Global}Alloc() and family
functions, where they, strictly speaking, return a handle, not a literal
PVOID, so arguably should be cast. For example:

    PSID pSid = (PSID)LocalAlloc(0, cBytes);

Since LocalAlloc() returns a HLOCAL - which just happens to be a PVOID - one
might argue that the cast should remain. As another example of
type-equivalence versus -distinction, DWORD and ULONG are both defined as
unsigned long, but I have currently left them as distinct types, too.

I would be glad for feedback on how type-strict we should be, please.

Thanks,

-- 
Andy.




From maxime.bellenge at gmail.com  Sat Dec 29 03:29:20 2007
From: maxime.bellenge at gmail.com (Maxime =?ISO-8859-1?Q?Belleng=E9?=)
Date: Sat, 29 Dec 2007 10:29:20 +0100
Subject: [1/3] WineD3D: Fix a problem in BltOverride
In-Reply-To: <4776222F.50707@inbox.lv>
References: <4776222F.50707@inbox.lv>
Message-ID: <1198920561.2789.2.camel@typhoon>

Hi,

Yes the problem is fixed with this patch although I have millions
traces like this one :

err:d3d_surface:IWineD3DSurfaceImpl_BltOverride Unexpected render target
-> render target blit

It makes the game slow whereas before wine 0.9.51 if I remember exactly,
the game was fast without this message. Maybe this trace should be made
a warn instead of en error ?

Maxime


On Sat, 2007-12-29 at 02:32 -0800, Alexander Dorofeyev wrote:
> Hi.
> 
> I think it may be the same regression I also saw in another app. At least it
> seems to be in that place too. Can you check if this patch helps?
> 
> Maxime Belleng? wrote:
>      > Hi Stephan,
>      >
>      > Since this patch has been commited to git I have a big regression in the
>      > game Syberia. Everything is black. Nothing is displayed expected some
>      > menu items.
>      >
>      > In order to determine that this is this patch which is the problem I did
>      > a "git bisect".
>      >
>      > Maxime
> 
> 
> 
> 
> 
> 
> 



From julliard at winehq.org  Sat Dec 29 03:46:16 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Sat, 29 Dec 2007 10:46:16 +0100
Subject: user32: Remove unneeded casts.
In-Reply-To: <fl505i$aai$1@ger.gmane.org> (Andrew Talbot's message of "Sat, 29
	Dec 2007 08:23:14 +0000")
References: <20071229000507.GB25261@redhat.com> <fl505i$aai$1@ger.gmane.org>
Message-ID: <87k5mx6dg7.fsf@wine.dyndns.org>

Andrew Talbot <Andrew.Talbot at talbotville.com> writes:

> In general, I have left the casts in where one PVOID-type handle was cast as
> another, e.g. HMODULE as HANDLE: I wasn't sure if strict typing might (one
> day) be an issue. AFAIK, my only transgressions were when I removed the
> casts from the return values of some {Local|Global}Alloc() and family
> functions, where they, strictly speaking, return a handle, not a literal
> PVOID, so arguably should be cast. For example:
>
>     PSID pSid = (PSID)LocalAlloc(0, cBytes);
>
> Since LocalAlloc() returns a HLOCAL - which just happens to be a PVOID - one
> might argue that the cast should remain. As another example of
> type-equivalence versus -distinction, DWORD and ULONG are both defined as
> unsigned long, but I have currently left them as distinct types, too.
>
> I would be glad for feedback on how type-strict we should be, please.

We want to be as type-strict as possible, but that doesn't mean we want
explicit typecasts, just the opposite in fact. The only way to benefit
from type strictness is to not use casts and let the compiler warn about
mismatches. That's also why generic handles like HANDLE or HLOCAL are
defined as void*, so that they can be assigned to other types without
casting. So typecasts of generic handle types, or of integer types,
should all be avoided as far as possible.

-- 
Alexandre Julliard
julliard at winehq.org


From rmh at aybabtu.com  Sat Dec 29 05:43:15 2007
From: rmh at aybabtu.com (Robert Millan)
Date: Sat, 29 Dec 2007 12:43:15 +0100
Subject: splitting out on_winver_change() and friends
In-Reply-To: <19e31a080712280243n2fb913fer392e0ed37b208145@mail.gmail.com>
References: <20071227215055.GA13916@thorin>
	<19e31a080712280243n2fb913fer392e0ed37b208145@mail.gmail.com>
Message-ID: <20071229114315.GA1799@thorin>

On Fri, Dec 28, 2007 at 05:43:40AM -0500, Steven Edwards wrote:
> Hi,
> 
> On Dec 27, 2007 4:50 PM, Robert Millan <rmh at aybabtu.com> wrote:
> > I'm writing a small application to automate the process of setting Windows
> > version for executables that are known to require a specific one.  I'd like
> > it to use the knowledge about defining Windows versions contained in
> > winecfg/appdefaults.c instead of duplicating/forking code from it.
> >
> > Would it be ok to move on_winver_change() and some of its friends like
> > win_versions[] and set_reg_key() to libwine.so.1 for this purpose ?
> 
> How about rather than writing another application to do this, you make
> winecfg take arguments on the command line so you could set something
> like
> 
> winecfg foo.exe --winver win98 --dll=gdiplus.dll=n

Yes, I suppose that'll do.   Want a patch for --winver ?

-- 
Robert Millan

<GPLv2> I know my rights; I want my phone call!
<DRM> What use is a phone call, if you are unable to speak?
(as seen on /.)


From julliard at winehq.org  Sat Dec 29 06:04:50 2007
From: julliard at winehq.org (Alexandre Julliard)
Date: Sat, 29 Dec 2007 13:04:50 +0100
Subject: splitting out on_winver_change() and friends
In-Reply-To: <20071229114315.GA1799@thorin> (Robert Millan's message of "Sat, 
	29 Dec 2007 12:43:15 +0100")
References: <20071227215055.GA13916@thorin>
	<19e31a080712280243n2fb913fer392e0ed37b208145@mail.gmail.com>
	<20071229114315.GA1799@thorin>
Message-ID: <87bq896719.fsf@wine.dyndns.org>

Robert Millan <rmh at aybabtu.com> writes:

> On Fri, Dec 28, 2007 at 05:43:40AM -0500, Steven Edwards wrote:
>> How about rather than writing another application to do this, you make
>> winecfg take arguments on the command line so you could set something
>> like
>> 
>> winecfg foo.exe --winver win98 --dll=gdiplus.dll=n
>
> Yes, I suppose that'll do.   Want a patch for --winver ?

It's only a matter of setting a registry key, that can be done easily by
calling regedit, there's no need to involve winecfg.

-- 
Alexandre Julliard
julliard at winehq.org


From rmh at aybabtu.com  Sat Dec 29 06:35:49 2007
From: rmh at aybabtu.com (Robert Millan)
Date: Sat, 29 Dec 2007 13:35:49 +0100
Subject: splitting out on_winver_change() and friends
In-Reply-To: <87bq896719.fsf@wine.dyndns.org>
References: <20071227215055.GA13916@thorin>
	<19e31a080712280243n2fb913fer392e0ed37b208145@mail.gmail.com>
	<20071229114315.GA1799@thorin> <87bq896719.fsf@wine.dyndns.org>
Message-ID: <20071229123549.GB3873@thorin>

On Sat, Dec 29, 2007 at 01:04:50PM +0100, Alexandre Julliard wrote:
> Robert Millan <rmh at aybabtu.com> writes:
> 
> > On Fri, Dec 28, 2007 at 05:43:40AM -0500, Steven Edwards wrote:
> >> How about rather than writing another application to do this, you make
> >> winecfg take arguments on the command line so you could set something
> >> like
> >> 
> >> winecfg foo.exe --winver win98 --dll=gdiplus.dll=n
> >
> > Yes, I suppose that'll do.   Want a patch for --winver ?
> 
> It's only a matter of setting a registry key, that can be done easily by
> calling regedit, there's no need to involve winecfg.

Looking at winecfg/appdefaults.c, there seems to be several keys involved.

-- 
Robert Millan

<GPLv2> I know my rights; I want my phone call!
<DRM> What use is a phone call, if you are unable to speak?
(as seen on /.)


From jgardou at yahoo.fr  Sat Dec 29 08:51:54 2007
From: jgardou at yahoo.fr (=?iso-8859-1?q?J=E9r=F4me_Gardou?=)
Date: Sat, 29 Dec 2007 15:51:54 +0100
Subject: .NET apps with mono... some testing.
Message-ID: <200712291551.54528.jgardou@yahoo.fr>

Many .NET/C# apps don't work with the combination wine-mono.....

I've discovered that installing the arial32 from msttcorefonts solves a lot of 
problems, especially with graphical apps.

I've tested a few apps (supreme commander patches, fastmd5 (tested here 
http://bugs.winehq.org/show_bug.cgi?id=10467 with native .NET...) and all of 
them worked quite well, although not quite beautiful.

	

	
		
___________________________________________________________________________ 
Yahoo! Mail r?invente le mail ! D?couvrez le nouveau Yahoo! Mail et son interface r?volutionnaire.
http://fr.mail.yahoo.com



From maarten at codeweavers.com  Sat Dec 29 09:43:45 2007
From: maarten at codeweavers.com (Maarten Lankhorst)
Date: Sat, 29 Dec 2007 16:43:45 +0100
Subject: .NET apps with mono... some testing.
In-Reply-To: <200712291551.54528.jgardou@yahoo.fr>
References: <200712291551.54528.jgardou@yahoo.fr>
Message-ID: <47766B31.5030102@codeweavers.com>

J?r?me Gardou schreef:
> Many .NET/C# apps don't work with the combination wine-mono.....
>
> I've discovered that installing the arial32 from msttcorefonts solves a lot of 
> problems, especially with graphical apps.
>
> I've tested a few apps (supreme commander patches, fastmd5 (tested here 
> http://bugs.winehq.org/show_bug.cgi?id=10467 with native .NET...) and all of 
> them worked quite well, although not quite beautiful.
>   
Which mono version did you use?


From rmh at aybabtu.com  Sat Dec 29 09:45:25 2007
From: rmh at aybabtu.com (Robert Millan)
Date: Sat, 29 Dec 2007 16:45:25 +0100
Subject: splitting out on_winver_change() and friends
In-Reply-To: <19e31a080712280249m2d0940desd3654b841c736666@mail.gmail.com>
References: <20071227215055.GA13916@thorin>
	<19e31a080712280243n2fb913fer392e0ed37b208145@mail.gmail.com>
	<19e31a080712280249m2d0940desd3654b841c736666@mail.gmail.com>
Message-ID: <20071229154525.GA9173@thorin>

On Fri, Dec 28, 2007 at 05:49:39AM -0500, Steven Edwards wrote:
> On Dec 28, 2007 5:43 AM, Steven Edwards <winehacker at gmail.com> wrote:
> > How about rather than writing another application to do this, you make
> > winecfg take arguments on the command line so you could set something
> > like
> >
> > winecfg foo.exe --winver win98 --dll=gdiplus.dll=n
> >
> > Then all you need is a script for your known bad applications....
> 
> Actually, another way you could do it is to use inf files and store
> them in a database. We discussed something like this for the appdb.
> Using inf's would be a cleaner method than hacking winecfg to automate
> importing this data in to the registry and then everyone can use it.
> I'd suggest if you know of an application thats buggy, needs the
> version and dll information hard set, you try the inf route and submit
> it to appdb if its an application listed there.

I was thinking in doing something like this already, but you still need a
way to set winver, so it boils down to either sharing code with winecfg or
duplicating it.

I'd like to avoid duplication if possible.

-- 
Robert Millan

<GPLv2> I know my rights; I want my phone call!
<DRM> What use is a phone call, if you are unable to speak?
(as seen on /.)


From jgardou at yahoo.fr  Sat Dec 29 09:55:28 2007
From: jgardou at yahoo.fr (=?iso-8859-1?q?J=E9r=F4me_Gardou?=)
Date: Sat, 29 Dec 2007 16:55:28 +0100
Subject: .NET apps with mono... some testing.
In-Reply-To: <47766B31.5030102@codeweavers.com>
References: <200712291551.54528.jgardou@yahoo.fr>
	<47766B31.5030102@codeweavers.com>
Message-ID: <200712291655.28234.jgardou@yahoo.fr>

Le Saturday 29 December 2007 16:43:45 Maarten Lankhorst, vous avez ?crit?:
> J?r?me Gardou schreef:
> > Many .NET/C# apps don't work with the combination wine-mono.....
> >
> > I've discovered that installing the arial32 from msttcorefonts solves a
> > lot of problems, especially with graphical apps.
> >
> > I've tested a few apps (supreme commander patches, fastmd5 (tested here
> > http://bugs.winehq.org/show_bug.cgi?id=10467 with native .NET...) and all
> > of them worked quite well, although not quite beautiful.
>
> Which mono version did you use?

mono-1.2.6 with gtksharp 2.10.2 . the latest available on mono website.

I'm trying to figure out why font rendering is so bad on gtk# applications. 
(try gtk theme manager... it's awful)

	

	
		
___________________________________________________________________________ 
Yahoo! Mail r?invente le mail ! D?couvrez le nouveau Yahoo! Mail et son interface r?volutionnaire.
http://fr.mail.yahoo.com



From wine-devel at kievinfo.com  Sat Dec 29 10:11:17 2007
From: wine-devel at kievinfo.com (Vitaliy Margolen)
Date: Sat, 29 Dec 2007 09:11:17 -0700
Subject: Where are the bugzilla admins?
Message-ID: <477671A5.6040403@kievinfo.com>

Where did our buzilla admins go? 3 weeks and nothing is changing!

Vitaliy.


From winehacker at gmail.com  Sat Dec 29 10:18:26 2007
From: winehacker at gmail.com (Steven Edwards)
Date: Sat, 29 Dec 2007 11:18:26 -0500
Subject: splitting out on_winver_change() and friends
In-Reply-To: <20071229154525.GA9173@thorin>
References: <20071227215055.GA13916@thorin>
	<19e31a080712280243n2fb913fer392e0ed37b208145@mail.gmail.com>
	<19e31a080712280249m2d0940desd3654b841c736666@mail.gmail.com>
	<20071229154525.GA9173@thorin>
Message-ID: <19e31a080712290818o4eaf3395v52f0a75a6fcd7c8f@mail.gmail.com>

On Dec 29, 2007 10:45 AM, Robert Millan <rmh at aybabtu.com> wrote:
> I was thinking in doing something like this already, but you still need a
> way to set winver, so it boils down to either sharing code with winecfg or
> duplicating it.
>
> I'd like to avoid duplication if possible.

I am not sure where the global winver is set but I am sure its still
in the registry so you can change it with a registry key as Julliard
said. For just running per-application all you need to do is set it as
HKCU\Software\Wine\AppDefaults\foo.exe\Version which is a string
resource, again this can be done via a reg file that regedit can
import. Thats even less complicated then then inf route I suggested.

Do you mean you have a situation like a broken application AND
installer that only works under win98 but the default version is
win2000? Maybe you only want that installer to run in win98 mode but
the rest of wine to run in win2000 mode? Wine used to have the -winver
option I think and CrossOver has this setting but I can't see anyway
to set the windows version on the command line for a buggy installer.
The solution (which I also think kind of sucks) would be to do
something like script

wine regedit add-setup.exe-version.reg
wine setup.exe
wine regedit remove-setup.exe-version.reg
wine regedit add-foo.exe-version.reg
wine foo.exe

Of course steps 3 and 4 could be combined in one registry file and 1
and 3 would not even be needed if you could set the version on the
command line but we don't seem to support that anymore for quite a
long time. I think the solution to have multiple appdefaults with
programs having generic names like setup.exe and install.exe is to
enhance the support in wine and winecfg application/dlloverrides to
use md5sum/sha hashes. I don't know how julliard really feels about
this but this is similar to what was discussed with having a custom
Wine shim engine for application compatibly. If you were going to
change some code and he approves I think this is the route to go.....

So say rather than having

HKCU\Software\Wine\AppDefaults\setup.exe\Version win98

you would have something like

HKCU\Software\Wine\AppDefaults\b83fd2e8b34ba6b6f59e9f9cfbe129d9\Version win98
HKCU\Software\Wine\AppDefaults\b83fd2e8b34ba6b6f59e9f9cfbe129d9\filename
setup.exe

HKCU\Software\Wine\AppDefaults\912672566150fd7663fba3a927f79fca\Version win2000
HKCU\Software\Wine\AppDefaults\912672566150fd7663fba3a927f79fca\filename
setup.exe

This way two installers both named setup.exe can have their own
windows version and dlloverrides set.

Thanks
Steven

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From winehacker at gmail.com  Sat Dec 29 10:23:11 2007
From: winehacker at gmail.com (Steven Edwards)
Date: Sat, 29 Dec 2007 11:23:11 -0500
Subject: splitting out on_winver_change() and friends
In-Reply-To: <20071229154525.GA9173@thorin>
References: <20071227215055.GA13916@thorin>
	<19e31a080712280243n2fb913fer392e0ed37b208145@mail.gmail.com>
	<19e31a080712280249m2d0940desd3654b841c736666@mail.gmail.com>
	<20071229154525.GA9173@thorin>
Message-ID: <19e31a080712290823x3a51f120l337194b14144f7ed@mail.gmail.com>

On Dec 29, 2007 10:45 AM, Robert Millan <rmh at aybabtu.com> wrote:
> I'd like to avoid duplication if possible.

Also as a follow-up again, you can also just hack Dan's winetricks
script for your needs as it does the winversion magic with the
registry I was talking about. I think doing that would be a hack and
if you want to properly fix the problem (if I understand what you need
correctly) is to enhance the entire application default override
system like I described in the last email.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From jgardou at yahoo.fr  Sat Dec 29 11:11:02 2007
From: jgardou at yahoo.fr (=?iso-8859-1?q?J=E9r=F4me_Gardou?=)
Date: Sat, 29 Dec 2007 18:11:02 +0100
Subject: .NET apps with mono... some testing.
In-Reply-To: <200712291655.28234.jgardou@yahoo.fr>
References: <200712291551.54528.jgardou@yahoo.fr>
	<47766B31.5030102@codeweavers.com>
	<200712291655.28234.jgardou@yahoo.fr>
Message-ID: <200712291811.03320.jgardou@yahoo.fr>

Le Saturday 29 December 2007 16:55:28 J?r?me Gardou, vous avez ?crit?:
> Le Saturday 29 December 2007 16:43:45 Maarten Lankhorst, vous avez ?crit?:
> > J?r?me Gardou schreef:
> > > Many .NET/C# apps don't work with the combination wine-mono.....
> > >
> > > I've discovered that installing the arial32 from msttcorefonts solves a
> > > lot of problems, especially with graphical apps.
> > >
> > > I've tested a few apps (supreme commander patches, fastmd5 (tested here
> > > http://bugs.winehq.org/show_bug.cgi?id=10467 with native .NET...) and
> > > all of them worked quite well, although not quite beautiful.
> >
> > Which mono version did you use?
>
> mono-1.2.6 with gtksharp 2.10.2 . the latest available on mono website.
>
> I'm trying to figure out why font rendering is so bad on gtk# applications.
> (try gtk theme manager... it's awful)
>
>

Some more feedback here.

Changing the key HKEY_CURRENT_CONFIG\Software\Fonts\LogPixels from 96 to 2 
changes everything. From enormous characters in gtk# programs, there is now a 
good size in those apps.

Obviously, this is not the good way to get it working.




	

	
		
___________________________________________________________________________ 
Yahoo! Mail r?invente le mail ! D?couvrez le nouveau Yahoo! Mail et son interface r?volutionnaire.
http://fr.mail.yahoo.com



From stefani at seibold.net  Sat Dec 29 07:59:31 2007
From: stefani at seibold.net (Stefani Seibold)
Date: Sat, 29 Dec 2007 14:59:31 +0100
Subject: err:ntdll:RtlpWaitForCriticalSection blocked
Message-ID: <1198936771.9031.6.camel@matrix>

Hi,

i still try since more than two years to bring up the old windows 95
game "pitfall: the mayan adventure".

The games runs well without sound, but if i try to enable the sound a
small sound chuck will be played and the games freeze with the message:

err:ntdll:RtlpWaitForCriticalSection section 0x20017c90 "?" wait timed
out in thread 0009, blocked by 000f, retrying (60 sec)
err:ntdll:RtlpWaitForCriticalSection section 0x20017c90 "?" wait timed
out in thread 000e, blocked by 000f, retrying (60 sec)

All Wine Versions since the last two years have the same effect,
included the newest 0.9.52.

Any idea?

Thanx for helping me...

Stefani




From hverbeet at gmail.com  Sat Dec 29 12:36:24 2007
From: hverbeet at gmail.com (H. Verbeet)
Date: Sat, 29 Dec 2007 19:36:24 +0100
Subject: What happened to the videos from WineConf?
In-Reply-To: <558b2f5c0712281026x49fe685y9f596ff9872f7059@mail.gmail.com>
References: <47752A3A.7010704@codeweavers.com>
	<558b2f5c0712281026x49fe685y9f596ff9872f7059@mail.gmail.com>
Message-ID: <d658b69e0712291036l797bac3i272f82c8ee9863e9@mail.gmail.com>

On 28/12/2007, Lei Zhang <thestig at google.com> wrote:
> On Dec 28, 2007 8:54 AM, Maarten Lankhorst <maarten at codeweavers.com> wrote:
> > I remember at wineconf there were some videos created, what happened
> > with those? I tried to look on youtube for wineconf, but I didn't find
> > anything. Are they online yet? Or will they be put online?
> >
> > -Maarten
> >
>
> The videos have been processed and encoded, but we ran into problems
> getting them on youtube. I've found the right person to talk to about
> this, so hopefully they'll get the videos online in the next couple
> weeks.
>
FWIW, personally I don't care much for youtube. Just having an .ogg we
can download somewhere would be enough for me.

Related to this subject, what happened to the group foto? I don't
think it was posted to winehq like last year.


From saulius2 at ar.fi.lt  Sat Dec 29 13:26:47 2007
From: saulius2 at ar.fi.lt (Saulius Krasuckas)
Date: Sat, 29 Dec 2007 21:26:47 +0200 (EET)
Subject: COM/DCOM of WINE
In-Reply-To: <200710250958.35661.research@science.su>
References: <586B06EED9F2614DAA1B52C8C626563D0258F4F1@NE2K3EVS10.corp.clp.com.hk>
	<200710250958.35661.research@science.su>
Message-ID: <Pine.LNX.4.62.0712291647270.12541@tvarka.ar.fi.lt>

* On Thu, 25 Oct 2007, L. Rahyen wrote:
> * On Thursday October 25 2007 08:08, Fong, Man To wrote:
> > 
> > > The communication protocol, pre-defined by TCS manufacturing, is 
> > > DCOM. Since the communication protocol is not opened by the 
> > > manufacturer. We must install the API provided by the manufacturer 
> > > on our workstation running on Linux. Does WINE support the DCOM 
> > > function?
  ... 
> If something will not work for you please fill a bug report at 
> http://bugs.winehq.org . In case if builtin DCOM support doesn't work as 
> expected you can run "winetricks dcom98" to use native DCOM instead (you 
> can download winetricks at http://kegel.com/wine/winetricks ). If this 
> workaround helps you should mention this in your bug report as well.

IANAL, but for being legal this way requires a user to have valid Windows 
Licence (or so).  One of at least Win98, AFAIK.


From saulius2 at ar.fi.lt  Sat Dec 29 13:39:23 2007
From: saulius2 at ar.fi.lt (Saulius Krasuckas)
Date: Sat, 29 Dec 2007 21:39:23 +0200 (EET)
Subject: bug 9986
In-Reply-To: <9e89675b0710260445h39205b83t4458a5d2819b82d1@mail.gmail.com>
References: <3a768c550710251443y28c5ec63j3e671cf0514b530@mail.gmail.com>
	<3f4fd2640710251502q1bd24a3ftf9d38348e8dcec4c@mail.gmail.com>
	<3a768c550710251509m21e52d59u54825cb64df67397@mail.gmail.com>
	<3f4fd2640710251558s32981fd1saccd79783874864f@mail.gmail.com>
	<9e89675b0710260445h39205b83t4458a5d2819b82d1@mail.gmail.com>
Message-ID: <Pine.LNX.4.62.0712292127050.12541@tvarka.ar.fi.lt>

* On Fri, 26 Oct 2007, Damjan Jovanovic wrote:
> * On 10/26/07, Reece Dunn wrote:
> > * On 25/10/2007, Juan Lang wrote:
> > > 
> > > > Tests would also be useful here as well, so that there is not a 
> > > > regression.
> > >
> > > That's good general advice, but hard to implement without a serial 
> > > device to test against, which our test systems won't have.
> >
> > You could always skip the tests when a serial connection is not 
> > present. That way, you get coverage on systems that do have them. It 
> > should be possible to configure Virtual Machines that have serial 
> > ports suitable for use in these tests.
  ...
> You can emulate a serial port, but that requires kernel-mode drivers
> in at least Windows, and emulating hardware that plugs into the
> emulated port isn't much easier.

Yes, but this is possible. I believe, the ideal state would be when MinGW 
support for compiling device drivers + Wine support for running KMD is 
good enough.

It probably should be a separate software project, though, as it will 
require very specific driver coding and testing-on-Windows manpower.  No?


From alexd4 at inbox.lv  Sat Dec 29 23:24:07 2007
From: alexd4 at inbox.lv (Alexander Dorofeyev)
Date: Sat, 29 Dec 2007 21:24:07 -0800
Subject: [1/3] WineD3D: Fix a problem in BltOverride
In-Reply-To: <1198920561.2789.2.camel@typhoon>
References: <4776222F.50707@inbox.lv> <1198920561.2789.2.camel@typhoon>
Message-ID: <47772B77.9000703@inbox.lv>

I don't have this game, so I can't check myself, but I think that the reason of 
slowdown may be not only that a err message is printed, but also because it 
exists with error, and that means it will have to do slower, software blit. But 
in older versions in this situation it would try hardware accelerated blit, I think.

Can you try commenting or removing the line with ERR() to check? It's 
wine/dlls/wined3d/surface.c:2976. If the game is still slower than it used to 
be, another thing you can try is also comment/remove 'return ...' statement just 
after that ERR and see what happens. After more careful look at that code, it 
looks to me both ERR and return there may be a mistake, because it causes 
regular texture -> render target blits not to happen in hardware, but it will be 
safer if you test first if it works at all without these lines :).

Maxime Belleng? wrote:
> Hi,
> 
> Yes the problem is fixed with this patch although I have millions
> traces like this one :
> 
> err:d3d_surface:IWineD3DSurfaceImpl_BltOverride Unexpected render target
> -> render target blit
> 
> It makes the game slow whereas before wine 0.9.51 if I remember exactly,
> the game was fast without this message. Maybe this trace should be made
> a warn instead of en error ?


From thunderbird2k at gmx.net  Sat Dec 29 13:51:26 2007
From: thunderbird2k at gmx.net (Roderick Colenbrander)
Date: Sat, 29 Dec 2007 20:51:26 +0100
Subject: splitting out on_winver_change() and friends
In-Reply-To: <19e31a080712290818o4eaf3395v52f0a75a6fcd7c8f@mail.gmail.com>
References: <20071227215055.GA13916@thorin>
	<19e31a080712280243n2fb913fer392e0ed37b208145@mail.gmail.com>
	<19e31a080712280249m2d0940desd3654b841c736666@mail.gmail.com>
	<20071229154525.GA9173@thorin>
	<19e31a080712290818o4eaf3395v52f0a75a6fcd7c8f@mail.gmail.com>
Message-ID: <20071229195126.54450@gmx.net>

> On Dec 29, 2007 10:45 AM, Robert Millan <rmh at aybabtu.com> wrote:
> > I was thinking in doing something like this already, but you still need
> a
> > way to set winver, so it boils down to either sharing code with winecfg
> or
> > duplicating it.
> >
> > I'd like to avoid duplication if possible.
> 
> I am not sure where the global winver is set but I am sure its still
> in the registry so you can change it with a registry key as Julliard
> said. For just running per-application all you need to do is set it as
> HKCU\Software\Wine\AppDefaults\foo.exe\Version which is a string
> resource, again this can be done via a reg file that regedit can
> import. Thats even less complicated then then inf route I suggested.
> 
> Do you mean you have a situation like a broken application AND
> installer that only works under win98 but the default version is
> win2000? Maybe you only want that installer to run in win98 mode but
> the rest of wine to run in win2000 mode? Wine used to have the -winver
> option I think and CrossOver has this setting but I can't see anyway
> to set the windows version on the command line for a buggy installer.
> The solution (which I also think kind of sucks) would be to do
> something like script
> 
> wine regedit add-setup.exe-version.reg
> wine setup.exe
> wine regedit remove-setup.exe-version.reg
> wine regedit add-foo.exe-version.reg
> wine foo.exe
> 
> Of course steps 3 and 4 could be combined in one registry file and 1
> and 3 would not even be needed if you could set the version on the
> command line but we don't seem to support that anymore for quite a
> long time. I think the solution to have multiple appdefaults with
> programs having generic names like setup.exe and install.exe is to
> enhance the support in wine and winecfg application/dlloverrides to
> use md5sum/sha hashes. I don't know how julliard really feels about
> this but this is similar to what was discussed with having a custom
> Wine shim engine for application compatibly. If you were going to
> change some code and he approves I think this is the route to go.....
> 
> So say rather than having
> 
> HKCU\Software\Wine\AppDefaults\setup.exe\Version win98
> 
> you would have something like
> 
> HKCU\Software\Wine\AppDefaults\b83fd2e8b34ba6b6f59e9f9cfbe129d9\Version
> win98
> HKCU\Software\Wine\AppDefaults\b83fd2e8b34ba6b6f59e9f9cfbe129d9\filename
> setup.exe
> 
> HKCU\Software\Wine\AppDefaults\912672566150fd7663fba3a927f79fca\Version
> win2000
> HKCU\Software\Wine\AppDefaults\912672566150fd7663fba3a927f79fca\filename
> setup.exe
> 
> This way two installers both named setup.exe can have their own
> windows version and dlloverrides set.
> 
> Thanks
> Steven
> 
> -- 
> Steven Edwards
> 
> "There is one thing stronger than all the armies in the world, and
> that is an idea whose time has come." - Victor Hugo
> 

The system on windows doesn't use the md5sum (I think it has one) but it looks for the product ID which is burried into most executables first. It also checks for other things but in a hackier way. As there are a lot of different versions of a program but which all need the same override.

Roderick
-- 
GMX FreeMail: 1 GB Postfach, 5 E-Mail-Adressen, 10 Free SMS.
Alle Infos und kostenlose Anmeldung: http://www.gmx.net/de/go/freemail


From rmh at aybabtu.com  Sat Dec 29 13:58:06 2007
From: rmh at aybabtu.com (Robert Millan)
Date: Sat, 29 Dec 2007 20:58:06 +0100
Subject: COM/DCOM of WINE
In-Reply-To: <Pine.LNX.4.62.0712291647270.12541@tvarka.ar.fi.lt>
References: <586B06EED9F2614DAA1B52C8C626563D0258F4F1@NE2K3EVS10.corp.clp.com.hk>
	<200710250958.35661.research@science.su>
	<Pine.LNX.4.62.0712291647270.12541@tvarka.ar.fi.lt>
Message-ID: <20071229195806.GA16541@thorin>

On Sat, Dec 29, 2007 at 09:26:47PM +0200, Saulius Krasuckas wrote:
>   ... 
> > If something will not work for you please fill a bug report at 
> > http://bugs.winehq.org . In case if builtin DCOM support doesn't work as 
> > expected you can run "winetricks dcom98" to use native DCOM instead (you 
> > can download winetricks at http://kegel.com/wine/winetricks ). If this 
> > workaround helps you should mention this in your bug report as well.
> 
> IANAL, but for being legal this way requires a user to have valid Windows 
> Licence (or so).  One of at least Win98, AFAIK.

AFAIK copyright only governs copying/distribution.  You may need a license
to redistribute MS-DCOM, but since it's Microsoft itself who distributes it
in their website I don't think they have a basis to claim damages.

(IANAL, either)

-- 
Robert Millan

<GPLv2> I know my rights; I want my phone call!
<DRM> What use is a phone call, if you are unable to speak?
(as seen on /.)


From saulius2 at ar.fi.lt  Sat Dec 29 14:24:56 2007
From: saulius2 at ar.fi.lt (Saulius Krasuckas)
Date: Sat, 29 Dec 2007 22:24:56 +0200 (EET)
Subject: icmp states I need to be running wine as root
In-Reply-To: <3a768c550710211426g690f0256s3dd7053ad426672d@mail.gmail.com>
References: <BAY128-W20EECF38BE9B2383B74329AB990@phx.gbl>
	<471BBDF5.4000105@kievinfo.com>
	<3a768c550710211405y7538b533jf64bb7d18020ad12@mail.gmail.com>
	<BAY128-W6DDF560A5D1ECA2013A27AB990@phx.gbl>
	<3a768c550710211426g690f0256s3dd7053ad426672d@mail.gmail.com>
Message-ID: <Pine.LNX.4.62.0712292141470.12541@tvarka.ar.fi.lt>

* On Sun, 21 Oct 2007, Juan Lang wrote:
> 
> > Isn't there another way to do this than with SOCK_RAW, or having to 
> > run wine as root?
> 
> In answer to your second question:  yes, modify the Linux kernel not
> to have such restrictions.

Well, there are already patches which modifies it in one way or another.  
I refer to "man 7 capabilities" or web resources [1]-[3].  Some of 
approaches may be abandoned already, but I see recent discussion [4] on 
this and by [5] I judge SELinux already can handle this task.

Plus, I have found some recently updated tool called "Filesystem 
capabilities for linux" which also is not POSIX compatible (and so were 
old capabilities implementation for linux kernel):

|  With this patch, you will be able to grant selective privileges to 
| executables on a needed basis. This means for some executables, there is 
| no need anymore to run as root or as a suid root binary.
| 
| For example, you may drop the SUID bit from ping and grant the 
| CAP_NET_RAW capability:
| 
|     # chmod u-s /bin/ping
|     # chcap cap_net_raw=ep /bin/ping 

If this is acceptable solution, then it probably would be nice for Wine to 
have separate binary for every needed capability.  CAP_NET_RAW (for ICMP), 
CAP_SYS_RAWIO (for IO ports) and CAP_SYS_NICE (for threads priority) comes 
to mind.

This plan is to don't force users to give the bunch of capabilities to the 
main Wine binary (or even several of them) at once (so the security risk 
should be increased in a minimal way).  But well, that could be a minor 
nuance for such users.


[1] http://www.securityfocus.com/infocus/1400
[2] http://lwn.net/Articles/79185/
[3] http://lwn.net/Articles/199004/
[4] http://lkml.org/lkml/2006/9/18/100
[5] http://lwn.net/Articles/79208/
[6] http://www.olafdietsche.de/linux/capability/


From rmh at aybabtu.com  Sat Dec 29 14:08:53 2007
From: rmh at aybabtu.com (Robert Millan)
Date: Sat, 29 Dec 2007 21:08:53 +0100
Subject: splitting out on_winver_change() and friends
In-Reply-To: <19e31a080712290818o4eaf3395v52f0a75a6fcd7c8f@mail.gmail.com>
References: <20071227215055.GA13916@thorin>
	<19e31a080712280243n2fb913fer392e0ed37b208145@mail.gmail.com>
	<19e31a080712280249m2d0940desd3654b841c736666@mail.gmail.com>
	<20071229154525.GA9173@thorin>
	<19e31a080712290818o4eaf3395v52f0a75a6fcd7c8f@mail.gmail.com>
Message-ID: <20071229200853.GB16541@thorin>

On Sat, Dec 29, 2007 at 11:18:26AM -0500, Steven Edwards wrote:
> 
> you would have something like
> 
> HKCU\Software\Wine\AppDefaults\b83fd2e8b34ba6b6f59e9f9cfbe129d9\Version win98
> HKCU\Software\Wine\AppDefaults\b83fd2e8b34ba6b6f59e9f9cfbe129d9\filename
> setup.exe
> 
> HKCU\Software\Wine\AppDefaults\912672566150fd7663fba3a927f79fca\Version win2000
> HKCU\Software\Wine\AppDefaults\912672566150fd7663fba3a927f79fca\filename
> setup.exe

Sounds good.  It could also be a good idea to have some mechanism so that
multiple hashes can point to the same description / setup.  Think of the same
versioning problem shared by a dozen of different localised versions of an
app, etc.

How about something like:

HKCU\Software\Wine\AppDefaults\md5\b83fd2e8b34ba6b6f59e9f9cfbe129d9 foomatic_installer
HKCU\Software\Wine\AppDefaults\md5\912672566150fd7663fba3a927f79fca foomatic_installer
   [ ... ]
HKCU\Software\Wine\AppDefaults\foomatic_installer\Version win98
HKCU\Software\Wine\AppDefaults\foomatic_installer\filename setup.exe

(as a bonus, this gives us a short description of what these hashes are
referring to)

-- 
Robert Millan

<GPLv2> I know my rights; I want my phone call!
<DRM> What use is a phone call, if you are unable to speak?
(as seen on /.)


From rmh at aybabtu.com  Sat Dec 29 14:23:37 2007
From: rmh at aybabtu.com (Robert Millan)
Date: Sat, 29 Dec 2007 21:23:37 +0100
Subject: splitting out on_winver_change() and friends
In-Reply-To: <20071229195126.54450@gmx.net>
References: <20071227215055.GA13916@thorin>
	<19e31a080712280243n2fb913fer392e0ed37b208145@mail.gmail.com>
	<19e31a080712280249m2d0940desd3654b841c736666@mail.gmail.com>
	<20071229154525.GA9173@thorin>
	<19e31a080712290818o4eaf3395v52f0a75a6fcd7c8f@mail.gmail.com>
	<20071229195126.54450@gmx.net>
Message-ID: <20071229202337.GA17240@thorin>

On Sat, Dec 29, 2007 at 08:51:26PM +0100, Roderick Colenbrander wrote:
> 
> The system on windows doesn't use the md5sum (I think it has one) but it looks for the product ID which is burried into most executables first. It also checks for other things but in a hackier way. As there are a lot of different versions of a program but which all need the same override.

I think it's a bad idea to do that:

  - Product IDs may not necessarily be unique identifiers for every
  given program.  Hashes are.

  - It's easier for users to submit information about their apps if they
  can use tools they're familiar with such as md5sum / sha1sum.

-- 
Robert Millan

<GPLv2> I know my rights; I want my phone call!
<DRM> What use is a phone call, if you are unable to speak?
(as seen on /.)


From luis.montes at dslextreme.com  Sat Dec 29 14:35:01 2007
From: luis.montes at dslextreme.com (Luis A. Montes)
Date: Sat, 29 Dec 2007 12:35:01 -0800
Subject: RtlpWaitForCriticalSection
Message-ID: <1198960501.5547.29.camel@localhost>

I got a game (Need for speed III) that has been reported to work by
others. On my computer, though, the game hangs at different places about
50% of the time. I compiled Wine 0.9.51 from source on a Slackware 12.0
dual core Athlon, and although I'm sure most people this days buy at
least that kind of computer, maybe that was not true when the reports
came out. What I'm thinking is that this is a race condition brought out
because of the two cores. I think that because if I run inside gdb I
catch a SIGTERM going to a thread that then exits. Another thread then
prints the:
err:ntdll:RtlpWaitForCriticalSection section ... wait timed out in
thread ..., blocked by <dead_thread>, retrying (60 sec)

I see three ways to fix this problem:
- When a thread dies, release the locks it has. Of course this wouldn't
be compatible with windows, but perhaps a command line option could
activate that code. In any case I could try something like that for this
game in particular. I'm looking for some pointers on where should I
start looking.
- Looking into why the thread is getting a SIGTERM in the first place.
Perhaps there is a way to delay the signal from being sent in a
reasonable way? Who would be sending it?
- Run the game in a single core (setting the affinity?) It just occur to
me that I should be able to set the affinity on a bash shell and then
start wine from there. I'll try that.



From rmh at aybabtu.com  Sat Dec 29 16:13:04 2007
From: rmh at aybabtu.com (Robert Millan)
Date: Sat, 29 Dec 2007 23:13:04 +0100
Subject: splitting out on_winver_change() and friends
In-Reply-To: <19e31a080712290823x3a51f120l337194b14144f7ed@mail.gmail.com>
References: <20071227215055.GA13916@thorin>
	<19e31a080712280243n2fb913fer392e0ed37b208145@mail.gmail.com>
	<19e31a080712280249m2d0940desd3654b841c736666@mail.gmail.com>
	<20071229154525.GA9173@thorin>
	<19e31a080712290823x3a51f120l337194b14144f7ed@mail.gmail.com>
Message-ID: <20071229221304.GA20600@thorin>

On Sat, Dec 29, 2007 at 11:23:11AM -0500, Steven Edwards wrote:
> On Dec 29, 2007 10:45 AM, Robert Millan <rmh at aybabtu.com> wrote:
> > I'd like to avoid duplication if possible.
> 
> Also as a follow-up again, you can also just hack Dan's winetricks
> script for your needs as it does the winversion magic with the
> registry I was talking about.

I looked at this before, and the winversion magic in that script seems to
be just a minor part of what winecfg does.

> I think doing that would be a hack and
> if you want to properly fix the problem (if I understand what you need
> correctly) is to enhance the entire application default override
> system like I described in the last email.

Yes.  I want to do it right.  Should I start working in that direction?

-- 
Robert Millan

<GPLv2> I know my rights; I want my phone call!
<DRM> What use is a phone call, if you are unable to speak?
(as seen on /.)


From winehacker at gmail.com  Sat Dec 29 16:29:40 2007
From: winehacker at gmail.com (Steven Edwards)
Date: Sat, 29 Dec 2007 17:29:40 -0500
Subject: splitting out on_winver_change() and friends
In-Reply-To: <20071229221304.GA20600@thorin>
References: <20071227215055.GA13916@thorin>
	<19e31a080712280243n2fb913fer392e0ed37b208145@mail.gmail.com>
	<19e31a080712280249m2d0940desd3654b841c736666@mail.gmail.com>
	<20071229154525.GA9173@thorin>
	<19e31a080712290823x3a51f120l337194b14144f7ed@mail.gmail.com>
	<20071229221304.GA20600@thorin>
Message-ID: <19e31a080712291429x486cfb2l4f676d6a243f15a3@mail.gmail.com>

On Dec 29, 2007 5:13 PM, Robert Millan <rmh at aybabtu.com> wrote:
> Yes.  I want to do it right.  Should I start working in that direction?

I'd like to hear Alexandre's comments for my suggestions. The current
application override system bothers me but maybe he has other ideas or
I am missing something. The entire system seems to depend too much on
the applications name which seems limited to me but maybe he has ideas
for a more robust way of tracking dlloverrides and version settings
when the application name conflicts.

-- 
Steven Edwards

"There is one thing stronger than all the armies in the world, and
that is an idea whose time has come." - Victor Hugo


From dank at kegel.com  Sat Dec 29 19:04:16 2007
From: dank at kegel.com (Dan Kegel)
Date: Sat, 29 Dec 2007 17:04:16 -0800
Subject: appdb license choices unclear
Message-ID: <a71bd89a0712291704u6c996d51x82c2ef89b970cbdf@mail.gmail.com>

Has anybody else been confused by this?
When submitting an app to the appdb, I'm often flummoxed
by what to put in the license field.  I'm usually
looking for something that means
"Closed source, free to download, but not redistributable"
(like e.g. http://labs.adobe.com/misc/terms_of_use.html )
but the only choices
are: Retail, Open Source, Freeware, Demo, Shareware.

"Freeware" might be the closest of the bunch, but it implies GPL or
at least the ability to redistribute binaries
(i.e. the other meaning of the word Free).

Is there a way to make this clearer?   Maybe "nonredistributable freeware"?
- Dan


From dank at kegel.com  Sat Dec 29 19:13:24 2007
From: dank at kegel.com (Dan Kegel)
Date: Sat, 29 Dec 2007 17:13:24 -0800
Subject: appdb new version submission form has awkward radio buttons
Message-ID: <a71bd89a0712291713m31767092ge9d77942ad18d6be@mail.gmail.com>

When submitting a new version, clicking the radio button next
to "Request being a maintainer for this version, allowing you to edit it later"
or "Monitor changes to this version, also after it has been accepted"
can't be undone.  There should be a way to get back to the state
of no button clicked.  Perhaps those should be checkboxes instead.


From remco47 at yahoo.com  Sat Dec 29 20:22:24 2007
From: remco47 at yahoo.com (Remco)
Date: Sat, 29 Dec 2007 18:22:24 -0800 (PST)
Subject: What happened to the videos from WineConf?
Message-ID: <132394.88565.qm@web50110.mail.re2.yahoo.com>

"H. Verbeet" <hverbeet at gmail.com> wrote:
> > The videos have been processed and encoded, but we ran into problems
> > getting them on youtube. I've found the right person to talk to
> > about this, so hopefully they'll get the videos online in the next
> > couple weeks.
> 
> FWIW, personally I don't care much for youtube. Just having an .ogg we
> can download somewhere would be enough for me.

Maybe the full-res Theora videos can be published as torrents on a
strictly legal tracker like legittorrents.info? Alternatively,
WineHQ.org could host a tracker. This can be useful for
bandwidth-reduction on all downloads from WineHQ.org.

Remco



      ____________________________________________________________________________________
Looking for last minute shopping deals?  
Find them fast with Yahoo! Search.  http://tools.search.yahoo.com/newsearch/category.php?category=shopping


From dank at kegel.com  Sat Dec 29 23:48:45 2007
From: dank at kegel.com (Dan Kegel)
Date: Sat, 29 Dec 2007 21:48:45 -0800
Subject: So, you want to fix typos?
Message-ID: <a71bd89a0712292148i394d4004habfca647842f3715@mail.gmail.com>

I see somebody's posting a few fix-typo-in-comments patches, e.g.
http://www.winehq.org/pipermail/wine-patches/2007-December/048099.html
http://www.winehq.org/pipermail/wine-patches/2007-December/048101.html

That reminds me that I worked out some time ago how
to find such typos efficiently.  At the risk of encouraging lots
of silly typo-fixing patches, I've documented the process here:
http://kegel.com/wine/spellingpolice/

For instance, to find typos in comments in shell32, you can do:

sudo apt-get install ispell

wget http://kegel.com/wine/spellingpolice/stop.txt
wget http://kegel.com/wine/spellingpolice/lspell-pl.txt -O lspell.pl
perl lspell.pl stop.txt ~/wine-git/dlls/shell32/*.[ch]

This outputs:

/home/dank/wine-git/dlls/shell32/autocomplete.c: 1

dispays

/home/dank/wine-git/dlls/shell32/brsfolder.c: 1

relativ

/home/dank/wine-git/dlls/shell32/dataobject.c: 1

droping

/home/dank/wine-git/dlls/shell32/iconcache.c: 1

resoure

/home/dank/wine-git/dlls/shell32/pidl.c: 1

relativ

/home/dank/wine-git/dlls/shell32/pidl.h: 1

desribes

/home/dank/wine-git/dlls/shell32/shell.c: 1

incidently

/home/dank/wine-git/dlls/shell32/shfldr_fs.c: 1

spezified

/home/dank/wine-git/dlls/shell32/shfldr_unixfs.c: 4

appart relativ savely should'nt

/home/dank/wine-git/dlls/shell32/shlexec.c: 1

foward

/home/dank/wine-git/dlls/shell32/shlfileop.c: 2

ERRROR INVLID

/home/dank/wine-git/dlls/shell32/shlfolder.c: 1

whitch

/home/dank/wine-git/dlls/shell32/shlview.c: 2

buily provied

/home/dank/wine-git/dlls/shell32/trash.c: 1

DESCRITION


From fgouget at free.fr  Sun Dec 30 03:22:41 2007
From: fgouget at free.fr (Francois Gouget)
Date: Sun, 30 Dec 2007 10:22:41 +0100 (CET)
Subject: So, you want to fix typos?
In-Reply-To: <a71bd89a0712292148i394d4004habfca647842f3715@mail.gmail.com>
References: <a71bd89a0712292148i394d4004habfca647842f3715@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0712301010400.13226@amboise.dolphin>

On Sat, 29 Dec 2007, Dan Kegel wrote:
[...]
> That reminds me that I worked out some time ago how
> to find such typos efficiently.  At the risk of encouraging lots
> of silly typo-fixing patches, I've documented the process here:
> http://kegel.com/wine/spellingpolice/

I've run my 'typos' script on your custom dictionary and noticed it 
allows a couple of bad words:

   nonexistant
   upto
   UPTO
   wether

and also

   Codeweavers
   Bad capitalization, should be 'CodeWeavers'. I'm including it because 
the dictionary seems case sensitive.

It also allows all variants of the following though I realize you have 
no choice because these are part of longer Microsoft identifiers:
   OCCURED  (from STATUS_MCA_OCCURED)
   SEPERATOR (from MDP_SEPERATOR, SDDL_SEPERATOR and SEPERATOR)


Typos:
   http://fgouget.free.fr/index-en.shtml#typos
   http://fgouget.free.fr/typos/typos

-- 
Francois Gouget <fgouget at free.fr>              http://fgouget.free.fr/
          The last time religion ruled, it was called the dark ages.


